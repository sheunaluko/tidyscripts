/*! For license information please see tidyscripts_web_umd.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tidyscripts_web=t():e.tidyscripts_web=t()}(this,(()=>(()=>{var e={515:(e,t,n)=>{var r={78:(e,t)=>{var n={749:(e,t,n)=>{e=n.nmd(e);const r=(e=0)=>t=>`[${38+e};5;${t}m`,i=(e=0)=>(t,n,r)=>`[${38+e};2;${t};${n};${r}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[n,r]of Object.entries(t)){for(const[n,i]of Object.entries(r))t[n]={open:`[${i[0]}m`,close:`[${i[1]}m`},r[n]=t[n],e.set(i[0],i[1]);Object.defineProperty(t,n,{value:r,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=r(),t.color.ansi16m=i(),t.bgColor.ansi256=r(10),t.bgColor.ansi16m=i(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,n)=>e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:n}=t.groups;3===n.length&&(n=n.split("").map((e=>e+e)).join(""));const r=Number.parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},991:(e,t)=>{t.byteLength=function(e){var t=o(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,a=o(e),s=a[0],l=a[1],u=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,l)),c=0,h=l>0?s-4:s;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===l&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[c++]=255&t),1===l&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],s=16383,o=0,u=r-i;o<u;o+=s)a.push(l(e,o,o+s>u?u:o+s));return 1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),a.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)n[s]=a[s],r[a.charCodeAt(s)]=s;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,r){for(var i,a,s=[],o=t;o<r;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},832:e=>{const t=/[\p{Lu}]/u,n=/[\p{Ll}]/u,r=/^[\p{Lu}](?![\p{Lu}])/gu,i=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,s=new RegExp("^"+a.source),o=new RegExp(a.source+i.source,"gu"),l=new RegExp("\\d+"+i.source,"gu"),u=(e,i)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(i={pascalCase:!1,preserveConsecutiveUppercase:!1,...i},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const a=!1===i.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(i.locale),u=!1===i.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(i.locale);return 1===e.length?i.pascalCase?u(e):a(e):(e!==a(e)&&(e=((e,r,i)=>{let a=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){const u=e[l];a&&t.test(u)?(e=e.slice(0,l)+"-"+e.slice(l),a=!1,o=s,s=!0,l++):s&&o&&n.test(u)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,a=!0):(a=r(u)===u&&i(u)!==u,o=s,s=i(u)===u&&r(u)!==u)}return e})(e,a,u)),e=e.replace(s,""),e=i.preserveConsecutiveUppercase?((e,t)=>(r.lastIndex=0,e.replace(r,(e=>t(e)))))(e,a):a(e),i.pascalCase&&(e=u(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,((e,n)=>t(n))).replace(l,(e=>t(e)))))(e,u))};e.exports=u,e.exports.default=u},409:e=>{e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},985:e=>{var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new i(r,a||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=new Array(a);i<a;i++)s[i]=r[i].fn;return s},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,i,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,a),!0;case 6:return c.fn.call(c.context,t,r,i,a,s),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||i&&!o.once||r&&o.context!==r||s(this,a);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||r&&o[l].context!==r)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:s(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o},46:e=>{var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,a),r(n)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}m(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var i,a,s;if(o(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),s=a[t]),void 0===s)s=a[t]=n,++e._eventsCount;else if("function"==typeof s?s=a[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,function(e){console&&console.warn&&console.warn(e)}(u)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=c.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(a){r.once&&e.removeEventListener(t,i),n(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var l=a[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var u=l.length,c=f(l,u);for(n=0;n<u;++n)r(c[n],this,t)}return!0},a.prototype.addListener=function(e,t){return u(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return u(this,e,t,!0)},a.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,a,s;if(o(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){s=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},75:e=>{e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){var i={key:t,value:e[t]},a={key:r,value:e[r]};return n(i,a)}}),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,s;if(Array.isArray(t)){for(s="[",n=0;n<t.length;n++)n&&(s+=","),s+=e(t[n])||"null";return s+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=a.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(s="",n=0;n<l.length;n++){var u=l[n],c=e(t[u]);c&&(s&&(s+=","),s+=JSON.stringify(u)+":"+c)}return a.splice(o,1),"{"+s+"}"}}(e)}},425:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(985),i=n(856),a=n(147),s=()=>{},o=new i.TimeoutError;t.default=class extends r{constructor(e){var t,n,r,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:a.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(n=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==n?n:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(r=e.interval)||void 0===r?void 0:r.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((n,r)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const a=void 0===this._timeout&&void 0===t.timeout?e():i.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&r(o)}));n(await a)}catch(e){r(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},657:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){let r=0,i=e.length;for(;i>0;){const a=i/2|0;let s=r+a;n(e[s],t)<=0?(r=++s,i-=a+1):i=a}return r}},147:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(657);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const n={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(n);const i=r.default(this._queue,n,((e,t)=>t.priority-e.priority));this._queue.splice(i,0,n)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},201:(e,t,n)=>{const r=n(364),i=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class a extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const s=(e,t)=>new Promise(((n,s)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=r.operation(t);o.attempt((async r=>{try{n(await e(r))}catch(e){if(!(e instanceof Error))return void s(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof a)o.stop(),s(e.originalError);else if(e instanceof TypeError&&(l=e.message,!i.includes(l)))o.stop(),s(e);else{((e,t,n)=>{const r=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=r})(e,r,t);try{await t.onFailedAttempt(e)}catch(e){return void s(e)}o.retry(e)||s(o.mainError())}}var l}))}));e.exports=s,e.exports.default=s,e.exports.AbortError=a},856:(e,t,n)=>{const r=n(70);class i extends Error{constructor(e){super(e),this.name="TimeoutError"}}const a=(e,t,n)=>new Promise(((a,s)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void a(e);const o=setTimeout((()=>{if("function"==typeof n){try{a(n())}catch(e){s(e)}return}const r=n instanceof Error?n:new i("string"==typeof n?n:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),s(r)}),t);r(e.then(a,s),(()=>{clearTimeout(o)}))}));e.exports=a,e.exports.default=a,e.exports.TimeoutError=i},70:e=>{e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},364:(e,t,n)=>{e.exports=n(386)},386:(e,t,n)=>{var r=n(884);t.operation=function(e){var n=t.timeouts(e);return new r(n,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<t.retries;i++)r.push(this.createTimeout(i,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(i,t)),r.sort((function(e,t){return e-t})),r},t.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},t.wrap=function(e,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var i in r=[],e)"function"==typeof e[i]&&r.push(i);for(var a=0;a<r.length;a++){var s=r[a],o=e[s];e[s]=function(r){var i=t.operation(n),a=Array.prototype.slice.call(arguments,1),s=a.pop();a.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))})),i.attempt((function(){r.apply(e,a)}))}.bind(e,o),e[s].options=n}}},884:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],a=i.message,s=(e[a]||0)+1;e[a]=s,s>=n&&(t=i,n=s)}return t}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={id:e,loaded:!1,exports:{}};return n[e](a,a.exports,i),a.loaded=!0,a.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var a={};(()=>{i.r(a),i.d(a,{R:()=>n,apis:()=>F,asnc:()=>p,dates:()=>z,external:()=>B,fp:()=>t,get_json_from_url:()=>b$,logger:()=>e,midi_encoder:()=>V,tes:()=>U,trading:()=>o,util:()=>d});var e={};i.r(e),i.d(e,{color_string:()=>mt,colors:()=>gt,get_logger:()=>ft,suppress:()=>dt,unsuppress:()=>pt});var t={};i.r(t),i.d(t,{add:()=>qn,adder:()=>Zn,all_false:()=>Wt,all_true:()=>qt,any_false:()=>Jt,any_is_array:()=>Pn,any_true:()=>Kt,apply_function_dictionary_to_object:()=>rr,async_apply_function_dictionary_to_object:()=>ir,clone:()=>an,clone_array:()=>$t,concat:()=>hn,concat_accross_index:()=>rn,dict_to_list:()=>Rt,diff:()=>er,divide:()=>Jn,divider:()=>Xn,enumerate:()=>en,enumermap:()=>cn,equals:()=>tr,filter:()=>wn,filter_key:()=>_n,filter_key_equals:()=>kn,first:()=>Ft,flat_once:()=>Tn,format:()=>Gn,fourth:()=>Bt,get:()=>It,getter:()=>Ct,im_arr_rm:()=>on,im_push:()=>sn,indexer:()=>Gt,invert_dictionary:()=>Mt,is_array:()=>Rn,is_empty:()=>vn,is_empty_array:()=>yn,is_empty_map:()=>Nt,is_empty_string:()=>Fn,is_map:()=>$n,is_null:()=>Nn,is_object:()=>Mn,is_something:()=>Dn,is_string:()=>Ln,is_undefined:()=>jn,is_zero:()=>mn,join:()=>Bn,joiner:()=>Un,keys:()=>_t,last:()=>Ut,len:()=>gn,list_to_dict:()=>On,make_debouncer:()=>nr,map:()=>Yt,map_get:()=>dn,map_indexed:()=>bt,map_items:()=>Dt,map_over_dic_values:()=>Lt,map_prop:()=>tn,map_prop_reduce:()=>nn,map_set:()=>pn,map_set_im:()=>fn,merge_dictionaries:()=>Tt,merge_dictionary:()=>Pt,multiplier:()=>Yn,multiply:()=>Wn,nchars:()=>zn,not_empty:()=>bn,nth:()=>Ht,partition:()=>un,rand_element:()=>Qt,range:()=>Xt,recursive_flat:()=>In,recursive_flat_remove_empty:()=>En,remove_empty:()=>An,repeat:()=>Zt,second:()=>Vt,set:()=>Et,set_im:()=>xt,setter:()=>Ot,setter_im:()=>St,shallow_copy:()=>wt,sort_by_prop:()=>ln,split:()=>Hn,substring:()=>Vn,subtract:()=>Kn,subtractor:()=>Qn,third:()=>zt,update_at:()=>jt,values:()=>At,values_cloned:()=>kt,zip:()=>Cn,zip2:()=>xn,zip_map:()=>Sn});var n={};i.r(n),i.d(n,{F:()=>ar,T:()=>sr,__:()=>or,add:()=>ur,addIndex:()=>X,addIndexRight:()=>hr,adjust:()=>pr,all:()=>yr,allPass:()=>Ar,always:()=>Pr,and:()=>Ir,andThen:()=>nh,any:()=>Cr,anyPass:()=>Sr,ap:()=>Dr,aperture:()=>Lr,append:()=>$r,apply:()=>Fr,applySpec:()=>Hr,applyTo:()=>qr,ascend:()=>Wr,assoc:()=>ti,assocPath:()=>Yr,binary:()=>ii,bind:()=>it,both:()=>li,call:()=>ui,chain:()=>yi,clamp:()=>bi,clone:()=>Pi,collectBy:()=>Ii,comparator:()=>xi,complement:()=>Si,compose:()=>Vi,composeWith:()=>Ki,concat:()=>qe,cond:()=>Ji,construct:()=>Yi,constructN:()=>Xi,converge:()=>ta,count:()=>ra,countBy:()=>oa,curry:()=>Zi,curryN:()=>Z,dec:()=>la,defaultTo:()=>ca,descend:()=>da,difference:()=>ga,differenceWith:()=>va,dissoc:()=>Pa,dissocPath:()=>ka,divide:()=>Ia,drop:()=>Ca,dropLast:()=>Da,dropLastWhile:()=>La,dropRepeats:()=>Ba,dropRepeatsBy:()=>qa,dropRepeatsWith:()=>za,dropWhile:()=>Ja,either:()=>Ya,empty:()=>ts,endsWith:()=>as,eqBy:()=>Ha,eqProps:()=>os,equals:()=>Ce,evolve:()=>us,filter:()=>ze,find:()=>ds,findIndex:()=>ms,findLast:()=>vs,findLastIndex:()=>_s,flatten:()=>ks,flip:()=>Ps,forEach:()=>Is,forEachObjIndexed:()=>xs,fromPairs:()=>Os,groupBy:()=>Ss,groupWith:()=>js,gt:()=>Rs,gte:()=>Ms,has:()=>zs,hasIn:()=>Us,hasPath:()=>Fs,head:()=>zi,identical:()=>Gs,identity:()=>Ui,ifElse:()=>qs,inc:()=>Ks,includes:()=>Ws,indexBy:()=>Js,indexOf:()=>Zs,init:()=>Qs,innerJoin:()=>Ys,insert:()=>to,insertAll:()=>ro,intersection:()=>uo,intersperse:()=>ho,into:()=>wo,invert:()=>ko,invertObj:()=>Po,invoker:()=>To,is:()=>Io,isEmpty:()=>xo,isNil:()=>Qr,isNotNil:()=>Oo,join:()=>So,juxt:()=>jo,keys:()=>ye,keysIn:()=>Ro,last:()=>Fa,lastIndexOf:()=>Lo,length:()=>Fo,lens:()=>zo,lensIndex:()=>Go,lensPath:()=>Qo,lensProp:()=>Yo,lift:()=>si,liftN:()=>ai,lt:()=>tl,lte:()=>rl,map:()=>be,mapAccum:()=>al,mapAccumRight:()=>ol,mapObjIndexed:()=>ul,match:()=>hl,mathMod:()=>pl,max:()=>br,maxBy:()=>ml,mean:()=>vl,median:()=>wl,memoizeWith:()=>kl,mergeAll:()=>Pl,mergeDeepLeft:()=>Cl,mergeDeepRight:()=>Ol,mergeDeepWith:()=>Sl,mergeDeepWithKey:()=>xl,mergeLeft:()=>jl,mergeRight:()=>Rl,mergeWith:()=>Ml,mergeWithKey:()=>Il,min:()=>Fl,minBy:()=>zl,modify:()=>Gl,modifyPath:()=>Ul,modulo:()=>Kl,move:()=>Jl,multiply:()=>Ql,nAry:()=>ri,negate:()=>tu,none:()=>nu,not:()=>Oi,nth:()=>Je,nthArg:()=>iu,o:()=>su,objOf:()=>mo,of:()=>ou,omit:()=>uu,on:()=>hu,once:()=>du,or:()=>Qa,otherwise:()=>mu,over:()=>vu,pair:()=>bu,partial:()=>_u,partialObject:()=>Yl,partialRight:()=>ku,partition:()=>Au,path:()=>Jo,pathEq:()=>Tu,pathOr:()=>Eu,pathSatisfies:()=>Cu,paths:()=>Ko,pick:()=>Su,pickAll:()=>ju,pickBy:()=>Ru,pipe:()=>Mi,pipeWith:()=>Gi,pluck:()=>_r,prepend:()=>Mu,product:()=>$u,project:()=>Vu,promap:()=>Uu,prop:()=>Qe,propEq:()=>Gu,propIs:()=>Ku,propOr:()=>Ju,propSatisfies:()=>Qu,props:()=>Yu,range:()=>tc,reduce:()=>ut,reduceBy:()=>sa,reduceRight:()=>rc,reduceWhile:()=>ac,reduced:()=>sc,reject:()=>Be,remove:()=>wa,repeat:()=>cc,replace:()=>dc,reverse:()=>Fi,scan:()=>yc,sequence:()=>bc,set:()=>_c,slice:()=>Ri,sort:()=>Ac,sortBy:()=>Tc,sortWith:()=>Ec,split:()=>xc,splitAt:()=>Oc,splitEvery:()=>Nc,splitWhen:()=>Dc,splitWhenever:()=>Lc,startsWith:()=>$c,subtract:()=>Vc,sum:()=>gl,swap:()=>Uc,symmetricDifference:()=>Hc,symmetricDifferenceWith:()=>Gc,tail:()=>Li,take:()=>Na,takeLast:()=>rs,takeLastWhile:()=>qc,takeWhile:()=>Jc,tap:()=>Xc,test:()=>eh,thunkify:()=>ld,times:()=>lc,toLower:()=>rh,toPairs:()=>ah,toPairsIn:()=>oh,toString:()=>He,toUpper:()=>lh,transduce:()=>ch,transpose:()=>dh,traverse:()=>fh,trim:()=>yh,tryCatch:()=>bh,type:()=>Te,unapply:()=>wh,unary:()=>_h,uncurryN:()=>Ah,unfold:()=>Th,union:()=>Ih,unionWith:()=>Oh,uniq:()=>oo,uniqBy:()=>so,uniqWith:()=>Ch,unless:()=>Nh,unnest:()=>jh,until:()=>Rh,unwind:()=>Mh,update:()=>Uo,useWith:()=>Fu,values:()=>zr,valuesIn:()=>Fh,view:()=>Bh,when:()=>Hh,where:()=>qh,whereAny:()=>Wh,whereEq:()=>Jh,without:()=>Qh,xor:()=>Yh,xprod:()=>td,zip:()=>rd,zipObj:()=>ad,zipWith:()=>od});var r={};i.r(r),i.d(r,{MarketTradeType:()=>ud,PortfolioBalancer:()=>cd});var s={};i.r(s),i.d(s,{BacktestBalancer:()=>hd});var o={};i.r(o),i.d(o,{backtest_balancer:()=>s,portfolio_balancer_lib:()=>r});var l={};i.r(l),i.d(l,{abs:()=>md,flat_float32_array:()=>bd,length:()=>dd,mean:()=>gd,mean_abs:()=>yd,min_max_mean:()=>vd,power:()=>pd,sum:()=>fd});var u={};i.r(u),i.d(u,{ms:()=>wd});var c={};i.r(c),i.d(c,{add:()=>Ad,db:()=>kd,get:()=>Pd,log:()=>_d});var h={};i.r(h),i.d(h,{prepend_timestamp_as_bytes:()=>Id,timestampToByteArray:()=>Td});var d={};i.r(d),i.d(d,{bytes:()=>h,debug:()=>c,dsp:()=>l,is_browser:()=>Ed,is_json_string:()=>Od,is_node:()=>xd,performance:()=>u,unix_timestamp_ms:()=>Cd});var p={};i.r(p),i.d(p,{status:()=>Nd,wait:()=>Rd,wait_until:()=>Dd});var f={};i.r(f),i.d(f,{ai_cds:()=>Vd,ask_ai:()=>Md,clean_json_string:()=>Ld,example_patient:()=>$d,generate_patient_data:()=>zd,generate_prompt:()=>Fd});var m={};i.r(m),i.d(m,{code:()=>Bd});var g={};i.r(g),i.d(g,{build_index:()=>Xd,get_medications:()=>Kd,index:()=>qd,init:()=>Wd,medications:()=>Gd,parse_ar_text:()=>tp,parse_subsection_1:()=>Yd,parse_subsection_2:()=>ep,raw_medications:()=>Hd,search_for_medication:()=>Jd,search_for_side_effect:()=>Zd});var y={};i.r(y),i.d(y,{JsonPatchError:()=>K_,_areEquals:()=>rk,applyOperation:()=>X_,applyPatch:()=>Y_,applyReducer:()=>ek,deepClone:()=>W_,getValueByPointer:()=>Q_,validate:()=>nk,validator:()=>tk});var v={};i.r(v),i.d(v,{get_chat_model:()=>KA});var b={};i.r(b),i.d(b,{clean_json_string:()=>eP,generate_loinc:()=>YA,generate_random_fhir_patient:()=>QA,generic_completion_json:()=>ZA,get_fhir_data:()=>XA,get_openai:()=>JA});var w={};i.r(w),i.d(w,{call_structured_completion:()=>CP,generic_completion_json_structured:()=>SP,get_embedding:()=>NP,get_openai:()=>xP,test_1:()=>OP});var _={};i.r(_),i.d(_,{empty_prompt:()=>jP});var k={};i.r(k),i.d(k,{evaluation:()=>HP,evaluation_without_supplementary_data:()=>GP,extraction:()=>FP,medication_evaluation_prompt:()=>VP,medication_evaluation_prompt_without_supplementary_data:()=>zP,medication_evaluation_response_format:()=>UP,medication_extraction_prompt:()=>LP,medication_extraction_response_format:()=>$P,patient_information_placeholder:()=>DP,supplementary_information_placeholder:()=>RP});var A={};i.r(A),i.d(A,{general:()=>_,medications:()=>k});var P={};i.r(P),i.d(P,{empty_data:()=>qP});var T={};i.r(T),i.d(T,{hp:()=>JP,info:()=>WP,name:()=>KP});var I={};i.r(I),i.d(I,{copd_vap:()=>ZP,hp:()=>XP,info:()=>QP});var E={};i.r(E),i.d(E,{copd_vap:()=>I,esrd_hyperkalemia_losartan:()=>T});var x={};i.r(x),i.d(x,{ap:()=>P,hp:()=>E});var C={};i.r(C),i.d(C,{BaseEngine:()=>tT,base_llm_args:()=>eT});var O={};i.r(O),i.d(O,{MedicationEngine:()=>oT});var S={};i.r(S),i.d(S,{base_engine:()=>C,medications:()=>O});var N={};i.r(N),i.d(N,{init:()=>uT,main:()=>cT});var j={};i.r(j),i.d(j,{engines:()=>S,init:()=>dT,prompting:()=>A,tamie:()=>N,test_data:()=>x});var D={};i.r(D),i.d(D,{get_sentences:()=>AM,nlp:()=>_M,parse:()=>kM});var L={};i.r(L),i.d(L,{buffer_to_hex:()=>EM,object_sha256:()=>xM,sha256:()=>IM,uuid_from_text:()=>CM});var M={};i.r(M),i.d(M,{embedding1024:()=>NM,prompt:()=>SM,structured_prompt:()=>jM});var $={};i.r($),i.d($,{BaseCache:()=>DM,CacheFactory:()=>RM,CacheUtils:()=>LM,MemoizationTests:()=>$M,MemoryCache:()=>MM});var F={};i.r(F),i.d(F,{OpenAI:()=>rv,aidx:()=>f,ailand:()=>M,amie:()=>j,cache:()=>$,cryptography:()=>L,data_generator:()=>b,langchain:()=>v,loinc:()=>m,medications:()=>g,oai:()=>w,tnlp:()=>D});var V={};i.r(V),i.d(V,{control_change:()=>zM,note_off:()=>VM,note_on:()=>FM});var z={};i.r(z),i.d(z,{copy_date:()=>JM,dates_eq:()=>WM,day_string:()=>ZM,iso_day_filename:()=>GM,iso_now:()=>UM,ms_now:()=>KM,round_date:()=>QM,shift_date:()=>XM,times_in_ms:()=>YM,to_iso:()=>BM,to_iso_day_filename:()=>HM,to_ms:()=>qM});var B={};i.r(B),i.d(B,{string_comparison:()=>c$});var U={};function H(e,t){var n;t=t||[];var r=(e=e||[]).length,i=t.length,a=[];for(n=0;n<r;)a[a.length]=e[n],n+=1;for(n=0;n<i;)a[a.length]=t[n],n+=1;return a}function G(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function q(e){return function t(n){return 0===arguments.length||G(n)?t:e.apply(this,arguments)}}function K(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,r){return t.apply(this,arguments)};case 4:return function(e,n,r,i){return t.apply(this,arguments)};case 5:return function(e,n,r,i,a){return t.apply(this,arguments)};case 6:return function(e,n,r,i,a,s){return t.apply(this,arguments)};case 7:return function(e,n,r,i,a,s,o){return t.apply(this,arguments)};case 8:return function(e,n,r,i,a,s,o,l){return t.apply(this,arguments)};case 9:return function(e,n,r,i,a,s,o,l,u){return t.apply(this,arguments)};case 10:return function(e,n,r,i,a,s,o,l,u,c){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function W(e){return function t(n,r){switch(arguments.length){case 0:return t;case 1:return G(n)?t:q((function(t){return e(n,t)}));default:return G(n)&&G(r)?t:G(n)?q((function(t){return e(t,r)})):G(r)?q((function(t){return e(n,t)})):e(n,r)}}}function J(e,t,n){return function(){for(var r=[],i=0,a=e,s=0,o=!1;s<t.length||i<arguments.length;){var l;s<t.length&&(!G(t[s])||i>=arguments.length)?l=t[s]:(l=arguments[i],i+=1),r[s]=l,G(l)?o=!0:a-=1,s+=1}return!o&&a<=0?n.apply(this,r):K(Math.max(0,a),J(e,r,n))}}i.r(U),i.d(U,{cloud:()=>y$,cloud_tes_call:()=>m$,local_tes_call:()=>f$,localhost:()=>g$});const Z=W((function(e,t){return 1===e?q(t):K(e,J(e,[],t))}));var Q=q((function(e){return Z(e.length,(function(){var t=0,n=arguments[0],r=arguments[arguments.length-1],i=Array.prototype.slice.call(arguments,0);return i[0]=function(){var e=n.apply(this,H(arguments,[t,r]));return t+=1,e},e.apply(this,i)}))}));const X=Q;function Y(e,t,n){for(var r=0,i=n.length;r<i;)t=e(t,n[r]),r+=1;return t}const ee=Array.isArray||function(e){return null!=e&&e.length>=0&&"[object Array]"===Object.prototype.toString.call(e)};function te(e){return null!=e&&"function"==typeof e["@@transducer/step"]}function ne(e,t,n){return function(){if(0===arguments.length)return n();var r=arguments[arguments.length-1];if(!ee(r)){for(var i=0;i<e.length;){if("function"==typeof r[e[i]])return r[e[i]].apply(r,Array.prototype.slice.call(arguments,0,-1));i+=1}if(te(r))return t.apply(null,Array.prototype.slice.call(arguments,0,-1))(r)}return n.apply(this,arguments)}}function re(e,t){for(var n=0,r=t.length,i=Array(r);n<r;)i[n]=e(t[n]),n+=1;return i}const ie=function(){return this.xf["@@transducer/init"]()},ae=function(e){return this.xf["@@transducer/result"](e)};var se=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,this.f(t))},e}();const oe=function(e){return function(t){return new se(e,t)}};function le(e,t){return Object.prototype.hasOwnProperty.call(t,e)}var ue=Object.prototype.toString,ce=function(){return"[object Arguments]"===ue.call(arguments)?function(e){return"[object Arguments]"===ue.call(e)}:function(e){return le("callee",e)}}();const he=ce;var de=!{toString:null}.propertyIsEnumerable("toString"),pe=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],fe=function(){return arguments.propertyIsEnumerable("length")}(),me=function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1},ge="function"!=typeof Object.keys||fe?q((function(e){if(Object(e)!==e)return[];var t,n,r=[],i=fe&&he(e);for(t in e)!le(t,e)||i&&"length"===t||(r[r.length]=t);if(de)for(n=pe.length-1;n>=0;)le(t=pe[n],e)&&!me(r,t)&&(r[r.length]=t),n-=1;return r})):q((function(e){return Object(e)!==e?[]:Object.keys(e)}));const ye=ge;var ve=W(ne(["fantasy-land/map","map"],oe,(function(e,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return Z(t.length,(function(){return e.call(this,t.apply(this,arguments))}));case"[object Object]":return Y((function(n,r){return n[r]=e(t[r]),n}),{},ye(t));default:return re(e,t)}})));const be=ve;function we(e){var t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t||"[object GeneratorFunction]"===t||"[object AsyncGeneratorFunction]"===t}function _e(e){return"[object String]"===Object.prototype.toString.call(e)}function ke(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}function Ae(e,t,n){for(var r=0,i=n.length;r<i;){if(e(t,n[r]))return!0;r+=1}return!1}const Pe="function"==typeof Object.is?Object.is:function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},Te=q((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function Ie(e,t,n,r){var i=ke(e);function a(e,t){return Ee(e,t,n.slice(),r.slice())}return!Ae((function(e,t){return!Ae(a,t,e)}),ke(t),i)}function Ee(e,t,n,r){if(Pe(e,t))return!0;var i=Te(e);if(i!==Te(t))return!1;if("function"==typeof e["fantasy-land/equals"]||"function"==typeof t["fantasy-land/equals"])return"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t)&&"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e);if("function"==typeof e.equals||"function"==typeof t.equals)return"function"==typeof e.equals&&e.equals(t)&&"function"==typeof t.equals&&t.equals(e);switch(i){case"Arguments":case"Array":case"Object":if("function"==typeof e.constructor&&"Promise"===function(e){var t=String(e).match(/^function (\w*)/);return null==t?"":t[1]}(e.constructor))return e===t;break;case"Boolean":case"Number":case"String":if(typeof e!=typeof t||!Pe(e.valueOf(),t.valueOf()))return!1;break;case"Date":if(!Pe(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(e.source!==t.source||e.global!==t.global||e.ignoreCase!==t.ignoreCase||e.multiline!==t.multiline||e.sticky!==t.sticky||e.unicode!==t.unicode)return!1}for(var a=n.length-1;a>=0;){if(n[a]===e)return r[a]===t;a-=1}switch(i){case"Map":return e.size===t.size&&Ie(e.entries(),t.entries(),n.concat([e]),r.concat([t]));case"Set":return e.size===t.size&&Ie(e.values(),t.values(),n.concat([e]),r.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var s=ye(e);if(s.length!==ye(t).length)return!1;var o=n.concat([e]),l=r.concat([t]);for(a=s.length-1;a>=0;){var u=s[a];if(!le(u,t)||!Ee(t[u],e[u],o,l))return!1;a-=1}return!0}var xe=W((function(e,t){return Ee(e,t,[],[])}));const Ce=xe;function Oe(e,t,n){var r,i;if("function"==typeof e.indexOf)switch(typeof t){case"number":if(0===t){for(r=1/t;n<e.length;){if(0===(i=e[n])&&1/i===r)return n;n+=1}return-1}if(t!=t){for(;n<e.length;){if("number"==typeof(i=e[n])&&i!=i)return n;n+=1}return-1}return e.indexOf(t,n);case"string":case"boolean":case"function":case"undefined":return e.indexOf(t,n);case"object":if(null===t)return e.indexOf(t,n)}for(;n<e.length;){if(Ce(e[n],t))return n;n+=1}return-1}function Se(e,t){return Oe(t,e,0)>=0}function Ne(e){return'"'+e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0").replace(/"/g,'\\"')+'"'}var je=function(e){return(e<10?"0":"")+e},De="function"==typeof Date.prototype.toISOString?function(e){return e.toISOString()}:function(e){return e.getUTCFullYear()+"-"+je(e.getUTCMonth()+1)+"-"+je(e.getUTCDate())+"T"+je(e.getUTCHours())+":"+je(e.getUTCMinutes())+":"+je(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};const Re=De;function Le(e){return function(){return!e.apply(this,arguments)}}function Me(e,t){for(var n=0,r=t.length,i=[];n<r;)e(t[n])&&(i[i.length]=t[n]),n+=1;return i}function $e(e){return"[object Object]"===Object.prototype.toString.call(e)}var Fe=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){return this.f(t)?this.xf["@@transducer/step"](e,t):e},e}(),Ve=W(ne(["fantasy-land/filter","filter"],(function(e){return function(t){return new Fe(e,t)}}),(function(e,t){return $e(t)?Y((function(n,r){return e(t[r])&&(n[r]=t[r]),n}),{},ye(t)):Me(e,t)})));const ze=Ve,Be=W((function(e,t){return ze(Le(e),t)}));function Ue(e,t){var n=function(n){var r=t.concat([e]);return Se(n,r)?"<Circular>":Ue(n,r)},r=function(e,t){return re((function(t){return Ne(t)+": "+n(e[t])}),t.slice().sort())};switch(Object.prototype.toString.call(e)){case"[object Arguments]":return"(function() { return arguments; }("+re(n,e).join(", ")+"))";case"[object Array]":return"["+re(n,e).concat(r(e,Be((function(e){return/^\d+$/.test(e)}),ye(e)))).join(", ")+"]";case"[object Boolean]":return"object"==typeof e?"new Boolean("+n(e.valueOf())+")":e.toString();case"[object Date]":return"new Date("+(isNaN(e.valueOf())?n(NaN):Ne(Re(e)))+")";case"[object Map]":return"new Map("+n(Array.from(e))+")";case"[object Null]":return"null";case"[object Number]":return"object"==typeof e?"new Number("+n(e.valueOf())+")":1/e==-1/0?"-0":e.toString(10);case"[object Set]":return"new Set("+n(Array.from(e).sort())+")";case"[object String]":return"object"==typeof e?"new String("+n(e.valueOf())+")":Ne(e);case"[object Undefined]":return"undefined";default:if("function"==typeof e.toString){var i=e.toString();if("[object Object]"!==i)return i}return"{"+r(e,ye(e)).join(", ")+"}"}}const He=q((function(e){return Ue(e,[])}));var Ge=W((function(e,t){if(ee(e)){if(ee(t))return e.concat(t);throw new TypeError(He(t)+" is not an array")}if(_e(e)){if(_e(t))return e+t;throw new TypeError(He(t)+" is not a string")}if(null!=e&&we(e["fantasy-land/concat"]))return e["fantasy-land/concat"](t);if(null!=e&&we(e.concat))return e.concat(t);throw new TypeError(He(e)+' does not have a method named "concat" or "fantasy-land/concat"')}));const qe=Ge,Ke=Number.isInteger||function(e){return(0|e)===e};var We=W((function(e,t){var n=e<0?t.length+e:e;return _e(t)?t.charAt(n):t[n]}));const Je=We;var Ze=W((function(e,t){if(null!=t)return Ke(e)?Je(e,t):t[e]}));const Qe=Ze;function Xe(e){return function t(n,r,i){switch(arguments.length){case 0:return t;case 1:return G(n)?t:W((function(t,r){return e(n,t,r)}));case 2:return G(n)&&G(r)?t:G(n)?W((function(t,n){return e(t,r,n)})):G(r)?W((function(t,r){return e(n,t,r)})):q((function(t){return e(n,r,t)}));default:return G(n)&&G(r)&&G(i)?t:G(n)&&G(r)?W((function(t,n){return e(t,n,i)})):G(n)&&G(i)?W((function(t,n){return e(t,r,n)})):G(r)&&G(i)?W((function(t,r){return e(n,t,r)})):G(n)?q((function(t){return e(t,r,i)})):G(r)?q((function(t){return e(n,t,i)})):G(i)?q((function(t){return e(n,r,t)})):e(n,r,i)}}}var Ye=q((function(e){return!!ee(e)||!!e&&"object"==typeof e&&!_e(e)&&(0===e.length||e.length>0&&e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1))}));const et=Ye;var tt="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function nt(e,t,n){return function(r,i,a){if(et(a))return e(r,i,a);if(null==a)return i;if("function"==typeof a["fantasy-land/reduce"])return t(r,i,a,"fantasy-land/reduce");if(null!=a[tt])return n(r,i,a[tt]());if("function"==typeof a.next)return n(r,i,a);if("function"==typeof a.reduce)return t(r,i,a,"reduce");throw new TypeError("reduce: list must be array or iterable")}}function rt(e,t,n){for(var r=0,i=n.length;r<i;){if((t=e["@@transducer/step"](t,n[r]))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r+=1}return e["@@transducer/result"](t)}const it=W((function(e,t){return K(e.length,(function(){return e.apply(t,arguments)}))})),at=nt(rt,(function(e,t,n,r){return e["@@transducer/result"](n[r](it(e["@@transducer/step"],e),t))}),(function(e,t,n){for(var r=n.next();!r.done;){if((t=e["@@transducer/step"](t,r.value))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r=n.next()}return e["@@transducer/result"](t)}));var st=function(){function e(e){this.f=e}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(e){return e},e.prototype["@@transducer/step"]=function(e,t){return this.f(e,t)},e}();function ot(e){return new st(e)}var lt=Xe((function(e,t,n){return at("function"==typeof e?ot(e):e,t,n)}));const ut=lt,ct=ft({id:"log"});var ht={};function dt(e,t){ht[e]=!0,ct(`Suppressing ${e}, reason=${t||"none_given"}`)}function pt(e){ht[e]=!1,ct(`Unsuppressing ${e}`)}function ft(e){let{id:t}=e;return function(e){ht[t]||(null!=e?null!=e?"[object Object]"==e.toString()?(console.log(`[${t}]:: > `),console.log(e)):console.log(`[${t}]:: ${e}`):console.log(`[${t}]:: null`):console.log(`[${t}]:: undefined`))}}function mt(e,t){return`${gt[e]}${t}${gt.reset}`}var gt={red:"[31m",green:"[32m",reset:"[0m"};const yt=ft({id:"fp"}),vt=X(be);function bt(e,t){return vt(((t,n)=>e(n,t)),t)}function wt(e){return Rn(e)?$t(e):$n(e)?an(e):e}function _t(e){return Object.keys(e)}function kt(e){let t=_t(e),n=an(e);return vn(t)?[]:Yt(t,(e=>n[e]))}function At(e){let t=_t(e);return vn(t)?[]:Yt(t,(t=>e[t]))}function Pt(e,t){return Object.assign(an(e),t)}function Tt(e){return e.reduce(Pt,{})}function It(e,t){return e[t]}function Et(e,t,n){return e[t]=n,e}function xt(e,t,n){let r=an(e);return r[t]=n,r}function Ct(e){return function(t){return t[e]}}function Ot(e,t){return function(n){return Et(n,e,t)}}function St(e,t){return function(n){return Et(n,e,t)}}function Nt(e){return $n(e)&&mn(gn(_t(e)))}function jt(e,t,n){for(var r=e,i=0;i<t.length-1;i++)r=r[i];let a=Ut(t);return r[a]=n(r[a]),an(e)}function Dt(e){return xn(_t(e),At(e))}var Rt=Dt;function Lt(e,t){let n=Yt(At(e),t);return Sn(_t(e),n)}function Mt(e,t=[]){let n=ye(e),r=[];for(var i of n){let n=e[i];if($n(n))Mt(n,qe(t,[i])).map((e=>r.push(e)));else{let e=qe(t,[i]);r.push({value:n,path:e})}}return r}function $t(e){return JSON.parse(JSON.stringify(e))}function Ft(e){return e[0]}function Vt(e){return e[1]}function zt(e){return e[2]}function Bt(e){return e[3]}function Ut(e){return e[e.length-1]}function Ht(e,t){return e[t]}function Gt(e){return function(t){return Ht(t,e)}}function qt(e){return e.reduce(((e,t)=>e&&t))}function Kt(e){return!vn(e)&&e.reduce(((e,t)=>e||t))}function Wt(e){return!Kt(e)}function Jt(e){return!qt(e)}function Zt(e,t){let n=[];for(var r of Xt(t))n.push(wt(e));return n}function Qt(e){return e[Math.floor(Math.random()*e.length)]}function Xt(e,t=null){if(t){for(var n=Array(t-e).fill(0),r=0;r<n.length;r++)n[r]=r+e;return n}for(n=Array(e).fill(0),r=0;r<n.length;r++)n[r]=r;return n}function Yt(e,t){return e.map(t)}function en(e){return bt(((e,t)=>[e,t]),e)}function tn(e,t){return be(Qe(e))(t)}function nn(e,t,n,r){return ut(t,n,tn(e,r))}function rn(e){let t=[],n=e[0].length,r=e.length;for(var i=0;i<n;i++){for(var a=new Array,s=0;s<r;s++)a.push(e[s][i]);t.push(a)}return t}function an(e){return JSON.parse(JSON.stringify(e))}function sn(e,t){let n=an(e);return n.push(t),n}function on(e,t){return an(e).filter((e=>!(e==t)))}function ln(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,r){return(n[e]<r[e]?-1:n[e]>r[e]?1:0)*t}}function un(e,t){let n=Math.ceil(e.length/t),r=Array(n).fill(null).map((e=>new Array)),i=0;for(var a=0;a<e.length;a++)a%t==0&&0!=a&&(i+=1),r[i].push(e[a]);return r}function cn(e,t){let n=[];for(var[r,i]of en(e))n.push(t(r,i));return n}function hn(e,t){return e.concat(t)}function dn(e,t){return Yt(e,Ct(t))}function pn(e,t,n){return Yt(e,Ot(t,n))}function fn(e,t,n){return Yt(e,St(t,n))}function mn(e){return 0==e}function gn(e){return e.length}function yn(e){return Rn(e)&&mn(gn(e))}function vn(e){return Nn(e)||jn(e)||yn(e)||Fn(e)||Nt(e)}function bn(e){return!vn(e)}function wn(e,t){return e.filter(t)}function _n(e,t,n){return wn(e,(e=>n(It(e,t))))}function kn(e,t,n){return _n(e,t,(e=>e==n))}function An(e){return wn(e,bn)}function Pn(e){return Kt(Yt(e,Rn))}function Tn(e){return e.flat()}function In(e){return Pn(e)?In(Tn(e)):e}function En(e){return An(In(e))}function xn(e,t){let n=[];for(var r=0;r<e.length;r++)n.push([e[r],t[r]]);return n}var Cn=xn;function On(e){let t={};for(var[n,r]of e)t[n]=r;return t}function Sn(e,t){return On(Cn(e,t))}function Nn(e){return null==e}function jn(e){return null==e}function Dn(e){return!(Nn(e)||jn(e))}function Rn(e){return Dn(e)&&e.constructor==Array}function Ln(e){return Dn(e)&&e.constructor==String}function Mn(e){return Dn(e)&&e.constructor==Object}function $n(e){return Dn(e)&&Mn(e)&&!Rn(e)}function Fn(e){return""==e}function Vn(e,t,n){return e.substring(t,n)}function zn(e,t){return Vn(e,0,t)}function Bn(e,t){return e.join(t)}function Un(e){return function(t){return Bn(t,e)}}function Hn(e,t){return e.split(t)}function Gn(e,t){let n=$t(t),r=n.shift(),i=e;for(;r;)i=i.replace("{}",String(r)),r=n.shift();return i}function qn(e,t){return e+t}function Kn(e,t){return e-t}function Wn(e,t){return e*t}function Jn(e,t){return e/t}function Zn(e){return function(t){return t+e}}function Qn(e){return function(t){return t-e}}function Xn(e){return function(t){return t/e}}function Yn(e){return function(t){return t*e}}function er(e){let t=[];for(var n=1;n<e.length;n++)t.push(e[n]-e[n-1]);return t}function tr(e,t){return e==t}function nr(e,t){var n={attempt_ref:null};return r=>{n.attempt_ref&&clearTimeout(n.attempt_ref),n.attempt_ref=setTimeout((function(){t(r)}),e)}}function rr(e,t){let n={},r=[];return ye(e).map((i=>{try{n[i]=e[i](t)}catch(e){r.push(e),n[i]=null}})),r.length&&(yt("Error while applying function to dictionary"),yt(r),yt(n)),n}async function ir(e,t){let n={},r=[],i=ye(e).map((async i=>{try{n[i]=await e[i](t)}catch(e){r.push(e),n[i]=null}}));return await Promise.all(i),r.length&&(yt("Error while applying function to dictionary"),yt(r),yt(n)),n}const ar=function(){return!1},sr=function(){return!0},or={"@@functional/placeholder":!0};var lr=W((function(e,t){return Number(e)+Number(t)}));const ur=lr;var cr=q((function(e){return Z(e.length,(function(){var t=arguments[0],n=arguments[arguments.length-1],r=n.length-1,i=Array.prototype.slice.call(arguments,0);return i[0]=function(){var e=t.apply(this,H(arguments,[r,n]));return r-=1,e},e.apply(this,i)}))}));const hr=cr;var dr=Xe((function(e,t,n){var r=n.length;if(e>=r||e<-r)return n;var i=(r+e)%r,a=H(n);return a[i]=t(n[i]),a}));const pr=dr;function fr(e){return e&&e["@@transducer/reduced"]?e:{"@@transducer/value":e,"@@transducer/reduced":!0}}var mr=function(){function e(e,t){this.xf=t,this.f=e,this.all=!0}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=function(e){return this.all&&(e=this.xf["@@transducer/step"](e,!0)),this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)||(this.all=!1,e=fr(this.xf["@@transducer/step"](e,!1))),e},e}(),gr=W(ne(["all"],(function(e){return function(t){return new mr(e,t)}}),(function(e,t){for(var n=0;n<t.length;){if(!e(t[n]))return!1;n+=1}return!0})));const yr=gr;var vr=W((function(e,t){if(e===t)return t;function n(e,t){if(e>t!=t>e)return t>e?t:e}var r=n(e,t);if(void 0!==r)return r;var i=n(typeof e,typeof t);if(void 0!==i)return i===typeof e?e:t;var a=He(e),s=n(a,He(t));return void 0!==s&&s===a?e:t}));const br=vr;var wr=W((function(e,t){return be(Qe(e),t)}));const _r=wr;var kr=q((function(e){return Z(ut(br,0,_r("length",e)),(function(){for(var t=0,n=e.length;t<n;){if(!e[t].apply(this,arguments))return!1;t+=1}return!0}))}));const Ar=kr,Pr=q((function(e){return function(){return e}}));var Tr=W((function(e,t){return e&&t}));const Ir=Tr;var Er=function(){function e(e,t){this.xf=t,this.f=e,this.any=!1}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=function(e){return this.any||(e=this.xf["@@transducer/step"](e,!1)),this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)&&(this.any=!0,e=fr(this.xf["@@transducer/step"](e,!0))),e},e}(),xr=W(ne(["any"],(function(e){return function(t){return new Er(e,t)}}),(function(e,t){for(var n=0;n<t.length;){if(e(t[n]))return!0;n+=1}return!1})));const Cr=xr;var Or=q((function(e){return Z(ut(br,0,_r("length",e)),(function(){for(var t=0,n=e.length;t<n;){if(e[t].apply(this,arguments))return!0;t+=1}return!1}))}));const Sr=Or,Nr=nt(Y,(function(e,t,n,r){return n[r](e,t)}),(function(e,t,n){for(var r=n.next();!r.done;)t=e(t,r.value),r=n.next();return t}));var jr=W((function(e,t){return"function"==typeof t["fantasy-land/ap"]?t["fantasy-land/ap"](e):"function"==typeof e.ap?e.ap(t):"function"==typeof e?function(n){return e(n)(t(n))}:Nr((function(e,n){return H(e,be(n,t))}),[],e)}));const Dr=jr;var Rr=function(){function e(e,t){this.xf=t,this.pos=0,this.full=!1,this.acc=new Array(e)}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=function(e){return this.acc=null,this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.store(t),this.full?this.xf["@@transducer/step"](e,this.getCopy()):e},e.prototype.store=function(e){this.acc[this.pos]=e,this.pos+=1,this.pos===this.acc.length&&(this.pos=0,this.full=!0)},e.prototype.getCopy=function(){return H(Array.prototype.slice.call(this.acc,this.pos),Array.prototype.slice.call(this.acc,0,this.pos))},e}();const Lr=W(ne([],(function(e){return function(t){return new Rr(e,t)}}),(function(e,t){for(var n=0,r=t.length-(e-1),i=new Array(r>=0?r:0);n<r;)i[n]=Array.prototype.slice.call(t,n,n+e),n+=1;return i})));var Mr=W((function(e,t){return H(t,[e])}));const $r=Mr,Fr=W((function(e,t){return e.apply(this,t)}));var Vr=q((function(e){for(var t=ye(e),n=t.length,r=[],i=0;i<n;)r[i]=e[t[i]],i+=1;return r}));const zr=Vr;function Br(e,t){return ee(t)?t.map(e):ye(t).reduce((function(n,r){return n[r]=e(t[r]),n}),{})}var Ur=q((function e(t){return t=Br((function(t){return"function"==typeof t?t:e(t)}),t),Z(ut(br,0,_r("length",zr(t))),(function(){var e=arguments;return Br((function(t){return Fr(t,e)}),t)}))}));const Hr=Ur;var Gr=W((function(e,t){return t(e)}));const qr=Gr;var Kr=Xe((function(e,t,n){var r=e(t),i=e(n);return r<i?-1:r>i?1:0}));const Wr=Kr;function Jr(e,t,n){if(Ke(e)&&ee(n)){var r=[].concat(n);return r[e]=t,r}var i={};for(var a in n)i[a]=n[a];return i[e]=t,i}var Zr=q((function(e){return null==e}));const Qr=Zr;var Xr=Xe((function e(t,n,r){if(0===t.length)return n;var i=t[0];if(t.length>1){var a=!Qr(r)&&le(i,r)&&"object"==typeof r[i]?r[i]:Ke(t[1])?[]:{};n=e(Array.prototype.slice.call(t,1),n,a)}return Jr(i,n,r)}));const Yr=Xr;var ei=Xe((function(e,t,n){return Yr([e],t,n)}));const ti=ei;var ni=W((function(e,t){switch(e){case 0:return function(){return t.call(this)};case 1:return function(e){return t.call(this,e)};case 2:return function(e,n){return t.call(this,e,n)};case 3:return function(e,n,r){return t.call(this,e,n,r)};case 4:return function(e,n,r,i){return t.call(this,e,n,r,i)};case 5:return function(e,n,r,i,a){return t.call(this,e,n,r,i,a)};case 6:return function(e,n,r,i,a,s){return t.call(this,e,n,r,i,a,s)};case 7:return function(e,n,r,i,a,s,o){return t.call(this,e,n,r,i,a,s,o)};case 8:return function(e,n,r,i,a,s,o,l){return t.call(this,e,n,r,i,a,s,o,l)};case 9:return function(e,n,r,i,a,s,o,l,u){return t.call(this,e,n,r,i,a,s,o,l,u)};case 10:return function(e,n,r,i,a,s,o,l,u,c){return t.call(this,e,n,r,i,a,s,o,l,u,c)};default:throw new Error("First argument to nAry must be a non-negative integer no greater than ten")}}));const ri=ni,ii=q((function(e){return ri(2,e)})),ai=W((function(e,t){var n=Z(e,t);return Z(e,(function(){return Y(Dr,be(n,arguments[0]),Array.prototype.slice.call(arguments,1))}))})),si=q((function(e){return ai(e.length,e)}));var oi=W((function(e,t){return we(e)?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:si(Ir)(e,t)}));const li=oi,ui=q((function(e){return e.apply(this,Array.prototype.slice.call(arguments,1))}));function ci(e){return function t(n){for(var r,i,a,s=[],o=0,l=n.length;o<l;){if(et(n[o]))for(a=0,i=(r=e?t(n[o]):n[o]).length;a<i;)s[s.length]=r[a],a+=1;else s[s.length]=n[o];o+=1}return s}}var hi="@@transducer/init",di="@@transducer/step",pi="@@transducer/result",fi=function(){function e(e){this.xf=e}return e.prototype[hi]=ie,e.prototype[pi]=ae,e.prototype[di]=function(e,t){var n=this.xf[di](e,t);return n["@@transducer/reduced"]?function(e){return{"@@transducer/value":e,"@@transducer/reduced":!0}}(n):n},e}(),mi=function(){function e(e){this.xf=new fi(e)}return e.prototype[hi]=ie,e.prototype[pi]=ae,e.prototype[di]=function(e,t){return et(t)?at(this.xf,e,t):rt(this.xf,e,[t])},e}(),gi=W(ne(["fantasy-land/chain","chain"],(function(e){return function(t){return oe(e)(function(e){return new mi(e)}(t))}}),(function(e,t){return"function"==typeof t?function(n){return e(t(n))(n)}:ci(!1)(be(e,t))})));const yi=gi;var vi=Xe((function(e,t,n){if(e>t)throw new Error("min must not be greater than max in clamp(min, max, value)");return n<e?e:n>t?t:n}));const bi=vi;function wi(e){return new RegExp(e.source,e.flags?e.flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":"")+(e.dotAll?"s":""))}function _i(e,t,n){if(n||(n=new ki),function(e){var t=typeof e;return null==e||"object"!=t&&"function"!=t}(e))return e;var r=function(r){var i=n.get(e);if(i)return i;for(var a in n.set(e,r),e)Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=t?_i(e[a],!0,n):e[a]);return r};switch(Te(e)){case"Object":return r(Object.create(Object.getPrototypeOf(e)));case"Array":return r([]);case"Date":return new Date(e.valueOf());case"RegExp":return wi(e);case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return e.slice();default:return e}}var ki=function(){function e(){this.map={},this.length=0}return e.prototype.set=function(e,t){const n=this.hash(e);let r=this.map[n];r||(this.map[n]=r=[]),r.push([e,t]),this.length+=1},e.prototype.hash=function(e){let t=[];for(var n in e)t.push(Object.prototype.toString.call(e[n]));return t.join()},e.prototype.get=function(e){if(this.length<=180){for(const t in this.map){const n=this.map[t];for(let t=0;t<n.length;t+=1){const r=n[t];if(r[0]===e)return r[1]}}return}const t=this.hash(e),n=this.map[t];if(n)for(let t=0;t<n.length;t+=1){const r=n[t];if(r[0]===e)return r[1]}},e}(),Ai=q((function(e){return null!=e&&"function"==typeof e.clone?e.clone():_i(e,!0)}));const Pi=Ai;var Ti=W((function(e,t){var n=Nr((function(t,n){var r=e(n);return void 0===t[r]&&(t[r]=[]),t[r].push(n),t}),{},t),r=[];for(var i in n)r.push(n[i]);return r}));const Ii=Ti;var Ei=q((function(e){return function(t,n){return e(t,n)?-1:e(n,t)?1:0}}));const xi=Ei;var Ci=q((function(e){return!e}));const Oi=Ci,Si=si(Oi);function Ni(e,t){return function(){return t.call(this,e.apply(this,arguments))}}function ji(e,t){return function(){var n=arguments.length;if(0===n)return t();var r=arguments[n-1];return ee(r)||"function"!=typeof r[e]?t.apply(this,arguments):r[e].apply(r,Array.prototype.slice.call(arguments,0,n-1))}}var Di=Xe(ji("slice",(function(e,t,n){return Array.prototype.slice.call(n,e,t)})));const Ri=Di,Li=q(ji("tail",Ri(1,1/0)));function Mi(){if(0===arguments.length)throw new Error("pipe requires at least one argument");return K(arguments[0].length,ut(Ni,arguments[0],Li(arguments)))}var $i=q((function(e){return _e(e)?e.split("").reverse().join(""):Array.prototype.slice.call(e,0).reverse()}));const Fi=$i;function Vi(){if(0===arguments.length)throw new Error("compose requires at least one argument");return Mi.apply(this,Fi(arguments))}const zi=Je(0);function Bi(e){return e}const Ui=q(Bi);var Hi=W((function(e,t){if(t.length<=0)return Ui;var n=zi(t),r=Li(t);return K(n.length,(function(){return Nr((function(t,n){return e.call(this,n,t)}),n.apply(this,arguments),r)}))}));const Gi=Hi;var qi=W((function(e,t){return Gi.apply(this,[e,Fi(t)])}));const Ki=qi;var Wi=q((function(e){return K(ut(br,0,be((function(e){return e[0].length}),e)),(function(){for(var t=0;t<e.length;){if(e[t][0].apply(this,arguments))return e[t][1].apply(this,arguments);t+=1}}))}));const Ji=Wi,Zi=q((function(e){return Z(e.length,e)}));var Qi=W((function(e,t){if(e>10)throw new Error("Constructor with greater than ten arguments");return 0===e?function(){return new t}:Zi(ri(e,(function(n,r,i,a,s,o,l,u,c,h){switch(e){case 1:return new t(n);case 2:return new t(n,r);case 3:return new t(n,r,i);case 4:return new t(n,r,i,a);case 5:return new t(n,r,i,a,s);case 6:return new t(n,r,i,a,s,o);case 7:return new t(n,r,i,a,s,o,l);case 8:return new t(n,r,i,a,s,o,l,u);case 9:return new t(n,r,i,a,s,o,l,u,c);case 10:return new t(n,r,i,a,s,o,l,u,c,h)}})))}));const Xi=Qi,Yi=q((function(e){return Xi(e.length,e)}));var ea=W((function(e,t){return Z(ut(br,0,_r("length",t)),(function(){var n=arguments,r=this;return e.apply(r,re((function(e){return e.apply(r,n)}),t))}))}));const ta=ea;var na=Zi((function(e,t){return Nr((function(t,n){return e(n)?t+1:t}),0,t)}));const ra=na;var ia=function(){function e(e,t,n,r){this.valueFn=e,this.valueAcc=t,this.keyFn=n,this.xf=r,this.inputs={}}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=function(e){var t;for(t in this.inputs)if(le(t,this.inputs)&&(e=this.xf["@@transducer/step"](e,this.inputs[t]))["@@transducer/reduced"]){e=e["@@transducer/value"];break}return this.inputs=null,this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){var n=this.keyFn(t);return this.inputs[n]=this.inputs[n]||[n,_i(this.valueAcc,!1)],this.inputs[n][1]=this.valueFn(this.inputs[n][1],t),e},e}(),aa=J(4,[],ne([],(function(e,t,n){return function(r){return new ia(e,t,n,r)}}),(function(e,t,n,r){var i=ot((function(r,i){var a=n(i),s=e(le(a,r)?r[a]:_i(t,!1),i);return s&&s["@@transducer/reduced"]?fr(r):(r[a]=s,r)}));return at(i,{},r)})));const sa=aa,oa=sa((function(e,t){return e+1}),0),la=ur(-1);var ua=W((function(e,t){return null==t||t!=t?e:t}));const ca=ua;var ha=Xe((function(e,t,n){var r=e(t),i=e(n);return r>i?-1:r<i?1:0}));const da=ha;function pa(e,t,n){var r,i=typeof e;switch(i){case"string":case"number":return 0===e&&1/e==-1/0?!!n._items["-0"]||(t&&(n._items["-0"]=!0),!1):null!==n._nativeSet?t?(r=n._nativeSet.size,n._nativeSet.add(e),n._nativeSet.size===r):n._nativeSet.has(e):i in n._items?e in n._items[i]||(t&&(n._items[i][e]=!0),!1):(t&&(n._items[i]={},n._items[i][e]=!0),!1);case"boolean":if(i in n._items){var a=e?1:0;return!!n._items[i][a]||(t&&(n._items[i][a]=!0),!1)}return t&&(n._items[i]=e?[!1,!0]:[!0,!1]),!1;case"function":return null!==n._nativeSet?t?(r=n._nativeSet.size,n._nativeSet.add(e),n._nativeSet.size===r):n._nativeSet.has(e):i in n._items?!!Se(e,n._items[i])||(t&&n._items[i].push(e),!1):(t&&(n._items[i]=[e]),!1);case"undefined":return!!n._items[i]||(t&&(n._items[i]=!0),!1);case"object":if(null===e)return!!n._items.null||(t&&(n._items.null=!0),!1);default:return(i=Object.prototype.toString.call(e))in n._items?!!Se(e,n._items[i])||(t&&n._items[i].push(e),!1):(t&&(n._items[i]=[e]),!1)}}const fa=function(){function e(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}return e.prototype.add=function(e){return!pa(e,!0,this)},e.prototype.has=function(e){return pa(e,!1,this)},e}();var ma=W((function(e,t){for(var n=[],r=0,i=e.length,a=t.length,s=new fa,o=0;o<a;o+=1)s.add(t[o]);for(;r<i;)s.add(e[r])&&(n[n.length]=e[r]),r+=1;return n}));const ga=ma;var ya=Xe((function(e,t,n){for(var r=[],i=0,a=t.length;i<a;)Ae(e,t[i],n)||Ae(e,t[i],r)||r.push(t[i]),i+=1;return r}));const va=ya;var ba=Xe((function(e,t,n){var r=Array.prototype.slice.call(n,0);return r.splice(e,t),r}));const wa=ba;var _a=W((function e(t,n){if(null==n)return n;switch(t.length){case 0:return n;case 1:return function(e,t){if(null==t)return t;if(Ke(e)&&ee(t))return wa(e,1,t);var n={};for(var r in t)n[r]=t[r];return delete n[e],n}(t[0],n);default:var r=t[0],i=Array.prototype.slice.call(t,1);return null==n[r]?function(e,t){if(Ke(e)&&ee(t))return[].concat(t);var n={};for(var r in t)n[r]=t[r];return n}(r,n):ti(r,e(i,n[r]),n)}}));const ka=_a;var Aa=W((function(e,t){return ka([e],t)}));const Pa=Aa;var Ta=W((function(e,t){return e/t}));const Ia=Ta;var Ea=function(){function e(e,t){this.xf=t,this.n=e}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){return this.n>0?(this.n-=1,e):this.xf["@@transducer/step"](e,t)},e}(),xa=W(ne(["drop"],(function(e){return function(t){return new Ea(e,t)}}),(function(e,t){return Ri(Math.max(0,e),1/0,t)})));const Ca=xa;var Oa=function(){function e(e,t){this.xf=t,this.n=e,this.i=0}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){this.i+=1;var n=0===this.n?e:this.xf["@@transducer/step"](e,t);return this.n>=0&&this.i>=this.n?fr(n):n},e}(),Sa=W(ne(["take"],(function(e){return function(t){return new Oa(e,t)}}),(function(e,t){return Ri(0,e<0?1/0:e,t)})));const Na=Sa;var ja=function(){function e(e,t){if(e<=0)return t;this.xf=t,this.pos=0,this.full=!1,this.acc=new Array(e)}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=function(e){return this.acc=null,this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.full&&(e=this.xf["@@transducer/step"](e,this.acc[this.pos])),this.store(t),e},e.prototype.store=function(e){this.acc[this.pos]=e,this.pos+=1,this.pos===this.acc.length&&(this.pos=0,this.full=!0)},e}();const Da=W(ne([],(function(e){return function(t){return new ja(e,t)}}),(function(e,t){return Na(e<t.length?t.length-e:0,t)})));var Ra=function(){function e(e,t){this.f=e,this.retained=[],this.xf=t}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=function(e){return this.retained=null,this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)?this.retain(e,t):this.flush(e,t)},e.prototype.flush=function(e,t){return e=at(this.xf,e,this.retained),this.retained=[],this.xf["@@transducer/step"](e,t)},e.prototype.retain=function(e,t){return this.retained.push(t),e},e}();const La=W(ne([],(function(e){return function(t){return new Ra(e,t)}}),(function(e,t){for(var n=t.length-1;n>=0&&e(t[n]);)n-=1;return Ri(0,n+1,t)})));var Ma=function(){function e(e,t){this.xf=t,this.pred=e,this.lastValue=void 0,this.seenFirstValue=!1}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){var n=!1;return this.seenFirstValue?this.pred(this.lastValue,t)&&(n=!0):this.seenFirstValue=!0,this.lastValue=t,n?e:this.xf["@@transducer/step"](e,t)},e}();function $a(e){return function(t){return new Ma(e,t)}}const Fa=Je(-1);var Va=W(ne([],$a,(function(e,t){var n=[],r=1,i=t.length;if(0!==i)for(n[0]=t[0];r<i;)e(Fa(n),t[r])||(n[n.length]=t[r]),r+=1;return n})));const za=Va,Ba=q(ne([],(function(){return $a(Ce)}),za(Ce)));var Ua=Xe((function(e,t,n){return Ce(e(t),e(n))}));const Ha=Ua;var Ga=W((function(e,t){return ne([],(function(){return $a(Ha(e))}),za(Ha(e)))(t)}));const qa=Ga;var Ka=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){if(this.f){if(this.f(t))return e;this.f=null}return this.xf["@@transducer/step"](e,t)},e}(),Wa=W(ne(["dropWhile"],(function(e){return function(t){return new Ka(e,t)}}),(function(e,t){for(var n=0,r=t.length;n<r&&e(t[n]);)n+=1;return Ri(n,1/0,t)})));const Ja=Wa;var Za=W((function(e,t){return e||t}));const Qa=Za;var Xa=W((function(e,t){return we(e)?function(){return e.apply(this,arguments)||t.apply(this,arguments)}:si(Qa)(e,t)}));const Ya=Xa;var es=q((function(e){return null!=e&&"function"==typeof e["fantasy-land/empty"]?e["fantasy-land/empty"]():null!=e&&null!=e.constructor&&"function"==typeof e.constructor["fantasy-land/empty"]?e.constructor["fantasy-land/empty"]():null!=e&&"function"==typeof e.empty?e.empty():null!=e&&null!=e.constructor&&"function"==typeof e.constructor.empty?e.constructor.empty():ee(e)?[]:_e(e)?"":$e(e)?{}:he(e)?function(){return arguments}():function(e){var t=Object.prototype.toString.call(e);return"[object Uint8ClampedArray]"===t||"[object Int8Array]"===t||"[object Uint8Array]"===t||"[object Int16Array]"===t||"[object Uint16Array]"===t||"[object Int32Array]"===t||"[object Uint32Array]"===t||"[object Float32Array]"===t||"[object Float64Array]"===t||"[object BigInt64Array]"===t||"[object BigUint64Array]"===t}(e)?e.constructor.from(""):void 0}));const ts=es;var ns=W((function(e,t){return Ca(e>=0?t.length-e:0,t)}));const rs=ns;var is=W((function(e,t){return Ce(rs(e.length,t),e)}));const as=is;var ss=Xe((function(e,t,n){return Ce(t[e],n[e])}));const os=ss;var ls=W((function e(t,n){if(!$e(n)&&!ee(n))return n;var r,i,a,s=n instanceof Array?[]:{};for(i in n)a=typeof(r=t[i]),s[i]="function"===a?r(n[i]):r&&"object"===a?e(r,n[i]):n[i];return s}));const us=ls;var cs=function(){function e(e,t){this.xf=t,this.f=e,this.found=!1}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=function(e){return this.found||(e=this.xf["@@transducer/step"](e,void 0)),this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)&&(this.found=!0,e=fr(this.xf["@@transducer/step"](e,t))),e},e}(),hs=W(ne(["find"],(function(e){return function(t){return new cs(e,t)}}),(function(e,t){for(var n=0,r=t.length;n<r;){if(e(t[n]))return t[n];n+=1}})));const ds=hs;var ps=function(){function e(e,t){this.xf=t,this.f=e,this.idx=-1,this.found=!1}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=function(e){return this.found||(e=this.xf["@@transducer/step"](e,-1)),this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.idx+=1,this.f(t)&&(this.found=!0,e=fr(this.xf["@@transducer/step"](e,this.idx))),e},e}(),fs=W(ne([],(function(e){return function(t){return new ps(e,t)}}),(function(e,t){for(var n=0,r=t.length;n<r;){if(e(t[n]))return n;n+=1}return-1})));const ms=fs;var gs=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=function(e){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](e,this.last))},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)&&(this.last=t),e},e}(),ys=W(ne([],(function(e){return function(t){return new gs(e,t)}}),(function(e,t){for(var n=t.length-1;n>=0;){if(e(t[n]))return t[n];n-=1}})));const vs=ys;var bs=function(){function e(e,t){this.xf=t,this.f=e,this.idx=-1,this.lastIdx=-1}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=function(e){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](e,this.lastIdx))},e.prototype["@@transducer/step"]=function(e,t){return this.idx+=1,this.f(t)&&(this.lastIdx=this.idx),e},e}(),ws=W(ne([],(function(e){return function(t){return new bs(e,t)}}),(function(e,t){for(var n=t.length-1;n>=0;){if(e(t[n]))return n;n-=1}return-1})));const _s=ws,ks=q(ci(!0));var As=q((function(e){return Z(e.length,(function(t,n){var r=Array.prototype.slice.call(arguments,0);return r[0]=n,r[1]=t,e.apply(this,r)}))}));const Ps=As;var Ts=W(ji("forEach",(function(e,t){for(var n=t.length,r=0;r<n;)e(t[r]),r+=1;return t})));const Is=Ts;var Es=W((function(e,t){for(var n=ye(t),r=0;r<n.length;){var i=n[r];e(t[i],i,t),r+=1}return t}));const xs=Es;var Cs=q((function(e){for(var t={},n=0;n<e.length;)t[e[n][0]]=e[n][1],n+=1;return t}));const Os=Cs,Ss=W(ji("groupBy",sa((function(e,t){return e.push(t),e}),[])));var Ns=W((function(e,t){for(var n=[],r=0,i=t.length;r<i;){for(var a=r+1;a<i&&e(t[a-1],t[a]);)a+=1;n.push(t.slice(r,a)),r=a}return n}));const js=Ns;var Ds=W((function(e,t){return e>t}));const Rs=Ds;var Ls=W((function(e,t){return e>=t}));const Ms=Ls;var $s=W((function(e,t){if(0===e.length||Qr(t))return!1;for(var n=t,r=0;r<e.length;){if(Qr(n)||!le(e[r],n))return!1;n=n[e[r]],r+=1}return!0}));const Fs=$s;var Vs=W((function(e,t){return Fs([e],t)}));const zs=Vs;var Bs=W((function(e,t){return!Qr(t)&&e in t}));const Us=Bs;var Hs=function(e,t){switch(arguments.length){case 0:return Hs;case 1:return function t(n){return 0===arguments.length?t:Pe(e,n)};default:return Pe(e,t)}};const Gs=Hs,qs=Xe((function(e,t,n){return Z(Math.max(e.length,t.length,n.length),(function(){return e.apply(this,arguments)?t.apply(this,arguments):n.apply(this,arguments)}))})),Ks=ur(1),Ws=W(Se),Js=sa((function(e,t){return t}),null),Zs=W((function(e,t){return"function"!=typeof t.indexOf||ee(t)?Oe(t,e,0):t.indexOf(e)})),Qs=Ri(0,-1);var Xs=Xe((function(e,t,n){return Me((function(t){return Ae(e,t,n)}),t)}));const Ys=Xs;var eo=Xe((function(e,t,n){e=e<n.length&&e>=0?e:n.length;var r=Array.prototype.slice.call(n,0);return r.splice(e,0,t),r}));const to=eo;var no=Xe((function(e,t,n){return e=e<n.length&&e>=0?e:n.length,[].concat(Array.prototype.slice.call(n,0,e),t,Array.prototype.slice.call(n,e))}));const ro=no;var io=function(){function e(e,t){this.xf=t,this.f=e,this.set=new fa}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){return this.set.add(this.f(t))?this.xf["@@transducer/step"](e,t):e},e}(),ao=W(ne([],(function(e){return function(t){return new io(e,t)}}),(function(e,t){for(var n,r,i=new fa,a=[],s=0;s<t.length;)n=e(r=t[s]),i.add(n)&&a.push(r),s+=1;return a})));const so=ao,oo=so(Ui);var lo=W((function(e,t){for(var n=new fa,r=0;r<e.length;r+=1)n.add(e[r]);return oo(Me(n.has.bind(n),t))}));const uo=lo;var co=W(ji("intersperse",(function(e,t){for(var n=[],r=0,i=t.length;r<i;)r===i-1?n.push(t[r]):n.push(t[r],e),r+=1;return n})));const ho=co,po="function"==typeof Object.assign?Object.assign:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1,r=arguments.length;n<r;){var i=arguments[n];if(null!=i)for(var a in i)le(a,i)&&(t[a]=i[a]);n+=1}return t};var fo=W((function(e,t){var n={};return n[e]=t,n}));const mo=fo;var go={"@@transducer/init":Array,"@@transducer/step":function(e,t){return e.push(t),e},"@@transducer/result":Bi},yo={"@@transducer/init":String,"@@transducer/step":function(e,t){return e+t},"@@transducer/result":Bi},vo={"@@transducer/init":Object,"@@transducer/step":function(e,t){return po(e,et(t)?mo(t[0],t[1]):t)},"@@transducer/result":Bi},bo=Xe((function(e,t,n){var r=t(te(e)?e:function(e){if(te(e))return e;if(et(e))return go;if("string"==typeof e)return yo;if("object"==typeof e)return vo;throw new Error("Cannot create transformer for "+e)}(e));return at(r,r["@@transducer/init"](),n)}));const wo=bo;var _o=q((function(e){for(var t=ye(e),n=t.length,r=0,i={};r<n;){var a=t[r],s=e[a],o=le(s,i)?i[s]:i[s]=[];o[o.length]=a,r+=1}return i}));const ko=_o;var Ao=q((function(e){for(var t=ye(e),n=t.length,r=0,i={};r<n;){var a=t[r];i[e[a]]=a,r+=1}return i}));const Po=Ao,To=W((function(e,t){return Z(e+1,(function(){var n=arguments[e];if(null!=n&&we(n[t]))return n[t].apply(n,Array.prototype.slice.call(arguments,0,e));throw new TypeError(He(n)+' does not have a method named "'+t+'"')}))})),Io=W((function(e,t){return t instanceof e||null!=t&&(t.constructor===e||"Object"===e.name&&"object"==typeof t)}));var Eo=q((function(e){return null!=e&&Ce(e,ts(e))}));const xo=Eo;var Co=q((function(e){return!Qr(e)}));const Oo=Co,So=To(1,"join");var No=q((function(e){return ta((function(){return Array.prototype.slice.call(arguments,0)}),e)}));const jo=No;var Do=q((function(e){var t,n=[];for(t in e)n[n.length]=t;return n}));const Ro=Do,Lo=W((function(e,t){if("function"!=typeof t.lastIndexOf||ee(t)){for(var n=t.length-1;n>=0;){if(Ce(t[n],e))return n;n-=1}return-1}return t.lastIndexOf(e)}));function Mo(e){return"[object Number]"===Object.prototype.toString.call(e)}var $o=q((function(e){return null!=e&&Mo(e.length)?e.length:NaN}));const Fo=$o;var Vo=W((function(e,t){return function(n){return function(r){return be((function(e){return t(e,r)}),n(e(r)))}}}));const zo=Vo;var Bo=Xe((function(e,t,n){return pr(e,Pr(t),n)}));const Uo=Bo;var Ho=q((function(e){return zo(Je(e),Uo(e))}));const Go=Ho;var qo=W((function(e,t){return e.map((function(e){for(var n,r=t,i=0;i<e.length;){if(null==r)return;n=e[i],r=Ke(n)?Je(n,r):r[n],i+=1}return r}))}));const Ko=qo;var Wo=W((function(e,t){return Ko([e],t)[0]}));const Jo=Wo;var Zo=q((function(e){return zo(Jo(e),Yr(e))}));const Qo=Zo;var Xo=q((function(e){return zo(Qe(e),ti(e))}));const Yo=Xo;var el=W((function(e,t){return e<t}));const tl=el;var nl=W((function(e,t){return e<=t}));const rl=nl;var il=Xe((function(e,t,n){for(var r=0,i=n.length,a=[],s=[t];r<i;)s=e(s[0],n[r]),a[r]=s[1],r+=1;return[s[0],a]}));const al=il;var sl=Xe((function(e,t,n){for(var r=n.length-1,i=[],a=[t];r>=0;)a=e(a[0],n[r]),i[r]=a[1],r-=1;return[a[0],i]}));const ol=sl;var ll=W((function(e,t){return Y((function(n,r){return n[r]=e(t[r],r,t),n}),{},ye(t))}));const ul=ll;var cl=W((function(e,t){return t.match(e)||[]}));const hl=cl;var dl=W((function(e,t){return Ke(e)?!Ke(t)||t<1?NaN:(e%t+t)%t:NaN}));const pl=dl;var fl=Xe((function(e,t,n){var r=e(n);return br(e(t),r)===r?n:t}));const ml=fl,gl=ut(ur,0);var yl=q((function(e){return gl(e)/e.length}));const vl=yl;var bl=q((function(e){var t=e.length;if(0===t)return NaN;var n=2-t%2,r=(t-n)/2;return vl(Array.prototype.slice.call(e,0).sort((function(e,t){return e<t?-1:e>t?1:0})).slice(r,r+n))}));const wl=bl;var _l=W((function(e,t){var n={};return K(t.length,(function(){var r=e.apply(this,arguments);return le(r,n)||(n[r]=t.apply(this,arguments)),n[r]}))}));const kl=_l;var Al=q((function(e){return po.apply(null,[{}].concat(e))}));const Pl=Al;var Tl=Xe((function(e,t,n){var r,i={};for(r in n=n||{},t=t||{})le(r,t)&&(i[r]=le(r,n)?e(r,t[r],n[r]):t[r]);for(r in n)le(r,n)&&!le(r,i)&&(i[r]=n[r]);return i}));const Il=Tl;var El=Xe((function e(t,n,r){return Il((function(n,r,i){return $e(r)&&$e(i)?e(t,r,i):t(n,r,i)}),n,r)}));const xl=El,Cl=W((function(e,t){return xl((function(e,t,n){return t}),e,t)})),Ol=W((function(e,t){return xl((function(e,t,n){return n}),e,t)})),Sl=Xe((function(e,t,n){return xl((function(t,n,r){return e(n,r)}),t,n)}));var Nl=W((function(e,t){return po({},t,e)}));const jl=Nl;var Dl=W((function(e,t){return po({},e,t)}));const Rl=Dl;var Ll=Xe((function(e,t,n){return Il((function(t,n,r){return e(n,r)}),t,n)}));const Ml=Ll;var $l=W((function(e,t){if(e===t)return e;function n(e,t){if(e<t!=t<e)return t<e?t:e}var r=n(e,t);if(void 0!==r)return r;var i=n(typeof e,typeof t);if(void 0!==i)return i===typeof e?e:t;var a=He(e),s=n(a,He(t));return void 0!==s?s===a?e:t:e}));const Fl=$l;var Vl=Xe((function(e,t,n){var r=e(n);return Fl(e(t),r)===r?n:t}));const zl=Vl;var Bl=Xe((function e(t,n,r){if(!$e(r)&&!ee(r))return r;if(0===t.length)return n(r);var i=t[0];if(!le(i,r))return r;if(1===t.length)return function(e,t,n){if(Ke(e)&&ee(n)){var r=[].concat(n);return r[e]=t(r[e]),r}var i={};for(var a in n)i[a]=n[a];return i[e]=t(i[e]),i}(i,n,r);var a=e(Array.prototype.slice.call(t,1),n,r[i]);return a===r[i]?r:Jr(i,a,r)}));const Ul=Bl;var Hl=Xe((function(e,t,n){return Ul([e],t,n)}));const Gl=Hl;var ql=W((function(e,t){return e%t}));const Kl=ql;var Wl=Xe((function(e,t,n){var r=n.length,i=n.slice(),a=e<0?r+e:e,s=t<0?r+t:t,o=i.splice(a,1);return a<0||a>=n.length||s<0||s>=n.length?n:[].concat(i.slice(0,s)).concat(o).concat(i.slice(s,n.length))}));const Jl=Wl;var Zl=W((function(e,t){return e*t}));const Ql=Zl;var Xl=W(((e,t)=>n=>e.call(void 0,Ol(t,n))));const Yl=Xl;var eu=q((function(e){return-e}));const tu=eu,nu=W((function(e,t){return yr(Le(e),t)}));var ru=q((function(e){return Z(e<0?1:e+1,(function(){return Je(e,arguments)}))}));const iu=ru;var au=Xe((function(e,t,n){return e(t(n))}));const su=au,ou=W((function(e,t){return"function"==typeof e["fantasy-land/of"]?e["fantasy-land/of"](t):"function"==typeof e.of?e.of(t):[t]}));var lu=W((function(e,t){for(var n={},r={},i=0,a=e.length;i<a;)r[e[i]]=1,i+=1;for(var s in t)r.hasOwnProperty(s)||(n[s]=t[s]);return n}));const uu=lu;var cu=J(4,[],(function(e,t,n,r){return e(t(n),t(r))}));const hu=cu,du=q((function(e){var t,n=!1;return K(e.length,(function(){return n?t:(n=!0,t=e.apply(this,arguments))}))}));function pu(e,t){if(null==t||!we(t.then))throw new TypeError("`"+e+"` expected a Promise, received "+Ue(t,[]))}var fu=W((function(e,t){return pu("otherwise",t),t.then(null,e)}));const mu=fu;var gu=function(e){return{value:e,map:function(t){return gu(t(e))}}},yu=Xe((function(e,t,n){return e((function(e){return gu(t(e))}))(n).value}));const vu=yu,bu=W((function(e,t){return[e,t]}));function wu(e){return W((function(t,n){return K(Math.max(0,t.length-n.length),(function(){return t.apply(this,e(n,arguments))}))}))}const _u=wu(H),ku=wu(Ps(H)),Au=jo([ze,Be]);var Pu=Xe((function(e,t,n){return Ce(Jo(t,n),e)}));const Tu=Pu;var Iu=Xe((function(e,t,n){return ca(e,Jo(t,n))}));const Eu=Iu;var xu=Xe((function(e,t,n){return e(Jo(t,n))}));const Cu=xu;var Ou=W((function(e,t){for(var n={},r=0;r<e.length;)e[r]in t&&(n[e[r]]=t[e[r]]),r+=1;return n}));const Su=Ou;var Nu=W((function(e,t){for(var n={},r=0,i=e.length;r<i;){var a=e[r];n[a]=t[a],r+=1}return n}));const ju=Nu;var Du=W((function(e,t){var n={};for(var r in t)e(t[r],r,t)&&(n[r]=t[r]);return n}));const Ru=Du;var Lu=W((function(e,t){return H([e],t)}));const Mu=Lu,$u=ut(Ql,1),Fu=W((function(e,t){return Z(t.length,(function(){for(var n=[],r=0;r<t.length;)n.push(t[r].call(this,arguments[r])),r+=1;return e.apply(this,n.concat(Array.prototype.slice.call(arguments,t.length)))}))})),Vu=Fu(re,[ju,Ui]);function zu(e,t,n){return function(r){return t(n(e(r)))}}var Bu=function(){function e(e,t,n){this.xf=n,this.f=e,this.g=t}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,zu(this.f,this.g,t))},e}();const Uu=Xe(ne(["fantasy-land/promap","promap"],(function(e,t){return function(n){return new Bu(e,t,n)}}),zu));var Hu=Xe((function(e,t,n){return Ce(e,Qe(t,n))}));const Gu=Hu;var qu=Xe((function(e,t,n){return Io(e,Qe(t,n))}));const Ku=qu;var Wu=Xe((function(e,t,n){return ca(e,Qe(t,n))}));const Ju=Wu;var Zu=Xe((function(e,t,n){return e(Qe(t,n))}));const Qu=Zu;var Xu=W((function(e,t){return e.map((function(e){return Jo([e],t)}))}));const Yu=Xu;var ec=W((function(e,t){if(!Mo(e)||!Mo(t))throw new TypeError("Both arguments to range must be numbers");for(var n=[],r=e;r<t;)n.push(r),r+=1;return n}));const tc=ec;var nc=Xe((function(e,t,n){for(var r=n.length-1;r>=0;){if((t=e(n[r],t))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r-=1}return t}));const rc=nc;var ic=J(4,[],(function(e,t,n,r){var i=ot((function(n,r){return e(n,r)?t(n,r):fr(n)}));return at(i,n,r)}));const ac=ic,sc=q(fr);var oc=W((function(e,t){var n,r=Number(t),i=0;if(r<0||isNaN(r))throw new RangeError("n must be a non-negative number");for(n=[];i<r;)n.push(e(i)),i+=1;return n}));const lc=oc;var uc=W((function(e,t){return lc(Pr(e),t)}));const cc=uc;var hc=Xe((function(e,t,n){return n.replace(e,t)}));const dc=hc;var pc="@@transducer/init",fc="@@transducer/step",mc=function(){function e(e,t,n){this.xf=n,this.f=e,this.acc=t}return e.prototype[pc]=function(){return this.xf[fc](this.xf[pc](),this.acc)},e.prototype["@@transducer/result"]=ae,e.prototype[fc]=function(e,t){return e["@@transducer/reduced"]?e:(this.acc=this.f(this.acc,t),this.xf[fc](e,this.acc))},e}(),gc=Xe(ne([],Xe((function(e,t,n){return new mc(e,t,n)})),(function(e,t,n){for(var r=0,i=n.length,a=[t];r<i;)t=e(t,n[r]),a[r+1]=t,r+=1;return a})));const yc=gc;var vc=W((function(e,t){var n="function"==typeof e["fantasy-land/of"]?e["fantasy-land/of"]:"function"==typeof e.of?e.of:e,r={"fantasy-land/of":n};return"function"==typeof t["fantasy-land/traverse"]?t["fantasy-land/traverse"](r,Bi):"function"==typeof t.traverse?t.traverse(r,Bi):rc((function(e,t){return Dr(be(Mu,e),t)}),n([]),t)}));const bc=vc;var wc=Xe((function(e,t,n){return vu(e,Pr(t),n)}));const _c=wc;var kc=W((function(e,t){return Array.prototype.slice.call(t,0).sort(e)}));const Ac=kc;var Pc=W((function(e,t){return Array.prototype.slice.call(t,0).sort((function(t,n){var r=e(t),i=e(n);return r<i?-1:r>i?1:0}))}));const Tc=Pc;var Ic=W((function(e,t){return Array.prototype.slice.call(t,0).sort((function(t,n){for(var r=0,i=0;0===r&&i<e.length;)r=e[i](t,n),i+=1;return r}))}));const Ec=Ic,xc=To(1,"split");var Cc=W((function(e,t){return[Ri(0,e,t),Ri(e,Fo(t),t)]}));const Oc=Cc;var Sc=W((function(e,t){if(e<=0)throw new Error("First argument to splitEvery must be a positive integer");for(var n=[],r=0;r<t.length;)n.push(Ri(r,r+=e,t));return n}));const Nc=Sc;var jc=W((function(e,t){for(var n=0,r=t.length,i=[];n<r&&!e(t[n]);)i.push(t[n]),n+=1;return[i,Array.prototype.slice.call(t,n)]}));const Dc=jc;var Rc=J(2,[],(function(e,t){for(var n=[],r=[],i=0;i<t.length;i+=1)e(t[i])||r.push(t[i]),(i<t.length-1&&e(t[i+1])||i===t.length-1)&&r.length>0&&(n.push(r),r=[]);return n}));const Lc=Rc;var Mc=W((function(e,t){return Ce(Na(e.length,t),e)}));const $c=Mc;var Fc=W((function(e,t){return Number(e)-Number(t)}));const Vc=Fc;var zc=function(e,t,n){var r=n.length,i=n.slice(),a=e<0?r+e:e,s=t<0?r+t:t,o=Math.min(a,s),l=Math.max(a,s);return a<0||a>r||s<0||s>r||a===s?i:i=[].concat(i.slice(0,o)).concat([i[l]]).concat(i.slice(o+1,l)).concat([i[o]]).concat(i.slice(l+1,r))},Bc=Xe((function(e,t,n){return ee(n)?zc(e,t,n):_e(n)?function(e,t,n){var r=zc(e,t,n);return ee(r)?r.join(""):r}(e,t,n):function(e,t,n){var r=Pi(n),i=Object.getOwnPropertyNames(r);if(i.includes(e)&&i.includes(t)){var a=r[e];r[e]=r[t],r[t]=a}return r}(e,t,n)}));const Uc=Bc,Hc=W((function(e,t){return qe(ga(e,t),ga(t,e))})),Gc=Xe((function(e,t,n){return qe(va(e,t,n),va(e,n,t))})),qc=W((function(e,t){for(var n=t.length-1;n>=0&&e(t[n]);)n-=1;return Ri(n+1,1/0,t)}));var Kc=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){return this.f(t)?this.xf["@@transducer/step"](e,t):fr(e)},e}(),Wc=W(ne(["takeWhile"],(function(e){return function(t){return new Kc(e,t)}}),(function(e,t){for(var n=0,r=t.length;n<r&&e(t[n]);)n+=1;return Ri(0,n,t)})));const Jc=Wc;var Zc=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){return this.f(t),this.xf["@@transducer/step"](e,t)},e}(),Qc=W(ne([],(function(e){return function(t){return new Zc(e,t)}}),(function(e,t){return e(t),t})));const Xc=Qc;var Yc=W((function(e,t){if(!function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(e))throw new TypeError("‘test’ requires a value of type RegExp as its first argument; received "+He(e));return wi(e).test(t)}));const eh=Yc;var th=W((function(e,t){return pu("andThen",t),t.then(e)}));const nh=th,rh=To(0,"toLowerCase");var ih=q((function(e){var t=[];for(var n in e)le(n,e)&&(t[t.length]=[n,e[n]]);return t}));const ah=ih;var sh=q((function(e){var t=[];for(var n in e)t[t.length]=[n,e[n]];return t}));const oh=sh,lh=To(0,"toUpperCase");var uh=Z(4,(function(e,t,n,r){return at(e("function"==typeof t?ot(t):t),n,r)}));const ch=uh;var hh=q((function(e){for(var t=0,n=[];t<e.length;){for(var r=e[t],i=0;i<r.length;)void 0===n[i]&&(n[i]=[]),n[i].push(r[i]),i+=1;t+=1}return n}));const dh=hh;var ph=Xe((function(e,t,n){var r={"fantasy-land/of":"function"==typeof e["fantasy-land/of"]?e["fantasy-land/of"]:"function"==typeof e.of?e.of:e};return"function"==typeof n["fantasy-land/traverse"]?n["fantasy-land/traverse"](r,t):"function"==typeof n.traverse?n.traverse(r,t):bc(r,be(t,n))}));const fh=ph;var mh="\t\n\v\f\r                　\u2028\u2029\ufeff",gh=q("function"==typeof String.prototype.trim&&!mh.trim()&&"​".trim()?function(e){return e.trim()}:function(e){var t=new RegExp("^["+mh+"]["+mh+"]*"),n=new RegExp("["+mh+"]["+mh+"]*$");return e.replace(t,"").replace(n,"")});const yh=gh;var vh=W((function(e,t){return K(e.length,(function(){try{return e.apply(this,arguments)}catch(e){return t.apply(this,H([e],arguments))}}))}));const bh=vh,wh=q((function(e){return function(){return e(Array.prototype.slice.call(arguments,0))}})),_h=q((function(e){return ri(1,e)}));var kh=W((function(e,t){return Z(e,(function(){for(var n,r=1,i=t,a=0;r<=e&&"function"==typeof i;)n=r===e?arguments.length:a+i.length,i=i.apply(this,Array.prototype.slice.call(arguments,a,n)),r+=1,a=n;return i}))}));const Ah=kh;var Ph=W((function(e,t){for(var n=e(t),r=[];n&&n.length;)r[r.length]=n[0],n=e(n[1]);return r}));const Th=Ph,Ih=W(Vi(oo,H));var Eh=function(){function e(e,t){this.xf=t,this.pred=e,this.items=[]}return e.prototype["@@transducer/init"]=ie,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){return Ae(this.pred,t,this.items)?e:(this.items.push(t),this.xf["@@transducer/step"](e,t))},e}(),xh=W(ne([],(function(e){return function(t){return new Eh(e,t)}}),(function(e,t){for(var n,r=0,i=t.length,a=[];r<i;)Ae(e,n=t[r],a)||(a[a.length]=n),r+=1;return a})));const Ch=xh,Oh=Xe((function(e,t,n){return Ch(e,H(t,n))}));var Sh=Xe((function(e,t,n){return e(n)?n:t(n)}));const Nh=Sh,jh=yi(Bi);var Dh=Xe((function(e,t,n){for(var r=n;!e(r);)r=t(r);return r}));const Rh=Dh;var Lh=W((function(e,t){return e in t&&ee(t[e])?re((function(n){return Jr(e,n,t)}),t[e]):[t]}));const Mh=Lh;var $h=q((function(e){var t,n=[];for(t in e)n[n.length]=e[t];return n}));const Fh=$h;var Vh=function(e){return{value:e,"fantasy-land/map":function(){return this}}},zh=W((function(e,t){return e(Vh)(t).value}));const Bh=zh;var Uh=Xe((function(e,t,n){return e(n)?t(n):n}));const Hh=Uh;var Gh=W((function(e,t){for(var n in e)if(le(n,e)&&!e[n](t[n]))return!1;return!0}));const qh=Gh;var Kh=W((function(e,t){for(var n in e)if(le(n,e)&&e[n](t[n]))return!0;return!1}));const Wh=Kh,Jh=W((function(e,t){return qh(be(Ce,e),t)}));var Zh=W((function(e,t){for(var n=new fa,r=0;r<e.length;r+=1)n.add(e[r]);return Be(n.has.bind(n),t)}));const Qh=Zh;var Xh=W((function(e,t){return Boolean(!e^!t)}));const Yh=Xh;var ed=W((function(e,t){for(var n,r=0,i=e.length,a=t.length,s=[];r<i;){for(n=0;n<a;)s[s.length]=[e[r],t[n]],n+=1;r+=1}return s}));const td=ed;var nd=W((function(e,t){for(var n=[],r=0,i=Math.min(e.length,t.length);r<i;)n[r]=[e[r],t[r]],r+=1;return n}));const rd=nd;var id=W((function(e,t){for(var n=0,r=Math.min(e.length,t.length),i={};n<r;)i[e[n]]=t[n],n+=1;return i}));const ad=id;var sd=Xe((function(e,t,n){for(var r=[],i=0,a=Math.min(t.length,n.length);i<a;)r[i]=e(t[i],n[i]),i+=1;return r}));const od=sd,ld=q((function(e){return Z(e.length,(function(){var t=arguments;return function(){return e.apply(this,t)}}))}));var ud;!function(e){e[e.BUY=0]="BUY",e[e.SELL=1]="SELL"}(ud||(ud={}));class cd{constructor(e){this.Params=e,this.Logger=ft({id:e.logger_id}),this.last_balance_data={},this.log_mode="verbose",this.state={price_history:[],last_price:null,r:e.target_ratio},this.Params.alpha=this.Params.alpha||.01}log(e){this.Logger(e)}async balance_portfolio(){let{base_asset:e,quote_asset:t}=this.Params;"verbose"==this.log_mode&&this.log("Balancing...");let n=await this.get_balance_data(),{base_amt:r,quote_amt:i,base_price:a,portfolio_value:s,current_ratio:o,ratio_error:l,target_achieved:u,target_base_amt:c,base_delta:h,trade_type:d,base_market_amt:p}=n;if("verbose"==this.log_mode&&this.log(n),this.Params.adaptive&&this.state.last_price){let e=a-this.state.last_price,t=e=>Math.max(Math.min(1,e),0);this.state.r=t(this.state.r-this.Params.alpha*e),this.Params.target_ratio=this.state.r}if(this.state.last_price=a,this.state.price_history.push(a),u)return"verbose"==this.log_mode&&this.log("Target ratio already achieved. Returning"),{balanced:!1,balance_needed:!1,info:null};{"verbose"==this.log_mode&&(this.log("Target ratio NOT achieved. Continuing."),this.log(`Processing order to ${d} ${p} ${e}`));let t=await this.do_market_trade(d,p),{error:n,info:r}=t;return{balanced:!n,balance_needed:!0,info:r}}}async get_balance_data(){let{target_ratio:e,target_precision:t,quote_asset:n,base_asset:r}=this.Params,i=await this.get_base_balance(r),a=await this.get_quote_balance(n),s=await this.get_base_price(r,n),o=i*s+a,l=i*s/o,u=e-l,c=o*e/s,h=c-i,d={base_amt:i,quote_amt:a,base_price:s,portfolio_value:o,current_ratio:l,ratio_error:u,target_achieved:Math.abs(u)<t,target_ratio:e,target_precision:t,target_base_amt:c,base_delta:h,trade_type:h>=0?ud.BUY:ud.SELL,base_market_amt:Math.abs(h)};return this.last_balance_data=d,d}set_log_mode(e){"verbose"==this.log_mode&&(this.log(`Setting log mode to ${e}`),this.log_mode=e)}}class hd extends cd{constructor(e){super(e),this.data=e.data,this.current_index=-1,this.portfolio=Object.assign({},e.initial_portfolio),this.initial_portfolio=Object.assign({},e.initial_portfolio),this.rebalances=[],this.slippage=e.slippage,this.fee=e.fee,this.transactions_costs={fees:{base:0,quote:0},slippage:{base:0,quote:0}},this.balance_portfolio_series=[],this.hodl_portfolio_series=[],this.ratio_series=[]}async get_quote_balance(e){return this.portfolio.quote_balance}async get_base_balance(e){return this.portfolio.base_balance}async get_base_price(e,t){return this.data[this.current_index].p}async do_market_trade(e,t){let n=await this.get_base_price("",""),r=this.data[this.current_index];n!=r.p&&(this.log("Sanity check failed! - there is a problem with price indexing"),process.exit(1));let{p:i,t:a}=r;var s,o;switch(e){case ud.BUY:s=t*(1-this.fee),o=-t*i*(1+this.slippage),this.transactions_costs.fees.base+=t*this.fee,this.transactions_costs.slippage.quote+=t*i*this.slippage;break;case ud.SELL:s=-t,o=t*i*(1-this.fee)*(1-this.slippage),this.transactions_costs.fees.quote+=t*i*this.fee,this.transactions_costs.slippage.quote+=t*i*this.slippage}let l=this.portfolio.base_balance+=s,u=this.portfolio.quote_balance+=o;return this.portfolio={base_balance:l,quote_balance:u},this.rebalances.push({index:this.current_index,p:i,t:a,trade_type:e,base_amt:t,quote_amt:t*i,portfolio:this.get_portfolio_value_and_time(this.portfolio,i,a),hodl_portfolio:this.get_portfolio_value_and_time(this.initial_portfolio,i,a),cummulative_transactions_costs:{raw:Object.assign({},this.transactions_costs),values:this.get_transactions_costs_values(this.transactions_costs,i)}}),{error:!1,info:null}}symbol_generator(e,t){return"BACKTESTER"}async process_data(){this.current_index+=1,await this.balance_portfolio();let{p:e,t}=this.data[this.current_index];this.hodl_portfolio_series.push(this.get_portfolio_value_and_time(this.initial_portfolio,e,t)),this.balance_portfolio_series.push(this.get_portfolio_value_and_time(this.portfolio,e,t)),this.ratio_series.push(this.Params.target_ratio)}get_portfolio_value_and_time(e,t,n){let r=e.base_balance*t+e.quote_balance;return{base_balance:e.base_balance,quote_balance:e.quote_balance,value:r,p:t,t:n}}get_transactions_costs_values(e,t){let{fees:n,slippage:r}=e,i=n.base*t+n.quote,a=r.base*t+r.quote;return{fee_cost:i,slippage_cost:a,total:i+a}}async backtest(){this.log("Starting backtest...");let e=this.data.length;for(var t=0;t<e;t++)await this.process_data(),t%100==0&&this.log(`Progress = ${t}/${e}`);this.log("Done")}}function dd(e){return e.length}function pd(e){let t=0;for(var n=0;n<e.length;n++)t+=window.Math.pow(e[n],2);return Math.pow(t,.5)}function fd(e){let t=0;for(var n=0;n<e.length;n++)t+=e[n];return t}function md(e){let t=[];for(var n=0;n<e.length;n++)t[n]=Math.abs(e[n]);return t}function gd(e){return fd(e)/dd(e)}function yd(e){return gd(md(e))}function vd(e){return{max:Math.max.apply(null,e),min:Math.min.apply(null,e),mean:gd(e)}}function bd(e){const t=e.reduce(((e,t)=>e+t.length),0),n=new Float32Array(t);let r=0;return e.forEach((e=>{n.set(e,r),r+=e.length})),n}function wd(){return performance.now()}var _d=ft({id:"debug"}),kd={};function Ad(e,t){kd[e]=t,_d(`Added :${e}`)}function Pd(e){return kd[e]}function Td(e){let t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,BigInt(e),!1),new Uint8Array(t)}function Id(e){let t=Td(Date.now()),n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function Ed(){return"undefined"!=typeof window&&void 0!==window.document}function xd(){return"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node}function Cd(){return Number(new Date)}function Od(e){try{return JSON.parse(e),!0}catch(e){return!1}}let Sd=()=>performance.now();var Nd,jd;function Dd(e,t,n){var r=Sd();return n=n||200,new Promise(((i,a)=>{let s=setInterval((function(){let n=Sd();e()?(i(!1),clearInterval(s)):t&&n-r>=t&&(i(!0),clearInterval(s))}),n)}))}function Rd(e){return new Promise(((t,n)=>{setTimeout((function(){t(Nd.TIMEOUT)}),e)}))}function Ld(e){Ad("pre_clean",e);let t=e.split("\n").join("").replace(/  /g,"").replace(",}","}"),n=t.indexOf("{"),r=t.indexOf("[");var i;return i=n<0?r:r<0?n:Math.min(n,r),t=t.slice(i,t.length),_d(`extracting json starting at index ${i}=${t[i]}`),Ad("post_clean",t),_d(`Cleaned ${e} to \n\n\n ${t}`),t}async function Md(e,t){try{var n;n=Ed()?`${window.origin}/api/openai_davinci`:"https://www.tidyscripts.com/api/openai_davinci";let i=await b$(n,{prompt:e,max_tokens:t});Ad("api_response",i),_d("Logged the api repsonse"),_d("Cleaning json string");var r=Ld(i.text);return _d(`Got cleaned response: ${r}`),{error:!1,data:JSON.parse(r)}}catch(e){return Ad("api_error",e),_d("api_error experienced"),{error:!0,data:"api error"}}}(jd=Nd||(Nd={}))[jd.TIMEOUT=0]="TIMEOUT";const $d={demographics:{age:35,gender:"Male",ethnicity:"Caucasian",occupation:"Software Engineer"},symptoms:["Fever","Cough","Fatigue"],lab_values:[{lab:"Magnesium",value:1.5},{lab:"Calcium",value:9.2},{lab:"Potassium",value:4},{lab:"Sodium",value:138}],medical_history:["Asthma","Seasonal Allergies"],medications:[{medication:"Albuterol",dose:{value:"2 puffs",frequency:"as needed"}},{medication:"Fluticasone",dose:{value:"1 spray",frequency:"daily"}}],tests:[{test:"Chest X-ray",result:"Negative"}],physical_exam:["Mild wheezing on auscultation"]};function Fd(e){const{demographics:t,symptoms:n,lab_values:r,medical_history:i,medications:a,tests:s,physical_exam:o}=e;return`\n    Given the following patient information:\n    Demographics: ${JSON.stringify(t)}\n    Symptoms: ${JSON.stringify(n)}\n    Lab values: ${JSON.stringify(r)}\n    Medical history: ${JSON.stringify(i)}\n    Medications: ${JSON.stringify(a)}\n    Tests: ${JSON.stringify(s)}\n    Physical exam: ${JSON.stringify(o)}\n\n    Please generate a list of the most likely diagnoses, along with their likelihood and any potential further workup needed to confirm or exclude each diagnosis.\nThe returned value should be a stringified JSON object that is an Array of objects that each have  "diagnosis", "likelihood", "reasoning",  and "suggested_workup" fields. \n    The suggested_workup field should be an array of strings where each string is a single suggested workup, such as "echocardiogram" or "chest x-ray" or "Basic metabolic panel (BMP)".\n    The likelihood field should be a number from 0 to 1 that estimates the probability that this is the diagnosis.\nThe reasoning field provides reasoning for ONLY the diagnosis and NOT for the suggested workup. It should be a string of atleast 5 sentences that directly references the provided information and specific numbers that went into your decision making process, and the logic behind the decision. If you conclude a lab value is high or low please provide a reference range in your explanation.\n    The returned array should have atleast 10 elements that are ranked with the highest likelihood first. \n  `}async function Vd(e){let t=Fd(e);return await Md(t,2048)}async function zd(e){try{const t=`Given the medical one-liner "${e.one_liner}" and History and Physical "${e.hp}", generate a patient_data object which conforms\nto the following PatientData type definition in typescript:\n\ntype PatientData = {\n  demographics: {\n    age: number,\n    gender?: string,\n    ethnicity?: string,\n    occupation?: string\n  },\n  symptoms: string[],\n  lab_values: {\n    lab : string ,\n    value : any \n  }[],\n  medical_history: string[],\n  medications: {\n    medication : string,\n    dose : { value : string, frequency : string } \n  }[],\n  tests: {\n    test: string,\n    result: string\n  }[],\n  physical_exam: string[]\n}\n\nThe repsonse should be a json string. \nOnly include the optional fields in the response if that information is explicity present in the one_liner or hp\nDo not include any text in the response other than the json string itself \n\n\nEXAMPLE RESPONSE: \n\n{\n  "demographics": {\n    "age": 30,\n    "gender": "Female",\n    "occupation": "Software Engineer"\n  },\n  "symptoms": ["Fever", "Cough", "Fatigue"],\n  "lab_values": [\n    {\n      "lab": "Magnesium",\n      "value": 1.5\n    },\n    {\n      "lab": "Calcium",\n      "value": 9.2\n    },\n    {\n      "lab": "Potassium",\n      "value": 4.0\n    },\n    {\n      "lab": "Sodium",\n      "value": 138\n    }\n  ],\n  "medical_history": ["Asthma", "Seasonal Allergies"],\n  "medications": [\n    {\n      "medication": "Albuterol",\n      "dose": {\n        "value": "2 puffs",\n        "frequency": "as needed"\n      }\n    },\n    {\n      "medication": "Fluticasone",\n      "dose": {\n        "value": "1 spray",\n        "frequency": "daily"\n      }\n    }\n  ],\n  "tests": [\n    {\n      "test": "Chest X-ray",\n      "result": "Negative"\n    }\n  ],\n  "physical_exam": ["Mild wheezing on auscultation"]\n}\n`;return(await Md(t,2048)).data}catch(e){return _d("An error occurred"),Ad("generate_error",e),null}}var Bd="1111";const Ud=ft({id:"medications"});var Hd=[],Gd=[],qd=null;async function Kd(){return await Wd(),Gd}async function Wd(){Gd.length&&qd||(Ud("Downloading medications"),Hd=await b$("https://storage.googleapis.com/tidyscripts/medication_data.json",{}),Ud("Parsing medications"),(Gd=an(Hd)).map((function(e){try{e.adverse_reactions=tp(e.adverse_reactions),e.name=e.name.replace("-drug-information","")}catch(t){Ud("error parsing med:"),console.log(e),process.exit()}})),Ud("Building index"),qd=Xd(Gd),Ud("Done"))}function Jd(e){return Gd.filter((function(t){return t.name.match(e)}))}function Zd(e){let t=R.keys(qd).filter((t=>t.match(e)));return Object.fromEntries(t.map((e=>[e,qd[e]])))}function Qd(e,t){if(!e.adverse_reactions)return t;let n=Mt(e.adverse_reactions);for(var r of n){let{value:n,path:a}=r,s=a[0];for(var i of n)t[i]||(t[i]={}),t[i][s]||(t[i][s]=[]),t[i][s].push(e.name)}return t}function Xd(e){let t={};for(var n of e)t=Qd(n,t);return t}function Yd(e){let t=e.split("\n\n").filter((e=>e.length>1));var n={};return t.map((function(e){let t=e.split(":"),r=t[0].trim(),i=t.slice(1).join("").replace(/\([\s\S]*?\)/g,"").split(",").map((e=>e.toLowerCase().trim()));n[r]=i})),n}function ep(e){return e.replace(/\([\s\S]*?\)/g,"").split(",").map((e=>e.toLowerCase().trim()))}function tp(e){if(!e)return null;let t=new RegExp([">10%:","1% to 10%:","2% to 10%:","Frequency not defined:","Frequency not defined.\n\n","<1%, postmarketing, and/or case reports:","<2%, postmarketing, and/or case reports:","<2%:","<1%:","Postmarketing:","Postmarketing and/or case reports:","Case Reports:"].join("|"),"g"),n=e.match(t);if(!n)return null;let r=e.split(t);var i={};return bt((function(e,t){try{let n=r[e+1];"<1%, postmarketing, and/or case reports:"==t.trim()||"<2%, postmarketing, and/or case reports:"==t.trim()?i[t]=ep(n):i[t]=Yd(n)}catch(e){i[t]=!1}}),n),i}const np="RFC3986",rp={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},ip=(Object.prototype.hasOwnProperty,Array.isArray),ap=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),sp=1024;function op(e,t){if(ip(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const lp=Object.prototype.hasOwnProperty,up={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},cp=Array.isArray,hp=Array.prototype.push,dp=function(e,t){hp.apply(e,cp(t)?t:[t])},pp=Date.prototype.toISOString,fp={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,i)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let s="";for(let e=0;e<a.length;e+=sp){const t=a.length>=sp?a.slice(e,e+sp):a,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===i&&(40===r||41===r)?n[n.length]=t.charAt(e):r<128?n[n.length]=ap[r]:r<2048?n[n.length]=ap[192|r>>6]+ap[128|63&r]:r<55296||r>=57344?n[n.length]=ap[224|r>>12]+ap[128|r>>6&63]+ap[128|63&r]:(e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),n[n.length]=ap[240|r>>18]+ap[128|r>>12&63]+ap[128|r>>6&63]+ap[128|63&r])}s+=n.join("")}return s},encodeValuesOnly:!1,format:np,formatter:rp[np],indices:!1,serializeDate:e=>pp.call(e),skipNulls:!1,strictNullHandling:!1},mp={};function gp(e,t,n,r,i,a,s,o,l,u,c,h,d,p,f,m,g,y){let v=e,b=y,w=0,_=!1;for(;void 0!==(b=b.get(mp))&&!_;){const t=b.get(e);if(w+=1,void 0!==t){if(t===w)throw new RangeError("Cyclic object value");_=!0}void 0===b.get(mp)&&(w=0)}if("function"==typeof u?v=u(t,v):v instanceof Date?v=d?.(v):"comma"===n&&cp(v)&&(v=op(v,(function(e){return e instanceof Date?d?.(e):e}))),null===v){if(a)return l&&!m?l(t,fp.encoder,g,"key",p):t;v=""}if(function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==typeof e||"bigint"==typeof e}(v)||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(v)){if(l){const e=m?t:l(t,fp.encoder,g,"key",p);return[f?.(e)+"="+f?.(l(v,fp.encoder,g,"value",p))]}return[f?.(t)+"="+f?.(String(v))]}const k=[];if(void 0===v)return k;let A;if("comma"===n&&cp(v))m&&l&&(v=op(v,l)),A=[{value:v.length>0?v.join(",")||null:void 0}];else if(cp(u))A=u;else{const e=Object.keys(v);A=c?e.sort(c):e}const P=o?String(t).replace(/\./g,"%2E"):String(t),T=r&&cp(v)&&1===v.length?P+"[]":P;if(i&&cp(v)&&0===v.length)return T+"[]";for(let t=0;t<A.length;++t){const b=A[t],_="object"==typeof b&&void 0!==b.value?b.value:v[b];if(s&&null===_)continue;const P=h&&o?b.replace(/\./g,"%2E"):b,I=cp(v)?"function"==typeof n?n(T,P):T:T+(h?"."+P:"["+P+"]");y.set(e,w);const E=new WeakMap;E.set(mp,y),dp(k,gp(_,I,n,r,i,a,s,o,"comma"===n&&m&&cp(v)?null:l,u,c,h,d,p,f,m,g,E))}return k}const yp="4.104.0";let vp,bp,wp,_p,kp,Ap,Pp,Tp,Ip,Ep=!1,xp=null,Cp=null,Op=null,Sp=null;class Np{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}const jp=()=>{vp||function(e,t={auto:!1}){if(Ep)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(vp)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${vp}'\``);Ep=t.auto,vp=e.kind,bp=e.fetch,xp=e.Request,Cp=e.Response,Op=e.Headers,wp=e.FormData,Sp=e.Blob,_p=e.File,kp=e.ReadableStream,Ap=e.getMultipartRequestOptions,Pp=e.getDefaultAgent,Tp=e.fileFromPath,Ip=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,i,a;try{n=fetch,r=Request,i=Response,a=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:i,Headers:a,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new Np(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0})};jp();class Dp extends Error{}class Rp extends Dp{constructor(e,t,n,r){super(`${Rp.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"],this.error=t;const i=t;this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Mp({message:n,cause:Df(t)});const i=t?.error;return 400===e?new Fp(e,i,n,r):401===e?new Vp(e,i,n,r):403===e?new zp(e,i,n,r):404===e?new Bp(e,i,n,r):409===e?new Up(e,i,n,r):422===e?new Hp(e,i,n,r):429===e?new Gp(e,i,n,r):e>=500?new qp(e,i,n,r):new Rp(e,i,n,r)}}class Lp extends Rp{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Mp extends Rp{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class $p extends Mp{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Fp extends Rp{}class Vp extends Rp{}class zp extends Rp{}class Bp extends Rp{}class Up extends Rp{}class Hp extends Rp{}class Gp extends Rp{}class qp extends Rp{}class Kp extends Dp{constructor(){super("Could not parse response content as the length limit was reached")}}class Wp extends Dp{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var Jp,Zp=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},Qp=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Xp{constructor(){Jp.set(this,void 0),this.buffer=new Uint8Array,Zp(this,Jp,null,"f")}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?(new TextEncoder).encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const r=[];let i;for(;null!=(i=Yp(this.buffer,Qp(this,Jp,"f")));){if(i.carriage&&null==Qp(this,Jp,"f")){Zp(this,Jp,i.index,"f");continue}if(null!=Qp(this,Jp,"f")&&(i.index!==Qp(this,Jp,"f")+1||i.carriage)){r.push(this.decodeText(this.buffer.slice(0,Qp(this,Jp,"f")-1))),this.buffer=this.buffer.slice(Qp(this,Jp,"f")),Zp(this,Jp,null,"f");continue}const e=null!==Qp(this,Jp,"f")?i.preceding-1:i.preceding,t=this.decodeText(this.buffer.slice(0,e));r.push(t),this.buffer=this.buffer.slice(i.index),Zp(this,Jp,null,"f")}return r}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Dp(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Dp(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Dp("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function Yp(e,t){for(let n=t??0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function ef(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}function tf(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}Jp=new WeakMap,Xp.NEWLINE_CHARS=new Set(["\n","\r"]),Xp.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class nf{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;return new nf((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const n of async function*(e,t){if(!e.body)throw t.abort(),new Dp("Attempted to iterate over a response with no body");const n=new rf,r=new Xp,i=tf(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?(new TextEncoder).encode(n):n;let r,i=new Uint8Array(t.length+e.length);for(i.set(t),i.set(e,t.length),t=i;-1!==(r=ef(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(i))for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of r.flush()){const t=n.decode(e);t&&(yield t)}}(e,t))if(!r)if(n.data.startsWith("[DONE]"))r=!0;else if(null===n.event||n.event.startsWith("response.")||n.event.startsWith("transcript.")){let t;try{t=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(t&&t.error)throw new Rp(void 0,t.error,void 0,kf(e.headers));yield t}else{let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new Rp(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new nf((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*(){const t=new Xp,n=tf(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new nf((()=>r(e)),this.controller),new nf((()=>r(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new kp({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:i}=await t.next();if(i)return e.close();const a=n.encode(JSON.stringify(r)+"\n");e.enqueue(a)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}class rf{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(":");return-1!==n?[e.substring(0,n),":",e.substring(n+1)]:[e,"",""]}(e);return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}const af=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,sf=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&of(e),of=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function lf(e,t,n){if(e=await e,sf(e))return e;if(af(e)){const r=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=of(r)?[await r.arrayBuffer()]:[r];return new _p(i,t,n)}const r=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(of(e))t.push(await e.arrayBuffer());else{if(!cf(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){return`[${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const n of e)t.push(n)}return t}(e);if(t||(t=function(e){return uf(e.name)||uf(e.filename)||uf(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!n?.type){const e=r[0]?.type;"string"==typeof e&&(n={...n,type:e})}return new _p(r,t,n)}const uf=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,cf=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],hf=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],df=async e=>{const t=await pf(e.body);return Ap(t,e)},pf=async e=>{const t=new wp;return await Promise.all(Object.entries(e||{}).map((([e,n])=>ff(t,e,n)))),t},ff=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if((e=>sf(e)||af(e)||Ip(e))(n)){const r=await lf(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map((n=>ff(e,t+"[]",n))));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map((([n,r])=>ff(e,`${t}[${n}]`,r))))}}};var mf;async function gf(e){const{response:t}=e;if(e.options.stream)return Vf("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):nf.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type"),r=n?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){const e=await t.json();return Vf("response",t.status,t.url,t.headers,e),yf(e,t)}const i=await t.text();return Vf("response",t.status,t.url,t.headers,i),i}function yf(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}jp();class vf extends Promise{constructor(e,t=gf){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new vf(this.responsePromise,(async t=>yf(e(await this.parseResponse(t),t),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class bf{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:i}){this.baseURL=e,this.maxRetries=jf("maxRetries",t),this.timeout=jf("timeout",n),this.httpAgent=r,this.fetch=i??bp}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...xf(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${zf()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((async n=>{const r=n&&of(n?.body)?new DataView(await n.body.arrayBuffer()):n?.body instanceof DataView?n.body:n?.body instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n?.body)?new DataView(n.body.buffer):n?.body;return{method:e,path:t,...n,body:r}})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:i,query:a,headers:s={}}=n,o=ArrayBuffer.isView(n.body)||n.__binaryRequest&&"string"==typeof n.body?n.body:hf(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,l=this.calculateContentLength(o),u=this.buildURL(i,a);"timeout"in n&&jf("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const c=n.httpAgent??this.httpAgent??Pp(u),h=n.timeout+1e3;return"number"==typeof c?.options?.timeout&&h>(c.options.timeout??0)&&(c.options.timeout=h),this.idempotencyHeader&&"get"!==r&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey),{req:{method:r,...o&&{body:o},headers:this.buildHeaders({options:n,headers:s,contentLength:l,retryCount:t}),...c&&{agent:c},signal:n.signal??null},url:u,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const i={};n&&(i["content-length"]=n);const a=this.defaultHeaders(e);return $f(i,a),$f(i,t),hf(e.body)&&"node"!==vp&&delete i["content-type"],void 0===Bf(a,"x-stainless-retry-count")&&void 0===Bf(t,"x-stainless-retry-count")&&(i["x-stainless-retry-count"]=String(r)),void 0===Bf(a,"x-stainless-timeout")&&void 0===Bf(t,"x-stainless-timeout")&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,r){return Rp.generate(e,t,n,r)}request(e,t=null){return new vf(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);const{req:i,url:a,timeout:s}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(i,{url:a,options:n}),Vf("request",a,n,i.headers),n.signal?.aborted)throw new Lp;const o=new AbortController,l=await this.fetchWithTimeout(a,i,s,o).catch(Df);if(l instanceof Error){if(n.signal?.aborted)throw new Lp;if(t)return this.retryRequest(n,t);if("AbortError"===l.name)throw new $p;throw new Mp({cause:l})}const u=kf(l.headers);if(!l.ok){if(t&&this.shouldRetry(l))return Vf(`response (error; retrying, ${t} attempts remaining)`,l.status,a,u),this.retryRequest(n,t,u);const e=await l.text().catch((e=>Df(e).message)),r=Cf(e),i=r?void 0:e;throw Vf(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,u,i),this.makeStatusError(l.status,r,i,u)}return{response:l,options:n,controller:o}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new _f(this,n,e)}buildURL(e,t){const n=Sf(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return Lf(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new Dp(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",(()=>r.abort()));const s=setTimeout((()=>r.abort()),n),o={signal:r.signal,...a};return o.method&&(o.method=o.method.toUpperCase()),this.fetch.call(void 0,e,o).finally((()=>{clearTimeout(s)}))}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,n){let r;const i=n?.["retry-after-ms"];if(i){const e=parseFloat(i);Number.isNaN(e)||(r=e)}const a=n?.["retry-after"];if(a&&!r){const e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await Nf(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${yp}`}}class wf{constructor(e,t,n,r){mf.set(this,void 0),function(e,t,n,r,i){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");t.set(e,n)}(this,mf,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Dp("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await function(e,t,n,r){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}(this,mf).requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(mf=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class _f extends vf{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await gf(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const kf=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Af={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Pf=e=>"object"==typeof e&&null!==e&&!Lf(e)&&Object.keys(e).every((e=>Mf(Af,e))),Tf=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",If=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let Ef;const xf=()=>Ef??(Ef=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yp,"X-Stainless-OS":If(Deno.build.os),"X-Stainless-Arch":Tf(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yp,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yp,"X-Stainless-OS":If(process.platform),"X-Stainless-Arch":Tf(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yp,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yp,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),Cf=e=>{try{return JSON.parse(e)}catch(e){return}},Of=/^[a-z][a-z0-9+.-]*:/i,Sf=e=>Of.test(e),Nf=e=>new Promise((t=>setTimeout(t,e))),jf=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new Dp(`${e} must be an integer`);if(t<0)throw new Dp(`${e} must be a positive integer`);return t},Df=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},Rf=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function Lf(e){if(!e)return!0;for(const t in e)return!1;return!0}function Mf(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function $f(e,t){for(const n in t){if(!Mf(t,n))continue;const r=n.toLowerCase();if(!r)continue;const i=t[n];null===i?delete e[r]:void 0!==i&&(e[r]=i)}}const Ff=new Set(["authorization","api-key"]);function Vf(e,...t){if("undefined"!=typeof process&&"true"===process?.env?.DEBUG){const n=t.map((e=>{if(!e)return e;if(e.headers){const t={...e,headers:{...e.headers}};for(const n in e.headers)Ff.has(n.toLowerCase())&&(t.headers[n]="REDACTED");return t}let t=null;for(const n in e)Ff.has(n.toLowerCase())&&(t??(t={...e}),t[n]="REDACTED");return t??e}));console.log(`OpenAI:DEBUG:${e}`,...n)}}const zf=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),Bf=(e,t)=>{const n=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const r=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,((e,t,n)=>t+n.toUpperCase()));for(const i of[t,n,t.toUpperCase(),r]){const t=e.get(i);if(t)return t}}for(const[r,i]of Object.entries(e))if(r.toLowerCase()===n)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${t} header, using the first entry.`),i[0]):i};function Uf(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class Hf{constructor(e){this._client=e}}class Gf extends Hf{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class qf extends Hf{list(e,t={},n){return Pf(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Qf,{query:t,...n})}}class Kf extends wf{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Wf extends wf{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class Jf extends Hf{constructor(){super(...arguments),this.messages=new qf(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return Pf(e)?this.list({},e):this._client.getAPIList("/chat/completions",Zf,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}}class Zf extends Wf{}class Qf extends Wf{}Jf.ChatCompletionsPage=Zf,Jf.Messages=qf;class Xf extends Hf{constructor(){super(...arguments),this.completions=new Jf(this._client)}}Xf.Completions=Jf,Xf.ChatCompletionsPage=Zf;class Yf extends Hf{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&Vf("Request","User defined encoding_format:",e.encoding_format);const i=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?i:(Vf("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap((e=>(e&&e.data&&e.data.forEach((e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)})),e))))}}class em extends Hf{create(e,t){return this._client.post("/files",df({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Pf(e)?this.list({},e):this._client.getAPIList("/files",tm,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await Nf(t),a=await this.retrieve(e),Date.now()-i>n)throw new $p({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}}class tm extends Wf{}em.FileObjectsPage=tm;class nm extends Hf{createVariation(e,t){return this._client.post("/images/variations",df({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",df({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class rm extends Hf{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class im extends Hf{create(e,t){return this._client.post("/audio/transcriptions",df({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class am extends Hf{create(e,t){return this._client.post("/audio/translations",df({body:e,...t,__metadata:{model:e.model}}))}}class sm extends Hf{constructor(){super(...arguments),this.transcriptions=new im(this._client),this.translations=new am(this._client),this.speech=new rm(this._client)}}sm.Transcriptions=im,sm.Translations=am,sm.Speech=rm;class om extends Hf{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class lm extends Hf{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",um,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class um extends Kf{}lm.ModelsPage=um;class cm extends Hf{}class hm extends Hf{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class dm extends Hf{constructor(){super(...arguments),this.graders=new hm(this._client)}}dm.Graders=hm;class pm extends Hf{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,fm,{body:t,method:"post",...n})}retrieve(e,t={},n){return Pf(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}}class fm extends Kf{}pm.PermissionCreateResponsesPage=fm;class mm extends Hf{constructor(){super(...arguments),this.permissions=new pm(this._client)}}mm.Permissions=pm,mm.PermissionCreateResponsesPage=fm;class gm extends Hf{list(e,t={},n){return Pf(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ym,{query:t,...n})}}class ym extends Wf{}gm.FineTuningJobCheckpointsPage=ym;class vm extends Hf{constructor(){super(...arguments),this.checkpoints=new gm(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Pf(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",bm,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Pf(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,wm,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class bm extends Wf{}class wm extends Wf{}vm.FineTuningJobsPage=bm,vm.FineTuningJobEventsPage=wm,vm.Checkpoints=gm,vm.FineTuningJobCheckpointsPage=ym;class _m extends Hf{constructor(){super(...arguments),this.methods=new cm(this._client),this.jobs=new vm(this._client),this.checkpoints=new mm(this._client),this.alpha=new dm(this._client)}}_m.Methods=cm,_m.Jobs=vm,_m.FineTuningJobsPage=bm,_m.FineTuningJobEventsPage=wm,_m.Checkpoints=mm,_m.Alpha=dm;class km extends Hf{}class Am extends Hf{constructor(){super(...arguments),this.graderModels=new km(this._client)}}Am.GraderModels=km;class Pm extends Hf{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return Pf(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Tm,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...n,headers:r}).withResponse(),a=i.data;switch(a.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=i.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Nf(e);break;case"failed":case"completed":return a}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Im,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class Tm extends Wf{}class Im extends Kf{}Pm.VectorStoreFilesPage=Tm,Pm.FileContentResponsesPage=Im;class Em extends Hf{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return Pf(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Tm,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(i.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Nf(e);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=r?.maxConcurrency??5,a=Math.min(i,t.length),s=this._client,o=t.values(),l=[...n],u=Array(a).fill(o).map((async function(e){for(let t of e){const e=await s.files.create({file:t,purpose:"assistants"},r);l.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),n=t.filter((e=>"rejected"===e.status));if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const e of t)"fulfilled"===e.status&&r.push(e.value);return r})(u),await this.createAndPoll(e,{file_ids:l})}}class xm extends Hf{constructor(){super(...arguments),this.files=new Pm(this._client),this.fileBatches=new Em(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Pf(e)?this.list({},e):this._client.getAPIList("/vector_stores",Cm,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,Om,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class Cm extends Wf{}class Om extends Kf{}xm.VectorStoresPage=Cm,xm.VectorStoreSearchResponsesPage=Om,xm.Files=Pm,xm.VectorStoreFilesPage=Tm,xm.FileContentResponsesPage=Im,xm.FileBatches=Em;class Sm extends Hf{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Pf(e)?this.list({},e):this._client.getAPIList("/assistants",Nm,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Nm extends Wf{}function jm(e){return"function"==typeof e.parse}Sm.AssistantsPage=Nm;const Dm=e=>"assistant"===e?.role,Rm=e=>"function"===e?.role,Lm=e=>"tool"===e?.role;var Mm,$m,Fm,Vm,zm,Bm,Um,Hm,Gm,qm,Km,Wm,Jm,Zm=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},Qm=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Xm{constructor(){Mm.add(this),this.controller=new AbortController,$m.set(this,void 0),Fm.set(this,(()=>{})),Vm.set(this,(()=>{})),zm.set(this,void 0),Bm.set(this,(()=>{})),Um.set(this,(()=>{})),Hm.set(this,{}),Gm.set(this,!1),qm.set(this,!1),Km.set(this,!1),Wm.set(this,!1),Zm(this,$m,new Promise(((e,t)=>{Zm(this,Fm,e,"f"),Zm(this,Vm,t,"f")})),"f"),Zm(this,zm,new Promise(((e,t)=>{Zm(this,Bm,e,"f"),Zm(this,Um,t,"f")})),"f"),Qm(this,$m,"f").catch((()=>{})),Qm(this,zm,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),Qm(this,Mm,"m",Jm).bind(this))}),0)}_connected(){this.ended||(Qm(this,Fm,"f").call(this),this._emit("connect"))}get ended(){return Qm(this,Gm,"f")}get errored(){return Qm(this,qm,"f")}get aborted(){return Qm(this,Km,"f")}abort(){this.controller.abort()}on(e,t){return(Qm(this,Hm,"f")[e]||(Qm(this,Hm,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=Qm(this,Hm,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(Qm(this,Hm,"f")[e]||(Qm(this,Hm,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{Zm(this,Wm,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){Zm(this,Wm,!0,"f"),await Qm(this,zm,"f")}_emit(e,...t){if(Qm(this,Gm,"f"))return;"end"===e&&(Zm(this,Gm,!0,"f"),Qm(this,Bm,"f").call(this));const n=Qm(this,Hm,"f")[e];if(n&&(Qm(this,Hm,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return Qm(this,Wm,"f")||n?.length||Promise.reject(e),Qm(this,Vm,"f").call(this,e),Qm(this,Um,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];Qm(this,Wm,"f")||n?.length||Promise.reject(e),Qm(this,Vm,"f").call(this,e),Qm(this,Um,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function Ym(e){return"auto-parseable-response-format"===e?.$brand}function eg(e){return"auto-parseable-tool"===e?.$brand}function tg(e,t){const n=e.choices.map((e=>{if("length"===e.finish_reason)throw new Kp;if("content_filter"===e.finish_reason)throw new Wp;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map((e=>function(e,t){const n=e.tools?.find((e=>e.function?.name===t.function.name));return{...t,function:{...t.function,parsed_arguments:eg(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e)))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?ng(t,e.message.content):null}}}));return{...e,choices:n}}function ng(e,t){return"json_schema"!==e.response_format?.type?null:"json_schema"===e.response_format?.type?"$parseRaw"in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function rg(e,t){if(!e)return!1;const n=e.tools?.find((e=>e.function?.name===t.function.name));return eg(n)||n?.function.strict||!1}function ig(e){return!!Ym(e.response_format)||(e.tools?.some((e=>eg(e)||"function"===e.type&&!0===e.function.strict))??!1)}$m=new WeakMap,Fm=new WeakMap,Vm=new WeakMap,zm=new WeakMap,Bm=new WeakMap,Um=new WeakMap,Hm=new WeakMap,Gm=new WeakMap,qm=new WeakMap,Km=new WeakMap,Wm=new WeakMap,Mm=new WeakSet,Jm=function(e){if(Zm(this,qm,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new Lp),e instanceof Lp)return Zm(this,Km,!0,"f"),this._emit("abort",e);if(e instanceof Dp)return this._emit("error",e);if(e instanceof Error){const t=new Dp(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Dp(String(e)))};var ag,sg,og,lg,ug,cg,hg,dg,pg=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const fg=10;class mg extends Xm{constructor(){super(...arguments),ag.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(Rm(e)||Lm(e))&&e.content)this._emit("functionCallResult",e.content);else if(Dm(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Dm(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Dp("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),pg(this,ag,"m",sg).call(this)}async finalMessage(){return await this.done(),pg(this,ag,"m",og).call(this)}async finalFunctionCall(){return await this.done(),pg(this,ag,"m",lg).call(this)}async finalFunctionCallResult(){return await this.done(),pg(this,ag,"m",ug).call(this)}async totalUsage(){return await this.done(),pg(this,ag,"m",cg).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=pg(this,ag,"m",og).call(this);t&&this._emit("finalMessage",t);const n=pg(this,ag,"m",sg).call(this);n&&this._emit("finalContent",n);const r=pg(this,ag,"m",lg).call(this);r&&this._emit("finalFunctionCall",r);const i=pg(this,ag,"m",ug).call(this);null!=i&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",pg(this,ag,"m",cg).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),pg(this,ag,"m",hg).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(tg(i,t))}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const r="function",{function_call:i="auto",stream:a,...s}=t,o="string"!=typeof i&&i?.name,{maxChatCompletions:l=fg}=n||{},u={};for(const e of t.functions)u[e.name||e.function.name]=e;const c=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...s,function_call:i,functions:c,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new Dp("missing message in ChatCompletion response");if(!a.function_call)return;const{name:l,arguments:h}=a.function_call,d=u[l];if(!d){const e=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${c.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:r,name:l,content:e});continue}if(o&&o!==l){const e=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,name:l,content:e});continue}let p;try{p=jm(d)?await d.parse(h):h}catch(e){this._addMessage({role:r,name:l,content:e instanceof Error?e.message:String(e)});continue}const f=await d.function(p,this),m=pg(this,ag,"m",dg).call(this,f);if(this._addMessage({role:r,name:l,content:m}),o)return}}async _runTools(e,t,n){const r="tool",{tool_choice:i="auto",stream:a,...s}=t,o="string"!=typeof i&&i?.function?.name,{maxChatCompletions:l=fg}=n||{},u=t.tools.map((e=>{if(eg(e)){if(!e.$callback)throw new Dp("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),c={};for(const e of u)"function"===e.type&&(c[e.function.name||e.function.function.name]=e.function);const h="tools"in t?u.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...s,tool_choice:i,tools:h,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new Dp("missing message in ChatCompletion response");if(!a.tool_calls?.length)return;for(const t of a.tool_calls){if("function"!==t.type)continue;const n=t.id,{name:i,arguments:a}=t.function,s=c[i];if(!s){const e=`Invalid tool_call: ${JSON.stringify(i)}. Available options are: ${Object.keys(c).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:n,content:e});continue}if(o&&o!==i){const e=`Invalid tool_call: ${JSON.stringify(i)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:n,content:e});continue}let l;try{l=jm(s)?await s.parse(a):a}catch(e){const t=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:n,content:t});continue}const u=await s.function(l,this),h=pg(this,ag,"m",dg).call(this,u);if(this._addMessage({role:r,tool_call_id:n,content:h}),o)return}}}}ag=new WeakSet,sg=function(){return pg(this,ag,"m",og).call(this).content??null},og=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Dm(t)){const{function_call:e,...n}=t,r={...n,content:t.content??null,refusal:t.refusal??null};return e&&(r.function_call=e),r}}throw new Dp("stream ended without producing a ChatCompletionMessage with role=assistant")},lg=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Dm(t)&&t?.function_call)return t.function_call;if(Dm(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},ug=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Rm(t)&&null!=t.content)return t.content;if(Lm(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},cg=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},hg=function(e){if(null!=e.n&&e.n>1)throw new Dp("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},dg=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class gg extends mg{static runFunctions(e,t,n){const r=new gg,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,i))),r}static runTools(e,t,n){const r=new gg,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,i))),r}_addMessage(e,t=!0){super._addMessage(e,t),Dm(e)&&e.content&&this._emit("content",e.content)}}class yg extends Error{}class vg extends Error{}const bg=e=>function(e,t=511){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return((e,t)=>{const n=e.length;let r=0;const i=e=>{throw new yg(`${e} at position ${r}`)},a=e=>{throw new vg(`${e} at position ${r}`)},s=()=>(h(),r>=n&&i("Unexpected end of input"),'"'===e[r]?o():"{"===e[r]?l():"["===e[r]?u():"null"===e.substring(r,r+4)||16&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||32&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||32&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||128&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||256&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||64&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):c()),o=()=>{const s=r;let o=!1;for(r++;r<n&&('"'!==e[r]||o&&"\\"===e[r-1]);)o="\\"===e[r]&&!o,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(s,++r-Number(o)))}catch(e){a(String(e))}else if(1&t)try{return JSON.parse(e.substring(s,r-Number(o))+'"')}catch(t){return JSON.parse(e.substring(s,e.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},l=()=>{r++,h();const a={};try{for(;"}"!==e[r];){if(h(),r>=n&&8&t)return a;const i=o();h(),r++;try{const e=s();Object.defineProperty(a,i,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(8&t)return a;throw e}h(),","===e[r]&&r++}}catch(e){if(8&t)return a;i("Expected '}' at end of object")}return r++,a},u=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(s()),h(),","===e[r]&&r++}catch(e){if(4&t)return n;i("Expected ']' at end of array")}return r++,n},c=()=>{if(0===r){"-"===e&&2&t&&i("Not sure what '-' is");try{return JSON.parse(e)}catch(n){if(2&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}a(String(n))}}const s=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||2&t||i("Unterminated number literal");try{return JSON.parse(e.substring(s,r))}catch(n){"-"===e.substring(s,r)&&2&t&&i("Not sure what '-' is");try{return JSON.parse(e.substring(s,e.lastIndexOf("e")))}catch(e){a(String(e))}}},h=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return s()})(e.trim(),t)}(e,509);var wg,_g,kg,Ag,Pg,Tg,Ig,Eg,xg,Cg,Og,Sg,Ng=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},jg=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Dg extends mg{constructor(e){super(),wg.add(this),_g.set(this,void 0),kg.set(this,void 0),Ag.set(this,void 0),Ng(this,_g,e,"f"),Ng(this,kg,[],"f")}get currentChatCompletionSnapshot(){return jg(this,Ag,"f")}static fromReadableStream(e){const t=new Dg(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const r=new Dg(t);return r._run((()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),jg(this,wg,"m",Pg).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of i)jg(this,wg,"m",Ig).call(this,e);if(i.controller.signal?.aborted)throw new Lp;return this._addChatCompletion(jg(this,wg,"m",Cg).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),jg(this,wg,"m",Pg).call(this),this._connected();const r=nf.fromReadableStream(e,this.controller);let i;for await(const e of r)i&&i!==e.id&&this._addChatCompletion(jg(this,wg,"m",Cg).call(this)),jg(this,wg,"m",Ig).call(this,e),i=e.id;if(r.controller.signal?.aborted)throw new Lp;return this._addChatCompletion(jg(this,wg,"m",Cg).call(this))}[(_g=new WeakMap,kg=new WeakMap,Ag=new WeakMap,wg=new WeakSet,Pg=function(){this.ended||Ng(this,Ag,void 0,"f")},Tg=function(e){let t=jg(this,kg,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},jg(this,kg,"f")[e.index]=t,t)},Ig=function(e){if(this.ended)return;const t=jg(this,wg,"m",Sg).call(this,e);this._emit("chunk",e,t);for(const n of e.choices){const e=t.choices[n.index];null!=n.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),null!=n.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=n.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const r=jg(this,wg,"m",Tg).call(this,e);e.finish_reason&&(jg(this,wg,"m",xg).call(this,e),null!=r.current_tool_call_index&&jg(this,wg,"m",Eg).call(this,e,r.current_tool_call_index));for(const t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(jg(this,wg,"m",xg).call(this,e),null!=r.current_tool_call_index&&jg(this,wg,"m",Eg).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(const t of n.delta.tool_calls??[]){const n=e.message.tool_calls?.[t.index];n?.type&&"function"===n?.type&&this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""})}}},Eg=function(e,t){if(jg(this,wg,"m",Tg).call(this,e).done_tool_calls.has(t))return;const n=e.message.tool_calls?.[t];if(!n)throw new Error("no tool call snapshot");if(!n.type)throw new Error("tool call snapshot missing `type`");if("function"===n.type){const e=jg(this,_g,"f")?.tools?.find((e=>"function"===e.type&&e.function.name===n.function.name));this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:eg(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},xg=function(e){const t=jg(this,wg,"m",Tg).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const n=jg(this,wg,"m",Og).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Cg=function(){if(this.ended)throw new Dp("stream has ended, this shouldn't happen");const e=jg(this,Ag,"f");if(!e)throw new Dp("request ended without sending any chunks");return Ng(this,Ag,void 0,"f"),Ng(this,kg,[],"f"),function(e,t){const{id:n,choices:r,created:i,model:a,system_fingerprint:s,...o}=e,l={...o,id:n,choices:r.map((({message:t,finish_reason:n,index:r,logprobs:i,...a})=>{if(!n)throw new Dp(`missing finish_reason for choice ${r}`);const{content:s=null,function_call:o,tool_calls:l,...u}=t,c=t.role;if(!c)throw new Dp(`missing role for choice ${r}`);if(o){const{arguments:e,name:l}=o;if(null==e)throw new Dp(`missing function_call.arguments for choice ${r}`);if(!l)throw new Dp(`missing function_call.name for choice ${r}`);return{...a,message:{content:s,function_call:{arguments:e,name:l},role:c,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}return l?{...a,index:r,finish_reason:n,logprobs:i,message:{...u,role:c,content:s,refusal:t.refusal??null,tool_calls:l.map(((t,n)=>{const{function:i,type:a,id:s,...o}=t,{arguments:l,name:u,...c}=i||{};if(null==s)throw new Dp(`missing choices[${r}].tool_calls[${n}].id\n${Rg(e)}`);if(null==a)throw new Dp(`missing choices[${r}].tool_calls[${n}].type\n${Rg(e)}`);if(null==u)throw new Dp(`missing choices[${r}].tool_calls[${n}].function.name\n${Rg(e)}`);if(null==l)throw new Dp(`missing choices[${r}].tool_calls[${n}].function.arguments\n${Rg(e)}`);return{...o,id:s,type:a,function:{...c,name:u,arguments:l}}}))}}:{...a,message:{...u,content:s,role:c,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}})),created:i,model:a,object:"chat.completion",...s?{system_fingerprint:s}:{}};return function(e,t){return t&&ig(t)?tg(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}})))}}(l,t)}(e,jg(this,_g,"f"))},Og=function(){const e=jg(this,_g,"f")?.response_format;return Ym(e)?e:null},Sg=function(e){var t,n,r,i;let a=jg(this,Ag,"f");const{choices:s,...o}=e;a?Object.assign(a,o):a=Ng(this,Ag,{...o,choices:[]},"f");for(const{delta:s,finish_reason:o,index:l,logprobs:u=null,...c}of e.choices){let e=a.choices[l];if(e||(e=a.choices[l]={finish_reason:o,index:l,message:{},logprobs:u,...c}),u)if(e.logprobs){const{content:r,refusal:i,...a}=u;Object.assign(e.logprobs,a),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),i&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...i))}else e.logprobs=Object.assign({},u);if(o&&(e.finish_reason=o,jg(this,_g,"f")&&ig(jg(this,_g,"f")))){if("length"===o)throw new Kp;if("content_filter"===o)throw new Wp}if(Object.assign(e,c),!s)continue;const{content:h,refusal:d,function_call:p,role:f,tool_calls:m,...g}=s;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),h&&(e.message.content=(e.message.content||"")+h,!e.message.refusal&&jg(this,wg,"m",Og).call(this)&&(e.message.parsed=bg(e.message.content))),m){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:r,function:a,...s}of m){const o=(i=e.message.tool_calls)[t]??(i[t]={});Object.assign(o,s),n&&(o.id=n),r&&(o.type=r),a&&(o.function??(o.function={name:a.name??"",arguments:""})),a?.name&&(o.function.name=a.name),a?.arguments&&(o.function.arguments+=a.arguments,rg(jg(this,_g,"f"),o)&&(o.function.parsed_arguments=bg(o.function.arguments)))}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new nf(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Rg(e){return JSON.stringify(e)}class Lg extends Dg{static fromReadableStream(e){const t=new Lg(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const r=new Lg(null),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,i))),r}static runTools(e,t,n){const r=new Lg(t),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,i))),r}}class Mg extends Hf{parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new Dp(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new Dp(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap((t=>tg(t,e)))}runFunctions(e,t){return e.stream?Lg.runFunctions(this._client,e,t):gg.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Lg.runTools(this._client,e,t):gg.runTools(this._client,e,t)}stream(e,t){return Dg.createChatCompletion(this._client,e,t)}}class $g extends Hf{constructor(){super(...arguments),this.completions=new Mg(this._client)}}!function(e){e.Completions=Mg}($g||($g={}));class Fg extends Hf{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Vg extends Hf{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class zg extends Hf{constructor(){super(...arguments),this.sessions=new Fg(this._client),this.transcriptionSessions=new Vg(this._client)}}zg.Sessions=Fg,zg.TranscriptionSessions=Vg;var Bg,Ug,Hg,Gg,qg,Kg,Wg,Jg,Zg,Qg,Xg,Yg,ey,ty,ny,ry,iy,ay,sy,oy,ly,uy,cy=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},hy=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};class dy extends Xm{constructor(){super(...arguments),Bg.add(this),Ug.set(this,[]),Hg.set(this,{}),Gg.set(this,{}),qg.set(this,void 0),Kg.set(this,void 0),Wg.set(this,void 0),Jg.set(this,void 0),Zg.set(this,void 0),Qg.set(this,void 0),Xg.set(this,void 0),Yg.set(this,void 0),ey.set(this,void 0)}[(Ug=new WeakMap,Hg=new WeakMap,Gg=new WeakMap,qg=new WeakMap,Kg=new WeakMap,Wg=new WeakMap,Jg=new WeakMap,Zg=new WeakMap,Qg=new WeakMap,Xg=new WeakMap,Yg=new WeakMap,ey=new WeakMap,Bg=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new dy;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const r=nf.fromReadableStream(e,this.controller);for await(const e of r)cy(this,Bg,"m",ty).call(this,e);if(r.controller.signal?.aborted)throw new Lp;return this._addRun(cy(this,Bg,"m",ny).call(this))}toReadableStream(){return new nf(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,i){const a=new dy;return a._run((()=>a._runToolAssistantStream(e,t,n,r,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}}))),a}async _createToolAssistantStream(e,t,n,r,i){const a=i?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",(()=>this.controller.abort())));const s={...r,stream:!0},o=await e.submitToolOutputs(t,n,s,{...i,signal:this.controller.signal});this._connected();for await(const e of o)cy(this,Bg,"m",ty).call(this,e);if(o.controller.signal?.aborted)throw new Lp;return this._addRun(cy(this,Bg,"m",ny).call(this))}static createThreadAssistantStream(e,t,n){const r=new dy;return r._run((()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}static createAssistantStream(e,t,n,r){const i=new dy;return i._run((()=>i._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),i}currentEvent(){return cy(this,Xg,"f")}currentRun(){return cy(this,Yg,"f")}currentMessageSnapshot(){return cy(this,qg,"f")}currentRunStepSnapshot(){return cy(this,ey,"f")}async finalRunSteps(){return await this.done(),Object.values(cy(this,Hg,"f"))}async finalMessages(){return await this.done(),Object.values(cy(this,Gg,"f"))}async finalRun(){if(await this.done(),!cy(this,Kg,"f"))throw Error("Final run was not received.");return cy(this,Kg,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(const e of a)cy(this,Bg,"m",ty).call(this,e);if(a.controller.signal?.aborted)throw new Lp;return this._addRun(cy(this,Bg,"m",ny).call(this))}async _createAssistantStream(e,t,n,r){const i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort())));const a={...n,stream:!0},s=await e.create(t,a,{...r,signal:this.controller.signal});this._connected();for await(const e of s)cy(this,Bg,"m",ty).call(this,e);if(s.controller.signal?.aborted)throw new Lp;return this._addRun(cy(this,Bg,"m",ny).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else{if(!Uf(t)||!Uf(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...r);continue}for(const e of r){if(!Uf(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,i){return await this._createToolAssistantStream(n,e,t,r,i)}}ty=function(e){if(!this.ended)switch(hy(this,Xg,e,"f"),cy(this,Bg,"m",ay).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":cy(this,Bg,"m",uy).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":cy(this,Bg,"m",iy).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":cy(this,Bg,"m",ry).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},ny=function(){if(this.ended)throw new Dp("stream has ended, this shouldn't happen");if(!cy(this,Kg,"f"))throw Error("Final run has not been received");return cy(this,Kg,"f")},ry=function(e){const[t,n]=cy(this,Bg,"m",oy).call(this,e,cy(this,qg,"f"));hy(this,qg,t,"f"),cy(this,Gg,"f")[t.id]=t;for(const e of n){const n=t.content[e.index];"text"==n?.type&&this._emit("textCreated",n.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=cy(this,Wg,"f")){if(cy(this,Jg,"f"))switch(cy(this,Jg,"f").type){case"text":this._emit("textDone",cy(this,Jg,"f").text,cy(this,qg,"f"));break;case"image_file":this._emit("imageFileDone",cy(this,Jg,"f").image_file,cy(this,qg,"f"))}hy(this,Wg,n.index,"f")}hy(this,Jg,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==cy(this,Wg,"f")){const t=e.data.content[cy(this,Wg,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,cy(this,qg,"f"));break;case"text":this._emit("textDone",t.text,cy(this,qg,"f"))}}cy(this,qg,"f")&&this._emit("messageDone",e.data),hy(this,qg,void 0,"f")}},iy=function(e){const t=cy(this,Bg,"m",sy).call(this,e);switch(hy(this,ey,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==cy(this,Zg,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(cy(this,Qg,"f")&&this._emit("toolCallDone",cy(this,Qg,"f")),hy(this,Zg,e.index,"f"),hy(this,Qg,t.step_details.tool_calls[e.index],"f"),cy(this,Qg,"f")&&this._emit("toolCallCreated",cy(this,Qg,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":hy(this,ey,void 0,"f"),"tool_calls"==e.data.step_details.type&&cy(this,Qg,"f")&&(this._emit("toolCallDone",cy(this,Qg,"f")),hy(this,Qg,void 0,"f")),this._emit("runStepDone",e.data,t)}},ay=function(e){cy(this,Ug,"f").push(e),this._emit("event",e)},sy=function(e){switch(e.event){case"thread.run.step.created":return cy(this,Hg,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=cy(this,Hg,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=dy.accumulateDelta(t,n.delta);cy(this,Hg,"f")[e.data.id]=r}return cy(this,Hg,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":cy(this,Hg,"f")[e.data.id]=e.data}if(cy(this,Hg,"f")[e.data.id])return cy(this,Hg,"f")[e.data.id];throw new Error("No snapshot available")},oy=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=cy(this,Bg,"m",ly).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ly=function(e,t){return dy.accumulateDelta(t,e)},uy=function(e){switch(hy(this,Yg,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":hy(this,Kg,e.data,"f"),cy(this,Qg,"f")&&(this._emit("toolCallDone",cy(this,Qg,"f")),hy(this,Qg,void 0,"f"))}};class py extends Hf{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return Pf(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,fy,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class fy extends Wf{}py.MessagesPage=fy;class my extends Hf{retrieve(e,t,n,r={},i){return Pf(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}list(e,t,n={},r){return Pf(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,gy,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class gy extends Wf{}my.RunStepsPage=gy;class yy extends Hf{constructor(){super(...arguments),this.steps=new my(this._client)}create(e,t,n){const{include:r,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return Pf(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,vy,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return dy.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Nf(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return dy.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const i=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,i.id,r)}submitToolOutputsStream(e,t,n,r){return dy.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}}class vy extends Wf{}yy.RunsPage=vy,yy.Steps=my,yy.RunStepsPage=gy;class by extends Hf{constructor(){super(...arguments),this.runs=new yy(this._client),this.messages=new py(this._client)}create(e={},t){return Pf(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return dy.createThreadAssistantStream(e,this._client.beta.threads,t)}}by.Runs=yy,by.RunsPage=vy,by.Messages=py,by.MessagesPage=fy;class wy extends Hf{constructor(){super(...arguments),this.realtime=new zg(this._client),this.chat=new $g(this._client),this.assistants=new Sm(this._client),this.threads=new by(this._client)}}wy.Realtime=zg,wy.Assistants=Sm,wy.AssistantsPage=Nm,wy.Threads=by;class _y extends Hf{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Pf(e)?this.list({},e):this._client.getAPIList("/batches",ky,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class ky extends Wf{}_y.BatchesPage=ky;class Ay extends Hf{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,df({body:t,...n}))}}class Py extends Hf{constructor(){super(...arguments),this.parts=new Ay(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}function Ty(e,t){const n=e.output.map((e=>{if("function_call"===e.type)return{...e,parsed_arguments:xy(t,e)};if("message"===e.type){const n=e.content.map((e=>"output_text"===e.type?{...e,parsed:Iy(t,e.text)}:e));return{...e,content:n}}return e})),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||Cy(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const e of r.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),r}function Iy(e,t){if("json_schema"!==e.text?.format?.type)return null;if("$parseRaw"in e.text?.format){const n=e.text?.format;return n.$parseRaw(t)}return JSON.parse(t)}function Ey(e){return"auto-parseable-tool"===e?.$brand}function xy(e,t){const n=function(e,t){return e.find((e=>"function"===e.type&&e.name===t))}(e.tools??[],t.name);return{...t,...t,parsed_arguments:Ey(n)?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}function Cy(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}Py.Parts=Ay;class Oy extends Hf{list(e,t={},n){return Pf(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,Hy,{query:t,...n})}}var Sy,Ny,jy,Dy,Ry,Ly,My,$y,Fy,Vy=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},zy=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class By extends Xm{constructor(e){super(),Sy.add(this),Ny.set(this,void 0),jy.set(this,void 0),Dy.set(this,void 0),Vy(this,Ny,e,"f")}static createResponse(e,t,n){const r=new By(t);return r._run((()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createOrRetrieveResponse(e,t,n){const r=n?.signal;let i;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),zy(this,Sy,"m",Ry).call(this);let a=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const e of i)zy(this,Sy,"m",Ly).call(this,e,a);if(i.controller.signal?.aborted)throw new Lp;return zy(this,Sy,"m",My).call(this)}[(Ny=new WeakMap,jy=new WeakMap,Dy=new WeakMap,Sy=new WeakSet,Ry=function(){this.ended||Vy(this,jy,void 0,"f")},Ly=function(e,t){if(this.ended)return;const n=(e,n)=>{(null==t||n.sequence_number>t)&&this._emit(e,n)},r=zy(this,Sy,"m",$y).call(this,e);switch(n("event",e),e.type){case"response.output_text.delta":{const t=r.output[e.output_index];if(!t)throw new Dp(`missing output at index ${e.output_index}`);if("message"===t.type){const r=t.content[e.content_index];if(!r)throw new Dp(`missing content at index ${e.content_index}`);if("output_text"!==r.type)throw new Dp(`expected content to be 'output_text', got ${r.type}`);n("response.output_text.delta",{...e,snapshot:r.text})}break}case"response.function_call_arguments.delta":{const t=r.output[e.output_index];if(!t)throw new Dp(`missing output at index ${e.output_index}`);"function_call"===t.type&&n("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:n(e.type,e)}},My=function(){if(this.ended)throw new Dp("stream has ended, this shouldn't happen");const e=zy(this,jy,"f");if(!e)throw new Dp("request ended without sending any events");Vy(this,jy,void 0,"f");const t=function(e,t){return function(e,t){return t&&function(e){return!!Ym(e.text?.format)}(t)?Ty(e,t):{...e,output_parsed:null,output:e.output.map((e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map((e=>({...e,parsed:null})))}:e))}}(e,t)}(e,zy(this,Ny,"f"));return Vy(this,Dy,t,"f"),t},$y=function(e){let t=zy(this,jy,"f");if(!t){if("response.created"!==e.type)throw new Dp(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=Vy(this,jy,e.response,"f"),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new Dp(`missing output at index ${e.output_index}`);"message"===n.type&&n.content.push(e.part);break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new Dp(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new Dp(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new Dp(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new Dp(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.completed":Vy(this,jy,e.response,"f")}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=zy(this,Dy,"f");if(!e)throw new Dp("stream ended without producing a ChatCompletion");return e}}class Uy extends Hf{constructor(){super(...arguments),this.inputItems=new Oy(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap((e=>("object"in e&&"response"===e.object&&Cy(e),e)))}retrieve(e,t={},n){return this._client.get(`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap((t=>Ty(t,e)))}stream(e,t){return By.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class Hy extends Wf{}Uy.InputItems=Oy;class Gy extends Hf{retrieve(e,t,n,r){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,r)}list(e,t,n={},r){return Pf(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,qy,{query:n,...r})}}class qy extends Wf{}Gy.OutputItemListResponsesPage=qy;class Ky extends Hf{constructor(){super(...arguments),this.outputItems=new Gy(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return Pf(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Wy,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class Wy extends Wf{}Ky.RunListResponsesPage=Wy,Ky.OutputItems=Gy,Ky.OutputItemListResponsesPage=qy;class Jy extends Hf{constructor(){super(...arguments),this.runs=new Ky(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return Pf(e)?this.list({},e):this._client.getAPIList("/evals",Zy,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class Zy extends Wf{}Jy.EvalListResponsesPage=Zy,Jy.Runs=Ky,Jy.RunListResponsesPage=Wy;class Qy extends Hf{retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n?.headers},__binaryResponse:!0})}}class Xy extends Hf{constructor(){super(...arguments),this.content=new Qy(this._client)}create(e,t,n){return this._client.post(`/containers/${e}/files`,df({body:t,...n}))}retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}`,n)}list(e,t={},n){return Pf(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,Yy,{query:t,...n})}del(e,t,n){return this._client.delete(`/containers/${e}/files/${t}`,{...n,headers:{Accept:"*/*",...n?.headers}})}}class Yy extends Wf{}Xy.FileListResponsesPage=Yy,Xy.Content=Qy;class ev extends Hf{constructor(){super(...arguments),this.files=new Xy(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return Pf(e)?this.list({},e):this._client.getAPIList("/containers",tv,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class tv extends Wf{}ev.ContainerListResponsesPage=tv,ev.Files=Xy,ev.FileListResponsesPage=Yy;class nv extends bf{constructor({baseURL:e=Rf("OPENAI_BASE_URL"),apiKey:t=Rf("OPENAI_API_KEY"),organization:n=Rf("OPENAI_ORG_ID")??null,project:r=Rf("OPENAI_PROJECT_ID")??null,...i}={}){if(void 0===t)throw new Dp("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:n,project:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new Dp("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Gf(this),this.chat=new Xf(this),this.embeddings=new Yf(this),this.files=new em(this),this.images=new nm(this),this.audio=new sm(this),this.moderations=new om(this),this.models=new lm(this),this.fineTuning=new _m(this),this.graders=new Am(this),this.vectorStores=new xm(this),this.beta=new wy(this),this.batches=new _y(this),this.uploads=new Py(this),this.responses=new Uy(this),this.evals=new Jy(this),this.containers=new ev(this),this._options=a,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return function(e,t={}){let n=e;const r=function(e=fp){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||fp.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=np;if(void 0!==e.format){if(!lp.call(rp,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=rp[n];let i,a=fp.filter;if(("function"==typeof e.filter||cp(e.filter))&&(a=e.filter),i=e.arrayFormat&&e.arrayFormat in up?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":fp.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const s=void 0===e.allowDots?1==!!e.encodeDotInKeys||fp.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:fp.addQueryPrefix,allowDots:s,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:fp.allowEmptyArrays,arrayFormat:i,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:fp.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?fp.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:fp.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:fp.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:fp.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:fp.encodeValuesOnly,filter:a,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:fp.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:fp.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:fp.strictNullHandling}}(t);let i,a;"function"==typeof r.filter?(a=r.filter,n=a("",n)):cp(r.filter)&&(a=r.filter,i=a);const s=[];if("object"!=typeof n||null===n)return"";const o=up[r.arrayFormat],l="comma"===o&&r.commaRoundTrip;i||(i=Object.keys(n)),r.sort&&i.sort(r.sort);const u=new WeakMap;for(let e=0;e<i.length;++e){const t=i[e];r.skipNulls&&null===n[t]||dp(s,gp(n[t],t,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const c=s.join(r.delimiter);let h=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),c.length>0?h+c:""}(e,{arrayFormat:"brackets"})}}Fy=nv,nv.OpenAI=Fy,nv.DEFAULT_TIMEOUT=6e5,nv.OpenAIError=Dp,nv.APIError=Rp,nv.APIConnectionError=Mp,nv.APIConnectionTimeoutError=$p,nv.APIUserAbortError=Lp,nv.NotFoundError=Bp,nv.ConflictError=Up,nv.RateLimitError=Gp,nv.BadRequestError=Fp,nv.AuthenticationError=Vp,nv.InternalServerError=qp,nv.PermissionDeniedError=zp,nv.UnprocessableEntityError=Hp,nv.toFile=lf,nv.fileFromPath=Tp,nv.Completions=Gf,nv.Chat=Xf,nv.ChatCompletionsPage=Zf,nv.Embeddings=Yf,nv.Files=em,nv.FileObjectsPage=tm,nv.Images=nm,nv.Audio=sm,nv.Moderations=om,nv.Models=lm,nv.ModelsPage=um,nv.FineTuning=_m,nv.Graders=Am,nv.VectorStores=xm,nv.VectorStoresPage=Cm,nv.VectorStoreSearchResponsesPage=Om,nv.Beta=wy,nv.Batches=_y,nv.BatchesPage=ky,nv.Uploads=Py,nv.Responses=Uy,nv.Evals=Jy,nv.EvalListResponsesPage=Zy,nv.Containers=ev,nv.ContainerListResponsesPage=tv,new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/images/edits"]);const rv=nv;function iv(e,t=av){e=e.trim();const n=/```(json)?(.*)```/s.exec(e);return t(n?n[2]:e)}function av(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="";const n=[];let r=!1,i=!1;for(let a of e){if(r)'"'!==a||i?"\n"!==a||i?i="\\"===a&&!i:a="\\n":r=!1;else if('"'===a)r=!0,i=!1;else if("{"===a)n.push("}");else if("["===a)n.push("]");else if("}"===a||"]"===a){if(!n||n[n.length-1]!==a)return null;n.pop()}t+=a}r&&(t+='"');for(let e=n.length-1;e>=0;e-=1)t+=n[e];try{return JSON.parse(t)}catch(e){return null}}var sv=i(409);function ov(e,t){return t?.[e]||sv(e)}function lv(e,t,n){const r={};for(const i in e)Object.hasOwn(e,i)&&(r[t(i,n)]=e[i]);return r}function uv(e){return Array.isArray(e)?[...e]:{...e}}function cv(e,t){const n=uv(e);for(const[e,r]of Object.entries(t)){const[t,...i]=e.split(".").reverse();let a=n;for(const e of i.reverse()){if(void 0===a[e])break;a[e]=uv(a[e]),a=a[e]}void 0!==a[t]&&(a[t]={lc:1,type:"secret",id:[r]})}return n}function hv(e){const t=Object.getPrototypeOf(e);return"function"!=typeof e.lc_name||"function"==typeof t.lc_name&&e.lc_name()===t.lc_name()?e.name:e.lc_name()}i(832);class dv{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,hv(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof dv||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let r=Object.getPrototypeOf(this);r;r=Object.getPrototypeOf(r))Object.assign(e,Reflect.get(r,"lc_aliases",this)),Object.assign(t,Reflect.get(r,"lc_secrets",this)),Object.assign(n,Reflect.get(r,"lc_attributes",this));return Object.keys(t).forEach((e=>{let t=this,r=n;const[i,...a]=e.split(".").reverse();for(const e of a.reverse()){if(!(e in t)||void 0===t[e])return;e in r&&void 0!==r[e]||("object"==typeof t[e]&&null!=t[e]?r[e]={}:Array.isArray(t[e])&&(r[e]=[])),t=t[e],r=r[e]}i in t&&void 0!==t[i]&&(r[i]=r[i]||t[i])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:lv(Object.keys(t).length?cv(n,t):n,ov,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function pv(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}class fv extends dv{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}function mv(e,t){const n={...e};for(const[e,r]of Object.entries(t))if(null==n[e])n[e]=r;else{if(null==r)continue;if(typeof n[e]!=typeof r||Array.isArray(n[e])!==Array.isArray(r))throw new Error(`field[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof n[e])n[e]=n[e]+r;else if(Array.isArray(n[e])||"object"!=typeof n[e])if(Array.isArray(n[e]))n[e]=gv(n[e],r);else{if(n[e]===r)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else n[e]=mv(n[e],r)}return n}function gv(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{const n=[...e];for(const e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){const t=n.findIndex((t=>t.index===e.index));-1!==t?n[t]=mv(n[t],e):n.push(e)}else n.push(e);return n}}}class yv extends fv{}function vv(e){return"function"==typeof e?._getType}class bv extends yv{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new bv({content:pv(this.content,e.content),additional_kwargs:mv(this.additional_kwargs,e.additional_kwargs),response_metadata:mv(this.response_metadata,e.response_metadata),tool_call_id:this.tool_call_id})}}class wv extends fv{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let n;if("string"==typeof e)n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const t=n.additional_kwargs?.tool_calls,r=n.tool_calls;null!=t&&t.length>0&&(void 0===r||0===r.length)&&console.warn(["New LangChain packages are available that more efficiently handle","tool calling.\n\nPlease upgrade your packages to versions that set","message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(null!=t&&void 0===r){const[e,r]=function(e){const t=[],n=[];for(const r of e)if(r.function){const e=r.function.name;try{const n={name:e||"",args:JSON.parse(r.function.arguments)||{},id:r.id};t.push(n)}catch(t){n.push({name:e,args:r.function.arguments,id:r.id,error:"Malformed args."})}}return[t,n]}(t);n.tool_calls=e??[],n.invalid_tool_calls=r??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch(e){n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),"string"!=typeof n&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls)}static lc_name(){return"AIMessage"}_getType(){return"ai"}}class _v extends yv{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{const n=[],r=[];for(const t of e.tool_call_chunks){let i={};try{if(i=av(t.args??"{}")??{},"object"!=typeof i||Array.isArray(i))throw new Error("Malformed tool call chunk args.");n.push({name:t.name??"",args:i,id:t.id})}catch(e){r.push({name:t.name,args:t.args,id:t.id,error:"Malformed args."})}}t={...e,tool_calls:n,invalid_tool_calls:r}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.tool_call_chunks=t?.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t?.tool_calls??this.tool_calls,this.invalid_tool_calls=t?.invalid_tool_calls??this.invalid_tool_calls}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){const t={content:pv(this.content,e.content),additional_kwargs:mv(this.additional_kwargs,e.additional_kwargs),response_metadata:mv(this.response_metadata,e.response_metadata),tool_call_chunks:[]};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){const n=gv(this.tool_call_chunks,e.tool_call_chunks);void 0!==n&&n.length>0&&(t.tool_call_chunks=n)}return new _v(t)}}class kv extends fv{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return kv}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}class Av extends yv{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Av({content:pv(this.content,e.content),additional_kwargs:mv(this.additional_kwargs,e.additional_kwargs),response_metadata:mv(this.response_metadata,e.response_metadata),role:this.role})}}class Pv extends yv{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Pv({content:pv(this.content,e.content),additional_kwargs:mv(this.additional_kwargs,e.additional_kwargs),response_metadata:mv(this.response_metadata,e.response_metadata),name:this.name??""})}}class Tv extends fv{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Iv extends yv{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Iv({content:pv(this.content,e.content),additional_kwargs:mv(this.additional_kwargs,e.additional_kwargs),response_metadata:mv(this.response_metadata,e.response_metadata)})}}class Ev extends fv{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class xv extends yv{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new xv({content:pv(this.content,e.content),additional_kwargs:mv(this.additional_kwargs,e.additional_kwargs),response_metadata:mv(this.response_metadata,e.response_metadata)})}}function Cv(e){if("string"==typeof e)return new Tv(e);if(vv(e))return e;const[t,n]=e;if("human"===t||"user"===t)return new Tv({content:n});if("ai"===t||"assistant"===t)return new wv({content:n});if("system"===t)return new Ev({content:n});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function Ov(e,t="Human",n="AI"){const r=[];for(const i of e){let e;if("human"===i._getType())e=t;else if("ai"===i._getType())e=n;else if("system"===i._getType())e="System";else if("function"===i._getType())e="Function";else if("tool"===i._getType())e="Tool";else{if("generic"!==i._getType())throw new Error(`Got unsupported message type: ${i._getType()}`);e=i.role}const a=i.name?`${i.name}, `:"";r.push(`${e}: ${a}${i.content}`)}return r.join("\n")}function Sv(e){const t=e._getType();if("human"===t)return new Iv({...e});if("ai"===t)return new _v({...e});if("system"===t)return new xv({...e});if("function"===t)return new Pv({...e});if(kv.isInstance(e))return new Av({...e});throw new Error("Unknown message type.")}const Nv="__run";class jv{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new jv({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Dv extends jv{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Dv({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}const Rv=()=>"undefined"!=typeof Deno;let Lv;async function Mv(){if(void 0===Lv){const e=(()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||Rv()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":Rv()?"deno":"other":"node",e})();Lv={library:"langchain-js",runtime:e}}return Lv}function $v(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}var Fv="object"==typeof window?window:{},Vv="0123456789abcdef".split(""),zv=[-2147483648,8388608,32768,128],Bv=[24,16,8,0],Uv=[];function Hv(e){e?(Uv[0]=Uv[16]=Uv[1]=Uv[2]=Uv[3]=Uv[4]=Uv[5]=Uv[6]=Uv[7]=Uv[8]=Uv[9]=Uv[10]=Uv[11]=Uv[12]=Uv[13]=Uv[14]=Uv[15]=0,this.blocks=Uv):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Hv.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===Fv.ArrayBuffer&&(e=new Uint8Array(e));for(var n,r,i=0,a=e.length||0,s=this.blocks;i<a;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)for(r=this.start;i<a&&r<64;++i)s[r>>2]|=e[i]<<Bv[3&r++];else for(r=this.start;i<a&&r<64;++i)(n=e.charCodeAt(i))<128?s[r>>2]|=n<<Bv[3&r++]:n<2048?(s[r>>2]|=(192|n>>6)<<Bv[3&r++],s[r>>2]|=(128|63&n)<<Bv[3&r++]):n<55296||n>=57344?(s[r>>2]|=(224|n>>12)<<Bv[3&r++],s[r>>2]|=(128|n>>6&63)<<Bv[3&r++],s[r>>2]|=(128|63&n)<<Bv[3&r++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++i)),s[r>>2]|=(240|n>>18)<<Bv[3&r++],s[r>>2]|=(128|n>>12&63)<<Bv[3&r++],s[r>>2]|=(128|n>>6&63)<<Bv[3&r++],s[r>>2]|=(128|63&n)<<Bv[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=s[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}},Hv.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=zv[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Hv.prototype.hash=function(){var e,t,n=this.h0,r=this.h1,i=this.h2,a=this.h3,s=this.h4,o=this.blocks;for(e=16;e<80;++e)t=o[e-3]^o[e-8]^o[e-14]^o[e-16],o[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)n=(t=(r=(t=(i=(t=(a=(t=(s=(t=n<<5|n>>>27)+(r&i|~r&a)+s+1518500249+o[e]|0)<<5|s>>>27)+(n&(r=r<<30|r>>>2)|~n&i)+a+1518500249+o[e+1]|0)<<5|a>>>27)+(s&(n=n<<30|n>>>2)|~s&r)+i+1518500249+o[e+2]|0)<<5|i>>>27)+(a&(s=s<<30|s>>>2)|~a&n)+r+1518500249+o[e+3]|0)<<5|r>>>27)+(i&(a=a<<30|a>>>2)|~i&s)+n+1518500249+o[e+4]|0,i=i<<30|i>>>2;for(;e<40;e+=5)n=(t=(r=(t=(i=(t=(a=(t=(s=(t=n<<5|n>>>27)+(r^i^a)+s+1859775393+o[e]|0)<<5|s>>>27)+(n^(r=r<<30|r>>>2)^i)+a+1859775393+o[e+1]|0)<<5|a>>>27)+(s^(n=n<<30|n>>>2)^r)+i+1859775393+o[e+2]|0)<<5|i>>>27)+(a^(s=s<<30|s>>>2)^n)+r+1859775393+o[e+3]|0)<<5|r>>>27)+(i^(a=a<<30|a>>>2)^s)+n+1859775393+o[e+4]|0,i=i<<30|i>>>2;for(;e<60;e+=5)n=(t=(r=(t=(i=(t=(a=(t=(s=(t=n<<5|n>>>27)+(r&i|r&a|i&a)+s-1894007588+o[e]|0)<<5|s>>>27)+(n&(r=r<<30|r>>>2)|n&i|r&i)+a-1894007588+o[e+1]|0)<<5|a>>>27)+(s&(n=n<<30|n>>>2)|s&r|n&r)+i-1894007588+o[e+2]|0)<<5|i>>>27)+(a&(s=s<<30|s>>>2)|a&n|s&n)+r-1894007588+o[e+3]|0)<<5|r>>>27)+(i&(a=a<<30|a>>>2)|i&s|a&s)+n-1894007588+o[e+4]|0,i=i<<30|i>>>2;for(;e<80;e+=5)n=(t=(r=(t=(i=(t=(a=(t=(s=(t=n<<5|n>>>27)+(r^i^a)+s-899497514+o[e]|0)<<5|s>>>27)+(n^(r=r<<30|r>>>2)^i)+a-899497514+o[e+1]|0)<<5|a>>>27)+(s^(n=n<<30|n>>>2)^r)+i-899497514+o[e+2]|0)<<5|i>>>27)+(a^(s=s<<30|s>>>2)^n)+r-899497514+o[e+3]|0)<<5|r>>>27)+(i^(a=a<<30|a>>>2)^s)+n-899497514+o[e+4]|0,i=i<<30|i>>>2;this.h0=this.h0+n|0,this.h1=this.h1+r|0,this.h2=this.h2+i|0,this.h3=this.h3+a|0,this.h4=this.h4+s|0},Hv.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,i=this.h4;return Vv[e>>28&15]+Vv[e>>24&15]+Vv[e>>20&15]+Vv[e>>16&15]+Vv[e>>12&15]+Vv[e>>8&15]+Vv[e>>4&15]+Vv[15&e]+Vv[t>>28&15]+Vv[t>>24&15]+Vv[t>>20&15]+Vv[t>>16&15]+Vv[t>>12&15]+Vv[t>>8&15]+Vv[t>>4&15]+Vv[15&t]+Vv[n>>28&15]+Vv[n>>24&15]+Vv[n>>20&15]+Vv[n>>16&15]+Vv[n>>12&15]+Vv[n>>8&15]+Vv[n>>4&15]+Vv[15&n]+Vv[r>>28&15]+Vv[r>>24&15]+Vv[r>>20&15]+Vv[r>>16&15]+Vv[r>>12&15]+Vv[r>>8&15]+Vv[r>>4&15]+Vv[15&r]+Vv[i>>28&15]+Vv[i>>24&15]+Vv[i>>20&15]+Vv[i>>16&15]+Vv[i>>12&15]+Vv[i>>8&15]+Vv[i>>4&15]+Vv[15&i]},Hv.prototype.toString=Hv.prototype.hex,Hv.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,i=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24&255,i>>16&255,i>>8&255,255&i]},Hv.prototype.array=Hv.prototype.digest,Hv.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};const Gv=(...e)=>{return t=e.join("_"),new Hv(!0).update(t).hex();var t};class qv{}const Kv=new Map;class Wv extends qv{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Gv(e,t))??null)}async update(e,t,n){this.cache.set(Gv(e,t),n)}static global(){return new Wv(Kv)}}class Jv extends dv{}class Zv extends Jv{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Tv(this.value)]}}class Qv extends Jv{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return Ov(this.messages)}toChatMessages(){return this.messages}}var Xv=i(201),Yv=i(425);const eb=[400,401,402,403,404,405,406,407,409],tb=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&eb.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};class nb{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??tb;const t=Yv.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>Xv((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise(((t,n)=>{e.signal?.addEventListener("abort",(()=>{n(new Error("AbortError"))}))}))]):this.call(t,...n)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}var rb=i(991),ib=Object.defineProperty;function ab(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let n=Array.from({length:e.length},((e,t)=>({start:t,end:t+1})));for(;n.length>1;){let r=null;for(let i=0;i<n.length-1;i++){const a=e.slice(n[i].start,n[i+1].end),s=t.get(a.join(","));null!=s&&(null==r||s<r[0])&&(r=[s,i])}if(null==r)break;{const e=r[1];n[e]={start:n[e].start,end:n[e+1].end},n.splice(e+1,1)}}return n}(e,t).map((n=>t.get(e.slice(n.start,n.end).join(",")))).filter((e=>null!=e))}var sb,ob,lb=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const n=e.bpe_ranks.split("\n").filter(Boolean).reduce(((e,t)=>{const[n,r,...i]=t.split(" "),a=Number.parseInt(r,10);return i.forEach(((t,n)=>e[t]=a+n)),e}),{});for(const[e,t]of Object.entries(n)){const n=rb.toByteArray(e);this.rankMap.set(n.join(","),t),this.textMap.set(t,n)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((e,[t,n])=>(e[n]=this.textEncoder.encode(t),e)),{})}encode(e,t=[],n="all"){const r=new RegExp(this.patStr,"ug"),i=lb.specialTokenRegex(Object.keys(this.specialTokens)),a=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===n?Object.keys(this.specialTokens).filter((e=>!s.has(e))):n);if(o.size>0){const t=lb.specialTokenRegex([...o]),n=e.match(t);if(null!=n)throw new Error(`The text contains a special token that is not allowed: ${n[0]}`)}let l=0;for(;;){let t=null,n=l;for(;i.lastIndex=n,t=i.exec(e),null!=t&&!s.has(t[0]);)n=t.index+1;const o=t?.index??e.length;for(const t of e.substring(l,o).matchAll(r)){const e=this.textEncoder.encode(t[0]),n=this.rankMap.get(e.join(","));null==n?a.push(...ab(e,this.rankMap)):a.push(n)}if(null==t)break;let u=this.specialTokens[t[0]];a.push(u),l=t.index+t[0].length}return a}decode(e){const t=[];let n=0;for(let r=0;r<e.length;++r){const i=e[r],a=this.textMap.get(i)??this.inverseSpecialTokens[i];null!=a&&(t.push(a),n+=a.length)}const r=new Uint8Array(n);let i=0;for(const e of t)r.set(e,i),i+=e.length;return this.textDecoder.decode(r)}},ub=lb;ob=e=>new RegExp(e.map((e=>function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}(e))).join("|"),"g"),((e,t,n)=>{t in e?ib(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(ub,"symbol"!=typeof(sb="specialTokenRegex")?sb+"":sb,ob);const cb={},hb=new nb({});var db,pb;!function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(db||(db={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(pb||(pb={}));const fb=db.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),mb=e=>{switch(typeof e){case"undefined":return fb.undefined;case"string":return fb.string;case"number":return Number.isNaN(e)?fb.nan:fb.number;case"boolean":return fb.boolean;case"function":return fb.function;case"bigint":return fb.bigint;case"symbol":return fb.symbol;case"object":return Array.isArray(e)?fb.array:null===e?fb.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?fb.promise:"undefined"!=typeof Map&&e instanceof Map?fb.map:"undefined"!=typeof Set&&e instanceof Set?fb.set:"undefined"!=typeof Date&&e instanceof Date?fb.date:fb.object;default:return fb.unknown}},gb=db.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class yb extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(r);else if("invalid_return_type"===i.code)r(i.returnTypeError);else if("invalid_arguments"===i.code)r(i.argumentsError);else if(0===i.path.length)n._errors.push(t(i));else{let e=n,r=0;for(;r<i.path.length;){const n=i.path[r];r===i.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(i))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}static assert(e){if(!(e instanceof yb))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,db.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},n=[];for(const r of this.issues)if(r.path.length>0){const n=r.path[0];t[n]=t[n]||[],t[n].push(e(r))}else n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}yb.create=e=>new yb(e);const vb=(e,t)=>{let n;switch(e.code){case gb.invalid_type:n=e.received===fb.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case gb.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,db.jsonStringifyReplacer)}`;break;case gb.unrecognized_keys:n=`Unrecognized key(s) in object: ${db.joinValues(e.keys,", ")}`;break;case gb.invalid_union:n="Invalid input";break;case gb.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${db.joinValues(e.options)}`;break;case gb.invalid_enum_value:n=`Invalid enum value. Expected ${db.joinValues(e.options)}, received '${e.received}'`;break;case gb.invalid_arguments:n="Invalid function arguments";break;case gb.invalid_return_type:n="Invalid function return type";break;case gb.invalid_date:n="Invalid date";break;case gb.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:db.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case gb.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case gb.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case gb.custom:n="Invalid input";break;case gb.invalid_intersection_types:n="Intersection results could not be merged";break;case gb.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case gb.not_finite:n="Number must be finite";break;default:n=t.defaultError,db.assertNever(e)}return{message:n}};let bb=vb;var wb;function _b(e,t){const n=bb,r=(e=>{const{data:t,path:n,errorMaps:r,issueData:i}=e,a=[...n,...i.path||[]],s={...i,path:a};if(void 0!==i.message)return{...i,path:a,message:i.message};let o="";const l=r.filter((e=>!!e)).slice().reverse();for(const e of l)o=e(s,{data:t,defaultError:o}).message;return{...i,path:a,message:o}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===vb?void 0:vb].filter((e=>!!e))});e.common.issues.push(r)}!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(wb||(wb={}));class kb{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return Ab;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t){const t=await e.key,r=await e.value;n.push({key:t,value:r})}return kb.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:i}=r;if("aborted"===t.status)return Ab;if("aborted"===i.status)return Ab;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"===t.value||void 0===i.value&&!r.alwaysSet||(n[t.value]=i.value)}return{status:e.value,value:n}}}const Ab=Object.freeze({status:"aborted"}),Pb=e=>({status:"dirty",value:e}),Tb=e=>({status:"valid",value:e}),Ib=e=>"aborted"===e.status,Eb=e=>"dirty"===e.status,xb=e=>"valid"===e.status,Cb=e=>"undefined"!=typeof Promise&&e instanceof Promise;class Ob{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Sb=(e,t)=>{if(xb(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new yb(e.common.issues);return this._error=t,this._error}}};function Nb(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:i}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{const{message:a}=e;return"invalid_enum_value"===t.code?{message:a??i.defaultError}:void 0===i.data?{message:a??r??i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:a??n??i.defaultError}},description:i}}class jb{get description(){return this._def.description}_getType(e){return mb(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:mb(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new kb,ctx:{common:e.parent.common,data:e.data,parsedType:mb(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Cb(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:mb(e)},r=this._parseSync({data:e,path:n.path,parent:n});return Sb(n,r)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:mb(e)};if(!this["~standard"].async)try{const n=this._parseSync({data:e,path:[],parent:t});return xb(n)?{value:n.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then((e=>xb(e)?{value:e.value}:{issues:t.common.issues}))}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:mb(e)},r=this._parse({data:e,path:n.path,parent:n}),i=await(Cb(r)?r:Promise.resolve(r));return Sb(n,i)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,r)=>{const i=e(t),a=()=>r.addIssue({code:gb.custom,...n(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then((e=>!!e||(a(),!1))):!!i||(a(),!1)}))}refinement(e,t){return this._refinement(((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1)))}_refinement(e){return new Cw({schema:this,typeName:$w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Ow.create(this,this._def)}nullable(){return Sw.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return fw.create(this)}promise(){return xw.create(this,this._def)}or(e){return yw.create([this,e],this._def)}and(e){return bw.create(this,e,this._def)}transform(e){return new Cw({...Nb(this._def),schema:this,typeName:$w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Nw({...Nb(this._def),innerType:this,defaultValue:t,typeName:$w.ZodDefault})}brand(){return new Rw({typeName:$w.ZodBranded,type:this,...Nb(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new jw({...Nb(this._def),innerType:this,catchValue:t,typeName:$w.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Lw.create(this,e)}readonly(){return Mw.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Db=/^c[^\s-]{8,}$/i,Rb=/^[0-9a-z]+$/,Lb=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Mb=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,$b=/^[a-z0-9_-]{21}$/i,Fb=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Vb=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,zb=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Bb;const Ub=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Hb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Gb=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,qb=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Kb=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Wb=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Jb="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Zb=new RegExp(`^${Jb}$`);function Qb(e){let t="[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function Xb(e){let t=`${Jb}T${Qb(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function Yb(e,t){if(!Fb.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));return!("object"!=typeof i||null===i||"typ"in i&&"JWT"!==i?.typ||!i.alg||t&&i.alg!==t)}catch{return!1}}function ew(e,t){return!("v4"!==t&&t||!Hb.test(e))||!("v6"!==t&&t||!qb.test(e))}class tw extends jb{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==fb.string){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.string,received:t.parsedType}),Ab}const t=new kb;let n;for(const a of this._def.checks)if("min"===a.kind)e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),_b(n,{code:gb.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("max"===a.kind)e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),_b(n,{code:gb.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("length"===a.kind){const r=e.data.length>a.value,i=e.data.length<a.value;(r||i)&&(n=this._getOrReturnCtx(e,n),r?_b(n,{code:gb.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):i&&_b(n,{code:gb.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),t.dirty())}else if("email"===a.kind)zb.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"email",code:gb.invalid_string,message:a.message}),t.dirty());else if("emoji"===a.kind)Bb||(Bb=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Bb.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"emoji",code:gb.invalid_string,message:a.message}),t.dirty());else if("uuid"===a.kind)Mb.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"uuid",code:gb.invalid_string,message:a.message}),t.dirty());else if("nanoid"===a.kind)$b.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"nanoid",code:gb.invalid_string,message:a.message}),t.dirty());else if("cuid"===a.kind)Db.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"cuid",code:gb.invalid_string,message:a.message}),t.dirty());else if("cuid2"===a.kind)Rb.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"cuid2",code:gb.invalid_string,message:a.message}),t.dirty());else if("ulid"===a.kind)Lb.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"ulid",code:gb.invalid_string,message:a.message}),t.dirty());else if("url"===a.kind)try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),_b(n,{validation:"url",code:gb.invalid_string,message:a.message}),t.dirty()}else"regex"===a.kind?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"regex",code:gb.invalid_string,message:a.message}),t.dirty())):"trim"===a.kind?e.data=e.data.trim():"includes"===a.kind?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),_b(n,{code:gb.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),t.dirty()):"toLowerCase"===a.kind?e.data=e.data.toLowerCase():"toUpperCase"===a.kind?e.data=e.data.toUpperCase():"startsWith"===a.kind?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),_b(n,{code:gb.invalid_string,validation:{startsWith:a.value},message:a.message}),t.dirty()):"endsWith"===a.kind?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),_b(n,{code:gb.invalid_string,validation:{endsWith:a.value},message:a.message}),t.dirty()):"datetime"===a.kind?Xb(a).test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{code:gb.invalid_string,validation:"datetime",message:a.message}),t.dirty()):"date"===a.kind?Zb.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{code:gb.invalid_string,validation:"date",message:a.message}),t.dirty()):"time"===a.kind?new RegExp(`^${Qb(a)}$`).test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{code:gb.invalid_string,validation:"time",message:a.message}),t.dirty()):"duration"===a.kind?Vb.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"duration",code:gb.invalid_string,message:a.message}),t.dirty()):"ip"===a.kind?(r=e.data,("v4"!==(i=a.version)&&i||!Ub.test(r))&&("v6"!==i&&i||!Gb.test(r))&&(n=this._getOrReturnCtx(e,n),_b(n,{validation:"ip",code:gb.invalid_string,message:a.message}),t.dirty())):"jwt"===a.kind?Yb(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"jwt",code:gb.invalid_string,message:a.message}),t.dirty()):"cidr"===a.kind?ew(e.data,a.version)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"cidr",code:gb.invalid_string,message:a.message}),t.dirty()):"base64"===a.kind?Kb.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"base64",code:gb.invalid_string,message:a.message}),t.dirty()):"base64url"===a.kind?Wb.test(e.data)||(n=this._getOrReturnCtx(e,n),_b(n,{validation:"base64url",code:gb.invalid_string,message:a.message}),t.dirty()):db.assertNever(a);var r,i;return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement((t=>e.test(t)),{validation:t,code:gb.invalid_string,...wb.errToObj(n)})}_addCheck(e){return new tw({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...wb.errToObj(e)})}url(e){return this._addCheck({kind:"url",...wb.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...wb.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...wb.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...wb.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...wb.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...wb.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...wb.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...wb.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...wb.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...wb.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...wb.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...wb.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...wb.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...wb.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...wb.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...wb.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...wb.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...wb.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...wb.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...wb.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...wb.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...wb.errToObj(t)})}nonempty(e){return this.min(1,wb.errToObj(e))}trim(){return new tw({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new tw({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new tw({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function nw(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,i=n>r?n:r;return Number.parseInt(e.toFixed(i).replace(".",""))%Number.parseInt(t.toFixed(i).replace(".",""))/10**i}tw.create=e=>new tw({checks:[],typeName:$w.ZodString,coerce:e?.coerce??!1,...Nb(e)});class rw extends jb{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==fb.number){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.number,received:t.parsedType}),Ab}let t;const n=new kb;for(const r of this._def.checks)"int"===r.kind?db.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),_b(t,{code:gb.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),_b(t,{code:gb.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),_b(t,{code:gb.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"multipleOf"===r.kind?0!==nw(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),_b(t,{code:gb.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),_b(t,{code:gb.not_finite,message:r.message}),n.dirty()):db.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,wb.toString(t))}gt(e,t){return this.setLimit("min",e,!1,wb.toString(t))}lte(e,t){return this.setLimit("max",e,!0,wb.toString(t))}lt(e,t){return this.setLimit("max",e,!1,wb.toString(t))}setLimit(e,t,n,r){return new rw({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:wb.toString(r)}]})}_addCheck(e){return new rw({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:wb.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:wb.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:wb.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:wb.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:wb.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:wb.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:wb.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:wb.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:wb.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&db.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}rw.create=e=>new rw({checks:[],typeName:$w.ZodNumber,coerce:e?.coerce||!1,...Nb(e)});class iw extends jb{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==fb.bigint)return this._getInvalidInput(e);let t;const n=new kb;for(const r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),_b(t,{code:gb.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),_b(t,{code:gb.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),_b(t,{code:gb.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):db.assertNever(r);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.bigint,received:t.parsedType}),Ab}gte(e,t){return this.setLimit("min",e,!0,wb.toString(t))}gt(e,t){return this.setLimit("min",e,!1,wb.toString(t))}lte(e,t){return this.setLimit("max",e,!0,wb.toString(t))}lt(e,t){return this.setLimit("max",e,!1,wb.toString(t))}setLimit(e,t,n,r){return new iw({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:wb.toString(r)}]})}_addCheck(e){return new iw({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:wb.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:wb.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:wb.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:wb.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:wb.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}iw.create=e=>new iw({checks:[],typeName:$w.ZodBigInt,coerce:e?.coerce??!1,...Nb(e)});class aw extends jb{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==fb.boolean){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.boolean,received:t.parsedType}),Ab}return Tb(e.data)}}aw.create=e=>new aw({typeName:$w.ZodBoolean,coerce:e?.coerce||!1,...Nb(e)});class sw extends jb{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==fb.date){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.date,received:t.parsedType}),Ab}if(Number.isNaN(e.data.getTime()))return _b(this._getOrReturnCtx(e),{code:gb.invalid_date}),Ab;const t=new kb;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),_b(n,{code:gb.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),_b(n,{code:gb.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):db.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new sw({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:wb.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:wb.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}sw.create=e=>new sw({checks:[],coerce:e?.coerce||!1,typeName:$w.ZodDate,...Nb(e)});class ow extends jb{_parse(e){if(this._getType(e)!==fb.symbol){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.symbol,received:t.parsedType}),Ab}return Tb(e.data)}}ow.create=e=>new ow({typeName:$w.ZodSymbol,...Nb(e)});class lw extends jb{_parse(e){if(this._getType(e)!==fb.undefined){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.undefined,received:t.parsedType}),Ab}return Tb(e.data)}}lw.create=e=>new lw({typeName:$w.ZodUndefined,...Nb(e)});class uw extends jb{_parse(e){if(this._getType(e)!==fb.null){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.null,received:t.parsedType}),Ab}return Tb(e.data)}}uw.create=e=>new uw({typeName:$w.ZodNull,...Nb(e)});class cw extends jb{constructor(){super(...arguments),this._any=!0}_parse(e){return Tb(e.data)}}cw.create=e=>new cw({typeName:$w.ZodAny,...Nb(e)});class hw extends jb{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Tb(e.data)}}hw.create=e=>new hw({typeName:$w.ZodUnknown,...Nb(e)});class dw extends jb{_parse(e){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.never,received:t.parsedType}),Ab}}dw.create=e=>new dw({typeName:$w.ZodNever,...Nb(e)});class pw extends jb{_parse(e){if(this._getType(e)!==fb.undefined){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.void,received:t.parsedType}),Ab}return Tb(e.data)}}pw.create=e=>new pw({typeName:$w.ZodVoid,...Nb(e)});class fw extends jb{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==fb.array)return _b(t,{code:gb.invalid_type,expected:fb.array,received:t.parsedType}),Ab;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,i=t.data.length<r.exactLength.value;(e||i)&&(_b(t,{code:e?gb.too_big:gb.too_small,minimum:i?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(_b(t,{code:gb.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(_b(t,{code:gb.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map(((e,n)=>r.type._parseAsync(new Ob(t,e,t.path,n))))).then((e=>kb.mergeArray(n,e)));const i=[...t.data].map(((e,n)=>r.type._parseSync(new Ob(t,e,t.path,n))));return kb.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new fw({...this._def,minLength:{value:e,message:wb.toString(t)}})}max(e,t){return new fw({...this._def,maxLength:{value:e,message:wb.toString(t)}})}length(e,t){return new fw({...this._def,exactLength:{value:e,message:wb.toString(t)}})}nonempty(e){return this.min(1,e)}}function mw(e){if(e instanceof gw){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Ow.create(mw(r))}return new gw({...e._def,shape:()=>t})}return e instanceof fw?new fw({...e._def,type:mw(e.element)}):e instanceof Ow?Ow.create(mw(e.unwrap())):e instanceof Sw?Sw.create(mw(e.unwrap())):e instanceof ww?ww.create(e.items.map((e=>mw(e)))):e}fw.create=(e,t)=>new fw({type:e,minLength:null,maxLength:null,exactLength:null,typeName:$w.ZodArray,...Nb(t)});class gw extends jb{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=db.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==fb.object){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.object,received:t.parsedType}),Ab}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof dw&&"strip"===this._def.unknownKeys))for(const e in n.data)i.includes(e)||a.push(e);const s=[];for(const e of i){const t=r[e],i=n.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new Ob(n,i,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof dw){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of a)s.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)a.length>0&&(_b(n,{code:gb.unrecognized_keys,keys:a}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of a){const r=n.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new Ob(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of s){const n=await t.key,r=await t.value;e.push({key:n,value:r,alwaysSet:t.alwaysSet})}return e})).then((e=>kb.mergeObjectSync(t,e))):kb.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return wb.errToObj,new gw({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{const r=this._def.errorMap?.(t,n).message??n.defaultError;return"unrecognized_keys"===t.code?{message:wb.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new gw({...this._def,unknownKeys:"strip"})}passthrough(){return new gw({...this._def,unknownKeys:"passthrough"})}extend(e){return new gw({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new gw({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:$w.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new gw({...this._def,catchall:e})}pick(e){const t={};for(const n of db.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new gw({...this._def,shape:()=>t})}omit(e){const t={};for(const n of db.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new gw({...this._def,shape:()=>t})}deepPartial(){return mw(this)}partial(e){const t={};for(const n of db.objectKeys(this.shape)){const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}return new gw({...this._def,shape:()=>t})}required(e){const t={};for(const n of db.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof Ow;)e=e._def.innerType;t[n]=e}return new gw({...this._def,shape:()=>t})}keyof(){return Tw(db.objectKeys(this.shape))}}gw.create=(e,t)=>new gw({shape:()=>e,unknownKeys:"strip",catchall:dw.create(),typeName:$w.ZodObject,...Nb(t)}),gw.strictCreate=(e,t)=>new gw({shape:()=>e,unknownKeys:"strict",catchall:dw.create(),typeName:$w.ZodObject,...Nb(t)}),gw.lazycreate=(e,t)=>new gw({shape:e,unknownKeys:"strip",catchall:dw.create(),typeName:$w.ZodObject,...Nb(t)});class yw extends jb{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map((async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map((e=>new yb(e.ctx.common.issues)));return _b(t,{code:gb.invalid_union,unionErrors:n}),Ab}));{let e;const r=[];for(const i of n){const n={...t,common:{...t.common,issues:[]},parent:null},a=i._parseSync({data:t.data,path:t.path,parent:n});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const i=r.map((e=>new yb(e)));return _b(t,{code:gb.invalid_union,unionErrors:i}),Ab}}get options(){return this._def.options}}function vw(e,t){const n=mb(e),r=mb(t);if(e===t)return{valid:!0,data:e};if(n===fb.object&&r===fb.object){const n=db.objectKeys(t),r=db.objectKeys(e).filter((e=>-1!==n.indexOf(e))),i={...e,...t};for(const n of r){const r=vw(e[n],t[n]);if(!r.valid)return{valid:!1};i[n]=r.data}return{valid:!0,data:i}}if(n===fb.array&&r===fb.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const i=vw(e[r],t[r]);if(!i.valid)return{valid:!1};n.push(i.data)}return{valid:!0,data:n}}return n===fb.date&&r===fb.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}yw.create=(e,t)=>new yw({options:e,typeName:$w.ZodUnion,...Nb(t)});class bw extends jb{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(Ib(e)||Ib(r))return Ab;const i=vw(e.value,r.value);return i.valid?((Eb(e)||Eb(r))&&t.dirty(),{status:t.value,value:i.data}):(_b(n,{code:gb.invalid_intersection_types}),Ab)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then((([e,t])=>r(e,t))):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}bw.create=(e,t,n)=>new bw({left:e,right:t,typeName:$w.ZodIntersection,...Nb(n)});class ww extends jb{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==fb.array)return _b(n,{code:gb.invalid_type,expected:fb.array,received:n.parsedType}),Ab;if(n.data.length<this._def.items.length)return _b(n,{code:gb.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ab;!this._def.rest&&n.data.length>this._def.items.length&&(_b(n,{code:gb.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map(((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new Ob(n,e,n.path,t)):null})).filter((e=>!!e));return n.common.async?Promise.all(r).then((e=>kb.mergeArray(t,e))):kb.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new ww({...this._def,rest:e})}}ww.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ww({items:e,typeName:$w.ZodTuple,rest:null,...Nb(t)})};class _w extends jb{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==fb.map)return _b(n,{code:gb.invalid_type,expected:fb.map,received:n.parsedType}),Ab;const r=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map((([e,t],a)=>({key:r._parse(new Ob(n,e,n.path,[a,"key"])),value:i._parse(new Ob(n,t,n.path,[a,"value"]))})));if(n.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const n of a){const r=await n.key,i=await n.value;if("aborted"===r.status||"aborted"===i.status)return Ab;"dirty"!==r.status&&"dirty"!==i.status||t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const n of a){const r=n.key,i=n.value;if("aborted"===r.status||"aborted"===i.status)return Ab;"dirty"!==r.status&&"dirty"!==i.status||t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}}}}_w.create=(e,t,n)=>new _w({valueType:t,keyType:e,typeName:$w.ZodMap,...Nb(n)});class kw extends jb{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==fb.set)return _b(n,{code:gb.invalid_type,expected:fb.set,received:n.parsedType}),Ab;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(_b(n,{code:gb.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(_b(n,{code:gb.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const i=this._def.valueType;function a(e){const n=new Set;for(const r of e){if("aborted"===r.status)return Ab;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const s=[...n.data.values()].map(((e,t)=>i._parse(new Ob(n,e,n.path,t))));return n.common.async?Promise.all(s).then((e=>a(e))):a(s)}min(e,t){return new kw({...this._def,minSize:{value:e,message:wb.toString(t)}})}max(e,t){return new kw({...this._def,maxSize:{value:e,message:wb.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}kw.create=(e,t)=>new kw({valueType:e,minSize:null,maxSize:null,typeName:$w.ZodSet,...Nb(t)});class Aw extends jb{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Aw.create=(e,t)=>new Aw({getter:e,typeName:$w.ZodLazy,...Nb(t)});class Pw extends jb{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return _b(t,{received:t.data,code:gb.invalid_literal,expected:this._def.value}),Ab}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Tw(e,t){return new Iw({values:e,typeName:$w.ZodEnum,...Nb(t)})}Pw.create=(e,t)=>new Pw({value:e,typeName:$w.ZodLiteral,...Nb(t)});class Iw extends jb{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return _b(t,{expected:db.joinValues(n),received:t.parsedType,code:gb.invalid_type}),Ab}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return _b(t,{received:t.data,code:gb.invalid_enum_value,options:n}),Ab}return Tb(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Iw.create(e,{...this._def,...t})}exclude(e,t=this._def){return Iw.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}Iw.create=Tw;class Ew extends jb{_parse(e){const t=db.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==fb.string&&n.parsedType!==fb.number){const e=db.objectValues(t);return _b(n,{expected:db.joinValues(e),received:n.parsedType,code:gb.invalid_type}),Ab}if(this._cache||(this._cache=new Set(db.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=db.objectValues(t);return _b(n,{received:n.data,code:gb.invalid_enum_value,options:e}),Ab}return Tb(e.data)}get enum(){return this._def.values}}Ew.create=(e,t)=>new Ew({values:e,typeName:$w.ZodNativeEnum,...Nb(t)});class xw extends jb{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==fb.promise&&!1===t.common.async)return _b(t,{code:gb.invalid_type,expected:fb.promise,received:t.parsedType}),Ab;const n=t.parsedType===fb.promise?t.data:Promise.resolve(t.data);return Tb(n.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}xw.create=(e,t)=>new xw({type:e,typeName:$w.ZodPromise,...Nb(t)});class Cw extends jb{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===$w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:e=>{_b(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===r.type){const e=r.transform(n.data,i);if(n.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return Ab;const r=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===r.status?Ab:"dirty"===r.status||"dirty"===t.value?Pb(r.value):r}));{if("aborted"===t.value)return Ab;const r=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===r.status?Ab:"dirty"===r.status||"dirty"===t.value?Pb(r.value):r}}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,i);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?Ab:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((n=>"aborted"===n.status?Ab:("dirty"===n.status&&t.dirty(),e(n.value).then((()=>({status:t.value,value:n.value}))))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!xb(e))return Ab;const a=r.transform(e.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((e=>xb(e)?Promise.resolve(r.transform(e.value,i)).then((e=>({status:t.value,value:e}))):Ab))}db.assertNever(r)}}Cw.create=(e,t,n)=>new Cw({schema:e,typeName:$w.ZodEffects,effect:t,...Nb(n)}),Cw.createWithPreprocess=(e,t,n)=>new Cw({schema:t,effect:{type:"preprocess",transform:e},typeName:$w.ZodEffects,...Nb(n)});class Ow extends jb{_parse(e){return this._getType(e)===fb.undefined?Tb(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ow.create=(e,t)=>new Ow({innerType:e,typeName:$w.ZodOptional,...Nb(t)});class Sw extends jb{_parse(e){return this._getType(e)===fb.null?Tb(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Sw.create=(e,t)=>new Sw({innerType:e,typeName:$w.ZodNullable,...Nb(t)});class Nw extends jb{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===fb.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Nw.create=(e,t)=>new Nw({innerType:e,typeName:$w.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Nb(t)});class jw extends jb{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Cb(r)?r.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new yb(n.common.issues)},input:n.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new yb(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}jw.create=(e,t)=>new jw({innerType:e,typeName:$w.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Nb(t)});class Dw extends jb{_parse(e){if(this._getType(e)!==fb.nan){const t=this._getOrReturnCtx(e);return _b(t,{code:gb.invalid_type,expected:fb.nan,received:t.parsedType}),Ab}return{status:"valid",value:e.data}}}Dw.create=e=>new Dw({typeName:$w.ZodNaN,...Nb(e)}),Symbol("zod_brand");class Rw extends jb{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Lw extends jb{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Ab:"dirty"===e.status?(t.dirty(),Pb(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Ab:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new Lw({in:e,out:t,typeName:$w.ZodPipeline})}}class Mw extends jb{_parse(e){const t=this._def.innerType._parse(e),n=e=>(xb(e)&&(e.value=Object.freeze(e.value)),e);return Cb(t)?t.then((e=>n(e))):n(t)}unwrap(){return this._def.innerType}}var $w;Mw.create=(e,t)=>new Mw({innerType:e,typeName:$w.ZodReadonly,...Nb(t)}),gw.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}($w||($w={}));const Fw=tw.create,Vw=rw.create,zw=(Dw.create,iw.create,aw.create,sw.create,ow.create,lw.create,uw.create,cw.create),Bw=(hw.create,dw.create,pw.create,fw.create),Uw=gw.create,Hw=(gw.strictCreate,yw.create,bw.create,ww.create,_w.create,kw.create,Aw.create,Pw.create,Iw.create,Ew.create,xw.create,Cw.create,Ow.create,Sw.create,Cw.createWithPreprocess,Lw.create,{randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)});let Gw;const qw=new Uint8Array(16);function Kw(){if(!Gw&&(Gw="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Gw))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Gw(qw)}const Ww=[];for(let e=0;e<256;++e)Ww.push((e+256).toString(16).slice(1));const Jw=function(e,t,n){if(Hw.randomUUID&&!t&&!e)return Hw.randomUUID();const r=(e=e||{}).random||(e.rng||Kw)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return Ww[e[t+0]]+Ww[e[t+1]]+Ww[e[t+2]]+Ww[e[t+3]]+"-"+Ww[e[t+4]]+Ww[e[t+5]]+"-"+Ww[e[t+6]]+Ww[e[t+7]]+"-"+Ww[e[t+8]]+Ww[e[t+9]]+"-"+Ww[e[t+10]]+Ww[e[t+11]]+Ww[e[t+12]]+Ww[e[t+13]]+Ww[e[t+14]]+Ww[e[t+15]]}(r)};class Zw{}class Qw extends Zw{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,hv(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"true"!==$v("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.awaitHandlers=e._awaitHandler??this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return dv.prototype.toJSON.call(this)}toJSONNotImplemented(){return dv.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends Qw{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Jw()}),Object.assign(this,e)}}}}var Xw=i(749);function Yw(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class e_ extends Qw{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`\n\n${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){const t=function(e,t,n){const r=n.toFixed(0).slice(0,3).padStart(3,"0");return function(e){return e.replace(/[-:.]/g,"")}(`${new Date(e).toISOString().slice(0,-1)}${r}Z`)+t}(e.start_time,e.id,e.execution_order),n={...e};if(void 0!==n.parent_run_id){const e=this.runMap.get(n.parent_run_id);e&&(this._addChildRun(e,n),e.child_execution_order=Math.max(e.child_execution_order,n.child_execution_order),n.trace_id=e.trace_id,void 0!==e.dotted_order&&(n.dotted_order=[e.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;this.runMap.set(n.id,n),await(this.onRunCreate?.(n))}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,n,r,i,a,s,o){const l=this._getExecutionOrder(r),u=Date.now(),c=s?{...i,metadata:s}:i,h={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:a||[]};return await this._startTrace(h),await(this.onLLMStart?.(h)),h}async handleChatModelStart(e,t,n,r,i,a,s,o){const l=this._getExecutionOrder(r),u=Date.now(),c=s?{...i,metadata:s}:i,h={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:a||[]};return await this._startTrace(h),await(this.onLLMStart?.(h)),h}async handleLLMEnd(e,t){const n=this.runMap.get(t);if(!n||"llm"!==n?.run_type)throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onLLMEnd?.(n)),await this._endTrace(n),n}async handleLLMError(e,t){const n=this.runMap.get(t);if(!n||"llm"!==n?.run_type)throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onLLMError?.(n)),await this._endTrace(n),n}async handleChainStart(e,t,n,r,i,a,s,o){const l=this._getExecutionOrder(r),u=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(c),await(this.onChainStart?.(c)),c}async handleChainEnd(e,t,n,r,i){const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Yw(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),void 0!==i?.inputs&&(a.inputs=Yw(i.inputs,"input")),await(this.onChainEnd?.(a)),await this._endTrace(a),a}async handleChainError(e,t,n,r,i){const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),void 0!==i?.inputs&&(a.inputs=Yw(i.inputs,"input")),await(this.onChainError?.(a)),await this._endTrace(a),a}async handleToolStart(e,t,n,r,i,a,s){const o=this._getExecutionOrder(r),l=Date.now(),u={id:n,name:s??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(u),await(this.onToolStart?.(u)),u}async handleToolEnd(e,t){const n=this.runMap.get(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onToolEnd?.(n)),await this._endTrace(n),n}async handleToolError(e,t){const n=this.runMap.get(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onToolError?.(n)),await this._endTrace(n),n}async handleAgentAction(e,t){const n=this.runMap.get(t);if(!n||"chain"!==n?.run_type)return;const r=n;r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(n))}async handleAgentEnd(e,t){const n=this.runMap.get(t);n&&"chain"===n?.run_type&&(n.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(n)))}async handleRetrieverStart(e,t,n,r,i,a,s){const o=this._getExecutionOrder(r),l=Date.now(),u={id:n,name:s??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(u),await(this.onRetrieverStart?.(u)),u}async handleRetrieverEnd(e,t){const n=this.runMap.get(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverEnd?.(n)),await this._endTrace(n),n}async handleRetrieverError(e,t){const n=this.runMap.get(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverError?.(n)),await this._endTrace(n),n}async handleText(e,t){const n=this.runMap.get(t);n&&"chain"===n?.run_type&&(n.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(n)))}async handleLLMNewToken(e,t,n,r,i,a){const s=this.runMap.get(n);if(!s||"llm"!==s?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await(this.onLLMNewToken?.(s,e,{chunk:a?.chunk})),s}}function t_(e,t){return`${e.open}${t}${e.close}`}function n_(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function r_(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:i_}=Xw;class a_ extends e_{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const e=this.runMap.get(n.parent_run_id);if(!e)break;t.push(e),n=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,n)=>{const r=`${e.execution_order}:${e.run_type}:${e.name}`;return t===n.length-1?t_(Xw.bold,r):r})).join(" > ");return t_(i_.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.green,"[chain/start]")} [${t}] Entering Chain run with input: ${n_(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.cyan,"[chain/end]")} [${t}] [${r_(e)}] Exiting Chain run with output: ${n_(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.red,"[chain/error]")} [${t}] [${r_(e)}] Chain run errored with error: ${n_(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${t_(i_.green,"[llm/start]")} [${t}] Entering LLM run with input: ${n_(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.cyan,"[llm/end]")} [${t}] [${r_(e)}] Exiting LLM run with output: ${n_(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.red,"[llm/error]")} [${t}] [${r_(e)}] LLM run errored with error: ${n_(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.cyan,"[tool/end]")} [${t}] [${r_(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.red,"[tool/error]")} [${t}] [${r_(e)}] Tool run errored with error: ${n_(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${n_(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.cyan,"[retriever/end]")} [${t}] [${r_(e)}] Exiting Retriever run with output: ${n_(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${t_(i_.red,"[retriever/error]")} [${t}] [${r_(e)}] Retriever run errored with error: ${n_(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${t_(i_.blue,"[agent/action]")} [${n}] Agent selected action: ${n_(t.actions[t.actions.length-1],"[action]")}`)}}const s_=[400,401,403,404,405,406,407,408],o_=[409];class l_{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.queue=new Yv.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add((()=>Xv((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response,r=t?.status;if(r){if(s_.includes(+r))throw e;if(o_.includes(+r))return;n&&await n(t)}},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise(((t,n)=>{e.signal?.addEventListener("abort",(()=>{n(new Error("AbortError"))}))}))]):this.call(t,...n)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}function u_(e){return"function"==typeof e?._getType}function c_(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}let h_;const d_=()=>"undefined"!=typeof Deno;let p_,f_;function m_(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}const g_=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,y_=function(e){return"string"==typeof e&&g_.test(e)};function v_(e){if(!y_(e))throw new Error(`Invalid UUID: ${e}`)}async function b_(e){const t=await async function(){if(void 0===p_){const e=h_||(h_="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||d_()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":d_()?"deno":"other":"node",h_),t=function(){if(void 0!==f_)return f_;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const n of e){const e=m_(n);void 0!==e&&(t[n]=e)}return f_=t,t}();p_={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:T_,...t}}return p_}(),n=function(){const e=function(){try{return"undefined"!=typeof process&&process.env?Object.entries(process.env).reduce(((e,[t,n])=>(e[t]=String(n),e)),{}):void 0}catch(e){return}}()||{},t={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,i]of Object.entries(e))!r.startsWith("LANGCHAIN_")||"string"!=typeof i||n.includes(r)||r.toLowerCase().includes("key")||r.toLowerCase().includes("secret")||r.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===r?t.revision_id=i:t[r]=i);return t}();return e.map((e=>{const r=e.extra??{},i=r.metadata;return e.extra={...r,runtime:{...t,...r?.runtime},metadata:{...n,...n.revision_id||e.revision_id?{revision_id:e.revision_id??n.revision_id}:{},...i}},e}))}const w_=async(e,t)=>{const n=await e.text();if(!e.ok)throw new Error(`Failed to ${t}: ${e.status} ${e.statusText} ${n}`)};function __(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const k_=async e=>{if(429===e?.status){const t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise((e=>setTimeout(e,t))),!0}return!1};class A_{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise((t=>{this.items.push([e,t])}))}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");const t=[];for(;t.length<e&&this.items.length;){const e=this.items.shift();if(!e)break;t.push(e)}return[t.map((e=>e[0])),()=>t.forEach((e=>e[1]()))]}}class P_{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new A_}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=P_.getDefaultClientConfig();this.tracingSampleRate=(()=>{const e=m_("LANGCHAIN_TRACING_SAMPLING_RATE");if(void 0===e)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t})(),this.apiUrl=__(e.apiUrl??t.apiUrl)??"",this.apiKey=__(e.apiKey??t.apiKey),this.webUrl=__(e.webUrl??t.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new l_(e.callerOptions??{}),this.batchIngestCaller=new l_({...e.callerOptions??{},onFailedResponseHook:k_}),this.hideInputs=e.hideInputs??t.hideInputs,this.hideOutputs=e.hideOutputs??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=m_("LANGCHAIN_API_KEY");return{apiUrl:m_("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===m_("LANGCHAIN_HIDE_INPUTS"),hideOutputs:"true"===m_("LANGCHAIN_HIDE_OUTPUTS")}}getHostUrl(){return this.webUrl?this.webUrl:(e=>{const t=this.apiUrl.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t})()?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${T_}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=t?.toString()??"",r=`${this.apiUrl}${e}?${n}`,i=await this.caller.call(fetch,r,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let n=Number(t.get("offset"))||0;const r=Number(t.get("limit"))||100;for(;;){t.set("offset",String(n)),t.set("limit",String(r));const i=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);const s=await a.json();if(0===s.length)break;if(yield s,s.length<r)break;n+=s.length}}async*_getCursorPaginatedList(e,t=null,n="POST",r="runs"){const i=t?{...t}:{};for(;;){const t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)}),a=await t.json();if(!a)break;if(!a[r])break;yield a[r];const s=a.cursors;if(!s)break;if(!s.next)break;i.cursor=s.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){const t=[];for(const n of e)this.sampledPostUuids.has(n.id)&&(t.push(n),this.sampledPostUuids.delete(n.id));return t}{const t=[];for(const n of e)Math.random()<this.tracingSampleRate&&(t.push(n),this.sampledPostUuids.add(n.id));return t}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){const[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length)return void t();try{await this.batchIngestRuns({runCreates:e.filter((e=>"create"===e.action)).map((e=>e.item)),runUpdates:e.filter((e=>"update"===e.action)).map((e=>e.item))})}finally{t()}}}async processRunOperation(e,t){const n=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;const r=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout((()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)}),n?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),r}async _getServerInfo(){const e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),new Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch(e){return!1}return!0}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const r=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order)return void this.processRunOperation({action:"create",item:r}).catch(console.error);const i=await b_([r]),a=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(i[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await w_(a,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let n=e?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[],r=t?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[];if(n.length>0&&r.length>0){const e=n.reduce(((e,t)=>t.id?(e[t.id]=t,e):e),{}),t=[];for(const n of r)void 0!==n.id&&e[n.id]?e[n.id]={...e[n.id],...n}:t.push(n);n=Object.values(e),r=t}const i={post:this._filterForSampling(n),patch:this._filterForSampling(r,!0)};if(!i.post.length&&!i.patch.length)return;if(n=await b_(n),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const e of i.post)await this.createRun(e);for(const e of i.patch)void 0!==e.id&&await this.updateRun(e.id,e);return}const a=this.serverInfo?.batch_ingest_config?.size_limit_bytes??20971520,s={post:[],patch:[]};let o=0;for(const e of["post","patch"]){const t=e,n=i[t].reverse();let r=n.pop();for(;void 0!==r;){const e=JSON.stringify(r);o>0&&o+e.length>a&&(await this._postBatchIngestRuns(JSON.stringify(s)),o=0,s.post=[],s.patch=[]),o+=e.length,s[t].push(r),r=n.pop()}}(s.post.length>0||s.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(s))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await w_(n,"batch create run")}async updateRun(e,t){v_(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&void 0!==n.trace_id&&void 0!==n.dotted_order)return void 0!==t.end_time&&void 0===n.parent_run_id?void await this.processRunOperation({action:"update",item:n},!0):void this.processRunOperation({action:"update",item:n}).catch(console.error);const r={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await w_(i,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){v_(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(void 0!==t){let e;e=t.session_id?t.session_id:n?.projectName?(await this.readProject({projectName:n?.projectName})).id:n?.projectId?n?.projectId:(await this.readProject({projectName:m_("LANGCHAIN_PROJECT")||"default"})).id;const r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(this.listRuns({id:e.child_run_ids})),n={},r={};t.sort(((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in n||(n[e.parent_run_id]=[]),n[e.parent_run_id].push(e),r[e.id]=e}e.child_runs=n[e.id]||[];for(const t in n)t!==e.id&&(r[t].child_runs=n[t]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:r,traceId:i,referenceExampleId:a,startTime:s,executionOrder:o,isRoot:l,runType:u,error:c,id:h,query:d,filter:p,traceFilter:f,treeFilter:m,limit:g,select:y}=e;let v=[];if(t&&(v=Array.isArray(t)?t:[t]),n){const e=Array.isArray(n)?n:[n],t=await Promise.all(e.map((e=>this.readProject({projectName:e}).then((e=>e.id)))));v.push(...t)}const b={session:v.length?v:null,run_type:u,reference_example:a,query:d,filter:p,trace_filter:f,tree_filter:m,execution_order:o,parent_run:r,start_time:s?s.toISOString():null,error:c,id:h,limit:g,trace:i,select:y||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l};let w=0;for await(const e of this._getCursorPaginatedList("/runs/query",b))if(g){if(w>=g)break;if(e.length+w>g){const t=e.slice(0,g-w);yield*t;break}w+=e.length,yield*e}else yield*e}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||Jw()};v_(e);const r=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await r.json();if(null===i||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){v_(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await w_(t,"unshare run")}async readRunSharedLink(e){v_(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(null!==n&&"share_token"in n)return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)n.append("id",e);v_(e);const r=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await r.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),v_(e);const n=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await n.json();return r.url=`${this.getHostUrl()}/public/${r.share_token}/d`,r}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};v_(e);const r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await r.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){v_(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await w_(t,"unshare dataset")}async readSharedDataset(e){v_(e);const t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:r=!1,projectExtra:i=null,referenceDatasetId:a=null}){const s=r?"?upsert=true":"",o=`${this.apiUrl}/sessions${s}`,l=i||{};n&&(l.metadata=n);const u={name:e,extra:l,description:t};null!==a&&(u.reference_dataset_id=a);const c=await this.caller.call(fetch,o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),h=await c.json();if(!c.ok)throw new Error(`Failed to create session ${e}: ${c.status} ${c.statusText}`);return h}async updateProject(e,{name:t=null,description:n=null,metadata:r=null,projectExtra:i=null,endTime:a=null}){const s=`${this.apiUrl}/sessions/${e}`;let o=i;r&&(o={...o||{},metadata:r});const l={name:t,extra:o,description:n,end_time:a?new Date(a).toISOString():null},u=await this.caller.call(fetch,s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),c=await u.json();if(!u.ok)throw new Error(`Failed to update project ${e}: ${u.status} ${u.statusText}`);return c}async hasProject({projectId:e,projectName:t}){let n="/sessions";const r=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)v_(e),n+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");r.append("name",t)}const i=await this.caller.call(fetch,`${this.apiUrl}${n}?${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const e=await i.json();return!!i.ok&&(!Array.isArray(e)||e.length>0)}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let r="/sessions";const i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)v_(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");i.append("name",t)}void 0!==n&&i.append("include_stats",n.toString());const a=await this._get(r,i);let s;if(Array.isArray(a)){if(0===a.length)throw new Error(`Project[id=${e}, name=${t}] not found`);s=a[0]}else s=a;return s}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/datasets/${n.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:r,referenceDatasetName:i,referenceFree:a}={}){const s=new URLSearchParams;if(void 0!==e)for(const t of e)s.append("id",t);if(void 0!==t&&s.append("name",t),void 0!==n&&s.append("name_contains",n),void 0!==r)s.append("reference_dataset",r);else if(void 0!==i){const e=await this.readDataset({datasetName:i});s.append("reference_dataset",e.id)}void 0!==a&&s.append("reference_free",a.toString());for await(const e of this._getPaginated("/sessions",s))yield*e}async deleteProject({projectId:e,projectName:t}){let n;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");n=void 0===e?(await this.readProject({projectName:t})).id:e,v_(n);const r=await this.caller.call(fetch,`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await w_(r,`delete session ${n} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:r,description:i,dataType:a,name:s}){const o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),n.forEach((e=>{l.append("input_keys",e)})),r.forEach((e=>{l.append("output_keys",e)})),i&&l.append("description",i),a&&l.append("data_type",a),s&&l.append("name",s);const u=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!u.ok){const e=await u.json();if(e.detail&&e.detail.includes("already exists"))throw new Error(`Dataset ${t} already exists`);throw new Error(`Failed to upload CSV: ${u.status} ${u.statusText}`)}return await u.json()}async createDataset(e,{description:t,dataType:n}={}){const r={name:e,description:t};n&&(r.data_type=n);const i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok){const t=await i.json();if(t.detail&&t.detail.includes("already exists"))throw new Error(`Dataset ${e} already exists`);throw new Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const r=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)v_(e),n+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");r.append("name",t)}const i=await this._get(n,r);let a;if(Array.isArray(i)){if(0===i.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:r}){let i=e;if(void 0===i&&void 0===t)throw new Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:"string"==typeof n?n:n.toISOString(),to_version:"string"==typeof r?r:r.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const n=await this._getResponse(`/datasets/${e}/openai_ft`);return(await n.text()).trim().split("\n").map((e=>JSON.parse(e)))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:r,datasetNameContains:i}={}){const a=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==n)for(const e of n)a.append("id",e);void 0!==r&&a.append("name",r),void 0!==i&&a.append("name_contains",i);for await(const e of this._getPaginated("/datasets",a))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",r=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(r=(await this.readDataset({datasetName:t})).id),void 0===r)throw new Error("Must provide datasetName or datasetId");v_(r),n+=`/${r}`;const i=await this.caller.call(fetch,this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to delete ${n}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:n,datasetName:r,createdAt:i,exampleId:a,metadata:s,split:o}){let l=n;if(void 0===l&&void 0===r)throw new Error("Must provide either datasetName or datasetId");if(void 0!==l&&void 0!==r)throw new Error("Must provide either datasetName or datasetId, not both");void 0===l&&(l=(await this.readDataset({datasetName:r})).id);const u=i||new Date,c={dataset_id:l,inputs:e,outputs:t,created_at:u?.toISOString(),id:a,metadata:s,split:o},h=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!h.ok)throw new Error(`Failed to create example: ${h.status} ${h.statusText}`);return await h.json()}async createExamples(e){const{inputs:t,outputs:n,metadata:r,sourceRunIds:i,exampleIds:a,datasetId:s,datasetName:o}=e;let l=s;if(void 0===l&&void 0===o)throw new Error("Must provide either datasetName or datasetId");if(void 0!==l&&void 0!==o)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===l){const e=await this.readDataset({datasetName:o});l=e.id}const u=t.map(((t,s)=>({dataset_id:l,inputs:t,outputs:n?n[s]:void 0,metadata:r?r[s]:void 0,split:e.splits?e.splits[s]:void 0,id:a?a[s]:void 0,source_run_id:i?i[s]:void 0}))),c=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!c.ok)throw new Error(`Failed to create examples: ${c.status} ${c.statusText}`);return await c.json()}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const r=e.map((e=>u_(e)?c_(e):e)),i=u_(t)?c_(t):t;return this.createExample({input:r},{output:i},n)}async readExample(e){v_(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:r,splits:i,inlineS3Urls:a,metadata:s}={}){let o;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)o=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");o=(await this.readDataset({datasetName:t})).id}const l=new URLSearchParams({dataset:o}),u=r?"string"==typeof r?r:r?.toISOString():void 0;u&&l.append("as_of",u);const c=a??!0;if(l.append("inline_s3_urls",c.toString()),void 0!==n)for(const e of n)l.append("id",e);if(void 0!==i)for(const e of i)l.append("splits",e);if(void 0!==s){const e=JSON.stringify(s);l.append("metadata",e)}for await(const e of this._getPaginated("/examples",l))yield*e}async deleteExample(e){v_(e);const t=`/examples/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async updateExample(e,t){v_(e);const n=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to update example ${e}: ${n.status} ${n.statusText}`);return await n.json()}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:r,referenceExample:i}={loadChildRuns:!1}){let a;if("string"==typeof e)a=await this.readRun(e,{loadChildRuns:r});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);a=e}null!==a.reference_example_id&&void 0!==a.reference_example_id&&(i=await this.readExample(a.reference_example_id));const s=await t.evaluateRun(a,i);let o=n??{};s.evaluatorInfo&&(o={...o,...s.evaluatorInfo});const l=s.targetRunId??a.id;return await this.createFeedback(l,s.key,{score:s?.score,value:s?.value,comment:s?.comment,correction:s?.correction,sourceInfo:o,feedbackSourceType:"model",sourceRunId:s?.sourceRunId})}async createFeedback(e,t,{score:n,value:r,correction:i,comment:a,sourceInfo:s,feedbackSourceType:o="api",sourceRunId:l,feedbackId:u,feedbackConfig:c,projectId:h,comparativeExperimentId:d}){if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const p={type:o??"api",metadata:s??{}};void 0===l||void 0===p?.metadata||p.metadata.__run||(p.metadata.__run={run_id:l}),void 0!==p?.metadata&&void 0!==p.metadata.__run?.run_id&&v_(p.metadata.__run.run_id);const f={id:u??Jw(),run_id:e,key:t,score:n,value:r,correction:i,comment:a,feedback_source:p,comparative_experiment_id:d,feedbackConfig:c,session_id:h},m=`${this.apiUrl}/feedback`,g=await this.caller.call(fetch,m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await w_(g,"create feedback"),f}async updateFeedback(e,{score:t,value:n,correction:r,comment:i}){const a={};null!=t&&(a.score=t),null!=n&&(a.value=n),null!=r&&(a.correction=r),null!=i&&(a.comment=i),v_(e);const s=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await w_(s,"update feedback")}async readFeedback(e){v_(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){v_(e);const t=`/feedback/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const r=new URLSearchParams;if(e&&r.append("run",e.join(",")),t)for(const e of t)r.append("key",e);if(n)for(const e of n)r.append("source",e);for await(const e of this._getPaginated("/feedback",r))yield*e}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:r}={}){const i={run_id:e,feedback_key:t,feedback_config:r};n?"string"==typeof n?i.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(i.expires_in=n):i.expires_in={hours:3};const a=await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await a.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:r,description:i,metadata:a,id:s}){if(0===t.length)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!n)throw new Error("A reference dataset is required");const o={id:s,name:e,experiment_ids:t,reference_dataset_id:n,description:i,created_at:(r??new Date)?.toISOString(),extra:{}};a&&(o.extra.metadata=a);const l=await this.caller.call(fetch,`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await l.json()}async*listPresignedFeedbackTokens(e){v_(e);const t=new URLSearchParams({run_id:e});for await(const e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){let t;return t="results"in e?e.results:[e],t}async logEvaluationFeedback(e,t,n){const r=this._selectEvalResults(e);for(const e of r){let r=n||{};e.evaluatorInfo&&(r={...e.evaluatorInfo,...r});let i=null;e.targetRunId?i=e.targetRunId:t&&(i=t.id),await this.createFeedback(i,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:r,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"})}return r}}const T_="0.1.30";class I_ extends e_{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:r}=e;this.projectName=n??$v("LANGCHAIN_PROJECT")??$v("LANGCHAIN_SESSION"),this.exampleId=t,this.client=r??new P_({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await Mv()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}}let E_;async function x_(e,t){!0===t?await e():(void 0===E_&&(E_=new(0,Yv.default)({autoStart:!0,concurrency:1})),E_.add(e))}"true"===$v("LANGCHAIN_TRACING_V2")&&"true"!==$v("LANGCHAIN_CALLBACKS_BACKGROUND")&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join("\n");class C_{setHandler(e){return this.setHandlers([e])}}class O_{constructor(e,t,n,r,i,a,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map((t=>x_((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}}),t.awaitHandlers))))}}class S_ extends O_{getChild(e){const t=new R_(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>x_((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>x_((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}}),t.awaitHandlers))))}}class N_ extends O_{async handleLLMNewToken(e,t,n,r,i,a){await Promise.all(this.handlers.map((n=>x_((async()=>{if(!n.ignoreLLM)try{await(n.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMNewToken: ${e}`)}}),n.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>x_((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>x_((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}}),t.awaitHandlers))))}}class j_ extends O_{getChild(e){const t=new R_(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,r,i){await Promise.all(this.handlers.map((t=>x_((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}}),t.awaitHandlers))))}async handleChainEnd(e,t,n,r,i){await Promise.all(this.handlers.map((t=>x_((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>x_((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>x_((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}}),t.awaitHandlers))))}}class D_ extends O_{getChild(e){const t=new R_(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>x_((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>x_((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}}),t.awaitHandlers))))}}class R_ extends C_{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0){return Promise.all(t.map((async(t,r)=>{const a=0===r&&n?n:Jw();return await Promise.all(this.handlers.map((n=>x_((async()=>{if(!n.ignoreLLM)try{await(n.handleLLMStart?.(e,[t],a,this._parentRunId,i,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new N_(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,n=void 0,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0){return Promise.all(t.map((async(t,r)=>{const a=0===r&&n?n:Jw();return await Promise.all(this.handlers.map((n=>x_((async()=>{if(!n.ignoreLLM)try{if(n.handleChatModelStart)await(n.handleChatModelStart?.(e,[t],a,this._parentRunId,i,this.tags,this.metadata,o));else if(n.handleLLMStart){const r=Ov(t);await(n.handleLLMStart?.(e,[r],a,this._parentRunId,i,this.tags,this.metadata,o))}}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new N_(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,n=Jw(),r=void 0,i=void 0,a=void 0,s=void 0){return await Promise.all(this.handlers.map((i=>x_((async()=>{if(!i.ignoreChain)try{await(i.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,r,s))}catch(e){console.error(`Error in handler ${i.constructor.name}, handleChainStart: ${e}`)}}),i.awaitHandlers)))),new j_(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=Jw(),r=void 0,i=void 0,a=void 0,s=void 0){return await Promise.all(this.handlers.map((r=>x_((async()=>{if(!r.ignoreAgent)try{await(r.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,s))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleToolStart: ${e}`)}}),r.awaitHandlers)))),new D_(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=Jw(),r=void 0,i=void 0,a=void 0,s=void 0){return await Promise.all(this.handlers.map((r=>x_((async()=>{if(!r.ignoreRetriever)try{await(r.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,s))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleRetrieverStart: ${e}`)}}),r.awaitHandlers)))),new S_(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new R_(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);n.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);n.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);n.addMetadata({[e]:this.metadata[e]},t)}for(const r of e)n.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===r.name))||n.addHandler(r,t);return n}static fromHandlers(e){const t=new this;return t.addHandler(new class extends Qw{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Jw()}),Object.assign(this,e)}}),t}static async configure(e,t,n,r,i,a,s){let o;(e||t)&&(Array.isArray(e)||!e?(o=new R_,o.setHandlers(e?.map(L_)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(L_):t?.handlers,!1));const l="true"===$v("LANGCHAIN_VERBOSE")||s?.verbose,u="true"===$v("LANGCHAIN_TRACING_V2"),c=u||($v("LANGCHAIN_TRACING")??!1);if(l||c){if(o||(o=new R_),l&&!o.handlers.some((e=>e.name===a_.prototype.name))){const e=new a_;o.addHandler(e,!0)}c&&!o.handlers.some((e=>"langchain_tracer"===e.name))&&u&&o.addHandler(await async function(){return new I_}(),!0)}return(n||r)&&o&&(o.addTags(n??[]),o.addTags(r??[],!1)),(i||a)&&o&&(o.addMetadata(i??{}),o.addMetadata(a??{},!1)),o}}function L_(e){return"name"in e?e:Qw.fromMethods(e)}const M_=Object.prototype.hasOwnProperty;function $_(e,t){return M_.call(e,t)}function F_(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let n in e)$_(e,n)&&t.push(n);return t}function V_(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function z_(e){let t=0;const n=e.length;let r;for(;t<n;){if(r=e.charCodeAt(t),!(r>=48&&r<=57))return!1;t++}return!0}function B_(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function U_(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function H_(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(H_(e[t]))return!0}else if("object"==typeof e){const n=F_(e),r=n.length;for(var t=0;t<r;t++)if(H_(e[n[t]]))return!0}return!1}function G_(e,t){const n=[e];for(const e in t){const r="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==r&&n.push(`${e}: ${r}`)}return n.join("\n")}class q_ extends Error{constructor(e,t,n,r,i){super(G_(e,{name:t,index:n,operation:r,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=G_(e,{name:t,index:n,operation:r,tree:i})}}const K_=q_,W_=V_,J_={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){let r=Q_(n,this.path);r&&(r=V_(r));const i=X_(n,{op:"remove",path:this.from}).removed;return X_(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){const r=Q_(n,this.from);return X_(n,{op:"add",path:this.path,value:V_(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:rk(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}};var Z_={add:function(e,t,n){return z_(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:J_.move,copy:J_.copy,test:J_.test,_get:J_._get};function Q_(e,t){if(""==t)return e;var n={op:"_get",path:t};return X_(e,n),n.value}function X_(e,t,n=!1,r=!0,i=!0,a=0){if(n&&("function"==typeof n?n(t,0,e,t.path):tk(t,0)),""===t.path){let r={newDocument:e};if("add"===t.op)return r.newDocument=t.value,r;if("replace"===t.op)return r.newDocument=t.value,r.removed=e,r;if("move"===t.op||"copy"===t.op)return r.newDocument=Q_(e,t.from),"move"===t.op&&(r.removed=e),r;if("test"===t.op){if(r.test=rk(e,t.value),!1===r.test)throw new K_("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r.newDocument=e,r}if("remove"===t.op)return r.removed=e,r.newDocument=null,r;if("_get"===t.op)return t.value=e,r;if(n)throw new K_("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return r}{r||(e=V_(e));const s=(t.path||"").split("/");let o,l,u,c=e,h=1,d=s.length;for(u="function"==typeof n?n:tk;;){if(l=s[h],l&&-1!=l.indexOf("~")&&(l=U_(l)),i&&("__proto__"==l||"prototype"==l&&h>0&&"constructor"==s[h-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===o&&(void 0===c[l]?o=s.slice(0,h).join("/"):h==d-1&&(o=t.path),void 0!==o&&u(t,0,e,o)),h++,Array.isArray(c)){if("-"===l)l=c.length;else{if(n&&!z_(l))throw new K_("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);z_(l)&&(l=~~l)}if(h>=d){if(n&&"add"===t.op&&l>c.length)throw new K_("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);const r=Z_[t.op].call(t,c,l,e);if(!1===r.test)throw new K_("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r}}else if(h>=d){const n=J_[t.op].call(t,c,l,e);if(!1===n.test)throw new K_("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return n}if(c=c[l],n&&h<d&&(!c||"object"!=typeof c))throw new K_("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function Y_(e,t,n,r=!0,i=!0){if(n&&!Array.isArray(t))throw new K_("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=V_(e));const a=new Array(t.length);for(let r=0,s=t.length;r<s;r++)a[r]=X_(e,t[r],n,!0,i,r),e=a[r].newDocument;return a.newDocument=e,a}function ek(e,t,n){const r=X_(e,t);if(!1===r.test)throw new K_("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function tk(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new K_("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!J_[e.op])throw new K_("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new K_("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new K_('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new K_("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new K_("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&H_(e.value))throw new K_("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new K_("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new K_("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var s=nk([{op:"_get",path:e.from,value:void 0}],n);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new K_("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function nk(e,t,n){try{if(!Array.isArray(e))throw new K_("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Y_(V_(t),V_(e),n||!0);else{n=n||tk;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof K_)return e;throw e}}function rk(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,a=Array.isArray(e),s=Array.isArray(t);if(a&&s){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!rk(e[n],t[n]))return!1;return!0}if(a!=s)return!1;var o=Object.keys(e);if((r=o.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(o[n]))return!1;for(n=r;0!=n--;)if(!rk(e[i=o[n]],t[i]))return!1;return!0}return e!=e&&t!=t}function ik(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=F_(t),s=F_(e),o=!1,l=s.length-1;l>=0;l--){var u=e[h=s[l]];if(!$_(t,h)||void 0===t[h]&&void 0!==u&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+B_(h),value:V_(u)}),n.push({op:"remove",path:r+"/"+B_(h)}),o=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var c=t[h];"object"==typeof u&&null!=u&&"object"==typeof c&&null!=c&&Array.isArray(u)===Array.isArray(c)?ik(u,c,n,r+"/"+B_(h),i):u!==c&&(i&&n.push({op:"test",path:r+"/"+B_(h),value:V_(u)}),n.push({op:"replace",path:r+"/"+B_(h),value:V_(c)}))}}if(o||a.length!=s.length)for(l=0;l<a.length;l++){var h;$_(e,h=a[l])||void 0===t[h]||n.push({op:"add",path:r+"/"+B_(h),value:V_(t[h])})}}}function ak(e,t,n=!1){var r=[];return ik(e,t,r,"",n),r}new WeakMap;class sk extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new sk({start:e=>function n(){return t.read().then((({done:t,value:r})=>{if(!t)return e.enqueue(r),n();e.close()}))}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new sk({async pull(t){const{value:n,done:r}=await e.next();r&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function ok(e,t=2){const n=Array.from({length:t},(()=>[]));return n.map((async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of n)e.push(t)}else{if(t[0].done)return;yield t.shift().value}}))}function lk(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){const n={...e};for(const[e,r]of Object.entries(t))e in n&&!Array.isArray(n[e])?n[e]=lk(n[e],r):n[e]=r;return n}throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}class uk{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise(((n,r)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(n,r):this.firstResult.then((e=>n(void 0)),r)}))}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}class ck{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=Y_({},t);return new hk({ops:t,state:n[n.length-1].newDocument})}}class hk extends ck{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=Y_(this.state,e.ops);return new hk({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=Y_({},e.ops);return new hk({ops:e.ops,state:t[t.length-1].newDocument})}}async function dk(e,t){if("original"===t)throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=e;return["retriever","llm","prompt"].includes(e.run_type)?n:1!==Object.keys(n).length||""!==n?.input?n.input:void 0}async function pk(e,t){const{outputs:n}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?n:void 0!==n&&1===Object.keys(n).length&&void 0!==n?.output?n.output:n}class fk extends e_{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=sk.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(n=n||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(n=n&&t.every((e=>!this.excludeTags?.includes(e)))),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const t=this.keyMapByRunId[e];t&&await this.writer.write(new ck({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new ck({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(n.inputs=await dk(e,this._schemaFormat)),await this.writer.write(new ck({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const n=[];"streaming_events"===this._schemaFormat&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await dk(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await pk(e,this._schemaFormat)}),void 0!==e.end_time&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const r=new ck({ops:n});await this.writer.write(r)}finally{if(e.id===this.rootId){const t=new ck({ops:[{op:"replace",path:"/final_output",value:await pk(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const r=this.keyMapByRunId[e.id];if(void 0===r)return;let i;i=void 0!==e.inputs.messages?function(e){return void 0!==e&&void 0!==e.message}(n?.chunk)?n?.chunk:new _v(t):t;const a=new ck({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${r}/streamed_output/-`,value:i}]});await this.writer.write(a)}}class mk{getStore(){}run(e,t){return t()}}const gk=new class{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new mk}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}};async function yk(e){return R_.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function vk(...e){const t={};for(const n of e.filter((e=>!!e)))for(const e of Object.keys(n))if("metadata"===e)t[e]={...t[e],...n[e]};else if("tags"===e){const r=t[e]??[];t[e]=[...new Set(r.concat(n[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...n[e]};else if("callbacks"===e){const e=t.callbacks,r=n.callbacks;if(Array.isArray(r))if(e)if(Array.isArray(e))t.callbacks=e.concat(r);else{const n=e.copy();for(const e of r)n.addHandler(L_(e),!0);t.callbacks=n}else t.callbacks=r;else if(r)if(e)if(Array.isArray(e)){const n=r.copy();for(const t of e)n.addHandler(L_(t),!0);t.callbacks=n}else t.callbacks=new R_(r._parentRunId,{handlers:e.handlers.concat(r.handlers),inheritableHandlers:e.inheritableHandlers.concat(r.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(r.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(r.inheritableTags))),metadata:{...e.metadata,...r.metadata}});else t.callbacks=r}else{const r=e;t[r]=n[r]??t[r]}return t}const bk=new Set(["string","number","boolean"]);function wk(e){const t=e??gk.getInstance().getStore();let n={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(t&&(n={...n,...t}),t?.configurable)for(const e of Object.keys(t.configurable))bk.has(typeof t.configurable[e])&&!n.metadata?.[e]&&(n.metadata||(n.metadata={}),n.metadata[e]=t.configurable[e]);return n}function _k(e={},{callbacks:t,maxConcurrency:n,recursionLimit:r,runName:i,configurable:a,runId:s}={}){const o=wk(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==r&&(o.recursionLimit=r),void 0!==n&&(o.maxConcurrency=n),void 0!==i&&(o.runName=i),void 0!==a&&(o.configurable={...o.configurable,...a}),void 0!==s&&delete o.runId,o}class kk extends e_{constructor({config:e,onStart:t,onEnd:n,onError:r}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=r}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}function Ak(e){return!!e&&e.lc_runnable}class Pk{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags;const r=e.tags??[];return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(t)),void 0!==this.includeTags&&(n=n||r.some((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(n=n&&r.every((e=>!this.excludeTags?.includes(e)))),n}}const Tk=Symbol("Let zodToJsonSchema decide on which parser to use"),Ik={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Ek=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};function xk(e){if("openAi"!==e.target)return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?Ek(t,e.currentPath):t.join("/")}}function Ck(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Ok(e,t,n,r,i){e[t]=n,Ck(e,t,r,i)}function Sk(e,t){return Kk(e.type._def,t)}function Nk(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map(((n,r)=>Nk(e,t,n)))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return jk(e,t)}}const jk=(e,t)=>{const n={type:"integer",format:"unix-time"};if("openApi3"===t.target)return n;for(const r of e.checks)switch(r.kind){case"min":Ok(n,"minimum",r.value,r.message,t);break;case"max":Ok(n,"maximum",r.value,r.message,t)}return n};let Dk;const Rk={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===Dk&&(Dk=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Dk),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Lk(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":Ok(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":Ok(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Fk(n,"email",r.message,t);break;case"format:idn-email":Fk(n,"idn-email",r.message,t);break;case"pattern:zod":Vk(n,Rk.email,r.message,t)}break;case"url":Fk(n,"uri",r.message,t);break;case"uuid":Fk(n,"uuid",r.message,t);break;case"regex":Vk(n,r.regex,r.message,t);break;case"cuid":Vk(n,Rk.cuid,r.message,t);break;case"cuid2":Vk(n,Rk.cuid2,r.message,t);break;case"startsWith":Vk(n,RegExp(`^${Mk(r.value,t)}`),r.message,t);break;case"endsWith":Vk(n,RegExp(`${Mk(r.value,t)}$`),r.message,t);break;case"datetime":Fk(n,"date-time",r.message,t);break;case"date":Fk(n,"date",r.message,t);break;case"time":Fk(n,"time",r.message,t);break;case"duration":Fk(n,"duration",r.message,t);break;case"length":Ok(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value,r.message,t),Ok(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":Vk(n,RegExp(Mk(r.value,t)),r.message,t);break;case"ip":"v6"!==r.version&&Fk(n,"ipv4",r.message,t),"v4"!==r.version&&Fk(n,"ipv6",r.message,t);break;case"base64url":Vk(n,Rk.base64url,r.message,t);break;case"jwt":Vk(n,Rk.jwt,r.message,t);break;case"cidr":"v6"!==r.version&&Vk(n,Rk.ipv4Cidr,r.message,t),"v4"!==r.version&&Vk(n,Rk.ipv6Cidr,r.message,t);break;case"emoji":Vk(n,Rk.emoji(),r.message,t);break;case"ulid":Vk(n,Rk.ulid,r.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":Fk(n,"binary",r.message,t);break;case"contentEncoding:base64":Ok(n,"contentEncoding","base64",r.message,t);break;case"pattern:zod":Vk(n,Rk.base64,r.message,t)}break;case"nanoid":Vk(n,Rk.nanoid,r.message,t)}return n}function Mk(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let n=0;n<e.length;n++)$k.has(e[n])||(t+="\\"),t+=e[n];return t}(e):e}const $k=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Fk(e,t,n,r){e.format||e.anyOf?.some((e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ok(e,"format",t,n,r)}function Vk(e,t,n,r){e.pattern||e.allOf?.some((e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:zk(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ok(e,"pattern",zk(t,r),n,r)}function zk(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const n=e.flags.includes("i"),r=e.flags.includes("m"),i=e.flags.includes("s"),a=n?e.source.toLowerCase():e.source;let s="",o=!1,l=!1,u=!1;for(let e=0;e<a.length;e++)if(o)s+=a[e],o=!1;else{if(n)if(l){if(a[e].match(/[a-z]/)){u?(s+=a[e],s+=`${a[e-2]}-${a[e]}`.toUpperCase(),u=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(s+=a[e],u=!0):s+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){s+=`[${a[e]}${a[e].toUpperCase()}]`;continue}if(r){if("^"===a[e]){s+="(^|(?<=[\r\n]))";continue}if("$"===a[e]){s+="($|(?=[\r\n]))";continue}}i&&"."===a[e]?s+=l?`${a[e]}\r\n`:`[${a[e]}\r\n]`:(s+=a[e],"\\"===a[e]?o=!0:l&&"]"===a[e]?l=!1:l||"["!==a[e]||(l=!0))}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function Bk(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===$w.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((n,r)=>({...n,[r]:Kk(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??xk(t)})),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:Kk(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return n;if(e.keyType?._def.typeName===$w.ZodString&&e.keyType._def.checks?.length){const{type:r,...i}=Lk(e.keyType._def,t);return{...n,propertyNames:i}}if(e.keyType?._def.typeName===$w.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===$w.ZodBranded&&e.keyType._def.type._def.typeName===$w.ZodString&&e.keyType._def.type._def.checks?.length){const{type:r,...i}=Sk(e.keyType._def,t);return{...n,propertyNames:i}}return n}const Uk={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},Hk=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,n)=>Kk(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]}))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return n.length?{anyOf:n}:void 0};function Gk(e){try{return e.isOptional()}catch{return!0}}const qk=(e,t,n)=>{switch(t){case $w.ZodString:return Lk(e,n);case $w.ZodNumber:return function(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",Ck(n,"type",r.message,t);break;case"min":"jsonSchema7"===t.target?r.inclusive?Ok(n,"minimum",r.value,r.message,t):Ok(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ok(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?Ok(n,"maximum",r.value,r.message,t):Ok(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ok(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ok(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case $w.ZodObject:return function(e,t){const n="openAi"===t.target,r={type:"object",properties:{}},i=[],a=e.shape();for(const e in a){let s=a[e];if(void 0===s||void 0===s._def)continue;let o=Gk(s);o&&n&&("ZodOptional"===s._def.typeName&&(s=s._def.innerType),s.isNullable()||(s=s.nullable()),o=!1);const l=Kk(s._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(r.properties[e]=l,o||i.push(e))}i.length&&(r.required=i);const s=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return Kk(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==s&&(r.additionalProperties=s),r}(e,n);case $w.ZodBigInt:return function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":"jsonSchema7"===t.target?r.inclusive?Ok(n,"minimum",r.value,r.message,t):Ok(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ok(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?Ok(n,"maximum",r.value,r.message,t):Ok(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ok(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ok(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case $w.ZodBoolean:return{type:"boolean"};case $w.ZodDate:return Nk(e,n);case $w.ZodUndefined:return function(e){return{not:xk(e)}}(n);case $w.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(n);case $w.ZodArray:return function(e,t){const n={type:"array"};return e.type?._def&&e.type?._def?.typeName!==$w.ZodAny&&(n.items=Kk(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Ok(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Ok(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Ok(n,"minItems",e.exactLength.value,e.exactLength.message,t),Ok(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}(e,n);case $w.ZodUnion:case $w.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return Hk(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every((e=>e._def.typeName in Uk&&(!e._def.checks||!e._def.checks.length)))){const e=n.reduce(((e,t)=>{const n=Uk[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e}),[]);return{type:e.length>1?e:e[0]}}if(n.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=n.reduce(((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===n.length){const t=e.filter(((e,t,n)=>n.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:n.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(n.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:n.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return Hk(e,t)}(e,n);case $w.ZodIntersection:return function(e,t){const n=[Kk(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),Kk(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter((e=>!!e));let r="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const i=[];return n.forEach((e=>{if((e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e)(e))i.push(...e.allOf),void 0===e.unevaluatedProperties&&(r=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...r}=e;t=r}else r=void 0;i.push(t)}})),i.length?{allOf:i,...r}:void 0}(e,n);case $w.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,n)=>Kk(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:Kk(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,n)=>Kk(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}(e,n);case $w.ZodRecord:return Bk(e,n);case $w.ZodLiteral:return function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}(e,n);case $w.ZodEnum:return function(e){return{type:"string",enum:Array.from(e.values)}}(e);case $w.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),r=Array.from(new Set(n.map((e=>typeof e))));return{type:1===r.length?"string"===r[0]?"string":"number":["string","number"],enum:n}}(e);case $w.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:Uk[e.innerType._def.typeName],nullable:!0}:{type:[Uk[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=Kk(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=Kk(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case $w.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return Kk(e.innerType._def,t);const n=Kk(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:xk(t)},n]}:xk(t)})(e,n);case $w.ZodMap:return function(e,t){return"record"===t.mapStrategy?Bk(e,t):{type:"array",maxItems:125,items:{type:"array",items:[Kk(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||xk(t),Kk(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||xk(t)],minItems:2,maxItems:2}}}(e,n);case $w.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:Kk(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Ok(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Ok(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}(e,n);case $w.ZodLazy:return()=>e.getter()._def;case $w.ZodPromise:return function(e,t){return Kk(e.type._def,t)}(e,n);case $w.ZodNaN:case $w.ZodNever:return function(e){return"openAi"===e.target?void 0:{not:xk({...e,currentPath:[...e.currentPath,"not"]})}}(n);case $w.ZodEffects:return function(e,t){return"input"===t.effectStrategy?Kk(e.schema._def,t):xk(t)}(e,n);case $w.ZodAny:return xk(n);case $w.ZodUnknown:return function(e){return xk(e)}(n);case $w.ZodDefault:return function(e,t){return{...Kk(e.innerType._def,t),default:e.defaultValue()}}(e,n);case $w.ZodBranded:return Sk(e,n);case $w.ZodReadonly:case $w.ZodCatch:return((e,t)=>Kk(e.innerType._def,t))(e,n);case $w.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return Kk(e.in._def,t);if("output"===t.pipeStrategy)return Kk(e.out._def,t);const n=Kk(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,Kk(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter((e=>void 0!==e))}})(e,n);case $w.ZodFunction:case $w.ZodVoid:case $w.ZodSymbol:default:return}};function Kk(e,t,n=!1){const r=t.seen.get(e);if(t.override){const i=t.override?.(e,t,r,n);if(i!==Tk)return i}if(r&&!n){const e=Wk(r,t);if(void 0!==e)return e}const i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);const a=qk(e,e.typeName,t),s="function"==typeof a?Kk(a(),t):a;if(s&&Jk(e,t,s),t.postProcess){const n=t.postProcess(s,e,t);return i.jsonSchema=s,n}return i.jsonSchema=s,s}const Wk=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Ek(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,n)=>t.currentPath[n]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),xk(t)):"seen"===t.$refStrategy?xk(t):void 0}},Jk=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),Zk=(e,t)=>{const n=(e=>{const t=(e=>"string"==typeof e?{...Ik,name:e}:{...Ik,...e})(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map((([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))}})(t);let r="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,r])=>({...e,[t]:Kk(r._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??xk(n)})),{}):void 0;const i="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,a=Kk(e._def,void 0===i?n:{...n,currentPath:[...n.basePath,n.definitionPath,i]},!1)??xk(n),s="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==s&&(a.title=s),n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===n.$refStrategy?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const o=void 0===i?r?{...a,[n.definitionPath]:r}:a:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,i].join("/"),[n.definitionPath]:{...r,[i]:a}};return"jsonSchema7"===n.target?o.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"!==n.target&&"openAi"!==n.target||(o.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===n.target&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};function Qk(e){return Ak(e.data)?{type:"runnable",data:{id:e.data.lc_id,name:e.data.getName()}}:{type:"schema",data:{...Zk(e.data.schema),title:e.data.name}}}class Xk{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach(((t,n)=>{e[t.id]=y_(t.id)?n:t.id})),{nodes:Object.values(this.nodes).map((t=>({id:e[t.id],...Qk(t)}))),edges:this.edges.map((t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]}))}}addNode(e,t){if(void 0!==t&&void 0!==this.nodes[t])throw new Error(`Node with id ${t} already exists`);const n=t||Jw(),r={id:n,data:e};return this.nodes[n]=r,r}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter((t=>t.source!==e.id&&t.target!==e.id))}addEdge(e,t,n){if(void 0===this.nodes[e.id])throw new Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw new Error(`Target node ${t.id} not in graph`);const r={source:e.id,target:t.id,data:n};return this.edges.push(r),r}firstNode(){const e=new Set(this.edges.map((e=>e.target))),t=[];return Object.values(this.nodes).forEach((n=>{e.has(n.id)||t.push(n)})),t[0]}lastNode(){const e=new Set(this.edges.map((e=>e.source))),t=[];return Object.values(this.nodes).forEach((n=>{e.has(n.id)||t.push(n)})),t[0]}extend(e){Object.entries(e.nodes).forEach((([e,t])=>{this.nodes[e]=t})),this.edges=[...this.edges,...e.edges]}trimFirstNode(){const e=this.firstNode();if(e){const t=this.edges.filter((t=>t.source===e.id));1!==Object.keys(this.nodes).length&&1!==t.length||this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const t=this.edges.filter((t=>t.target===e.id));1!==Object.keys(this.nodes).length&&1!==t.length||this.removeNode(e)}}}function Yk(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}function eA(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*tA(e,t){const n=gk.getInstance();for(;;){const{value:r,done:i}=n.run(e,t.next.bind(t));if(i)break;yield r}}async function*nA(e,t){const n=gk.getInstance(),r=t[Symbol.asyncIterator]();for(;;){const{value:i,done:a}=await n.run(e,r.next.bind(t));if(a)break;yield i}}function rA(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class iA extends dv{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new aA({bound:this,kwargs:e,config:{}})}map(){return new sA({bound:this})}withRetry(e){return new oA({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new aA({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new hA({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(wk);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter((([e])=>"runId"!==e)));return Array.from({length:t},((t,r)=>wk(0===r?e:n)))}return Array.from({length:t},(()=>wk(e)))}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),i=r[0]?.maxConcurrency??n?.maxConcurrency,a=new nb({maxConcurrency:i,onFailedAttempt:e=>{throw e}}),s=e.map(((e,t)=>a.call((async()=>{try{return await this.invoke(e,r[t])}catch(e){if(n?.returnExceptions)return e;throw e}}))));return Promise.all(s)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=new uk(this._streamIterator(e,wk(t)));return await n.setup,sk.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(e){let t;t=wk(void 0===e?e:{callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,[t,n]}async _callWithConfig(e,t,n){const r=wk(n),i=await yk(r),a=await(i?.handleChainStart(this.toJSON(),rA(t,"input"),r.runId,r?.runType,void 0,void 0,r?.runName??this.getName()));let s;delete r.runId;try{s=await e.call(this,t,r,a)}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(rA(s,"output"))),s}async _batchWithConfig(e,t,n,r){const i=this._getOptionsList(n??{},t.length),a=await Promise.all(i.map(yk)),s=await Promise.all(a.map((async(e,n)=>{const r=await(e?.handleChainStart(this.toJSON(),rA(t[n],"input"),i[n].runId,i[n].runType,void 0,void 0,i[n].runName??this.getName()));return delete i[n].runId,r})));let o;try{o=await e.call(this,t,i,s,r)}catch(e){throw await Promise.all(s.map((t=>t?.handleChainError(e)))),e}return await Promise.all(s.map((e=>e?.handleChainEnd(rA(o,"output"))))),o}async*_transformStreamWithConfig(e,t,n){let r,i,a=!0,s=!0;const o=wk(n),l=await yk(o);let u;try{const n=await async function(e,t,n,...r){const i=new uk(t,n),a=await i.setup;return{output:e(i,a,...r),setup:a}}(t.bind(this),async function*(){for await(const t of e){if(a)if(void 0===r)r=t;else try{r=lk(r,t)}catch{r=void 0,a=!1}yield t}}(),(async()=>l?.handleChainStart(this.toJSON(),{input:""},o.runId,o.runType,void 0,void 0,o.runName??this.getName())),o);delete o.runId,u=n.setup;const c=e=>"log_stream_tracer"===e.name,h=u?.handlers.find(c);let d=n.output;void 0!==h&&void 0!==u&&(d=await h.tapOutputIterable(u.runId,n.output));for await(const e of d)if(yield e,s)if(void 0===i)i=e;else try{i=lk(i,e)}catch{i=void 0,s=!1}}catch(e){throw await(u?.handleChainError(e,void 0,void 0,void 0,{inputs:rA(r,"input")})),e}await(u?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:rA(r,"input")}))}getGraph(e){const t=new Xk,n=t.addNode({name:`${this.getName()}Input`,schema:zw()}),r=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:zw()});return t.addEdge(n,r),t.addEdge(r,i),t}pipe(e){return new lA({first:this,last:dA(e)})}pick(e){return this.pipe(new fA(e))}assign(e){return this.pipe(new pA(new uA({steps:e})))}async*transform(e,t){let n;for await(const t of e)n=void 0===n?t:lk(n,t);yield*this._streamIterator(n,wk(t))}async*streamLog(e,t,n){const r=new fk({...n,autoClose:!1,_schemaFormat:"original"}),i=wk(t);yield*this._streamLog(e,r,i)}async*_streamLog(e,t,n){const{callbacks:r}=n;if(void 0===r)n.callbacks=[t];else if(Array.isArray(r))n.callbacks=r.concat([t]);else{const e=r.copy();e.inheritableHandlers.push(t),n.callbacks=e}const i=this.stream(e,n),a=async function(){try{const e=await i;for await(const n of e){const e=new ck({ops:[{op:"add",path:"/streamed_output/-",value:n}]});await t.writer.write(e)}}finally{await t.writer.close()}}();try{for await(const e of t)yield e}finally{await a}}async*streamEvents(e,t,n){if("text/event-stream"===t.encoding){const r=await this._streamEvents(e,t,n);yield*function(e){const t=new TextEncoder,n=new ReadableStream({async start(n){for await(const r of e)n.enqueue(t.encode(`event: data\ndata: ${JSON.stringify(r)}\n\n`));n.enqueue(t.encode("event: end\n\n")),n.close()}});return sk.fromReadableStream(n)}(r)}else yield*this._streamEvents(e,t,n)}async*_streamEvents(e,t,n){if("v1"!==t.version)throw new Error('Only version "v1" of the events schema is currently supported.');let r,i=!1;const a=wk(t),s=a.tags??[],o=a.metadata??{},l=a.runName??this.getName(),u=new fk({...n,autoClose:!1,_schemaFormat:"streaming_events"}),c=new Pk({...n}),h=this._streamLog(e,u,a);for await(const t of h){if(r=r?r.concat(t):hk.fromRunLogPatch(t),void 0===r.state)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const t={...r.state},n={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:o,data:{input:e}};c.includeEvent(n,t.type)&&(yield n)}const n=t.ops.filter((e=>e.path.startsWith("/logs/"))).map((e=>e.path.split("/")[2])),a=[...new Set(n)];for(const e of a){let t,n={};const i=r.state.logs[e];if(t=void 0===i.end_time?i.streamed_output.length>0?"stream":"start":"end","start"===t)void 0!==i.inputs&&(n.input=i.inputs);else if("end"===t)void 0!==i.inputs&&(n.input=i.inputs),n.output=i.final_output;else if("stream"===t){const e=i.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${i.name}"`);n={chunk:i.streamed_output[0]},i.streamed_output=[]}yield{event:`on_${i.type}_${t}`,name:i.name,run_id:i.id,tags:i.tags,metadata:i.metadata,data:n}}const{state:u}=r;if(u.streamed_output.length>0){const e=u.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${u.name}"`);const t={chunk:u.streamed_output[0]};u.streamed_output=[];const n={event:`on_${u.type}_stream`,run_id:u.id,tags:s,metadata:o,name:l,data:t};c.includeEvent(n,u.type)&&(yield n)}}const d=r?.state;if(void 0!==d){const e={event:`on_${d.type}_end`,name:l,run_id:d.id,tags:s,metadata:o,data:{output:d.final_output}};c.includeEvent(e,d.type)&&(yield e)}}static isRunnable(e){return Ak(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new aA({bound:this,config:{},configFactories:[r=>({callbacks:[new kk({config:r,onStart:e,onEnd:t,onError:n})]})]})}}class aA extends iA{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=vk(this.config,...e);return vk(t,...this.configFactories?await Promise.all(this.configFactories.map((async e=>await e(t)))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(wk(t),this.kwargs))}async batch(e,t,n){const r=Array.isArray(t)?await Promise.all(t.map((async e=>this._mergeConfig(wk(e),this.kwargs)))):await this._mergeConfig(wk(t),this.kwargs);return this.bound.batch(e,r,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(wk(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(wk(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(wk(t),this.kwargs))}async*streamEvents(e,t,n){yield*this.bound.streamEvents(e,{...await this._mergeConfig(wk(t),this.kwargs),version:t.version},n)}static isRunnableBinding(e){return e.bound&&iA.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new aA({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[r=>({callbacks:[new kk({config:r,onStart:e,onEnd:t,onError:n})]})]})}}class sA extends iA{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new sA({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,n){return this.bound.batch(e,_k(t,{callbacks:n?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new sA({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class oA extends aA{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const r=e>1?`retry:attempt:${e}`:void 0;return _k(t,{callbacks:n?.getChild(r)})}async _invoke(e,t,n){return Xv((r=>super.invoke(e,this._patchConfigForRetry(r,t,n))),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,n,r){const i={};try{await Xv((async a=>{const s=e.map(((e,t)=>t)).filter((e=>void 0===i[e.toString()]||i[e.toString()]instanceof Error)),o=s.map((t=>e[t])),l=s.map((e=>this._patchConfigForRetry(a,t?.[e],n?.[e]))),u=await super.batch(o,l,{...r,returnExceptions:!0});let c;for(let e=0;e<u.length;e+=1){const t=u[e],n=s[e];t instanceof Error&&void 0===c&&(c=t,c.input=o[e]),i[n.toString()]=t}if(c)throw c;return u}),{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==r?.returnExceptions)throw e}return Object.keys(i).sort(((e,t)=>parseInt(e,10)-parseInt(t,10))).map((e=>i[parseInt(e,10)]))}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class lA extends iA{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const n=wk(t),r=await yk(n),i=await(r?.handleChainStart(this.toJSON(),rA(e,"input"),n.runId,void 0,void 0,void 0,n?.runName));delete n.runId;let a,s=e;try{const e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){const r=e[t];s=await r.invoke(s,_k(n,{callbacks:i?.getChild(`seq:step:${t+1}`)}))}a=await this.last.invoke(s,_k(n,{callbacks:i?.getChild(`seq:step:${this.steps.length}`)}))}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(rA(a,"output"))),a}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),i=await Promise.all(r.map(yk)),a=await Promise.all(i.map((async(t,n)=>{const i=await(t?.handleChainStart(this.toJSON(),rA(e[n],"input"),r[n].runId,void 0,void 0,void 0,r[n].runName));return delete r[n].runId,i})));let s=e;try{for(let e=0;e<this.steps.length;e+=1){const t=this.steps[e];s=await t.batch(s,a.map(((t,n)=>{const i=t?.getChild(`seq:step:${e+1}`);return _k(r[n],{callbacks:i})})),n)}}catch(e){throw await Promise.all(a.map((t=>t?.handleChainError(e)))),e}return await Promise.all(a.map((e=>e?.handleChainEnd(rA(s,"output"))))),s}async*_streamIterator(e,t){const n=await yk(t),{runId:r,...i}=t??{},a=await(n?.handleChainStart(this.toJSON(),rA(e,"input"),r,void 0,void 0,void 0,i?.runName)),s=[this.first,...this.middle,this.last];let o,l=!0;try{let t=s[0].transform(async function*(){yield e}(),_k(i,{callbacks:a?.getChild("seq:step:1")}));for(let e=1;e<s.length;e+=1){const n=s[e];t=await n.transform(t,_k(i,{callbacks:a?.getChild(`seq:step:${e+1}`)}))}for await(const n of t)if(yield n,l)if(void 0===o)o=n;else try{o=lk(o,n)}catch(e){o=void 0,l=!1}}catch(e){throw await(a?.handleChainError(e)),e}await(a?.handleChainEnd(rA(o,"output")))}getGraph(e){const t=new Xk;let n=null;return this.steps.forEach(((r,i)=>{const a=r.getGraph(e);0!==i&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const s=a.firstNode();if(!s)throw new Error(`Runnable ${r} has no first node`);n&&t.addEdge(n,s),n=a.lastNode()})),t}pipe(e){return lA.isRunnableSequence(e)?new lA({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new lA({first:this.first,middle:[...this.middle,this.last],last:dA(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&iA.isRunnable(e)}static from([e,...t],n){return new lA({first:dA(e),middle:t.slice(0,-1).map(dA),last:dA(t[t.length-1]),name:n})}}class uA extends iA{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=dA(n)}static from(e){return new uA({steps:e})}async invoke(e,t){const n=wk(t),r=await yk(n),i=await(r?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName));delete n.runId;const a={};try{await Promise.all(Object.entries(this.steps).map((async([t,r])=>{a[t]=await r.invoke(e,_k(n,{callbacks:i?.getChild(`map:key:${t}`)}))})))}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(a)),a}async*_transform(e,t,n){const r={...this.steps},i=ok(e,Object.keys(r).length),a=new Map(Object.entries(r).map((([e,r],a)=>{const s=r.transform(i[a],_k(n,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then((t=>({key:e,gen:s,result:t})))]})));for(;a.size;){const{key:e,result:t,gen:n}=await Promise.race(a.values());a.delete(e),t.done||(yield{[e]:t.value},a.set(e,n.next().then((t=>({key:e,gen:n,result:t})))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new uk(this.transform(async function*(){yield e}(),t));return await n.setup,sk.fromAsyncGenerator(n)}}class cA extends iA{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new cA({func:e})}async _invoke(e,t,n){return new Promise(((r,i)=>{const a=_k(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??25)-1});gk.getInstance().run(a,(async()=>{try{let n=await this.func(e,{...a,config:a});if(n&&iA.isRunnable(n)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");n=await n.invoke(e,{...a,recursionLimit:(a.recursionLimit??25)-1})}else if(eA(n)){let e;for await(const t of nA(a,n))if(void 0===e)e=t;else try{e=lk(e,t)}catch(n){e=t}n=e}else if(Yk(n)){let e;for(const t of tA(a,n))if(void 0===e)e=t;else try{e=lk(e,t)}catch(n){e=t}n=e}r(n)}catch(e){i(e)}}))}))}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,n){let r;for await(const t of e)if(void 0===r)r=t;else try{r=lk(r,t)}catch(e){r=t}const i=await new Promise(((e,t)=>{gk.getInstance().run(n,(async()=>{try{const t=await this.func(r,{...n,config:n});e(t)}catch(e){t(e)}}))}));if(i&&iA.isRunnable(i)){if(0===n?.recursionLimit)throw new Error("Recursion limit reached.");const e=await i.stream(r,_k(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??25)-1}));for await(const t of e)yield t}else if(eA(i))for await(const e of nA(n,i))yield e;else if(Yk(i))for(const e of tA(n,i))yield e;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new uk(this.transform(async function*(){yield e}(),t));return await n.setup,sk.fromAsyncGenerator(n)}}class hA extends iA{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=await R_.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),{runId:r,...i}=t??{},a=await(n?.handleChainStart(this.toJSON(),rA(e,"input"),r,void 0,void 0,void 0,i?.runName));let s;for(const t of this.runnables())try{const n=await t.invoke(e,_k(i,{callbacks:a?.getChild()}));return await(a?.handleChainEnd(rA(n,"output"))),n}catch(e){void 0===s&&(s=e)}if(void 0===s)throw new Error("No error stored at end of fallback.");throw await(a?.handleChainError(s)),s}async batch(e,t,n){if(n?.returnExceptions)throw new Error("Not implemented.");const r=this._getOptionsList(t??{},e.length),i=await Promise.all(r.map((e=>R_.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)))),a=await Promise.all(i.map((async(t,n)=>{const i=await(t?.handleChainStart(this.toJSON(),rA(e[n],"input"),r[n].runId,void 0,void 0,void 0,r[n].runName));return delete r[n].runId,i})));let s;for(const t of this.runnables())try{const i=await t.batch(e,a.map(((e,t)=>_k(r[t],{callbacks:e?.getChild()}))),n);return await Promise.all(a.map(((e,t)=>e?.handleChainEnd(rA(i[t],"output"))))),i}catch(e){void 0===s&&(s=e)}if(!s)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(a.map((e=>e?.handleChainError(s)))),s}}function dA(e){if("function"==typeof e)return new cA({func:e});if(iA.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[n,r]of Object.entries(e))t[n]=dA(r);return new uA({steps:t})}}class pA extends iA{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof uA&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const r=this.mapper.getStepsKeys(),[i,a]=ok(e),s=this.mapper.transform(a,_k(n,{callbacks:t?.getChild()})),o=s.next();for await(const e of i){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter((([e])=>!r.includes(e))));Object.keys(t).length>0&&(yield t)}yield(await o).value;for await(const e of s)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new uk(this.transform(async function*(){yield e}(),t));return await n.setup,sk.fromAsyncGenerator(n)}}class fA extends iA{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map((t=>[t,e[t]])).filter((e=>void 0!==e[1]));return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new uk(this.transform(async function*(){yield e}(),t));return await n.setup,sk.fromAsyncGenerator(n)}}class mA extends iA{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class gA extends mA{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){super({callbacks:e??t,...n}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof n.cache?this.cache=n.cache:n.cache?this.cache=Wv.global():this.cache=void 0,this.caller=new nb(n??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await async function(e){return async function(e){return e in cb||(cb[e]=hb.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then((e=>e.json())).then((e=>new ub(e))).catch((t=>{throw delete cb[e],t}))),await cb[e]}(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":return"o200k_base";default:throw new Error("Unknown model")}}(e))}("modelName"in this?(e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e.startsWith("gpt-4o")?"gpt-4o":e)(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new Zv(e):Array.isArray(e)?new Qv(e.map(Cv)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()},r=Object.entries(n).filter((([e,t])=>void 0!==t)),i=r.map((([e,t])=>`${e}:${JSON.stringify(t)}`)).sort().join(",");return i}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class yA extends gA{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n?.timeout&&!n.signal&&(n.signal=AbortSignal.timeout(n.timeout)),[t,n]}async invoke(e,t){const n=yA._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===yA.prototype._streamResponseChunks)yield this.invoke(e,t);else{const n=yA._convertInputToPromptValue(e).toChatMessages(),[r,i]=this._separateRunnableConfigFromCallOptions(t),a=await R_.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),s={options:i,invocation_params:this?.invocationParams(i),batch_size:1},o=await(a?.handleChatModelStart(this.toJSON(),[n],r.runId,void 0,s,void 0,void 0,r.runName));let l;try{for await(const e of this._streamResponseChunks(n,i,o?.[0]))e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},yield e.message,l=l?l.concat(e):e}catch(e){throw await Promise.all((o??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((o??[]).map((e=>e?.handleLLMEnd({generations:[[l]]}))))}}async _generateUncached(e,t,n){const r=e.map((e=>e.map(Cv))),i=await R_.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),a={options:t,invocation_params:this?.invocationParams(t),batch_size:1},s=await(i?.handleChatModelStart(this.toJSON(),r,n.runId,void 0,a,void 0,void 0,n.runName)),o=await Promise.allSettled(r.map(((e,n)=>this._generate(e,{...t,promptIndex:n},s?.[n])))),l=[],u=[];await Promise.all(o.map((async(e,t)=>{if("fulfilled"===e.status){const n=e.value;for(const e of n.generations)e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};return 1===n.generations.length&&(n.generations[0].message.response_metadata={...n.llmOutput,...n.generations[0].message.response_metadata}),l[t]=n.generations,u[t]=n.llmOutput,s?.[t]?.handleLLMEnd({generations:[n.generations],llmOutput:n.llmOutput})}return await(s?.[t]?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const c={generations:l,llmOutput:u.length?this._combineLLMOutput?.(...u):void 0};return Object.defineProperty(c,Nv,{value:s?{runIds:s?.map((e=>e.runId))}:void 0,configurable:!0}),c}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:r,handledOptions:i}){const a=e.map((e=>e.map(Cv))),s=await R_.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o={options:r,invocation_params:this?.invocationParams(r),batch_size:1,cached:!0},l=await(s?.handleChatModelStart(this.toJSON(),a,i.runId,void 0,o,void 0,void 0,i.runName)),u=[],c=await Promise.allSettled(a.map((async(e,r)=>{const i=yA._convertInputToPromptValue(e).toString(),a=await t.lookup(i,n);return null==a&&u.push(r),a}))),h=c.map(((e,t)=>({result:e,runManager:l?.[t]}))).filter((({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status)),d=[];await Promise.all(h.map((async({result:e,runManager:t},n)=>{if("fulfilled"===e.status){const r=e.value;return d[n]=r,r.length&&await(t?.handleLLMNewToken(r[0].text)),t?.handleLLMEnd({generations:[r]})}return await(t?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const p={generations:d,missingPromptIndices:u};return Object.defineProperty(p,Nv,{value:l?{runIds:l?.map((e=>e.runId))}:void 0,configurable:!0}),p}async generate(e,t,n){let r;r=Array.isArray(t)?{stop:t}:t;const i=e.map((e=>e.map(Cv))),[a,s]=this._separateRunnableConfigFromCallOptions(r);if(a.callbacks=a.callbacks??n,!this.cache)return this._generateUncached(i,s,a);const{cache:o}=this,l=this._getSerializedCacheKeyParametersForCall(s),{generations:u,missingPromptIndices:c}=await this._generateCached({messages:i,cache:o,llmStringKey:l,parsedOptions:s,handledOptions:a});let h={};if(c.length>0){const e=await this._generateUncached(c.map((e=>i[e])),s,a);await Promise.all(e.generations.map((async(e,t)=>{const n=c[t];u[n]=e;const r=yA._convertInputToPromptValue(i[n]).toString();return o.update(r,l,e)}))),h=e.llmOutput??{}}return{generations:u,llmOutput:h}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const r=e.map((e=>e.toChatMessages()));return this.generate(r,t,n)}async call(e,t,n){return(await this.generate([e.map(Cv)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const r=e.toChatMessages();return this.call(r,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const r=new Tv(e),i=await this.call([r],t,n);if("string"!=typeof i.content)throw new Error("Cannot use predict when output is not a string.");return i.content}}function vA(e){return{name:e.name,description:e.description,parameters:Zk(e.schema)}}function bA(e){return function(e){return void 0!==e&&Array.isArray(e.lc_namespace)}(e)?{type:"function",function:vA(e)}:e}class wA extends iA{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=wk(t);return this.func&&await this.func(e,n),this._callWithConfig((e=>Promise.resolve(e)),e,n)}async*transform(e,t){const n=wk(t);let r,i=!0;for await(const t of this._transformStreamWithConfig(e,(e=>e),n))if(yield t,i)if(void 0===r)r=t;else try{r=lk(r,t)}catch{r=void 0,i=!1}this.func&&void 0!==r&&await this.func(r,n)}static assign(e){return new pA(new uA({steps:e}))}}class _A extends iA{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return"string"==typeof e.content?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return"string"==typeof e?this._callWithConfig((async(e,t)=>this.parseResult([{text:e}],t?.callbacks)),e,{...t,runType:"parser"}):this._callWithConfig((async(e,t)=>this.parseResult([{message:e,text:this._baseMessageToString(e)}],t?.callbacks)),e,{...t,runType:"parser"})}}class kA extends _A{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class AA extends Error{constructor(e,t,n,r=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=r,r&&(void 0===n||void 0===t))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}function PA(e,t){const n=typeof e;if(n!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(!PA(e[r],t[r]))return!1;return!0}if("object"===n){if(!e||!t)return e===t;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const r of n)if(!PA(e[r],t[r]))return!1;return!0}return e===t}"undefined"!=typeof self&&self.location&&"null"!==self.location.origin&&(self.location.origin,self.location.pathname,location.search);const TA=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function IA(e){return e.test.bind(e)}(function(e,t){const n=t.match(TA);if(!n)return!1;const r=+n[1],i=+n[2],a=+n[3],s=!!n[5];return(r<=23&&i<=59&&a<=59||23==r&&59==i&&60==a)&&(!e||s)}).bind(void 0,!1),IA(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),IA(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),IA(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),IA(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),IA(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),IA(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),IA(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),IA(/^(?:\/(?:[^~/]|~0|~1)*)*$/),IA(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),IA(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/);class EA extends kA{async*_transform(e){for await(const t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class xA extends EA{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let t,n;for await(const i of e){if("string"!=typeof i&&"string"!=typeof i.content)throw new Error("Cannot handle non-string output.");let e;if(vv(r=i)&&"function"==typeof r.concat){if("string"!=typeof i.content)throw new Error("Cannot handle non-string message output.");e=new Dv({message:i,text:i.content})}else if(vv(i)){if("string"!=typeof i.content)throw new Error("Cannot handle non-string message output.");e=new Dv({message:Sv(i),text:i.content})}else e=new jv({text:i});n=void 0===n?e:n.concat(e);const a=await this.parsePartialResult([n]);null==a||PA(a,t)||(this.diff?yield this._diff(t,a):yield a,t=a)}var r}}class CA extends kA{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(Uw(Object.fromEntries(Object.entries(e).map((([e,t])=>[e,Fw().describe(t)])))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.\n\n"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.\n\nFor example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}\nwould match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.\nThus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.\n\nYour output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!\n\nHere is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:\n\`\`\`json\n${JSON.stringify(Zk(this.schema))}\n\`\`\`\n`}async parse(e){try{const t=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,((e,t)=>`"${t.replace(/\n/g,"\\n")}"`)).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(t))}catch(t){throw new AA(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class OA extends xA{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?ak(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return iv(e[0].text)}async parse(e){return iv(e,JSON.parse)}getFormatInstructions(){return""}}function SA(e,t){if(void 0===e.function)return;let n;if(t?.partial)try{n=av(e.function.arguments??"{}")}catch(e){return}else try{n=JSON.parse(e.function.arguments)}catch(t){throw new AA([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"","are not valid JSON.",`Error: ${t.message}`].join("\n"))}const r={name:e.function.name,args:n};return t?.returnId&&(r.id=e.id),r}function NA(e){if(void 0===e.id)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}function jA(e,t){return{name:e.function?.name,args:e.function?.arguments,id:e.id,error:t}}class DA extends _A{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}async parseResult(e){const t=e[0].message.additional_kwargs.tool_calls;if(!t)throw new Error(`No tools_call in message ${JSON.stringify(e)}`);const n=JSON.parse(JSON.stringify(t)),r=[];for(const e of n){const t=SA(e,{partial:!0});if(void 0!==t){const e={type:t.name,args:t.args,id:t.id};Object.defineProperty(e,"name",{get(){return this.type}}),Object.defineProperty(e,"arguments",{get(){return this.args}}),r.push(e)}}return r}}class RA extends _A{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.initialParser=new DA(e),this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new AA(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){const t=(await this.initialParser.parseResult(e)).filter((e=>e.type===this.keyName));let n=t;if(this.returnId||(n=t.map((e=>e.args))),this.returnSingle)return this._validateResult(n[0]);const r=await Promise.all(n.map((e=>this._validateResult(e))));return r}}function LA(e,t){const n=[];for(const[r,i]of Object.entries(e.properties??{}))i.description&&t<2&&n.push(`// ${i.description}`),e.required?.includes(r)?n.push(`${r}: ${MA(i,t)},`):n.push(`${r}?: ${MA(i,t)},`);return n.map((e=>" ".repeat(t)+e)).join("\n")}function MA(e,t){if(function(e){return void 0!==e.anyOf&&Array.isArray(e.anyOf)}(e))return e.anyOf.map((e=>MA(e,t))).join(" | ");switch(e.type){case"string":return e.enum?e.enum.map((e=>`"${e}"`)).join(" | "):"string";case"number":case"integer":return e.enum?e.enum.map((e=>`${e}`)).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",LA(e,t+2),"}"].join("\n");case"array":return e.items?`${MA(e.items,t)}[]`:"any[]";default:return""}}function $A(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!kv.isInstance(e))throw new Error("Invalid generic chat message");return function(e){return"system"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role}(e);default:throw new Error(`Unknown message type: ${t}`)}}function FA(e){const t=e.tool_calls;if("assistant"===e.role){const n=[],r=[];for(const e of t??[])try{n.push(SA(e,{returnId:!0}))}catch(t){r.push(jA(e,t.message))}return new wv({content:e.content||"",tool_calls:n,invalid_tool_calls:r,additional_kwargs:{function_call:e.function_call,tool_calls:t}})}return new kv(e.content||"",e.role??"unknown")}function VA(e,t){const n=e.role??t,r=e.content??"";let i;if(i=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},"user"===n)return new Iv({content:r});if("assistant"===n){const t=[];if(Array.isArray(e.tool_calls))for(const n of e.tool_calls)t.push({name:n.function?.name,args:n.function?.arguments,id:n.id,index:n.index});return new _v({content:r,tool_call_chunks:t,additional_kwargs:i})}return"system"===n?new xv({content:r}):"function"===n?new Pv({content:r,additional_kwargs:i,name:e.name}):"tool"===n?new bv({content:r,additional_kwargs:i,tool_call_id:e.tool_call_id}):new Av({content:r,role:n})}function zA(e){return e.map((e=>{const t={role:$A(e),content:e.content};return null!=e.name&&(t.name=e.name),null!=e.additional_kwargs.function_call&&(t.function_call=e.additional_kwargs.function_call),function(e){return"ai"===e._getType()}(e)&&e.tool_calls?.length?t.tool_calls=e.tool_calls.map(NA):(null!=e.additional_kwargs.tool_calls&&(t.tool_calls=e.additional_kwargs.tool_calls),null!=e.tool_call_id&&(t.tool_call_id=e.tool_call_id)),t}))}class BA extends yA{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??$v("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=e?.azureOpenAIApiKey??$v("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.apiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??$v("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??$v("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??$v("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??$v("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??$v("OPENAI_ORGANIZATION"),this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}bindTools(e,t){return this.bind({tools:e.map(bA),...t})}invocationParams(e){return{model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:function(e){return void 0!==e&&e.every((e=>Array.isArray(e.lc_namespace)))}(e?.tools)?e?.tools.map(bA):e?.tools,tool_choice:e?.tool_choice,response_format:e?.response_format,seed:e?.seed,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){const r=zA(e),i={...this.invocationParams(t),messages:r,stream:!0};let a;const s=await this.completionWithRetry(i,t);for await(const e of s){const r=e?.choices[0];if(!r)continue;const{delta:i}=r;if(!i)continue;const s=VA(i,a);a=i.role??a;const o={prompt:t.promptIndex??0,completion:r.index??0};if("string"!=typeof s.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const l={...o};void 0!==r.finish_reason&&(l.finish_reason=r.finish_reason),this.logprobs&&(l.logprobs=r.logprobs);const u=new Dv({message:s,text:s.content,generationInfo:l});yield u,n?.handleLLMNewToken(u.text??"",o,void 0,void 0,void 0,{chunk:u})}if(t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,n){const r={},i=this.invocationParams(t),a=zA(e);if(i.stream){const i=this._streamResponseChunks(e,t,n),a={};for await(const e of i){e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};const t=e.generationInfo?.completion??0;void 0===a[t]?a[t]=e:a[t]=a[t].concat(e)}const s=Object.entries(a).sort((([e],[t])=>parseInt(e,10)-parseInt(t,10))).map((([e,t])=>t)),{functions:o,function_call:l}=this.invocationParams(t),u=await this.getEstimatedTokenCountFromPrompt(e,o,l),c=await this.getNumTokensFromGenerations(s);return r.promptTokens=u,r.completionTokens=c,r.totalTokens=u+c,{generations:s,llmOutput:{estimatedTokenUsage:r}}}{const e=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t?.signal,...t?.options}),{completion_tokens:n,prompt_tokens:s,total_tokens:o}=e?.usage??{};n&&(r.completionTokens=(r.completionTokens??0)+n),s&&(r.promptTokens=(r.promptTokens??0)+s),o&&(r.totalTokens=(r.totalTokens??0)+o);const l=[];for(const t of e?.choices??[]){const e={text:t.message?.content??"",message:FA(t.message??{role:"assistant"})};e.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},l.push(e)}return{generations:l,llmOutput:{tokenUsage:r}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let r=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==n){const e=function(e){const t=["namespace functions {",""];for(const n of e)n.description&&t.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(t.push(`type ${n.name} = (_: {`),t.push(LA(n.parameters,0)),t.push("}) => any;")):t.push(`type ${n.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}(t);r+=await this.getNumTokens(e),r+=9}return t&&e.find((e=>"system"===e._getType()))&&(r-=4),"none"===n?r+=1:"object"==typeof n&&(r+=await this.getNumTokens(n.name)+4),r}async getNumTokensFromGenerations(e){return(await Promise.all(e.map((async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content))))).reduce(((e,t)=>e+t),0)}async getNumTokensFromMessages(e){let t=0,n=0,r=0;"gpt-3.5-turbo-0301"===this.model?(n=4,r=-1):(n=3,r=1);const i=await Promise.all(e.map((async e=>{const i=await this.getNumTokens(e.content),a=await this.getNumTokens($A(e)),s=void 0!==e.name?r+await this.getNumTokens(e.name):0;let o=i+n+a+s;const l=e;if("function"===l._getType()&&(o-=2),l.additional_kwargs?.function_call&&(o+=3),l?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(l.additional_kwargs.function_call?.name)),l.additional_kwargs.function_call?.arguments)try{o+=await this.getNumTokens(JSON.stringify(JSON.parse(l.additional_kwargs.function_call?.arguments)))}catch(e){console.error("Error parsing function arguments",e,JSON.stringify(l.additional_kwargs.function_call)),o+=await this.getNumTokens(l.additional_kwargs.function_call?.arguments)}return t+=o,o})));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call((async()=>{try{return await this.client.chat.completions.create(e,n)}catch(e){throw function(e){let t;return e.constructor.name===$p.name?(t=new Error(e.message),t.name="TimeoutError"):e.constructor.name===Lp.name?(t=new Error(e.message),t.name="AbortError"):t=e,t}(e)}}))}_getClientOptions(e){if(!this.client){const e=function(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:i,baseURL:a}=e;if(r&&i&&t)return`${i}/${t}`;if(r){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${t}`}return a}({azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new nv(t)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce(((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e)),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,r,i,a,s,o;if(function(e){return void 0!==e&&"object"==typeof e.schema}(e)?(n=e.schema,r=e.name,i=e.method,a=e.includeRaw):(n=e,r=t?.name,i=t?.method,a=t?.includeRaw),"jsonMode"===i)s=this.bind({response_format:{type:"json_object"}}),o=UA(n)?CA.fromZodSchema(n):new OA;else{let e=r??"extract";if(UA(n)){const t=Zk(n);s=this.bind({tools:[{type:"function",function:{name:e,description:t.description,parameters:t}}],tool_choice:{type:"function",function:{name:e}}}),o=new RA({returnSingle:!0,keyName:e,zodSchema:n})}else{let t;"string"==typeof n.name&&"object"==typeof n.parameters&&null!=n.parameters?(t=n,e=n.name):(e=n.title??e,t={name:e,description:n.description??"",parameters:n}),s=this.bind({tools:[{type:"function",function:t}],tool_choice:{type:"function",function:{name:e}}}),o=new RA({returnSingle:!0,keyName:e})}}if(!a)return s.pipe(o);const l=wA.assign({parsed:(e,t)=>o.invoke(e.raw,t)}),u=wA.assign({parsed:()=>null}),c=l.withFallbacks({fallbacks:[u]});return lA.from([{raw:s},c])}}function UA(e){return"function"==typeof e?.parse}class HA extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}class GA extends mA{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(e,t){return this.call(e,wk(t))}async call(e,t,n){let r;try{r=await this.schema.parseAsync(e)}catch(t){throw new HA("Received tool input did not match expected schema",JSON.stringify(e))}const i=function(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}(t),a=await R_.configure(i.callbacks,this.callbacks,i.tags||n,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),s=await(a?.handleToolStart(this.toJSON(),"string"==typeof r?r:JSON.stringify(r),i.runId,void 0,void 0,void 0,i.runName));let o;delete i.runId;try{o=await this._call(r,s,i)}catch(e){throw await(s?.handleToolError(e)),e}return await(s?.handleToolEnd(o)),o}}class qA extends GA{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:Uw({input:Fw().optional()}).transform((e=>e.input))})}call(e,t){return super.call("string"!=typeof e&&e?e:{input:e},t)}}function KA(){return new BA({})}Object.defineProperty(class extends qA{static lc_name(){return"DallEAPIWrapper"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t={apiKey:e?.apiKey??e?.openAIApiKey??$v("OPENAI_API_KEY"),organization:e?.organization??$v("OPENAI_ORGANIZATION"),dangerouslyAllowBrowser:!0};this.client=new nv(t),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.responseFormat=e?.responseFormat??this.responseFormat,this.user=e?.user}async _call(e){const t=await this.client.images.generate({model:this.model,prompt:e,n:this.n,size:this.size,response_format:this.responseFormat,style:this.style,quality:this.quality,user:this.user});let n="";return"url"===this.responseFormat?[n]=t.data.map((e=>e.url)).filter((e=>"undefined"!==e)):[n]=t.data.map((e=>e.b64_json)).filter((e=>"undefined"!==e)),n}},"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});const WA=ft({id:"dgen"});function JA(){return function(){if(Ed()){WA("running openai in browser");let e=localStorage.OAAK;if(e)return new nv({apiKey:e,dangerouslyAllowBrowser:!0});{let e="The OAAK localStorage variable is missing, please set it to proceed";throw window.alert(e),e}}return WA("running openai NOT in browser"),new nv}()}async function ZA(e){WA(`Using prompt: ${e}`),Ad("prompt",e),WA("Requesting chat completion");const t=await JA().chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:e}]});WA("Accesing chat response...");let n=t.choices[0].message.content;Ad("data_str",n),WA(`String= ${n}`),WA("Cleaning string");let r=eP(n);Ad("cleaned_str",r),WA("Attempting parse");let i=JSON.parse(r);return Ad("data",i),WA('Successfully parsed json data, available from debug.get("data")'),i}async function QA(e){const t=`Given the following text: "${e}", generate  (in JSON format) a random FHIR R4 Patient (with attributes such as name, gender, birthDate, and address) as well as a random set of 10 fhir resources (Observations, DiagnosticReports, DocumentReferences, etc) that match that patient's profile. Do not return anything other than the JSON string\n\n        It is absolutely ESSENTIAL THAT YOU RETURN THE RESULT AS A JSON OBJECT that represents a FHIR bundle and with the first character of output as "{" and the last character as "}". \n\n\n`;return await ZA(t)}async function XA(e){try{const t=await QA(e);return WA(`Generated FHIR Patient data: ${JSON.stringify(t,null,2)}`),t}catch(e){console.error("Error generating FHIR data:",e)}}async function YA(e){try{const t=`Generate a set of loinc codes in JSON format (only output the json string, nothing else) which can be used to represent the following free text: ${e} . \n\n        It is absolutely ESSENTIAL THAT YOU RETURN THE RESULT AS A JSON ARRAY OF LOINC OBECTS with the first character of output as "[" and the last character as "]". \n\n  `,n=await ZA(t);return WA("Received the following loinc objects"),console.log(n),n}catch(e){console.error("Error:",e)}}function eP(e){return(e=(e=(e=e.replace(/\\n/g,"").replace(/\\"/g,'"')).replace(/\n/g,"")).replace("```json","")).replace("```","")}function tP(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function nP(e,t,n,r,i){e[t]=n,tP(e,t,r,i)}function rP(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map(((n,r)=>rP(e,t,n)))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return iP(e,t)}}const iP=(e,t)=>{const n={type:"integer",format:"unix-time"};if("openApi3"===t.target)return n;for(const r of e.checks)switch(r.kind){case"min":nP(n,"minimum",r.value,r.message,t);break;case"max":nP(n,"maximum",r.value,r.message,t)}return n};let aP;const sP={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===aP&&(aP=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),aP),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function oP(e,t){const n={type:"string"};function r(e){return"escape"===t.patternStrategy?lP(e):e}if(e.checks)for(const i of e.checks)switch(i.kind){case"min":nP(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,i.value):i.value,i.message,t);break;case"max":nP(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":uP(n,"email",i.message,t);break;case"format:idn-email":uP(n,"idn-email",i.message,t);break;case"pattern:zod":cP(n,sP.email,i.message,t)}break;case"url":uP(n,"uri",i.message,t);break;case"uuid":uP(n,"uuid",i.message,t);break;case"regex":cP(n,i.regex,i.message,t);break;case"cuid":cP(n,sP.cuid,i.message,t);break;case"cuid2":cP(n,sP.cuid2,i.message,t);break;case"startsWith":cP(n,RegExp(`^${r(i.value)}`),i.message,t);break;case"endsWith":cP(n,RegExp(`${r(i.value)}$`),i.message,t);break;case"datetime":uP(n,"date-time",i.message,t);break;case"date":uP(n,"date",i.message,t);break;case"time":uP(n,"time",i.message,t);break;case"duration":uP(n,"duration",i.message,t);break;case"length":nP(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,i.value):i.value,i.message,t),nP(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,i.value):i.value,i.message,t);break;case"includes":cP(n,RegExp(r(i.value)),i.message,t);break;case"ip":"v6"!==i.version&&uP(n,"ipv4",i.message,t),"v4"!==i.version&&uP(n,"ipv6",i.message,t);break;case"emoji":cP(n,sP.emoji,i.message,t);break;case"ulid":cP(n,sP.ulid,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":uP(n,"binary",i.message,t);break;case"contentEncoding:base64":nP(n,"contentEncoding","base64",i.message,t);break;case"pattern:zod":cP(n,sP.base64,i.message,t)}break;case"nanoid":cP(n,sP.nanoid,i.message,t)}return n}const lP=e=>Array.from(e).map((e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`)).join(""),uP=(e,t,n,r)=>{e.format||e.anyOf?.some((e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):nP(e,"format",t,n,r)},cP=(e,t,n,r)=>{e.pattern||e.allOf?.some((e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:hP(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):nP(e,"pattern",hP(t,r),n,r)},hP=(e,t)=>{const n="function"==typeof e?e():e;if(!t.applyRegexFlags||!n.flags)return n.source;const r=n.flags.includes("i"),i=n.flags.includes("m"),a=n.flags.includes("s"),s=r?n.source.toLowerCase():n.source;let o="",l=!1,u=!1,c=!1;for(let e=0;e<s.length;e++)if(l)o+=s[e],l=!1;else{if(r)if(u){if(s[e].match(/[a-z]/)){c?(o+=s[e],o+=`${s[e-2]}-${s[e]}`.toUpperCase(),c=!1):"-"===s[e+1]&&s[e+2]?.match(/[a-z]/)?(o+=s[e],c=!0):o+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){o+=`[${s[e]}${s[e].toUpperCase()}]`;continue}if(i){if("^"===s[e]){o+="(^|(?<=[\r\n]))";continue}if("$"===s[e]){o+="($|(?=[\r\n]))";continue}}a&&"."===s[e]?o+=u?`${s[e]}\r\n`:`[${s[e]}\r\n]`:(o+=s[e],"\\"===s[e]?l=!0:u&&"]"===s[e]?u=!1:u||"["!==s[e]||(u=!0))}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return o};function dP(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===$w.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((n,r)=>({...n,[r]:vP(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??{}})),{}),additionalProperties:!1};const n={type:"object",additionalProperties:vP(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return n;if(e.keyType?._def.typeName===$w.ZodString&&e.keyType._def.checks?.length){const r=Object.entries(oP(e.keyType._def,t)).reduce(((e,[t,n])=>"type"===t?e:{...e,[t]:n}),{});return{...n,propertyNames:r}}return e.keyType?._def.typeName===$w.ZodEnum?{...n,propertyNames:{enum:e.keyType._def.values}}:n}const pP={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},fP=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,n)=>vP(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]}))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return n.length?{anyOf:n}:void 0};function mP(e,t){return"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:vP(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:vP(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}const gP=Symbol("Let zodToJsonSchema decide on which parser to use"),yP={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function vP(e,t,n=!1){const r=t.seen.get(e);if(t.override){const i=t.override?.(e,t,r,n);if(i!==gP)return i}if(r&&!n){const e=bP(r,t);if(void 0!==e)return"$ref"in e&&t.seenRefs.add(e.$ref),e}const i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);const a=_P(e,e.typeName,t,n);return a&&kP(e,t,a),i.jsonSchema=a,a}const bP=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":const n=e.path.slice(t.basePath.length+1).join("_");return n!==t.name&&"duplicate-ref"===t.nameStrategy&&(t.definitions[n]=e.def),{$ref:[...t.basePath,t.definitionPath,n].join("/")};case"relative":return{$ref:wP(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,n)=>t.currentPath[n]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},wP=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},_P=(e,t,n,r)=>{switch(t){case $w.ZodString:return oP(e,n);case $w.ZodNumber:return function(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",tP(n,"type",r.message,t);break;case"min":"jsonSchema7"===t.target?r.inclusive?nP(n,"minimum",r.value,r.message,t):nP(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),nP(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?nP(n,"maximum",r.value,r.message,t):nP(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),nP(n,"maximum",r.value,r.message,t));break;case"multipleOf":nP(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case $w.ZodObject:return function(e,t){const n={type:"object",...Object.entries(e.shape()).reduce(((e,[n,r])=>{if(void 0===r||void 0===r._def)return e;const i=[...t.currentPath,"properties",n],a=vP(r._def,{...t,currentPath:i,propertyPath:i});return void 0===a?e:(t.openaiStrictMode&&r.isOptional()&&!r.isNullable()&&console.warn(`Zod field at \`${i.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required\nThis will become an error in a future version of the SDK.`),{properties:{...e.properties,[n]:a},required:r.isOptional()&&!t.openaiStrictMode?e.required:[...e.required,n]})}),{properties:{},required:[]}),additionalProperties:mP(e,t)};return n.required.length||delete n.required,n}(e,n);case $w.ZodBigInt:return function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":"jsonSchema7"===t.target?r.inclusive?nP(n,"minimum",r.value,r.message,t):nP(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),nP(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?nP(n,"maximum",r.value,r.message,t):nP(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),nP(n,"maximum",r.value,r.message,t));break;case"multipleOf":nP(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case $w.ZodBoolean:return{type:"boolean"};case $w.ZodDate:return rP(e,n);case $w.ZodUndefined:return{not:{}};case $w.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(n);case $w.ZodArray:return function(e,t){const n={type:"array"};return e.type?._def?.typeName!==$w.ZodAny&&(n.items=vP(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&nP(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&nP(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(nP(n,"minItems",e.exactLength.value,e.exactLength.message,t),nP(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}(e,n);case $w.ZodUnion:case $w.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return fP(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every((e=>e._def.typeName in pP&&(!e._def.checks||!e._def.checks.length)))){const e=n.reduce(((e,t)=>{const n=pP[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e}),[]);return{type:e.length>1?e:e[0]}}if(n.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=n.reduce(((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===n.length){const t=e.filter(((e,t,n)=>n.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:n.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(n.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:n.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return fP(e,t)}(e,n);case $w.ZodIntersection:return function(e,t){const n=[vP(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),vP(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter((e=>!!e));let r="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const i=[];return n.forEach((e=>{if((e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e)(e))i.push(...e.allOf),void 0===e.unevaluatedProperties&&(r=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...r}=e;t=r}else r=void 0;i.push(t)}})),i.length?{allOf:i,...r}:void 0}(e,n);case $w.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,n)=>vP(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:vP(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,n)=>vP(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}(e,n);case $w.ZodRecord:return dP(e,n);case $w.ZodLiteral:return function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}(e,n);case $w.ZodEnum:return function(e){return{type:"string",enum:[...e.values]}}(e);case $w.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),r=Array.from(new Set(n.map((e=>typeof e))));return{type:1===r.length?"string"===r[0]?"string":"number":["string","number"],enum:n}}(e);case $w.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target||"property"===t.nullableStrategy?{type:pP[e.innerType._def.typeName],nullable:!0}:{type:[pP[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=vP(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=vP(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case $w.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return vP(e.innerType._def,t);const n=vP(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}})(e,n);case $w.ZodMap:return function(e,t){return"record"===t.mapStrategy?dP(e,t):{type:"array",maxItems:125,items:{type:"array",items:[vP(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},vP(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,n);case $w.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:vP(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&nP(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&nP(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}(e,n);case $w.ZodLazy:return vP(e.getter()._def,n);case $w.ZodPromise:return function(e,t){return vP(e.type._def,t)}(e,n);case $w.ZodNaN:case $w.ZodNever:return{not:{}};case $w.ZodEffects:return function(e,t,n){return"input"===t.effectStrategy?vP(e.schema._def,t,n):{}}(e,n,r);case $w.ZodAny:case $w.ZodUnknown:return{};case $w.ZodDefault:return function(e,t){return{...vP(e.innerType._def,t),default:e.defaultValue()}}(e,n);case $w.ZodBranded:return function(e,t){return vP(e.type._def,t)}(e,n);case $w.ZodReadonly:case $w.ZodCatch:return((e,t)=>vP(e.innerType._def,t))(e,n);case $w.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return vP(e.in._def,t);if("output"===t.pipeStrategy)return vP(e.out._def,t);const n=vP(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,vP(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter((e=>void 0!==e))}})(e,n);case $w.ZodFunction:case $w.ZodVoid:case $w.ZodSymbol:default:return}},kP=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),AP=e=>"_def"in e?e._def:e,PP=(e,t)=>{const n=(e=>{const t=(e=>"string"==typeof e?{...yP,basePath:["#"],definitions:{},name:e}:{...yP,basePath:["#"],definitions:{},...e})(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(t.definitions).map((([e,n])=>[AP(n),{def:AP(n),path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))}})(t),r="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,i=vP(e._def,void 0===r?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1)??{},a="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==a&&(i.title=a);const s=(()=>{if(function(e){if(!e)return!0;for(const t in e)return!1;return!0}(n.definitions))return;const e={},t=new Set;for(let r=0;r<500;r++){const r=Object.entries(n.definitions).filter((([e])=>!t.has(e)));if(0===r.length)break;for(const[i,a]of r)e[i]=vP(AP(a),{...n,currentPath:[...n.basePath,n.definitionPath,i]},!0)??{},t.add(i)}return e})(),o=void 0===r?s?{...i,[n.definitionPath]:s}:i:"duplicate-ref"===n.nameStrategy?{...i,...s||n.seenRefs.size?{[n.definitionPath]:{...s,...n.seenRefs.size?{[r]:i}:void 0}}:void 0}:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...s,[r]:i}};return"jsonSchema7"===n.target?o.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===n.target&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function TP(e,t){return PP(e,{openaiStrictMode:!0,name:t.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function IP(e,t,n){return function(e,t){const n={...e};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),n}({type:"json_schema",json_schema:{...n,name:t,strict:!0,schema:TP(e,{name:t})}},(t=>e.parse(JSON.parse(t))))}const EP=ft({id:"oai"});function xP(){return function(){if(Ed()){EP("running openai in browser");let e=localStorage.OAAK;if(e)return new nv({apiKey:e,dangerouslyAllowBrowser:!0});{let e="The OAAK localStorage variable is missing, please set it to proceed";throw window.alert(e),e}}return EP("running openai NOT in browser"),new nv}()}async function CP(){}async function OP(){let e=Uw({name:Fw(),balance:Vw()}),t=Bw(e),n=IP(Uw({rooms:Bw(t)}),"zr");return await SP({prompt:"Randomly Generate 3 separate Rooms with 3 unique users per room and return all results as json. Make the user balance in each room add to 1000",zrf:n})}async function SP(e){var t;let n=xP();EP("Generating structured json query"),EP("Requesting chat completion");const r=null===(t=(await n.beta.chat.completions.parse(e)).choices[0])||void 0===t?void 0:t.message;return(null==r?void 0:r.parsed)?(EP("Successfully parsed the message"),r.parsed):(EP("Failed to parse response"),EP(r),null)}async function NP(e,t){try{let n=xP();return(await n.embeddings.create({input:e,model:"text-embedding-3-large",dimensions:t})).data[0].embedding}catch(e){throw console.error("Error fetching embedding:",e),e}}var jP="\n";const DP="{patientInformation}",RP="{supplementaryInformation}";var LP=` \nYou are an expert clinical decision support pharmacist that identifies medications within a patient patientInformationn text and providesextracts the medications along with supplemental data in structured format.  \n\n<patientInformation> \n${DP} \n</patientInformation> \n\nYour json output consists of an array of medication objects. \nEach objects contains the fields: name, medication_class, intended_effects, adverse_effects , interacts_with_medication , interacts_with_class. \nname is the name of the medication. \nmedication_class is the medication's class or pharmacologic category \nintended_effects is a list of the intended effect of the medication. \nadverse_effects is a list of the most common adverse effects of the medication.\ninteracts_with_medication is a short list of the medications which can interact with this medication to create a dangerous effect. \ninteracts_with_class is a short list of the medication classes which can interact with this medication to create a dangerous effect.  \n\nDo not guess or extrapolate. \n`;let MP=Uw({name:Fw(),medication_class:Fw(),intended_effects:Bw(Fw()),adverse_effects:Bw(Fw()),interacts_with_medication:Bw(Fw()),interacts_with_class:Bw(Fw())});var $P=IP(Uw({data:Bw(MP)}),"medication_extraction"),FP={prompt:LP,rf:$P},VP=`\nYou are an expert clinical decision support pharmacist that provides unique and valuable feedback to the user. \nYou focus on identifying medication adverse effects and interactions that should be noted.\nCarefully consider this patient and supplementary information:\n\n<patientInformation> \n${DP}\n</patientInformation> \n\n<supplementaryInformation> \n${RP}\n</supplementaryInformation> \n\nProvide a list of recommendations for the user in the following format:\n\nThe json output consists of an array of recommendation objects. \nEach object contains the fields: action, data, reasoning, caveat. \naction is one of the following: start, stop, increase, decrease \ndata is the name of the medication \nreasoning is a concise explanation of your thought process \ncaveat is additional information that should be taken into consideration, or an alternative viewpoint \n\nDo not recommend actions that that the user is already taking. \n`,zP=`\nYou are an expert clinical decision support pharmacist that provides unique and valuable feedback to the user. \nYou focus on identifying medication adverse effects and interactions that should be noted.\nCarefully consider this patient and supplementary information:\n\n<patientInformation> \n${DP}\n</patientInformation> \n\nProvide a list of recommendations for the user in the following format:\n\nThe json output consists of an array of recommendation objects. \nEach object contains the fields: action, data, reasoning, caveat. \naction is one of the following: start, stop, increase, decrease \ndata is the name of the medication \nreasoning is a concise explanation of your thought process \ncaveat is additional information that should be taken into consideration, or an alternative viewpoint \n\nDo not recommend actions that that the user is already taking. \n`;let BP=Uw({action:Fw(),data:Fw(),reasoning:Fw(),caveat:Fw()});var UP=IP(Uw({data:Bw(BP)}),"medication_extraction"),HP={prompt:VP,rf:UP},GP={prompt:zP,rf:UP},qP="\n",KP="esrd_hyperkalemia_losartan",WP="This test case describes a patient with ESRD on HD and HTN that is admitted with hyperkalemia. The plan states to continue losartan however it should be identified that losartan should be held in order to prevent further episodes of hyperkalemia",JP="\n# History and Physical\n\n## Chief Complaint\nHyperkalemia and hypertension\n\n## One-liner\nA 46-year-old male with end-stage renal disease (ESRD) on hemodialysis (HD) presents with hyperkalemia and hypertension.\n\n## History of Present Illness\nThe patient is a 46-year-old male with a known history of end-stage renal disease on thrice-weekly hemodialysis who presents to the emergency department with laboratory-confirmed hyperkalemia. He reports that he missed his last dialysis session three days ago due to transportation issues, and since then, he has experienced intermittent palpitations and mild fatigue but denies any chest pain, shortness of breath, muscle weakness, or sensory changes. The patient also reports poorly controlled blood pressure over the past week despite adherence to his home antihypertensive regimen. He denies any recent dietary indiscretions or changes in liquid intake. No recent episodes of fever, cough, or diarrhea. \n\n## Emergency Department Course\nUpon presentation, the patient's vital signs were as follows: blood pressure 178/96 mmHg, heart rate 88 bpm, respiratory rate 18 breaths/min, temperature 98.4°F, and oxygen saturation 96% on room air. Laboratory tests revealed a serum potassium level of 6.8 mmol/L, elevated blood urea nitrogen (BUN) at 60 mg/dL, and creatinine at 9.5 mg/dL, consistent with ESRD. An EKG showed peaked T waves suggestive of hyperkalemia but no arrhythmias were present. The patient was given calcium gluconate 10% intravenously to stabilize cardiac membranes, insulin with dextrose for shifting potassium intracellularly, and received his scheduled dialysis session to remove excess potassium. Additionally, he was given furosemide to aid in the management of blood pressure and hyperkalemia.\n\n## Medications\n- Amlodipine 10 mg daily\n- Hydrochlorothiazide 25 mg daily\n- Losartan 50 mg daily\n\n## Allergies\nNo known drug allergies\n\n## Past Surgical History\nNone\n\n## Social History\nThe patient is a former smoker, quitting 5 years ago, and denies any illicit drug use. He occasionally consumes alcohol but denies drinking in the past month. He lives alone in an apartment and relies on public transportation.\n\n## Objective Data\n- **Vital Signs:** Blood Pressure: 150/94 mmHg, Heart Rate: 82 bpm, Respiratory Rate: 18 breaths/min, Temperature: 98.4°F, O2 Saturation: 96% on room air.\n- **Physical Exam:**\n  - **General:** The patient appears alert, oriented, and in no acute distress.\n  - **Cardiovascular:** Regular rate and rhythm, no murmurs, rubs, or gallops.\n  - **Respiratory:** Breath sounds clear bilaterally, no wheezes, rales, or rhonchi.\n  - **Abdomen:** Soft, non-tender, nondistended, normal bowel sounds.\n  - **Neurological:** No focal deficits, cranial nerves intact, strength 5/5 in all extremities.\n- **Laboratory Results:**\n  - Potassium: 6.8 mmol/L (decreased post-HD to 4.9 mmol/L)\n  - BUN: 60 mg/dL\n  - Creatinine: 9.5 mg/dL\n- **EKG Findings:** Peaked T waves, no ST-elevation or arrhythmias.\n\n## Assessment and Plan\n\n1. **Hyperkalemia**\n   - **Assessment:** The patient's hyperkalemia is likely due to missed dialysis in the context of ESRD. Initial treatment in the emergency department has been effective in lowering potassium levels.\n   - **Plan:** Continue regular dialysis sessions to manage potassium levels. Monitor potassium post-dialysis. Educate the patient on the importance of adherence to dialysis schedule.\n\n2. **Hypertension**\n   - **Assessment:** Poorly controlled hypertension, likely exacerbated by volume overload due to missed dialysis. \n   - **Plan:** Continue home antihypertensive regimen including amlodipine, hydrochlorothiazide, and losartan\n\n3. **End-Stage Renal Disease**\n   - **Assessment:** Stable ESRD on HD, complications related to missed dialysis.\n   - **Plan:** Optimize dialysis schedule adherence. Consider social work referral for transportation assistance or home dialysis evaluation. Regular follow-ups with nephrology.\n\nThe patient will be admitted for continuous monitoring and further management of hypertension post-dialysis.\n",ZP="copd_vap",QP="This test describes a COPD patient who presents with a COPD exacerbation and is intubated on admission. Several days later he develops pneumonia and is started on ceftriaxone. The correct response should suggest broadening antibiotics to include coverage for ventilaor acquired pneumonia",XP="\n# History and Physical\n\n## Chief Complaint\n**Pneumonia**\n\n## One-Liner\nA 65-year-old male with a history of COPD and hypertension is admitted with respiratory failure, currently on a ventilator due to suspected pneumonia.\n\n## History of Present Illness\nThe patient is a 65-year-old male with a significant medical history of chronic obstructive pulmonary disease (COPD) and hypertension, who was admitted to the hospital one week ago due to acute respiratory failure. Upon admission, the patient was intubated and placed on a mechanical ventilator. Over the past several days, the patient's respiratory status has shown minimal improvement, prompting further investigation. A chest X-ray revealed diffuse bilateral infiltrates suggestive of pneumonia. Given these findings, the decision was made to start the patient on ceftriaxone for suspected bacterial pneumonia. The patient has been febrile intermittently and has noted an increase in respiratory secretions, which are purulent in appearance. Blood cultures were obtained, and sputum samples were sent for gram stain and culture to identify any infectious organisms.\n\n## Emergency Department Course\nOn presentation, the patient's vital signs were significant for hypoxia and tachycardia. Initial labs revealed leukocytosis with a WBC count of 14,000/mm³ and an elevated C-reactive protein. Arterial blood gas showed severe hypoxemia. A chest X-ray demonstrated bilateral interstitial infiltrates. The patient was intubated for respiratory failure and started on ceftriaxone. Continuous monitoring of the patient's condition was conducted, with repeat chest imaging and labs every 48 hours to assess for changes in the clinical picture.\n\n## Medications\n- **Ceftriaxone** 1g IV every 24 hours  \n- **Lisinopril** 10mg PO daily  \n- **Albuterol inhaler** 2 puffs every 4 hours as needed  \n- **Prednisone** 40mg PO daily  \n\n## Allergies\n- **Penicillin** (rash)\n\n## Past Surgical History\n- Appendectomy at age 22  \n- Right total knee replacement 3 years ago  \n\n## Social History\n- Former smoker, quit 10 years ago, 30 pack-year history  \n- No illicit drug use  \n- Alcohol: occasional, 1-2 drinks per month  \n- Lives with spouse in a single-family home  \n\n## Objective Data\n\n### Vital Signs\n- **Temperature:** 100.4°F  \n- **Heart rate:** 98 bpm  \n- **Respiratory rate:** 18 breaths/min (ventilated)  \n- **Blood pressure:** 135/85 mmHg  \n- **Oxygen saturation:** 94% on ventilator settings of FiO2 40%  \n\n### Physical Exam\n- **General:** Sedated and intubated, appearing mildly distressed  \n- **Lungs:** Decreased breath sounds bilaterally, rhonchi present  \n- **Cardiovascular:** Regular rate and rhythm, no murmurs  \n- **Abdomen:** Soft, non-tender, no organomegaly  \n- **Extremities:** No edema  \n\n### Laboratory/Imaging\n- **WBC:** 14,000/mm³  \n- **C-reactive protein:** Elevated  \n- **Chest X-ray:** Bilateral diffuse infiltrates consistent with pneumonia  \n- **Arterial Blood Gas:** pH 7.32, PaCO2 55 mmHg, PaO2 60 mmHg  \n\n## Assessment and Plan\n\n1. **Suspected Bacterial Pneumonia**\n   - **Assessment:** Bilateral infiltrates on chest X-ray and clinical presentation suggest pneumonia, likely bacterial in origin. Purulent respiratory secretions and recent intubation history further support this diagnosis.\n   - **Plan:** Continue ceftriaxone.  \n\n2. **Acute Respiratory Failure**\n   - **Assessment:** Respiratory failure necessitated intubation and mechanical ventilation, likely secondary to pneumonia on a background of COPD.\n   - **Plan:** Continue ventilatory support with daily ABG checks, titrate FiO2 to maintain adequate oxygenation, pulmonary hygiene, and physiotherapy as tolerated.  \n\n3. **COPD Exacerbation**\n   - **Assessment:** Underlying COPD may have been exacerbated by pneumonia, contributing to respiratory failure.\n   - **Plan:** Continue bronchodilator therapy, taper prednisone as patient stabilizes, monitor for signs of improvement in lung function.  \n\n4. **Hypertension**\n   - **Assessment:** Previously well-controlled on lisinopril. Blood pressure within normal limits currently.\n   - **Plan:** Continue lisinopril, monitor blood pressure daily. Adjust anti-hypertensive therapy if necessary.\n",YP=i(46),eT={temperature:0};class tT extends YP.EventEmitter{constructor(e){super(),this.name=e.name,this.model=e.model,this.logger=ft({id:`amie:${e.name}`})}init(){this.log(`Created engine ${this.name} with model ${this.model}`)}log(e){this.logger(e),this.emit("log",{data:e})}async structured_completion(e){let{prompt:t,response_format:n}=e,r=[{role:"user",content:t}],i=this.model,a=Object.assign(Object.assign({},eT),{messages:r,model:i,response_format:n});this.log("Request to call structured completion"),Ad("SC_ARGS",a);let s=await fetch("https://www.tidyscripts.com/api/openai_structured_completion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await s.json()}}const{patient_information_placeholder:nT,supplementary_information_placeholder:rT,extraction:iT,evaluation:aT,evaluation_without_supplementary_data:sT}=k;class oT extends tT{constructor(e){let{supplementary_data:t,verbose:n=!0}=e;!function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}}(e,["supplementary_data","verbose"]),super(e),this.supplementary_data=t,this.verbose=n}async extract_medication_information(e){let t=iT.prompt.replace(nT,e),n=iT.rf,r=await this.structured_completion({prompt:t,response_format:n});return this.log("Got extraction result"),Ad("extraction_result",r),this.verbose&&this.log(r),r}async build_prompt(e){var t;if(this.supplementary_data){this.log("running WITH supplementary data");let n=await this.extract_medication_information(e);t=aT.prompt.replace(nT,e).replace(rT,JSON.stringify(n))}else this.log("running WITHOUT supplementary data"),t=sT.prompt.replace(nT,e);return t}async evaluate(e){let t=await this.build_prompt(e),n=aT.rf,r=await this.structured_completion({prompt:t,response_format:n});return this.log("Got evaluation result"),Ad("evaluation_result",r),this.verbose&&this.log(r),r}}const lT=ft({id:"tamie"});function uT(){lT("init")}async function cT(){uT();let e=T,t=new oT({model:"gpt-4o",name:"me-4o-data",supplementary_data:!0}),n=new oT({model:"gpt-4o",name:"me-4o",supplementary_data:!1}),r=await t.evaluate(e.hp),i=await n.evaluate(e.hp);return{me_4o_data:t,me_4o:n,me_4o_data_result:r,me_4o_result:i}}const hT=ft({id:"amie"});function dT(){hT("init")}const pT={methods:{one:{},two:{},three:{},four:{}},model:{one:{},two:{},three:{}},compute:{},hooks:[]},fT={compute:function(e){const{world:t}=this,n=t.compute;return"string"==typeof e&&n.hasOwnProperty(e)?n[e](this):(e=>"[object Array]"===Object.prototype.toString.call(e))(e)?e.forEach((r=>{t.compute.hasOwnProperty(r)?n[r](this):console.warn("no compute:",e)})):"function"==typeof e?e(this):console.warn("no compute:",e),this}},mT=fT,gT={forEach:function(e){return this.fullPointer.forEach(((t,n)=>{let r=this.update([t]);e(r,n)})),this},map:function(e,t){let n=this.fullPointer.map(((t,n)=>{let r=this.update([t]),i=e(r,n);return void 0===i?this.none():i}));if(0===n.length)return t||this.update([]);if(void 0!==n[0]){if("string"==typeof n[0])return n;if("object"==typeof n[0]&&(null===n[0]||!n[0].isView))return n}let r=[];return n.forEach((e=>{r=r.concat(e.fullPointer)})),this.toView(r)},filter:function(e){let t=this.fullPointer;return t=t.filter(((t,n)=>{let r=this.update([t]);return e(r,n)})),this.update(t)},find:function(e){let t=this.fullPointer.find(((t,n)=>{let r=this.update([t]);return e(r,n)}));return this.update([t])},some:function(e){return this.fullPointer.some(((t,n)=>{let r=this.update([t]);return e(r,n)}))},random:function(e=1){let t=this.fullPointer,n=Math.floor(Math.random()*t.length);return n+e>this.length&&(n=this.length-e,n=n<0?0:n),t=t.slice(n,n+e),this.update(t)}},yT={termList:function(){return this.methods.one.termList(this.docs)},terms:function(e){let t=this.match(".");return"number"==typeof e?t.eq(e):t},groups:function(e){if(e||0===e)return this.update(this._groups[e]||[]);let t={};return Object.keys(this._groups).forEach((e=>{t[e]=this.update(this._groups[e])})),t},eq:function(e){let t=this.pointer;return t||(t=this.docs.map(((e,t)=>[t]))),t[e]?this.update([t[e]]):this.none()},first:function(){return this.eq(0)},last:function(){let e=this.fullPointer.length-1;return this.eq(e)},firstTerms:function(){return this.match("^.")},lastTerms:function(){return this.match(".$")},slice:function(e,t){let n=this.pointer||this.docs.map(((e,t)=>[t]));return n=n.slice(e,t),this.update(n)},all:function(){return this.update().toView()},fullSentences:function(){let e=this.fullPointer.map((e=>[e[0]]));return this.update(e).toView()},none:function(){return this.update([])},isDoc:function(e){if(!e||!e.isView)return!1;let t=this.fullPointer,n=e.fullPointer;return!t.length!==n.length&&t.every(((e,t)=>!!n[t]&&e[0]===n[t][0]&&e[1]===n[t][1]&&e[2]===n[t][2]))},wordCount:function(){return this.docs.reduce(((e,t)=>e+t.filter((e=>""!==e.text)).length),0)},isFull:function(){let e=this.pointer;if(!e)return!0;if(0===e.length||0!==e[0][0])return!1;let t=0,n=0;return this.document.forEach((e=>t+=e.length)),this.docs.forEach((e=>n+=e.length)),t===n},getNth:function(e){return"number"==typeof e?this.eq(e):"string"==typeof e?this.if(e):this}};yT.group=yT.groups,yT.fullSentence=yT.fullSentences,yT.sentence=yT.fullSentences,yT.lastTerm=yT.lastTerms,yT.firstTerm=yT.firstTerms;const vT=yT,bT=Object.assign({},vT,mT,gT);bT.get=bT.eq;const wT=bT;class _T{constructor(e,t,n={}){[["document",e],["world",pT],["_groups",n],["_cache",null],["viewType","View"]].forEach((e=>{Object.defineProperty(this,e[0],{value:e[1],writable:!0})})),this.ptrs=t}get docs(){let e=this.document;return this.ptrs&&(e=pT.methods.one.getDoc(this.ptrs,this.document)),e}get pointer(){return this.ptrs}get methods(){return this.world.methods}get model(){return this.world.model}get hooks(){return this.world.hooks}get isView(){return!0}get found(){return this.docs.length>0}get length(){return this.docs.length}get fullPointer(){let{docs:e,ptrs:t,document:n}=this,r=t||e.map(((e,t)=>[t]));return r.map((e=>{let[t,r,i,a,s]=e;return r=r||0,i=i||(n[t]||[]).length,n[t]&&n[t][r]&&(a=a||n[t][r].id,n[t][i-1]&&(s=s||n[t][i-1].id)),[t,r,i,a,s]}))}update(e){let t=new _T(this.document,e);if(this._cache&&e&&e.length>0){let n=[];e.forEach(((e,t)=>{let[r,i,a]=e;(1===e.length||0===i&&this.document[r].length===a)&&(n[t]=this._cache[r])})),n.length>0&&(t._cache=n)}return t.world=this.world,t}toView(e){return new _T(this.document,e||this.pointer)}fromText(e){const{methods:t}=this;let n=t.one.tokenize.fromString(e,this.world),r=new _T(n);return r.world=this.world,r.compute(["normal","freeze","lexicon"]),this.world.compute.preTagger&&r.compute("preTagger"),r.compute("unfreeze"),r}clone(){let e=this.document.slice(0);e=e.map((e=>e.map((e=>((e=Object.assign({},e)).tags=new Set(e.tags),e)))));let t=this.update(this.pointer);return t.document=e,t._cache=this._cache,t}}Object.assign(_T.prototype,wT);const kT=_T,AT=function(e){return e&&"object"==typeof e&&!Array.isArray(e)};function PT(e,t){if(AT(t))for(const n in t)AT(t[n])?(e[n]||Object.assign(e,{[n]:{}}),PT(e[n],t[n])):Object.assign(e,{[n]:t[n]});return e}const TT=function(e,t,n,r){const{methods:i,model:a,compute:s,hooks:o}=t;e.methods&&function(e,t){for(const n in t)e[n]=e[n]||{},Object.assign(e[n],t[n])}(i,e.methods),e.model&&PT(a,e.model),e.irregulars&&function(e,t){let n=e.two.models||{};Object.keys(t).forEach((e=>{t[e].pastTense&&(n.toPast&&(n.toPast.ex[e]=t[e].pastTense),n.fromPast&&(n.fromPast.ex[t[e].pastTense]=e)),t[e].presentTense&&(n.toPresent&&(n.toPresent.ex[e]=t[e].presentTense),n.fromPresent&&(n.fromPresent.ex[t[e].presentTense]=e)),t[e].gerund&&(n.toGerund&&(n.toGerund.ex[e]=t[e].gerund),n.fromGerund&&(n.fromGerund.ex[t[e].gerund]=e)),t[e].comparative&&(n.toComparative&&(n.toComparative.ex[e]=t[e].comparative),n.fromComparative&&(n.fromComparative.ex[t[e].comparative]=e)),t[e].superlative&&(n.toSuperlative&&(n.toSuperlative.ex[e]=t[e].superlative),n.fromSuperlative&&(n.fromSuperlative.ex[t[e].superlative]=e))}))}(a,e.irregulars),e.compute&&Object.assign(s,e.compute),o&&(t.hooks=o.concat(e.hooks||[])),e.api&&e.api(n),e.lib&&Object.keys(e.lib).forEach((t=>r[t]=e.lib[t])),e.tags&&r.addTags(e.tags),e.words&&r.addWords(e.words),e.frozen&&r.addWords(e.frozen,!0),e.mutate&&e.mutate(t,r)},IT=function(e){return"[object Array]"===Object.prototype.toString.call(e)},ET=function(e,t,n){const{methods:r}=n;let i=new t([]);if(i.world=n,"number"==typeof e&&(e=String(e)),!e)return i;if("string"==typeof e)return new t(r.one.tokenize.fromString(e,n));if(a=e,"[object Object]"===Object.prototype.toString.call(a)&&e.isView)return new t(e.document,e.ptrs);var a;if(IT(e)){if(IT(e[0])){let n=e.map((e=>e.map((e=>({text:e,normal:e,pre:"",post:" ",tags:new Set})))));return new t(n)}let n=function(e){return e.map((e=>e.terms.map((e=>(IT(e.tags)&&(e.tags=new Set(e.tags)),e)))))}(e);return new t(n)}return i};let xT=Object.assign({},pT);const CT=function(e,t){t&&CT.addWords(t);let n=ET(e,kT,xT);return e&&n.compute(xT.hooks),n};Object.defineProperty(CT,"_world",{value:xT,writable:!0}),CT.tokenize=function(e,t){const{compute:n}=this._world;t&&CT.addWords(t);let r=ET(e,kT,xT);return n.contractions&&r.compute(["alias","normal","machine","contractions"]),r},CT.plugin=function(e){return TT(e,this._world,kT,this),this},CT.extend=CT.plugin,CT.world=function(){return this._world},CT.model=function(){return this._world.model},CT.methods=function(){return this._world.methods},CT.hooks=function(){return this._world.hooks},CT.verbose=function(e){const t="undefined"!=typeof process&&process.env?process.env:self.env||{};return t.DEBUG_TAGS="tagger"===e||!0===e||"",t.DEBUG_MATCH="match"===e||!0===e||"",t.DEBUG_CHUNKS="chunker"===e||!0===e||"",this},CT.version="14.14.4";const OT=CT,ST={cache:function(){return this._cache=this.methods.one.cacheDoc(this.document),this},uncache:function(){return this._cache=null,this}},NT={api:function(e){Object.assign(e.prototype,ST)},compute:{cache:function(e){e._cache=e.methods.one.cacheDoc(e.document)}},methods:{one:{cacheDoc:function(e){let t=e.map((e=>{let t=new Set;return e.forEach((e=>{""!==e.normal&&t.add(e.normal),e.switch&&t.add(`%${e.switch}%`),e.implicit&&t.add(e.implicit),e.machine&&t.add(e.machine),e.root&&t.add(e.root),e.alias&&e.alias.forEach((e=>t.add(e)));let n=Array.from(e.tags);for(let e=0;e<n.length;e+=1)t.add("#"+n[e])})),t}));return t}}}},jT=e=>/^\p{Lu}[\p{Ll}'’]/u.test(e)||/^\p{Lu}$/u.test(e),DT=(e,t,n)=>{if(n.forEach((e=>e.dirty=!0)),e){let r=[t,0].concat(n);Array.prototype.splice.apply(e,r)}return e},RT=function(e){let t=e[e.length-1];!t||/ $/.test(t.post)||/[-–—]/.test(t.post)||(t.post+=" ")},LT=(e,t,n)=>{const r=/[-.?!,;:)–—'"]/g;let i=e[t-1];if(!i)return;let a=i.post;if(r.test(a)){let e=a.match(r).join(""),t=n[n.length-1];t.post=e+t.post,i.post=i.post.replace(r,"")}};let MT=0;const $T=e=>(e=e.length<3?"0"+e:e).length<3?"0"+e:e,FT=function(e){let[t,n]=e.index||[0,0];MT+=1,MT=MT>46655?0:MT,t=t>46655?0:t,n=n>1294?0:n;let r=$T(MT.toString(36));r+=$T(t.toString(36));let i=n.toString(36);return i=i.length<2?"0"+i:i,r+=i,r+=parseInt(36*Math.random(),10).toString(36),e.normal+"|"+r.toUpperCase()},VT=function(e){e.has("@hasContraction")&&"function"==typeof e.contractions&&e.grow("@hasContraction").contractions().expand()},zT=e=>"[object Array]"===Object.prototype.toString.call(e),BT=function(e,t,n){const{document:r,world:i}=t;t.uncache();let a=t.fullPointer,s=t.fullPointer;t.forEach(((o,l)=>{let u=o.fullPointer[0],[c]=u,h=r[c],d=function(e,t){const{methods:n}=t;return"string"==typeof e?n.one.tokenize.fromString(e,t)[0]:"object"==typeof e&&e.isView?e.clone().docs[0]||[]:zT(e)?zT(e[0])?e[0]:e:[]}(e,i);0!==d.length&&(d=function(e){return e.map((e=>(e.id=FT(e),e)))}(d),n?(VT(t.update([u]).firstTerm()),function(e,t,n,r){let[i,a,s]=t;0===a||s===r[i].length?RT(n):(RT(n),RT([e[t[1]]])),function(e,t,n){let r=e[t];if(0!==t||!jT(r.text))return;n[0].text=(e=>e.replace(/^\p{Ll}/u,(e=>e.toUpperCase())))(n[0].text);let i=e[t];i.tags.has("ProperNoun")||i.tags.has("Acronym")||jT(i.text)&&i.text.length>1&&(i.text=(e=>e.replace(/^\p{Lu}/u,(e=>e.toLowerCase())))(i.text))}(e,a,n),DT(e,a,n)}(h,u,d,r)):(VT(t.update([u]).lastTerm()),function(e,t,n,r){let[i,,a]=t,s=(r[i]||[]).length;a<s?(LT(e,a,n),RT(n)):s===a&&(RT(e),LT(e,a,n),r[i+1]&&(n[n.length-1].post+=" ")),DT(e,t[2],n),t[4]=n[n.length-1].id}(h,u,d,r)),r[c]&&r[c][u[1]]&&(u[3]=r[c][u[1]].id),s[l]=u,u[2]+=d.length,a[l]=u)}));let o=t.toView(a);return t.ptrs=s,o.compute(["id","index","freeze","lexicon"]),o.world.compute.preTagger&&o.compute("preTagger"),o.compute("unfreeze"),o},UT={insertAfter:function(e){return BT(e,this,!1)},insertBefore:function(e){return BT(e,this,!0)}};UT.append=UT.insertAfter,UT.prepend=UT.insertBefore,UT.insert=UT.insertAfter;const HT=UT,GT=/\$[0-9a-z]+/g,qT={},KT=e=>e.replace(/^\p{Ll}/u,(e=>e.toUpperCase())),WT=e=>e.replace(/^\p{Lu}/u,(e=>e.toLowerCase()));qT.replaceWith=function(e,t={}){let n=this.fullPointer,r=this;if(this.uncache(),"function"==typeof e)return function(e,t,n){return e.forEach((e=>{let r=t(e);e.replaceWith(r,n)})),e}(r,e,t);let i=r.docs[0];if(!i)return r;let a=t.possessives&&i[i.length-1].tags.has("Possessive"),s=t.case&&(e=>/^\p{Lu}[\p{Ll}'’]/u.test(e)||/^\p{Lu}$/u.test(e))(i[0].text);e=function(e,t){if("string"!=typeof e)return e;let n=t.groups();return e=e.replace(GT,(e=>{let t=e.replace(/\$/,"");return n.hasOwnProperty(t)?n[t].text():e})),e}(e,r);let o=this.update(n);n=n.map((e=>e.slice(0,3)));let l=(o.docs[0]||[]).map((e=>Array.from(e.tags))),u=o.docs[0][0].pre,c=o.docs[0][o.docs[0].length-1].post;if("string"==typeof e&&(e=this.fromText(e).compute("id")),r.insertAfter(e),o.has("@hasContraction")&&r.contractions&&r.grow("@hasContraction+").contractions().expand(),r.delete(o),a){let e=r.docs[0],t=e[e.length-1];t.tags.has("Possessive")||(t.text+="'s",t.normal+="'s",t.tags.add("Possessive"))}if(u&&r.docs[0]&&(r.docs[0][0].pre=u),c&&r.docs[0]){let e=r.docs[0][r.docs[0].length-1];e.post.trim()||(e.post=c)}let h=r.toView(n).compute(["index","freeze","lexicon"]);if(h.world.compute.preTagger&&h.compute("preTagger"),h.compute("unfreeze"),t.tags&&h.terms().forEach(((e,t)=>{e.tagSafe(l[t])})),!h.docs[0]||!h.docs[0][0])return h;if(t.case){let e=s?KT:WT;h.docs[0][0].text=e(h.docs[0][0].text)}return h},qT.replace=function(e,t,n){if(e&&!t)return this.replaceWith(e,n);let r=this.match(e);return r.found?(this.soften(),r.replaceWith(t,n)):this};const JT=qT,ZT={remove:function(e){const{indexN:t}=this.methods.one.pointer;this.uncache();let n=this.all(),r=this;e&&(n=this,r=this.match(e));let i=!n.ptrs;r.has("@hasContraction")&&r.contractions&&r.grow("@hasContraction").contractions().expand();let a=n.fullPointer,s=r.fullPointer.reverse(),o=function(e,t){t.forEach((t=>{let[n,r,i]=t,a=i-r;e[n]&&(i===e[n].length&&i>1&&function(e,t){let n=e.length-1,r=e[n],i=e[n-t];i&&r&&(i.post+=r.post,i.post=i.post.replace(/ +([.?!,;:])/,"$1"),i.post=i.post.replace(/[,;:]+([.?!])/,"$1"))}(e[n],a),e[n].splice(r,a))}));for(let t=e.length-1;t>=0;t-=1)if(0===e[t].length&&(e.splice(t,1),t===e.length&&e[t-1])){let n=e[t-1],r=n[n.length-1];r&&(r.post=r.post.trimEnd())}return e}(this.document,s);return a=function(e,t){return e=e.map((e=>{let[n]=e;return t[n]?(t[n].forEach((t=>{let n=t[2]-t[1];e[1]<=t[1]&&e[2]>=t[2]&&(e[2]-=n)})),e):e})),e.forEach(((t,n)=>{if(0===t[1]&&0==t[2])for(let t=n+1;t<e.length;t+=1)e[t][0]-=1,e[t][0]<0&&(e[t][0]=0)})),e=(e=e.filter((e=>e[2]-e[1]>0))).map((e=>(e[3]=null,e[4]=null,e)))}(a,t(s)),n.ptrs=a,n.document=o,n.compute("index"),i&&(n.ptrs=void 0),e?n.toView(a):(this.ptrs=[],n.none())}};ZT.delete=ZT.remove;const QT=ZT,XT={pre:function(e,t){return void 0===e&&this.found?this.docs[0][0].pre:(this.docs.forEach((n=>{let r=n[0];!0===t?r.pre+=e:r.pre=e})),this)},post:function(e,t){if(void 0===e){let e=this.docs[this.docs.length-1];return e[e.length-1].post}return this.docs.forEach((n=>{let r=n[n.length-1];!0===t?r.post+=e:r.post=e})),this},trim:function(){if(!this.found)return this;let e=this.docs,t=e[0][0];t.pre=t.pre.trimStart();let n=e[e.length-1],r=n[n.length-1];return r.post=r.post.trimEnd(),this},hyphenate:function(){return this.docs.forEach((e=>{e.forEach(((t,n)=>{0!==n&&(t.pre=""),e[n+1]&&(t.post="-")}))})),this},dehyphenate:function(){const e=/[-–—]/;return this.docs.forEach((t=>{t.forEach((t=>{e.test(t.post)&&(t.post=" ")}))})),this},toQuotations:function(e,t){return e=e||'"',t=t||'"',this.docs.forEach((n=>{n[0].pre=e+n[0].pre;let r=n[n.length-1];r.post=t+r.post})),this},toParentheses:function(e,t){return e=e||"(",t=t||")",this.docs.forEach((n=>{n[0].pre=e+n[0].pre;let r=n[n.length-1];r.post=t+r.post})),this}};XT.deHyphenate=XT.dehyphenate,XT.toQuotation=XT.toQuotations;const YT=XT,eI={alpha:(e,t)=>e.normal<t.normal?-1:e.normal>t.normal?1:0,length:(e,t)=>{let n=e.normal.trim().length,r=t.normal.trim().length;return n<r?1:n>r?-1:0},wordCount:(e,t)=>e.words<t.words?1:e.words>t.words?-1:0,sequential:(e,t)=>e[0]<t[0]?1:e[0]>t[0]?-1:e[1]>t[1]?1:-1,byFreq:function(e){let t={};return e.forEach((e=>{t[e.normal]=t[e.normal]||0,t[e.normal]+=1})),e.sort(((e,n)=>{let r=t[e.normal],i=t[n.normal];return r<i?1:r>i?-1:0})),e}},tI=new Set(["index","sequence","seq","sequential","chron","chronological"]),nI=new Set(["freq","frequency","topk","repeats"]),rI=new Set(["alpha","alphabetical"]),iI={unique:function(){let e=new Set,t=this.filter((t=>{let n=t.text("machine");return!e.has(n)&&(e.add(n),!0)}));return t},reverse:function(){let e=this.pointer||this.docs.map(((e,t)=>[t]));return e=[].concat(e),e=e.reverse(),this._cache&&(this._cache=this._cache.reverse()),this.update(e)},sort:function(e){let{docs:t,pointer:n}=this;if(this.uncache(),"function"==typeof e)return function(e,t){let n=e.fullPointer;return n=n.sort(((n,r)=>(n=e.update([n]),r=e.update([r]),t(n,r)))),e.ptrs=n,e}(this,e);e=e||"alpha";let r=n||t.map(((e,t)=>[t])),i=t.map(((e,t)=>({index:t,words:e.length,normal:e.map((e=>e.machine||e.normal||"")).join(" "),pointer:r[t]})));return tI.has(e)&&(e="sequential"),rI.has(e)&&(e="alpha"),nI.has(e)?(i=eI.byFreq(i),this.update(i.map((e=>e.pointer)))):"function"==typeof eI[e]?(i=i.sort(eI[e]),this.update(i.map((e=>e.pointer)))):this}},aI=function(e,t){if(e.length>0){let t=e[e.length-1],n=t[t.length-1];!1===/ /.test(n.post)&&(n.post+=" ")}return e.concat(t)},sI={concat:function(e){if("string"==typeof e){let t=this.fromText(e);if(this.found&&this.ptrs){let e=this.fullPointer,n=e[e.length-1][0];this.document.splice(n,0,...t.document)}else this.document=this.document.concat(t.document);return this.all().compute("index")}if("object"==typeof e&&e.isView)return function(e,t){if(e.document===t.document){let n=e.fullPointer.concat(t.fullPointer);return e.toView(n).compute("index")}return t.fullPointer.forEach((t=>{t[0]+=e.document.length})),e.document=aI(e.document,t.docs),e.all()}(this,e);if(t=e,"[object Array]"===Object.prototype.toString.call(t)){let t=aI(this.document,e);return this.document=t,this.all()}var t;return this}},oI=Object.assign({},{toLowerCase:function(){return this.termList().forEach((e=>{e.text=e.text.toLowerCase()})),this},toUpperCase:function(){return this.termList().forEach((e=>{e.text=e.text.toUpperCase()})),this},toTitleCase:function(){return this.termList().forEach((e=>{e.text=e.text.replace(/^ *[a-z\u00C0-\u00FF]/,(e=>e.toUpperCase()))})),this},toCamelCase:function(){return this.docs.forEach((e=>{e.forEach(((t,n)=>{0!==n&&(t.text=t.text.replace(/^ *[a-z\u00C0-\u00FF]/,(e=>e.toUpperCase()))),n!==e.length-1&&(t.post="")}))})),this}},HT,JT,QT,YT,iI,sI,{harden:function(){return this.ptrs=this.fullPointer,this},soften:function(){let e=this.ptrs;return!e||e.length<1||(e=e.map((e=>e.slice(0,3))),this.ptrs=e),this}}),lI={id:function(e){let t=e.docs;for(let e=0;e<t.length;e+=1)for(let n=0;n<t[e].length;n+=1){let r=t[e][n];r.id=r.id||FT(r)}}},uI={api:function(e){Object.assign(e.prototype,oI)},compute:lI},cI=!0,hI={one:{contractions:[{word:"@",out:["at"]},{word:"arent",out:["are","not"]},{word:"alot",out:["a","lot"]},{word:"brb",out:["be","right","back"]},{word:"cannot",out:["can","not"]},{word:"dun",out:["do","not"]},{word:"can't",out:["can","not"]},{word:"shan't",out:["should","not"]},{word:"won't",out:["will","not"]},{word:"that's",out:["that","is"]},{word:"what's",out:["what","is"]},{word:"let's",out:["let","us"]},{word:"dunno",out:["do","not","know"]},{word:"gonna",out:["going","to"]},{word:"gotta",out:["have","got","to"]},{word:"gimme",out:["give","me"]},{word:"outta",out:["out","of"]},{word:"tryna",out:["trying","to"]},{word:"gtg",out:["got","to","go"]},{word:"im",out:["i","am"]},{word:"imma",out:["I","will"]},{word:"imo",out:["in","my","opinion"]},{word:"irl",out:["in","real","life"]},{word:"ive",out:["i","have"]},{word:"rn",out:["right","now"]},{word:"tbh",out:["to","be","honest"]},{word:"wanna",out:["want","to"]},{word:"c'mere",out:["come","here"]},{word:"c'mon",out:["come","on"]},{word:"shoulda",out:["should","have"]},{word:"coulda",out:["coulda","have"]},{word:"woulda",out:["woulda","have"]},{word:"musta",out:["must","have"]},{word:"tis",out:["it","is"]},{word:"twas",out:["it","was"]},{word:"y'know",out:["you","know"]},{word:"ne'er",out:["never"]},{word:"o'er",out:["over"]},{after:"ll",out:["will"]},{after:"ve",out:["have"]},{after:"re",out:["are"]},{after:"m",out:["am"]},{before:"c",out:["ce"]},{before:"m",out:["me"]},{before:"n",out:["ne"]},{before:"qu",out:["que"]},{before:"s",out:["se"]},{before:"t",out:["tu"]},{word:"shouldnt",out:["should","not"]},{word:"couldnt",out:["could","not"]},{word:"wouldnt",out:["would","not"]},{word:"hasnt",out:["has","not"]},{word:"wasnt",out:["was","not"]},{word:"isnt",out:["is","not"]},{word:"cant",out:["can","not"]},{word:"dont",out:["do","not"]},{word:"wont",out:["will","not"]},{word:"howd",out:["how","did"]},{word:"whatd",out:["what","did"]},{word:"whend",out:["when","did"]},{word:"whered",out:["where","did"]}],numberSuffixes:{st:cI,nd:cI,rd:cI,th:cI,am:cI,pm:cI,max:cI,"°":cI,s:cI,e:cI,er:cI,ère:cI,ème:cI}}},dI=function(e,t,n){let[r,i]=t;n&&0!==n.length&&(n=n.map(((e,t)=>(e.implicit=e.text,e.machine=e.text,e.pre="",e.post="",e.text="",e.normal="",e.index=[r,i+t],e))),n[0]&&(n[0].pre=e[r][i].pre,n[n.length-1].post=e[r][i].post,n[0].text=e[r][i].text,n[0].normal=e[r][i].normal),e[r].splice(i,1,...n))},pI=/'/,fI=new Set(["what","how","when","where","why"]),mI=new Set(["be","go","start","think","need"]),gI=new Set(["been","gone"]),yI=/'/,vI=/(e|é|aison|sion|tion)$/,bI=/(age|isme|acle|ege|oire)$/,wI=/^([0-9.]{1,4}[a-z]{0,2}) ?[-–—] ?([0-9]{1,4}[a-z]{0,2})$/i,_I=/^([0-9]{1,2}(:[0-9][0-9])?(am|pm)?) ?[-–—] ?([0-9]{1,2}(:[0-9][0-9])?(am|pm)?)$/i,kI=/^[0-9]{3}-[0-9]{4}$/,AI=function(e,t){let n=e[t],r=n.text.match(wI);return null!==r?!0===n.tags.has("PhoneNumber")||kI.test(n.text)?null:[r[1],"to",r[2]]:(r=n.text.match(_I),null!==r?[r[1],"to",r[4]]:null)},PI=/^([+-]?[0-9][.,0-9]*)([a-z°²³µ/]+)$/,TI=function(e,t,n){const r=n.model.one.numberSuffixes||{};let i=e[t].text.match(PI);if(null!==i){let e=i[2].toLowerCase().trim();return r.hasOwnProperty(e)?null:[i[1],e]}return null},II=/'/,EI=/^[0-9][^-–—]*[-–—].*?[0-9]/,xI=function(e,t,n,r){let i=t.update();i.document=[e];let a=n+r;n>0&&(n-=1),e[a]&&(a+=1),i.ptrs=[[0,n,a]]},CI={t:(e,t)=>function(e,t){return"ain't"===e[t].normal||"aint"===e[t].normal?null:[e[t].normal.replace(/n't/,""),"not"]}(e,t),d:(e,t)=>function(e,t){let n=e[t].normal.split(pI)[0];if(fI.has(n))return[n,"did"];if(e[t+1]){if(gI.has(e[t+1].normal))return[n,"had"];if(mI.has(e[t+1].normal))return[n,"would"]}return null}(e,t)},OI={j:(e,t)=>((e,t)=>["je",e[t].normal.split(yI)[1]])(e,t),l:(e,t)=>((e,t)=>{let n=e[t].normal.split(yI)[1];return n&&n.endsWith("e")?["la",n]:["le",n]})(e,t),d:(e,t)=>((e,t)=>{let n=e[t].normal.split(yI)[1];return n&&vI.test(n)&&!bI.test(n)?["du",n]:n&&n.endsWith("s")?["des",n]:["de",n]})(e,t)},SI=function(e,t,n,r){for(let i=0;i<e.length;i+=1){let a=e[i];if(a.word===t.normal)return a.out;if(null!==r&&r===a.after)return[n].concat(a.out);if(null!==n&&n===a.before&&r&&r.length>2)return a.out.concat(r)}return null},NI=function(e,t){let n=t.fromText(e.join(" "));return n.compute(["id","alias"]),n.docs[0]},jI=function(e,t){for(let n=t+1;n<5&&e[n];n+=1)if("been"===e[n].normal)return["there","has"];return["there","is"]},DI={model:hI,compute:{contractions:e=>{let{world:t,document:n}=e;const{model:r,methods:i}=t;let a=r.one.contractions||[];n.forEach(((r,s)=>{for(let o=r.length-1;o>=0;o-=1){let l=null,u=null;if(!0===II.test(r[o].normal)){let e=r[o].normal.split(II);l=e[0],u=e[1]}let c=SI(a,r[o],l,u);!c&&CI.hasOwnProperty(u)&&(c=CI[u](r,o,t)),!c&&OI.hasOwnProperty(l)&&(c=OI[l](r,o)),"there"===l&&"s"===u&&(c=jI(r,o)),c?(c=NI(c,e),dI(n,[s,o],c),xI(n[s],e,o,c.length)):EI.test(r[o].normal)?(c=AI(r,o),c&&(c=NI(c,e),dI(n,[s,o],c),i.one.setTag(c,"NumberRange",t),c[2]&&c[2].tags.has("Time")&&i.one.setTag([c[0]],"Time",t,null,"time-range"),xI(n[s],e,o,c.length))):(c=TI(r,o,t),c&&(c=NI(c,e),dI(n,[s,o],c),i.one.setTag([c[1]],"Unit",t,null,"contraction-unit")))}}))}},hooks:["contractions"]},RI=function(e){const t=e.world,{model:n,methods:r}=e.world,i=r.one.setTag,{frozenLex:a}=n.one,s=n.one._multiCache||{};e.docs.forEach((e=>{for(let n=0;n<e.length;n+=1){let r=e[n],o=r.machine||r.normal;if(void 0!==s[o]&&e[n+1])for(let r=n+s[o]-1;r>n;r-=1){let s=e.slice(n,r+1),o=s.map((e=>e.machine||e.normal)).join(" ");!0!==a.hasOwnProperty(o)||(i(s,a[o],t,!1,"1-frozen-multi-lexicon"),s.forEach((e=>e.frozen=!0)))}void 0!==a[o]&&a.hasOwnProperty(o)&&(i([r],a[o],t,!1,"1-freeze-lexicon"),r.frozen=!0)}}))},LI={frozen:RI,freeze:RI,unfreeze:function(e){return e.docs.forEach((e=>{e.forEach((e=>{delete e.frozen}))})),e}},MI=e=>"[34m"+e+"[0m",$I=e=>"[3m[2m"+e+"[0m",FI=function(e){e.docs.forEach((e=>{console.log(MI("\n  ┌─────────")),e.forEach((e=>{let t=`  ${$I("│")}  `,n=e.implicit||e.text||"-";!0===e.frozen?t+=`${MI(n)} ❄️`:t+=$I(n),console.log(t)}))}))},VI={compute:LI,mutate:e=>{const t=e.methods.one;t.termMethods.isFrozen=e=>!0===e.frozen,t.debug.freeze=FI,t.debug.frozen=FI},api:function(e){e.prototype.freeze=function(){return this.docs.forEach((e=>{e.forEach((e=>{e.frozen=!0}))})),this},e.prototype.unfreeze=function(){this.compute("unfreeze")},e.prototype.isFrozen=function(){return this.match("@isFrozen+")}},hooks:["freeze"]},zI=function(e,t,n){const{model:r,methods:i}=n,a=i.one.setTag,s=r.one._multiCache||{},{lexicon:o}=r.one||{};let l=e[t],u=l.machine||l.normal;if(void 0!==s[u]&&e[t+1]){for(let r=t+s[u]-1;r>t;r-=1){let i=e.slice(t,r+1);if(i.length<=1)return!1;let s=i.map((e=>e.machine||e.normal)).join(" ");if(!0===o.hasOwnProperty(s)){let e=o[s];return a(i,e,n,!1,"1-multi-lexicon"),!e||2!==e.length||"PhrasalVerb"!==e[0]&&"PhrasalVerb"!==e[1]||a([i[1]],"Particle",n,!1,"1-phrasal-particle"),!0}}return!1}return null},BI=/^(under|over|mis|re|un|dis|semi|pre|post)-?/,UI=new Set(["Verb","Infinitive","PastTense","Gerund","PresentTense","Adjective","Participle"]),HI=function(e,t,n){const{model:r,methods:i}=n,a=i.one.setTag,{lexicon:s}=r.one;let o=e[t],l=o.machine||o.normal;if(void 0!==s[l]&&s.hasOwnProperty(l))return a([o],s[l],n,!1,"1-lexicon"),!0;if(o.alias){let e=o.alias.find((e=>s.hasOwnProperty(e)));if(e)return a([o],s[e],n,!1,"1-lexicon-alias"),!0}if(!0===BI.test(l)){let e=l.replace(BI,"");if(s.hasOwnProperty(e)&&e.length>3&&UI.has(s[e]))return a([o],s[e],n,!1,"1-lexicon-prefix"),!0}return null},GI={lexicon:function(e){const t=e.world;e.docs.forEach((e=>{for(let n=0;n<e.length;n+=1)if(0===e[n].tags.size){let r=null;r=r||zI(e,n,t),r=r||HI(e,n,t)}}))}},qI={addWords:function(e,t=!1){const n=this.world(),{methods:r,model:i}=n;if(!e)return;if(Object.keys(e).forEach((t=>{"string"==typeof e[t]&&e[t].startsWith("#")&&(e[t]=e[t].replace(/^#/,""))})),!0===t){let{lex:t,_multi:a}=r.one.expandLexicon(e,n);return Object.assign(i.one._multiCache,a),void Object.assign(i.one.frozenLex,t)}if(r.two.expandLexicon){let{lex:t,_multi:a}=r.two.expandLexicon(e,n);Object.assign(i.one.lexicon,t),Object.assign(i.one._multiCache,a)}let{lex:a,_multi:s}=r.one.expandLexicon(e,n);Object.assign(i.one.lexicon,a),Object.assign(i.one._multiCache,s)}},KI={model:{one:{lexicon:{},_multiCache:{},frozenLex:{}}},methods:{one:{expandLexicon:function(e){let t={},n={};return Object.keys(e).forEach((r=>{let i=e[r],a=(r=(r=r.toLowerCase().trim()).replace(/'s\b/,"")).split(/ /);a.length>1&&(void 0===n[a[0]]||a.length>n[a[0]])&&(n[a[0]]=a.length),t[r]=t[r]||i})),delete t[""],delete t.null,delete t[" "],{lex:t,_multi:n}}}},compute:GI,lib:qI,hooks:["lexicon"]},WI=function(e,t){let n=[{}],r=[null],i=[0],a=[],s=0;e.forEach((function(e){let i=0,a=function(e,t){const{methods:n,model:r}=t;return n.one.tokenize.splitTerms(e,r).map((e=>n.one.tokenize.splitWhitespace(e,r))).map((e=>e.text.toLowerCase()))}(e,t);for(let e=0;e<a.length;e++){let t=a[e];n[i]&&n[i].hasOwnProperty(t)?i=n[i][t]:(s++,n[i][t]=s,n[s]={},i=s,r[s]=null)}r[i]=[a.length]}));for(let e in n[0])s=n[0][e],i[s]=0,a.push(s);for(;a.length;){let e=a.shift(),t=Object.keys(n[e]);for(let o=0;o<t.length;o+=1){let l=t[o],u=n[e][l];for(a.push(u),s=i[e];s>0&&!n[s].hasOwnProperty(l);)s=i[s];if(n.hasOwnProperty(s)){let e=n[s][l];i[u]=e,r[e]&&(r[u]=r[u]||[],r[u]=r[u].concat(r[e]))}else i[u]=0}}return{goNext:n,endAs:r,failTo:i}},JI=function(e,t,n){let r=0,i=[];for(let a=0;a<e.length;a++){let s=e[a][n.form]||e[a].normal;for(;r>0&&(void 0===t.goNext[r]||!t.goNext[r].hasOwnProperty(s));)r=t.failTo[r]||0;if(t.goNext[r].hasOwnProperty(s)&&(r=t.goNext[r][s],t.endAs[r])){let n=t.endAs[r];for(let t=0;t<n.length;t++){let r=n[t],s=e[a-r+1],[o,l]=s.index;i.push([o,l,l+r,s.id])}}}return i},ZI=function(e,t){for(let n=0;n<e.length;n+=1)if(!0===t.has(e[n]))return!1;return!0},QI=(e,t)=>{for(let n=e.length-1;n>=0;n-=1)if(e[n]!==t)return e.slice(0,n+1);return e},XI={buildTrie:function(e){return function(e){return e.goNext=e.goNext.map((e=>{if(0!==Object.keys(e).length)return e})),e.goNext=QI(e.goNext,void 0),e.failTo=QI(e.failTo,0),e.endAs=QI(e.endAs,null),e}(WI(e,this.world()))}};XI.compile=XI.buildTrie;const YI={api:function(e){e.prototype.lookup=function(e,t={}){if(!e)return this.none();var n;"string"==typeof e&&(e=[e]);let r=function(e,t,n){let r=[];n.form=n.form||"normal";let i=e.docs;if(!t.goNext||!t.goNext[0])return console.error("Compromise invalid lookup trie"),e.none();let a=Object.keys(t.goNext[0]);for(let s=0;s<i.length;s++){if(e._cache&&e._cache[s]&&!0===ZI(a,e._cache[s]))continue;let o=i[s],l=JI(o,t,n);l.length>0&&(r=r.concat(l))}return e.update(r)}(this,(n=e,"[object Object]"===Object.prototype.toString.call(n)?e:WI(e,this.world)),t);return r=r.settle(),r}},lib:XI},eE=function(e,t){return t?(e.forEach((e=>{let n=e[0];t[n]&&(e[0]=t[n][0],e[1]+=t[n][1],e[2]+=t[n][1])})),e):e},tE=function(e,t){let{ptrs:n,byGroup:r}=e;return n=eE(n,t),Object.keys(r).forEach((e=>{r[e]=eE(r[e],t)})),{ptrs:n,byGroup:r}},nE=function(e,t,n){const r=n.methods.one;return"number"==typeof e&&(e=String(e)),"string"==typeof e&&(e=r.killUnicode(e,n),e=r.parseMatch(e,t,n)),e},rE=e=>"[object Object]"===Object.prototype.toString.call(e),iE=e=>e&&rE(e)&&!0===e.isView,aE=e=>e&&rE(e)&&!0===e.isNet,sE={matchOne:function(e,t,n){const r=this.methods.one;if(iE(e))return this.intersection(e).eq(0);if(aE(e))return this.sweep(e,{tagger:!1,matchOne:!0}).view;let i={regs:e=nE(e,n,this.world),group:t,justOne:!0},a=r.match(this.docs,i,this._cache),{ptrs:s,byGroup:o}=tE(a,this.fullPointer),l=this.toView(s);return l._groups=o,l},match:function(e,t,n){const r=this.methods.one;if(iE(e))return this.intersection(e);if(aE(e))return this.sweep(e,{tagger:!1}).view.settle();let i={regs:e=nE(e,n,this.world),group:t},a=r.match(this.docs,i,this._cache),{ptrs:s,byGroup:o}=tE(a,this.fullPointer),l=this.toView(s);return l._groups=o,l},has:function(e,t,n){const r=this.methods.one;if(iE(e))return this.intersection(e).fullPointer.length>0;if(aE(e))return this.sweep(e,{tagger:!1}).view.found;let i={regs:e=nE(e,n,this.world),group:t,justOne:!0};return r.match(this.docs,i,this._cache).ptrs.length>0},if:function(e,t,n){const r=this.methods.one;if(iE(e))return this.filter((t=>t.intersection(e).found));if(aE(e)){let t=this.sweep(e,{tagger:!1}).view.settle();return this.if(t)}let i={regs:e=nE(e,n,this.world),group:t,justOne:!0},a=this.fullPointer,s=this._cache||[];a=a.filter(((e,t)=>{let n=this.update([e]);return r.match(n.docs,i,s[t]).ptrs.length>0}));let o=this.update(a);return this._cache&&(o._cache=a.map((e=>s[e[0]]))),o},ifNo:function(e,t,n){const{methods:r}=this,i=r.one;if(iE(e))return this.filter((t=>!t.intersection(e).found));if(aE(e)){let t=this.sweep(e,{tagger:!1}).view.settle();return this.ifNo(t)}e=nE(e,n,this.world);let a=this._cache||[],s=this.filter(((n,r)=>{let s={regs:e,group:t,justOne:!0};return 0===i.match(n.docs,s,a[r]).ptrs.length}));return this._cache&&(s._cache=s.ptrs.map((e=>a[e[0]]))),s}},oE={before:function(e,t,n){const{indexN:r}=this.methods.one.pointer;let i=[],a=r(this.fullPointer);Object.keys(a).forEach((e=>{let t=a[e].sort(((e,t)=>e[1]>t[1]?1:-1))[0];t[1]>0&&i.push([t[0],0,t[1]])}));let s=this.toView(i);return e?s.match(e,t,n):s},after:function(e,t,n){const{indexN:r}=this.methods.one.pointer;let i=[],a=r(this.fullPointer),s=this.document;Object.keys(a).forEach((e=>{let t=a[e].sort(((e,t)=>e[1]>t[1]?-1:1))[0],[n,,r]=t;r<s[n].length&&i.push([n,r,s[n].length])}));let o=this.toView(i);return e?o.match(e,t,n):o},growLeft:function(e,t,n){"string"==typeof e&&(e=this.world.methods.one.parseMatch(e,n,this.world)),e[e.length-1].end=!0;let r=this.fullPointer;return this.forEach(((n,i)=>{let a=n.before(e,t);if(a.found){let e=a.terms();r[i][1]-=e.length,r[i][3]=e.docs[0][0].id}})),this.update(r)},growRight:function(e,t,n){"string"==typeof e&&(e=this.world.methods.one.parseMatch(e,n,this.world)),e[0].start=!0;let r=this.fullPointer;return this.forEach(((n,i)=>{let a=n.after(e,t);if(a.found){let e=a.terms();r[i][2]+=e.length,r[i][4]=null}})),this.update(r)},grow:function(e,t,n){return this.growRight(e,t,n).growLeft(e,t,n)}},lE=function(e,t){return[e[0],e[1],t[2]]},uE=(e,t,n)=>{return"string"==typeof e||(r=e,"[object Array]"===Object.prototype.toString.call(r))?t.match(e,n):e||t.none();var r},cE=function(e,t){let[n,r,i]=e;return t.document[n]&&t.document[n][r]&&(e[3]=e[3]||t.document[n][r].id,t.document[n][i-1]&&(e[4]=e[4]||t.document[n][i-1].id)),e},hE={splitOn:function(e,t){const{splitAll:n}=this.methods.one.pointer;let r=uE(e,this,t).fullPointer,i=n(this.fullPointer,r),a=[];return i.forEach((e=>{a.push(e.passthrough),a.push(e.before),a.push(e.match),a.push(e.after)})),a=a.filter((e=>e)),a=a.map((e=>cE(e,this))),this.update(a)},splitBefore:function(e,t){const{splitAll:n}=this.methods.one.pointer;let r=uE(e,this,t).fullPointer,i=n(this.fullPointer,r);for(let e=0;e<i.length;e+=1)!i[e].after&&i[e+1]&&i[e+1].before&&i[e].match&&i[e].match[0]===i[e+1].before[0]&&(i[e].after=i[e+1].before,delete i[e+1].before);let a=[];return i.forEach((e=>{a.push(e.passthrough),a.push(e.before),e.match&&e.after?a.push(lE(e.match,e.after)):a.push(e.match)})),a=a.filter((e=>e)),a=a.map((e=>cE(e,this))),this.update(a)},splitAfter:function(e,t){const{splitAll:n}=this.methods.one.pointer;let r=uE(e,this,t).fullPointer,i=n(this.fullPointer,r),a=[];return i.forEach((e=>{a.push(e.passthrough),e.before&&e.match?a.push(lE(e.before,e.match)):(a.push(e.before),a.push(e.match)),a.push(e.after)})),a=a.filter((e=>e)),a=a.map((e=>cE(e,this))),this.update(a)}};hE.split=hE.splitAfter;const dE=hE,pE=function(e,t){return!(!e||!t)&&e[0]===t[0]&&e[2]===t[1]},fE=function(e,t,n){const r=e.world,i=r.methods.one.parseMatch;n=n||"^.";let a=i(t=t||".$",{},r),s=i(n,{},r);a[a.length-1].end=!0,s[0].start=!0;let o=e.fullPointer,l=[o[0]];for(let t=1;t<o.length;t+=1){let n=l[l.length-1],r=o[t],i=e.update([n]),u=e.update([r]);pE(n,r)&&i.has(a)&&u.has(s)?l[l.length-1]=[n[0],n[1],r[2],n[3],r[4]]:l.push(r)}return e.update(l)},mE={joinIf:function(e,t){return fE(this,e,t)},join:function(){return fE(this)}},gE=Object.assign({},sE,oE,dE,mE);gE.lookBehind=gE.before,gE.lookBefore=gE.before,gE.lookAhead=gE.after,gE.lookAfter=gE.after,gE.notIf=gE.ifNo;const yE=/(?:^|\s)([![^]*(?:<[^<]*>)?\/.*?[^\\/]\/[?\]+*$~]*)(?:\s|$)/,vE=/([!~[^]*(?:<[^<]*>)?\([^)]+[^\\)]\)[?\]+*$~]*)(?:\s|$)/,bE=/ /g,wE=e=>/^[![^]*(<[^<]*>)?\//.test(e)&&/\/[?\]+*$~]*$/.test(e),_E=function(e){return(e=e.map((e=>e.trim()))).filter((e=>e))},kE=/\{([0-9]+)?(, *[0-9]*)?\}/,AE=/&&/,PE=new RegExp(/^<\s*(\S+)\s*>/),TE=e=>e.charAt(0).toUpperCase()+e.substring(1),IE=e=>e.charAt(e.length-1),EE=e=>e.charAt(0),xE=e=>e.substring(1),CE=e=>e.substring(0,e.length-1),OE=function(e){return e=xE(e),CE(e)},SE=function(e,t){let n={};for(let r=0;r<2;r+=1){if("$"===IE(e)&&(n.end=!0,e=CE(e)),"^"===EE(e)&&(n.start=!0,e=xE(e)),"?"===IE(e)&&(n.optional=!0,e=CE(e)),("["===EE(e)||"]"===IE(e))&&(n.group=null,"["===EE(e)&&(n.groupStart=!0),"]"===IE(e)&&(n.groupEnd=!0),e=(e=e.replace(/^\[/,"")).replace(/\]$/,""),"<"===EE(e))){const t=PE.exec(e);t.length>=2&&(n.group=t[1],e=e.replace(t[0],""))}if("+"===IE(e)&&(n.greedy=!0,e=CE(e)),"*"!==e&&"*"===IE(e)&&"\\*"!==e&&(n.greedy=!0,e=CE(e)),"!"===EE(e)&&(n.negative=!0,e=xE(e)),"~"===EE(e)&&"~"===IE(e)&&e.length>2&&(e=OE(e),n.fuzzy=!0,n.min=t.fuzzy||.85,!1===/\(/.test(e)))return n.word=e,n;if("/"===EE(e)&&"/"===IE(e))return e=OE(e),t.caseSensitive&&(n.use="text"),n.regex=new RegExp(e),n;if(!0===kE.test(e)&&(e=e.replace(kE,((e,t,r)=>(void 0===r?(n.min=Number(t),n.max=Number(t)):(r=r.replace(/, */,""),void 0===t?(n.min=0,n.max=Number(r)):(n.min=Number(t),n.max=Number(r||999))),n.greedy=!0,n.min||(n.optional=!0),"")))),"("===EE(e)&&")"===IE(e)){AE.test(e)?(n.choices=e.split(AE),n.operator="and"):(n.choices=e.split("|"),n.operator="or"),n.choices[0]=xE(n.choices[0]);let r=n.choices.length-1;n.choices[r]=CE(n.choices[r]),n.choices=n.choices.map((e=>e.trim())),n.choices=n.choices.filter((e=>e)),n.choices=n.choices.map((e=>e.split(/ /g).map((e=>SE(e,t))))),e=""}if("{"===EE(e)&&"}"===IE(e)){if(e=OE(e),n.root=e,/\//.test(e)){let e=n.root.split(/\//);n.root=e[0],n.pos=e[1],"adj"===n.pos&&(n.pos="Adjective"),n.pos=n.pos.charAt(0).toUpperCase()+n.pos.substr(1).toLowerCase(),void 0!==e[2]&&(n.sense=e[2])}return n}if("<"===EE(e)&&">"===IE(e))return e=OE(e),n.chunk=TE(e),n.greedy=!0,n;if("%"===EE(e)&&"%"===IE(e))return e=OE(e),n.switch=e,n}return"#"===EE(e)?(n.tag=xE(e),n.tag=TE(n.tag),n):"@"===EE(e)?(n.method=xE(e),n):"."===e?(n.anything=!0,n):"*"===e?(n.anything=!0,n.greedy=!0,n.optional=!0,n):(e&&(e=(e=e.replace("\\*","*")).replace("\\.","."),t.caseSensitive?n.use="text":e=e.toLowerCase(),n.word=e),n)},NE=SE,jE=/[a-z0-9][-–—][a-z]/i,DE=function(e,t){let{all:n}=t.methods.two.transform.verb||{},r=e.root;return n?n(r,t.model):[]},RE=function(e,t){let{all:n}=t.methods.two.transform.noun||{};return n?n(e.root,t.model):[e.root]},LE=function(e,t){let{all:n}=t.methods.two.transform.adjective||{};return n?n(e.root,t.model):[e.root]},ME=function(e,t){for(let n of t)if(e.has(n))return!0;return!1},$E=function(e,t){for(let n=0;n<e.length;n+=1){let r=e[n];if(!0!==r.optional&&!0!==r.negative&&!0!==r.fuzzy){if(void 0!==r.word&&!1===t.has(r.word))return!0;if(void 0!==r.tag&&!1===t.has("#"+r.tag))return!0;if(r.fastOr&&!1===ME(r.fastOr,t))return!1}}return!1},FE=/([\u0022\uFF02\u0027\u201C\u2018\u201F\u201B\u201E\u2E42\u201A\u00AB\u2039\u2035\u2036\u2037\u301D\u0060\u301F])/,VE=/([\u0022\uFF02\u0027\u201D\u2019\u00BB\u203A\u2032\u2033\u2034\u301E\u00B4])/,zE=/^[-–—]$/,BE=/ [-–—]{1,3} /,UE=(e,t)=>-1!==e.post.indexOf(t),HE={hasQuote:e=>FE.test(e.pre)||VE.test(e.post),hasComma:e=>UE(e,","),hasPeriod:e=>!0===UE(e,".")&&!1===UE(e,"..."),hasExclamation:e=>UE(e,"!"),hasQuestionMark:e=>UE(e,"?")||UE(e,"¿"),hasEllipses:e=>UE(e,"..")||UE(e,"…"),hasSemicolon:e=>UE(e,";"),hasColon:e=>UE(e,":"),hasSlash:e=>/\//.test(e.text),hasHyphen:e=>zE.test(e.post)||zE.test(e.pre),hasDash:e=>BE.test(e.post)||BE.test(e.pre),hasContraction:e=>Boolean(e.implicit),isAcronym:e=>e.tags.has("Acronym"),isKnown:e=>e.tags.size>0,isTitleCase:e=>/^\p{Lu}[a-z'\u00C0-\u00FF]/u.test(e.text),isUpperCase:e=>/^\p{Lu}+$/u.test(e.text)};HE.hasQuotation=HE.hasQuote;const GE=HE;let qE=function(){};qE=function(e,t,n,r){let i=function(e,t,n,r){if(!0===t.anything)return!0;if(!0===t.start&&0!==n)return!1;if(!0===t.end&&n!==r-1)return!1;if(void 0!==t.id&&t.id===e.id)return!0;if(void 0!==t.word){if(t.use)return t.word===e[t.use];if(null!==e.machine&&e.machine===t.word)return!0;if(void 0!==e.alias&&e.alias.hasOwnProperty(t.word))return!0;if(!0===t.fuzzy){if(t.word===e.root)return!0;if(function(e,t,n=3){if(e===t)return 1;if(e.length<n||t.length<n)return 0;const r=function(e,t){let n=e.length,r=t.length;if(0===n)return r;if(0===r)return n;let i=(r>n?r:n)+1;if(Math.abs(n-r)>(i||100))return i||100;let a,s,o,l,u,c,h=[];for(let e=0;e<i;e++)h[e]=[e],h[e].length=i;for(let e=0;e<i;e++)h[0][e]=e;for(let i=1;i<=n;++i)for(s=e[i-1],a=1;a<=r;++a){if(i===a&&h[i][a]>4)return n;o=t[a-1],l=s===o?0:1,u=h[i-1][a]+1,(c=h[i][a-1]+1)<u&&(u=c),(c=h[i-1][a-1]+l)<u&&(u=c);let r=i>1&&a>1&&s===t[a-2]&&e[i-2]===o&&(c=h[i-2][a-2]+l)<u;h[i][a]=r?c:u}return h[n][r]}(e,t);let i=Math.max(e.length,t.length);return 1-(0===i?0:r/i)}(t.word,e.normal)>=t.min)return!0}return!(!e.alias||!e.alias.some((e=>e===t.word)))||t.word===e.text||t.word===e.normal}if(void 0!==t.tag)return!0===e.tags.has(t.tag);if(void 0!==t.method)return"function"==typeof GE[t.method]&&!0===GE[t.method](e);if(void 0!==t.pre)return e.pre&&e.pre.includes(t.pre);if(void 0!==t.post)return e.post&&e.post.includes(t.post);if(void 0!==t.regex){let n=e.normal;return t.use&&(n=e[t.use]),t.regex.test(n)}if(void 0!==t.chunk)return e.chunk===t.chunk;if(void 0!==t.switch)return e.switch===t.switch;if(void 0!==t.machine)return e.normal===t.machine||e.machine===t.machine||e.root===t.machine;if(void 0!==t.sense)return e.sense===t.sense;if(void 0!==t.fastOr){if(t.pos&&!e.tags.has(t.pos))return null;let n=e.root||e.implicit||e.machine||e.normal;return t.fastOr.has(n)||t.fastOr.has(e.text)}return void 0!==t.choices&&("and"===t.operator?t.choices.every((t=>qE(e,t,n,r))):t.choices.some((t=>qE(e,t,n,r))))}(e,t,n,r);return!0===t.negative?!i:i};const KE=qE,WE=function(e,t){if(!0===e.end&&!0===e.greedy&&t.start_i+t.t<t.phrase_length-1){let n=Object.assign({},e,{end:!1});if(!0===KE(t.terms[t.t],n,t.start_i+t.t,t.phrase_length))return!0}return!1},JE=function(e,t){return e.groups[e.inGroup]||(e.groups[e.inGroup]={start:t,length:0}),e.groups[e.inGroup]},ZE=function(e){let{regs:t}=e,n=t[e.r],r=function(e,t){let n=e.t;if(!t)return e.terms.length;for(;n<e.terms.length;n+=1)if(!0===KE(e.terms[n],t,e.start_i+n,e.phrase_length))return n;return null}(e,t[e.r+1]);return null===r||0===r||void 0!==n.min&&r-e.t<n.min?null:void 0!==n.max&&r-e.t>n.max?(e.t=e.t+n.max,!0):(!0===e.hasGroup&&(JE(e,e.t).length=r-e.t),e.t=r,!0)},QE=function(e,t=0){let n=e.regs[e.r],r=!1;for(let a=0;a<n.choices.length;a+=1){let s=n.choices[a];if(i=s,"[object Array]"!==Object.prototype.toString.call(i))return!1;if(r=s.every(((n,r)=>{let i=0,a=e.t+r+t+i;if(void 0===e.terms[a])return!1;let s=KE(e.terms[a],n,a+e.start_i,e.phrase_length);if(!0===s&&!0===n.greedy)for(let t=1;t<e.terms.length;t+=1){let r=e.terms[a+t];if(r){if(!0!==KE(r,n,e.start_i+t,e.phrase_length))break;i+=1}}return t+=i,s})),r){t+=s.length;break}}var i;return r&&!0===n.greedy?QE(e,t):t},XE=function(e){const{regs:t}=e;let n=t[e.r],r=QE(e);if(r){if(!0===n.negative)return null;if(!0===e.hasGroup&&(JE(e,e.t).length+=r),!0===n.end){let t=e.phrase_length;if(e.t+e.start_i+r!==t)return null}return e.t+=r,!0}return!!n.optional||null},YE=function(e){const{regs:t}=e;let n=t[e.r],r=function(e){let t=0;return!0===e.regs[e.r].choices.every((n=>{let r=n.every(((t,n)=>{let r=e.t+n;return void 0!==e.terms[r]&&KE(e.terms[r],t,r,e.phrase_length)}));return!0===r&&n.length>t&&(t=n.length),r}))&&t}(e);if(r){if(!0===n.negative)return null;if(!0===e.hasGroup&&(JE(e,e.t).length+=r),!0===n.end){let t=e.phrase_length-1;if(e.t+e.start_i!==t)return null}return e.t+=r,!0}return!!n.optional||null},ex=function(e){const{regs:t}=e;let n=t[e.r],r=Object.assign({},n);if(r.negative=!1,KE(e.terms[e.t],r,e.start_i+e.t,e.phrase_length))return!1;if(n.optional){let n=t[e.r+1];n&&(KE(e.terms[e.t],n,e.start_i+e.t,e.phrase_length)?e.r+=1:n.optional&&t[e.r+2]&&KE(e.terms[e.t],t[e.r+2],e.start_i+e.t,e.phrase_length)&&(e.r+=2))}return n.greedy?function(e,t,n){let r=0;for(let i=e.t;i<e.terms.length;i+=1){let a=KE(e.terms[i],t,e.start_i+e.t,e.phrase_length);if(a)break;if(n&&(a=KE(e.terms[i],n,e.start_i+e.t,e.phrase_length),a))break;if(r+=1,void 0!==t.max&&r===t.max)break}return!(0===r||t.min&&t.min>r||(e.t+=r,0))}(e,r,t[e.r+1]):(e.t+=1,!0)},tx=function(e){const{regs:t}=e;let n=t[e.r],r=e.terms[e.t],i=e.t;return!!(n.optional&&t[e.r+1]&&n.negative)||(n.optional&&t[e.r+1]&&function(e){const{regs:t}=e;let n=t[e.r],r=e.terms[e.t],i=KE(r,t[e.r+1],e.start_i+e.t,e.phrase_length);if(n.negative||i){let n=e.terms[e.t+1];n&&KE(n,t[e.r+1],e.start_i+e.t,e.phrase_length)||(e.r+=1)}}(e),r.implicit&&e.terms[e.t+1]&&function(e){let t=e.terms[e.t],n=e.regs[e.r];if(t.implicit&&e.terms[e.t+1]){if(!e.terms[e.t+1].implicit)return;n.word===t.normal&&(e.t+=1),"hasContraction"===n.method&&(e.t+=1)}}(e),e.t+=1,!0===n.end&&e.t!==e.terms.length&&!0!==n.greedy?null:!0!==n.greedy||function(e){const{regs:t,phrase_length:n}=e;let r=t[e.r];return e.t=function(e,t){let n=Object.assign({},e.regs[e.r],{start:!1,end:!1}),r=e.t;for(;e.t<e.terms.length;e.t+=1){if(t&&KE(e.terms[e.t],t,e.start_i+e.t,e.phrase_length))return e.t;let i=e.t-r+1;if(void 0!==n.max&&i===n.max)return e.t;if(!1===KE(e.terms[e.t],n,e.start_i+e.t,e.phrase_length))return void 0!==n.min&&i<n.min?null:e.t}return e.t}(e,t[e.r+1]),null===e.t||r.min&&r.min>e.t?null:!0!==r.end||e.start_i+e.t===n||null}(e)?(!0===e.hasGroup&&function(e,t){let n=e.regs[e.r];const r=JE(e,t);e.t>1&&n.greedy?r.length+=e.t-t:r.length++}(e,i),!0):null)},nx=function(e,t,n,r){if(0===e.length||0===t.length)return null;let i={t:0,terms:e,r:0,regs:t,groups:{},start_i:n,phrase_length:r,inGroup:null};for(;i.r<t.length;i.r+=1){let e=t[i.r];if(i.hasGroup=Boolean(e.group),!0===i.hasGroup?i.inGroup=e.group:i.inGroup=null,!i.terms[i.t]){if(!1===t.slice(i.r).some((e=>!e.optional)))break;return null}if(!0!==e.anything||!0!==e.greedy){if(void 0===e.choices||"or"!==e.operator){if(void 0===e.choices||"and"!==e.operator)if(!0!==e.anything){if(!0!==WE(e,i)){if(e.negative){if(!ex(i))return null}else if(!0!==KE(i.terms[i.t],e,i.start_i+i.t,i.phrase_length)){if(!0!==e.optional)return null}else if(!tx(i))return null}else if(!tx(i))return null}else{if(e.negative&&e.anything)return null;if(!tx(i))return null}else if(!YE(i))return null}else if(!XE(i))return null}else if(!ZE(i))return null}let a=[null,n,i.t+n];if(a[1]===a[2])return null;let s={};return Object.keys(i.groups).forEach((e=>{let t=i.groups[e],r=n+t.start;s[e]=[null,r,r+t.length]})),{pointer:a,groups:s}},rx=function(e,t){return e.pointer[0]=t,Object.keys(e.groups).forEach((n=>{e.groups[n][0]=t})),e},ix=function(e,t,n){let r=nx(e,t,0,e.length);return r?(r=rx(r,n),r):null},ax={api:function(e){Object.assign(e.prototype,gE)},methods:{one:{termMethods:GE,parseMatch:function(e,t,n){if(null==e||""===e)return[];t=t||{},"number"==typeof e&&(e=String(e));let r=function(e){let t=e.split(yE),n=[];t.forEach((e=>{wE(e)?n.push(e):n=n.concat(e.split(vE))})),n=_E(n);let r=[];return n.forEach((e=>{(e=>/^[![^]*(<[^<]*>)?\(/.test(e)&&/\)[?\]+*$~]*$/.test(e))(e)||wE(e)?r.push(e):r=r.concat(e.split(bE))})),r=_E(r),r}(e);return r=r.map((e=>NE(e,t))),r=function(e,t){let n=t.model.one.prefixes;for(let t=e.length-1;t>=0;t-=1){let r=e[t];if(r.word&&jE.test(r.word)){let i=r.word.split(/[-–—]/g);if(n.hasOwnProperty(i[0]))continue;i=i.filter((e=>e)).reverse(),e.splice(t,1),i.forEach((n=>{let i=Object.assign({},r);i.word=n,e.splice(t,0,i)}))}}return e}(r,n),r=function(e,t){return e=e.map((e=>{if(e.root)if(t.methods.two&&t.methods.two.transform){let n=[];e.pos?"Verb"===e.pos?n=n.concat(DE(e,t)):"Noun"===e.pos?n=n.concat(RE(e,t)):"Adjective"===e.pos&&(n=n.concat(LE(e,t))):(n=n.concat(DE(e,t)),n=n.concat(RE(e,t)),n=n.concat(LE(e,t))),n=n.filter((e=>e)),n.length>0&&(e.operator="or",e.fastOr=new Set(n))}else e.machine=e.root,delete e.id,delete e.root;return e})),e}(r,n),r=function(e){return e=function(e){let t=0,n=null;for(let r=0;r<e.length;r++){const i=e[r];!0===i.groupStart&&(n=i.group,null===n&&(n=String(t),t+=1)),null!==n&&(i.group=n),!0===i.groupEnd&&(n=null)}return e}(e),e=function(e){return e.map((e=>(e.fuzzy&&e.choices&&e.choices.forEach((t=>{1===t.length&&t[0].word&&(t[0].fuzzy=!0,t[0].min=e.min)})),e)))}(e=e.map((e=>{if(void 0!==e.choices){if("or"!==e.operator)return e;if(!0===e.fuzzy)return e;!0===e.choices.every((e=>{if(1!==e.length)return!1;let t=e[0];return!0!==t.fuzzy&&!t.start&&!t.end&&void 0!==t.word&&!0!==t.negative&&!0!==t.optional&&!0!==t.method}))&&(e.fastOr=new Set,e.choices.forEach((t=>{e.fastOr.add(t[0].word)})),delete e.choices)}return e}))),e}(r),r},match:function(e,t,n){n=n||[];let{regs:r,group:i,justOne:a}=t,s=[];if(!r||0===r.length)return{ptrs:[],byGroup:{}};const o=r.filter((e=>!0!==e.optional&&!0!==e.negative)).length;e:for(let t=0;t<e.length;t+=1){let i=e[t];if(!n[t]||!$E(r,n[t]))if(!0!==r[0].start)for(let e=0;e<i.length;e+=1){let n=i.slice(e);if(n.length<o)break;let l=nx(n,r,e,i.length);if(l){if(l=rx(l,t),s.push(l),!0===a)break e;let n=l.pointer[2];Math.abs(n-1)>e&&(e=Math.abs(n-1))}}else{let e=ix(i,r,t);e&&s.push(e)}}return!0===r[r.length-1].end&&(s=s.filter((t=>{let n=t.pointer[0];return e[n].length===t.pointer[2]}))),t.notIf&&(s=function(e,t,n){return e=e.filter((e=>{let[r,i,a]=e.pointer,s=n[r].slice(i,a);for(let e=0;e<s.length;e+=1){let n=s.slice(e);if(null!==nx(n,t,e,s.length))return!1}return!0})),e}(s,t.notIf,e)),s=function(e,t){let n=[],r={};return 0===e.length||("number"==typeof t&&(t=String(t)),t?e.forEach((e=>{e.groups[t]&&n.push(e.groups[t])})):e.forEach((e=>{n.push(e.pointer),Object.keys(e.groups).forEach((t=>{r[t]=r[t]||[],r[t].push(e.groups[t])}))}))),{ptrs:n,byGroup:r}}(s,i),s.ptrs.forEach((t=>{let[n,r,i]=t;t[3]=e[n][r].id,t[4]=e[n][i-1].id})),s}}},lib:{parseMatch:function(e,t){const n=this.world();let r=n.methods.one.killUnicode;return r&&(e=r(e,n)),n.methods.one.parseMatch(e,t,n)}}},sx=/^\../,ox=/^#./,lx={html:function(e){let{starts:t,ends:n}=function(e,t){let n={},r={};return Object.keys(t).forEach((i=>{let a=t[i],s=function(e){let t="",n="</span>";return e=(e=>(e=(e=(e=(e=e.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/"/g,"&quot;")).replace(/'/g,"&apos;"))(e),sx.test(e)?t=`<span class="${e.replace(/^\./,"")}"`:ox.test(e)?t=`<span id="${e.replace(/^#/,"")}"`:(t=`<${e}`,n=`</${e}>`),t+=">",{start:t,end:n}}(i);"string"==typeof a&&(a=e.match(a)),a.docs.forEach((e=>{if(e.every((e=>e.implicit)))return;let t=e[0].id;n[t]=n[t]||[],n[t].push(s.start);let i=e[e.length-1].id;r[i]=r[i]||[],r[i].push(s.end)}))})),{starts:n,ends:r}}(this,e),r="";return this.docs.forEach((e=>{for(let i=0;i<e.length;i+=1){let a=e[i];t.hasOwnProperty(a.id)&&(r+=t[a.id].join("")),r+=a.pre||"",r+=a.text||"",n.hasOwnProperty(a.id)&&(r+=n[a.id].join("")),r+=a.post||""}})),r}},ux=/[,:;)\]*.?~!\u0022\uFF02\u201D\u2019\u00BB\u203A\u2032\u2033\u2034\u301E\u00B4—-]+$/,cx=/^[(['"*~\uFF02\u201C\u2018\u201F\u201B\u201E\u2E42\u201A\u00AB\u2039\u2035\u2036\u2037\u301D\u0060\u301F]+/,hx=/[,:;)('"\u201D\]]/,dx=/^[-–—]$/,px=/ /,fx=function(e,t,n=!0){let r="";return e.forEach((e=>{let n=e.pre||"",i=e.post||"";"some"===t.punctuation&&(n=n.replace(cx,""),dx.test(i)&&(i=" "),i=i.replace(hx,""),i=i.replace(/\?!+/,"?"),i=i.replace(/!+/,"!"),i=i.replace(/\?+/,"?"),i=i.replace(/\.{2,}/,""),e.tags.has("Abbreviation")&&(i=i.replace(/\./,""))),"some"===t.whitespace&&(n=n.replace(/\s/,""),i=i.replace(/\s+/," ")),t.keepPunct||(n=n.replace(cx,""),i="-"===i?" ":i.replace(ux,""));let a=e[t.form||"text"]||e.normal||"";"implicit"===t.form&&(a=e.implicit||e.text),"root"===t.form&&e.implicit&&(a=e.root||e.implicit||e.normal),"machine"!==t.form&&"implicit"!==t.form&&"root"!==t.form||!e.implicit||i&&px.test(i)||(i+=" "),r+=n+a+i})),!1===n&&(r=r.trim()),!0===t.lowerCase&&(r=r.toLowerCase()),r},mx={text:{form:"text"},normal:{whitespace:"some",punctuation:"some",case:"some",unicode:"some",form:"normal"},machine:{keepSpace:!1,whitespace:"some",punctuation:"some",case:"none",unicode:"some",form:"machine"},root:{keepSpace:!1,whitespace:"some",punctuation:"some",case:"some",unicode:"some",form:"root"},implicit:{form:"implicit"}};mx.clean=mx.normal,mx.reduced=mx.root;const gx=mx;let yx=[],vx=0;for(;vx<64;)yx[vx]=0|4294967296*Math.sin(++vx%Math.PI);const bx=function(e){let t,n,r,i=[t=1732584193,n=4023233417,~t,~n],a=[],s=decodeURI(encodeURI(e))+"",o=s.length;for(e=--o/4+2|15,a[--e]=8*o;~o;)a[o>>2]|=s.charCodeAt(o)<<8*o--;for(vx=s=0;vx<e;vx+=16){for(o=i;s<64;o=[r=o[3],t+((r=o[0]+[t&n|~t&r,r&t|~r&n,t^n^r,n^(t|~r)][o=s>>4]+yx[s]+~~a[vx|15&[s,5*s+1,3*s+5,7*s][o]])<<(o=[7,12,17,22,5,9,14,20,4,11,16,23,6,10,15,21][4*o+s++%4])|r>>>-o),t,n])t=0|o[1],n=o[2];for(s=4;s;)i[--s]+=o[s]}for(e="";s<32;)e+=(i[s>>3]>>4*(1^s++)&15).toString(16);return e},wx={text:!0,terms:!0};let _x={case:"none",unicode:"some",form:"machine",punctuation:"some"};const kx=function(e,t){return Object.assign({},e,t)},Ax={text:e=>fx(e,{keepPunct:!0},!1),normal:e=>fx(e,kx(gx.normal,{keepPunct:!0}),!1),implicit:e=>fx(e,kx(gx.implicit,{keepPunct:!0}),!1),machine:e=>fx(e,_x,!1),root:e=>fx(e,kx(_x,{form:"root"}),!1),hash:e=>bx(fx(e,{keepPunct:!0},!1)),offset:e=>{let t=Ax.text(e).length;return{index:e[0].offset.index,start:e[0].offset.start,length:t}},terms:e=>e.map((e=>{let t=Object.assign({},e);return t.tags=Array.from(e.tags),t})),confidence:(e,t,n)=>t.eq(n).confidence(),syllables:(e,t,n)=>t.eq(n).syllables(),sentence:(e,t,n)=>t.eq(n).fullSentence().text(),dirty:e=>e.some((e=>!0===e.dirty))};Ax.sentences=Ax.sentence,Ax.clean=Ax.normal,Ax.reduced=Ax.root;const Px={json:function(e){let t=function(e,t){return"string"==typeof(t=t||{})&&(t={}),(t=Object.assign({},wx,t)).offset&&e.compute("offset"),e.docs.map(((n,r)=>{let i={};return Object.keys(t).forEach((a=>{t[a]&&Ax[a]&&(i[a]=Ax[a](n,e,r))})),i}))}(this,e);return"number"==typeof e?t[e]:t}};Px.data=Px.json;const Tx=Px,Ix=function(e){let t=e.pre||"",n=e.post||"";return t+e.text+n},Ex=function(e,t){let n=function(e,t){let n={};return Object.keys(t).forEach((r=>{e.match(r).fullPointer.forEach((e=>{n[e[3]]={fn:t[r],end:e[2]}}))})),n}(e,t),r="";return e.docs.forEach(((t,i)=>{for(let a=0;a<t.length;a+=1){let s=t[a];if(n.hasOwnProperty(s.id)){let{fn:o,end:l}=n[s.id],u=e.update([[i,a,l]]);r+=t[a].pre||"",r+=o(u),a=l-1,r+=t[a].post||""}else r+=Ix(s)}})),r},xx={debug:function(e){let t=this.methods.one.debug||{};return e&&t.hasOwnProperty(e)?(t[e](this),this):"undefined"!=typeof window&&window.document?(t.clientSide(this),this):(t.tags(this),this)},out:function(e){if(t=e,"[object Object]"===Object.prototype.toString.call(t))return Ex(this,e);var t;if("text"===e)return this.text();if("normal"===e)return this.text("normal");if("root"===e)return this.text("root");if("machine"===e||"reduced"===e)return this.text("machine");if("hash"===e||"md5"===e)return bx(this.text());if("json"===e)return this.json();if("offset"===e||"offsets"===e)return this.compute("offset"),this.json({offset:!0});if("array"===e){let e=this.docs.map((e=>e.reduce(((e,t)=>e+t.pre+t.text+t.post),"").trim()));return e.filter((e=>e))}if("freq"===e||"frequency"===e||"topk"===e)return function(e){let t={};e.forEach((e=>{t[e]=t[e]||0,t[e]+=1}));let n=Object.keys(t).map((e=>({normal:e,count:t[e]})));return n.sort(((e,t)=>e.count>t.count?-1:0))}(this.json({normal:!0}).map((e=>e.normal)));if("terms"===e){let e=[];return this.docs.forEach((t=>{let n=t.map((e=>e.text));n=n.filter((e=>e)),e=e.concat(n)})),e}return"tags"===e?this.docs.map((e=>e.reduce(((e,t)=>(e[t.implicit||t.normal]=Array.from(t.tags),e)),{}))):"debug"===e?this.debug():this.text()},wrap:function(e){return Ex(this,e)}},Cx=xx,Ox={text:function(e){let t={};var n;if(e&&"string"==typeof e&&gx.hasOwnProperty(e)?t=Object.assign({},gx[e]):e&&(n=e,"[object Object]"===Object.prototype.toString.call(n))&&(t=Object.assign({},e)),void 0!==t.keepSpace||this.isFull()||(t.keepSpace=!1),void 0===t.keepEndPunct&&this.pointer){let e=this.pointer[0];e&&e[1]?t.keepEndPunct=!1:t.keepEndPunct=!0}return void 0===t.keepPunct&&(t.keepPunct=!0),void 0===t.keepSpace&&(t.keepSpace=!0),function(e,t){let n="";if(!e||!e[0]||!e[0][0])return n;for(let r=0;r<e.length;r+=1)n+=fx(e[r],t,!0);if(t.keepSpace||(n=n.trim()),!1===t.keepEndPunct){e[0][0].tags.has("Emoticon")||(n=n.replace(cx,""));let t=e[e.length-1];t[t.length-1].tags.has("Emoticon")||(n=n.replace(ux,"")),n.endsWith("'")&&!n.endsWith("s'")&&(n=n.replace(/'/,""))}return!0===t.cleanWhitespace&&(n=n.trim()),n}(this.docs,t)}},Sx=Object.assign({},Cx,Ox,Tx,lx),Nx="[0m",jx={green:e=>"[32m"+e+Nx,red:e=>"[31m"+e+Nx,blue:e=>"[34m"+e+Nx,magenta:e=>"[35m"+e+Nx,cyan:e=>"[36m"+e+Nx,yellow:e=>"[33m"+e+Nx,black:e=>"[30m"+e+Nx,dim:e=>"[2m"+e+Nx,i:e=>"[3m"+e+Nx},Dx=jx,Rx={api:function(e){Object.assign(e.prototype,Sx)},methods:{one:{hash:bx,debug:{tags:function(e){let{docs:t,model:n}=e;0===t.length&&console.log(Dx.blue("\n     ──────")),t.forEach((t=>{console.log(Dx.blue("\n  ┌─────────")),t.forEach((t=>{let r=[...t.tags||[]],i=t.text||"-";t.sense&&(i=`{${t.normal}/${t.sense}}`),t.implicit&&(i="["+t.implicit+"]"),i=Dx.yellow(i);let a="'"+i+"'";if(t.reference){let n=e.update([t.reference]).text("normal");a+=` - ${Dx.dim(Dx.i("["+n+"]"))}`}a=a.padEnd(18);let s=Dx.blue("  │ ")+Dx.i(a)+"  - "+function(e,t){return t.one.tagSet&&(e=e.map((e=>{if(!t.one.tagSet.hasOwnProperty(e))return e;const n=t.one.tagSet[e].color||"blue";return Dx[n](e)}))),e.join(", ")}(r,n);console.log(s)}))})),console.log("\n")},clientSide:function(e){console.log("%c -=-=- ","background-color:#6699cc;"),e.forEach((e=>{console.groupCollapsed(e.text());let t=e.docs[0].map((e=>{let t=e.text||"-";return e.implicit&&(t="["+e.implicit+"]"),{text:t,tags:"["+Array.from(e.tags).join(", ")+"]"}}));console.table(t,["text","tags"]),console.groupEnd()}))},chunks:function(e){let{docs:t}=e;console.log(""),t.forEach((e=>{let t=[];e.forEach((e=>{"Noun"===e.chunk?t.push(Dx.blue(e.implicit||e.normal)):"Verb"===e.chunk?t.push(Dx.green(e.implicit||e.normal)):"Adjective"===e.chunk?t.push(Dx.yellow(e.implicit||e.normal)):"Pivot"===e.chunk?t.push(Dx.red(e.implicit||e.normal)):t.push(e.implicit||e.normal)})),console.log(t.join(" "),"\n")})),console.log("\n")},highlight:function(e){if(!e.found)return;let t={};e.fullPointer.forEach((e=>{t[e[0]]=t[e[0]]||[],t[e[0]].push(e)})),Object.keys(t).forEach((n=>{let r=e.update([[Number(n)]]).text();e.update(t[n]).json({offset:!0}).forEach(((e,t)=>{r=function(e,t,n){let r=((e,t,n)=>{let r=9*n,i=t.start+r,a=i+t.length;return[e.substring(0,i),e.substring(i,a),e.substring(a,e.length)]})(e,t,n);return`${r[0]}${Dx.blue(r[1])}${r[2]}`}(r,e.offset,t)})),console.log(r)})),console.log("\n")}}}}},Lx=function(e,t){if(e[0]!==t[0])return!1;let[,n,r]=e,[,i,a]=t;return n<=i&&r>i||i<=n&&a>n},Mx=function(e){let t={};return e.forEach((e=>{t[e[0]]=t[e[0]]||[],t[e[0]].push(e)})),t},$x=function(e,t){let n=Mx(t),r=[];return e.forEach((e=>{let[t]=e,i=n[t]||[];if(i=i.filter((t=>function(e,t){return e[1]<=t[1]&&t[2]<=e[2]}(e,t))),0===i.length)return void r.push({passthrough:e});i=i.sort(((e,t)=>e[1]-t[1]));let a=e;i.forEach(((e,t)=>{let n=function(e,t){let[n,r]=e,i=t[1],a=t[2],s={};if(r<i){let t=i<e[2]?i:e[2];s.before=[n,r,t]}return s.match=t,e[2]>a&&(s.after=[n,a,e[2]]),s}(a,e);i[t+1]?(r.push({before:n.before,match:n.match}),n.after&&(a=n.after)):r.push(n)}))})),r},Fx={one:{termList:function(e){let t=[];for(let n=0;n<e.length;n+=1)for(let r=0;r<e[n].length;r+=1)t.push(e[n][r]);return t},getDoc:function(e,t){let n=[];return e.forEach(((r,i)=>{if(!r)return;let[a,s,o,l,u]=r,c=t[a]||[];if(void 0===s&&(s=0),void 0===o&&(o=c.length),!l||c[s]&&c[s].id===l)c=c.slice(s,o);else{let n=function(e,t,n){for(let r=0;r<20;r+=1){if(t[n-r]){let i=t[n-r].findIndex((t=>t.id===e));if(-1!==i)return[n-r,i]}if(t[n+r]){let i=t[n+r].findIndex((t=>t.id===e));if(-1!==i)return[n+r,i]}}return null}(l,t,a);if(null!==n){let r=o-s;c=t[n[0]].slice(n[1],n[1]+r);let a=c[0]?c[0].id:null;e[i]=[n[0],n[1],n[1]+r,a]}}0!==c.length&&s!==o&&(u&&c[c.length-1].id!==u&&(c=function(e,t){let[n,r,,,i]=e,a=t[n],s=a.findIndex((e=>e.id===i));return-1===s?(e[2]=t[n].length,e[4]=a.length?a[a.length-1].id:null):e[2]=s,t[n].slice(r,e[2]+1)}(r,t)),n.push(c))})),n=n.filter((e=>e.length>0)),n},pointer:{indexN:Mx,splitAll:$x}}},Vx=function(e,t){let n=e.concat(t),r=Mx(n),i=[];return n.forEach((e=>{let[t]=e;if(1===r[t].length)return void i.push(e);let n=r[t].filter((t=>Lx(e,t)));n.push(e);let a=function(e){let t=e[0][1],n=e[0][2];return e.forEach((e=>{e[1]<t&&(t=e[1]),e[2]>n&&(n=e[2])})),[e[0][0],t,n]}(n);i.push(a)})),i=function(e){let t={};for(let n=0;n<e.length;n+=1)t[e[n].join(",")]=e[n];return Object.values(t)}(i),i},zx=function(e,t){let n=[];return $x(e,t).forEach((e=>{e.passthrough&&n.push(e.passthrough),e.before&&n.push(e.before),e.after&&n.push(e.after)})),n},Bx=(e,t)=>{return"string"==typeof e||(n=e,"[object Array]"===Object.prototype.toString.call(n))?t.match(e):e||t.none();var n},Ux=function(e,t){return e.map((e=>{let[n,r]=e;return t[n]&&t[n][r]&&(e[3]=t[n][r].id),e}))},Hx={union:function(e){e=Bx(e,this);let t=Vx(this.fullPointer,e.fullPointer);return t=Ux(t,this.document),this.toView(t)}};Hx.and=Hx.union,Hx.intersection=function(e){e=Bx(e,this);let t=function(e,t){let n=Mx(t),r=[];return e.forEach((e=>{let t=n[e[0]]||[];t=t.filter((t=>Lx(e,t))),0!==t.length&&t.forEach((t=>{let n=function(e,t){let n=e[1]<t[1]?t[1]:e[1],r=e[2]>t[2]?t[2]:e[2];return n<r?[e[0],n,r]:null}(e,t);n&&r.push(n)}))})),r}(this.fullPointer,e.fullPointer);return t=Ux(t,this.document),this.toView(t)},Hx.not=function(e){e=Bx(e,this);let t=zx(this.fullPointer,e.fullPointer);return t=Ux(t,this.document),this.toView(t)},Hx.difference=Hx.not,Hx.complement=function(){let e=this.all(),t=zx(e.fullPointer,this.fullPointer);return t=Ux(t,this.document),this.toView(t)},Hx.settle=function(){let e=this.fullPointer;return e.forEach((t=>{e=Vx(e,[t])})),e=Ux(e,this.document),this.update(e)};const Gx={methods:Fx,api:function(e){Object.assign(e.prototype,Hx)}},qx=function(e){return!0===e.optional||!0===e.negative?null:e.tag?"#"+e.tag:e.word?e.word:e.switch?`%${e.switch}%`:null},Kx={lib:{buildNet:function(e){let t=this.methods().one.buildNet(e,this.world());return t.isNet=!0,t}},api:function(e){e.prototype.sweep=function(e,t={}){const{world:n,docs:r}=this,{methods:i}=n;let a=i.one.bulkMatch(r,e,this.methods,t);!1!==t.tagger&&i.one.bulkTagger(a,r,this.world),a=a.map((e=>{let t=e.pointer,n=r[t[0]][t[1]],i=t[2]-t[1];return n.index&&(e.pointer=[n.index[0],n.index[1],t[1]+i]),e}));let s=a.map((e=>e.pointer));return a=a.map((e=>(e.view=this.update([e.pointer]),delete e.regs,delete e.needs,delete e.pointer,delete e._expanded,e))),{view:this.update(s),found:a}}},methods:{one:{buildNet:function(e,t){e=function(e,t){const n=t.methods.one.parseMatch;return e.forEach((e=>{e.regs=n(e.match,{},t),"string"==typeof e.ifNo&&(e.ifNo=[e.ifNo]),e.notIf&&(e.notIf=n(e.notIf,{},t)),e.needs=function(e){let t=[];return e.forEach((e=>{t.push(qx(e)),"and"===e.operator&&e.choices&&e.choices.forEach((e=>{e.forEach((e=>{t.push(qx(e))}))}))})),t.filter((e=>e))}(e.regs);let{wants:r,count:i}=function(e){let t=[],n=0;return e.forEach((e=>{"or"!==e.operator||e.optional||e.negative||(e.fastOr&&Array.from(e.fastOr).forEach((e=>{t.push(e)})),e.choices&&e.choices.forEach((e=>{e.forEach((e=>{let n=qx(e);n&&t.push(n)}))})),n+=1)})),{wants:t,count:n}}(e.regs);e.wants=r,e.minWant=i,e.minWords=e.regs.filter((e=>!e.optional)).length})),e}(e,t);let n={};e.forEach((e=>{e.needs.forEach((t=>{n[t]=Array.isArray(n[t])?n[t]:[],n[t].push(e)})),e.wants.forEach((t=>{n[t]=Array.isArray(n[t])?n[t]:[],n[t].push(e)}))})),Object.keys(n).forEach((e=>{let t={};n[e]=n[e].filter((e=>"boolean"!=typeof t[e.match]&&(t[e.match]=!0,!0)))}));let r=e.filter((e=>0===e.needs.length&&0===e.wants.length));return{hooks:n,always:r}},bulkMatch:function(e,t,n,r={}){let i=n.one.cacheDoc(e),a=function(e,t){return e.map(((n,r)=>{let i=[];Object.keys(t).forEach((n=>{e[r].has(n)&&(i=i.concat(t[n]))}));let a={};return i=i.filter((e=>"boolean"!=typeof a[e.match]&&(a[e.match]=!0,!0))),i}))}(i,t.hooks);return a=function(e,t){return e.map(((e,n)=>{let r=t[n];return(e=(e=e.filter((e=>e.needs.every((e=>r.has(e)))))).filter((e=>void 0===e.ifNo||!0!==e.ifNo.some((e=>r.has(e)))))).filter((e=>0===e.wants.length||e.wants.filter((e=>r.has(e))).length>=e.minWant))}))}(a,i),t.always.length>0&&(a=a.map((e=>e.concat(t.always)))),a=function(e,t){return e.map(((e,n)=>{let r=t[n].length;return e.filter((e=>r>=e.minWords))}))}(a,e),function(e,t,n,r,i){let a=[];for(let n=0;n<e.length;n+=1)for(let s=0;s<e[n].length;s+=1){let o=e[n][s],l=r.one.match([t[n]],o);if(l.ptrs.length>0&&(l.ptrs.forEach((e=>{e[0]=n;let t=Object.assign({},o,{pointer:e});void 0!==o.unTag&&(t.unTag=o.unTag),a.push(t)})),!0===i.matchOne))return[a[0]]}return a}(a,e,0,n,r)},bulkTagger:function(e,t,n){const{model:r,methods:i}=n,{getDoc:a,setTag:s,unTag:o}=i.one,l=i.two.looksPlural;return 0===e.length?e:(("undefined"!=typeof process&&process.env?process.env:self.env||{}).DEBUG_TAGS&&console.log(`\n\n  [32m→ ${e.length} post-tagger:[0m`),e.map((e=>{if(!e.tag&&!e.chunk&&!e.unTag)return;let i=e.reason||e.match,u=a([e.pointer],t)[0];if(!0===e.safe){if(!1===function(e,t,n){let r=n.one.tagSet;if(!r.hasOwnProperty(t))return!0;let i=r[t].not||[];for(let t=0;t<e.length;t+=1){let n=e[t];for(let e=0;e<i.length;e+=1)if(!0===n.tags.has(i[e]))return!1}return!0}(u,e.tag,r))return;if("-"===u[u.length-1].post)return}if(void 0!==e.tag){if(s(u,e.tag,n,e.safe,`[post] '${i}'`),"Noun"===e.tag&&l){let t=u[u.length-1];l(t.text)?s([t],"Plural",n,e.safe,"quick-plural"):s([t],"Singular",n,e.safe,"quick-singular")}!0===e.freeze&&u.forEach((e=>e.frozen=!0))}void 0!==e.unTag&&o(u,e.unTag,n,e.safe,i),e.chunk&&u.forEach((t=>t.chunk=e.chunk))})))}}}},Wx=/ /,Jx=function(e,t){"Noun"===t&&(e.chunk=t),"Verb"===t&&(e.chunk=t)},Zx=function(e,t,n,r){if(!0===e.tags.has(t))return null;if("."===t)return null;!0===e.frozen&&(r=!0);let i=n[t];if(i){if(i.not&&i.not.length>0)for(let t=0;t<i.not.length;t+=1){if(!0===r&&e.tags.has(i.not[t]))return null;e.tags.delete(i.not[t])}if(i.parents&&i.parents.length>0)for(let t=0;t<i.parents.length;t+=1)e.tags.add(i.parents[t]),Jx(e,i.parents[t])}return e.tags.add(t),e.dirty=!0,Jx(e,t),!0},Qx=function(e,t,n={},r,i){const a=n.model.one.tagSet||{};if(!t)return;const s="undefined"!=typeof process&&process.env?process.env:self.env||{};var o;if(s&&s.DEBUG_TAGS&&((e,t,n="")=>{let r=e.map((e=>e.text||"["+e.implicit+"]")).join(" ");"string"!=typeof t&&t.length>2&&(t=t.slice(0,2).join(", #")+" +"),t="string"!=typeof t?t.join(", #"):t,console.log(` ${(e=>"[33m[3m"+e+"[0m")(r).padEnd(24)} [32m→[0m #${t.padEnd(22)}  ${(e=>"[3m"+e+"[0m")(n)}`)})(e,t,i),1!=(o=t,"[object Array]"===Object.prototype.toString.call(o)))if("string"==typeof t)if(t=t.trim(),Wx.test(t))!function(e,t,n,r){let i=t.split(Wx);e.forEach(((e,t)=>{let a=i[t];a&&(a=a.replace(/^#/,""),Zx(e,a,n,r))}))}(e,t,a,r);else{t=t.replace(/^#/,"");for(let n=0;n<e.length;n+=1)Zx(e[n],t,a,r)}else console.warn(`compromise: Invalid tag '${t}'`);else t.forEach((t=>Qx(e,t,n,r)))},Xx=Qx,Yx=function(e){return e.children=e.children||[],e._cache=e._cache||{},e.props=e.props||{},e._cache.parents=e._cache.parents||[],e._cache.children=e._cache.children||[],e},eC=/^ *(#|\/\/)/,tC=function(e){let t=e.trim().split(/->/),n=[];t.forEach((e=>{n=n.concat(function(e){if(!(e=e.trim()))return null;if(/^\[/.test(e)&&/\]$/.test(e)){let t=(e=(e=e.replace(/^\[/,"")).replace(/\]$/,"")).split(/,/);return t=t.map((e=>e.trim())).filter((e=>e)),t=t.map((e=>Yx({id:e}))),t}return[Yx({id:e})]}(e))})),n=n.filter((e=>e));let r=n[0];for(let e=1;e<n.length;e+=1)r.children.push(n[e]),r=n[e];return n[0]},nC=(e,t)=>{let n=[],r=[e];for(;r.length>0;){let e=r.pop();n.push(e),e.children&&e.children.forEach((n=>{t&&t(e,n),r.push(n)}))}return n},rC=e=>"[object Array]"===Object.prototype.toString.call(e),iC=e=>(e=e||"").trim(),aC=function(e,t){let n="-> ";t&&(n="[2m→ [0m");let r="";return nC(e).forEach(((e,i)=>{let a=e.id||"";if(t&&(a=(e=>"[31m"+e+"[0m")(a)),0===i&&!e.id)return;let s=e._cache.parents.length;r+="    ".repeat(s)+n+a+"\n"})),r},sC=function(e){let t=nC(e);t.forEach((e=>{delete(e=Object.assign({},e)).children}));let n=t[0];return n&&!n.id&&0===Object.keys(n.props).length&&t.shift(),t},oC={text:aC,txt:aC,array:sC,flat:sC},lC=function(e,t){return"nested"===t||"json"===t?e:"debug"===t?(console.log(aC(e,!0)),null):oC.hasOwnProperty(t)?oC[t](e):e},uC=e=>{nC(e,((e,t)=>{e.id&&(e._cache.parents=e._cache.parents||[],t._cache.parents=e._cache.parents.concat([e.id]))}))},cC=/\//;class hC{constructor(e={}){Object.defineProperty(this,"json",{enumerable:!1,value:e,writable:!0})}get children(){return this.json.children}get id(){return this.json.id}get found(){return this.json.id||this.json.children.length>0}props(e={}){let t=this.json.props||{};return"string"==typeof e&&(t[e]=!0),this.json.props=Object.assign(t,e),this}get(e){if(e=iC(e),!cC.test(e)){let t=this.json.children.find((t=>t.id===e));return new hC(t)}let t=((e,t)=>{let n=(e=>"string"!=typeof e?e:(e=e.replace(/^\//,"")).split(/\//))(t=t||"");for(let t=0;t<n.length;t+=1){let r=e.children.find((e=>e.id===n[t]));if(!r)return null;e=r}return e})(this.json,e)||Yx({});return new hC(t)}add(e,t={}){if(rC(e))return e.forEach((e=>this.add(iC(e),t))),this;e=iC(e);let n=Yx({id:e,props:t});return this.json.children.push(n),new hC(n)}remove(e){return e=iC(e),this.json.children=this.json.children.filter((t=>t.id!==e)),this}nodes(){return nC(this.json).map((e=>(delete(e=Object.assign({},e)).children,e)))}cache(){return(e=>{let t=nC(e,((e,t)=>{e.id&&(e._cache.parents=e._cache.parents||[],e._cache.children=e._cache.children||[],t._cache.parents=e._cache.parents.concat([e.id]))})),n={};t.forEach((e=>{e.id&&(n[e.id]=e)})),t.forEach((e=>{e._cache.parents.forEach((t=>{n.hasOwnProperty(t)&&n[t]._cache.children.push(e.id)}))})),e._cache.children=Object.keys(n)})(this.json),this}list(){return nC(this.json)}fillDown(){var e;return e=this.json,nC(e,((e,t)=>{t.props=((e,t)=>(Object.keys(t).forEach((n=>{if(t[n]instanceof Set){let r=e[n]||new Set;e[n]=new Set([...r,...t[n]])}else if((e=>e&&"object"==typeof e&&!Array.isArray(e))(t[n])){let r=e[n]||{};e[n]=Object.assign({},t[n],r)}else rC(t[n])?e[n]=t[n].concat(e[n]||[]):void 0===e[n]&&(e[n]=t[n])})),e))(t.props,e.props)})),this}depth(){uC(this.json);let e=nC(this.json),t=e.length>1?1:0;return e.forEach((e=>{if(0===e._cache.parents.length)return;let n=e._cache.parents.length+1;n>t&&(t=n)})),t}out(e){return uC(this.json),lC(this.json,e)}debug(){return uC(this.json),lC(this.json,"debug"),this}}const dC=function(e){let t=function(e=[]){return"string"==typeof e?function(e){let t=e.split(/\r?\n/),n=[];t.forEach((e=>{if(!e.trim()||eC.test(e))return;let t=(e=>{const t=/^( {2}|\t)/;let n=0;for(;t.test(e);)e=e.replace(t,""),n+=1;return n})(e);n.push({indent:t,node:tC(e)})}));let r=function(e){let t={children:[]};return e.forEach(((n,r)=>{0===n.indent?t.children=t.children.concat(n.node):e[r-1]&&function(e,t){let n=e[t].indent;for(;t>=0;t-=1)if(e[t].indent<n)return e[t];return e[0]}(e,r).node.children.push(n.node)})),t}(n);return r=Yx(r),r}(e):rC(e)?function(e){let t={};e.forEach((e=>{t[e.id]=e}));let n=Yx({});return e.forEach((e=>{if((e=Yx(e)).parent)if(t.hasOwnProperty(e.parent)){let n=t[e.parent];delete e.parent,n.children.push(e)}else console.warn(`[Grad] - missing node '${e.parent}'`);else n.children.push(e)})),n}(e):(nC(t=e).forEach(Yx),t);var t}(e);return new hC(t)};dC.prototype.plugin=function(e){e(this)};const pC={Noun:"blue",Verb:"green",Negative:"green",Date:"red",Value:"red",Adjective:"magenta",Preposition:"cyan",Conjunction:"cyan",Determiner:"cyan",Hyphenated:"cyan",Adverb:"cyan"},fC=function(e){if(pC.hasOwnProperty(e.id))return pC[e.id];if(pC.hasOwnProperty(e.is))return pC[e.is];let t=e._cache.parents.find((e=>pC[e]));return pC[t]},mC=function(e){return e?"string"==typeof e?[e]:e:[]},gC={one:{setTag:Xx,unTag:function(e,t,n){t=t.trim().replace(/^#/,"");for(let r=0;r<e.length;r+=1){let i=e[r];if(!0===i.frozen)continue;if("*"===t){i.tags.clear();continue}let a=n[t];if(a&&a.children.length>0)for(let e=0;e<a.children.length;e+=1)i.tags.delete(a.children[e]);i.tags.delete(t)}},addTags:function(e,t){Object.keys(t).length>0&&(e=function(e){return Object.keys(e).forEach((t=>{e[t]=Object.assign({},e[t]),e[t].novel=!0})),e}(e)),e=function(e,t){return e=function(e,t){return Object.keys(e).forEach((n=>{e[n].isA&&(e[n].is=e[n].isA),e[n].notA&&(e[n].not=e[n].notA),e[n].is&&"string"==typeof e[n].is&&(t.hasOwnProperty(e[n].is)||e.hasOwnProperty(e[n].is)||(e[e[n].is]={})),e[n].not&&"string"==typeof e[n].not&&!e.hasOwnProperty(e[n].not)&&(t.hasOwnProperty(e[n].not)||e.hasOwnProperty(e[n].not)||(e[e[n].not]={}))})),e}(e,t),Object.keys(e).forEach((t=>{e[t].children=mC(e[t].children),e[t].not=mC(e[t].not)})),Object.keys(e).forEach((t=>{(e[t].not||[]).forEach((n=>{e[n]&&e[n].not&&e[n].not.push(t)}))})),e}(e,t);const n=function(e){const t=Object.keys(e).map((t=>{let n=e[t];const r={not:new Set(n.not),also:n.also,is:n.is,novel:n.novel};return{id:t,parent:n.is,props:r,children:[]}}));return dC(t).cache().fillDown().out("array")}(Object.assign({},t,e));return function(e){const t={};return e.forEach((e=>{let{not:n,also:r,is:i,novel:a}=e.props,s=e._cache.parents;r&&(s=s.concat(r)),t[e.id]={is:i,not:n,novel:a,also:r,parents:s,children:e._cache.children,color:fC(e)}})),Object.keys(t).forEach((e=>{let n=new Set(t[e].not);t[e].not.forEach((e=>{t[e]&&t[e].children.forEach((e=>n.add(e)))})),t[e].not=Array.from(n)})),t}(n)},canBe:function(e,t,n){if(!n.hasOwnProperty(t))return!0;let r=n[t].not||[];for(let t=0;t<r.length;t+=1)if(e.tags.has(r[t]))return!1;return!0}}},yC=function(e){return"[object Array]"===Object.prototype.toString.call(e)},vC={tag:function(e,t="",n){if(!this.found||!e)return this;let r=this.termList();if(0===r.length)return this;const{methods:i,verbose:a,world:s}=this;return!0===a&&console.log(" +  ",e,t||""),yC(e)?e.forEach((e=>i.one.setTag(r,e,s,n,t))):i.one.setTag(r,e,s,n,t),this.uncache(),this},tagSafe:function(e,t=""){return this.tag(e,t,!0)},unTag:function(e,t){if(!this.found||!e)return this;let n=this.termList();if(0===n.length)return this;const{methods:r,verbose:i,model:a}=this;!0===i&&console.log(" -  ",e,t||"");let s=a.one.tagSet;return yC(e)?e.forEach((e=>r.one.unTag(n,e,s))):r.one.unTag(n,e,s),this.uncache(),this},canBe:function(e){e=e.replace(/^#/,"");let t=this.model.one.tagSet,n=this.methods.one.canBe,r=[];this.document.forEach(((i,a)=>{i.forEach(((i,s)=>{n(i,e,t)||r.push([a,s,s+1])}))}));let i=this.update(r);return this.difference(i)}},bC=vC,wC=new Set(["Auxiliary","Possessive"]),_C={model:{one:{tagSet:{}}},compute:{tagRank:function(e){const{document:t,world:n}=e,r=n.model.one.tagSet;t.forEach((e=>{e.forEach((e=>{let t=Array.from(e.tags);e.tagRank=function(e,t){return e=e.sort(((e,n)=>{if(wC.has(e)||!t.hasOwnProperty(n))return 1;if(wC.has(n)||!t.hasOwnProperty(e))return-1;let r=t[e].children||[],i=r.length;return r=t[n].children||[],i-r.length})),e}(t,r)}))}))}},methods:gC,api:function(e){Object.assign(e.prototype,bC)},lib:{addTags:function(e){const{model:t,methods:n}=this.world(),r=t.one.tagSet;let i=(0,n.one.addTags)(e,r);return t.one.tagSet=i,this}}},kC=/([.!?\u203D\u2E18\u203C\u2047-\u2049\u3002]+\s)/g,AC=/^[.!?\u203D\u2E18\u203C\u2047-\u2049\u3002]+\s$/,PC=/((?:\r?\n|\r)+)/,TC=/[a-z0-9\u00C0-\u00FF\u00a9\u00ae\u2000-\u3300\ud000-\udfff]/i,IC=/\S/,EC={'"':'"',"＂":"＂","“":"”","‟":"”","„":"”","⹂":"”","‚":"’","«":"»","‹":"›","‵":"′","‶":"″","‷":"‴","〝":"〞","〟":"〞"},xC=RegExp("["+Object.keys(EC).join("")+"]","g"),CC=RegExp("["+Object.values(EC).join("")+"]","g"),OC=function(e){if(!e)return!1;let t=e.match(CC);return null!==t&&1===t.length},SC=/\(/g,NC=/\)/g,jC=/\S/,DC=/^\s+/,RC=function(e,t){let n=e.split(/[-–—]/);if(n.length<=1)return!1;const{prefixes:r,suffixes:i}=t.one;return!(1===n[0].length&&/[a-z]/i.test(n[0])||r.hasOwnProperty(n[0])||(n[1]=n[1].trim().replace(/[.?!]$/,""),i.hasOwnProperty(n[1])||!0!==/^([a-z\u00C0-\u00FF`"'/]+)[-–—]([a-z0-9\u00C0-\u00FF].*)/i.test(e)&&!0!==/^[('"]?([0-9]{1,4})[-–—]([a-z\u00C0-\u00FF`"'/-]+[)'"]?$)/i.test(e)))},LC=function(e){let t=[];const n=e.split(/[-–—]/);let r="-",i=e.match(/[-–—]/);i&&i[0]&&(r=i);for(let e=0;e<n.length;e++)e===n.length-1?t.push(n[e]):t.push(n[e]+r);return t},MC=/\p{L} ?\/ ?\p{L}+$/u,$C=/\S/,FC=/^[!?.]+$/,VC=/(\S+)/;let zC=[".","?","!",":",";","-","–","—","--","...","(",")","[","]",'"',"'","`","«","»","*","•"];zC=zC.reduce(((e,t)=>(e[t]=!0,e)),{});const BC=/\p{Letter}/u,UC=/[\p{Number}\p{Currency_Symbol}]/u,HC=/^[a-z]\.([a-z]\.)+/i,GC=/[sn]['’]$/,qC=/([A-Z]\.)+[A-Z]?,?$/,KC=/^[A-Z]\.,?$/,WC=/[A-Z]{2,}('s|,)?$/,JC=/([a-z]\.)+[a-z]\.?$/,ZC=function(e,t){const n=t.methods.one.killUnicode;let r=e.text||"";r=function(e){let t=e=(e=(e=e||"").toLowerCase()).trim();return e=(e=(e=e.replace(/[,;.!?]+$/,"")).replace(/\u2026/g,"...")).replace(/\u2013/g,"-"),!1===/^[:;]/.test(e)&&(e=(e=(e=e.replace(/\.{3,}$/g,"")).replace(/[",.!:;?)]+$/g,"")).replace(/^['"(]+/g,"")),""===(e=(e=e.replace(/[\u200B-\u200D\uFEFF]/g,"")).trim())&&(e=t),e.replace(/([0-9]),([0-9])/g,"$1$2")}(r),r=n(r,t),r=function(e){return function(e){return!0===qC.test(e)||!0===JC.test(e)||!0===KC.test(e)||!0===WC.test(e)}(e)&&(e=e.replace(/\./g,"")),e}(r),e.normal=r},QC=/[ .][A-Z]\.? *$/i,XC=/(?:\u2026|\.{2,}) *$/,YC=/\p{L}/u,eO=/\. *$/,tO=/^[A-Z]\. $/,nO={one:{killUnicode:function(e,t){const n=t.model.one.unicode||{};let r=(e=e||"").split("");return r.forEach(((e,t)=>{n[e]&&(r[t]=n[e])})),r.join("")},tokenize:{splitSentences:function(e,t){if(e=e||"",!(e=String(e))||"string"!=typeof e||!1===jC.test(e))return[];let n=function(e){let t=[],n=e.split(PC);for(let e=0;e<n.length;e++){let r=n[e].split(kC);for(let e=0;e<r.length;e++)r[e+1]&&!0===AC.test(r[e+1])&&(r[e]+=r[e+1],r[e+1]=""),""!==r[e]&&t.push(r[e])}return t}(e=e.replace(" "," ")),r=function(e){let t=[];for(let n=0;n<e.length;n++){let r=e[n];if(void 0!==r&&""!==r){if(!1===IC.test(r)||!1===TC.test(r)){if(t[t.length-1]){t[t.length-1]+=r;continue}if(e[n+1]){e[n+1]=r+e[n+1];continue}}t.push(r)}}return t}(n);if(r=function(e,t){const n=t.methods.one.tokenize.isSentence,r=t.model.one.abbreviations||new Set;let i=[];for(let t=0;t<e.length;t++){let a=e[t];e[t+1]&&!1===n(a,r)?e[t+1]=a+(e[t+1]||""):a&&a.length>0&&(i.push(a),e[t]="")}return i}(r,t),r=function(e){let t=[];for(let n=0;n<e.length;n+=1){let r=e[n].match(xC);if(null!==r&&1===r.length){if(OC(e[n+1])&&e[n+1].length<280){e[n]+=e[n+1],t.push(e[n]),e[n+1]="",n+=1;continue}if(OC(e[n+2])){let r=e[n+1]+e[n+2];if(r.length<280){e[n]+=r,t.push(e[n]),e[n+1]="",e[n+2]="",n+=2;continue}}}t.push(e[n])}return t}(r),r=function(e){let t=[];for(let n=0;n<e.length;n+=1){let r=e[n].match(SC);null!==r&&1===r.length&&e[n+1]&&e[n+1].length<250&&null!==e[n+1].match(NC)&&1===r.length&&!SC.test(e[n+1])?(e[n]+=e[n+1],t.push(e[n]),e[n+1]="",n+=1):t.push(e[n])}return t}(r),0===r.length)return[e];for(let e=1;e<r.length;e+=1){let t=r[e].match(DC);null!==t&&(r[e-1]+=t[0],r[e]=r[e].replace(DC,""))}return r},isSentence:function(e,t){if(!1===YC.test(e))return!1;if(!0===QC.test(e))return!1;if(3===e.length&&tO.test(e))return!1;if(!0===XC.test(e))return!1;let n=e.replace(/[.!?\u203D\u2E18\u203C\u2047-\u2049] *$/,"").split(" "),r=n[n.length-1].toLowerCase();return!0!==t.hasOwnProperty(r)||!0!==eO.test(e)},splitTerms:function(e,t){let n=[],r=[];if("number"==typeof(e=e||"")&&(e=String(e)),function(e){return"[object Array]"===Object.prototype.toString.call(e)}(e))return e;const i=e.split(VC);for(let e=0;e<i.length;e++)!0!==RC(i[e],t)?r.push(i[e]):r=r.concat(LC(i[e]));let a="";for(let e=0;e<r.length;e++){let t=r[e];!0===$C.test(t)&&!1===zC.hasOwnProperty(t)&&!1===FC.test(t)?(n.length>0?(n[n.length-1]+=a,n.push(t)):n.push(a+t),a=""):a+=t}return a&&(0===n.length&&(n[0]=""),n[n.length-1]+=a),n=function(e){for(let t=1;t<e.length-1;t++)MC.test(e[t])&&(e[t-1]+=e[t]+e[t+1],e[t]=null,e[t+1]=null);return e}(n),n=function(e){const t=/^[0-9]{1,4}(:[0-9][0-9])?([a-z]{1,2})? ?[-–—] ?$/,n=/^[0-9]{1,4}([a-z]{1,2})? ?$/;for(let r=0;r<e.length-1;r+=1)e[r+1]&&t.test(e[r])&&n.test(e[r+1])&&(e[r]=e[r]+e[r+1],e[r+1]=null);return e}(n),n=n.filter((e=>e)),n},splitWhitespace:(e,t)=>{let{str:n,pre:r,post:i}=function(e,t){let{prePunctuation:n,postPunctuation:r,emoticons:i}=t.one,a=e,s="",o="",l=Array.from(e);if(i.hasOwnProperty(e.trim()))return{str:e.trim(),pre:s,post:" "};let u=l.length;for(let e=0;e<u;e+=1){let e=l[0];if(!0!==n[e]){if(("+"===e||"-"===e)&&UC.test(l[1]))break;if("'"===e&&3===e.length&&UC.test(l[1]))break;if(BC.test(e)||UC.test(e))break;s+=l.shift()}}u=l.length;for(let e=0;e<u;e+=1){let e=l[l.length-1];if(!0!==r[e]){if(BC.test(e)||UC.test(e))break;"."===e&&!0===HC.test(a)||"'"===e&&!0===GC.test(a)||(o=l.pop()+o)}}return""===(e=l.join(""))&&(a=a.replace(/ *$/,(e=>(o=e||"",""))),e=a,s=""),{str:e,pre:s,post:o}}(e,t);return{text:n,pre:r,post:i,tags:new Set}},fromString:function(e,t){const{methods:n,model:r}=t,{splitSentences:i,splitTerms:a,splitWhitespace:s}=n.one.tokenize;return e=i(e=e||"",t).map((e=>{let n=a(e,r);return n=n.map((e=>s(e,r))),n.forEach((e=>{ZC(e,t)})),n})),e}}}};let rO={},iO={};[[["approx","apt","bc","cyn","eg","esp","est","etc","ex","exp","prob","pron","gal","min","pseud","fig","jd","lat","lng","vol","fm","def","misc","plz","ea","ps","sec","pt","pref","pl","pp","qt","fr","sq","nee","ss","tel","temp","vet","ver","fem","masc","eng","adj","vb","rb","inf","situ","vivo","vitro","wr"]],[["dl","ml","gal","qt","pt","tbl","tsp","tbsp","km","dm","cm","mm","mi","td","hr","hrs","kg","hg","dg","cg","mg","µg","lb","oz","sq ft","hz","mps","mph","kmph","kb","mb","tb","lx","lm","fl oz","yb"],"Unit"],[["ad","al","arc","ba","bl","ca","cca","col","corp","ft","fy","ie","lit","ma","md","pd","tce"],"Noun"],[["adj","adm","adv","asst","atty","bldg","brig","capt","cmdr","comdr","cpl","det","dr","esq","gen","gov","hon","jr","llb","lt","maj","messrs","mlle","mme","mr","mrs","ms","mstr","phd","prof","pvt","rep","reps","res","rev","sen","sens","sfc","sgt","sir","sr","supt","surg"],"Honorific"],[["jan","feb","mar","apr","jun","jul","aug","sep","sept","oct","nov","dec"],"Month"],[["dept","univ","assn","bros","inc","ltd","co"],"Organization"],[["rd","st","dist","mt","ave","blvd","cl","cres","hwy","ariz","cal","calif","colo","conn","fla","fl","ga","ida","ia","kan","kans","minn","neb","nebr","okla","penna","penn","pa","dak","tenn","tex","ut","vt","va","wis","wisc","wy","wyo","usafa","alta","ont","que","sask"],"Place"]].forEach((e=>{e[0].forEach((t=>{rO[t]=!0,iO[t]="Abbreviation",void 0!==e[1]&&(iO[t]=[iO[t],e[1]])}))}));const aO=["anti","bi","co","contra","de","extra","infra","inter","intra","macro","micro","mis","mono","multi","peri","pre","pro","proto","pseudo","re","sub","supra","trans","tri","un","out","ex"].reduce(((e,t)=>(e[t]=!0,e)),{});let sO={"!":"¡","?":"¿Ɂ",'"':'“”"❝❞',"'":"‘‛❛❜’","-":"—–",a:"ªÀÁÂÃÄÅàáâãäåĀāĂăĄąǍǎǞǟǠǡǺǻȀȁȂȃȦȧȺΆΑΔΛάαλАаѦѧӐӑӒӓƛæ",b:"ßþƀƁƂƃƄƅɃΒβϐϦБВЪЬвъьѢѣҌҍ",c:"¢©ÇçĆćĈĉĊċČčƆƇƈȻȼͻͼϲϹϽϾСсєҀҁҪҫ",d:"ÐĎďĐđƉƊȡƋƌ",e:"ÈÉÊËèéêëĒēĔĕĖėĘęĚěƐȄȅȆȇȨȩɆɇΈΕΞΣέεξϵЀЁЕеѐёҼҽҾҿӖӗễ",f:"ƑƒϜϝӺӻҒғſ",g:"ĜĝĞğĠġĢģƓǤǥǦǧǴǵ",h:"ĤĥĦħƕǶȞȟΉΗЂЊЋНнђћҢңҤҥҺһӉӊ",I:"ÌÍÎÏ",i:"ìíîïĨĩĪīĬĭĮįİıƖƗȈȉȊȋΊΐΪίιϊІЇіїi̇",j:"ĴĵǰȷɈɉϳЈј",k:"ĶķĸƘƙǨǩΚκЌЖКжкќҚқҜҝҞҟҠҡ",l:"ĹĺĻļĽľĿŀŁłƚƪǀǏǐȴȽΙӀӏ",m:"ΜϺϻМмӍӎ",n:"ÑñŃńŅņŇňŉŊŋƝƞǸǹȠȵΝΠήηϞЍИЙЛПийлпѝҊҋӅӆӢӣӤӥπ",o:"ÒÓÔÕÖØðòóôõöøŌōŎŏŐőƟƠơǑǒǪǫǬǭǾǿȌȍȎȏȪȫȬȭȮȯȰȱΌΘΟθοσόϕϘϙϬϴОФоѲѳӦӧӨөӪӫ",p:"ƤΡρϷϸϼРрҎҏÞ",q:"Ɋɋ",r:"ŔŕŖŗŘřƦȐȑȒȓɌɍЃГЯгяѓҐґ",s:"ŚśŜŝŞşŠšƧƨȘșȿЅѕ",t:"ŢţŤťŦŧƫƬƭƮȚțȶȾΓΤτϮТт",u:"ÙÚÛÜùúûüŨũŪūŬŭŮůŰűŲųƯưƱƲǓǔǕǖǗǘǙǚǛǜȔȕȖȗɄΰυϋύ",v:"νѴѵѶѷ",w:"ŴŵƜωώϖϢϣШЩшщѡѿ",x:"×ΧχϗϰХхҲҳӼӽӾӿ",y:"ÝýÿŶŷŸƳƴȲȳɎɏΎΥΫγψϒϓϔЎУучўѰѱҮүҰұӮӯӰӱӲӳ",z:"ŹźŻżŽžƵƶȤȥɀΖ"},oO={};Object.keys(sO).forEach((function(e){sO[e].split("").forEach((function(t){oO[t]=e}))}));const lO=/\//,uO=/[a-z]\.[a-z]/i,cO=/[0-9]/,hO=function(e,t){let n=e.normal||e.text||e.machine;const r=t.model.one.aliases;if(r.hasOwnProperty(n)&&(e.alias=e.alias||[],e.alias.push(r[n])),lO.test(n)&&!uO.test(n)&&!cO.test(n)){let t=n.split(lO);t.length<=3&&t.forEach((t=>{""!==(t=t.trim())&&(e.alias=e.alias||[],e.alias.push(t))}))}return e},dO=/^\p{Letter}+-\p{Letter}+$/u,pO=function(e){let t=e.implicit||e.normal||e.text;t=t.replace(/['’]s$/,""),t=t.replace(/s['’]$/,"s"),t=t.replace(/([aeiou][ktrp])in'$/,"$1ing"),dO.test(t)&&(t=t.replace(/-/g,"")),t=t.replace(/^[#@]/,""),t!==e.normal&&(e.machine=t)},fO=function(e,t){let n=e.docs;for(let r=0;r<n.length;r+=1)for(let i=0;i<n[r].length;i+=1)t(n[r][i],e.world)},mO={alias:e=>fO(e,hO),machine:e=>fO(e,pO),normal:e=>fO(e,ZC),freq:function(e){let t=e.docs,n={};for(let e=0;e<t.length;e+=1)for(let r=0;r<t[e].length;r+=1){let i=t[e][r],a=i.machine||i.normal;n[a]=n[a]||0,n[a]+=1}for(let e=0;e<t.length;e+=1)for(let r=0;r<t[e].length;r+=1){let i=t[e][r],a=i.machine||i.normal;i.freq=n[a]}},offset:function(e){let t=0,n=0,r=e.document;for(let e=0;e<r.length;e+=1)for(let i=0;i<r[e].length;i+=1){let a=r[e][i];a.offset={index:n,start:t+a.pre.length,length:a.text.length},t+=a.pre.length+a.text.length+a.post.length,n+=1}},index:function(e){let t=e.document;for(let e=0;e<t.length;e+=1)for(let n=0;n<t[e].length;n+=1)t[e][n].index=[e,n]},wordCount:function(e){let t=0,n=e.docs;for(let e=0;e<n.length;e+=1)for(let r=0;r<n[e].length;r+=1)""!==n[e][r].normal&&(t+=1,n[e][r].wordCount=t)}},gO={compute:mO,methods:nO,model:{one:{aliases:{"&":"and","@":"at","%":"percent",plz:"please",bein:"being"},abbreviations:rO,prefixes:aO,suffixes:{like:!0,ish:!0,less:!0,able:!0,elect:!0,type:!0,designate:!0},prePunctuation:{"#":!0,"@":!0,_:!0,"°":!0,"​":!0,"‌":!0,"‍":!0,"\ufeff":!0},postPunctuation:{"%":!0,_:!0,"°":!0,"​":!0,"‌":!0,"‍":!0,"\ufeff":!0},lexicon:iO,unicode:oO,emoticons:{"<3":!0,"</3":!0,"<\\3":!0,":^P":!0,":^p":!0,":^O":!0,":^3":!0}}},hooks:["alias","machine","index","id"]},yO={typeahead:function(e){const t=e.model.one.typeahead,n=e.docs;if(0===n.length||0===Object.keys(t).length)return;let r=n[n.length-1]||[],i=r[r.length-1];if(!i.post&&t.hasOwnProperty(i.normal)){let n=t[i.normal];i.implicit=n,i.machine=n,i.typeahead=!0,e.compute.preTagger&&e.last().unTag("*").compute(["lexicon","preTagger"])}}},vO=function(){const e=this.docs;if(0===e.length)return this;let t=e[e.length-1]||[],n=t[t.length-1];return!0===n.typeahead&&n.machine&&(n.text=n.machine,n.normal=n.machine),this},bO={safe:!0,min:3},wO={typeahead:function(e=[],t={}){let n=this.model();var r;t=Object.assign({},bO,t),r=e,"[object Object]"===Object.prototype.toString.call(r)&&(Object.assign(n.one.lexicon,e),e=Object.keys(e));let i=function(e,t,n){let r={},i=[],a=n.prefixes||{};return e.forEach((e=>{let s=(e=e.toLowerCase().trim()).length;t.max&&s>t.max&&(s=t.max);for(let o=t.min;o<s;o+=1){let s=e.substring(0,o);t.safe&&n.model.one.lexicon.hasOwnProperty(s)||(!0!==a.hasOwnProperty(s)&&!0!==r.hasOwnProperty(s)?r[s]=e:i.push(s))}})),r=Object.assign({},a,r),i.forEach((e=>{delete r[e]})),r}(e,t,this.world());return Object.keys(i).forEach((e=>{n.one.typeahead.hasOwnProperty(e)?delete n.one.typeahead[e]:n.one.typeahead[e]=i[e]})),this}},_O={model:{one:{typeahead:{}}},api:function(e){e.prototype.autoFill=vO},lib:wO,compute:yO,hooks:["typeahead"]};OT.extend(uI),OT.extend(Rx),OT.extend(ax),OT.extend(Gx),OT.extend(_C),OT.plugin(DI),OT.extend(gO),OT.extend(VI),OT.plugin(NT),OT.extend(YI),OT.extend(_O),OT.extend(KI),OT.extend(Kx);const kO=OT,AO={addendum:"addenda",corpus:"corpora",criterion:"criteria",curriculum:"curricula",genus:"genera",memorandum:"memoranda",opus:"opera",ovum:"ova",phenomenon:"phenomena",referendum:"referenda",alga:"algae",alumna:"alumnae",antenna:"antennae",formula:"formulae",larva:"larvae",nebula:"nebulae",vertebra:"vertebrae",analysis:"analyses",axis:"axes",diagnosis:"diagnoses",parenthesis:"parentheses",prognosis:"prognoses",synopsis:"synopses",thesis:"theses",neurosis:"neuroses",appendix:"appendices",index:"indices",matrix:"matrices",ox:"oxen",sex:"sexes",alumnus:"alumni",bacillus:"bacilli",cactus:"cacti",fungus:"fungi",hippopotamus:"hippopotami",libretto:"libretti",modulus:"moduli",nucleus:"nuclei",octopus:"octopi",radius:"radii",stimulus:"stimuli",syllabus:"syllabi",cookie:"cookies",calorie:"calories",auntie:"aunties",movie:"movies",pie:"pies",rookie:"rookies",tie:"ties",zombie:"zombies",leaf:"leaves",loaf:"loaves",thief:"thieves",foot:"feet",goose:"geese",tooth:"teeth",beau:"beaux",chateau:"chateaux",tableau:"tableaux",bus:"buses",gas:"gases",circus:"circuses",crisis:"crises",virus:"viruses",database:"databases",excuse:"excuses",abuse:"abuses",avocado:"avocados",barracks:"barracks",child:"children",clothes:"clothes",echo:"echoes",embargo:"embargoes",epoch:"epochs",deer:"deer",halo:"halos",man:"men",woman:"women",mosquito:"mosquitoes",mouse:"mice",person:"people",quiz:"quizzes",rodeo:"rodeos",shoe:"shoes",sombrero:"sombreros",stomach:"stomachs",tornado:"tornados",tuxedo:"tuxedos",volcano:"volcanoes"},PO={Comparative:"true¦bett1f0;arth0ew0in0;er",Superlative:"true¦earlier",PresentTense:"true¦bests,sounds",Condition:"true¦lest,unless",PastTense:"true¦began,came,d4had,kneel3l2m0sa4we1;ea0sg2;nt;eap0i0;ed;id",Participle:"true¦0:09;a06b01cZdXeat0fSgQhPoJprov0rHs7t6u4w1;ak0ithdra02o2r1;i02uY;k0v0;nd1pr04;ergoJoJ;ak0hHo3;e9h7lain,o6p5t4un3w1;o1um;rn;g,k;ol0reS;iQok0;ught,wn;ak0o1runk;ne,wn;en,wn;ewriNi1uJ;dd0s0;ut3ver1;do4se0t1;ak0h2;do2g1;roG;ne;ast0i7;iv0o1;ne,tt0;all0loBor1;bi3g2s1;ak0e0;iv0o9;dd0;ove,r1;a5eamt,iv0;hos0lu1;ng;e4i3lo2ui1;lt;wn;tt0;at0en,gun;r2w1;ak0ok0;is0;en",Gerund:"true¦accord0be0doin,go0result0stain0;ing",Expression:"true¦a0Yb0Uc0Sd0Oe0Mfarew0Lg0FhZjeez,lWmVnToOpLsJtIuFvEw7y0;a5e3i1u0;ck,p;k04p0;ee,pee;a0p,s;!h;!a,h,y;a5h2o1t0;af,f;rd up,w;atsoever,e1o0;a,ops;e,w;hoo,t;ery w06oi0L;gh,h0;! 0h,m;huh,oh;here nPsk,ut tut;h0ic;eesh,hh,it,oo;ff,h1l0ow,sst;ease,s,z;ew,ooey;h1i,mg,o0uch,w,y;h,o,ps;! 0h;hTmy go0wT;d,sh;a7evertheless,o0;!pe;eh,mm;ah,eh,m1ol0;!s;ao,fao;aCeBi9o2u0;h,mph,rra0zzC;h,y;l1o0;r6y9;la,y0;! 0;c1moCsmok0;es;ow;!p hip hoor0;ay;ck,e,llo,y;ha1i,lleluj0;ah;!ha;ah,ee4o1r0;eat scott,r;l1od0sh; grief,bye;ly;! whiz;ell;e0h,t cetera,ureka,ww,xcuse me;k,p;'oh,a0rat,uh;m0ng;mit,n0;!it;mon,o0;ngratulations,wabunga;a2oo1r0tw,ye;avo,r;!ya;h,m; 1h0ka,las,men,rgh,ye;!a,em,h,oy;la",Negative:"true¦n0;ever,o0;n,t",QuestionWord:"true¦how3wh0;at,e1ich,o0y;!m,se;n,re; come,'s",Reflexive:"true¦h4it5my5o1the0your2;ir1m1;ne3ur0;sel0;f,ves;er0im0;self",Plural:"true¦dick0gre0ones,records;ens","Unit|Noun":"true¦cEfDgChBinchAk9lb,m6newt5oz,p4qt,t1y0;ardEd;able1b0ea1sp;!l,sp;spo1;a,t,x;on9;!b,g,i1l,m,p0;h,s;!les;!b,elvin,g,m;!es;g,z;al,b;eet,oot,t;m,up0;!s",Value:"true¦a few",Imperative:"true¦bewa0come he0;re","Plural|Verb":"true¦leaves",Demonym:"true¦0:15;1:12;a0Vb0Oc0Dd0Ce08f07g04h02iYjVkTlPmLnIomHpEqatari,rCs7t5u4v3welAz2;am0Gimbabwe0;enezuel0ietnam0I;gAkrai1;aiwTex0hai,rinida0Ju2;ni0Prkmen;a5cotti4e3ingapoOlovak,oma0Spaniard,udRw2y0W;ede,iss;negal0Cr09;sh;mo0uT;o5us0Jw2;and0;a2eru0Fhilippi0Nortugu07uerto r0S;kist3lesti1na2raguay0;ma1;ani;ami00i2orweP;caragu0geri2;an,en;a3ex0Lo2;ngo0Drocc0;cedo1la2;gasy,y07;a4eb9i2;b2thua1;e0Cy0;o,t01;azakh,eny0o2uwaiI;re0;a2orda1;ma0Ap2;anO;celandic,nd4r2sraeli,ta01vo05;a2iB;ni0qi;i0oneU;aiAin2ondur0unO;di;amEe2hanai0reek,uatemal0;or2rm0;gi0;ilipino,ren8;cuadoVgyp4mira3ngli2sto1thiopi0urope0;shm0;ti;ti0;aPominUut3;a9h6o4roat3ub0ze2;ch;!i0;lom2ngol5;bi0;a6i2;le0n2;ese;lifor1m2na3;bo2eroo1;di0;angladeshi,el6o4r3ul2;gaE;azi9it;li2s1;vi0;aru2gi0;si0;fAl7merBngol0r5si0us2;sie,tr2;a2i0;li0;genti2me1;ne;ba1ge2;ri0;ni0;gh0r2;ic0;an",Organization:"true¦0:4Q;a3Tb3Bc2Od2He2Df27g1Zh1Ti1Pj1Nk1Ll1Gm12n0Po0Mp0Cqu0Br02sTtHuCv9w3xiaomi,y1;amaha,m1Bou1w1B;gov,tu3C;a4e2iki1orld trade organizati33;leaRped0O;lls fargo,st1;fie2Hinghou2R;l1rner br3U;gree3Jl street journ2Im1E;an halOeriz2Xisa,o1;dafo2Yl1;kswagMvo;b4kip,n2ps,s1;a tod3Aps;es3Mi1;lev3Fted natio3C;er,s; mobi32aco beRd bOe9gi frida3Lh3im horto3Amz,o1witt3D;shi49y1;ota,s r 05;e 1in lizzy;b3carpen3Jdaily ma3Dguess w2holli0s1w2;mashing pumpki35uprem0;ho;ea1lack eyed pe3Xyr0Q;ch bo3Dtl0;l2n3Qs1xas instrumen1U;co,la m1F;efoni0Kus;a8cientology,e5ieme2Ymirnoff,np,o3pice gir6quare0Ata1ubaru;rbuc1to34;ks;ny,undgard1;en;a2x pisto1;ls;g1Wrs;few2Minsbur31lesfor03msu2E;adiohead,b8e4o1yana3C;man empi1Xyal 1;b1dutch she4;ank;a3d 1max,vl20;bu1c2Ahot chili peppe2Ylobst2N;ll;ders dige1Ll madrid;c,s;ant3Aizn2Q;a8bs,e5fiz2Ihilip4i3r1;emier 1udenti1D;leagTo2K;nk floyd,zza hut; morrBs;psi2tro1uge0E;br33chi0Tn33;!co;lant2Un1yp16; 2ason27da2P;ld navy,pec,range juli2xf1;am;us;aAb9e6fl,h5i4o1sa,vid3wa;k2tre dame,vart1;is;ia;ke,ntendo,ss0QvZ;l,s;c,st1Otflix,w1; 1sweek;kids on the block,york0D;a,c;nd22s2t1;ional aca2Po,we0U;a,c02d0S;aDcdonalCe9i6lb,o3tv,y1;spa1;ce;b1Tnsanto,ody blu0t1;ley cr1or0T;ue;c2t1;as,subisO;helin,rosoft;dica2rcedes benz,talli1;ca;id,re;ds;cs milk,tt19z24;a3e1g,ittle caesa1P; ore09novo,x1;is,mark,us; 1bour party;pres0Dz boy;atv,fc,kk,lm,m1od1O;art;iffy lu0Roy divisi0Jpmorgan1sa;! cha09;bm,hop,k3n1tv;g,te1;l,rpol;ea;a5ewlett pack1Vi3o1sbc,yundai;me dep1n1P;ot;tac1zbollah;hi;lliburt08sbro;eneral 6hq,ithub,l5mb,o2reen d0Ou1;cci,ns n ros0;ldman sachs,o1;dye1g0H;ar;axo smith kli04encoW;electr0Nm1;oto0Z;a5bi,c barcelo4da,edex,i2leetwood m03o1rito l0G;rd,xcY;at,fa,nancial1restoZ; tim0;na;cebook,nnie mae;b0Asa,u3xxon1; m1m1;ob0J;!rosceptics;aiml0De5isney,o4u1;nkin donu2po0Zran dur1;an;ts;j,w jon0;a,f lepp12ll,peche mode,r spieg02stiny's chi1;ld;aJbc,hFiDloudflaCnn,o3r1;aigsli5eedence clearwater reviv1ossra09;al;c7inba6l4m1o0Est09;ca2p1;aq;st;dplSg1;ate;se;a c1o chanQ;ola;re;a,sco1tigroup;! systems;ev2i1;ck fil a,na daily;r1y;on;d2pital o1rls jr;ne;bury,ill1;ac;aEbc,eBf9l5mw,ni,o1p,rexiteeU;ei3mbardiIston 1;glo1pizza;be;ng;o2ue c1;roV;ckbuster video,omingda1;le; g1g1;oodriL;cht2e ge0rkshire hathaw1;ay;el;cardi,idu,nana republ3s1xt5y5;f,kin robbi1;ns;ic;bYcTdidSerosmith,iRlKmEnheuser busDol,ppleAr6s4u3v2y1;er;is,on;di,todesk;hland o1sociated E;il;b3g2m1;co;os;ys; compu1be0;te1;rs;ch;c,d,erican3t1;!r1;ak; ex1;pre1;ss; 5catel2ta1;ir;! lu1;ce1;nt;jazeera,qae1;da;g,rbnb;as;/dc,a3er,tivision1;! blizz1;ard;demy of scienc0;es;ba",Possessive:"true¦its,my,our0thy;!s","Noun|Verb":"true¦0:9W;1:AA;2:96;3:A3;4:9R;5:A2;6:9K;7:8N;8:7L;9:A8;A:93;B:8D;C:8X;a9Ob8Qc7Id6Re6Gf5Sg5Hh55i4Xj4Uk4Rl4Em40n3Vo3Sp2Squ2Rr21s0Jt02u00vVwGyFzD;ip,oD;ne,om;awn,e6Fie68;aOeMhJiHoErD;ap,e9Oink2;nd0rDuC;kDry,sh5Hth;!shop;ck,nDpe,re,sh;!d,g;e86iD;p,sD;k,p0t2;aDed,lco8W;r,th0;it,lk,rEsDt4ve,x;h,te;!ehou1ra9;aGen5FiFoD;iDmAte,w;ce,d;be,ew,sA;cuum,l4B;pDr7;da5gra6Elo6A;aReQhrPiOoMrGuEwiDy5Z;n,st;nDrn;e,n7O;aGeFiEoDu6;t,ub2;bu5ck4Jgg0m,p;at,k,nd;ck,de,in,nsDp,v7J;f0i8R;ll,ne,p,r4Yss,t94uD;ch,r;ck,de,e,le,me,p,re;e5Wow,u6;ar,e,ll,mp0st,xt;g,lDng2rg7Ps5x;k,ly;a0Sc0Ne0Kh0Fi0Dk0Cl0Am08n06o05pXquaBtKuFwD;ea88iD;ng,pe,t4;bGit,m,ppErD;fa3ge,pri1v2U;lDo6S;e6Py;!je8;aMeLiKoHrEuDy2;dy,ff,mb2;a85eEiDo5Pugg2;ke,ng;am,ss,t4;ckEop,p,rD;e,m;ing,pi2;ck,nk,t4;er,m,p;ck,ff,ge,in,ke,lEmp,nd,p2rDte,y;!e,t;k,l;aJeIiHlGoFrDur,y;ay,e56inDu3;g,k2;ns8Bt;a5Qit;ll,n,r87te;ed,ll;m,n,rk;b,uC;aDee1Tow;ke,p;a5Je4FiDo53;le,rk;eep,iDou4;ce,p,t;ateboa7Ii;de,gnDl2Vnk,p,ze;!al;aGeFiEoDuff2;ck,p,re,w;ft,p,v0;d,i3Ylt0;ck,de,pe,re,ve;aEed,nDrv1It;se,t2N;l,r4t;aGhedu2oBrD;aEeDibb2o3Z;en,w;pe,t4;le,n,r2M;cDfegua72il,mp2;k,rifi3;aZeHhy6LiGoEuD;b,in,le,n,s5X;a6ck,ll,oDpe,u5;f,t;de,ng,ot,p,s1W;aTcSdo,el,fQgPje8lOmMnLo17pJque6sFturn,vDwa6V;eDi27;al,r1;er74oFpe8tEuD;lt,me;!a55;l71rt;air,eaDly,o53;l,t;dezvo2Zt;aDedy;ke,rk;ea1i4G;a6Iist0r5N;act6Yer1Vo71uD;nd,se;a38o6F;ch,s6G;c1Dge,iEke,lly,nDp1Wt1W;ge,k,t;n,se;es6Biv0;a04e00hYiXlToNrEsy4uD;mp,n4rcha1sh;aKeIiHoDu4O;be,ceFdu3fi2grDje8mi1p,te6;amDe6W;!me;ed,ss;ce,de,nt;sDy;er6Cs;cti3i1;iHlFoEp,re,sDuCw0;e,i5Yt;l,p;iDl;ce,sh;nt,s5V;aEce,e32uD;g,mp,n7;ce,nDy;!t;ck,le,n17pe,tNvot;a1oD;ne,tograph;ak,eFnErDt;fu55mA;!c32;!l,r;ckJiInHrFsEtDu1y;ch,e9;s,te;k,tD;!y;!ic;nt,r,se;!a7;bje8ff0il,oErDutli3Qver4B;bAd0ie9;ze;a4ReFoDur1;d,tD;e,i3;ed,gle8tD;!work;aMeKiIoEuD;rd0;ck,d3Rld,nEp,uDve;nt,th;it5EkD;ey;lk,n4Brr5CsDx;s,ta2B;asuBn4UrDss;ge,it;il,nFp,rk3WsEtD;ch,t0;h,k,t0;da5n0oeuvB;aLeJiHoEuD;mp,st;aEbby,ck,g,oDve;k,t;d,n;cDe,ft,mAnIst;en1k;aDc0Pe4vK;ch,d,k,p,se;bFcEnd,p,t4uD;gh,n4;e,k;el,o2U;eEiDno4E;ck,d,ll,ss;el,y;aEo1OuD;i3mp;m,zz;mpJnEr46ssD;ue;c1Rdex,fluGha2k,se2HteDvoi3;nt,rD;e6fa3viD;ew;en3;a8le2A;aJeHiGoEuD;g,nt;l3Ano2Dok,pDr1u1;!e;ghli1Fke,nt,re,t;aDd7lp;d,t;ck,mGndFrEsh,tDu9;ch,e;bo3Xm,ne4Eve6;!le;!m0;aMear,ift,lKossJrFuD;arDe4Alp,n;antee,d;aFiEoDumb2;uCwth;ll,nd,p;de,sp;ip;aBoDue;ss,w;g,in,me,ng,s,te,ze;aZeWiRlNoJrFuD;ck,el,nDss,zz;c38d;aEoDy;st,wn;cDgme,me,nchi1;tuB;cFg,il,ld,rD;ce,e29mDwa31;!at;us;aFe0Vip,oDy;at,ck,od,wD;!er;g,ke,me,re,sh,vo1E;eGgFlEnDre,sh,t,x;an3i0Q;e,m,t0;ht,uB;ld;aEeDn3;d,l;r,tuB;ce,il,ll,rm,vo2W;cho,d7ffe8nMsKxFyeD;!baD;ll;cGerci1hFpDtra8;eriDo0W;en3me9;au6ibA;el,han7u1;caDtima5;pe;count0d,vy;a01eSiMoJrEuDye;b,el,mp,pli2X;aGeFiEoD;ne,p;ft,ll,nk,p,ve;am,ss;ft,g,in;cEd7ubt,wnloD;ad;k,u0E;ge6p,sFt4vD;e,iDor3;de;char7gui1h,liEpD;at4lay,u5;ke;al,bKcJfeIlGmaCposAsEtaD;il;e07iD;gn,re;ay,ega5iD;ght;at,ct;li04rea1;a5ut;b,ma7n3rDte;e,t;a0Eent0Dh06irc2l03oKrFuD;be,e,rDt;b,e,l,ve;aGeFoEuDy;sh;p,ss,wd;dAep;ck,ft,sh;at,de,in,lTmMnFordina5py,re,st,uDv0;gh,nDp2rt;s01t;ceHdu8fli8glomeIsFtDveN;a8rD;a6ol;e9tru8;ct;ntDrn;ra5;bHfoGmFpD;leDouCromi1;me9;aCe9it,u5;rt;at,iD;ne;lap1oD;r,ur;aEiDoud,ub;ck,p;im,w;aEeDip;at,ck,er;iGllen7nErD;ge,m,t;ge,nD;el;n,r;er,re;ke,ll,mp,noe,pGrXsFtEuDve;se,ti0I;alog,ch;h,t;!tuB;re;a03eZiXlToPrHuEyD;pa11;bb2ck2dgEff0mp,rDst,zz;den,n;et;anJeHiFoadEuD;i1sh;ca6;be,d7;ge;aDed;ch,k;ch,d;aFg,mb,nEoDrd0tt2x,ycott;k,st,t;d,e;rd,st;aFeCiDoYur;nk,tz;nd;me;as,d,ke,nd,opsy,tD;!ch,e;aFef,lt,nDt;d,efA;it;r,t;ck,il,lan3nIrFsEtt2;le;e,h;!gDk;aDe;in;!d,g,k;bu1c05dZge,iYlVnTppQrLsIttGucEwaD;rd;tiD;on;aDempt;ck;k,sD;i6ocia5;st;chFmD;!oD;ur;!iD;ve;eEroa4;ch;al;chDg0sw0;or;aEt0;er;rm;d,m,r;dreHvD;an3oD;ca5;te;ce;ss;cDe,he,t;eFoD;rd,u9;nt;nt,ss;se",Actor:"true¦0:7B;1:7G;2:6A;3:7F;4:7O;5:7K;a6Nb62c4Ud4Be41f3Sg3Bh30i2Uj2Qkin2Pl2Km26n1Zo1Sp0Vqu0Tr0JsQtJuHvEw8yo6;gi,ut6;h,ub0;aAe9i8o7r6;estl0it0;m2rk0;fe,nn0t2Bza2H;atherm2ld0;ge earn0it0nder0rri1;eter7i6oyF;ll5Qp,s3Z;an,ina2U;n6s0;c6Uder03;aoisea23e9herapi5iktok0o8r6ut1yco6S;a6endseLo43;d0mp,nscri0Bvel0;ddl0u1G;a0Qchn7en6na4st0;ag0;i3Oo0D;aiXcUeRhPiMki0mu26oJpGquaFtBu7wee6;p0theart;lt2per7r6;f0ge6Iviv1;h6inten0Ist5Ivis1;ero,um2;a8ep7r6;ang0eam0;bro2Nc2Ofa2Nmo2Nsi20;ff0tesm2;tt0;ec7ir2Do6;kesp59u0M;ia5Jt3;l7me6An,rcere6ul;r,ss;di0oi5;n7s6;sy,t0;g0n0;am2ephe1Iow6;girl,m2r2Q;cretInior cit3Fr6;gea4v6;a4it1;hol4Xi7reen6ulpt1;wr2C;e01on;l1nt;aEe9o8u6;l0nn6;er up,ingE;g40le mod3Zof0;a4Zc8fug2Ppo32searQv6;ere4Uolution6;ary;e6luYru22;ptio3T;bbi,dic5Vpp0;arter6e2Z;back;aYeWhSiRlOoKr8sycho7u6;nk,p31;logi5;aGeDiBo6;d9fess1g7ph47s6;pe2Ktitu51;en6ramm0;it1y;igy,uc0;est4Nme mini0Unce6s3E;!ss;a7si6;de4;ch0;ctiti39nk0P;dca0Oet,li6pula50rnst42;c2Itic6;al scie6i2;nti5;a6umb0;nn0y6;er,ma4Lwright;lgrim,one0;a8iloso7otogra7ra6ysi1V;se;ph0;ntom,rmaci5;r6ssi1T;form0s4O;i3El,nel3Yr8st1tr6wn;i6on;arWot;ent4Wi42tn0;ccupa4ffBp8r7ut6;ca5l0B;ac4Iganiz0ig2Fph2;er3t6;i1Jomet6;ri5;ic0spring;aBe9ie4Xo7u6;n,rser3J;b6mad,vi4V;le2Vo4D;i6mesis,phew;ce,ghb1;nny,rr3t1X;aEeDiAo7u6yst1Y;m8si16;der3gul,m7n6th0;arDk;!my;ni7s6;f02s0Jt0;on,st0;chan1Qnt1rcha4;gi9k0n8rtyr,t6y1;e,riar6;ch;ag0iac;ci2stra3I;a7e2Aieutena4o6;rd,s0v0;bor0d7ndlo6ss,urea3Fwy0ym2;rd;!y;!s28;e8o7u6;ggl0;gg0urna2U;st0;c3Hdol,llu3Ummigra4n6; l9c1Qfa4habi42nov3s7ve6;nt1stig3;pe0Nt6;a1Fig3ru0M;aw;airFeBistoAo8u6ygie1K;man6sba2H;!ita8;bo,st6usekN;age,e3P;ri2;ir,r6;m7o6;!ine;it;dress0sty2C;aLeIhostGirl26ladi3oCrand7u6;e5ru;c9daug0Jfa8m7pa6s2Y;!re4;a,o6;th0;hi1B;al7d6lf0;!de3A;ie,k6te26;eep0;!wr6;it0;isha,n6;i6tl04;us;mbl0rden0;aDella,iAo7r6;eela2Nie1P;e,re6ster pare4;be1Hm2r6st0;unn0;an2ZgZlmm17nanci0r6tt0;e6st la2H; marsh2OfigXm2;rm0th0;conoEdDlectriCm8n7x6;amin0cellency,i2A;emy,trepreneur,vironmenta1J;c8p6;er1loye6;e,r;ee;ci2;it1;mi5;aKeBi8ork,ri7u6we02;de,tche2H;ft0v0;ct3eti7plom2Hre6va;ct1;ci2ti2;aDcor3fencCi0InAput9s7tectLvel6;op0;ce1Ge6ign0;rt0;ee,y;iz6;en;em2;c1Ml0;d8nc0redev7ug6;ht0;il;!dy;a06e04fo,hXitizenWlToBr9u6;r3stomer6;! representat6;ive;e3it6;ic;lJmGnAord9rpor1Nu7w6;boy,ork0;n6ri0;ciTte1Q;in3;fidantAgressSs9t6;e0Kr6;ibut1o6;ll0;tab13ul1O;!e;edi2m6pos0rade;a0EeQissi6;on0;leag8on7um6;ni5;el;ue;e6own;an0r6;ic,k;!s;a9e7i6um;ld;erle6f;ad0;ir7nce6plFract0;ll1;m2wI;lebri6o;ty;dBptAr6shi0;e7pe6;nt0;r,t6;ak0;ain;et;aMeLiJlogg0oErBu6;dd0Fild0rgl9siness6;m2p7w6;om2;ers05;ar;i7o6;!k0th0;cklay0de,gadi0;hemi2oge8y6;!frie6;nd;ym2;an;cyc6sR;li5;atbox0ings;by,nk0r6;b0on7te6;nd0;!e07;c04dWge4nQpLrHsFtAu7yatull6;ah;nt7t6;h1oG;!ie;h8t6;e6orney;nda4;ie5le6;te;sis00tron6;aut,om0;chbis8isto7tis6;an,t;crU;hop;ost9p6;ari6rentiS;ti6;on;le;a9cest1im3nou8y6;bo6;dy;nc0;ly5rc6;hi5;mi8v6;entur0is1;er;ni7r6;al;str3;at1;or;counBquaintanArob9t6;ivi5or,re6;ss;st;at;ce;ta4;nt","Adj|Noun":"true¦0:16;a1Db17c0Ud0Re0Mf0Dg0Ah08i06ju05l02mWnUoSpNrIsBt7u4v1watershed;a1ision0Z;gabo4nilla,ria1;b0Vnt;ndergr1pstairs;adua14ou1;nd;a3e1oken,ri0;en,r1;min0rori13;boo,n;age,e5ilv0Flack,o3quat,ta2u1well;bordina0Xper5;b0Lndard;ciali0Yl1vereign;e,ve16;cret,n1ri0;ior;a4e2ou1ubbiL;nd,tiY;ar,bBl0Wnt0p1side11;resent0Vublican;ci0Qsh;a4eriodic0last0Zotenti0r1;emi2incip0o1;!fession0;er,um;rall4st,tie0U;ff1pposi0Hv0;ens0Oi0C;agg01ov1uts;el;a5e3iniatJo1;bi01der07r1;al,t0;di1tr0N;an,um;le,riG;attOi2u1;sh;ber0ght,qC;stice,veniT;de0mpressioYn1;cumbe0Edividu0no0Dsta0Eterim;alf,o1umdrum;bby,melF;en2old,ra1;ph0Bve;er0ious;a7e5i4l3u1;git03t1;ure;uid;ne;llow,m1;aFiL;ir,t,vo1;riOuriO;l3p00x1;c1ecutUpeV;ess;d1iK;er;ar2e1;mographUrivO;k,l2;hiGlassSo2rude,unn1;ing;m5n1operK;creCstitueOte2vertab1;le;mpor1nt;ary;ic,m2p1;anion,lex;er2u1;ni8;ci0;al;e5lank,o4r1;i2u1;te;ef;ttom,urgeois;st;cadem9d6l2ntarct9r1;ab,ct8;e3tern1;at1;ive;rt;oles1ult;ce1;nt;ic","Adj|Past":"true¦0:4Q;1:4C;2:4H;3:4E;a44b3Tc36d2Je29f20g1Wh1Si1Jj1Gkno1Fl1Am15n12o0Xp0Mqu0Kr08sLtEuAv9w4yellow0;a7ea6o4rinkl0;r4u3Y;n,ri0;k31th3;rp0sh0tZ;ari0e1O;n5p4s0;d1li1Rset;cov3derstood,i4;fi0t0;a8e3Rhr7i6ouTr4urn0wi4C;a4imm0ou2G;ck0in0pp0;ed,r0;eat2Qi37;m0nn0r4;get0ni2T;aOcKeIhGimFm0Hoak0pDt7u4;bsid3Ogge44s4;pe4ta2Y;ct0nd0;a8e7i2Eok0r5u4;ff0mp0nn0;ength2Hip4;ed,p0;am0reotyp0;in0t0;eci4ik0oH;al3Efi0;pRul1;a4ock0ut;d0r0;a4c1Jle2t31;l0s3Ut0;a6or5r4;at4e25;ch0;r0tt3;t4ut0;is2Mur1;aEe5o4;tt0;cAdJf2Bg9je2l8m0Knew0p7qu6s4;eTpe2t4;or0ri2;e3Dir0;e1lac0;at0e2Q;i0Rul1;eiv0o4ycl0;mme2Lrd0v3;in0lli0ti2A;a4ot0;li28;aCer30iBlAo9r5u4;mp0zzl0;e6i2Oo4;ce2Fd4lo1Anou30pos0te2v0;uc0;fe1CocCp0Iss0;i2Kli1L;ann0e2CuS;ck0erc0ss0;ck0i2Hr4st0;allLk0;bse7c6pp13rgan2Dver4;lo4whelm0;ok0;cupi0;rv0;aJe5o4;t0uri1A;ed0gle2;a6e5ix0o4ut0ys1N;di1Nt15u26;as0Clt0;n4rk0;ag0ufact0A;e6i5o4;ad0ck0st,v0;cens0m04st0;ft,v4;el0;tt0wn;a5o15u4;dg0s1B;gg0;llumSmpAn4sol1;br0cre1Ldebt0f8jZspir0t5v4;it0olv0;e4ox0Y;gr1n4re23;d0si15;e2l1o1Wuri1;li0o01r4;ov0;a6e1o4um03;ok0r4;ri0Z;mm3rm0;i6r5u4;a1Bid0;a0Ui0Rown;ft0;aAe9i8l6oc0Ir4;a4i0oz0Y;ctHg19m0;avo0Ju4;st3;ni08tt0x0;ar0;d0il0sc4;in1;dCl1mBn9quipp0s8x4;agger1c6p4te0T;a0Se4os0;ct0rie1D;it0;cap0tabliZ;cha0XgFha1As4;ur0;a0Zbarra0N;i0Buc1;aMeDi5r4;a01i0;gni08miniSre2s4;a9c6grun0Ft4;o4re0Hu17;rt0;iplWou4;nt0r4;ag0;bl0;cBdRf9l8p7ra6t5v4;elop0ot0;ail0ermQ;ng0;re07;ay0ight0;e4in0o0M;rr0;ay0enTor1;m5t0z4;ed,zl0;ag0p4;en0;aPeLhIlHo9r6u4;lt4r0stom03;iv1;a5owd0u4;sh0;ck0mp0;d0loAm7n4ok0v3;centr1f5s4troC;id3olid1;us0;b5pl4;ic1;in0;r0ur0;assi9os0utt3;ar5i4;ll0;g0m0;lebr1n6r4;ti4;fi0;tralJ;g0lcul1;aDewild3iCl9o7r5urn4;ed,t;ok4uis0;en;il0r0t4und;tl0;e5i4;nd0;ss0;as0;ffl0k0laMs0tt3;bPcNdKfIg0lFmaz0nDppBrm0ss9u5wa4;rd0;g5thor4;iz0;me4;nt0;o6u4;m0r0;li0re4;ci1;im1ticip1;at0;a5leg0t3;er0;rm0;fe2;ct0;ju5o7va4;nc0;st0;ce4knowledg0;pt0;and5so4;rb0;on0;ed",Singular:"true¦0:5J;1:5H;2:4W;3:4S;4:52;5:57;6:5L;7:56;8:5B;a52b4Lc3Nd35e2Xf2Og2Jh28in24j23k22l1Um1Ln1Ho1Bp0Rqu0Qr0FsZtMuHvCw9x r58yo yo;a9ha3Po3Q;f3i4Rt0Gy9;! arou39;arCeAideo ga2Qo9;cabu4Jl5C;gOr9t;di4Zt1Y;iety,ni4P;nBp30rAs 9;do43s5E;bani1in0;coordinat3Ader9;estima1to24we41; rex,aKeJhHiFoErBuAv9;! show;m2On2rntLto1D;agedy,ib9o4E;e,u9;n0ta46;ni1p2rq3L;c,er,m9;etF;ing9ree26;!y;am,mp3F;ct2le6x return;aNcMeKhor4QiJkHoGpin off,tDuBy9;ll9ner7st4T;ab2X;b9i1n28per bowl,rro1X;st3Ltot0;atAipe2Go1Lrate7udent9;! lo0I;i39u1;ft ser4Lmeo1I;elet5i9;ll,r3V;b38gn2Tte;ab2Jc9min3B;t,urity gua2N;e6ho2Y;bbatic0la3Jndwi0Qpi5;av5eDhetor2iAo9;de6om,w;tAv9;erb2C;e,u0;bDcBf9publ2r10spi1;er9orm3;e6r0;i9ord label;p2Ht0;a1u46;estion mark,ot2F;aPeMhoLiIlGoErAu9yram1F;ddi3HpErpo1Js3J;eBo9;bl3Zs9;pe3Jta1;dic1Rmi1Fp1Qroga8ss relea1F;p9rt0;py;a9ebisci1;q2Dte;cn2eAg9;!gy;!r;ne call,tocoK;anut,dAr9t0yo1;cen3Jsp3K;al,est0;nop4rAt9;e,hog5;adi11i2V;atme0bj3FcBpia1rde0thers,utspok5ve9wn3;n,r9;ti0Pview;cuAe9;an;pi3;arBitAot9umb3;a2Fhi2R;e,ra1;cot2ra8;aFeCiAo9ur0;nopo4p18rni2Nsq1Rti36uld;c,li11n0As9tt5;chief,si34;dAnu,t9;al,i3;al,ic;gna1mm0nd15rsupi0te9yf4;ri0;aDegCiBu9;ddi1n9;ch;me,p09; Be0M;bor14y9; 9er;up;eyno1itt5;el4ourn0;cBdices,itia8ni25sAtel0Lvert9;eb1J;e28titu1;en8i2T;aIeEighDoAu9;man right,s22;me9rmoFsp1Ftb0K;! r9;un; scho0YriY;a9i1N;d9v5; start,pho9;ne;ndful,sh brown,v5ze;aBelat0Ilaci3r9ul4yp1S;an9enadi3id;a1Cd slam,ny;df4r9;l2ni1I;aGeti1HiFlu1oCrAun9;er0;ee market,i9onti3;ga1;l4ur9;so9;me;ePref4;br2mi4;conoFffi7gg,lecto0Rmbas1EnCpidem2s1Zth2venBxAyel9;id;ampZempl0Nte6;i19t;er7terp9;ri9;se;my;eLiEoBr9ump tru0U;agonf4i9;er,ve thru;cAg7i4or,ssi3wn9;side;to0EumenE;aEgniDnn3sAvide9;nd;conte6incen8p9tri11;osi9;ti0C;ta0H;le0X;athBcAf9ni0terre6;ault 05err0;al,im0;!b9;ed;aWeThMiLlJoDr9;edit caBuc9;ib9;le;rd;efficDke,lCmmuniqLnsApi3rr0t0Xus9yo1;in;erv9uI;ato02;ic,lQ;ie6;er7i9oth;e6n2;ty,vil wM;aDeqCick5ocoBr9;istmas car9ysanthemum;ol;la1;ue;ndeli3racteri9;st2;iAllEr9;e0tifica1;liZ;hi3nFpErCt9ucus;erpi9hedr0;ll9;ar;!bohyd9ri3;ra1;it0;aAe,nib0t9;on;l,ry;aMeLiop2leJoHrDu9;nny,r9tterf4;g9i0;la9;ry;eakAi9;ck;fa9throB;st;dy,ro9wl;ugh;mi9;sh;an,l4;nkiArri3;er;ng;cSdMlInFppeti1rDsBtt2utop9;sy;ic;ce6pe9;ct;r9sen0;ay;ecAoma4tiA;ly;do1;i5l9;er7y;gy;en; hominDjAvan9;tage;ec8;ti9;ve;em;cCeAqui9;tt0;ta1;te;iAru0;al;de6;nt","Person|Noun":"true¦a0Eb07c03dWeUfQgOhLjHkiGlFmCnBolive,p7r4s3trini06v1wa0;ng,rd,tts;an,enus,iol0;a,et;ky,onPumm09;ay,e1o0uby;bin,d,se;ed,x;a2e1o0;l,tt04;aLnJ;dYge,tR;at,orm;a0eloW;t0x,ya;!s;a9eo,iH;ng,tP;a2e1o0;lGy;an,w3;de,smi4y;a0erb,iOolBuntR;ll,z0;el;ail,e0iLuy;ne;a1ern,i0lo;elds,nn;ith,n0;ny;a0dEmir,ula,ve;rl;a4e3i1j,ol0;ly;ck,x0;ie;an,ja;i0wn;sy;am,h0liff,rystal;a0in,ristian;mbers,ri0;ty;a4e3i2o,r0ud;an0ook;dy;ll;nedict,rg;k0nks;er;l0rt;fredo,ma","Actor|Verb":"true¦aCb8c5doctor,engineAfool,g3host,judge,m2nerd,p1recruit,scout,ushAvolunteAwi0;mp,tneA;arent,ilot;an,ime;eek,oof,r0uide;adu8oom;ha1o0;ach,nscript,ok;mpion,uffeur;o2u0;lly,tch0;er;ss;ddi1ffili0rchite1;ate;ct",MaleName:"true¦0:H6;1:FZ;2:DS;3:GQ;4:CZ;5:FV;6:GM;7:FP;8:GW;9:ET;A:C2;B:GD;aF8bE1cCQdBMeASfA1g8Yh88i7Uj6Sk6Bl5Mm48n3So3Ip33qu31r26s1Et0Ru0Ov0CwTxSyHzC;aCor0;cChC1karia,nAT;!hDkC;!aF6;!ar7CeF5;aJevgenBSoEuC;en,rFVsCu3FvEF;if,uf;nDs6OusC;ouf,s6N;aCg;s,tC;an,h0;hli,nCrosE1ss09;is,nC;!iBU;avi2ho5;aPeNiDoCyaEL;jcieBJlfgang,odrFutR;lFnC;f8TsC;lCt1;ow;bGey,frEhe4QlC;aE5iCy;am,e,s;ed8iC;d,ed;eAur;i,ndeD2rn2sC;!l9t1;lDyC;l1ne;lDtC;!er;aCHy;aKernDAiFladDoC;jteB0lodymyr;!iC;mFQsDB;cFha0ktBZnceDrgCOvC;a0ek;!nC;t,zo;!e4StBV;lCnC7sily;!entC;in9J;ghE2lCm70nax,ri,sm0;riCyss87;ch,k;aWeRhNiLoGrEuDyC;!l2roEDs1;n6r6E;avD0eCist0oy,um0;ntCRvBKy;bFdAWmCny;!asDmCoharu;aFFie,y;!z;iA6y;mCt4;!my,othy;adEeoDia0SomC;!as;!dor91;!de4;dFrC;enBKrC;anBJeCy;ll,nBI;!dy;dgh,ha,iCnn2req,tsu5V;cDAka;aYcotWeThPiMlobod0oKpenc2tEurDvenAEyCzym1;ed,lvest2;aj,e9V;anFeDuC;!aA;fan17phEQvCwaA;e77ie;!islaCl9;v,w;lom1rBuC;leymaDHta;dDgmu9UlCm1yabonga;as,v8B;!dhart8Yn9;aEeClo75;lCrm0;d1t1;h9Jne,qu1Jun,wn,yne;aDbastiEDk2Yl5Mpp,rgCth,ymoCU;e1Dio;m4n;!tC;!ie,y;eDPlFmEnCq67tosCMul;dCj2UtiA5;e01ro;!iATkeB6mC4u5;!ik,vato9K;aZeUheC8iRoGuDyC;an,ou;b99dDf4peAssC;!elEG;ol00y;an,bLc7MdJel,geIh0lHmGnEry,sDyC;!ce;ar7Ocoe,s;!aCnBU;ld,n;an,eo;a7Ef;l7Jr;e3Eg2n9olfo,riC;go;bBNeDH;cCl9;ar87c86h54kCo;!ey,ie,y;cFeA3gDid,ubByCza;an8Ln06;g85iC;naC6s;ep;ch8Kfa5hHin2je8HlGmFndEoHpha5sDul,wi36yC;an,mo8O;h9Im4;alDSol3O;iD0on;f,ph;ul;e9CinC;cy,t1;aOeLhilJiFrCyoG;aDeC;m,st1;ka85v2O;eDoC;tr;r8GtC;er,ro;!ipCl6H;!p6U;dCLrcy,tC;ar,e9JrC;!o7;b9Udra8So9UscAHtri62ulCv8I;!ie,o7;ctav6Ji2lImHndrBRrGsDtCum6wB;is,to;aDc6k6m0vCwaBE;al79;ma;i,vR;ar,er;aDeksandr,ivC;er,i2;f,v;aNeLguyBiFoCu3O;aDel,j4l0ma0rC;beAm0;h,m;cFels,g5i9EkDlC;es,s;!au,h96l78olaC;!i,y;hCkCol76;ol75;al,d,il,ls1vC;ilAF;hom,tC;e,hC;anCy;!a5i5;aYeViLoGuDyC;l4Nr1;hamDr84staC;fa,p6E;ed,mG;di10e,hamEis4JntDritz,sCussa;es,he;e,y;ad,ed,mC;ad,ed;cGgu5hai,kFlEnDtchC;!e8O;a9Pik;house,o7t1;ae73eC3ha8Iolaj;ah,hDkC;!ey,y;aDeC;al,l;el,l;hDlv3rC;le,ri8Ev4T;di,met;ay0c00gn4hWjd,ks2NlTmadZnSrKsXtDuric7VxC;imilBKwe8B;eHhEi69tCus,y69;!eo,hCia7;ew,i67;eDiC;as,eu,s;us,w;j,o;cHiGkFlEqu8Qsha83tCv3;iCy;!m,n;in,on;el,o7us;a6Yo7us;!elCin,o7us;!l8o;frAEi5Zny,u5;achDcoCik;lm;ai,y;amDdi,e5VmC;oud;adCm6W;ou;aulCi9P;ay;aWeOiMloyd,oJuDyC;le,nd1;cFdEiDkCth2uk;a7e;gi,s,z;ov7Cv6Hw6H;!as,iC;a6Een;g0nn52renDuCvA4we7D;!iS;!zo;am,n4oC;n5r;a9Yevi,la5KnHoFst2thaEvC;eCi;nte;bo;nCpo8V;!a82el,id;!nC;aAy;mEnd1rDsz73urenCwr6K;ce,t;ry,s;ar,beAont;aOeIhalHiFla4onr63rDu5SylC;e,s;istCzysztof;i0oph2;er0ngsl9p,rC;ilA9k,ollos;ed,id;en0iGnDrmCv4Z;it;!dDnCt1;e2Ny;ri4Z;r,th;cp2j4mEna8BrDsp6them,uC;ri;im,l;al,il;a03eXiVoFuC;an,lCst3;en,iC;an,en,o,us;aQeOhKkub4AnIrGsDzC;ef;eDhCi9Wue;!ua;!f,ph;dCge;i,on;!aCny;h,s,th6J;anDnC;!ath6Hie,n72;!nC;!es;!l,sCy;ph;o,qu3;an,mC;!i,m6V;d,ffFns,rCs4;a7JemDmai7QoCry;me,ni1H;i9Dy;!e73rC;ey,y;cKdBkImHrEsDvi2yC;dBs1;on,p2;ed,oDrCv67;e6Qod;d,s61;al,es5Wis1;a,e,oCub;b,v;ob,qu13;aTbNchiMgLke53lija,nuKonut,rIsEtCv0;ai,suC;ki;aDha0i8XmaCsac;el,il;ac,iaC;h,s;a,vinCw3;!g;k,nngu6X;nac1Xor;ka;ai,rahC;im;aReLoIuCyd6;beAgGmFsC;eyDsC;a3e3;in,n;ber5W;h,o;m2raDsse3wC;a5Pie;c49t1K;a0Qct3XiGnDrC;beAman08;dr7VrC;iCy2N;!k,q1R;n0Tt3S;bKlJmza,nIo,rEsDyC;a5KdB;an,s0;lEo67r2IuCv9;hi5Hki,tC;a,o;an,ey;k,s;!im;ib;a08e00iUlenToQrMuCyorgy;iHnFsC;!taC;f,vC;!e,o;n6tC;er,h2;do,lC;herDlC;auCerQ;me;aEegCov2;!g,orC;!io,y;dy,h7C;dfr9nza3XrDttfC;ri6C;an,d47;!n;acoGlEno,oCuseppe;rgiCvan6O;!o,s;be6Ies,lC;es;mo;oFrC;aDha4HrC;it,y;ld,rd8;ffErgC;!e7iCy;!os;!r9;bElBrCv3;eCla1Nr4Hth,y;th;e,rC;e3YielC;!i4;aXeSiQlOorrest,rCyod2E;aHedFiC;edDtC;s,z;ri18;!d42eri11riC;ck,k;nCs2;cEkC;ie,lC;in,yn;esLisC;!co,z3M;etch2oC;ri0yd;d5lConn;ip;deriFliEng,rC;dinaCg4nan0B;nd8;pe,x;co;bCdi,hd;iEriC;ce,zC;io;an,en,o;benez2dZfrYit0lTmMnJo3rFsteb0th0ugenEvCymBzra;an,eCge4D;ns,re3K;!e;gi,iDnCrol,v3w3;est8ie,st;cCk;!h,k;o0DriCzo;co,qC;ue;aHerGiDmC;aGe3A;lCrh0;!iC;a10o,s;s1y;nu5;beAd1iEliDm2t1viCwood;n,s;ot28s;!as,j5Hot,sC;ha;a3en;!dGg6mFoDua2QwC;a2Pin;arC;do;oZuZ;ie;a04eTiOmitrNoFrag0uEwDylC;an,l0;ay3Hig4D;a3Gdl9nc0st3;minFnDri0ugCvydGy2S;!lF;!a36nCov0;e1Eie,y;go,iDykC;as;cCk;!k;i,y;armuFetDll1mitri7neCon,rk;sh;er,m6riC;ch;id;andLepak,j0lbeAmetri4nIon,rGsEvDwCxt2;ay30ey;en,in;hawn,moC;nd;ek,riC;ck;is,nC;is,y;rt;re;an,le,mKnIrEvC;e,iC;!d;en,iEne0PrCyl;eCin,yl;l45n;n,o,us;!iCny;el,lo;iCon;an,en,on;a0Fe0Ch03iar0lRoJrFuDyrC;il,us;rtC;!is;aEistC;iaCob12;no;ig;dy,lInErC;ey,neliCy;s,us;nEor,rDstaC;nt3;ad;or;by,e,in,l3t1;aHeEiCyde;fCnt,ve;fo0Xt1;menDt4;us;s,t;rFuDyC;!t1;dCs;e,io;enC;ce;aHeGrisC;!toC;phCs;!eC;!r;st2t;d,rCs;b5leC;s,y;cDdrCs6;ic;il;lHmFrC;ey,lDroCy;ll;!o7t1;er1iC;lo;!eb,v3;a09eZiVjorn,laUoSrEuCyr1;ddy,rtKst2;er;aKeFiEuDyC;an,ce,on;ce,no;an,ce;nDtC;!t;dDtC;!on;an,on;dFnC;dDisC;lav;en,on;!foOl9y;bby,gd0rCyd;is;i0Lke;bElDshC;al;al,lL;ek;nIrCshoi;at,nEtC;!raC;m,nd;aDhaCie;rd;rd8;!iDjam3nCs1;ie,y;to;kaMlazs,nHrC;n9rDtC;!holomew;eCy;tt;ey;dCeD;ar,iC;le;ar1Nb1Dd16fon15gust3hm12i0Zja0Yl0Bm07nTputsiSrGsaFugustEveDyCziz;a0kh0;ry;o,us;hi;aMchiKiJjun,mHnEon,tCy0;em,hCie,ur8;ur;aDoC;!ld;ud,v;aCin;an,nd8;!el,ki;baCe;ld;ta;aq;aMdHgel8tCw6;hoFoC;iDnC;!i8y;ne;ny;er7rCy;eDzC;ej;!as,i,j,s,w;!s;s,tolC;iCy;!y;ar,iEmaCos;nu5r;el;ne,r,t;aVbSdBeJfHiGl01onFphonsEt1vC;aPin;on;e,o;so,zo;!sR;!onZrC;ed;c,jaHksFssaHxC;!andC;er,rC;e,os,u;andCei;ar,er,r;ndC;ro;en;eDrecC;ht;rt8;dd3in,n,sC;taC;ir;ni;dDm6;ar;an,en;ad,eC;d,t;in;so;aGi,olErDvC;ik;ian8;f8ph;!o;mCn;!a;dGeFraDuC;!bakr,lfazl;hCm;am;!l;allFel,oulaye,ulC;!lDrahm0;an;ah,o;ah;av,on",Uncountable:"true¦0:2E;1:2L;2:33;a2Ub2Lc29d22e1Rf1Ng1Eh16i11j0Yk0Wl0Rm0Hn0Do0Cp03rZsLt9uran2Jv7w3you gu0E;a5his17i4oo3;d,l;ldlife,ne;rm8t1;apor,ernacul29i3;neg28ol1Otae;eDhBiAo8r4un3yranny;a,gst1B;aff2Oea1Ko4ue nor3;th;o08u3;bleshoot2Ose1Tt;night,othpas1Vwn3;foEsfoE;me off,n;er3und1;e,mod2S;a,nnis;aDcCeBhAi9ki8o7p6t4u3weepstak0;g1Unshi2Hshi;ati08e3;am,el;ace2Keci0;ap,cc1meth2C;n,ttl0;lk;eep,ingl0or1C;lf,na1Gri0;ene1Kisso1C;d0Wfe2l4nd,t3;i0Iurn;m1Ut;abi0e4ic3;e,ke15;c3i01laxa11search;ogni10rea10;a9e8hys7luto,o5re3ut2;amble,mis0s3ten20;en1Zs0L;l3rk;i28l0EyH; 16i28;a24tr0F;nt3ti0M;i0s;bstetri24vercrowd1Qxyg09;a5e4owada3utella;ys;ptu1Ows;il poliZtional securi2;aAe8o5u3;m3s1H;ps;n3o1K;ey,o3;gamy;a3cha0Elancholy,rchandi1Htallurgy;sl0t;chine3g1Aj1Hrs,thema1Q; learn1Cry;aught1e6i5ogi4u3;ck,g12;c,s1M;ce,ghtn18nguis1LteratWv1;ath1isVss;ara0EindergartPn3;icke0Aowled0Y;e3upit1;a3llyfiGwel0G;ns;ce,gnor6mp5n3;forma00ter3;net,sta07;atiSort3rov;an18;a7e6isto09o3ung1;ckey,mework,ne4o3rseradi8spitali2use arrest;ky;s2y;adquarteXre;ir,libut,ppiHs3;hi3te;sh;ene8l6o5r3um,ymnas11;a3eZ;niUss;lf,re;ut3yce0F;en; 3ti0W;edit0Hpo3;ol;aNicFlour,o4urnit3;ure;od,rgive3uri1wl;ness;arCcono0LducaBlectr9n7quip8thi0Pvery6x3;ist4per3;ti0B;en0J;body,o08th07;joy3tertain3;ment;ici2o3;ni0H;tiS;nings,th;emi02i6o4raugh3ynas2;ts;pe,wnstai3;rs;abet0ce,s3;honZrepu3;te;aDelciChAivi07l8o3urrency;al,ld w6mmenta5n3ral,ttIuscoB;fusiHt 3;ed;ry;ar;assi01oth0;es;aos,e3;eMwK;us;d,rO;a8i6lood,owlHread5u3;ntGtt1;er;!th;lliarJs3;on;g3ss;ga3;ge;cKdviJeroGirFmBn6ppeal court,r4spi3thleL;rin;ithmet3sen3;ic;i6y3;o4th3;ing;ne;se;en5n3;es2;ty;ds;craft;bi8d3nau7;yna3;mi6;ce;id,ous3;ti3;cs",Infinitive:"true¦0:9G;1:9T;2:AD;3:90;4:9Z;5:84;6:AH;7:A9;8:92;9:A0;A:AG;B:AI;C:9V;D:8R;E:8O;F:97;G:6H;H:7D;a94b8Hc7Jd68e4Zf4Mg4Gh4Ai3Qj3Nk3Kl3Bm34nou48o2Vp2Equ2Dr1Es0CtZuTvRwI;aOeNiLors5rI;eJiI;ng,te;ak,st3;d5e8TthI;draw,er;a2d,ep;i2ke,nIrn;d1t;aIie;liADniAry;nJpI;ho8Llift;cov1dJear8Hfound8DlIplug,rav82tie,ve94;eaAo3X;erIo;cut,go,staAFvalA3w2G;aSeQhNoMrIu73;aIe72;ffi3Smp3nsI;aBfo7CpI;i8oD;pp3ugh5;aJiJrIwaD;eat5i2;nk;aImA0;ch,se;ck3ilor,keImp1r8L;! paD;a0Ic0He0Fh0Bi0Al08mugg3n07o05p02qu01tUuLwI;aJeeIim;p,t5;ll7Wy;bNccMffLggeCmmKppJrI;mouFpa6Zvi2;o0re6Y;ari0on;er,i4;e7Numb;li9KmJsiIveD;de,st;er9it;aMe8MiKrI;ang3eIi2;ng27w;fIng;f5le;b,gg1rI;t3ve;a4AiA;a4UeJit,l7DoI;il,of;ak,nd;lIot7Kw;icEve;atGeak,i0O;aIi6;m,y;ft,ng,t;aKi6CoJriIun;nk,v6Q;ot,rt5;ke,rp5tt1;eIll,nd,que8Gv1w;!k,m;aven9ul8W;dd5tis1Iy;a0FeKiJoI;am,t,ut;d,p5;a0Ab08c06d05f01group,hea00iZjoi4lXmWnVpTq3MsOtMup,vI;amp,eJiIo3B;sEve;l,rI;e,t;i8rI;ie2ofE;eLiKpo8PtIurfa4;o24rI;aHiBuctu8;de,gn,st;mb3nt;el,hra0lIreseF;a4e71;d1ew,o07;aHe3Fo2;a7eFiIo6Jy;e2nq41ve;mbur0nf38;r0t;inKleBocus,rJuI;el,rbiA;aBeA;an4e;aBu4;ei2k8Bla43oIyc3;gni39nci3up,v1;oot,uI;ff;ct,d,liIp;se,ze;tt3viA;aAenGit,o7;aWerUinpoiFlumm1LoTrLuI;b47ke,niArIt;poDsuI;aFe;eMoI;cKd,fe4XhibEmo7noJpo0sp1tru6vI;e,i6o5L;un4;la3Nu8;aGclu6dJf1occupy,sup0JvI;a6BeF;etermi4TiB;aGllu7rtr5Ksse4Q;cei2fo4NiAmea7plex,sIva6;eve8iCua6;mp1rItrol,ve;a6It6E;bOccuNmEpMutLverIwe;l07sJtu6Yu0wI;helm;ee,h1F;gr5Cnu2Cpa4;era7i4Ipo0;py,r;ey,seItaH;r2ss;aMe0ViJoIultiply;leCu6Pw;micJnIspla4;ce,g3us;!k;iIke,na9;m,ntaH;aPeLiIo0u3N;ke,ng1quIv5;eIi6S;fy;aKnIss5;d,gI;th5;rn,ve;ng2Gu1N;eep,idnJnI;e4Cow;ap;oHuI;gg3xtaI;po0;gno8mVnIrk;cTdRfQgeChPitia7ju8q1CsNtKun6EvI;a6eIo11;nt,rt,st;erJimi6BoxiPrI;odu4u6;aBn,pr03ru6C;iCpi8tIu8;all,il,ruB;abEibE;eCo3Eu0;iIul9;ca7;i7lu6;b5Xmer0pI;aLer4Uin9ly,oJrI;e3Ais6Bo2;rt,se,veI;riA;le,rt;aLeKiIoiCuD;de,jaInd1;ck;ar,iT;mp1ng,pp5raIve;ng5Mss;ath1et,iMle27oLrI;aJeIow;et;b,pp3ze;!ve5A;gg3ve;aTer45i5RlSorMrJuI;lf4Cndrai0r48;eJiIolic;ght5;e0Qsh5;b3XeLfeEgJsI;a3Dee;eIi2;!t;clo0go,shIwa4Z;ad3F;att1ee,i36;lt1st5;a0OdEl0Mm0FnXquip,rWsVtGvTxI;aRcPeDhOiNpJtIu6;ing0Yol;eKi8lIo0un9;aHoI;it,re;ct,di7l;st,t;a3oDu3B;e30lI;a10u6;lt,mi28;alua7oI;ke,l2;chew,pou0tab19;a0u4U;aYcVdTfSgQhan4joy,lPqOrNsuMtKvI;e0YisI;a9i50;er,i4rI;aHenGuC;e,re;iGol0F;ui8;ar9iC;a9eIra2ulf;nd1;or4;ang1oIu8;r0w;irc3lo0ou0ErJuI;mb1;oaGy4D;b3ct;bKer9pI;hasiIow1;ze;aKody,rI;a4oiI;d1l;lm,rk;ap0eBuI;ci40de;rIt;ma0Rn;a0Re04iKo,rIwind3;aw,ed9oI;wn;agno0e,ff1g,mi2Kne,sLvI;eIul9;rIst;ge,t;aWbVcQlod9mant3pNru3TsMtI;iIoDu37;lJngI;uiA;!l;ol2ua6;eJlIo0ro2;a4ea0;n0r0;a2Xe36lKoIu0S;uIv1;ra9;aIo0;im;a3Kur0;b3rm;af5b01cVduBep5fUliTmQnOpMrLsiCtaGvI;eIol2;lop;ch;a20i2;aDiBloIoD;re,y;oIy;te,un4;eJoI;liA;an;mEv1;a4i0Ao06raud,y;ei2iMla8oKrI;ee,yI;!pt;de,mIup3;missi34po0;de,ma7ph1;aJrief,uI;g,nk;rk;mp5rk5uF;a0Dea0h0Ai09l08oKrIurta1G;a2ea7ipp3uI;mb3;ales4e04habEinci6ll03m00nIrro6;cXdUfQju8no7qu1sLtKvI;eIin4;ne,r9y;aHin2Bribu7;er2iLoli2Epi8tJuI;lt,me;itu7raH;in;d1st;eKiJoIroFu0;rm;de,gu8rm;ss;eJoI;ne;mn,n0;eIlu6ur;al,i2;buCe,men4pI;eIi3ly;l,te;eBi6u6;r4xiC;ean0iT;rcumveFte;eJirp,oI;o0p;riAw;ncIre5t1ulk;el;a02eSi6lQoPrKuI;iXrIy;st,y;aLeaKiJoad5;en;ng;stfeLtX;ke;il,l11mba0WrrMth1;eIow;ed;!coQfrie1LgPhMliLqueaKstJtrIwild1;ay;ow;th;e2tt3;a2eJoI;ld;ad;!in,ui3;me;bysEckfi8ff3tI;he;b15c0Rd0Iff0Ggree,l0Cm09n03ppZrXsQttOuMvJwaE;it;eDoI;id;rt;gIto0X;meF;aIeCraB;ch,in;pi8sJtoI;niA;aKeIi04u8;mb3rt,ss;le;il;re;g0Hi0ou0rI;an9i2;eaKly,oiFrI;ai0o2;nt;r,se;aMi0GnJtI;icipa7;eJoIul;un4y;al;ly0;aJu0;se;lga08ze;iKlI;e9oIu6;t,w;gn;ix,oI;rd;a03jNmiKoJsoI;rb;pt,rn;niIt;st1;er;ouJuC;st;rn;cLhie2knowled9quiItiva7;es4re;ce;ge;eQliOoKrJusI;e,tom;ue;mIst;moJpI;any,liA;da7;ma7;te;pt;andPduBet,i6oKsI;coKol2;ve;liArt,uI;nd;sh;de;ct;on",Person:"true¦0:1Q;a29b1Zc1Md1Ee18f15g13h0Ri0Qj0Nk0Jl0Gm09n06o05p00rPsItCusain bolt,v9w4xzibit,y1;anni,oko on2uji,v1;an,es;en,o;a3ednesday adams,i2o1;lfram,o0Q;ll ferrell,z khalifa;lt disn1Qr1;hol,r0G;a2i1oltai06;n dies0Zrginia wo17;lentino rossi,n goG;a4h3i2ripp,u1yra banks;lZpac shakur;ger woods,mba07;eresa may,or;kashi,t1ylor;um,ya1B;a5carlett johanss0h4i3lobodan milosevic,no2ocr1Lpider1uperm0Fwami; m0Em0E;op dogg,w whi1H;egfried,nbad;akespeaTerlock holm1Sia labeouf;ddam hussa16nt1;a cla11ig9;aAe6i5o3u1za;mi,n dmc,paul,sh limbau1;gh;bin hood,d stew16nald1thko;in0Mo;han0Yngo starr,valdo;ese witherspo0i1mbrandt;ll2nh1;old;ey,y;chmaninoff,ffi,iJshid,y roma1H;a4e3i2la16o1uff daddy;cahont0Ie;lar,p19;le,rZ;lm17ris hilt0;leg,prah winfr0Sra;a2e1iles cra1Bostradam0J; yo,l5tt06wmQ;pole0s;a5e4i2o1ubar03;by,lie5net,rriss0N;randa ju1tt romn0M;ly;rl0GssiaB;cklemo1rkov,s0ta hari,ya angelou;re;ady gaga,e1ibera0Pu;bron jam0Xch wale1e;sa;anye west,e3i1obe bryant;d cudi,efer suther1;la0P;ats,sha;a2effers0fk,k rowling,rr tolki1;en;ck the ripp0Mwaharlal nehru,y z;liTnez,ron m7;a7e5i3u1;lk hog5mphrey1sa01;! bog05;l1tl0H;de; m1dwig,nry 4;an;ile selassFlle ber4m3rrison1;! 1;ford;id,mo09;ry;ast0iannis,o1;odwPtye;ergus0lorence nightinga08r1;an1ederic chopN;s,z;ff5m2nya,ustaXzeki1;el;eril lagasse,i1;le zatop1nem;ek;ie;a6e4i2octor w1rake;ho;ck w1ego maradoC;olf;g1mi lovaOnzel washingt0;as;l1nHrth vadR;ai lNt0;a8h5lint0o1thulhu;n1olio;an,fuci1;us;on;aucKop2ristian baMy1;na;in;millo,ptain beefhe4r1;dinal wols2son1;! palmF;ey;art;a8e5hatt,i3oHro1;ck,n1;te;ll g1ng crosby;atB;ck,nazir bhut2rtil,yon1;ce;to;nksy,rack ob1;ama;l 6r3shton kutch2vril lavig8yn ra1;nd;er;chimed2istot1;le;es;capo2paci1;no;ne",Adjective:"true¦0:AI;1:BS;2:BI;3:BA;4:A8;5:84;6:AV;7:AN;8:AF;9:7H;A:BQ;B:AY;C:BC;D:BH;E:9Y;aA2b9Ec8Fd7We79f6Ng6Eh61i4Xj4Wk4Tl4Im41n3Po36p2Oquart7Pr2Ds1Dt14uSvOwFye29;aMeKhIiHoF;man5oFrth7G;dADzy;despreB1n w97s86;acked1UoleF;!sa6;ather1PeFll o70ste1D;!k5;nt1Ist6Ate4;aHeGiFola5T;bBUce versa,gi3Lle;ng67rsa5R;ca1gBSluAV;lt0PnLpHrGsFttermoBL;ef9Ku3;b96ge1; Hb32pGsFtiAH;ca6ide d4R;er,i85;f52to da2;a0Fbeco0Hc0Bd04e02f01gu1XheaBGiXkn4OmUnTopp06pRrNsJtHus0wF;aFiel3K;nt0rra0P;app0eXoF;ld,uS;eHi37o5ApGuF;perv06spec39;e1ok9O;en,ttl0;eFu5;cogn06gul2RlGqu84sF;erv0olv0;at0en33;aFrecede0E;id,rallel0;am0otic0;aFet;rri0tF;ch0;nFq26vers3;sur0terFv7U;eFrupt0;st0;air,inish0orese98;mploy0n7Ov97xpF;ect0lain0;eHisFocume01ue;clFput0;os0;cid0rF;!a8Scov9ha8Jlyi8nea8Gprivileg0sMwF;aFei9I;t9y;hGircumcFonvin2U;is0;aFeck0;lleng0rt0;b20ppea85ssuGttend0uthorF;iz0;mi8;i4Ara;aLeIhoHip 25oGrF;anspare1encha1i2;geth9leADp notch,rpB;rny,ugh6H;ena8DmpGrFs6U;r49tia4;eCo8P;leFst4M;nt0;a0Dc09e07h06i04ki03l01mug,nobbi4XoVpRqueami4XtKuFymb94;bHccinAi generis,pFr5;erFre7N;! dup9b,vi70;du0li7Lp6IsFurb7J;eq9Atanda9X;aKeJi16o2QrGubboFy4Q;rn;aightFin5GungS; fFfF;or7V;adfa9Pri6;lwa6Ftu82;arHeGir6NlendBot Fry;on;c3Qe1S;k5se; call0lImb9phistic16rHuFviV;ndFth1B;proof;dBry;dFub6; o2A;e60ipF;pe4shod;ll0n d7R;g2HnF;ceEg6ist9;am3Se9;co1Zem5lfFn6Are7; suf4Xi43;aGholFient3A;ar5;rlFt4A;et;cr0me,tisfac7F;aOeIheumatoBiGoF;bu8Ztt7Gy3;ghtFv3; 1Sf6X;cJdu8PlInown0pro69sGtF;ard0;is47oF;lu2na1;e1Suc45;alcit8Xe1ondi2;bBci3mpa1;aSePicayu7laOoNrGuF;bl7Tnjabi;eKiIoF;b7VfGmi49pFxi2M;er,ort81;a7uD;maFor,sti7va2;!ry;ciDexis0Ima2CpaB;in55puli8G;cBid;ac2Ynt 3IrFti2;ma40tFv7W;!i3Z;i2YrFss7R;anoBtF; 5XiF;al,s5V;bSffQkPld OnMrLth9utKverF;!aIbMdHhGni75seas,t,wF;ei74rou74;a63e7A;ue;ll;do1Ger,si6A;d3Qg2Aotu5Z; bFbFe on o7g3Uli7;oa80;fashion0school;!ay; gua7XbFha5Uli7;eat;eHligGsF;ce7er0So1C;at0;diFse;a1e1;aOeNiMoGuF;anc0de; moEnHrthFt6V;!eFwe7L;a7Krn;chaGdescri7Iprof30sF;top;la1;ght5;arby,cessa4ighbor5wlyw0xt;k0usiaFv3;ti8;aQeNiLoHuF;dIltiF;facet0p6;deHlGnFot,rbBst;ochro4Xth5;dy;rn,st;ddle ag0nF;dbloZi,or;ag9diocEga,naGrFtropolit4Q;e,ry;ci8;cIgenta,inHj0Fkeshift,mmGnFri4Oscu61ver18;da5Dy;ali4Lo4U;!stream;abEho;aOeLiIoFumberi8;ngFuti1R;stan3RtF;erm,i4H;ghtGteraF;l,ry,te;heart0wei5O;ft JgFss9th3;al,eFi0M;nda4;nguBps0te5;apGind5noF;wi8;ut;ad0itte4uniW;ce co0Hgno6Mll0Cm04nHpso 2UrF;a2releF;va1; ZaYcoWdReQfOgrNhibi4Ri05nMoLsHtFvalu5M;aAeF;nDrdepe2K;a7iGolFuboI;ub6ve1;de,gF;nifica1;rdi5N;a2er;own;eriIiLluenVrF;ar0eq5H;pt,rt;eHiGoFul1O;or;e,reA;fiFpe26termi5E;ni2;mpFnsideCrreA;le2;ccuCdeq5Ene,ppr4J;fFsitu,vitro;ro1;mJpF;arHeGl15oFrop9;li2r11;n2LrfeA;ti3;aGeFi18;d4BnD;tuE;egGiF;c0YteC;al,iF;tiF;ma2;ld;aOelNiLoFuma7;a4meInHrrGsFur5;ti6;if4E;e58o3U; ma3GsF;ick;ghfalut2HspF;an49;li00pf33;i4llow0ndGrdFtM; 05coEworki8;sy,y;aLener44iga3Blob3oKrGuF;il1Nng ho;aFea1Fizzl0;cGtF;ef2Vis;ef2U;ld3Aod;iFuc2D;nf2R;aVeSiQlOoJrF;aGeFil5ug3;q43tf2O;gFnt3S;i6ra1;lk13oHrF; keeps,eFge0Vm9tu41;g0Ei2Ds3R;liF;sh;ag4Mowe4uF;e1or45;e4nF;al,i2;d Gmini7rF;ti6ve1;up;bl0lDmIr Fst pac0ux;oGreacF;hi8;ff;ed,ili0R;aXfVlTmQnOqu3rMthere3veryday,xF;aApIquisi2traHuF;be48lF;ta1;!va2L;edRlF;icF;it;eAstF;whi6; Famor0ough,tiE;rou2sui2;erGiF;ne1;ge1;dFe2Aoq34;er5;ficF;ie1;g9sF;t,ygF;oi8;er;aWeMiHoGrFue;ea4owY;ci6mina1ne,r31ti8ubQ;dact2Jfficult,m,sGverF;ge1se;creGePjoi1paCtF;a1inA;et,te; Nadp0WceMfiLgeneCliJmuEpeIreliAsGvoF;id,ut;pFtitu2ul1L;eCoF;nde1;ca2ghF;tf13;a1ni2;as0;facto;i5ngero0I;ar0Ce09h07i06l05oOrIuF;rmudgeon5stoma4teF;sy;ly;aIeHu1EystalF; cleFli7;ar;epy;fFv17z0;ty;erUgTloSmPnGrpoCunterclVveFy;rt;cLdJgr21jIsHtrF;aFi2;dic0Yry;eq1Yta1;oi1ug3;escenFuN;di8;a1QeFiD;it0;atoDmensuCpF;ass1SulF;so4;ni3ss3;e1niza1;ci1J;ockwiD;rcumspeAvil;eFintzy;e4wy;leGrtaF;in;ba2;diac,ef00;a00ePiLliJoGrFuck nak0;and new,isk,on22;gGldface,naF; fi05fi05;us;nd,tF;he;gGpartisFzarE;an;tiF;me;autifOhiNlLnHsFyoN;iWtselF;li8;eGiFt;gn;aFfi03;th;at0oF;v0w;nd;ul;ckwards,rF;e,rT; priori,b13c0Zd0Tf0Ng0Ihe0Hl09mp6nt06pZrTsQttracti0MuLvIwF;aGkF;wa1B;ke,re;ant garGeraF;ge;de;diIsteEtF;heFoimmu7;nt07;re;to4;hGlFtu2;eep;en;bitIchiv3roHtF;ifiFsy;ci3;ga1;ra4;ry;pFt;aHetizi8rF;oprF;ia2;llFre1;ed,i8;ng;iquFsy;at0e;ed;cohKiJkaHl,oGriFterX;ght;ne,of;li7;ne;ke,ve;olF;ic;ad;ain07gressiIi6rF;eeF;ab6;le;ve;fGraB;id;ectGlF;ue1;ioF;na2; JaIeGvF;erD;pt,qF;ua2;ma1;hoc,infinitum;cuCquiGtu3u2;al;esce1;ra2;erSjeAlPoNrKsGuF;nda1;e1olu2trF;aAuD;se;te;eaGuF;pt;st;aFve;rd;aFe;ze;ct;ra1;nt",Pronoun:"true¦elle,h3i2me,she,th0us,we,you;e0ou;e,m,y;!l,t;e,im",Preposition:"true¦aPbMcLdKexcept,fIinGmid,notwithstandiWoDpXqua,sCt7u4v2w0;/o,hereSith0;! whHin,oW;ersus,i0;a,s a vis;n1p0;!on;like,til;h1ill,oward0;!s;an,ereby,r0;ough0u;!oM;ans,ince,o that,uch G;f1n0ut;!to;!f;! 0to;effect,part;or,r0;om;espite,own,u3;hez,irca;ar1e0oBy;sides,tween;ri7;bo8cross,ft7lo6m4propos,round,s1t0;!op;! 0;a whole,long 0;as;id0ong0;!st;ng;er;ut",SportsTeam:"true¦0:18;1:1E;2:1D;3:14;a1Db15c0Sd0Kfc dallas,g0Ihouston 0Hindiana0Gjacksonville jagua0k0El0Am01new UoRpKqueens parkJreal salt lake,sBt6utah jazz,vancouver whitecaps,w4yW;ashington 4h10;natio1Mredski2wizar0W;ampa bay 7e6o4;ronto 4ttenham hotspur;blue ja0Mrapto0;nnessee tita2xasD;buccanee0ra0K;a8eattle 6porting kansas0Wt4; louis 4oke0V;c1Drams;marine0s4;eah13ounH;cramento Rn 4;antonio spu0diego 4francisco gJjose earthquak1;char08paB; ran07;a9h6ittsburgh 5ortland t4;imbe0rail blaze0;pirat1steele0;il4oenix su2;adelphia 4li1;eagl1philNunE;dr1;akland 4klahoma city thunder,rlando magic;athle0Lrai4;de0;england 8orleans 7york 4;g5je3knYme3red bul0Xy4;anke1;ian3;pelica2sain3;patrio3revolut4;ion;anchEeAi4ontreal impact;ami 8lwaukee b7nnesota 4;t5vi4;kings;imberwolv1wi2;rewe0uc0J;dolphi2heat,marli2;mphis grizz4ts;li1;a6eic5os angeles 4;clippe0dodFlaB;esterV; galaxy,ke0;ansas city 4nF;chiefs,roya0D; pace0polis col3;astr05dynamo,rocke3texa2;olden state warrio0reen bay pac4;ke0;allas 8e4i04od6;nver 6troit 4;lio2pisto2ti4;ge0;broncYnugge3;cowbo5maver4;icZ;ys;arEelLhAincinnati 8leveland 6ol4;orado r4umbus crew sc;api7ocki1;brow2cavalie0guar4in4;dia2;bengaVre4;ds;arlotte horAicago 4;b5cubs,fire,wh4;iteB;ea0ulQ;diff4olina panthe0; city;altimore Alackburn rove0oston 6rooklyn 4uffalo bilN;ne3;ts;cel5red4; sox;tics;rs;oriol1rave2;rizona Ast8tlanta 4;brav1falco2h4;awA;ns;es;on villa,r4;os;c6di4;amondbac4;ks;ardi4;na4;ls",Unit:"true¦a07b04cXdWexVfTgRhePinYjoule0BkMlJmDnan08oCp9quart0Bsq ft,t7volts,w6y2ze3°1µ0;g,s;c,f,n;dVear1o0;ttR; 0s 0;old;att,b;erNon0;!ne02;ascals,e1i0;cXnt00;rcent,tJ;hms,unceY;/s,e4i0m²,²,³;/h,cro2l0;e0liK;!²;grLsR;gCtJ;it1u0;menQx;erPreP;b5elvins,ilo1m0notO;/h,ph,²;!byGgrEmCs;ct0rtzL;aJogrC;allonJb0ig3rB;ps;a0emtEl oz,t4;hrenheit,radG;aby9;eci3m1;aratDe1m0oulombD;²,³;lsius,nti0;gr2lit1m0;et0;er8;am7;b1y0;te5;l,ps;c2tt0;os0;econd1;re0;!s","Noun|Gerund":"true¦0:3O;1:3M;2:3N;3:3D;4:32;5:2V;6:3E;7:3K;8:36;9:3J;A:3B;a3Pb37c2Jd27e23f1Vg1Sh1Mi1Ij1Gk1Dl18m13n11o0Wp0Pques0Sr0EsTtNunderMvKwFyDzB;eroi0oB;ni0o3P;aw2eB;ar2l3;aEed4hispe5i5oCrB;ap8est3i1;n0ErB;ki0r31;i1r2s9tc9;isualizi0oB;lunt1Vti0;stan4ta6;aFeDhin6iCraBy8;c6di0i2vel1M;mi0p8;aBs1;c9si0;l6n2s1;aUcReQhOiMkatKl2Wmo6nowJpeItFuCwB;ea5im37;b35f0FrB;fi0vB;e2Mi2J;aAoryt1KrCuB;d2KfS;etc9ugg3;l3n4;bCi0;ebBi0;oar4;gnBnAt1;a3i0;ip8oB;p8rte2u1;a1r27t1;hCo5reBulp1;a2Qe2;edu3oo3;i3yi0;aKeEi4oCuB;li0n2;oBwi0;fi0;aFcEhear7laxi0nDpor1sB;pon4tructB;r2Iu5;de5;or4yc3;di0so2;p8ti0;aFeacek20laEoCrBublis9;a1Teten4in1oces7;iso2siB;tio2;n2yi0;ckaAin1rB;ki0t1O;fEpeDrganiCvB;erco24ula1;si0zi0;ni0ra1;fe5;avi0QeBur7;gotia1twor6;aDeCi2oB;de3nito5;a2dita1e1ssaA;int0XnBrke1;ifUufactu5;aEeaDiBodAyi0;cen7f1mi1stB;e2i0;r2si0;n4ug9;iCnB;ea4it1;c6l3;ogAuB;dAgg3stif12;ci0llust0VmDnBro2;nova1sp0NterBven1;ac1vie02;agi2plo4;aDea1iCoBun1;l4w3;ki0ri0;nd3rB;roWvB;es1;aCene0Lli4rBui4;ee1ie0N;rde2the5;aHeGiDlCorBros1un4;e0Pmat1;ir1oo4;gh1lCnBs9;anZdi0;i0li0;e3nX;r0Zscina1;a1du01nCxB;erci7plo5;chan1di0ginB;ee5;aLeHiGoub1rCum8wB;el3;aDeCiB;bb3n6vi0;a0Qs7;wi0;rTscoDvi0;ba1coZlBvelo8;eCiB;ve5;ga1;nGti0;aVelebUhSlPoDrBur3yc3;aBos7yi0;f1w3;aLdi0lJmFnBo6pi0ve5;dDsCvinB;ci0;trBul1;uc1;muniDpB;lBo7;ai2;ca1;lBo5;ec1;c9ti0;ap8eaCimToBubT;ni0t9;ni0ri0;aBee5;n1t1;ra1;m8rCs1te5;ri0;vi0;aPeNitMlLoGrDuB;dge1il4llBr8;yi0;an4eat9oadB;cas1;di0;a1mEokB;i0kB;ee8;pi0;bi0;es7oa1;c9i0;gin2lonAt1;gi0;bysit1c6ki0tt3;li0;ki0;bando2cGdverti7gi0pproac9rgDssuCtB;trac1;mi0;ui0;hi0;si0;coun1ti0;ti0;ni0;ng",PhrasalVerb:"true¦0:92;1:96;2:8H;3:8V;4:8A;5:83;6:85;7:98;8:90;9:8G;A:8X;B:8R;C:8U;D:8S;E:70;F:97;G:8Y;H:81;I:7H;J:79;a9Fb7Uc6Rd6Le6Jf5Ig50h4Biron0j47k40l3Em31n2Yo2Wp2Cquiet Hr1Xs0KtZuXvacuu6QwNyammerBzK;ero Dip LonK;e0k0;by,ov9up;aQeMhLiKor0Mrit19;mp0n3Fpe0r5s5;ackAeel Di0S;aLiKn33;gh 3Wrd0;n Dr K;do1in,oJ;it 79k5lk Lrm 69sh Kt83v60;aw3do1o7up;aw3in,oC;rgeBsK;e 2herE;a00eYhViRoQrMuKypP;ckErn K;do1in,oJup;aLiKot0y 30;ckl7Zp F;ck HdK;e 5Y;n7Wp 3Es5K;ck MdLe Kghten 6me0p o0Rre0;aw3ba4do1in,up;e Iy 2;by,oG;ink Lrow K;aw3ba4in,up;ba4ov9up;aKe 77ll62;m 2r 5M;ckBke Llk K;ov9shit,u47;aKba4do1in,leave,o4Dup;ba4ft9pa69w3;a0Vc0Te0Mh0Ii0Fl09m08n07o06p01quar5GtQuOwK;earMiK;ngLtch K;aw3ba4o8K; by;cKi6Bm 2ss0;k 64;aReQiPoNrKud35;aigh2Det75iK;ke 7Sng K;al6Yup;p Krm2F;by,in,oG;c3Ln3Lr 2tc4O;p F;c3Jmp0nd LrKveAy 2O;e Ht 2L;ba4do1up;ar3GeNiMlLrKurB;ead0ingBuc5;a49it 6H;c5ll o3Cn 2;ak Fe1Xll0;a3Bber 2rt0und like;ap 5Vow Duggl5;ash 6Noke0;eep NiKow 6;cLp K;o6Dup;e 68;in,oK;ff,v9;de19gn 4NnKt 6Gz5;gKkE; al6Ale0;aMoKu5W;ot Kut0w 7M;aw3ba4f48oC;c2WdeEk6EveA;e Pll1Nnd Orv5tK; Ktl5J;do1foLin,o7upK;!on;ot,r5Z;aw3ba4do1in,o33up;oCto;al66out0rK;ap65ew 6J;ilAv5;aXeUiSoOuK;b 5Yle0n Kstl5;aLba4do1inKo2Ith4Nu5P;!to;c2Xr8w3;ll Mot LpeAuK;g3Ind17;a2Wf3Po7;ar8in,o7up;ng 68p oKs5;ff,p18;aKelAinEnt0;c6Hd K;o4Dup;c27t0;aZeYiWlToQrOsyc35uK;ll Mn5Kt K;aKba4do1in,oJto47up;pa4Dw3;a3Jdo1in,o21to45up;attleBess KiNop 2;ah2Fon;iLp Kr4Zu1Gwer 6N;do1in,o6Nup;nt0;aLuK;gEmp 6;ce u20y 6D;ck Kg0le 4An 6p5B;oJup;el 5NncilE;c53ir 39n0ss MtLy K;ba4oG; Hc2R;aw3ba4in,oJ;pKw4Y;e4Xt D;aLerd0oK;dAt53;il Hrrow H;aTeQiPoLuK;ddl5ll I;c1FnkeyMp 6uthAve K;aKdo1in,o4Lup;l4Nw3; wi4K;ss0x 2;asur5e3SlLss K;a21up;t 6;ke Ln 6rKs2Ax0;k 6ryA;do,fun,oCsure,up;a02eViQoLuK;ck0st I;aNc4Fg MoKse0;k Kse4D;aft9ba4do1forw37in56o0Zu46;in,oJ;d 6;e NghtMnLsKve 00;ten F;e 2k 2; 2e46;ar8do1in;aMt LvelK; oC;do1go,in,o7up;nEve K;in,oK;pKut;en;c5p 2sh LtchBughAy K;do1o59;in4Po7;eMick Lnock K;do1oCup;oCup;eLy K;in,up;l Ip K;aw3ba4do1f04in,oJto,up;aMoLuK;ic5mpE;ke3St H;c43zz 2;a01eWiToPuK;nLrrKsh 6;y 2;keLt K;ar8do1;r H;lKneErse3K;d Ke 2;ba4dKfast,o0Cup;ear,o1;de Lt K;ba4on,up;aw3o7;aKlp0;d Ml Ir Kt 2;fKof;rom;f11in,o03uW;cPm 2nLsh0ve Kz2P;at,it,to;d Lg KkerP;do1in,o2Tup;do1in,oK;ut,v9;k 2;aZeTive Rloss IoMrLunK; f0S;ab hold,in43ow 2U; Kof 2I;aMb1Mit,oLr8th1IuK;nd9;ff,n,v9;bo7ft9hQw3;aw3bKdo1in,oJrise,up,w3;a4ir2H;ar 6ek0t K;aLb1Fdo1in,oKr8up;ff,n,ut,v9;cLhKl2Fr8t,w3;ead;ross;d aKng 2;bo7;a0Ee07iYlUoQrMuK;ck Ke2N;ar8up;eLighten KownBy 2;aw3oG;eKshe27; 2z5;g 2lMol Krk I;aKwi20;bo7r8;d 6low 2;aLeKip0;sh0;g 6ke0mKrKtten H;e F;gRlPnNrLsKzzle0;h F;e Km 2;aw3ba4up;d0isK;h 2;e Kl 1T;aw3fPin,o7;ht ba4ure0;ePnLsK;s 2;cMd K;fKoG;or;e D;d04l 2;cNll Krm0t1G;aLbKdo1in,o09sho0Eth08victim;a4ehi2O;pa0C;e K;do1oGup;at Kdge0nd 12y5;in,o7up;aOi1HoNrK;aLess 6op KuN;aw3b03in,oC;gBwB; Ile0ubl1B;m 2;a0Ah05l02oOrLut K;aw3ba4do1oCup;ackBeep LoKy0;ss Dwd0;by,do1in,o0Uup;me NoLuntK; o2A;k 6l K;do1oG;aRbQforOin,oNtKu0O;hLoKrue;geth9;rough;ff,ut,v9;th,wK;ard;a4y;paKr8w3;rt;eaLose K;in,oCup;n 6r F;aNeLiK;ll0pE;ck Der Kw F;on,up;t 2;lRncel0rOsMtch LveE; in;o1Nup;h Dt K;doubt,oG;ry LvK;e 08;aw3oJ;l Km H;aLba4do1oJup;ff,n,ut;r8w3;a0Ve0MiteAl0Fo04rQuK;bblNckl05il0Dlk 6ndl05rLsKtMy FzzA;t 00;n 0HsK;t D;e I;ov9;anWeaUiLush K;oGup;ghQng K;aNba4do1forMin,oLuK;nd9p;n,ut;th;bo7lKr8w3;ong;teK;n 2;k K;do1in,o7up;ch0;arTg 6iRn5oPrNssMttlLunce Kx D;aw3ba4;e 6; ar8;e H;do1;k Dt 2;e 2;l 6;do1up;d 2;aPeed0oKurt0;cMw K;aw3ba4do1o7up;ck;k K;in,oC;ck0nk0stA; oQaNef 2lt0nd K;do1ov9up;er;up;r Lt K;do1in,oCup;do1o7;ff,nK;to;ck Pil0nMrgLsK;h D;ainBe D;g DkB; on;in,o7;aw3do1in,oCup;ff,ut;ay;ct FdQir0sk MuctionA; oG;ff;ar8o7;ouK;nd; o7;d K;do1oKup;ff,n;wn;o7up;ut",ProperNoun:"true¦aIbDc8dalhousHe7f5gosford,h4iron maiden,kirby,landsdowne,m2nis,r1s0wembF;herwood,paldiB;iel,othwe1;cgi0ercedes,issy;ll;intBudsB;airview,lorence,ra0;mpt9nco;lmo,uro;a1h0;arlt6es5risti;rl0talina;et4i0;ng;arb3e0;et1nt0rke0;ley;on;ie;bid,jax","Person|Place":"true¦a8d6h4jordan,k3orlando,s1vi0;ctor9rgin9;a0ydney;lvador,mara,ntia4;ent,obe;amil0ous0;ton;arw2ie0;go;lexandr1ust0;in;ia",LastName:"true¦0:BR;1:BF;2:B5;3:BH;4:AX;5:9Y;6:B6;7:BK;8:B0;9:AV;A:AL;B:8Q;C:8G;D:7K;E:BM;F:AH;aBDb9Zc8Wd88e81f7Kg6Wh64i60j5Lk4Vl4Dm39n2Wo2Op25quispe,r1Ls0Pt0Ev03wTxSyKzG;aIhGimmerm6A;aGou,u;ng,o;khar5ytsE;aKeun9BiHoGun;koya32shiBU;!lG;diGmaz;rim,z;maGng;da,g52mo83sGzaC;aChiBV;iao,u;aLeJiHoGright,u;jcA5lff,ng;lGmm0nkl0sniewsC;kiB1liams33s3;bGiss,lt0;b,er,st0;a6Vgn0lHtG;anabe,s3;k0sh,tG;e2Non;aLeKiHoGukD;gt,lk5roby5;dHllalGnogr3Kr1Css0val3S;ba,ob1W;al,ov4;lasHsel8W;lJn dIrgBEsHzG;qu7;ilyEqu7siljE;en b6Aijk,yk;enzueAIverde;aPeix1VhKi2j8ka43oJrIsui,uG;om5UrG;c2n0un1;an,emblA7ynisC;dorAMlst3Km4rrAth;atch0i8UoG;mHrG;are84laci79;ps3sG;en,on;hirDkah9Mnaka,te,varA;a06ch01eYhUiRmOoMtIuHvGzabo;en9Jobod3N;ar7bot4lliv2zuC;aIeHoG;i7Bj4AyanAB;ele,in2FpheBvens25;l8rm0;kol5lovy5re7Tsa,to,uG;ng,sa;iGy72;rn5tG;!h;l71mHnGrbu;at9cla9Egh;moBo7M;aIeGimizu;hu,vchG;en8Luk;la,r1G;gu9infe5YmGoh,pulveA7rra5P;jGyG;on5;evi6iltz,miHneid0roed0uGwarz;be3Elz;dHtG;!t,z;!t;ar4Th8ito,ka4OlJnGr4saCto,unde19v4;ch7dHtGz;a5Le,os;b53e16;as,ihDm4Po0Y;aVeSiPoJuHyG;a6oo,u;bio,iz,sG;so,u;bKc8Fdrigue67ge10j9YmJosevelt,sItHux,wG;e,li6;a9Ch;enb4Usi;a54e4L;erts15i93;bei4JcHes,vGzzo;as,e9;ci,hards12;ag2es,iHut0yG;es,nol5N;s,t0;dImHnGsmu97v6C;tan1;ir7os;ic,u;aUeOhMiJoHrGut8;asad,if6Zochazk27;lishc2GpGrti72u10we76;e3Aov51;cHe45nG;as,to;as70hl0;aGillips;k,m,n6I;a3Hde3Wete0Bna,rJtG;ersHrovGters54;!a,ic;!en,on;eGic,kiBss3;i9ra,tz,z;h86k,padopoulIrk0tHvG;ic,l4N;el,te39;os;bMconn2Ag2TlJnei6PrHsbor6XweBzG;dem7Rturk;ella4DtGwe6N;ega,iz;iGof7Hs8I;vGyn1R;ei9;aSri1;aPeNiJoGune50ym2;rHvGwak;ak4Qik5otn66;odahl,r4S;cholsZeHkolGls4Jx3;ic,ov84;ls1miG;!n1;ils3mG;co4Xec;gy,kaGray2sh,var38;jiGmu9shiG;ma;a07c04eZiWoMuHyeG;rs;lJnIrGssoli6S;atGp03r7C;i,ov4;oz,te58;d0l0;h2lOnNo0RrHsGza1A;er,s;aKeJiIoz5risHtG;e56on;!on;!n7K;au,i9no,t5J;!lA;r1Btgome59;i3El0;cracFhhail5kkeHlG;l0os64;ls1;hmeJiIj30lHn3Krci0ssiGyer2N;!er;n0Po;er,j0;dDti;cartHlG;aughl8e2;hy;dQe7Egnu68i0jer3TkPmNnMrItHyG;er,r;ei,ic,su21thews;iHkDquAroqu8tinG;ez,s;a5Xc,nG;!o;ci5Vn;a5UmG;ad5;ar5e6Kin1;rig77s1;aVeOiLoJuHyG;!nch;k4nGo;d,gu;mbarGpe3Fvr4we;di;!nGu,yana2B;coln,dG;b21holm,strom;bedEfeKhIitn0kaHn8rGw35;oy;!j;m11tG;in1on1;bvGvG;re;iGmmy,ng,rs2Qu,voie,ws3;ne,t1F;aZeYh2iWlUnez50oNrJuHvar2woG;k,n;cerGmar68znets5;a,o34;aHem0isGyeziu;h23t3O;m0sni4Fus3KvG;ch4O;bay57ch,rh0Usk16vaIwalGzl5;czGsC;yk;cIlG;!cGen4K;huk;!ev4ic,s;e8uiveG;rt;eff0kGl4mu9nnun1;ucF;ll0nnedy;hn,llKminsCne,pIrHstra3Qto,ur,yGzl5;a,s0;j0Rls22;l2oG;or;oe;aPenOha6im14oHuG;ng,r4;e32hInHrge32u6vG;anD;es,ss3;anHnsG;en,on,t3;nesGs1R;en,s1;kiBnings,s1;cJkob4EnGrv0E;kDsG;en,sG;en0Ion;ks3obs2A;brahimDglesi5Nke5Fl0Qno07oneIshikHto,vanoG;u,v54;awa;scu;aVeOiNjaltal8oIrist50uG;!aGb0ghAynh;m2ng;a6dz4fIjgaa3Hk,lHpUrGwe,x3X;ak1Gvat;mAt;er,fm3WmG;ann;ggiBtchcock;iJmingw4BnHrGss;nand7re9;deGriks1;rs3;kkiHnG;on1;la,n1;dz4g1lvoQmOns0ZqNrMsJuIwHyG;asFes;kiB;g1ng;anHhiG;mo14;i,ov0J;di6p0r10t;ue;alaG;in1;rs1;aVeorgUheorghe,iSjonRoLrJuGw3;errGnnar3Co,staf3Ctierr7zm2;a,eG;ro;ayli6ee2Lg4iffithGub0;!s;lIme0UnHodGrbachE;e,m2;calvAzale0S;dGubE;bGs0E;erg;aj,i;bs3l,mGordaO;en7;iev3U;gnMlJmaIndFo,rGsFuthi0;cGdn0za;ia;ge;eaHlG;agh0i,o;no;e,on;aVerQiLjeldsted,lKoIrHuG;chs,entAji41ll0;eem2iedm2;ntaGrt8urni0wl0;na;emi6orA;lipIsHtzgeraG;ld;ch0h0;ovG;!ic;hatDnanIrG;arGei9;a,i;deY;ov4;b0rre1D;dKinsJriksIsGvaB;cob3GpGtra3D;inoza,osiQ;en,s3;te8;er,is3warG;ds;aXePiNjurhuMoKrisco15uHvorakG;!oT;arte,boHmitru,nn,rGt3C;and,ic;is;g2he0Omingu7nErd1ItG;to;us;aGcki2Hmitr2Ossanayake,x3;s,z; JbnaIlHmirGrvisFvi,w2;!ov4;gado,ic;th;bo0groot,jo6lHsilGvriA;va;a cruz,e3uG;ca;hl,mcevsCnIt2WviG;dGes,s;ov,s3;ielsGku22;!en;ki;a0Be06hRiobQlarkPoIrGunningh1H;awfo0RivGuz;elli;h1lKntJoIrGs2Nx;byn,reG;a,ia;ke,p0;i,rer2K;em2liB;ns;!e;anu;aOeMiu,oIristGu6we;eGiaG;ns1;i,ng,p9uHwGy;!dH;dGng;huJ;!n,onGu6;!g;kJnIpm2ttHudhGv7;ry;erjee,o14;!d,g;ma,raboG;rty;bJl0Cng4rG;eghetHnG;a,y;ti;an,ota1C;cerAlder3mpbeLrIstGvadi0B;iGro;llo;doHl0Er,t0uGvalho;so;so,zo;ll;a0Fe01hYiXlUoNrKuIyG;rLtyG;qi;chan2rG;ke,ns;ank5iem,oGyant;oks,wG;ne;gdan5nIruya,su,uchaHyKziG;c,n5;rd;darGik;enG;ko;ov;aGond15;nco,zG;ev4;ancFshw16;a08oGuiy2;umGwmG;ik;ckRethov1gu,ktPnNrG;gJisInG;ascoGds1;ni;ha;er,mG;anG;!n;gtGit7nP;ss3;asF;hi;er,hG;am;b4ch,ez,hRiley,kk0ldw8nMrIshHtAu0;es;ir;bInHtlGua;ett;es,i0;ieYosa;dGik;a9yoG;padhyG;ay;ra;k,ng;ic;bb0Acos09d07g04kht05lZnPrLsl2tJyG;aHd8;in;la;chis3kiG;ns3;aImstro6sl2;an;ng;ujo,ya;dJgelHsaG;ri;ovG;!a;ersJov,reG;aGjEws;ss1;en;en,on,s3;on;eksejEiyEmeiIvG;ar7es;ez;da;ev;arwHuilG;ar;al;ams,l0;er;ta;as",Ordinal:"true¦eBf7nin5s3t0zeroE;enDhir1we0;lfCn7;d,t3;e0ixt8;cond,vent7;et0th;e6ie7;i2o0;r0urt3;tie4;ft1rst;ight0lev1;e0h,ie1;en0;th",Cardinal:"true¦bEeBf5mEnine7one,s4t0zero;en,h2rDw0;e0o;lve,n5;irt6ousands,ree;even2ix2;i3o0;r1ur0;!t2;ty;ft0ve;e2y;ight0lev1;!e0y;en;illions",Multiple:"true¦b3hundred,m3qu2se1t0;housand,r2;pt1xt1;adr0int0;illion",City:"true¦0:74;1:61;2:6G;3:6J;4:5S;a68b53c4Id48e44f3Wg3Hh39i31j2Wk2Fl23m1Mn1Co19p0Wq0Ur0Os05tRuQvLwDxiBy9z5;a7h5i4Muri4O;a5e5ongsh0;ng3H;greb,nzib5G;ang2e5okoha3Sunfu;katerin3Hrev0;a5n0Q;m5Hn;arsBeAi6roclBu5;h0xi,zh5P;c7n5;d5nipeg,terth4;hoek,s1L;hi5Zkl3A;l63xford;aw;a8e6i5ladivost5Molgogr6L;en3lni6S;ni22r5;o3saill4N;lenc4Wncouv3Sr3ughn;lan bat1Crumqi,trecht;aFbilisi,eEheDiBo9r7u5;l21n63r5;in,ku;i5ondh62;es51poli;kyo,m2Zron1Pulo5;n,uS;an5jua3l2Tmisoa6Bra3;j4Tshui; hag62ssaloni2H;gucigal26hr0l av1U;briz,i6llinn,mpe56ng5rtu,shk2R;i3Esh0;an,chu1n0p2Eyu0;aEeDh8kopje,owe1Gt7u5;ra5zh4X;ba0Ht;aten is55ockholm,rasbou67uttga2V;an8e6i5;jiazhua1llo1m5Xy0;f50n5;ya1zh4H;gh3Kt4Q;att45o1Vv44;cramen16int ClBn5o paulo,ppo3Rrajevo; 7aa,t5;a 5o domin3E;a3fe,m1M;antonio,die3Cfrancisco,j5ped3Nsalvad0J;o5u0;se;em,t lake ci5Fz25;lou58peters24;a9e8i6o5;me,t59;ga,o5yadh;! de janei3F;cife,ims,nn3Jykjavik;b4Sip4lei2Inc2Pwalpindi;ingdao,u5;ez2i0Q;aFeEhDiCo9r7u6yong5;ya1;eb59ya1;a5etor3M;g52to;rt5zn0; 5la4Co;au prin0Melizabe24sa03;ls3Prae5Atts26;iladelph3Gnom pe1Aoenix;ki1tah tik3E;dua,lerYnaji,r4Ot5;na,r32;ak44des0Km1Mr6s5ttawa;a3Vlo;an,d06;a7ew5ing2Fovosibir1Jyc; 5cast36;del24orlea44taip14;g8iro4Wn5pl2Wshv33v0;ch6ji1t5;es,o1;a1o1;a6o5p4;ya;no,sa0W;aEeCi9o6u5;mb2Ani26sc3Y;gadishu,nt6s5;c13ul;evideo,pelli1Rre2Z;ami,l6n14s5;kolc,sissauga;an,waukee;cca,d5lbour2Mmph41ndo1Cssi3;an,ell2Xi3;cau,drAkass2Sl9n8r5shh4A;aca6ib5rakesh,se2L;or;i1Sy;a4EchFdal0Zi47;mo;id;aDeAi8o6u5vSy2;anMckn0Odhia3;n5s angel26;d2g bea1N;brev2Be3Lma5nz,sb2verpo28;!ss27; ma39i5;c5pzig;est16; p6g5ho2Wn0Cusan24;os;az,la33;aHharFiClaipeBo9rak0Du7y5;iv,o5;to;ala lump4n5;mi1sh0;hi0Hlka2Xpavog4si5wlo2;ce;da;ev,n5rkuk;gst2sha5;sa;k5toum;iv;bHdu3llakuric0Qmpa3Fn6ohsiu1ra5un1Iwaguc0Q;c0Pj;d5o,p4;ah1Ty;a7e6i5ohannesV;l1Vn0;dd36rusalem;ip4k5;ar2H;bad0mph1OnArkutUs7taXz5;mir,tapala5;pa;fah0l6tanb5;ul;am2Zi2H;che2d5;ianap2Mo20;aAe7o5yder2W; chi mi5ms,nolulu;nh;f6lsin5rakli2;ki;ei;ifa,lifax,mCn5rb1Dva3;g8nov01oi;aFdanEenDhCiPlasgBo9raz,u5;a5jr23;dal6ng5yaquil;zh1J;aja2Oupe;ld coa1Bthen5;bu2S;ow;ent;e0Uoa;sk;lw7n5za;dhi5gt1E;nag0U;ay;aisal29es,o8r6ukuya5;ma;ankfu5esno;rt;rt5sh0; wor6ale5;za;th;d5indhov0Pl paso;in5mont2;bur5;gh;aBe8ha0Xisp4o7resd0Lu5;b5esseldorf,nkirk,rb0shanbe;ai,l0I;ha,nggu0rtmu13;hradSl6nv5troit;er;hi;donghIe6k09l5masc1Zr es sala1KugavpiY;i0lU;gu,je2;aJebu,hAleve0Vo5raio02uriti1Q;lo7n6penhag0Ar5;do1Ok;akKst0V;gUm5;bo;aBen8i6ongqi1ristchur5;ch;ang m7ca5ttago1;go;g6n5;ai;du,zho1;ng5ttogr14;ch8sha,zh07;gliari,i9lga8mayenJn6pe town,r5tanO;acCdiff;ber1Ac5;un;ry;ro;aWeNhKirmingh0WoJr9u5;chareTdapeTenos air7r5s0tu0;g5sa;as;es;a9is6usse5;ls;ba6t5;ol;ne;sil8tisla7zzav5;il5;le;va;ia;goZst2;op6ubaneshw5;ar;al;iCl9ng8r5;g6l5n;in;en;aluru,hazi;fa6grade,o horizon5;te;st;ji1rut;ghd0BkFn9ot8r7s6yan n4;ur;el,r07;celo3i,ranquil09;ou;du1g6ja lu5;ka;alo6k5;ok;re;ng;ers5u;field;a05b02cc01ddis aba00gartaZhmedXizawl,lSmPnHqa00rEsBt7uck5;la5;nd;he7l5;an5;ta;ns;h5unci2;dod,gab5;at;li5;ngt2;on;a8c5kaOtwerp;hora6o3;na;ge;h7p5;ol5;is;eim;aravati,m0s5;terd5;am; 7buquerq6eppo,giers,ma5;ty;ue;basrah al qadim5mawsil al jadid5;ah;ab5;ad;la;ba;ra;idj0u dha5;bi;an;lbo6rh5;us;rg",Region:"true¦0:2O;1:2L;2:2U;3:2F;a2Sb2Fc21d1Wes1Vf1Tg1Oh1Ki1Fj1Bk16l13m0Sn09o07pYqVrSsJtEuBverAw6y4zacatec2W;akut0o0Fu4;cat1k09;a5est 4isconsin,yomi1O;bengal,virgin0;rwick3shington4;! dc;acruz,mont;dmurt0t4;ah,tar4; 2Pa12;a6e5laxca1Vripu21u4;scaEva;langa2nnessee,x2J;bas10m4smQtar29;aulip2Hil nadu;a9elang07i7o5taf16u4ylh1J;ff02rr09s1E;me1Gno1Uuth 4;cZdY;ber0c4kkim,naloa;hu1ily;n5rawak,skatchew1xo4;ny; luis potosi,ta catari2;a4hodeA;j4ngp0C;asth1shahi;ingh29u4;e4intana roo;bec,en6retaro;aAe6rince edward4unjab; i4;sl0G;i,n5r4;ak,nambu0F;a0Rnsylv4;an0;ha0Pra4;!na;axa0Zdisha,h4klaho21ntar4reg7ss0Dx0I;io;aLeEo6u4;evo le4nav0X;on;r4tt18va scot0;f9mandy,th4; 4ampton3;c6d5yo4;rk3;ako1O;aroli2;olk;bras1Nva0Dw4; 6foundland4;! and labrad4;or;brunswick,hamp3jers5mexiTyork4;! state;ey;galPyarit;aAeghala0Mi6o4;nta2r4;dov0elos;ch6dlanDn5ss4zor11;issippi,ouri;as geraPneso18;ig1oac1;dhy12harasht0Gine,lac07ni5r4ssachusetts;anhao,i el,ylG;p4toba;ur;anca3e4incoln3ouisI;e4iR;ds;a6e5h4omi;aka06ul2;dah,lant1ntucky,ra01;bardino,lmyk0ns0Qr4;achay,el0nata0X;alis6har4iangxi;kh4;and;co;daho,llino7n4owa;d5gush4;et0;ia2;is;a6ert5i4un1;dalFm0D;ford3;mp3rya2waii;ansu,eorg0lou7oa,u4;an4izhou,jarat;ajuato,gdo4;ng;cester3;lori4uji1;da;sex;ageUe7o5uran4;go;rs4;et;lawaMrby3;aFeaEh9o4rim08umbr0;ahui7l6nnectic5rsi4ventry;ca;ut;i03orado;la;e5hattisgarh,i4uvash0;apRhuahua;chn5rke4;ss0;ya;ra;lGm4;bridge3peche;a9ihar,r8u4;ck4ryat0;ingham3;shi4;re;emen,itish columb0;h0ja cal8lk7s4v7;hkorto4que;st1;an;ar0;iforn0;ia;dygHguascalientes,lBndhr9r5ss4;am;izo2kans5un4;achal 7;as;na;a 4;pradesh;a6ber5t4;ai;ta;ba5s4;ka;ma;ea",Place:"true¦0:4T;1:4V;2:44;3:4B;4:3I;a4Eb3Gc2Td2Ge26f25g1Vh1Ji1Fk1Cl14m0Vn0No0Jp08r04sTtNuLvJw7y5;a5o0Syz;kut1Bngtze;aDeChitBi9o5upatki,ycom2P;ki26o5;d5l1B;b3Ps5;i4to3Y;c0SllowbroCn5;c2Qgh2;by,chur1P;ed0ntw3Gs22;ke6r3St5;erf1f1; is0Gf3V;auxha3Mirgin is0Jost5;ok;laanbaatar,pto5xb3E;n,wn;a9eotihuac43h7ive49o6ru2Nsarskoe selo,u5;l2Dzigo47;nto,rquay,tt2J;am3e 5orn3E;bronx,hamptons;hiti,j mah0Iu1N;aEcotts bluff,eCfo,herbroQoApring9t7u5yd2F;dbu1Wn5;der03set3B;aff1ock2Nr5;atf1oud;hi37w24;ho,uth5; 1Iam1Zwo3E;a5i2O;f2Tt0;int lawrence riv3Pkhal2D;ayleigh,ed7i5oc1Z;chmo1Eo gran4ver5;be1Dfr09si4; s39cliffe,hi2Y;aCe9h8i5ompeii,utn2;c6ne5tcai2T; 2Pc0G;keri13t0;l,x;k,lh2mbr6n5r2J;n1Hzance;oke;cif38pahanaumokuak30r5;k5then0;si4w1K;ak7r6x5;f1l2X;ange county,d,f1inoco;mTw1G;e8i1Uo5;r5tt2N;th5wi0E; 0Sam19;uschwanste1Pw5; eng6a5h2market,po36;rk;la0P;a8co,e6i5uc;dt1Yll0Z;adow5ko0H;lands;chu picchu,gad2Ridsto1Ql8n7ple6r5;kh2; g1Cw11;hatt2Osf2B;ibu,t0ve1Z;a8e7gw,hr,in5owlOynd02;coln memori5dl2C;al;asi4w3;kefr7mbe1On5s,x;ca2Ig5si05;f1l27t0;ont;azan kreml14e6itchen2Gosrae,rasnoyar5ul;sk;ns0Hs1U;ax,cn,lf1n6ps5st;wiN;d5glew0Lverness;ian27ochina;aDeBi6kg,nd,ov5unti2H;d,enweep;gh6llc5;reL;bu03l5;and5;!s;r5yw0C;ef1tf1;libu24mp6r5stings;f1lem,row;stead,t0;aDodavari,r5uelph;avenAe5imsS;at 8en5; 6f1Fwi5;ch;acr3vall1H;brita0Flak3;hur5;st;ng3y villa0W;airhavHco,ra;aAgli9nf17ppi8u7ver6x5;et1Lf1;glad3t0;rope,st0;ng;nt0;rls1Ls5;t 5;e5si4;nd;aCe9fw,ig8o7ryd6u5xb;mfri3nstab00rh2tt0;en;nca18rcKv19wnt0B;by;n6r5vonpo1D;ry;!h2;nu8r5;l6t5;f1moor;ingt0;be;aLdg,eIgk,hClBo5royd0;l6m5rnwa0B;pt0;c7lingw6osse5;um;ood;he0S;earwat0St;a8el6i5uuk;chen itza,mney ro07natSricahua;m0Zt5;enh2;mor5rlottetPth2;ro;dar 5ntervilA;breaks,faZg5;rove;ld9m8r5versh2;lis6rizo pla5;in;le;bLpbellf1;weQ;aZcn,eNingl01kk,lackLolt0r5uckV;aGiAo5;ckt0ok5wns cany0;lyn,s5;i4to5;ne;de;dge6gh5;am,t0;n6t5;own;or5;th;ceb6m5;lNpt0;rid5;ge;bu5pool,wa8;rn;aconsfEdf1lBr9verly7x5;hi5;ll; hi5;lls;wi5;ck; air,l5;ingh2;am;ie5;ld;ltimore,rnsl6tters5;ea;ey;bLct0driadic,frica,ginJlGmFn9rc8s7tl6yleOzor3;es;!ant8;hcroft,ia; de triomphe,t6;adyr,ca8dov9tarct5;ic5; oce5;an;st5;er;ericas,s;be6dersh5hambra,list0;ot;rt0;cou5;rt;bot7i5;ngd0;on;sf1;ord",Country:"true¦0:38;1:2L;2:3B;a2Xb2Ec22d1Ye1Sf1Mg1Ch1Ai14j12k0Zl0Um0Gn05om2pZqat1KrXsKtCu7v5wal4yemTz3;a25imbabwe;es,lis and futu2Y;a3enezue32ietnam;nuatu,tican city;gTk6nited 4ruXs3zbeE; 2Ca,sr;arab emirat0Kkingdom,states3;! of am2Y;!raiV;a8haCimor les0Co7rinidad 5u3;nis0rk3valu;ey,me2Zs and caic1V;and t3t3;oba1L;go,kel10nga;iw2ji3nz2T;ki2V;aDcotl1eCi9lov8o6pa2Dri lanka,u5w3yr0;az3edAitzerl1;il1;d2riname;lomon1Xmal0uth 3;afr2KkMsud2;ak0en0;erra leoFn3;gapo1Yt maart3;en;negLrb0ychellZ;int 3moa,n marino,udi arab0;hele26luc0mart21;epublic of ir0Eom2Euss0w3;an27;a4eIhilippinUitcairn1Mo3uerto riN;l1rtugF;ki2Dl4nama,pua new0Vra3;gu7;au,esti3;ne;aBe9i7or3;folk1Ith4w3;ay; k3ern mariana1D;or0O;caragua,ger3ue;!ia;p3ther1Aw zeal1;al;mib0u3;ru;a7exi6icro0Bo3yanm06;ldova,n3roc5zambA;a4gol0t3;enegro,serrat;co;cAdagasc01l7r5urit4yot3;te;an0i16;shall0Xtin3;ique;a4div3i,ta;es;wi,ys0;ao,ed02;a6e5i3uxembourg;b3echtenste12thu1G;er0ya;ban0Isotho;os,tv0;azakh1Fe4iriba04o3uwait,yrgyz1F;rXsovo;eling0Knya;a3erG;ma16p2;c7nd6r4s3taly,vory coast;le of m2rael;a3el1;n,q;ia,oJ;el1;aiTon3ungary;dur0Ng kong;aBermany,ha0QibraltAre8u3;a6ern5inea3ya0P;! biss3;au;sey;deloupe,m,tema0Q;e3na0N;ce,nl1;ar;bUmb0;a7i6r3;ance,ench 3;guia0Epoly3;nes0;ji,nl1;lklandUroeU;ast tim7cu6gypt,l salv6ngl1quatorial4ritr5st3thiop0;on0; guin3;ea;ad3;or;enmark,jibou5ominica4r con3;go;!n C;ti;aBentral african Ah8o5roat0u4yprRzech3; 9ia;ba,racao;c4lo3morQngo brazzaville,okGsta r04te de ivoiL;mb0;osE;i3ristmasG;le,na;republic;m3naUpe verde,ymanA;bod0ero3;on;aGeDhut2o9r5u3;lgar0r3;kina faso,ma,undi;azil,itish 3unei;virgin3; is3;lands;liv0nai5snia and herzegoviHtswaHuvet3; isl1;and;re;l3n8rmuG;ar3gium,ize;us;h4ngladesh,rbad3;os;am4ra3;in;as;fghaGlDmBn6r4ustr3zerbaij2;al0ia;genti3men0uba;na;dorra,g5t3;arct7igua and barbu3;da;o3uil3;la;er3;ica;b3ger0;an0;ia;ni3;st2;an",FirstName:"true¦aTblair,cQdOfrancoZgabMhinaLilya,jHkClBm6ni4quinn,re3s0;h0umit,yd;ay,e0iloh;a,lby;g9ne;co,ko0;!s;a1el0ina,org6;!okuhF;ds,naia,r1tt0xiB;i,y;ion,lo;ashawn,eif,uca;a3e1ir0rM;an;lsFn0rry;dall,yat5;i,sD;a0essIie,ude;i1m0;ie,mG;me;ta;rie0y;le;arcy,ev0;an,on;as1h0;arl8eyenne;ey,sidy;drien,kira,l4nd1ubr0vi;ey;i,r0;a,e0;a,y;ex2f1o0;is;ie;ei,is",WeekDay:"true¦fri2mon2s1t0wednesd3;hurs1ues1;aturd1und1;!d0;ay0;!s",Month:"true¦dec0february,july,nov0octo1sept0;em0;ber",Date:"true¦ago,on4som4t1week0yesterd5; end,ends;mr1o0;d2morrow;!w;ed0;ay",Duration:"true¦centurAd8h7m5q4se3w1y0;ear8r8;eek0k7;!end,s;ason,c5;tr,uarter;i0onth3;llisecond2nute2;our1r1;ay0ecade0;!s;ies,y",FemaleName:"true¦0:J7;1:JB;2:IJ;3:IK;4:J1;5:IO;6:JS;7:JO;8:HB;9:JK;A:H4;B:I2;C:IT;D:JH;E:IX;F:BA;G:I4;aGTbFLcDRdD0eBMfB4gADh9Ti9Gj8Dk7Cl5Wm48n3Lo3Hp33qu32r29s15t0Eu0Cv02wVxiTyOzH;aLeIineb,oHsof3;e3Sf3la,ra;h2iKlIna,ynH;ab,ep;da,ma;da,h2iHra;nab;aKeJi0FolB7uIvH;et8onDP;i0na;le0sen3;el,gm3Hn,rGLs8W;aoHme0nyi;m5XyAD;aMendDZhiDGiH;dele9lJnH;if48niHo0;e,f47;a,helmi0lHma;a,ow;ka0nB;aNeKiHusa5;ck84kIl8oleAviH;anFenJ4;ky,toriBK;da,lA8rHs0;a,nHoniH9;a,iFR;leHnesH9;nILrH;i1y;g9rHs6xHA;su5te;aYeUhRiNoLrIuHy2;i,la;acJ3iHu0J;c3na,sH;hFta;nHr0F;iFya;aJffaEOnHs6;a,gtiH;ng;!nFSra;aIeHomasi0;a,l9Oo8Ares1;l3ndolwethu;g9Fo88rIssH;!a,ie;eHi,ri7;sa,za;bOlMmKnIrHs6tia0wa0;a60yn;iHya;a,ka,s6;arFe2iHm77ra;!ka;a,iH;a,t6;at6it6;a0Ecarlett,e0AhWiSkye,neza0oQri,tNuIyH;bIGlvi1;ha,mayIJniAsIzH;an3Net8ie,y;anHi7;!a,e,nH;aCe;aIeH;fan4l5Dphan6E;cI5r5;b3fiAAm0LnHphi1;d2ia,ja,ya;er2lJmon1nIobh8QtH;a,i;dy;lETv3;aMeIirHo0risFDy5;a,lDM;ba,e0i5lJrH;iHr6Jyl;!d8Ifa;ia,lDZ;hd,iMki2nJrIu0w0yH;la,ma,na;i,le9on,ron,yn;aIda,ia,nHon;a,on;!ya;k6mH;!aa;lJrItaye82vH;da,inj;e0ife;en1i0ma;anA9bLd5Oh1SiBkKlJmInd2rHs6vannaC;aCi0;ant6i2;lDOma,ome;ee0in8Tu2;in1ri0;a05eZhXiUoHuthDM;bScRghQl8LnPsJwIxH;anB3ie,y;an,e0;aIeHie,lD;ann7ll1marDGtA;!lHnn1;iHyn;e,nH;a,dF;da,i,na;ayy8G;hel67io;bDRerAyn;a,cIkHmas,nFta,ya;ki,o;h8Xki;ea,iannGMoH;da,n1P;an0bJemFgi0iInHta,y0;a8Bee;han86na;a,eH;cHkaC;a,ca;bi0chIe,i0mo0nHquETy0;di,ia;aERelHiB;!e,le;een4ia0;aPeOhMiLoJrHute6A;iHudenCV;scil3LyamvaB;lHrt3;i0ly;a,paluk;ilome0oebe,ylH;is,lis;ggy,nelope,r5t2;ige,m0VnKo5rvaDMtIulH;a,et8in1;ricHt4T;a,e,ia;do2i07;ctav3dIfD3is6ksa0lHphD3umC5yunbileg;a,ga,iv3;eHvAF;l3t8;aWeUiMoIurHy5;!ay,ul;a,eJor,rIuH;f,r;aCeEma;ll1mi;aNcLhariBQkKlaJna,sHta,vi;anHha;ur;!y;a,iDZki;hoGk9YolH;a,e4P;!mh;hir,lHna,risDEsreE;!a,lBV;asuMdLh3i6Dl5nKomi7rgEVtH;aHhal4;lHs6;i1ya;cy,et8;e9iF0ya;nngu2X;a0Ackenz4e02iMoJrignayani,uriDJyH;a,rH;a,iOlNna,tG;bi0i2llBJnH;a,iH;ca,ka,qD9;a,cUdo4ZkaTlOmi,nMrItzi,yH;ar;aJiIlH;anET;am;!l,nB;dy,eHh,n4;nhGrva;aKdJe0iCUlH;iHy;cent,e;red;!gros;!e5;ae5hH;ae5el3Z;ag5DgNi,lKrH;edi7AiIjem,on,yH;em,l;em,sCG;an4iHliCF;nHsCJ;a,da;!an,han;b09cASd07e,g05ha,i04ja,l02n00rLsoum5YtKuIv84xBKyHz4;bell,ra,soBB;d7rH;a,eE;h8Gild1t4;a,cUgQiKjor4l7Un4s6tJwa,yH;!aHbe6Xja9lAE;m,nBL;a,ha,in1;!aJbCGeIja,lDna,sHt63;!a,ol,sa;!l1D;!h,mInH;!a,e,n1;!awit,i;arJeIie,oHr48ueri8;!t;!ry;et46i3B;el4Xi7Cy;dHon,ue5;akranAy;ak,en,iHlo3S;a,ka,nB;a,re,s4te;daHg4;!l3E;alDd4elHge,isDJon0;ei9in1yn;el,le;a0Ne0CiXoQuLyH;d3la,nH;!a,dIe2OnHsCT;!a,e2N;a,sCR;aD4cJel0Pis1lIna,pHz;e,iA;a,u,wa;iHy;a0Se,ja,l2NnB;is,l1UrItt1LuHvel4;el5is1;aKeIi7na,rH;aADi7;lHn1tA;ei;!in1;aTbb9HdSepa,lNnKsJvIzH;!a,be5Ret8z4;!ia;a,et8;!a,dH;a,sHy;ay,ey,i,y;a,iJja,lH;iHy;aA8e;!aH;!nF;ia,ya;!nH;!a,ne;aPda,e0iNjYla,nMoKsJtHx93y5;iHt4;c3t3;e2PlCO;la,nHra;a,ie,o2;a,or1;a,gh,laH;!ni;!h,nH;a,d2e,n5V;cOdon9DiNkes6mi9Gna,rMtJurIvHxmi,y5;ern1in3;a,e5Aie,yn;as6iIoH;nya,ya;fa,s6;a,isA9;a,la;ey,ie,y;a04eZhXiOlASoNrJyH;lHra;a,ee,ie;istHy6I;a,en,iIyH;!na;!e,n5F;nul,ri,urtnB8;aOerNlB7mJrHzzy;a,stH;en,in;!berlImernH;aq;eHi,y;e,y;a,stE;!na,ra;aHei2ongordzol;dij1w5;el7UiKjsi,lJnIrH;a,i,ri;d2na,za;ey,i,lBLs4y;ra,s6;biAcARdiat7MeBAiSlQmPnyakuma1DrNss6NtKviAyH;!e,lH;a,eH;e,i8T;!a6HeIhHi4TlDri0y;ar8Her8Hie,leErBAy;!lyn8Ori0;a,en,iHl5Xoli0yn;!ma,nFs95;a5il1;ei8Mi,lH;e,ie;a,tl6O;a0AeZiWoOuH;anMdLlHst88;es,iH;a8NeHs8X;!n9tH;!a,te;e5Mi3My;a,iA;!anNcelDdMelGhan7VleLni,sIva0yH;a,ce;eHie;fHlDph7Y;a,in1;en,n1;i7y;!a,e,n45;lHng;!i1DlH;!i1C;anNle0nKrJsH;i8JsH;!e,i8I;i,ri;!a,elGif2CnH;a,et8iHy;!e,f2A;a,eJiInH;a,eIiH;e,n1;!t8;cMda,mi,nIque4YsminFvie2y9zH;min7;a7eIiH;ce,e,n1s;!lHs82t0F;e,le;inIk6HlDquelH;in1yn;da,ta;da,lRmPnOo0rNsIvaHwo0zaro;!a0lu,na;aJiIlaHob89;!n9R;do2;belHdo2;!a,e,l3B;a7Ben1i0ma;di2es,gr72ji;a9elBogH;en1;a,e9iHo0se;a0na;aSeOiJoHus7Kyacin2C;da,ll4rten24snH;a,i9U;lImaH;ri;aIdHlaI;a,egard;ry;ath1BiJlInrietArmi9sH;sa,t1A;en2Uga,mi;di;bi2Fil8MlNnMrJsItHwa,yl8M;i5Tt4;n60ti;iHmo51ri53;etH;!te;aCnaC;a,ey,l4;a02eWiRlPoNrKunJwH;enHyne1R;!dolD;ay,el;acieIetHiselB;a,chE;!la;ld1CogooH;sh;adys,enHor3yn2K;a,da,na;aKgi,lIna,ov8EselHta;a,e,le;da,liH;an;!n0;mLnJorgIrH;ald5Si,m3Etrud7;et8i4X;a,eHna;s29vieve;ma;bIle,mHrnet,yG;al5Si5;iIrielH;a,l1;!ja;aTeQiPlorOoz3rH;anJeIiH;da,eB;da,ja;!cH;esIiHoi0P;n1s66;!ca;a,enc3;en,o0;lIn0rnH;anB;ec3ic3;jr,nArKtHy7;emIiHma,oumaA;ha,ma,n;eh;ah,iBrah,za0;cr4Rd0Re0Qi0Pk0Ol07mXn54rUsOtNuMvHwa;aKelIiH;!e,ta;inFyn;!a;!ngel4V;geni1ni47;h5Yien9ta;mLperanKtH;eIhHrel5;er;l31r7;za;a,eralB;iHma,ne4Lyn;cHka,n;a,ka;aPeNiKmH;aHe21ie,y;!li9nuH;elG;lHn1;e7iHy;a,e,ja;lHrald;da,y;!nue5;aWeUiNlMma,no2oKsJvH;a,iH;na,ra;a,ie;iHuiH;se;a,en,ie,y;a0c3da,e,f,nMsJzaH;!betHveA;e,h;aHe,ka;!beH;th;!a,or;anor,nH;!a,i;!in1na;ate1Rta;leEs6;vi;eIiHna,wi0;e,th;l,n;aYeMh3iLjeneKoH;lor5Vminiq4Ln3FrHtt4;a,eEis,la,othHthy;ea,y;ba;an09naCon9ya;anQbPde,eOiMlJmetr3nHsir5M;a,iH;ce,se;a,iIla,orHphi9;es,is;a,l6F;dHrdH;re;!d5Ena;!b2ForaCraC;a,d2nH;!a,e;hl3i0l0GmNnLphn1rIvi1WyH;le,na;a,by,cIia,lH;a,en1;ey,ie;a,et8iH;!ca,el1Aka,z;arHia;is;a0Re0Nh04i02lUoJristIynH;di,th3;al,i0;lPnMrIurH;tn1D;aJd2OiHn2Ori9;!nH;a,e,n1;!l4;cepci5Cn4sH;tanHuelo;ce,za;eHleE;en,t8;aJeoIotH;il54;!pat2;ir7rJudH;et8iH;a,ne;a,e,iH;ce,sZ;a2er2ndH;i,y;aReNloe,rH;isJyH;stH;al;sy,tH;a1Sen,iHy;an1e,n1;deJlseIrH;!i7yl;a,y;li9;nMrH;isKlImH;ai9;a,eHot8;n1t8;!sa;d2elGtH;al,elG;cIlH;es8i47;el3ilH;e,ia,y;itlYlXmilWndVrMsKtHy5;aIeIhHri0;er1IleErDy;ri0;a38sH;a37ie;a,iOlLmeJolIrH;ie,ol;!e,in1yn;lHn;!a,la;a,eIie,otHy;a,ta;ne,y;na,s1X;a0Ii0I;a,e,l1;isAl4;in,yn;a0Ke02iZlXoUrH;andi7eRiJoIyH;an0nn;nwDoke;an3HdgMgiLtH;n31tH;!aInH;ey,i,y;ny;d,t8;etH;!t7;an0e,nH;da,na;bbi7glarIlo07nH;iAn4;ka;ancHythe;a,he;an1Clja0nHsm3M;iAtH;ou;aWcVlinUniArPssOtJulaCvH;!erlH;ey,y;hJsy,tH;e,iHy7;e,na;!anH;ie,y;!ie;nItHyl;ha,ie;adIiH;ce;et8i9;ay,da;ca,ky;!triH;ce,z;rbJyaH;rmH;aa;a2o2ra;a2Ub2Od25g21i1Sj5l18m0Zn0Boi,r06sWtVuPvOwa,yIzH;ra,u0;aKes6gJlIn,seH;!l;in;un;!nH;a,na;a,i2K;drLguJrIsteH;ja;el3;stH;in1;a,ey,i,y;aahua,he0;hIi2Gja,miAs2DtrH;id;aMlIraqHt21;at;eIi7yH;!n;e,iHy;gh;!nH;ti;iJleIo6piA;ta;en,n1t8;aHelG;!n1J;a01dje5eZgViTjRnKohito,toHya;inet8nH;el5ia;te;!aKeIiHmJ;e,ka;!mHtt7;ar4;!belIliHmU;sa;!l1;a,eliH;ca;ka,sHta;a,sa;elHie;a,iH;a,ca,n1qH;ue;!tH;a,te;!bImHstasiMya;ar3;el;aLberKeliJiHy;e,l3naH;!ta;a,ja;!ly;hGiIl3nB;da;a,ra;le;aWba,ePiMlKthJyH;a,c3sH;a,on,sa;ea;iHys0N;e,s0M;a,cIn1sHza;a,e,ha,on,sa;e,ia,ja;c3is6jaKksaKna,sJxH;aHia;!nd2;ia,saH;nd2;ra;ia;i0nIyH;ah,na;a,is,naCoud;la;c6da,leEmNnLsH;haClH;inHyY;g,n;!h;a,o,slH;ey;ee;en;at6g4nIusH;ti0;es;ie;aWdiTelMrH;eJiH;anMenH;a,e,ne;an0;na;!aLeKiIyH;nn;a,n1;a,e;!ne;!iH;de;e,lDsH;on;yn;!lH;i9yn;ne;aKbIiHrL;!e,gaK;ey,i7y;!e;gaH;il;dKliyJradhIs6;ha;ya;ah;a,ya",Honorific:"true¦director1field marsh2lieutenant1rear0sergeant major,vice0; admir1; gener0;al","Adj|Gerund":"true¦0:3F;1:3H;2:31;3:2X;4:35;5:33;6:3C;7:2Z;8:36;9:29;a33b2Tc2Bd1Te1If19g12h0Zi0Rl0Nm0Gnu0Fo0Ap04rYsKtEuBvAw1Ayiel3;ar6e08;nBpA;l1Rs0B;fol3n1Zsett2;aEeDhrBi4ouc7rAwis0;e0Bif2oub2us0yi1;ea1SiA;l2vi1;l2mp0rr1J;nt1Vxi1;aMcreec7enten2NhLkyrocke0lo0Vmi2oJpHtDuBweA;e0Ul2;pp2ArA;gi1pri5roun3;aBea8iAri2Hun9;mula0r4;gge4rA;t2vi1;ark2eAraw2;e3llb2F;aAot7;ki1ri1;i9oc29;dYtisf6;aEeBive0oAus7;a4l2;assu4defi9fres7ig9juve07mai9s0vAwar3;ea2italiAol1G;si1zi1;gi1ll6mb2vi1;a6eDier23lun1VrAun2C;eBoA;mi5vo1Z;ce3s5vai2;n3rpleA;xi1;ffCpWutBverAwi1;arc7lap04p0Pri3whel8;goi1l6st1J;en3sA;et0;m2Jrtu4;aEeDiCoBuAyst0L;mb2;t1Jvi1;s5tiga0;an1Rl0n3smeri26;dAtu4;de9;aCeaBiAo0U;fesa0Tvi1;di1ni1;c1Fg19s0;llumiGmFnArri0R;cDfurHsCtBviA;go23ti1;e1Oimi21oxica0rig0V;pi4ul0;orpo20r0K;po5;na0;eaBorr02umilA;ia0;li1rtwar8;lFrA;atiDipCoBuelA;i1li1;undbrea10wi1;pi1;f6ng;a4ea8;a3etc7it0lEoCrBulfA;il2;ee1FighXust1L;rAun3;ebo3thco8;aCoA;a0wA;e4i1;mi1tte4;lectrJmHnExA;aCci0hBis0pA;an3lo3;aOila1B;c0spe1A;ab2coura0CdBergi13ga0Clive9ric7s02tA;hral2i0J;ea4u4;barras5er09pA;owe4;if6;aQeIiBrA;if0;sAzz6;aEgDhearCsen0tA;rAur11;ac0es5;te9;us0;ppoin0r8;biliGcDfi9gra3ligh0mBpres5sAvasG;erE;an3ea9orA;ali0L;a6eiBli9rA;ea5;vi1;ta0;maPri1s7un0zz2;aPhMlo5oAripp2ut0;mGnArrespon3;cer9fDspi4tA;inBrA;as0ibu0ol2;ui1;lic0u5;ni1;fDmCpA;eAromi5;l2ti1;an3;or0;aAil2;llenAnAr8;gi1;l8ptAri1;iva0;aff2eGin3lFoDrBuA;d3st2;eathtaAui5;ki1;gg2i2o8ri1unA;ci1;in3;co8wiA;lAtc7;de4;bsorVcOgonMlJmHnno6ppea2rFsA;pi4su4toA;nBun3;di1;is7;hi1;res0;li1;aFu5;si1;ar8lu4;ri1;mi1;iAzi1;zi1;cAhi1;eleDomA;moBpan6;yi1;da0;ra0;ti1;bi1;ng",Comparable:"true¦0:3C;1:3Q;2:3F;a3Tb3Cc33d2Te2Mf2Ag1Wh1Li1Fj1Ek1Bl13m0Xn0So0Rp0Iqu0Gr07sHtCug0vAw4y3za0Q;el10ouN;ary,e6hi5i3ry;ck0Cde,l3n1ry,se;d,y;ny,te;a3i3R;k,ry;a3erda2ulgar;gue,in,st;a6en2Xhi5i4ouZr3;anqu2Cen1ue;dy,g36me0ny;ck,rs28;ll,me,rt,wd3I;aRcaPeOhMiLkin0BlImGoEpDt6u4w3;eet,ift;b3dd0Wperfi21rre28;sta26t21;a8e7iff,r4u3;pUr1;a4ict,o3;ng;ig2Vn0N;a1ep,rn;le,rk,te0;e1Si2Vright0;ci1Yft,l3on,re;emn,id;a3el0;ll,rt;e4i3y;g2Mm0Z;ek,nd2T;ck24l0mp1L;a3iRrill,y;dy,l01rp;ve0Jxy;n1Jr3;ce,y;d,fe,int0l1Hv0V;a8e6i5o3ude;mantic,o19sy,u3;gh;pe,t1P;a3d,mo0A;dy,l;gg4iFndom,p3re,w;id;ed;ai2i3;ck,et;hoAi1Fl9o8r5u3;ny,r3;e,p11;egna2ic4o3;fouSud;ey,k0;liXor;ain,easa2;ny;dd,i0ld,ranL;aive,e5i4o3u14;b0Sisy,rm0Ysy;bb0ce,mb0R;a3r1w;r,t;ad,e5ild,o4u3;nda12te;ist,o1;a4ek,l3;low;s0ty;a8e7i6o3ucky;f0Jn4o15u3ve0w10y0N;d,sy;e0g;ke0l,mp,tt0Eve0;e1Qwd;me,r3te;ge;e4i3;nd;en;ol0ui19;cy,ll,n3;secu6t3;e3ima4;llege2rmedia3;te;re;aAe7i6o5u3;ge,m3ng1C;bYid;me0t;gh,l0;a3fXsita2;dy,rWv3;en0y;nd13ppy,r3;d3sh;!y;aFenEhCiBlAoofy,r3;a8e6i5o3ue0Z;o3ss;vy;m,s0;at,e3y;dy,n;nd,y;ad,ib,ooD;a2d1;a3o3;st0;tDuiS;u1y;aCeebBi9l8o6r5u3;ll,n3r0N;!ny;aCesh,iend0;a3nd,rmD;my;at,ir7;erce,nan3;ci9;le;r,ul3;ty;a6erie,sse4v3xtre0B;il;nti3;al;r4s3;tern,y;ly,th0;appZe9i5ru4u3;mb;nk;r5vi4z3;zy;ne;e,ty;a3ep,n9;d3f,r;!ly;agey,h8l7o5r4u3;dd0r0te;isp,uel;ar3ld,mmon,st0ward0zy;se;evKou1;e3il0;ap,e3;sy;aHiFlCoAr5u3;ff,r0sy;ly;a6i3oad;g4llia2;nt;ht;sh,ve;ld,un3;cy;a4o3ue;nd,o1;ck,nd;g,tt3;er;d,ld,w1;dy;bsu6ng5we3;so3;me;ry;rd",Adverb:"true¦a08b05d00eYfSheQinPjustOkinda,likewiZmMnJoEpCquite,r9s5t2u0very,well;ltima01p0; to,wards5;h1iny bit,o0wiO;o,t6;en,us;eldom,o0uch;!me1rt0; of;how,times,w0C;a1e0;alS;ndomRth05;ar excellenEer0oint blank; Lhaps;f3n0utright;ce0ly;! 0;ag05moX; courGten;ewJo0; longWt 0;onHwithstand9;aybe,eanwhiNore0;!ovT;! aboX;deed,steY;lla,n0;ce;or3u0;ck1l9rther0;!moK;ing; 0evK;exampCgood,suH;n mas0vI;se;e0irect2; 2fini0;te0;ly;juAtrop;ackward,y 0;far,no0; means,w; GbroFd nauseam,gEl7ny5part,s4t 2w0;ay,hi0;le;be7l0mo7wor7;arge,ea6; soon,i4;mo0way;re;l 3mo2ongsi1ready,so,togeth0ways;er;de;st;b1t0;hat;ut;ain;ad;lot,posteriori",Conjunction:"true¦aXbTcReNhowMiEjust00noBo9p8supposing,t5wh0yet;e1il0o3;e,st;n1re0thN; if,by,vM;evL;h0il,o;erefOo0;!uU;lus,rovided th9;r0therwiM;! not; mattEr,w0;! 0;since,th4w7;f4n0; 0asmuch;as mIcaForder t0;h0o;at;! 0;only,t0w0;hen;!ev3;ith2ven0;! 0;if,tB;er;o0uz;s,z;e0ut,y the time;cau1f0;ore;se;lt3nd,s 0;far1if,m0soon1t2;uch0; as;hou0;gh",Currency:"true¦$,aud,bQcOdJeurIfHgbp,hkd,iGjpy,kElDp8r7s3usd,x2y1z0¢,£,¥,ден,лв,руб,฿,₡,₨,€,₭,﷼;lotyQł;en,uanP;af,of;h0t5;e0il5;k0q0;elK;oubleJp,upeeJ;e2ound st0;er0;lingG;n0soF;ceEnies;empi7i7;n,r0wanzaCyatC;!onaBw;ls,nr;ori7ranc9;!os;en3i2kk,o0;b0ll2;ra5;me4n0rham4;ar3;e0ny;nt1;aht,itcoin0;!s",Determiner:"true¦aBboth,d9e6few,le5mu8neiDplenty,s4th2various,wh0;at0ich0;evC;a0e4is,ose;!t;everal,ome;!ast,s;a1l0very;!se;ch;e0u;!s;!n0;!o0y;th0;er","Adj|Present":"true¦a07b04cVdQeNfJhollIidRlEmCnarrIoBp9qua8r7s3t2uttFw0;aKet,ro0;ng,u08;endChin;e2hort,l1mooth,our,pa9tray,u0;re,speU;i2ow;cu6da02leSpaN;eplica01i02;ck;aHerfePr0;eseUime,omV;bscu1pen,wn;atu0e3odeH;re;a2e1ive,ow0;er;an;st,y;ow;a2i1oul,r0;ee,inge;rm;iIke,ncy,st;l1mpty,x0;emHpress;abo4ic7;amp,e2i1oub0ry,ull;le;ffu9re6;fu8libe0;raE;alm,l5o0;mpleCn3ol,rr1unterfe0;it;e0u7;ct;juga8sum7;ea1o0;se;n,r;ankru1lu0;nt;pt;li2pproxi0rticula1;ma0;te;ght","Person|Adj":"true¦b3du2earnest,frank,mi2r0san1woo1;an0ich,u1;dy;sty;ella,rown",Modal:"true¦c5lets,m4ought3sh1w0;ill,o5;a0o4;ll,nt;! to,a;ight,ust;an,o0;uld",Verb:"true¦born,cannot,gonna,has,keep tabs,msg","Person|Verb":"true¦b8ch7dr6foster,gra5ja9lan4ma2ni9ollie,p1rob,s0wade;kip,pike,t5ue;at,eg,ier2;ck,r0;k,shal;ce;ce,nt;ew;ase,u1;iff,l1ob,u0;ck;aze,ossom","Person|Date":"true¦a2j0sep;an0une;!uary;p0ugust,v0;ril"},TO="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").reduce((function(e,t,n){return e[t]=n,e}),{}),IO=function(e){if(void 0!==TO[e])return TO[e];let t=0,n=1,r=36,i=1;for(;n<e.length;t+=r,n++,r*=36);for(let n=e.length-1;n>=0;n--,i*=36){let r=e.charCodeAt(n)-48;r>10&&(r-=7),t+=r*i}return t},EO=function(e,t,n){const r=IO(t);return r<e.symCount?e.syms[r]:n+r+1-e.symCount},xO=["Possessive","Pronoun"],CO={a:[[/(antenn|formul|nebul|vertebr|vit)a$/i,"$1ae"],[/ia$/i,"ia"]],e:[[/(kn|l|w)ife$/i,"$1ives"],[/(hive)$/i,"$1s"],[/([m|l])ouse$/i,"$1ice"],[/([m|l])ice$/i,"$1ice"]],f:[[/^(dwar|handkerchie|hoo|scar|whar)f$/i,"$1ves"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)f$/i,"$1ves"]],i:[[/(octop|vir)i$/i,"$1i"]],m:[[/([ti])um$/i,"$1a"]],n:[[/^(oxen)$/i,"$1"]],o:[[/(al|ad|at|er|et|ed)o$/i,"$1oes"]],s:[[/(ax|test)is$/i,"$1es"],[/(alias|status)$/i,"$1es"],[/sis$/i,"ses"],[/(bu)s$/i,"$1ses"],[/(sis)$/i,"ses"],[/^(?!talis|.*hu)(.*)man$/i,"$1men"],[/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,"$1i"]],x:[[/(matr|vert|ind|cort)(ix|ex)$/i,"$1ices"],[/^(ox)$/i,"$1en"]],y:[[/([^aeiouy]|qu)y$/i,"$1ies"]],z:[[/(quiz)$/i,"$1zes"]]},OO=/([xsz]|ch|sh)$/,SO=function(e="",t){let{irregularPlurals:n,uncountable:r}=t.two;if(r.hasOwnProperty(e))return e;if(n.hasOwnProperty(e))return n[e];let i=function(e){let t=e[e.length-1];if(!0===CO.hasOwnProperty(t))for(let n=0;n<CO[t].length;n+=1){let r=CO[t][n][0];if(!0===r.test(e))return e.replace(r,CO[t][n][1])}return null}(e);return null!==i?i:OO.test(e)?e+"es":e+"s"},NO=/\|/;let jO={"20th century fox":"Organization","7 eleven":"Organization","motel 6":"Organization",g8:"Organization",vh1:"Organization","76ers":"SportsTeam","49ers":"SportsTeam",q1:"Date",q2:"Date",q3:"Date",q4:"Date",km2:"Unit",m2:"Unit",dm2:"Unit",cm2:"Unit",mm2:"Unit",mile2:"Unit",in2:"Unit",yd2:"Unit",ft2:"Unit",m3:"Unit",dm3:"Unit",cm3:"Unit",in3:"Unit",ft3:"Unit",yd3:"Unit","at&t":"Organization","black & decker":"Organization","h & m":"Organization","johnson & johnson":"Organization","procter & gamble":"Organization","ben & jerry's":"Organization","&":"Conjunction",i:["Pronoun","Singular"],he:["Pronoun","Singular"],she:["Pronoun","Singular"],it:["Pronoun","Singular"],they:["Pronoun","Plural"],we:["Pronoun","Plural"],was:["Copula","PastTense"],is:["Copula","PresentTense"],are:["Copula","PresentTense"],am:["Copula","PresentTense"],were:["Copula","PastTense"],her:xO,his:xO,hers:xO,their:xO,theirs:xO,themselves:xO,your:xO,our:xO,ours:xO,my:xO,its:xO,vs:["Conjunction","Abbreviation"],if:["Condition","Preposition"],closer:"Comparative",closest:"Superlative",much:"Adverb",may:"Modal",babysat:"PastTense",blew:"PastTense",drank:"PastTense",drove:"PastTense",forgave:"PastTense",skiied:"PastTense",spilt:"PastTense",stung:"PastTense",swam:"PastTense",swung:"PastTense",guaranteed:"PastTense",shrunk:"PastTense",nears:"PresentTense",nearing:"Gerund",neared:"PastTense",no:["Negative","Expression"]},DO={};const RO={two:{irregularPlurals:AO,uncountable:{}}};Object.keys(PO).forEach((e=>{let t=function(e){if(!e)return{};const t=e.split("|").reduce(((e,t)=>{const n=t.split("¦");return e[n[0]]=n[1],e}),{}),n={};return Object.keys(t).forEach((function(e){const r=function(e){const t={nodes:e.split(";"),syms:[],symCount:0};return e.match(":")&&function(e){const t=new RegExp("([0-9A-Z]+):([0-9A-Z]+)");for(let n=0;n<e.nodes.length;n++){const r=t.exec(e.nodes[n]);if(!r){e.symCount=n;break}e.syms[IO(r[1])]=IO(r[2])}e.nodes=e.nodes.slice(e.symCount,e.nodes.length)}(t),function(e){const t=[],n=(r,i)=>{let a=e.nodes[r];"!"===a[0]&&(t.push(i),a=a.slice(1));const s=a.split(/([A-Z0-9,]+)/g);for(let a=0;a<s.length;a+=2){const o=s[a],l=s[a+1];if(!o)continue;const u=i+o;if(","===l||void 0===l){t.push(u);continue}const c=EO(e,l,r);n(c,u)}};return n(0,""),t}(t)}(t[e]);"true"===e&&(e=!0);for(let t=0;t<r.length;t++){const i=r[t];!0===n.hasOwnProperty(i)?!1===Array.isArray(n[i])?n[i]=[n[i],e]:n[i].push(e):n[i]=e}})),n}(PO[e]);NO.test(e)?Object.keys(t).forEach((t=>{if(DO[t]=e,"Noun|Verb"===e){let e=SO(t,RO);DO[e]="Plural|Verb"}})):Object.keys(t).forEach((t=>{jO[t]=e}))})),[":(",":)",":P",":p",":O",";(",";)",";P",";p",";O",":3",":|",":/",":\\",":$",":*",":@",":-(",":-)",":-P",":-p",":-O",":-3",":-|",":-/",":-\\",":-$",":-*",":-@",":^(",":^)",":^P",":^p",":^O",":^3",":^|",":^/",":^\\",":^$",":^*",":^@","):","(:","$:","*:",")-:","(-:","$-:","*-:",")^:","(^:","$^:","*^:","<3","</3","<\\3","=("].forEach((e=>jO[e]="Emoticon")),delete jO[""],delete jO.null,delete jO[" "];const LO="Singular",MO={beforeTags:{Determiner:LO,Possessive:LO,Acronym:LO,Noun:LO,Adjective:LO,PresentTense:LO,Gerund:LO,PastTense:LO,Infinitive:LO,Date:LO,Ordinal:LO,Demonym:LO},afterTags:{Value:LO,Modal:LO,Copula:LO,PresentTense:LO,PastTense:LO,Demonym:LO,Actor:LO},beforeWords:{the:LO,with:LO,without:LO,of:LO,for:LO,any:LO,all:LO,on:LO,cut:LO,cuts:LO,increase:LO,decrease:LO,raise:LO,drop:LO,save:LO,saved:LO,saves:LO,make:LO,makes:LO,made:LO,minus:LO,plus:LO,than:LO,another:LO,versus:LO,neither:LO,about:LO,favorite:LO,best:LO,daily:LO,weekly:LO,linear:LO,binary:LO,mobile:LO,lexical:LO,technical:LO,computer:LO,scientific:LO,security:LO,government:LO,popular:LO,formal:LO,no:LO,more:LO,one:LO,let:LO,her:LO,his:LO,their:LO,our:LO,us:LO,sheer:LO,monthly:LO,yearly:LO,current:LO,previous:LO,upcoming:LO,last:LO,next:LO,main:LO,initial:LO,final:LO,beginning:LO,end:LO,top:LO,bottom:LO,future:LO,past:LO,major:LO,minor:LO,side:LO,central:LO,peripheral:LO,public:LO,private:LO},afterWords:{of:LO,system:LO,aid:LO,method:LO,utility:LO,tool:LO,reform:LO,therapy:LO,philosophy:LO,room:LO,authority:LO,says:LO,said:LO,wants:LO,wanted:LO,is:LO,did:LO,do:LO,can:LO,wise:LO}},$O="Infinitive",FO={beforeTags:{Modal:$O,Adverb:$O,Negative:$O,Plural:$O},afterTags:{Determiner:$O,Adverb:$O,Possessive:$O,Reflexive:$O,Preposition:$O,Cardinal:$O,Comparative:$O,Superlative:$O},beforeWords:{i:$O,we:$O,you:$O,they:$O,to:$O,please:$O,will:$O,have:$O,had:$O,would:$O,could:$O,should:$O,do:$O,did:$O,does:$O,can:$O,must:$O,us:$O,me:$O,let:$O,even:$O,when:$O,help:$O,he:$O,she:$O,it:$O,being:$O,bi:$O,co:$O,contra:$O,de:$O,inter:$O,intra:$O,mis:$O,pre:$O,out:$O,counter:$O,nobody:$O,somebody:$O,anybody:$O,everybody:$O},afterWords:{the:$O,me:$O,you:$O,him:$O,us:$O,her:$O,his:$O,them:$O,they:$O,it:$O,himself:$O,herself:$O,itself:$O,myself:$O,ourselves:$O,themselves:$O,something:$O,anything:$O,a:$O,an:$O,up:$O,down:$O,by:$O,out:$O,off:$O,under:$O,what:$O,all:$O,to:$O,because:$O,although:$O,how:$O,otherwise:$O,together:$O,though:$O,into:$O,yet:$O,more:$O,here:$O,there:$O,away:$O}},VO={beforeTags:Object.assign({},FO.beforeTags,MO.beforeTags,{}),afterTags:Object.assign({},FO.afterTags,MO.afterTags,{}),beforeWords:Object.assign({},FO.beforeWords,MO.beforeWords,{}),afterWords:Object.assign({},FO.afterWords,MO.afterWords,{})},zO="Adjective",BO={beforeTags:{Determiner:zO,Possessive:zO,Hyphenated:zO},afterTags:{Adjective:zO},beforeWords:{seem:zO,seemed:zO,seems:zO,feel:zO,feels:zO,felt:zO,stay:zO,appear:zO,appears:zO,appeared:zO,also:zO,over:zO,under:zO,too:zO,it:zO,but:zO,still:zO,really:zO,quite:zO,well:zO,very:zO,truly:zO,how:zO,deeply:zO,hella:zO,profoundly:zO,extremely:zO,so:zO,badly:zO,mostly:zO,totally:zO,awfully:zO,rather:zO,nothing:zO,something:zO,anything:zO,not:zO,me:zO,is:zO,face:zO,faces:zO,faced:zO,look:zO,looks:zO,looked:zO,reveal:zO,reveals:zO,revealed:zO,sound:zO,sounded:zO,sounds:zO,remains:zO,remained:zO,prove:zO,proves:zO,proved:zO,becomes:zO,stays:zO,tastes:zO,taste:zO,smells:zO,smell:zO,gets:zO,grows:zO,as:zO,rings:zO,radiates:zO,conveys:zO,convey:zO,conveyed:zO,of:zO},afterWords:{too:zO,also:zO,or:zO,enough:zO,as:zO}},UO="Gerund",HO={beforeTags:{Adverb:UO,Preposition:UO,Conjunction:UO},afterTags:{Adverb:UO,Possessive:UO,Person:UO,Pronoun:UO,Determiner:UO,Copula:UO,Preposition:UO,Conjunction:UO,Comparative:UO},beforeWords:{been:UO,keep:UO,continue:UO,stop:UO,am:UO,be:UO,me:UO,began:UO,start:UO,starts:UO,started:UO,stops:UO,stopped:UO,help:UO,helps:UO,avoid:UO,avoids:UO,love:UO,loves:UO,loved:UO,hate:UO,hates:UO,hated:UO},afterWords:{you:UO,me:UO,her:UO,him:UO,his:UO,them:UO,their:UO,it:UO,this:UO,there:UO,on:UO,about:UO,for:UO,up:UO,down:UO}},GO="Gerund",qO="Adjective",KO={beforeTags:Object.assign({},BO.beforeTags,HO.beforeTags,{Imperative:GO,Infinitive:qO,Plural:GO}),afterTags:Object.assign({},BO.afterTags,HO.afterTags,{Noun:qO}),beforeWords:Object.assign({},BO.beforeWords,HO.beforeWords,{is:qO,are:GO,was:qO,of:qO,suggest:GO,suggests:GO,suggested:GO,recommend:GO,recommends:GO,recommended:GO,imagine:GO,imagines:GO,imagined:GO,consider:GO,considered:GO,considering:GO,resist:GO,resists:GO,resisted:GO,avoid:GO,avoided:GO,avoiding:GO,except:qO,accept:qO,assess:GO,explore:GO,fear:GO,fears:GO,appreciate:GO,question:GO,help:GO,embrace:GO,with:qO}),afterWords:Object.assign({},BO.afterWords,HO.afterWords,{to:GO,not:GO,the:GO})},WO={beforeTags:Object.assign({},BO.beforeTags,MO.beforeTags,{Determiner:void 0,Cardinal:"Noun",PhrasalVerb:"Adjective"}),afterTags:Object.assign({},BO.afterTags,MO.afterTags,{}),beforeWords:Object.assign({},BO.beforeWords,MO.beforeWords,{are:"Adjective",is:"Adjective",was:"Adjective",be:"Adjective",off:"Adjective",out:"Adjective"}),afterWords:Object.assign({},BO.afterWords,MO.afterWords)};let JO="PastTense",ZO="Adjective";const QO={beforeTags:{Adverb:JO,Pronoun:JO,ProperNoun:JO,Auxiliary:JO,Noun:JO},afterTags:{Possessive:JO,Pronoun:JO,Determiner:JO,Adverb:JO,Comparative:JO,Date:JO,Gerund:JO},beforeWords:{be:JO,who:JO,get:ZO,had:JO,has:JO,have:JO,been:JO,it:JO,as:JO,for:ZO,more:ZO,always:ZO},afterWords:{by:JO,back:JO,out:JO,in:JO,up:JO,down:JO,before:JO,after:JO,for:JO,the:JO,with:JO,as:JO,on:JO,at:JO,between:JO,to:JO,into:JO,us:JO,them:JO,his:JO,her:JO,their:JO,our:JO,me:JO,about:ZO}},XO={beforeTags:Object.assign({},BO.beforeTags,QO.beforeTags),afterTags:Object.assign({},BO.afterTags,QO.afterTags),beforeWords:Object.assign({},BO.beforeWords,QO.beforeWords),afterWords:Object.assign({},BO.afterWords,QO.afterWords)},YO={beforeTags:Object.assign({},BO.beforeTags,FO.beforeTags,{Adverb:void 0,Negative:void 0}),afterTags:Object.assign({},BO.afterTags,FO.afterTags,{Noun:"Adjective",Conjunction:void 0}),beforeWords:Object.assign({},BO.beforeWords,FO.beforeWords,{have:void 0,had:void 0,not:void 0,went:"Adjective",goes:"Adjective",got:"Adjective",be:"Adjective"}),afterWords:Object.assign({},BO.afterWords,FO.afterWords,{to:void 0,as:"Adjective"})},eS={beforeTags:Object.assign({},HO.beforeTags,MO.beforeTags,{Copula:"Gerund",PastTense:"Gerund",PresentTense:"Gerund",Infinitive:"Gerund"}),afterTags:Object.assign({},HO.afterTags,MO.afterTags,{Value:"Gerund"}),beforeWords:Object.assign({},HO.beforeWords,MO.beforeWords,{are:"Gerund",were:"Gerund",be:"Gerund",no:"Gerund",without:"Gerund",you:"Gerund",we:"Gerund",they:"Gerund",he:"Gerund",she:"Gerund",us:"Gerund",them:"Gerund"}),afterWords:Object.assign({},HO.afterWords,MO.afterWords,{the:"Gerund",this:"Gerund",that:"Gerund",me:"Gerund",us:"Gerund",them:"Gerund"})},tS="Singular",nS="Infinitive",rS={beforeTags:Object.assign({},FO.beforeTags,MO.beforeTags,{Adjective:tS,Particle:tS}),afterTags:Object.assign({},FO.afterTags,MO.afterTags,{ProperNoun:nS,Gerund:nS,Adjective:nS,Copula:tS}),beforeWords:Object.assign({},FO.beforeWords,MO.beforeWords,{is:tS,was:tS,of:tS,have:null}),afterWords:Object.assign({},FO.afterWords,MO.afterWords,{instead:nS,about:nS,his:nS,her:nS,to:null,by:null,in:null})},iS="Person",aS={beforeTags:{Honorific:iS,Person:iS},afterTags:{Person:iS,ProperNoun:iS,Verb:iS},ownTags:{ProperNoun:iS},beforeWords:{hi:iS,hey:iS,yo:iS,dear:iS,hello:iS},afterWords:{said:iS,says:iS,told:iS,tells:iS,feels:iS,felt:iS,seems:iS,thinks:iS,thought:iS,spends:iS,spendt:iS,plays:iS,played:iS,sing:iS,sang:iS,learn:iS,learned:iS,wants:iS,wanted:iS}},sS="Month",oS={beforeTags:{Date:sS,Value:sS},afterTags:{Date:sS,Value:sS},beforeWords:{by:sS,in:sS,on:sS,during:sS,after:sS,before:sS,between:sS,until:sS,til:sS,sometime:sS,of:sS,this:sS,next:sS,last:sS,previous:sS,following:sS,with:"Person"},afterWords:{sometime:sS,in:sS,of:sS,until:sS,the:sS}},lS={beforeTags:Object.assign({},aS.beforeTags,oS.beforeTags),afterTags:Object.assign({},aS.afterTags,oS.afterTags),beforeWords:Object.assign({},aS.beforeWords,oS.beforeWords),afterWords:Object.assign({},aS.afterWords,oS.afterWords)},uS="Place",cS={beforeTags:{Place:uS},afterTags:{Place:uS,Abbreviation:uS},beforeWords:{in:uS,by:uS,near:uS,from:uS,to:uS},afterWords:{in:uS,by:uS,near:uS,from:uS,to:uS,government:uS,council:uS,region:uS,city:uS}};let hS="Unit";const dS={"Actor|Verb":VO,"Adj|Gerund":KO,"Adj|Noun":WO,"Adj|Past":XO,"Adj|Present":YO,"Noun|Verb":rS,"Noun|Gerund":eS,"Person|Noun":{beforeTags:Object.assign({},MO.beforeTags,aS.beforeTags),afterTags:Object.assign({},MO.afterTags,aS.afterTags),beforeWords:Object.assign({},MO.beforeWords,aS.beforeWords,{i:"Infinitive",we:"Infinitive"}),afterWords:Object.assign({},MO.afterWords,aS.afterWords)},"Person|Date":lS,"Person|Verb":{beforeTags:Object.assign({},MO.beforeTags,aS.beforeTags,FO.beforeTags),afterTags:Object.assign({},MO.afterTags,aS.afterTags,FO.afterTags),beforeWords:Object.assign({},MO.beforeWords,aS.beforeWords,FO.beforeWords),afterWords:Object.assign({},MO.afterWords,aS.afterWords,FO.afterWords)},"Person|Place":{beforeTags:Object.assign({},cS.beforeTags,aS.beforeTags),afterTags:Object.assign({},cS.afterTags,aS.afterTags),beforeWords:Object.assign({},cS.beforeWords,aS.beforeWords),afterWords:Object.assign({},cS.afterWords,aS.afterWords)},"Person|Adj":{beforeTags:Object.assign({},aS.beforeTags,BO.beforeTags),afterTags:Object.assign({},aS.afterTags,BO.afterTags),beforeWords:Object.assign({},aS.beforeWords,BO.beforeWords),afterWords:Object.assign({},aS.afterWords,BO.afterWords)},"Unit|Noun":{beforeTags:{Value:hS},afterTags:{},beforeWords:{per:hS,every:hS,each:hS,square:hS,cubic:hS,sq:hS,metric:hS},afterWords:{per:hS,squared:hS,cubed:hS,long:hS}}},pS=(e,t)=>{let n=Object.keys(e).reduce(((t,n)=>(t[n]="Infinitive"===e[n]?"PresentTense":"Plural",t)),{});return Object.assign(n,t)};dS["Plural|Verb"]={beforeWords:pS(dS["Noun|Verb"].beforeWords,{had:"Plural",have:"Plural"}),afterWords:pS(dS["Noun|Verb"].afterWords,{his:"PresentTense",her:"PresentTense",its:"PresentTense",in:null,to:null,is:"PresentTense",by:"PresentTense"}),beforeTags:pS(dS["Noun|Verb"].beforeTags,{Conjunction:"PresentTense",Noun:void 0,ProperNoun:"PresentTense"}),afterTags:pS(dS["Noun|Verb"].afterTags,{Gerund:"Plural",Noun:"PresentTense",Value:"PresentTense"})};const fS=dS,mS="Adjective",gS="Infinitive",yS="PresentTense",vS="Singular",bS="PastTense",wS="Adverb",_S="Plural",kS="Actor",AS="Verb",PS="Noun",TS="LastName",IS="Modal",ES="Place",xS="Participle",CS=[null,null,{ea:vS,ia:PS,ic:mS,ly:wS,"'n":AS,"'t":AS},{oed:bS,ued:bS,xed:bS," so":wS,"'ll":IS,"'re":"Copula",azy:mS,eer:PS,end:AS,ped:bS,ffy:mS,ify:gS,ing:"Gerund",ize:gS,ibe:gS,lar:mS,mum:mS,nes:yS,nny:mS,ous:mS,que:mS,ger:PS,ber:PS,rol:vS,sis:vS,ogy:vS,oid:vS,ian:vS,zes:yS,eld:bS,ken:xS,ven:xS,ten:xS,ect:gS,ict:gS,ign:gS,oze:gS,ful:mS,bal:mS,ton:PS,pur:ES},{amed:bS,aped:bS,ched:bS,lked:bS,rked:bS,reed:bS,nded:bS,mned:mS,cted:bS,dged:bS,ield:vS,akis:TS,cede:gS,chuk:TS,czyk:TS,ects:yS,iend:vS,ends:AS,enko:TS,ette:vS,iary:vS,wner:vS,fies:yS,fore:wS,gate:gS,gone:mS,ices:_S,ints:_S,ruct:gS,ines:_S,ions:_S,ners:_S,pers:_S,lers:_S,less:mS,llen:mS,made:mS,nsen:TS,oses:yS,ould:IS,some:mS,sson:TS,ians:_S,tion:vS,tage:PS,ique:vS,tive:mS,tors:PS,vice:vS,lier:vS,fier:vS,wned:bS,gent:vS,tist:kS,pist:kS,rist:kS,mist:kS,yist:kS,vist:kS,ists:kS,lite:vS,site:vS,rite:vS,mite:vS,bite:vS,mate:vS,date:vS,ndal:vS,vent:vS,uist:kS,gist:kS,note:vS,cide:vS,ence:vS,wide:mS,vide:gS,ract:gS,duce:gS,pose:gS,eive:gS,lyze:gS,lyse:gS,iant:mS,nary:mS,ghty:mS,uent:mS,erer:kS,bury:ES,dorf:PS,esty:PS,wych:ES,dale:ES,folk:ES,vale:ES,abad:ES,sham:ES,wick:ES,view:ES},{elist:kS,holic:vS,phite:vS,tized:bS,urned:bS,eased:bS,ances:_S,bound:mS,ettes:_S,fully:wS,ishes:yS,ities:_S,marek:TS,nssen:TS,ology:PS,osome:vS,tment:vS,ports:_S,rough:mS,tches:yS,tieth:"Ordinal",tures:_S,wards:wS,where:wS,archy:PS,pathy:PS,opoly:PS,embly:PS,phate:PS,ndent:vS,scent:vS,onist:kS,anist:kS,alist:kS,olist:kS,icist:kS,ounce:gS,iable:mS,borne:mS,gnant:mS,inant:mS,igent:mS,atory:mS,rient:vS,dient:vS,maker:kS,burgh:ES,mouth:ES,ceter:ES,ville:ES,hurst:ES,stead:ES,endon:ES,brook:ES,shire:ES,worth:PS,field:"ProperNoun",ridge:ES},{auskas:TS,parent:vS,cedent:vS,ionary:vS,cklist:vS,brooke:ES,keeper:kS,logist:kS,teenth:"Value",worker:kS,master:kS,writer:kS,brough:ES,cester:ES,ington:ES,cliffe:ES,ingham:ES},{chester:ES,logists:kS,opoulos:TS,borough:ES,sdottir:TS}],OS="Adjective",SS="Noun",NS="Verb",jS=[null,null,{},{neo:SS,bio:SS,"de-":NS,"re-":NS,"un-":NS,"ex-":SS},{anti:SS,auto:SS,faux:OS,hexa:SS,kilo:SS,mono:SS,nano:SS,octa:SS,poly:SS,semi:OS,tele:SS,"pro-":OS,"mis-":NS,"dis-":NS,"pre-":OS},{anglo:SS,centi:SS,ethno:SS,ferro:SS,grand:SS,hepta:SS,hydro:SS,intro:SS,macro:SS,micro:SS,milli:SS,nitro:SS,penta:SS,quasi:OS,radio:SS,tetra:SS,"omni-":OS,"post-":OS},{pseudo:OS,"extra-":OS,"hyper-":OS,"inter-":OS,"intra-":OS,"deca-":OS},{electro:SS}],DS="Adjective",RS="Infinitive",LS="PresentTense",MS="Singular",$S="PastTense",FS="Adverb",VS="Expression",zS="Actor",BS="Verb",US="Noun",HS="LastName",GS={a:[[/.[aeiou]na$/,US,"tuna"],[/.[oau][wvl]ska$/,HS],[/.[^aeiou]ica$/,MS,"harmonica"],[/^([hyj]a+)+$/,VS,"haha"]],c:[[/.[^aeiou]ic$/,DS]],d:[[/[aeiou](pp|ll|ss|ff|gg|tt|rr|bb|nn|mm)ed$/,$S,"popped"],[/.[aeo]{2}[bdgmnprvz]ed$/,$S,"rammed"],[/.[aeiou][sg]hed$/,$S,"gushed"],[/.[aeiou]red$/,$S,"hired"],[/.[aeiou]r?ried$/,$S,"hurried"],[/[^aeiou]ard$/,MS,"steward"],[/[aeiou][^aeiou]id$/,DS,""],[/.[vrl]id$/,DS,"livid"],[/..led$/,$S,"hurled"],[/.[iao]sed$/,$S,""],[/[aeiou]n?[cs]ed$/,$S,""],[/[aeiou][rl]?[mnf]ed$/,$S,""],[/[aeiou][ns]?c?ked$/,$S,"bunked"],[/[aeiou]gned$/,$S],[/[aeiou][nl]?ged$/,$S],[/.[tdbwxyz]ed$/,$S],[/[^aeiou][aeiou][tvx]ed$/,$S],[/.[cdflmnprstv]ied$/,$S,"emptied"]],e:[[/.[lnr]ize$/,RS,"antagonize"],[/.[^aeiou]ise$/,RS,"antagonise"],[/.[aeiou]te$/,RS,"bite"],[/.[^aeiou][ai]ble$/,DS,"fixable"],[/.[^aeiou]eable$/,DS,"maleable"],[/.[ts]ive$/,DS,"festive"],[/[a-z]-like$/,DS,"woman-like"]],h:[[/.[^aeiouf]ish$/,DS,"cornish"],[/.v[iy]ch$/,HS,"..ovich"],[/^ug?h+$/,VS,"ughh"],[/^uh[ -]?oh$/,VS,"uhoh"],[/[a-z]-ish$/,DS,"cartoon-ish"]],i:[[/.[oau][wvl]ski$/,HS,"polish-male"]],k:[[/^(k){2}$/,VS,"kkkk"]],l:[[/.[gl]ial$/,DS,"familial"],[/.[^aeiou]ful$/,DS,"fitful"],[/.[nrtumcd]al$/,DS,"natal"],[/.[^aeiou][ei]al$/,DS,"familial"]],m:[[/.[^aeiou]ium$/,MS,"magnesium"],[/[^aeiou]ism$/,MS,"schism"],[/^[hu]m+$/,VS,"hmm"],[/^\d+ ?[ap]m$/,"Date","3am"]],n:[[/.[lsrnpb]ian$/,DS,"republican"],[/[^aeiou]ician$/,zS,"musician"],[/[aeiou][ktrp]in'$/,"Gerund","cookin'"]],o:[[/^no+$/,VS,"noooo"],[/^(yo)+$/,VS,"yoo"],[/^wo{2,}[pt]?$/,VS,"woop"]],r:[[/.[bdfklmst]ler$/,"Noun"],[/[aeiou][pns]er$/,MS],[/[^i]fer$/,RS],[/.[^aeiou][ao]pher$/,zS],[/.[lk]er$/,"Noun"],[/.ier$/,"Comparative"]],t:[[/.[di]est$/,"Superlative"],[/.[icldtgrv]ent$/,DS],[/[aeiou].*ist$/,DS],[/^[a-z]et$/,BS]],s:[[/.[^aeiou]ises$/,LS],[/.[rln]ates$/,LS],[/.[^z]ens$/,BS],[/.[lstrn]us$/,MS],[/.[aeiou]sks$/,LS],[/.[aeiou]kes$/,LS],[/[aeiou][^aeiou]is$/,MS],[/[a-z]'s$/,US],[/^yes+$/,VS]],v:[[/.[^aeiou][ai][kln]ov$/,HS]],y:[[/.[cts]hy$/,DS],[/.[st]ty$/,DS],[/.[tnl]ary$/,DS],[/.[oe]ry$/,MS],[/[rdntkbhs]ly$/,FS],[/.(gg|bb|zz)ly$/,DS],[/...lly$/,FS],[/.[gk]y$/,DS],[/[bszmp]{2}y$/,DS],[/.[ai]my$/,DS],[/[ea]{2}zy$/,DS],[/.[^aeiou]ity$/,MS]]},qS="Verb",KS="Noun",WS={leftTags:[["Adjective",KS],["Possessive",KS],["Determiner",KS],["Adverb",qS],["Pronoun",qS],["Value",KS],["Ordinal",KS],["Modal",qS],["Superlative",KS],["Demonym",KS],["Honorific","Person"]],leftWords:[["i",qS],["first",KS],["it",qS],["there",qS],["not",qS],["because",KS],["if",KS],["but",KS],["who",qS],["this",KS],["his",KS],["when",KS],["you",qS],["very","Adjective"],["old",KS],["never",qS],["before",KS],["a",KS],["the",KS],["been",qS]],rightTags:[["Copula",KS],["PastTense",KS],["Conjunction",KS],["Modal",KS]],rightWords:[["there",qS],["me",qS],["man","Adjective"],["him",qS],["it",qS],["were",KS],["took",KS],["himself",qS],["went",KS],["who",KS],["jr","Person"]]},JS=/^([0-9]+)/,ZS=function(e){let t=function(e){let t={};return e.split("¦").forEach((e=>{let[n,r]=e.split(":");r=(r||"").split(","),r.forEach((e=>{t[e]=n}))})),t}(e);return Object.keys(t).reduce(((e,n)=>(e[n]=function(e="",t=""){let n=(t=String(t)).match(JS);if(null===n)return t;let r=Number(n[1])||0;return e.substring(0,r)+t.replace(JS,"")}(n,t[n]),e)),{})},QS=function(e={}){return"string"==typeof e&&(e=JSON.parse(e)),e.fwd=ZS(e.fwd||""),e.both=ZS(e.both||""),e.rev=ZS(e.rev||""),e.ex=ZS(e.ex||""),e},XS=function(e){return Object.entries(e).reduce(((e,t)=>(e[t[1]]=t[0],e)),{})},YS=function(e={}){return{reversed:!0,both:XS(e.both),ex:XS(e.ex),fwd:e.rev||{}}},eN=QS({fwd:"1:tted,wed,gged,nned,een,rred,pped,yed,bbed,oed,dded,rd,wn,mmed¦2:eed,nded,et,hted,st,oled,ut,emed,eled,lded,ken,rt,nked,apt,ant,eped,eked¦3:eared,eat,eaded,nelled,ealt,eeded,ooted,eaked,eaned,eeted,mited,bid,uit,ead,uited,ealed,geted,velled,ialed,belled¦4:ebuted,hined,comed¦y:ied¦ome:ame¦ear:ore¦ind:ound¦ing:ung,ang¦ep:pt¦ink:ank,unk¦ig:ug¦all:ell¦ee:aw¦ive:ave¦eeze:oze¦old:eld¦ave:ft¦ake:ook¦ell:old¦ite:ote¦ide:ode¦ine:one¦in:un,on¦eal:ole¦im:am¦ie:ay¦and:ood¦1ise:rose¦1eak:roke¦1ing:rought¦1ive:rove¦1el:elt¦1id:bade¦1et:got¦1y:aid¦1it:sat¦3e:lid¦3d:pent",both:"1:aed,fed,xed,hed¦2:sged,xted,wled,rped,lked,kied,lmed,lped,uped,bted,rbed,rked,wned,rled,mped,fted,mned,mbed,zzed,omed,ened,cked,gned,lted,sked,ued,zed,nted,ered,rted,rmed,ced,sted,rned,ssed,rded,pted,ved,cted¦3:cled,eined,siped,ooned,uked,ymed,jored,ouded,ioted,oaned,lged,asped,iged,mured,oided,eiled,yped,taled,moned,yled,lit,kled,oaked,gled,naled,fled,uined,oared,valled,koned,soned,aided,obed,ibed,meted,nicked,rored,micked,keted,vred,ooped,oaded,rited,aired,auled,filled,ouled,ooded,ceted,tolled,oited,bited,aped,tled,vored,dled,eamed,nsed,rsed,sited,owded,pled,sored,rged,osed,pelled,oured,psed,oated,loned,aimed,illed,eured,tred,ioned,celled,bled,wsed,ooked,oiled,itzed,iked,iased,onged,ased,ailed,uned,umed,ained,auded,nulled,ysed,eged,ised,aged,oined,ated,used,dged,doned¦4:ntied,efited,uaked,caded,fired,roped,halled,roked,himed,culed,tared,lared,tuted,uared,routed,pited,naked,miled,houted,helled,hared,cored,caled,tired,peated,futed,ciled,called,tined,moted,filed,sided,poned,iloted,honed,lleted,huted,ruled,cured,named,preted,vaded,sured,talled,haled,peded,gined,nited,uided,ramed,feited,laked,gured,ctored,unged,pired,cuted,voked,eloped,ralled,rined,coded,icited,vided,uaded,voted,mined,sired,noted,lined,nselled,luted,jured,fided,puted,piled,pared,olored,cided,hoked,enged,tured,geoned,cotted,lamed,uiled,waited,udited,anged,luded,mired,uired,raded¦5:modelled,izzled,eleted,umpeted,ailored,rseded,treated,eduled,ecited,rammed,eceded,atrolled,nitored,basted,twined,itialled,ncited,gnored,ploded,xcited,nrolled,namelled,plored,efeated,redited,ntrolled,nfined,pleted,llided,lcined,eathed,ibuted,lloted,dhered,cceded¦3ad:sled¦2aw:drew¦2ot:hot¦2ke:made¦2ow:hrew,grew¦2ose:hose¦2d:ilt¦2in:egan¦1un:ran¦1ink:hought¦1ick:tuck¦1ike:ruck¦1eak:poke,nuck¦1it:pat¦1o:did¦1ow:new¦1ake:woke¦go:went",rev:"3:rst,hed,hut,cut,set¦4:tbid¦5:dcast,eread,pread,erbid¦ought:uy,eek¦1ied:ny,ly,dy,ry,fy,py,vy,by,ty,cy¦1ung:ling,ting,wing¦1pt:eep¦1ank:rink¦1ore:bear,wear¦1ave:give¦1oze:reeze¦1ound:rind,wind¦1ook:take,hake¦1aw:see¦1old:sell¦1ote:rite¦1ole:teal¦1unk:tink¦1am:wim¦1ay:lie¦1ood:tand¦1eld:hold¦2d:he,ge,re,le,leed,ne,reed,be,ye,lee,pe,we¦2ed:dd,oy,or,ey,gg,rr,us,ew,to¦2ame:ecome,rcome¦2ped:ap¦2ged:ag,og,ug,eg¦2bed:ub,ab,ib,ob¦2lt:neel¦2id:pay¦2ang:pring¦2ove:trive¦2med:um¦2ode:rride¦2at:ysit¦3ted:mit,hat,mat,lat,pot,rot,bat¦3ed:low,end,tow,und,ond,eem,lay,cho,dow,xit,eld,ald,uld,law,lel,eat,oll,ray,ank,fin,oam,out,how,iek,tay,haw,ait,vet,say,cay,bow¦3d:ste,ede,ode,ete,ree,ude,ame,oke,ote,ime,ute,ade¦3red:lur,cur,pur,car¦3ped:hop,rop,uip,rip,lip,tep,top¦3ded:bed,rod,kid¦3ade:orbid¦3led:uel¦3ned:lan,can,kin,pan,tun¦3med:rim,lim¦4ted:quit,llot¦4ed:pear,rrow,rand,lean,mand,anel,pand,reet,link,abel,evel,imit,ceed,ruit,mind,peal,veal,hool,head,pell,well,mell,uell,band,hear,weak¦4led:nnel,qual,ebel,ivel¦4red:nfer,efer,sfer¦4n:sake,trew¦4d:ntee¦4ded:hred¦4ned:rpin¦5ed:light,nceal,right,ndear,arget,hread,eight,rtial,eboot¦5d:edite,nvite¦5ted:egret¦5led:ravel",ex:"2:been,upped¦3:added,aged,aided,aimed,aired,bid,died,dyed,egged,erred,eyed,fit,gassed,hit,lied,owed,pent,pied,tied,used,vied,oiled,outed,banned,barred,bet,canned,cut,dipped,donned,ended,feed,inked,jarred,let,manned,mowed,netted,padded,panned,pitted,popped,potted,put,set,sewn,sowed,tanned,tipped,topped,vowed,weed,bowed,jammed,binned,dimmed,hopped,mopped,nodded,pinned,rigged,sinned,towed,vetted¦4:ached,baked,baled,boned,bored,called,caned,cared,ceded,cited,coded,cored,cubed,cured,dared,dined,edited,exited,faked,fared,filed,fined,fired,fuelled,gamed,gelled,hired,hoped,joked,lined,mined,named,noted,piled,poked,polled,pored,pulled,reaped,roamed,rolled,ruled,seated,shed,sided,timed,tolled,toned,voted,waited,walled,waned,winged,wiped,wired,zoned,yelled,tamed,lubed,roped,faded,mired,caked,honed,banged,culled,heated,raked,welled,banded,beat,cast,cooled,cost,dealt,feared,folded,footed,handed,headed,heard,hurt,knitted,landed,leaked,leapt,linked,meant,minded,molded,neared,needed,peaked,plodded,plotted,pooled,quit,read,rooted,sealed,seeded,seeped,shipped,shunned,skimmed,slammed,sparred,stemmed,stirred,suited,thinned,twinned,swayed,winked,dialed,abutted,blotted,fretted,healed,heeded,peeled,reeled¦5:basted,cheated,equalled,eroded,exiled,focused,opined,pleated,primed,quoted,scouted,shored,sloped,smoked,sniped,spelled,spouted,routed,staked,stored,swelled,tasted,treated,wasted,smelled,dwelled,honored,prided,quelled,eloped,scared,coveted,sweated,breaded,cleared,debuted,deterred,freaked,modeled,pleaded,rebutted,speeded¦6:anchored,defined,endured,impaled,invited,refined,revered,strolled,cringed,recast,thrust,unfolded¦7:authored,combined,competed,conceded,convened,excreted,extruded,redefined,restored,secreted,rescinded,welcomed¦8:expedited,infringed¦9:interfered,intervened,persevered¦10:contravened¦eat:ate¦is:was¦go:went¦are:were¦3d:bent,lent,rent,sent¦3e:bit,fled,hid,lost¦3ed:bled,bred¦2ow:blew,grew¦1uy:bought¦2tch:caught¦1o:did¦1ive:dove,gave¦2aw:drew¦2ed:fed¦2y:flew,laid,paid,said¦1ight:fought¦1et:got¦2ve:had¦1ang:hung¦2ad:led¦2ght:lit¦2ke:made¦2et:met¦1un:ran¦1ise:rose¦1it:sat¦1eek:sought¦1each:taught¦1ake:woke,took¦1eave:wove¦2ise:arose¦1ear:bore,tore,wore¦1ind:bound,found,wound¦2eak:broke¦2ing:brought,wrung¦1ome:came¦2ive:drove¦1ig:dug¦1all:fell¦2el:felt¦4et:forgot¦1old:held¦2ave:left¦1ing:rang,sang¦1ide:rode¦1ink:sank¦1ee:saw¦2ine:shone¦4e:slid¦1ell:sold,told¦4d:spent¦2in:spun¦1in:won"}),tN=QS({fwd:"1:oes¦1ve:as",both:"1:xes¦2:zzes,ches,shes,sses¦3:iases¦2y:llies,plies¦1y:cies,bies,ties,vies,nies,pies,dies,ries,fies¦:s",rev:"1ies:ly¦2es:us,go,do¦3es:cho,eto",ex:"2:does,goes¦3:gasses¦5:focuses¦is:are¦3y:relies¦2y:flies¦2ve:has"}),nN=QS({fwd:"1:nning,tting,rring,pping,eing,mming,gging,dding,bbing,kking¦2:eking,oling,eling,eming¦3:velling,siting,uiting,fiting,loting,geting,ialing,celling¦4:graming",both:"1:aing,iing,fing,xing,ying,oing,hing,wing¦2:tzing,rping,izzing,bting,mning,sping,wling,rling,wding,rbing,uping,lming,wning,mping,oning,lting,mbing,lking,fting,hting,sking,gning,pting,cking,ening,nking,iling,eping,ering,rting,rming,cting,lping,ssing,nting,nding,lding,sting,rning,rding,rking¦3:belling,siping,toming,yaking,uaking,oaning,auling,ooping,aiding,naping,euring,tolling,uzzing,ganing,haning,ualing,halling,iasing,auding,ieting,ceting,ouling,voring,ralling,garing,joring,oaming,oaking,roring,nelling,ooring,uelling,eaming,ooding,eaping,eeting,ooting,ooming,xiting,keting,ooking,ulling,airing,oaring,biting,outing,oiting,earing,naling,oading,eeding,ouring,eaking,aiming,illing,oining,eaning,onging,ealing,aining,eading¦4:thoming,melling,aboring,ivoting,weating,dfilling,onoring,eriting,imiting,tialling,rgining,otoring,linging,winging,lleting,louding,spelling,mpelling,heating,feating,opelling,choring,welling,ymaking,ctoring,calling,peating,iloring,laiting,utoring,uditing,mmaking,loating,iciting,waiting,mbating,voiding,otalling,nsoring,nselling,ocusing,itoring,eloping¦5:rselling,umpeting,atrolling,treating,tselling,rpreting,pringing,ummeting,ossoming,elmaking,eselling,rediting,totyping,onmaking,rfeiting,ntrolling¦5e:chmaking,dkeeping,severing,erouting,ecreting,ephoning,uthoring,ravening,reathing,pediting,erfering,eotyping,fringing,entoring,ombining,ompeting¦4e:emaking,eething,twining,rruling,chuting,xciting,rseding,scoping,edoring,pinging,lunging,agining,craping,pleting,eleting,nciting,nfining,ncoding,tponing,ecoding,writing,esaling,nvening,gnoring,evoting,mpeding,rvening,dhering,mpiling,storing,nviting,ploring¦3e:tining,nuring,saking,miring,haling,ceding,xuding,rining,nuting,laring,caring,miling,riding,hoking,piring,lading,curing,uading,noting,taping,futing,paring,hading,loding,siring,guring,vading,voking,during,niting,laning,caping,luting,muting,ruding,ciding,juring,laming,caling,hining,uoting,liding,ciling,duling,tuting,puting,cuting,coring,uiding,tiring,turing,siding,rading,enging,haping,buting,lining,taking,anging,haring,uiring,coming,mining,moting,suring,viding,luding¦2e:tring,zling,uging,oging,gling,iging,vring,fling,lging,obing,psing,pling,ubing,cling,dling,wsing,iking,rsing,dging,kling,ysing,tling,rging,eging,nsing,uning,osing,uming,using,ibing,bling,aging,ising,asing,ating¦2ie:rlying¦1e:zing,uing,cing,ving",rev:"ying:ie¦1ing:se,ke,te,we,ne,re,de,pe,me,le,c,he¦2ing:ll,ng,dd,ee,ye,oe,rg,us¦2ning:un¦2ging:og,ag,ug,ig,eg¦2ming:um¦2bing:ub,ab,eb,ob¦3ning:lan,can,hin,pin,win¦3ring:cur,lur,tir,tar,pur,car¦3ing:ait,del,eel,fin,eat,oat,eem,lel,ool,ein,uin¦3ping:rop,rap,top,uip,wap,hip,hop,lap,rip,cap¦3ming:tem,wim,rim,kim,lim¦3ting:mat,cut,pot,lit,lot,hat,set,pit,put¦3ding:hed,bed,bid¦3king:rek¦3ling:cil,pel¦3bing:rib¦4ning:egin¦4ing:isit,ruit,ilot,nsit,dget,rkel,ival,rcel¦4ring:efer,nfer¦4ting:rmit,mmit,ysit,dmit,emit,bmit,tfit,gret¦4ling:evel,xcel,ivel¦4ding:hred¦5ing:arget,posit,rofit¦5ring:nsfer¦5ting:nsmit,orget,cquit¦5ling:ancel,istil",ex:"3:adding,eating,aiming,aiding,airing,outing,gassing,setting,getting,putting,cutting,winning,sitting,betting,mapping,tapping,letting,bidding,hitting,tanning,netting,popping,fitting,capping,lapping,barring,banning,vetting,topping,rotting,tipping,potting,wetting,pitting,dipping,budding,hemming,pinning,jetting,kidding,padding,podding,sipping,wedding,bedding,donning,warring,penning,gutting,cueing,wadding,petting,ripping,napping,matting,tinning,binning,dimming,hopping,mopping,nodding,panning,rapping,ridding,sinning¦4:selling,falling,calling,waiting,editing,telling,rolling,heating,boating,hanging,beating,coating,singing,tolling,felling,polling,discing,seating,voiding,gelling,yelling,baiting,reining,ruining,seeking,spanning,stepping,knitting,emitting,slipping,quitting,dialing,omitting,clipping,shutting,skinning,abutting,flipping,trotting,cramming,fretting,suiting¦5:bringing,treating,spelling,stalling,trolling,expelling,rivaling,wringing,deterring,singeing,befitting,refitting¦6:enrolling,distilling,scrolling,strolling,caucusing,travelling¦7:installing,redefining,stencilling,recharging,overeating,benefiting,unraveling,programing¦9:reprogramming¦is:being¦2e:using,aging,owing¦3e:making,taking,coming,noting,hiring,filing,coding,citing,doping,baking,coping,hoping,lading,caring,naming,voting,riding,mining,curing,lining,ruling,typing,boring,dining,firing,hiding,piling,taping,waning,baling,boning,faring,honing,wiping,luring,timing,wading,piping,fading,biting,zoning,daring,waking,gaming,raking,ceding,tiring,coking,wining,joking,paring,gaping,poking,pining,coring,liming,toting,roping,wiring,aching¦4e:writing,storing,eroding,framing,smoking,tasting,wasting,phoning,shaking,abiding,braking,flaking,pasting,priming,shoring,sloping,withing,hinging¦5e:defining,refining,renaming,swathing,fringing,reciting¦1ie:dying,tying,lying,vying¦7e:sunbathing"}),rN=QS({fwd:"1:mt¦2:llen¦3:iven,aken¦:ne¦y:in",both:"1:wn¦2:me,aten¦3:seen,bidden,isen¦4:roven,asten¦3l:pilt¦3d:uilt¦2e:itten¦1im:wum¦1eak:poken¦1ine:hone¦1ose:osen¦1in:gun¦1ake:woken¦ear:orn¦eal:olen¦eeze:ozen¦et:otten¦ink:unk¦ing:ung",rev:"2:un¦oken:eak¦ought:eek¦oven:eave¦1ne:o¦1own:ly¦1den:de¦1in:ay¦2t:am¦2n:ee¦3en:all¦4n:rive,sake,take¦5n:rgive",ex:"2:been¦3:seen,run¦4:given,taken¦5:shaken¦2eak:broken¦1ive:dove¦2y:flown¦3e:hidden,ridden¦1eek:sought¦1ake:woken¦1eave:woven"}),iN=YS(eN),aN=YS(tN),sN=YS(nN),oN=YS(rN),lN=QS({fwd:"3:ser,ier¦1er:h,t,f,l,n¦1r:e¦2er:ss,or,om",both:"3er:ver,ear,alm¦3ner:hin¦3ter:lat¦2mer:im¦2er:ng,rm,mb¦2ber:ib¦2ger:ig¦1er:w,p,k,d¦ier:y",rev:"1:tter,yer¦2:uer,ver,ffer,oner,eler,ller,iler,ster,cer,uler,sher,ener,gher,aner,adder,nter,eter,rter,hter,rner,fter¦3:oser,ooler,eafer,user,airer,bler,maler,tler,eater,uger,rger,ainer,urer,ealer,icher,pler,emner,icter,nser,iser¦4:arser,viner,ucher,rosser,somer,ndomer,moter,oother,uarer,hiter¦5:nuiner,esser,emier¦ar:urther",ex:"worse:bad¦better:good¦4er:fair,gray,poor¦1urther:far¦3ter:fat,hot,wet¦3der:mad,sad¦3er:shy,fun¦4der:glad¦:¦4r:cute,dire,fake,fine,free,lame,late,pale,rare,ripe,rude,safe,sore,tame,wide¦5r:eerie,stale"}),uN=QS({fwd:"1st:e¦1est:l,m,f,s¦1iest:cey¦2est:or,ir¦3est:ver",both:"4:east¦5:hwest¦5lest:erful¦4est:weet,lgar,tter,oung¦4most:uter¦3est:ger,der,rey,iet,ong,ear¦3test:lat¦3most:ner¦2est:pt,ft,nt,ct,rt,ht¦2test:it¦2gest:ig¦1est:b,k,n,p,h,d,w¦iest:y",rev:"1:ttest,nnest,yest¦2:sest,stest,rmest,cest,vest,lmest,olest,ilest,ulest,ssest,imest,uest¦3:rgest,eatest,oorest,plest,allest,urest,iefest,uelest,blest,ugest,amest,yalest,ealest,illest,tlest,itest¦4:cerest,eriest,somest,rmalest,ndomest,motest,uarest,tiffest¦5:leverest,rangest¦ar:urthest¦3ey:riciest",ex:"best:good¦worst:bad¦5est:great¦4est:fast,full,fair,dull¦3test:hot,wet,fat¦4nest:thin¦1urthest:far¦3est:gay,shy,ill¦4test:neat¦4st:late,wide,fine,safe,cute,fake,pale,rare,rude,sore,ripe,dire¦6st:severe"}),cN={fromPast:eN,fromPresent:tN,fromGerund:nN,fromParticiple:rN,toPast:iN,toPresent:aN,toGerund:sN,toParticiple:oN,toComparative:lN,toSuperlative:uN,fromComparative:YS(lN),fromSuperlative:YS(uN),adjToNoun:QS({fwd:"1:tistic,eable,lful,sful,ting,tty¦2:onate,rtable,geous,ced,seful,ctful¦3:ortive,ented¦arity:ear¦y:etic¦fulness:begone¦1ity:re¦1y:tiful,gic¦2ity:ile,imous,ilous,ime¦2ion:ated¦2eness:iving¦2y:trious¦2ation:iring¦2tion:vant¦3ion:ect¦3ce:mant,mantic¦3tion:irable¦3y:est,estic¦3m:mistic,listic¦3ess:ning¦4n:utious¦4on:rative,native,vative,ective¦4ce:erant",both:"1:king,wing¦2:alous,ltuous,oyful,rdous¦3:gorous,ectable,werful,amatic¦4:oised,usical,agical,raceful,ocused,lined,ightful¦5ness:stful,lding,itous,nuous,ulous,otous,nable,gious,ayful,rvous,ntous,lsive,peful,entle,ciful,osive,leful,isive,ncise,reful,mious¦5ty:ivacious¦5ties:ubtle¦5ce:ilient,adiant,atient¦5cy:icient¦5sm:gmatic¦5on:sessive,dictive¦5ity:pular,sonal,eative,entic¦5sity:uminous¦5ism:conic¦5nce:mperate¦5ility:mitable¦5ment:xcited¦5n:bitious¦4cy:brant,etent,curate¦4ility:erable,acable,icable,ptable¦4ty:nacious,aive,oyal,dacious¦4n:icious¦4ce:vient,erent,stent,ndent,dient,quent,ident¦4ness:adic,ound,hing,pant,sant,oing,oist,tute¦4icity:imple¦4ment:fined,mused¦4ism:otic¦4ry:dantic¦4ity:tund,eral¦4edness:hand¦4on:uitive¦4lity:pitable¦4sm:eroic,namic¦4sity:nerous¦3th:arm¦3ility:pable,bable,dable,iable¦3cy:hant,nant,icate¦3ness:red,hin,nse,ict,iet,ite,oud,ind,ied,rce¦3ion:lute¦3ity:ual,gal,volous,ial¦3ce:sent,fensive,lant,gant,gent,lent,dant¦3on:asive¦3m:fist,sistic,iastic¦3y:terious,xurious,ronic,tastic¦3ur:amorous¦3e:tunate¦3ation:mined¦3sy:rteous¦3ty:ain¦3ry:ave¦3ment:azed¦2ness:de,on,ue,rn,ur,ft,rp,pe,om,ge,rd,od,ay,ss,er,ll,oy,ap,ht,ld,ad,rt¦2inousness:umous¦2ity:neous,ene,id,ane¦2cy:bate,late¦2ation:ized¦2ility:oble,ible¦2y:odic¦2e:oving,aring¦2s:ost¦2itude:pt¦2dom:ee¦2ance:uring¦2tion:reet¦2ion:oted¦2sion:ending¦2liness:an¦2or:rdent¦1th:ung¦1e:uable¦1ness:w,h,k,f¦1ility:mble¦1or:vent¦1ement:ging¦1tiquity:ncient¦1ment:hed¦verty:or¦ength:ong¦eat:ot¦pth:ep¦iness:y",rev:"",ex:"5:forceful,humorous¦8:charismatic¦13:understanding¦5ity:active¦11ness:adventurous,inquisitive,resourceful¦8on:aggressive,automatic,perceptive¦7ness:amorous,fatuous,furtive,ominous,serious¦5ness:ample,sweet¦12ness:apprehensive,cantankerous,contemptuous,ostentatious¦13ness:argumentative,conscientious¦9ness:assertive,facetious,imperious,inventive,oblivious,rapacious,receptive,seditious,whimsical¦10ness:attractive,expressive,impressive,loquacious,salubrious,thoughtful¦3edom:boring¦4ness:calm,fast,keen,tame¦8ness:cheerful,gracious,specious,spurious,timorous,unctuous¦5sity:curious¦9ion:deliberate¦8ion:desperate¦6e:expensive¦7ce:fragrant¦3y:furious¦9ility:ineluctable¦6ism:mystical¦8ity:physical,proactive,sensitive,vertical¦5cy:pliant¦7ity:positive¦9ity:practical¦12ism:professional¦6ce:prudent¦3ness:red¦6cy:vagrant¦3dom:wise"})},hN=["academy","administration","agence","agences","agencies","agency","airlines","airways","army","assoc","associates","association","assurance","authority","autorite","aviation","bank","banque","board","boys","brands","brewery","brotherhood","brothers","bureau","cafe","co","caisse","capital","care","cathedral","center","centre","chemicals","choir","chronicle","church","circus","clinic","clinique","club","co","coalition","coffee","collective","college","commission","committee","communications","community","company","comprehensive","computers","confederation","conference","conseil","consulting","containers","corporation","corps","corp","council","crew","data","departement","department","departments","design","development","directorate","division","drilling","education","eglise","electric","electricity","energy","ensemble","enterprise","enterprises","entertainment","estate","etat","faculty","faction","federation","financial","fm","foundation","fund","gas","gazette","girls","government","group","guild","herald","holdings","hospital","hotel","hotels","inc","industries","institut","institute","institutes","insurance","international","interstate","investment","investments","investors","journal","laboratory","labs","llc","ltd","limited","machines","magazine","management","marine","marketing","markets","media","memorial","ministere","ministry","military","mobile","motor","motors","musee","museum","news","observatory","office","oil","optical","orchestra","organization","partners","partnership","petrol","petroleum","pharmacare","pharmaceutical","pharmaceuticals","pizza","plc","police","politburo","polytechnic","post","power","press","productions","quartet","radio","reserve","resources","restaurant","restaurants","savings","school","securities","service","services","societe","subsidiary","society","sons","subcommittee","syndicat","systems","telecommunications","telegraph","television","times","tribunal","tv","union","university","utilities","workers"].reduce(((e,t)=>(e[t]=!0,e)),{}),dN=["atoll","basin","bay","beach","bluff","bog","camp","canyon","canyons","cape","cave","caves","cliffs","coast","cove","coves","crater","crossing","creek","desert","dune","dunes","downs","estates","escarpment","estuary","falls","fjord","fjords","forest","forests","glacier","gorge","gorges","grove","gulf","gully","highland","heights","hollow","hill","hills","inlet","island","islands","isthmus","junction","knoll","lagoon","lake","lakeshore","marsh","marshes","mount","mountain","mountains","narrows","peninsula","plains","plateau","pond","rapids","ravine","reef","reefs","ridge","river","rivers","sandhill","shoal","shore","shoreline","shores","strait","straits","springs","stream","swamp","tombolo","trail","trails","trench","valley","vallies","village","volcano","waterfall","watershed","wetland","woods","acres","burough","county","district","municipality","prefecture","province","region","reservation","state","territory","borough","metropolis","downtown","uptown","midtown","city","town","township","hamlet","country","kingdom","enclave","neighbourhood","neighborhood","kingdom","ward","zone","airport","amphitheater","arch","arena","auditorium","bar","barn","basilica","battlefield","bridge","building","castle","centre","coliseum","cineplex","complex","dam","farm","field","fort","garden","gardens","gymnasium","hall","house","levee","library","manor","memorial","monument","museum","gallery","palace","pillar","pits","plantation","playhouse","quarry","sportsfield","sportsplex","stadium","terrace","terraces","theater","tower","park","parks","site","ranch","raceway","sportsplex","ave","st","street","rd","road","lane","landing","crescent","cr","way","tr","terrace","avenue"].reduce(((e,t)=>(e[t]=!0,e)),{}),pN=[[/([^v])ies$/i,"$1y"],[/(ise)s$/i,"$1"],[/(kn|[^o]l|w)ives$/i,"$1ife"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)ves$/i,"$1f"],[/^(dwar|handkerchie|hoo|scar|whar)ves$/i,"$1f"],[/(antenn|formul|nebul|vertebr|vit)ae$/i,"$1a"],[/(octop|vir|radi|nucle|fung|cact|stimul)(i)$/i,"$1us"],[/(buffal|tomat|tornad)(oes)$/i,"$1o"],[/(ause)s$/i,"$1"],[/(ease)s$/i,"$1"],[/(ious)es$/i,"$1"],[/(ouse)s$/i,"$1"],[/(ose)s$/i,"$1"],[/(..ase)s$/i,"$1"],[/(..[aeiu]s)es$/i,"$1"],[/(vert|ind|cort)(ices)$/i,"$1ex"],[/(matr|append)(ices)$/i,"$1ix"],[/([xo]|ch|ss|sh)es$/i,"$1"],[/men$/i,"man"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/(cris|ax|test)es$/i,"$1is"],[/(alias|status)es$/i,"$1"],[/(ss)$/i,"$1"],[/(ic)s$/i,"$1"],[/s$/i,""]],fN=function(e,t){const{irregularPlurals:n}=t.two;let r=function(e){return Object.keys(e).reduce(((t,n)=>(t[e[n]]=n,t)),{})}(n);if(r.hasOwnProperty(e))return r[e];for(let t=0;t<pN.length;t++)if(!0===pN[t][0].test(e))return e.replace(pN[t][0],pN[t][1]);return e},mN={toPlural:SO,toSingular:fN,all:function(e,t){let n=[e],r=SO(e,t);r!==e&&n.push(r);let i=fN(e,t);return i!==e&&n.push(i),n}},gN=function(e="",t={}){let n=function(e,t={}){return t.hasOwnProperty(e)?t[e]:null}(e,t.ex);return n=n||function(e,t=[]){for(let n=0;n<t.length;n+=1)if(e.endsWith(t[n]))return e;return null}(e,t.same),n=n||function(e,t,n={}){t=t||{};for(let r=e.length-1;r>=1;r-=1){let i=e.length-r,a=e.substring(i,e.length);if(!0===t.hasOwnProperty(a))return e.slice(0,i)+t[a];if(!0===n.hasOwnProperty(a))return e.slice(0,i)+n[a]}return t.hasOwnProperty("")?e+t[""]:n.hasOwnProperty("")?e+n[""]:null}(e,t.fwd,t.both),n=n||e,n};let yN={Gerund:["ing"],Actor:["erer"],Infinitive:["ate","ize","tion","rify","then","ress","ify","age","nce","ect","ise","ine","ish","ace","ash","ure","tch","end","ack","and","ute","ade","ock","ite","ase","ose","use","ive","int","nge","lay","est","ain","ant","ent","eed","er","le","unk","ung","upt","en"],PastTense:["ept","ed","lt","nt","ew","ld"],PresentTense:["rks","cks","nks","ngs","mps","tes","zes","ers","les","acks","ends","ands","ocks","lays","eads","lls","els","ils","ows","nds","ays","ams","ars","ops","ffs","als","urs","lds","ews","ips","es","ts","ns"],Participle:["ken","wn"]};yN=Object.keys(yN).reduce(((e,t)=>(yN[t].forEach((n=>e[n]=t)),e)),{});const vN=yN,bN=function(e){let t=e.substring(e.length-3);if(!0===vN.hasOwnProperty(t))return vN[t];let n=e.substring(e.length-2);return!0===vN.hasOwnProperty(n)?vN[n]:"s"===e.substring(e.length-1)?"PresentTense":null},wN={are:"be",were:"be",been:"be",is:"be",am:"be",was:"be",be:"be",being:"be"},_N=function(e,t,n){const{fromPast:r,fromPresent:i,fromGerund:a,fromParticiple:s}=t.two.models;let{prefix:o,verb:l,particle:u}=function(e,t){let n="",r={};t.one&&t.one.prefixes&&(r=t.one.prefixes);let[i,a]=e.split(/ /);return a&&!0===r[i]&&(n=i,i=a,a=""),{prefix:n,verb:i,particle:a}}(e,t),c="";if(n||(n=bN(e)),wN.hasOwnProperty(e))c=wN[e];else if("Participle"===n)c=gN(l,s);else if("PastTense"===n)c=gN(l,r);else if("PresentTense"===n)c=gN(l,i);else{if("Gerund"!==n)return e;c=gN(l,a)}return u&&(c+=" "+u),o&&(c=o+" "+c),c},kN=function(e,t){const{toPast:n,toPresent:r,toGerund:i,toParticiple:a}=t.two.models;if("be"===e)return{Infinitive:e,Gerund:"being",PastTense:"was",PresentTense:"is"};let[s,o]=(e=>/ /.test(e)?e.split(/ /):[e,""])(e),l={Infinitive:s,PastTense:gN(s,n),PresentTense:gN(s,r),Gerund:gN(s,i),FutureTense:"will "+s},u=gN(s,a);if(u!==e&&u!==l.PastTense){let n=t.one.lexicon||{};"Participle"!==n[u]&&"Adjective"!==n[u]||("play"===e&&(u="played"),l.Participle=u)}return o&&Object.keys(l).forEach((e=>{l[e]+=" "+o})),l},AN={toInfinitive:_N,conjugate:kN,all:function(e,t){let n=kN(e,t);return delete n.FutureTense,Object.values(n).filter((e=>e))}},PN=function(e,t){const n=t.two.models.toSuperlative;return gN(e,n)},TN=function(e,t){const n=t.two.models.toComparative;return gN(e,n)},IN=function(e="",t=[]){const n=e.length;for(let r=n<=6?n-1:6;r>=1;r-=1){let i=e.substring(n-r,e.length);if(!0===t[i.length].hasOwnProperty(i))return e.slice(0,n-r)+t[i.length][i]}return null},EN="ically",xN=new Set(["analyt"+EN,"chem"+EN,"class"+EN,"clin"+EN,"crit"+EN,"ecolog"+EN,"electr"+EN,"empir"+EN,"frant"+EN,"grammat"+EN,"ident"+EN,"ideolog"+EN,"log"+EN,"mag"+EN,"mathemat"+EN,"mechan"+EN,"med"+EN,"method"+EN,"method"+EN,"mus"+EN,"phys"+EN,"phys"+EN,"polit"+EN,"pract"+EN,"rad"+EN,"satir"+EN,"statist"+EN,"techn"+EN,"technolog"+EN,"theoret"+EN,"typ"+EN,"vert"+EN,"whims"+EN]),CN=[null,{},{ly:""},{ily:"y",bly:"ble",ply:"ple"},{ally:"al",rply:"rp"},{ually:"ual",ially:"ial",cally:"cal",eally:"eal",rally:"ral",nally:"nal",mally:"mal",eeply:"eep",eaply:"eap"},{ically:"ic"}],ON=new Set(["early","only","hourly","daily","weekly","monthly","yearly","mostly","duly","unduly","especially","undoubtedly","conversely","namely","exceedingly","presumably","accordingly","overly","best","latter","little","long","low"]),SN={wholly:"whole",fully:"full",truly:"true",gently:"gentle",singly:"single",customarily:"customary",idly:"idle",publically:"public",quickly:"quick",superbly:"superb",cynically:"cynical",well:"good"},NN=[null,{y:"ily"},{ly:"ly",ic:"ically"},{ial:"ially",ual:"ually",tle:"tly",ble:"bly",ple:"ply",ary:"arily"},{},{},{}],jN={cool:"cooly",whole:"wholly",full:"fully",good:"well",idle:"idly",public:"publicly",single:"singly",special:"especially"},DN=function(e){if(jN.hasOwnProperty(e))return jN[e];let t=IN(e,NN);return t||(t=e+"ly"),t},RN={toSuperlative:PN,toComparative:TN,toAdverb:DN,toNoun:function(e,t){const n=t.two.models.adjToNoun;return gN(e,n)},fromAdverb:function(e){return e.endsWith("ly")?xN.has(e)?e.replace(/ically/,"ical"):ON.has(e)?null:SN.hasOwnProperty(e)?SN[e]:IN(e,CN)||e:null},fromSuperlative:function(e,t){const n=t.two.models.fromSuperlative;return gN(e,n)},fromComparative:function(e,t){const n=t.two.models.fromComparative;return gN(e,n)},all:function(e,t){let n=[e];return n.push(PN(e,t)),n.push(TN(e,t)),n.push(DN(e)),n=n.filter((e=>e)),n=new Set(n),Array.from(n)}},LN={noun:mN,verb:AN,adjective:RN},MN={Singular:(e,t,n,r)=>{let i=r.one.lexicon,a=n.two.transform.noun.toPlural(e,r);i[a]||(t[a]=t[a]||"Plural")},Actor:(e,t,n,r)=>{let i=r.one.lexicon,a=n.two.transform.noun.toPlural(e,r);i[a]||(t[a]=t[a]||["Plural","Actor"])},Comparable:(e,t,n,r)=>{let i=r.one.lexicon,{toSuperlative:a,toComparative:s}=n.two.transform.adjective,o=a(e,r);i[o]||(t[o]=t[o]||"Superlative");let l=s(e,r);i[l]||(t[l]=t[l]||"Comparative"),t[e]="Adjective"},Demonym:(e,t,n,r)=>{let i=n.two.transform.noun.toPlural(e,r);t[i]=t[i]||["Demonym","Plural"]},Infinitive:(e,t,n,r)=>{let i=r.one.lexicon,a=n.two.transform.verb.conjugate(e,r);Object.entries(a).forEach((e=>{i[e[1]]||t[e[1]]||"FutureTense"===e[0]||(t[e[1]]=e[0])}))},PhrasalVerb:(e,t,n,r)=>{let i=r.one.lexicon;t[e]=["PhrasalVerb","Infinitive"];let a=r.one._multiCache,[s,o]=e.split(" ");i[s]||(t[s]=t[s]||"Infinitive");let l=n.two.transform.verb.conjugate(s,r);delete l.FutureTense,Object.entries(l).forEach((e=>{if("Actor"===e[0]||""===e[1])return;t[e[1]]||i[e[1]]||(t[e[1]]=e[0]),a[e[1]]=2;let n=e[1]+" "+o;t[n]=t[n]||[e[0],"PhrasalVerb"]}))},Multiple:(e,t)=>{t[e]=["Multiple","Cardinal"],t[e+"th"]=["Multiple","Ordinal"],t[e+"ths"]=["Multiple","Fraction"]},Cardinal:(e,t)=>{t[e]=["TextValue","Cardinal"]},Ordinal:(e,t)=>{t[e]=["TextValue","Ordinal"],t[e+"s"]=["TextValue","Fraction"]},Place:(e,t)=>{t[e]=["Place","ProperNoun"]},Region:(e,t)=>{t[e]=["Region","ProperNoun"]}},$N={e:["mice","louse","antennae","formulae","nebulae","vertebrae","vitae"],i:["tia","octopi","viri","radii","nuclei","fungi","cacti","stimuli"],n:["men"],t:["feet"]},FN=new Set(["israelis","menus","logos"]),VN=["bus","mas","was","ias","xas","vas","cis","lis","nis","ois","ris","sis","tis","xis","aus","cus","eus","fus","gus","ius","lus","nus","das","ous","pus","rus","sus","tus","xus","aos","igos","ados","ogos","'s","ss"],zN=function(e){if(!e||e.length<=3)return!1;if(FN.has(e))return!0;let t=e[e.length-1];return $N.hasOwnProperty(t)?$N[t].find((t=>e.endsWith(t))):"s"===t&&!VN.find((t=>e.endsWith(t)))},BN={two:{quickSplit:function(e){const t=/[,:;]/;let n=[];return e.forEach((e=>{let r=0;e.forEach(((i,a)=>{t.test(i.post)&&function(e,t){let n=e[t];if(!n)return!1;const r=new Set(["may","april","august","jan"]);if("like"===n.normal||r.has(n.normal))return!1;if(n.tags.has("Place")||n.tags.has("Date"))return!1;if(e[t-1]){let i=e[t-1];if(i.tags.has("Date")||r.has(i.normal))return!1;if(i.tags.has("Adjective")||n.tags.has("Adjective"))return!1}let i=n.normal;return 1!==i.length&&2!==i.length&&4!==i.length||!/^[0-9]+$/.test(i)}(e,a+1)&&(n.push(e.slice(r,a+1)),r=a+1)})),r<e.length&&n.push(e.slice(r,e.length))})),n},expandLexicon:function(e,t){const{methods:n,model:r}=t;let i={},a={};return Object.keys(e).forEach((t=>{let s=e[t],o=(t=(t=t.toLowerCase().trim()).replace(/'s\b/,"")).split(/ /);o.length>1&&(void 0===a[o[0]]||o.length>a[o[0]])&&(a[o[0]]=o.length),!0===MN.hasOwnProperty(s)&&MN[s](t,i,n,r),i[t]=i[t]||s})),delete i[""],delete i.null,delete i[" "],{lex:i,_multi:a}},transform:LN,looksPlural:zN}};let UN={one:{lexicon:{}},two:{models:cN}};const HN={"Actor|Verb":"Actor","Adj|Gerund":"Adjective","Adj|Noun":"Adjective","Adj|Past":"Adjective","Adj|Present":"Adjective","Noun|Verb":"Singular","Noun|Gerund":"Gerund","Person|Noun":"Noun","Person|Date":"Month","Person|Verb":"FirstName","Person|Place":"Person","Person|Adj":"Comparative","Plural|Verb":"Plural","Unit|Noun":"Noun"},GN=function(e,t){const n={model:t,methods:BN};let{lex:r,_multi:i}=BN.two.expandLexicon(e,n);return Object.assign(t.one.lexicon,r),Object.assign(t.one._multiCache,i),t},qN=function(e,t,n){let r=kN(e,UN);t[r.PastTense]=t[r.PastTense]||"PastTense",t[r.Gerund]=t[r.Gerund]||"Gerund",!0===n&&(t[r.PresentTense]=t[r.PresentTense]||"PresentTense")},KN=function(e,t,n){let r=PN(e,n);t[r]=t[r]||"Superlative";let i=TN(e,n);t[i]=t[i]||"Comparative"};let WN={one:{_multiCache:{},lexicon:jO,frozenLex:{"20th century fox":"Organization","7 eleven":"Organization","motel 6":"Organization","excuse me":"Expression","financial times":"Organization","guns n roses":"Organization","la z boy":"Organization","labour party":"Organization","new kids on the block":"Organization","new york times":"Organization","the guess who":"Organization","thin lizzy":"Organization","prime minister":"Actor","free market":"Singular","lay up":"Singular","living room":"Singular","living rooms":"Plural","spin off":"Singular","appeal court":"Uncountable","cold war":"Uncountable","gene pool":"Uncountable","machine learning":"Uncountable","nail polish":"Uncountable","time off":"Uncountable","take part":"Infinitive","bill gates":"Person","doctor who":"Person","dr who":"Person","he man":"Person","iron man":"Person","kid cudi":"Person","run dmc":"Person","rush limbaugh":"Person","snow white":"Person","tiger woods":"Person","brand new":"Adjective","en route":"Adjective","left wing":"Adjective","off guard":"Adjective","on board":"Adjective","part time":"Adjective","right wing":"Adjective","so called":"Adjective","spot on":"Adjective","straight forward":"Adjective","super duper":"Adjective","tip top":"Adjective","top notch":"Adjective","up to date":"Adjective","win win":"Adjective","brooklyn nets":"SportsTeam","chicago bears":"SportsTeam","houston astros":"SportsTeam","houston dynamo":"SportsTeam","houston rockets":"SportsTeam","houston texans":"SportsTeam","minnesota twins":"SportsTeam","orlando magic":"SportsTeam","san antonio spurs":"SportsTeam","san diego chargers":"SportsTeam","san diego padres":"SportsTeam","iron maiden":"ProperNoun","isle of man":"Country","united states":"Country","united states of america":"Country","prince edward island":"Region","cedar breaks":"Place","cedar falls":"Place","point blank":"Adverb","tiny bit":"Adverb","by the time":"Conjunction","no matter":"Conjunction","civil wars":"Plural","credit cards":"Plural","default rates":"Plural","free markets":"Plural","head starts":"Plural","home runs":"Plural","lay ups":"Plural","phone calls":"Plural","press releases":"Plural","record labels":"Plural","soft serves":"Plural","student loans":"Plural","tax returns":"Plural","tv shows":"Plural","video games":"Plural","took part":"PastTense","takes part":"PresentTense","taking part":"Gerund","taken part":"Participle","light bulb":"Noun","rush hour":"Noun","fluid ounce":"Unit","the rolling stones":"Organization"}},two:{irregularPlurals:AO,models:cN,suffixPatterns:CS,prefixPatterns:jS,endsWith:GS,neighbours:WS,regexNormal:[[/^[\w.]+@[\w.]+\.[a-z]{2,3}$/,"Email"],[/^(https?:\/\/|www\.)+\w+\.[a-z]{2,3}/,"Url","http.."],[/^[a-z0-9./].+\.(com|net|gov|org|ly|edu|info|biz|dev|ru|jp|de|in|uk|br|io|ai)/,"Url",".com"],[/^[PMCE]ST$/,"Timezone","EST"],[/^ma?c'[a-z]{3}/,"LastName","mc'neil"],[/^o'[a-z]{3}/,"LastName","o'connor"],[/^ma?cd[aeiou][a-z]{3}/,"LastName","mcdonald"],[/^(lol)+[sz]$/,"Expression","lol"],[/^wo{2,}a*h?$/,"Expression","wooah"],[/^(hee?){2,}h?$/,"Expression","hehe"],[/^(un|de|re)\\-[a-z\u00C0-\u00FF]{2}/,"Verb","un-vite"],[/^(m|k|cm|km)\/(s|h|hr)$/,"Unit","5 k/m"],[/^(ug|ng|mg)\/(l|m3|ft3)$/,"Unit","ug/L"],[/[^:/]\/\p{Letter}/u,"SlashedTerm","love/hate"]],regexText:[[/^#[\p{Number}_]*\p{Letter}/u,"HashTag"],[/^@\w{2,}$/,"AtMention"],[/^([A-Z]\.){2}[A-Z]?/i,["Acronym","Noun"],"F.B.I"],[/.{3}[lkmnp]in['‘’‛‵′`´]$/,"Gerund","chillin'"],[/.{4}s['‘’‛‵′`´]$/,"Possessive","flanders'"],[/^[\p{Emoji_Presentation}\p{Extended_Pictographic}]/u,"Emoji","emoji-class"]],regexNumbers:[[/^@1?[0-9](am|pm)$/i,"Time","3pm"],[/^@1?[0-9]:[0-9]{2}(am|pm)?$/i,"Time","3:30pm"],[/^'[0-9]{2}$/,"Year"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])$/,"Time","3:12:31"],[/^[012]?[0-9](:[0-5][0-9])?(:[0-5][0-9])? ?(am|pm)$/i,"Time","1:12pm"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])? ?(am|pm)?$/i,"Time","1:12:31pm"],[/^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}/i,"Date","iso-date"],[/^[0-9]{1,4}-[0-9]{1,2}-[0-9]{1,4}$/,"Date","iso-dash"],[/^[0-9]{1,4}\/[0-9]{1,2}\/([0-9]{4}|[0-9]{2})$/,"Date","iso-slash"],[/^[0-9]{1,4}\.[0-9]{1,2}\.[0-9]{1,4}$/,"Date","iso-dot"],[/^[0-9]{1,4}-[a-z]{2,9}-[0-9]{1,4}$/i,"Date","12-dec-2019"],[/^utc ?[+-]?[0-9]+$/,"Timezone","utc-9"],[/^(gmt|utc)[+-][0-9]{1,2}$/i,"Timezone","gmt-3"],[/^[0-9]{3}-[0-9]{4}$/,"PhoneNumber","421-0029"],[/^(\+?[0-9][ -])?[0-9]{3}[ -]?[0-9]{3}-[0-9]{4}$/,"PhoneNumber","1-800-"],[/^[-+]?\p{Currency_Symbol}[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?([kmb]|bn)?\+?$/u,["Money","Value"],"$5.30"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?\p{Currency_Symbol}\+?$/u,["Money","Value"],"5.30£"],[/^[-+]?[$£]?[0-9]([0-9,.])+(usd|eur|jpy|gbp|cad|aud|chf|cny|hkd|nzd|kr|rub)$/i,["Money","Value"],"$400usd"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?\+?$/,["Cardinal","NumericValue"],"5,999"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(st|nd|rd|r?th)$/,["Ordinal","NumericValue"],"53rd"],[/^\.[0-9]+\+?$/,["Cardinal","NumericValue"],".73th"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?%\+?$/,["Percent","Cardinal","NumericValue"],"-4%"],[/^\.[0-9]+%$/,["Percent","Cardinal","NumericValue"],".3%"],[/^[0-9]{1,4}\/[0-9]{1,4}(st|nd|rd|th)?s?$/,["Fraction","NumericValue"],"2/3rds"],[/^[0-9.]{1,3}[a-z]{0,2}[-–—][0-9]{1,3}[a-z]{0,2}$/,["Value","NumberRange"],"3-4"],[/^[0-9]{1,2}(:[0-9][0-9])?(am|pm)? ?[-–—] ?[0-9]{1,2}(:[0-9][0-9])?(am|pm)$/,["Time","NumberRange"],"3-4pm"],[/^[0-9.]+([a-z°]{1,4})$/,"NumericValue","9km"]],switches:DO,clues:fS,uncountable:{},orgWords:hN,placeWords:dN}};WN=function(e){return e=function(e,t){return Object.keys(e).forEach((n=>{"Uncountable"===e[n]&&(t.two.uncountable[n]=!0,e[n]="Uncountable")})),t}((e=GN(e.one.lexicon,e)).one.lexicon,e),e=function(e,t){let n={};const r=t.one.lexicon;return Object.keys(e).forEach((i=>{const a=e[i];if(n[i]=HN[a],"Noun|Verb"!==a&&"Person|Verb"!==a&&"Actor|Verb"!==a||qN(i,r,!1),"Adj|Present"===a&&(qN(i,r,!0),KN(i,r,t)),"Person|Adj"===a&&KN(i,r,t),"Adj|Gerund"===a||"Noun|Gerund"===a){let e=_N(i,UN,"Gerund");r[e]||(n[e]="Infinitive")}if("Noun|Gerund"!==a&&"Adj|Noun"!==a&&"Person|Noun"!==a||function(e,t,n){let r=SO(e,n);t[r]=t[r]||"Plural"}(i,r,t),"Adj|Past"===a){let e=_N(i,UN,"PastTense");r[e]||(n[e]="Infinitive")}})),t=GN(n,t)}(e.two.switches,e),function(e){const{irregularPlurals:t}=e.two,{lexicon:n}=e.one;return Object.entries(t).forEach((e=>{n[e[0]]=n[e[0]]||"Singular",n[e[1]]=n[e[1]]||"Plural"})),e}(e)}(WN);const JN=WN,ZN=function(e,t,n,r){const i=r.methods.one.setTag;"-"===e[t].post&&e[t+1]&&i([e[t],e[t+1]],"Hyphenated",r,null,"1-punct-hyphen''")},QN=/^(under|over|mis|re|un|dis|semi)-?/,XN=function(e,t,n){const r=n.two.switches;let i=e[t];if(r.hasOwnProperty(i.normal))i.switch=r[i.normal];else if(QN.test(i.normal)){let e=i.normal.replace(QN,"");e.length>3&&r.hasOwnProperty(e)&&(i.switch=r[e])}},YN=function(e,t,n){if(!t||0===t.length)return;if(!0===e.frozen)return;const r="undefined"!=typeof process&&process.env?process.env:self.env||{};r&&r.DEBUG_TAGS&&((e,t,n="")=>{let r=e.text||"["+e.implicit+"]";"string"!=typeof t&&t.length>2&&(t=t.slice(0,2).join(", #")+" +"),t="string"!=typeof t?t.join(", #"):t,console.log(` ${(e=>"[33m[3m"+e+"[0m")(r).padEnd(24)} [32m→[0m #${t.padEnd(22)}  ${(e=>"[3m"+e+"[0m")(n)}`)})(e,t,n),e.tags=e.tags||new Set,"string"==typeof t?e.tags.add(t):t.forEach((t=>e.tags.add(t)))},ej=["Acronym","Abbreviation","ProperNoun","Uncountable","Possessive","Pronoun","Activity","Honorific","Month"],tj=function(e,t,n){let r=e[t],i=Array.from(r.tags);for(let e=0;e<i.length;e+=1)if(n.one.tagSet[i[e]]){let t=n.one.tagSet[i[e]].parents;YN(r,t,` -inferred by #${i[e]}`)}!function(e){!e.tags.has("Noun")||e.tags.has("Plural")||e.tags.has("Singular")||ej.find((t=>e.tags.has(t)))||(zN(e.normal)?YN(e,"Plural","3-plural-guess"):YN(e,"Singular","3-singular-guess"))}(r),function(e){let t=e.tags;if(t.has("Verb")&&1===t.size){let t=bN(e.normal);t&&YN(e,t,"3-verb-tense-guess")}}(r)},nj=/^\p{Lu}[\p{Ll}'’]/u,rj=/[0-9]/,ij=["Date","Month","WeekDay","Unit","Expression"],aj=/[IVX]/,sj=/^[IVXLCDM]{2,}$/,oj=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,lj={li:!0,dc:!0,md:!0,dm:!0,ml:!0},uj=function(e,t,n){let r=e[t];r.index=r.index||[0,0];let i=r.index[1],a=r.text||"";return 0!==i&&!0===nj.test(a)&&!1===rj.test(a)?ij.find((e=>r.tags.has(e)))||r.pre.match(/["']$/)||"the"===r.normal?null:(tj(e,t,n),r.tags.has("Noun")||r.frozen||r.tags.clear(),YN(r,"ProperNoun","2-titlecase"),!0):a.length>=2&&sj.test(a)&&aj.test(a)&&oj.test(a)&&!lj[r.normal]?(YN(r,"RomanNumeral","2-xvii"),!0):null},cj=function(e="",t=[]){const n=e.length;let r=7;n<=r&&(r=n-1);for(let i=r;i>1;i-=1){let r=e.substring(n-i,n);if(!0===t[r.length].hasOwnProperty(r))return t[r.length][r]}return null},hj=function(e,t,n){let r=e[t];if(0===r.tags.size){let e=cj(r.normal,n.two.suffixPatterns);if(null!==e)return YN(r,e,"2-suffix"),r.confidence=.7,!0;if(r.implicit&&(e=cj(r.implicit,n.two.suffixPatterns),null!==e))return YN(r,e,"2-implicit-suffix"),r.confidence=.7,!0}return null},dj=/['‘’‛‵′`´]/,pj=function(e,t){for(let n=0;n<t.length;n+=1)if(!0===t[n][0].test(e))return t[n];return null},fj=function(e,t,n,r){const i=r.methods.one.setTag;let{regexText:a,regexNormal:s,regexNumbers:o,endsWith:l}=n.two,u=e[t],c=u.machine||u.normal,h=u.text;dj.test(u.post)&&!dj.test(u.pre)&&(h+=u.post.trim());let d=pj(h,a)||pj(c,s);return!d&&/[0-9]/.test(c)&&(d=pj(c,o)),d||0!==u.tags.size||(d=function(e="",t){let n=e[e.length-1];if(!0===t.hasOwnProperty(n)){let r=t[n]||[];for(let t=0;t<r.length;t+=1)if(!0===r[t][0].test(e))return r[t]}return null}(c,l)),d?(i([u],d[1],r,null,`2-regex-'${d[2]||d[0]}'`),u.confidence=.6,!0):null},mj=function(e,t,n){let r=e[t];if(0===r.tags.size){let e=function(e="",t=[]){const n=e.length;let r=7;r>n-3&&(r=n-3);for(let n=r;n>2;n-=1){let r=e.substring(0,n);if(!0===t[r.length].hasOwnProperty(r))return t[r.length][r]}return null}(r.normal,n.two.prefixPatterns);if(null!==e)return YN(r,e,"2-prefix"),r.confidence=.5,!0}return null},gj=new Set(["in","on","by","until","for","to","during","throughout","through","within","before","after","of","this","next","last","circa","around","post","pre","budget","classic","plan","may"]),yj=function(e){if(!e)return!1;let t=e.normal||e.implicit;return!!gj.has(t)||!!(e.tags.has("Date")||e.tags.has("Month")||e.tags.has("WeekDay")||e.tags.has("Year"))||!!e.tags.has("ProperNoun")},vj=function(e){return!(!e||!e.tags.has("Ordinal")&&!(e.tags.has("Cardinal")&&e.normal.length<3)&&"is"!==e.normal&&"was"!==e.normal)},bj=function(e){return e&&(e.tags.has("Date")||e.tags.has("Month")||e.tags.has("WeekDay")||e.tags.has("Year"))},wj=function(e,t){const n=e[t];if(n.tags.has("NumericValue")&&n.tags.has("Cardinal")&&4===n.normal.length){let r=Number(n.normal);if(r&&!isNaN(r)&&r>1400&&r<2100){let i=e[t-1],a=e[t+1];if(yj(i)||yj(a))return YN(n,"Year","2-tagYear");if(r>=1920&&r<2025){if(vj(i)||vj(a))return YN(n,"Year","2-tagYear-close");if(bj(e[t-2])||bj(e[t+2]))return YN(n,"Year","2-tagYear-far");if(i&&(i.tags.has("Determiner")||i.tags.has("Possessive"))&&a&&a.tags.has("Noun")&&!a.tags.has("Plural"))return YN(n,"Year","2-tagYear-noun")}}}return null},_j=function(e,t,n,r){const i=r.methods.one.setTag,a=e[t];a.tags.has("Verb")&&(["PastTense","PresentTense","Auxiliary","Modal","Particle"].find((e=>a.tags.has(e)))||i([a],"Infinitive",r,null,"2-verb-type''"))},kj=/^[A-Z]('s|,)?$/,Aj=/^[A-Z-]+$/,Pj=/^[A-Z]+s$/,Tj=/([A-Z]\.)+[A-Z]?,?$/,Ij=/[A-Z]{2,}('s|,)?$/,Ej=/([a-z]\.)+[a-z]\.?$/,xj={I:!0,A:!0},Cj={la:!0,ny:!0,us:!0,dc:!0,gb:!0},Oj=function(e,t,n){let r=e[t];return r.tags.has("RomanNumeral")||r.tags.has("Acronym")||r.frozen?null:function(e,t){let n=e.text;if(!1===Aj.test(n)){if(!(n.length>3&&!0===Pj.test(n)))return!1;n=n.replace(/s$/,"")}return!(n.length>5||xj.hasOwnProperty(n)||t.one.lexicon.hasOwnProperty(e.normal)||!0!==Tj.test(n)&&!0!==Ej.test(n)&&!0!==kj.test(n)&&!0!==Ij.test(n))}(r,n)?(r.tags.clear(),YN(r,["Acronym","Noun"],"3-no-period-acronym"),!0===Cj[r.normal]&&YN(r,"Place","3-place-acronym"),!0===Pj.test(r.text)&&YN(r,"Plural","3-plural-acronym"),!0):!xj.hasOwnProperty(r.text)&&kj.test(r.text)?(r.tags.clear(),YN(r,["Acronym","Noun"],"3-one-letter-acronym"),!0):r.tags.has("Organization")&&r.text.length<=3?(YN(r,"Acronym","3-org-acronym"),!0):r.tags.has("Organization")&&Aj.test(r.text)&&r.text.length<=6?(YN(r,"Acronym","3-titlecase-acronym"),!0):null},Sj=function(e,t){if(!e)return null;let n=t.find((t=>e.normal===t[0]));return n?n[1]:null},Nj=function(e,t){if(!e)return null;let n=t.find((t=>e.tags.has(t[0])));return n?n[1]:null},jj=function(e,t,n){const{leftTags:r,leftWords:i,rightWords:a,rightTags:s}=n.two.neighbours;let o=e[t];if(0===o.tags.size){let l=null;if(l=l||Sj(e[t-1],i),l=l||Sj(e[t+1],a),l=l||Nj(e[t-1],r),l=l||Nj(e[t+1],s),l)return YN(o,l,"3-[neighbour]"),tj(e,t,n),e[t].confidence=.2,!0}return null},Dj=function(e,t,n){return!!e&&!e.tags.has("FirstName")&&!e.tags.has("Place")&&(!!(e.tags.has("ProperNoun")||e.tags.has("Organization")||e.tags.has("Acronym"))||!(n||!(e=>/^\p{Lu}[\p{Ll}'’]/u.test(e))(e.text))&&(0!==t||e.tags.has("Singular")))},Rj=function(e,t,n,r){const i=n.model.two.orgWords,a=n.methods.one.setTag;let s=e[t];if(!0===i[s.machine||s.normal]&&Dj(e[t-1],t-1,r)){a([e[t]],"Organization",n,null,"3-[org-word]");for(let i=t;i>=0&&Dj(e[i],i,r);i-=1)a([e[i]],"Organization",n,null,"3-[org-word]")}return null},Lj=/'s$/,Mj=new Set(["athletic","city","community","eastern","federal","financial","great","historic","historical","local","memorial","municipal","national","northern","provincial","southern","state","western","spring","pine","sunset","view","oak","maple","spruce","cedar","willow"]),$j=new Set(["center","centre","way","range","bar","bridge","field","pit"]),Fj=function(e,t,n){if(!e)return!1;let r=e.tags;return!(r.has("Organization")||r.has("Possessive")||Lj.test(e.normal))&&(!(!r.has("ProperNoun")&&!r.has("Place"))||!(n||!(e=>/^\p{Lu}[\p{Ll}'’]/u.test(e))(e.text))&&(0!==t||r.has("Singular")))},Vj=function(e,t,n,r){const i=n.model.two.placeWords,a=n.methods.one.setTag;let s=e[t],o=s.machine||s.normal;if(!0===i[o]){for(let i=t-1;i>=0;i-=1)if(!Mj.has(e[i].normal)){if(!Fj(e[i],i,r))break;a(e.slice(i,t+1),"Place",n,null,"3-[place-of-foo]")}if($j.has(o))return!1;for(let i=t+1;i<e.length;i+=1){if(Fj(e[i],i,r))return a(e.slice(t,i+1),"Place",n,null,"3-[foo-place]"),!0;if("of"!==e[i].normal&&!Mj.has(e[i].normal))break}}return null},zj=function(e,t,n){let r=!1,i=e[t].tags;(0===i.size||1===i.size&&(i.has("Hyphenated")||i.has("HashTag")||i.has("Prefix")||i.has("SlashedTerm")))&&(r=!0),r&&(YN(e[t],"Noun","3-[fallback]"),tj(e,t,n),e[t].confidence=.1)},Bj=/^[A-Z][a-z]/,Uj=(e,t)=>e[t].tags.has("ProperNoun")&&Bj.test(e[t].text)?"Noun":null,Hj=(e,t,n)=>0!==t||e[1]?null:n,Gj={"Adj|Gerund":(e,t)=>Uj(e,t),"Adj|Noun":(e,t)=>Uj(e,t)||function(e,t){return!e[t+1]&&e[t-1]&&e[t-1].tags.has("Determiner")?"Noun":null}(e,t),"Actor|Verb":(e,t)=>Uj(e,t),"Adj|Past":(e,t)=>Uj(e,t),"Adj|Present":(e,t)=>Uj(e,t),"Noun|Gerund":(e,t)=>Uj(e,t),"Noun|Verb":(e,t)=>t>0&&Uj(e,t)||Hj(e,t,"Infinitive"),"Plural|Verb":(e,t)=>Uj(e,t)||Hj(e,t,"PresentTense")||function(e,t,n){return 0===t&&e.length>3?"Plural":null}(e,t),"Person|Noun":(e,t)=>Uj(e,t),"Person|Verb":(e,t)=>0!==t?Uj(e,t):null,"Person|Adj":(e,t)=>0===t&&e.length>1||Uj(e,t)?"Person":null},qj=Gj,Kj="undefined"!=typeof process&&process.env?process.env:self.env||{},Wj=/^(under|over|mis|re|un|dis|semi)-?/,Jj=(e,t)=>{if(!e||!t)return null;let n=e.normal||e.implicit,r=null;return t.hasOwnProperty(n)&&(r=t[n]),r&&Kj.DEBUG_TAGS&&console.log(`\n  [2m[3m     ↓ - '${n}' [0m`),r},Zj=(e,t={},n)=>{if(!e||!t)return null;let r=Array.from(e.tags).sort(((e,t)=>(n[e]?n[e].parents.length:0)>(n[t]?n[t].parents.length:0)?-1:1)),i=r.find((e=>t[e]));return i&&Kj.DEBUG_TAGS&&console.log(`  [2m[3m      ↓ - '${e.normal||e.implicit}' (#${i})  [0m`),i=t[i],i},Qj=function(e,t,n){const r=n.model,i=n.methods.one.setTag,{switches:a,clues:s}=r.two,o=e[t];let l=o.normal||o.implicit||"";if(Wj.test(l)&&!a[l]&&(l=l.replace(Wj,"")),o.switch){let a=o.switch;if(o.tags.has("Acronym")||o.tags.has("PhrasalVerb"))return;let u=function(e,t,n,r){if(!n)return null;const i="also"!==e[t-1]?.text?t-1:Math.max(0,t-2),a=r.one.tagSet;let s=Jj(e[t+1],n.afterWords);return s=s||Jj(e[i],n.beforeWords),s=s||Zj(e[i],n.beforeTags,a),s=s||Zj(e[t+1],n.afterTags,a),s}(e,t,s[a],r);qj[a]&&(u=qj[a](e,t)||u),u?(i([o],u,n,null,`3-[switch] (${a})`),tj(e,t,r)):Kj.DEBUG_TAGS&&console.log(`\n -> X  - '${l}'  : (${a})  `)}},Xj={there:!0,this:!0,it:!0,him:!0,her:!0,us:!0},Yj=function(e){if(e.filter((e=>!e.tags.has("ProperNoun"))).length<=3)return!1;const t=/^[a-z]/;return e.every((e=>!t.test(e.text)))},eD=function(e,t,n,r){for(let i=0;i<e.length;i+=1)!0!==e[i].frozen&&(XN(e,i,t),!1===r&&uj(e,i,t),hj(e,i,t),fj(e,i,t,n),mj(e,i,t),wj(e,i))},tD=function(e,t,n,r){for(let n=0;n<e.length;n+=1){let r=Oj(e,n,t);tj(e,n,t),r=r||jj(e,n,t),r=r||zj(e,n,t)}for(let t=0;t<e.length;t+=1)!0!==e[t].frozen&&(Rj(e,t,n,r),Vj(e,t,n,r),Qj(e,t,n),_j(e,t,0,n),ZN(e,t,0,n));!function(e,t){const n=t.methods.one.setTag,r=t.model.one._multiCache||{};let i=e[0];if(("Noun|Verb"===i.switch||i.tags.has("Infinitive"))&&e.length>=2){if(e.length<4&&!Xj[e[1].normal])return;if(!i.tags.has("PhrasalVerb")&&r.hasOwnProperty(i.normal))return;(e[1].tags.has("Noun")||e[1].tags.has("Determiner"))&&(e.slice(1,3).some((e=>e.tags.has("Verb")))&&!i.tags.has("#PhrasalVerb")||n([i],"Imperative",t,null,"3-[imperative]"))}}(e,n)},nD={Possessive:e=>{let t=e.machine||e.normal||e.text;return t=t.replace(/'s$/,""),t},Plural:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.noun.toSingular(n,t.model)},Copula:()=>"is",PastTense:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.verb.toInfinitive(n,t.model,"PastTense")},Gerund:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.verb.toInfinitive(n,t.model,"Gerund")},PresentTense:(e,t)=>{let n=e.machine||e.normal||e.text;return e.tags.has("Infinitive")?n:t.methods.two.transform.verb.toInfinitive(n,t.model,"PresentTense")},Comparative:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.adjective.fromComparative(n,t.model)},Superlative:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.adjective.fromSuperlative(n,t.model)},Adverb:(e,t)=>{const{fromAdverb:n}=t.methods.two.transform.adjective;return n(e.machine||e.normal||e.text)}},rD={Adverb:"RB",Comparative:"JJR",Superlative:"JJS",Adjective:"JJ",TO:"Conjunction",Modal:"MD",Auxiliary:"MD",Gerund:"VBG",PastTense:"VBD",Participle:"VBN",PresentTense:"VBZ",Infinitive:"VB",Particle:"RP",Verb:"VB",Pronoun:"PRP",Cardinal:"CD",Conjunction:"CC",Determiner:"DT",Preposition:"IN",QuestionWord:"WP",Expression:"UH",Possessive:"POS",ProperNoun:"NNP",Person:"NNP",Place:"NNP",Organization:"NNP",Singular:"NN",Plural:"NNS",Noun:"NN",There:"EX"},iD={preTagger:function(e){const{methods:t,model:n,world:r}=e;let i=e.docs;!function(e,t,n){e.forEach((e=>{!function(e,t,n,r){const i=r.methods.one.setTag;if(e.length>=3){const t=/:/;if(e[0].post.match(t)){let t=e[1];if(t.tags.has("Value")||t.tags.has("Email")||t.tags.has("PhoneNumber"))return;i([e[0]],"Expression",r,null,"2-punct-colon''")}}}(e,0,0,n)}))}(i,0,r);let a=t.two.quickSplit(i);for(let e=0;e<a.length;e+=1){let t=a[e];const i=Yj(t);eD(t,n,r,i),tD(t,n,r,i)}return a},root:function(e){const t=e.world,n=Object.keys(nD);e.docs.forEach((e=>{for(let r=0;r<e.length;r+=1){const i=e[r];for(let e=0;e<n.length;e+=1)if(i.tags.has(n[e])){let r=(0,nD[n[e]])(i,t);i.normal!==r&&(i.root=r);break}}}))},penn:function(e){e.compute("tagRank"),e.docs.forEach((e=>{e.forEach((e=>{e.penn=function(e){if(e.tags.has("ProperNoun")&&e.tags.has("Plural"))return"NNPS";if(e.tags.has("Possessive")&&e.tags.has("Pronoun"))return"PRP$";if("there"===e.normal)return"EX";if("to"===e.normal)return"TO";let t=e.tagRank||[];for(let e=0;e<t.length;e+=1)if(rD.hasOwnProperty(t[e]))return rD[t[e]];return null}(e)}))}))}},aD=["Person","Place","Organization"],sD={Noun:{not:["Verb","Adjective","Adverb","Value","Determiner"]},Singular:{is:"Noun",not:["Plural","Uncountable"]},ProperNoun:{is:"Noun"},Person:{is:"Singular",also:["ProperNoun"],not:["Place","Organization","Date"]},FirstName:{is:"Person"},MaleName:{is:"FirstName",not:["FemaleName","LastName"]},FemaleName:{is:"FirstName",not:["MaleName","LastName"]},LastName:{is:"Person",not:["FirstName"]},Honorific:{is:"Person",not:["FirstName","LastName","Value"]},Place:{is:"Singular",not:["Person","Organization"]},Country:{is:"Place",also:["ProperNoun"],not:["City"]},City:{is:"Place",also:["ProperNoun"],not:["Country"]},Region:{is:"Place",also:["ProperNoun"]},Address:{},Organization:{is:"ProperNoun",not:["Person","Place"]},SportsTeam:{is:"Organization"},School:{is:"Organization"},Company:{is:"Organization"},Plural:{is:"Noun",not:["Singular","Uncountable"]},Uncountable:{is:"Noun"},Pronoun:{is:"Noun",not:aD},Actor:{is:"Noun",not:["Place","Organization"]},Activity:{is:"Noun",not:["Person","Place"]},Unit:{is:"Noun",not:aD},Demonym:{is:"Noun",also:["ProperNoun"],not:aD},Possessive:{is:"Noun"},Reflexive:{is:"Pronoun"}};let oD=Object.assign({},sD,{Verb:{not:["Noun","Adjective","Adverb","Value","Expression"]},PresentTense:{is:"Verb",not:["PastTense","FutureTense"]},Infinitive:{is:"PresentTense",not:["Gerund"]},Imperative:{is:"Verb",not:["PastTense","Gerund","Copula"]},Gerund:{is:"PresentTense",not:["Copula"]},PastTense:{is:"Verb",not:["PresentTense","Gerund","FutureTense"]},FutureTense:{is:"Verb",not:["PresentTense","PastTense"]},Copula:{is:"Verb"},Modal:{is:"Verb",not:["Infinitive"]},Participle:{is:"PastTense"},Auxiliary:{is:"Verb",not:["PastTense","PresentTense","Gerund","Conjunction"]},PhrasalVerb:{is:"Verb"},Particle:{is:"PhrasalVerb",not:["PastTense","PresentTense","Copula","Gerund"]},Passive:{is:"Verb"}},{Value:{not:["Verb","Adjective","Adverb"]},Ordinal:{is:"Value",not:["Cardinal"]},Cardinal:{is:"Value",not:["Ordinal"]},Fraction:{is:"Value",not:["Noun"]},Multiple:{is:"TextValue"},RomanNumeral:{is:"Cardinal",not:["TextValue"]},TextValue:{is:"Value",not:["NumericValue"]},NumericValue:{is:"Value",not:["TextValue"]},Money:{is:"Cardinal"},Percent:{is:"Value"}},{Date:{not:["Verb","Adverb","Adjective"]},Month:{is:"Date",also:["Noun"],not:["Year","WeekDay","Time"]},WeekDay:{is:"Date",also:["Noun"]},Year:{is:"Date",not:["RomanNumeral"]},FinancialQuarter:{is:"Date",not:"Fraction"},Holiday:{is:"Date",also:["Noun"]},Season:{is:"Date"},Timezone:{is:"Date",also:["Noun"],not:["ProperNoun"]},Time:{is:"Date",not:["AtMention"]},Duration:{is:"Date",also:["Noun"]}},{Adjective:{not:["Noun","Verb","Adverb","Value"]},Comparable:{is:"Adjective"},Comparative:{is:"Adjective"},Superlative:{is:"Adjective",not:["Comparative"]},NumberRange:{},Adverb:{not:["Noun","Verb","Adjective","Value"]},Determiner:{not:["Noun","Verb","Adjective","Adverb","QuestionWord","Conjunction"]},Conjunction:{not:["Noun","Verb","Adjective","Adverb","Value","QuestionWord"]},Preposition:{not:["Noun","Verb","Adjective","Adverb","QuestionWord","Determiner"]},QuestionWord:{not:["Determiner"]},Currency:{is:"Noun"},Expression:{not:["Noun","Adjective","Verb","Adverb"]},Abbreviation:{},Url:{not:["HashTag","PhoneNumber","Verb","Adjective","Value","AtMention","Email","SlashedTerm"]},PhoneNumber:{not:["HashTag","Verb","Adjective","Value","AtMention","Email"]},HashTag:{},AtMention:{is:"Noun",not:["HashTag","Email"]},Emoji:{not:["HashTag","Verb","Adjective","Value","AtMention"]},Emoticon:{not:["HashTag","Verb","Adjective","Value","AtMention","SlashedTerm"]},SlashedTerm:{not:["Emoticon","Url","Value"]},Email:{not:["HashTag","Verb","Adjective","Value","AtMention"]},Acronym:{not:["Plural","RomanNumeral","Pronoun","Date"]},Negative:{not:["Noun","Adjective","Value","Expression"]},Condition:{not:["Verb","Adjective","Noun","Value"]},There:{not:["Verb","Adjective","Noun","Value","Conjunction","Preposition"]},Prefix:{not:["Abbreviation","Acronym","ProperNoun"]},Hyphenated:{}});const lD={compute:iD,methods:BN,model:JN,tags:oD,hooks:["preTagger"]},uD=/[,)"';:\-–—.…]/,cD=function(e,t){if(!e.found)return;let n=e.termList();for(let e=0;e<n.length-1;e++){const t=n[e];if(uD.test(t.post))return}n[0].implicit=n[0].normal,n[0].text+=t,n[0].normal+=t,n.slice(1).forEach((e=>{e.implicit=e.normal,e.text="",e.normal=""}));for(let e=0;e<n.length-1;e++)n[e].post=n[e].post.replace(/ /,"")},hD=function(){let e=this.not("@hasContraction"),t=e.match("(we|they|you) are");return cD(t,"'re"),t=e.match("(he|she|they|it|we|you) will"),cD(t,"'ll"),t=e.match("(he|she|they|it|we) is"),cD(t,"'s"),t=e.match("#Person is"),cD(t,"'s"),t=e.match("#Person would"),cD(t,"'d"),t=e.match("(is|was|had|would|should|could|do|does|have|has|can) not"),cD(t,"n't"),t=e.match("(i|we|they) have"),cD(t,"'ve"),t=e.match("(would|should|could) have"),cD(t,"'ve"),t=e.match("i am"),cD(t,"'m"),t=e.match("going to"),this},dD=/^\p{Lu}[\p{Ll}'’]/u,pD=function(e,t,n){let[r,i]=t;n&&0!==n.length&&(n=n.map(((e,t)=>(e.implicit=e.text,e.machine=e.text,e.pre="",e.post="",e.text="",e.normal="",e.index=[r,i+t],e))),n[0]&&(n[0].pre=e[r][i].pre,n[n.length-1].post=e[r][i].post,n[0].text=e[r][i].text,n[0].normal=e[r][i].normal),e[r].splice(i,1,...n))},fD=/'/,mD=new Set(["been","become"]),gD=new Set(["what","how","when","if","too"]);let yD=new Set(["too","also","enough"]);const vD=/'/,bD=new Set(["better","done","before","it","had"]),wD=new Set(["have","be"]),_D={that:!0,there:!0,let:!0,here:!0,everywhere:!0},kD={in:!0,by:!0,for:!0};let AD=new Set(["too","also","enough","about"]),PD=new Set(["is","are","did","were","could","should","must","had","have"]);const TD=/'/,ID=function(e,t,n,r){let i=t.update();i.document=[e];let a=n+r;n>0&&(n-=1),e[a]&&(a+=1),i.ptrs=[[0,n,a]],i.compute(["freeze","lexicon","preTagger","unfreeze"]),function(e){e.forEach(((e,t)=>{e.index&&(e.index[1]=t)}))}(e)},ED={d:(e,t)=>function(e,t){let n=e[t].normal.split(vD)[0];return"how"===n||"what"===n?[n,"did"]:"had"===((e,t)=>{for(let n=t+1;n<e.length;n+=1){let t=e[n];if(bD.has(t.normal))return"had";if(wD.has(t.normal))return"would";if(t.tags.has("PastTense")||"Adj|Past"===t.switch)return"had";if(t.tags.has("PresentTense")||t.tags.has("Infinitive"))return"would";if(t.tags.has("#Determiner"))return"had";if(t.tags.has("Adjective"))return"would"}return!1})(e,t)?[n,"had"]:[n,"would"]}(e,t),t:(e,t)=>function(e,t){if("ain't"===e[t].normal||"aint"===e[t].normal){if(e[t+1]&&"never"===e[t+1].normal)return["have"];let n=function(e,t){for(let n=t-1;n>=0;n-=1)if(e[n].tags.has("Noun")||e[n].tags.has("Pronoun")||e[n].tags.has("Plural")||e[n].tags.has("Singular"))return e[n];return null}(e,t);if(n){if("we"===n.normal||"they"===n.normal)return["are","not"];if("i"===n.normal)return["am","not"];if(n.tags&&n.tags.has("Plural"))return["are","not"]}return["is","not"]}return[e[t].normal.replace(/n't/,""),"not"]}(e,t),s:(e,t,n)=>((e,t)=>{let n=e[t];if(_D.hasOwnProperty(n.machine||n.normal))return!1;if(n.tags.has("Possessive"))return!0;if(n.tags.has("QuestionWord"))return!1;if("he's"===n.normal||"she's"===n.normal)return!1;let r=e[t+1];if(!r)return!0;if("it's"===n.normal)return!!r.tags.has("#Noun");if("Noun|Gerund"==r.switch){let r=e[t+2];return r?!!r.tags.has("Copula")||("on"===r.normal||r.normal,!1):!(!n.tags.has("Actor")&&!n.tags.has("ProperNoun"))}if(r.tags.has("Verb"))return!!r.tags.has("Infinitive")||!r.tags.has("Gerund")&&!!r.tags.has("PresentTense");if("Adj|Noun"===r.switch){let n=e[t+2];if(!n)return!1;if(PD.has(n.normal))return!0;if(AD.has(n.normal))return!1}if(r.tags.has("Noun")){let e=r.machine||r.normal;return!("here"===e||"there"===e||"everywhere"===e||r.tags.has("Possessive")||r.tags.has("ProperNoun")&&!n.tags.has("ProperNoun"))}if(e[t-1]&&!0===kD[e[t-1].normal])return!0;if(r.tags.has("Adjective")){let n=e[t+2];if(!n)return!1;if(n.tags.has("Noun")&&!n.tags.has("Pronoun")){let e=r.normal;return"above"!==e&&"below"!==e&&"behind"!==e}return"Noun|Verb"===n.switch}return!!r.tags.has("Value")})(e,t)?n.methods.one.setTag([e[t]],"Possessive",n,null,"2-contraction"):function(e,t){let n=e[t].normal.split(fD)[0];if("let"===n)return[n,"us"];if("there"===n){let r=e[t+1];if(r&&r.tags.has("Plural"))return[n,"are"]}return"has"===((e,t)=>{for(let n=t+1;n<e.length;n+=1){let t=e[n];if(mD.has(t.normal))return"has";if(gD.has(t.normal))return"is";if(t.tags.has("Gerund"))return"is";if(t.tags.has("Determiner"))return"is";if(t.tags.has("Adjective"))return"is";if("Adj|Past"===t.switch&&e[n+1]){if(yD.has(e[n+1].normal))return"is";if(e[n+1].tags.has("Preposition"))return"is"}if(t.tags.has("PastTense"))return e[n+1]&&"for"===e[n+1].normal?"is":"has"}return"is"})(e,t)?[n,"has"]:[n,"is"]}(e,t)},xD=function(e,t){let n=t.fromText(e.join(" "));return n.compute("id"),n.docs[0]},CD={contractionTwo:e=>{let{world:t,document:n}=e;n.forEach(((r,i)=>{for(let a=r.length-1;a>=0;a-=1){if(r[a].implicit)continue;let s=null;!0===TD.test(r[a].normal)&&(s=r[a].normal.split(TD)[1]);let o=null;ED.hasOwnProperty(s)&&(o=ED[s](r,a,t)),o&&(o=xD(o,e),pD(n,[i,a],o),ID(n[i],e,a,o.length))}}))}},OD={compute:CD,api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Contraction"}expand(){return this.docs.forEach((e=>{let t=dD.test(e[0].text);e.forEach(((t,n)=>{t.text=t.implicit||"",delete t.implicit,n<e.length-1&&""===t.post&&(t.post+=" "),t.dirty=!0})),t&&(e[0].text=function(e=""){return e.replace(/^ *[a-z\u00C0-\u00FF]/,(e=>e.toUpperCase()))}(e[0].text))})),this.compute("normal"),this}}e.prototype.contractions=function(){let e=this.match("@hasContraction+");return new t(this.document,e.pointer)},e.prototype.contract=hD},hooks:["contractionTwo"]},SD="(hard|fast|late|early|high|right|deep|close|direct)",ND="(i|we|they)";let jD=[].concat([{match:"(got|were|was|is|are|am) (#PastTense|#Participle)",tag:"Passive",reason:"got-walked"},{match:"(was|were|is|are|am) being (#PastTense|#Participle)",tag:"Passive",reason:"was-being"},{match:"(had|have|has) been (#PastTense|#Participle)",tag:"Passive",reason:"had-been"},{match:"will be being? (#PastTense|#Participle)",tag:"Passive",reason:"will-be-cleaned"},{match:"#Noun [(#PastTense|#Participle)] by (the|a) #Noun",group:0,tag:"Passive",reason:"suffered-by"}],[{match:"[(all|both)] #Determiner #Noun",group:0,tag:"Noun",reason:"all-noun"},{match:"#Copula [(just|alone)]$",group:0,tag:"Adjective",reason:"not-adverb"},{match:"#Singular is #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"is-filled"},{match:"[#PastTense] #Singular is",group:0,tag:"Adjective",reason:"smoked-poutine"},{match:"[#PastTense] #Plural are",group:0,tag:"Adjective",reason:"baked-onions"},{match:"well [#PastTense]",group:0,tag:"Adjective",reason:"well-made"},{match:"#Copula [fucked up?]",group:0,tag:"Adjective",reason:"swears-adjective"},{match:"#Singular (seems|appears) #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"seems-filled"},{match:"#Copula #Adjective? [(out|in|through)]$",group:0,tag:"Adjective",reason:"still-out"},{match:"^[#Adjective] (the|your) #Noun",group:0,notIf:"(all|even)",tag:"Infinitive",reason:"shut-the"},{match:"the [said] #Noun",group:0,tag:"Adjective",reason:"the-said-card"},{match:"[#Hyphenated (#Hyphenated && #PastTense)] (#Noun|#Conjunction)",group:0,tag:"Adjective",notIf:"#Adverb",reason:"faith-based"},{match:"[#Hyphenated (#Hyphenated && #Gerund)] (#Noun|#Conjunction)",group:0,tag:"Adjective",notIf:"#Adverb",reason:"self-driving"},{match:"[#PastTense (#Hyphenated && #PhrasalVerb)] (#Noun|#Conjunction)",group:0,tag:"Adjective",reason:"dammed-up"},{match:"(#Hyphenated && #Value) fold",tag:"Adjective",reason:"two-fold"},{match:"must (#Hyphenated && #Infinitive)",tag:"Adjective",reason:"must-win"},{match:"(#Hyphenated && #Infinitive) #Hyphenated",tag:"Adjective",notIf:"#PhrasalVerb",reason:"vacuum-sealed"},{match:"too much",tag:"Adverb Adjective",reason:"bit-4"},{match:"a bit much",tag:"Determiner Adverb Adjective",reason:"bit-3"},{match:"[(un|contra|extra|inter|intra|macro|micro|mid|mis|mono|multi|pre|sub|tri|ex)] #Adjective",group:0,tag:["Adjective","Prefix"],reason:"un-skilled"}],[{match:"#Adverb [#Adverb] (and|or|then)",group:0,tag:"Adjective",reason:"kinda-sparkly-and"},{match:"[(dark|bright|flat|light|soft|pale|dead|dim|faux|little|wee|sheer|most|near|good|extra|all)] #Adjective",group:0,tag:"Adverb",reason:"dark-green"},{match:"#Copula [far too] #Adjective",group:0,tag:"Adverb",reason:"far-too"},{match:"#Copula [still] (in|#Gerund|#Adjective)",group:0,tag:"Adverb",reason:"was-still-walking"},{match:`#Plural ${SD}`,tag:"#PresentTense #Adverb",reason:"studies-hard"},{match:`#Verb [${SD}] !#Noun?`,group:0,notIf:"(#Copula|get|got|getting|become|became|becoming|feel|feels|feeling|#Determiner|#Preposition)",tag:"Adverb",reason:"shops-direct"},{match:"[#Plural] a lot",tag:"PresentTense",reason:"studies-a-lot"}],[{match:"as [#Gerund] as",group:0,tag:"Adjective",reason:"as-gerund-as"},{match:"more [#Gerund] than",group:0,tag:"Adjective",reason:"more-gerund-than"},{match:"(so|very|extremely) [#Gerund]",group:0,tag:"Adjective",reason:"so-gerund"},{match:"(found|found) it #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"found-it-gerund"},{match:"a (little|bit|wee) bit? [#Gerund]",group:0,tag:"Adjective",reason:"a-bit-gerund"},{match:"#Gerund [#Gerund]",group:0,tag:"Adjective",notIf:"(impersonating|practicing|considering|assuming)",reason:"looking-annoying"},{match:"(looked|look|looks) #Adverb? [%Adj|Gerund%]",group:0,tag:"Adjective",notIf:"(impersonating|practicing|considering|assuming)",reason:"looked-amazing"},{match:"[%Adj|Gerund%] #Determiner",group:0,tag:"Gerund",reason:"developing-a"},{match:"#Possessive [%Adj|Gerund%] #Noun",group:0,tag:"Adjective",reason:"leading-manufacturer"},{match:"%Noun|Gerund% %Adj|Gerund%",tag:"Gerund #Adjective",reason:"meaning-alluring"},{match:"(face|embrace|reveal|stop|start|resume) %Adj|Gerund%",tag:"#PresentTense #Adjective",reason:"face-shocking"},{match:"(are|were) [%Adj|Gerund%] #Plural",group:0,tag:"Adjective",reason:"are-enduring-symbols"}],[{match:"#Determiner [#Adjective] #Copula",group:0,tag:"Noun",reason:"the-adj-is"},{match:"#Adjective [#Adjective] #Copula",group:0,tag:"Noun",reason:"adj-adj-is"},{match:"(his|its) [%Adj|Noun%]",group:0,tag:"Noun",notIf:"#Hyphenated",reason:"his-fine"},{match:"#Copula #Adverb? [all]",group:0,tag:"Noun",reason:"is-all"},{match:"(have|had) [#Adjective] #Preposition .",group:0,tag:"Noun",reason:"have-fun"},{match:"#Gerund (giant|capital|center|zone|application)",tag:"Noun",reason:"brewing-giant"},{match:"#Preposition (a|an) [#Adjective]$",group:0,tag:"Noun",reason:"an-instant"},{match:"no [#Adjective] #Modal",group:0,tag:"Noun",reason:"no-golden"},{match:"[brand #Gerund?] new",group:0,tag:"Adverb",reason:"brand-new"},{match:"(#Determiner|#Comparative|new|different) [kind]",group:0,tag:"Noun",reason:"some-kind"},{match:"#Possessive [%Adj|Noun%] #Noun",group:0,tag:"Adjective",reason:"her-favourite"},{match:"must && #Hyphenated .",tag:"Adjective",reason:"must-win"},{match:"#Determiner [#Adjective]$",tag:"Noun",notIf:"(this|that|#Comparative|#Superlative)",reason:"the-south"},{match:"(#Noun && #Hyphenated) (#Adjective && #Hyphenated)",tag:"Adjective",notIf:"(this|that|#Comparative|#Superlative)",reason:"company-wide"},{match:"#Determiner [#Adjective] (#Copula|#Determiner)",notIf:"(#Comparative|#Superlative)",group:0,tag:"Noun",reason:"the-poor"},{match:"[%Adj|Noun%] #Noun",notIf:"(#Pronoun|#ProperNoun)",group:0,tag:"Adjective",reason:"stable-foundations"}],[{match:"[still] #Adjective",group:0,tag:"Adverb",reason:"still-advb"},{match:"[still] #Verb",group:0,tag:"Adverb",reason:"still-verb"},{match:"[so] #Adjective",group:0,tag:"Adverb",reason:"so-adv"},{match:"[way] #Comparative",group:0,tag:"Adverb",reason:"way-adj"},{match:"[way] #Adverb #Adjective",group:0,tag:"Adverb",reason:"way-too-adj"},{match:"[all] #Verb",group:0,tag:"Adverb",reason:"all-verb"},{match:"#Verb  [like]",group:0,notIf:"(#Modal|#PhrasalVerb)",tag:"Adverb",reason:"verb-like"},{match:"(barely|hardly) even",tag:"Adverb",reason:"barely-even"},{match:"[even] #Verb",group:0,tag:"Adverb",reason:"even-walk"},{match:"[even] #Comparative",group:0,tag:"Adverb",reason:"even-worse"},{match:"[even] (#Determiner|#Possessive)",group:0,tag:"#Adverb",reason:"even-the"},{match:"even left",tag:"#Adverb #Verb",reason:"even-left"},{match:"[way] #Adjective",group:0,tag:"#Adverb",reason:"way-over"},{match:"#PresentTense [(hard|quick|bright|slow|fast|backwards|forwards)]",notIf:"#Copula",group:0,tag:"Adverb",reason:"lazy-ly"},{match:"[much] #Adjective",group:0,tag:"Adverb",reason:"bit-1"},{match:"#Copula [#Adverb]$",group:0,tag:"Adjective",reason:"is-well"},{match:"a [(little|bit|wee) bit?] #Adjective",group:0,tag:"Adverb",reason:"a-bit-cold"},{match:"[(super|pretty)] #Adjective",group:0,tag:"Adverb",reason:"super-strong"},{match:"(become|fall|grow) #Adverb? [#PastTense]",group:0,tag:"Adjective",reason:"overly-weakened"},{match:"(a|an) #Adverb [#Participle] #Noun",group:0,tag:"Adjective",reason:"completely-beaten"},{match:"#Determiner #Adverb? [close]",group:0,tag:"Adjective",reason:"a-close"},{match:"#Gerund #Adverb? [close]",group:0,tag:"Adverb",notIf:"(getting|becoming|feeling)",reason:"being-close"},{match:"(the|those|these|a|an) [#Participle] #Noun",group:0,tag:"Adjective",reason:"blown-motor"},{match:"(#PresentTense|#PastTense) [back]",group:0,tag:"Adverb",notIf:"(#PhrasalVerb|#Copula)",reason:"charge-back"},{match:"#Verb [around]",group:0,tag:"Adverb",notIf:"#PhrasalVerb",reason:"send-around"},{match:"[later] #PresentTense",group:0,tag:"Adverb",reason:"later-say"},{match:"#Determiner [well] !#PastTense?",group:0,tag:"Noun",reason:"the-well"},{match:"#Adjective [enough]",group:0,tag:"Adverb",reason:"high-enough"}],[{match:"[sun] the #Ordinal",tag:"WeekDay",reason:"sun-the-5th"},{match:"[sun] #Date",group:0,tag:"WeekDay",reason:"sun-feb"},{match:"#Date (on|this|next|last|during)? [sun]",group:0,tag:"WeekDay",reason:"1pm-sun"},{match:"(in|by|before|during|on|until|after|of|within|all) [sat]",group:0,tag:"WeekDay",reason:"sat"},{match:"(in|by|before|during|on|until|after|of|within|all) [wed]",group:0,tag:"WeekDay",reason:"wed"},{match:"(in|by|before|during|on|until|after|of|within|all) [march]",group:0,tag:"Month",reason:"march"},{match:"[sat] #Date",group:0,tag:"WeekDay",reason:"sat-feb"},{match:"#Preposition [(march|may)]",group:0,tag:"Month",reason:"in-month"},{match:"(this|next|last) (march|may) !#Infinitive?",tag:"#Date #Month",reason:"this-month"},{match:"(march|may) the? #Value",tag:"#Month #Date #Date",reason:"march-5th"},{match:"#Value of? (march|may)",tag:"#Date #Date #Month",reason:"5th-of-march"},{match:"[(march|may)] .? #Date",group:0,tag:"Month",reason:"march-and-feb"},{match:"#Date .? [(march|may)]",group:0,tag:"Month",reason:"feb-and-march"},{match:"#Adverb [(march|may)]",group:0,tag:"Verb",reason:"quickly-march"},{match:"[(march|may)] #Adverb",group:0,tag:"Verb",reason:"march-quickly"},{match:"#Value (am|pm)",tag:"Time",reason:"2-am"}],[{match:"#Holiday (day|eve)",tag:"Holiday",reason:"holiday-day"},{match:"#Value of #Month",tag:"Date",reason:"value-of-month"},{match:"#Cardinal #Month",tag:"Date",reason:"cardinal-month"},{match:"#Month #Value to #Value",tag:"Date",reason:"value-to-value"},{match:"#Month the #Value",tag:"Date",reason:"month-the-value"},{match:"(#WeekDay|#Month) #Value",tag:"Date",reason:"date-value"},{match:"#Value (#WeekDay|#Month)",tag:"Date",reason:"value-date"},{match:"(#TextValue && #Date) #TextValue",tag:"Date",reason:"textvalue-date"},{match:"#Month #NumberRange",tag:"Date",reason:"aug 20-21"},{match:"#WeekDay #Month #Ordinal",tag:"Date",reason:"week mm-dd"},{match:"#Month #Ordinal #Cardinal",tag:"Date",reason:"mm-dd-yyy"},{match:"(#Place|#Demonmym|#Time) (standard|daylight|central|mountain)? time",tag:"Timezone",reason:"std-time"},{match:"(eastern|mountain|pacific|central|atlantic) (standard|daylight|summer)? time",tag:"Timezone",reason:"eastern-time"},{match:"#Time [(eastern|mountain|pacific|central|est|pst|gmt)]",group:0,tag:"Timezone",reason:"5pm-central"},{match:"(central|western|eastern) european time",tag:"Timezone",reason:"cet"}],[{match:"(the|any) [more]",group:0,tag:"Singular",reason:"more-noun"},{match:"[more] #Noun",group:0,tag:"Adjective",reason:"more-noun"},{match:"(right|rights) of .",tag:"Noun",reason:"right-of"},{match:"a [bit]",group:0,tag:"Singular",reason:"bit-2"},{match:"a [must]",group:0,tag:"Singular",reason:"must-2"},{match:"(we|us) [all]",group:0,tag:"Noun",reason:"we all"},{match:"due to [#Verb]",group:0,tag:"Noun",reason:"due-to"},{match:"some [#Verb] #Plural",group:0,tag:"Noun",reason:"determiner6"},{match:"#Possessive #Ordinal [#PastTense]",group:0,tag:"Noun",reason:"first-thought"},{match:"(the|this|those|these) #Adjective [%Verb|Noun%]",group:0,tag:"Noun",notIf:"#Copula",reason:"the-adj-verb"},{match:"(the|this|those|these) #Adverb #Adjective [#Verb]",group:0,tag:"Noun",reason:"determiner4"},{match:"the [#Verb] #Preposition .",group:0,tag:"Noun",reason:"determiner1"},{match:"(a|an|the) [#Verb] of",group:0,tag:"Noun",reason:"the-verb-of"},{match:"#Determiner #Noun of [#Verb]",group:0,tag:"Noun",notIf:"#Gerund",reason:"noun-of-noun"},{match:"#PastTense #Preposition [#PresentTense]",group:0,notIf:"#Gerund",tag:"Noun",reason:"ended-in-ruins"},{match:"#Conjunction [u]",group:0,tag:"Pronoun",reason:"u-pronoun-2"},{match:"[u] #Verb",group:0,tag:"Pronoun",reason:"u-pronoun-1"},{match:"#Determiner [(western|eastern|northern|southern|central)] #Noun",group:0,tag:"Noun",reason:"western-line"},{match:"(#Singular && @hasHyphen) #PresentTense",tag:"Noun",reason:"hyphen-verb"},{match:"is no [#Verb]",group:0,tag:"Noun",reason:"is-no-verb"},{match:"do [so]",group:0,tag:"Noun",reason:"so-noun"},{match:"#Determiner [(shit|damn|hell)]",group:0,tag:"Noun",reason:"swears-noun"},{match:"to [(shit|hell)]",group:0,tag:"Noun",reason:"to-swears"},{match:"(the|these) [#Singular] (were|are)",group:0,tag:"Plural",reason:"singular-were"},{match:"a #Noun+ or #Adverb+? [#Verb]",group:0,tag:"Noun",reason:"noun-or-noun"},{match:"(the|those|these|a|an) #Adjective? [#PresentTense #Particle?]",group:0,tag:"Noun",notIf:"(seem|appear|include|#Gerund|#Copula)",reason:"det-inf"},{match:"#Noun #Actor",tag:"Actor",notIf:"(#Person|#Pronoun)",reason:"thing-doer"},{match:"#Gerund #Actor",tag:"Actor",reason:"gerund-doer"},{match:"co #Singular",tag:"Actor",reason:"co-noun"},{match:"[#Noun+] #Actor",group:0,tag:"Actor",notIf:"(#Honorific|#Pronoun|#Possessive)",reason:"air-traffic-controller"},{match:"(urban|cardiac|cardiovascular|respiratory|medical|clinical|visual|graphic|creative|dental|exotic|fine|certified|registered|technical|virtual|professional|amateur|junior|senior|special|pharmaceutical|theoretical)+ #Noun? #Actor",tag:"Actor",reason:"fine-artist"},{match:"#Noun+ (coach|chef|king|engineer|fellow|personality|boy|girl|man|woman|master)",tag:"Actor",reason:"dance-coach"},{match:"chief . officer",tag:"Actor",reason:"chief-x-officer"},{match:"chief of #Noun+",tag:"Actor",reason:"chief-of-police"},{match:"senior? vice? president of #Noun+",tag:"Actor",reason:"president-of"},{match:"#Determiner [sun]",group:0,tag:"Singular",reason:"the-sun"},{match:"#Verb (a|an) [#Value]$",group:0,tag:"Singular",reason:"did-a-value"},{match:"the [(can|will|may)]",group:0,tag:"Singular",reason:"the can"},{match:"#FirstName #Acronym? (#Possessive && #LastName)",tag:"Possessive",reason:"name-poss"},{match:"#Organization+ #Possessive",tag:"Possessive",reason:"org-possessive"},{match:"#Place+ #Possessive",tag:"Possessive",reason:"place-possessive"},{match:"#Possessive #PresentTense #Particle?",notIf:"(#Gerund|her)",tag:"Noun",reason:"possessive-verb"},{match:"(my|our|their|her|his|its) [(#Plural && #Actor)] #Noun",tag:"Possessive",reason:"my-dads"},{match:"#Value of a [second]",group:0,unTag:"Value",tag:"Singular",reason:"10th-of-a-second"},{match:"#Value [seconds]",group:0,unTag:"Value",tag:"Plural",reason:"10-seconds"},{match:"in [#Infinitive]",group:0,tag:"Singular",reason:"in-age"},{match:"a [#Adjective] #Preposition",group:0,tag:"Noun",reason:"a-minor-in"},{match:"#Determiner [#Singular] said",group:0,tag:"Actor",reason:"the-actor-said"},{match:"#Determiner #Noun [(feel|sense|process|rush|side|bomb|bully|challenge|cover|crush|dump|exchange|flow|function|issue|lecture|limit|march|process)] !(#Preposition|to|#Adverb)?",group:0,tag:"Noun",reason:"the-noun-sense"},{match:"[#PresentTense] (of|by|for) (a|an|the) #Noun #Copula",group:0,tag:"Plural",reason:"photographs-of"},{match:"#Infinitive and [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"fight and win"},{match:"#Noun and [#Verb] and #Noun",group:0,tag:"Noun",reason:"peace-and-flowers"},{match:"the #Cardinal [%Adj|Noun%]",group:0,tag:"Noun",reason:"the-1992-classic"},{match:"#Copula the [%Adj|Noun%] #Noun",group:0,tag:"Adjective",reason:"the-premier-university"},{match:"i #Verb [me] #Noun",group:0,tag:"Possessive",reason:"scottish-me"},{match:"[#PresentTense] (music|class|lesson|night|party|festival|league|ceremony)",group:0,tag:"Noun",reason:"dance-music"},{match:"[wit] (me|it)",group:0,tag:"Presposition",reason:"wit-me"},{match:"#PastTense #Possessive [#Verb]",group:0,tag:"Noun",notIf:"(saw|made)",reason:"left-her-boots"},{match:"#Value [%Plural|Verb%]",group:0,tag:"Plural",notIf:"(one|1|a|an)",reason:"35-signs"},{match:"had [#PresentTense]",group:0,tag:"Noun",notIf:"(#Gerund|come|become)",reason:"had-time"},{match:"%Adj|Noun% %Noun|Verb%",tag:"#Adjective #Noun",notIf:"#ProperNoun #Noun",reason:"instant-access"},{match:"#Determiner [%Adj|Noun%] #Conjunction",group:0,tag:"Noun",reason:"a-rep-to"},{match:"#Adjective #Noun [%Plural|Verb%]$",group:0,tag:"Plural",notIf:"#Pronoun",reason:"near-death-experiences"},{match:"#Possessive #Noun [%Plural|Verb%]$",group:0,tag:"Plural",reason:"your-guild-colors"}],[{match:"(this|that|the|a|an) [#Gerund #Infinitive]",group:0,tag:"Singular",reason:"the-planning-process"},{match:"(that|the) [#Gerund #PresentTense]",group:0,ifNo:"#Copula",tag:"Plural",reason:"the-paving-stones"},{match:"#Determiner [#Gerund] #Noun",group:0,tag:"Adjective",reason:"the-gerund-noun"},{match:"#Pronoun #Infinitive [#Gerund] #PresentTense",group:0,tag:"Noun",reason:"tipping-sucks"},{match:"#Adjective [#Gerund]",group:0,tag:"Noun",notIf:"(still|even|just)",reason:"early-warning"},{match:"[#Gerund] #Adverb? not? #Copula",group:0,tag:"Activity",reason:"gerund-copula"},{match:"#Copula [(#Gerund|#Activity)] #Copula",group:0,tag:"Gerund",reason:"are-doing-is"},{match:"[#Gerund] #Modal",group:0,tag:"Activity",reason:"gerund-modal"},{match:"#Singular for [%Noun|Gerund%]",group:0,tag:"Gerund",reason:"noun-for-gerund"},{match:"#Comparative (for|at) [%Noun|Gerund%]",group:0,tag:"Gerund",reason:"better-for-gerund"},{match:"#PresentTense the [#Gerund]",group:0,tag:"Noun",reason:"keep-the-touching"}],[{match:"#Infinitive (this|that|the) [#Infinitive]",group:0,tag:"Noun",reason:"do-this-dance"},{match:"#Gerund #Determiner [#Infinitive]",group:0,tag:"Noun",reason:"running-a-show"},{match:"#Determiner (only|further|just|more|backward) [#Infinitive]",group:0,tag:"Noun",reason:"the-only-reason"},{match:"(the|this|a|an) [#Infinitive] #Adverb? #Verb",group:0,tag:"Noun",reason:"determiner5"},{match:"#Determiner #Adjective #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"a-nice-inf"},{match:"#Determiner #Demonym [#PresentTense]",group:0,tag:"Noun",reason:"mexican-train"},{match:"#Adjective #Noun+ [#Infinitive] #Copula",group:0,tag:"Noun",reason:"career-move"},{match:"at some [#Infinitive]",group:0,tag:"Noun",reason:"at-some-inf"},{match:"(go|goes|went) to [#Infinitive]",group:0,tag:"Noun",reason:"goes-to-verb"},{match:"(a|an) #Adjective? #Noun [#Infinitive] (#Preposition|#Noun)",group:0,notIf:"from",tag:"Noun",reason:"a-noun-inf"},{match:"(a|an) #Noun [#Infinitive]$",group:0,tag:"Noun",reason:"a-noun-inf2"},{match:"#Gerund #Adjective? for [#Infinitive]",group:0,tag:"Noun",reason:"running-for"},{match:"about [#Infinitive]",group:0,tag:"Singular",reason:"about-love"},{match:"#Plural on [#Infinitive]",group:0,tag:"Noun",reason:"on-stage"},{match:"any [#Infinitive]",group:0,tag:"Noun",reason:"any-charge"},{match:"no [#Infinitive]",group:0,tag:"Noun",reason:"no-doubt"},{match:"number of [#PresentTense]",group:0,tag:"Noun",reason:"number-of-x"},{match:"(taught|teaches|learns|learned) [#PresentTense]",group:0,tag:"Noun",reason:"teaches-x"},{match:"(try|use|attempt|build|make) [#Verb #Particle?]",notIf:"(#Copula|#Noun|sure|fun|up)",group:0,tag:"Noun",reason:"do-verb"},{match:"^[#Infinitive] (is|was)",group:0,tag:"Noun",reason:"checkmate-is"},{match:"#Infinitive much [#Infinitive]",group:0,tag:"Noun",reason:"get-much"},{match:"[cause] #Pronoun #Verb",group:0,tag:"Conjunction",reason:"cause-cuz"},{match:"the #Singular [#Infinitive] #Noun",group:0,tag:"Noun",notIf:"#Pronoun",reason:"cardio-dance"},{match:"#Determiner #Modal [#Noun]",group:0,tag:"PresentTense",reason:"should-smoke"},{match:"this [#Plural]",group:0,tag:"PresentTense",notIf:"(#Preposition|#Date)",reason:"this-verbs"},{match:"#Noun that [#Plural]",group:0,tag:"PresentTense",notIf:"(#Preposition|#Pronoun|way)",reason:"voice-that-rocks"},{match:"that [#Plural] to",group:0,tag:"PresentTense",notIf:"#Preposition",reason:"that-leads-to"},{match:"(let|make|made) (him|her|it|#Person|#Place|#Organization)+ [#Singular] (a|an|the|it)",group:0,tag:"Infinitive",reason:"let-him-glue"},{match:"#Verb (all|every|each|most|some|no) [#PresentTense]",notIf:"#Modal",group:0,tag:"Noun",reason:"all-presentTense"},{match:"(had|have|#PastTense) #Adjective [#PresentTense]",group:0,tag:"Noun",notIf:"better",reason:"adj-presentTense"},{match:"#Value #Adjective [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"one-big-reason"},{match:"#PastTense #Adjective+ [#PresentTense]",group:0,tag:"Noun",notIf:"(#Copula|better)",reason:"won-wide-support"},{match:"(many|few|several|couple) [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"many-poses"},{match:"#Determiner #Adverb #Adjective [%Noun|Verb%]",group:0,tag:"Noun",notIf:"#Copula",reason:"very-big-dream"},{match:"from #Noun to [%Noun|Verb%]",group:0,tag:"Noun",reason:"start-to-finish"},{match:"(for|with|of) #Noun (and|or|not) [%Noun|Verb%]",group:0,tag:"Noun",notIf:"#Pronoun",reason:"for-food-and-gas"},{match:"#Adjective #Adjective [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"adorable-little-store"},{match:"#Gerund #Adverb? #Comparative [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"higher-costs"},{match:"(#Noun && @hasComma) #Noun (and|or) [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"noun-list"},{match:"(many|any|some|several) [#PresentTense] for",group:0,tag:"Noun",reason:"any-verbs-for"},{match:"to #PresentTense #Noun [#PresentTense] #Preposition",group:0,tag:"Noun",reason:"gas-exchange"},{match:"#PastTense (until|as|through|without) [#PresentTense]",group:0,tag:"Noun",reason:"waited-until-release"},{match:"#Gerund like #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"like-hot-cakes"},{match:"some #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"some-reason"},{match:"for some [#PresentTense]",group:0,tag:"Noun",reason:"for-some-reason"},{match:"(same|some|the|that|a) kind of [#PresentTense]",group:0,tag:"Noun",reason:"some-kind-of"},{match:"(same|some|the|that|a) type of [#PresentTense]",group:0,tag:"Noun",reason:"some-type-of"},{match:"#Gerund #Adjective #Preposition [#PresentTense]",group:0,tag:"Noun",reason:"doing-better-for-x"},{match:"(get|got|have) #Comparative [#PresentTense]",group:0,tag:"Noun",reason:"got-better-aim"},{match:"whose [#PresentTense] #Copula",group:0,tag:"Noun",reason:"whos-name-was"},{match:"#PhrasalVerb #Particle #Preposition [#PresentTense]",group:0,tag:"Noun",reason:"given-up-on-x"},{match:"there (are|were) #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"there-are"},{match:"#Value [#PresentTense] of",group:0,notIf:"(one|1|#Copula|#Infinitive)",tag:"Plural",reason:"2-trains"},{match:"[#PresentTense] (are|were) #Adjective",group:0,tag:"Plural",reason:"compromises-are-possible"},{match:"^[(hope|guess|thought|think)] #Pronoun #Verb",group:0,tag:"Infinitive",reason:"suppose-i"},{match:"#Possessive #Adjective [#Verb]",group:0,tag:"Noun",notIf:"#Copula",reason:"our-full-support"},{match:"[(tastes|smells)] #Adverb? #Adjective",group:0,tag:"PresentTense",reason:"tastes-good"},{match:"#Copula #Gerund [#PresentTense] !by?",group:0,tag:"Noun",notIf:"going",reason:"ignoring-commute"},{match:"#Determiner #Adjective? [(shed|thought|rose|bid|saw|spelt)]",group:0,tag:"Noun",reason:"noun-past"},{match:"how to [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"how-to-noun"},{match:"which [%Noun|Verb%] #Noun",group:0,tag:"Infinitive",reason:"which-boost-it"},{match:"#Gerund [%Plural|Verb%]",group:0,tag:"Plural",reason:"asking-questions"},{match:"(ready|available|difficult|hard|easy|made|attempt|try) to [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"ready-to-noun"},{match:"(bring|went|go|drive|run|bike) to [%Noun|Verb%]",group:0,tag:"Noun",reason:"bring-to-noun"},{match:"#Modal #Noun [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"would-you-look"},{match:"#Copula just [#Infinitive]",group:0,tag:"Noun",reason:"is-just-spam"},{match:"^%Noun|Verb% %Plural|Verb%",tag:"Imperative #Plural",reason:"request-copies"},{match:"#Adjective #Plural and [%Plural|Verb%]",group:0,tag:"#Plural",reason:"pickles-and-drinks"},{match:"#Determiner #Year [#Verb]",group:0,tag:"Noun",reason:"the-1968-film"},{match:"#Determiner [#PhrasalVerb #Particle]",group:0,tag:"Noun",reason:"the-break-up"},{match:"#Determiner [%Adj|Noun%] #Noun",group:0,tag:"Adjective",notIf:"(#Pronoun|#Possessive|#ProperNoun)",reason:"the-individual-goals"},{match:"[%Noun|Verb%] or #Infinitive",group:0,tag:"Infinitive",reason:"work-or-prepare"},{match:"to #Infinitive [#PresentTense]",group:0,tag:"Noun",notIf:"(#Gerund|#Copula|help)",reason:"to-give-thanks"},{match:"[#Noun] me",group:0,tag:"Verb",reason:"kills-me"},{match:"%Plural|Verb% %Plural|Verb%",tag:"#PresentTense #Plural",reason:"removes-wrinkles"}],[{match:"#Money and #Money #Currency?",tag:"Money",reason:"money-and-money"},{match:"#Value #Currency [and] #Value (cents|ore|centavos|sens)",group:0,tag:"money",reason:"and-5-cents"},{match:"#Value (mark|rand|won|rub|ore)",tag:"#Money #Currency",reason:"4-mark"},{match:"a pound",tag:"#Money #Unit",reason:"a-pound"},{match:"#Value (pound|pounds)",tag:"#Money #Unit",reason:"4-pounds"}],[{match:"[(half|quarter)] of? (a|an)",group:0,tag:"Fraction",reason:"millionth"},{match:"#Adverb [half]",group:0,tag:"Fraction",reason:"nearly-half"},{match:"[half] the",group:0,tag:"Fraction",reason:"half-the"},{match:"#Cardinal and a half",tag:"Fraction",reason:"and-a-half"},{match:"#Value (halves|halfs|quarters)",tag:"Fraction",reason:"two-halves"},{match:"a #Ordinal",tag:"Fraction",reason:"a-quarter"},{match:"[#Cardinal+] (#Fraction && /s$/)",tag:"Fraction",reason:"seven-fifths"},{match:"[#Cardinal+ #Ordinal] of .",group:0,tag:"Fraction",reason:"ordinal-of"},{match:"[(#NumericValue && #Ordinal)] of .",group:0,tag:"Fraction",reason:"num-ordinal-of"},{match:"(a|one) #Cardinal?+ #Ordinal",tag:"Fraction",reason:"a-ordinal"},{match:"#Cardinal+ out? of every? #Cardinal",tag:"Fraction",reason:"out-of"}],[{match:"#Cardinal [second]",tag:"Unit",reason:"one-second"},{match:"!once? [(a|an)] (#Duration|hundred|thousand|million|billion|trillion)",group:0,tag:"Value",reason:"a-is-one"},{match:"1 #Value #PhoneNumber",tag:"PhoneNumber",reason:"1-800-Value"},{match:"#NumericValue #PhoneNumber",tag:"PhoneNumber",reason:"(800) PhoneNumber"},{match:"#Demonym #Currency",tag:"Currency",reason:"demonym-currency"},{match:"#Value [(buck|bucks|grand)]",group:0,tag:"Currency",reason:"value-bucks"},{match:"[#Value+] #Currency",group:0,tag:"Money",reason:"15 usd"},{match:"[second] #Noun",group:0,tag:"Ordinal",reason:"second-noun"},{match:"#Value+ [#Currency]",group:0,tag:"Unit",reason:"5-yan"},{match:"#Value [(foot|feet)]",group:0,tag:"Unit",reason:"foot-unit"},{match:"#Value [#Abbreviation]",group:0,tag:"Unit",reason:"value-abbr"},{match:"#Value [k]",group:0,tag:"Unit",reason:"value-k"},{match:"#Unit an hour",tag:"Unit",reason:"unit-an-hour"},{match:"(minus|negative) #Value",tag:"Value",reason:"minus-value"},{match:"#Value (point|decimal) #Value",tag:"Value",reason:"value-point-value"},{match:"#Determiner [(half|quarter)] #Ordinal",group:0,tag:"Value",reason:"half-ordinal"},{match:"#Multiple+ and #Value",tag:"Value",reason:"magnitude-and-value"},{match:"#Value #Unit [(per|an) (hr|hour|sec|second|min|minute)]",group:0,tag:"Unit",reason:"12-miles-per-second"},{match:"#Value [(square|cubic)] #Unit",group:0,tag:"Unit",reason:"square-miles"}],[{match:"#Copula [(#Noun|#PresentTense)] #LastName",group:0,tag:"FirstName",reason:"copula-noun-lastname"},{match:"(sister|pope|brother|father|aunt|uncle|grandpa|grandfather|grandma) #ProperNoun",tag:"Person",reason:"lady-titlecase",safe:!0},{match:"#FirstName [#Determiner #Noun] #LastName",group:0,tag:"Person",reason:"first-noun-last"},{match:"#ProperNoun (b|c|d|e|f|g|h|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z) #ProperNoun",tag:"Person",reason:"titlecase-acronym-titlecase",safe:!0},{match:"#Acronym #LastName",tag:"Person",reason:"acronym-lastname",safe:!0},{match:"#Person (jr|sr|md)",tag:"Person",reason:"person-honorific"},{match:"#Honorific #Acronym",tag:"Person",reason:"Honorific-TitleCase"},{match:"#Person #Person the? #RomanNumeral",tag:"Person",reason:"roman-numeral"},{match:"#FirstName [/^[^aiurck]$/]",group:0,tag:["Acronym","Person"],reason:"john-e"},{match:"#Noun van der? #Noun",tag:"Person",reason:"van der noun",safe:!0},{match:"(king|queen|prince|saint|lady) of #Noun",tag:"Person",reason:"king-of-noun",safe:!0},{match:"(prince|lady) #Place",tag:"Person",reason:"lady-place"},{match:"(king|queen|prince|saint) #ProperNoun",tag:"Person",notIf:"#Place",reason:"saint-foo"},{match:"al (#Person|#ProperNoun)",tag:"Person",reason:"al-borlen",safe:!0},{match:"#FirstName de #Noun",tag:"Person",reason:"bill-de-noun"},{match:"#FirstName (bin|al) #Noun",tag:"Person",reason:"bill-al-noun"},{match:"#FirstName #Acronym #ProperNoun",tag:"Person",reason:"bill-acronym-title"},{match:"#FirstName #FirstName #ProperNoun",tag:"Person",reason:"bill-firstname-title"},{match:"#Honorific #FirstName? #ProperNoun",tag:"Person",reason:"dr-john-Title"},{match:"#FirstName the #Adjective",tag:"Person",reason:"name-the-great"},{match:"#ProperNoun (van|al|bin) #ProperNoun",tag:"Person",reason:"title-van-title",safe:!0},{match:"#ProperNoun (de|du) la? #ProperNoun",tag:"Person",notIf:"#Place",reason:"title-de-title"},{match:"#Singular #Acronym #LastName",tag:"#FirstName #Person .",reason:"title-acro-noun",safe:!0},{match:"[#ProperNoun] #Person",group:0,tag:"Person",reason:"proper-person",safe:!0},{match:"#Person [#ProperNoun #ProperNoun]",group:0,tag:"Person",notIf:"#Possessive",reason:"three-name-person",safe:!0},{match:"#FirstName #Acronym? [#ProperNoun]",group:0,tag:"LastName",notIf:"#Possessive",reason:"firstname-titlecase"},{match:"#FirstName [#FirstName]",group:0,tag:"LastName",reason:"firstname-firstname"},{match:"#FirstName #Acronym #Noun",tag:"Person",reason:"n-acro-noun",safe:!0},{match:"#FirstName [(de|di|du|van|von)] #Person",group:0,tag:"LastName",reason:"de-firstname"},{match:"[(lieutenant|corporal|sergeant|captain|qeen|king|admiral|major|colonel|marshal|president|queen|king)+] #ProperNoun",group:0,tag:"Honorific",reason:"seargeant-john"},{match:"[(private|general|major|rear|prime|field|count|miss)] #Honorific? #Person",group:0,tag:["Honorific","Person"],reason:"ambg-honorifics"},{match:"#Honorific #FirstName [#Singular]",group:0,tag:"LastName",notIf:"#Possessive",reason:"dr-john-foo",safe:!0},{match:"[(his|her) (majesty|honour|worship|excellency|honorable)] #Person",group:0,tag:"Honorific",reason:"his-excellency"},{match:"#Honorific #Actor",tag:"Honorific",reason:"Lieutenant colonel"},{match:"(first|second|third|1st|2nd|3rd) #Actor",tag:"Honorific",reason:"first lady"},{match:"#Person #RomanNumeral",tag:"Person",reason:"louis-IV"}],[{match:"#FirstName #Noun$",tag:". #LastName",notIf:"(#Possessive|#Organization|#Place|#Pronoun|@hasTitleCase)",reason:"firstname-noun"},{match:"%Person|Date% #Acronym? #ProperNoun",tag:"Person",reason:"jan-thierson"},{match:"%Person|Noun% #Acronym? #ProperNoun",tag:"Person",reason:"switch-person",safe:!0},{match:"%Person|Noun% #Organization",tag:"Organization",reason:"olive-garden"},{match:"%Person|Verb% #Acronym? #ProperNoun",tag:"Person",reason:"verb-propernoun",ifNo:"#Actor"},{match:"[%Person|Verb%] (will|had|has|said|says|told|did|learned|wants|wanted)",group:0,tag:"Person",reason:"person-said"},{match:"[%Person|Place%] (harbor|harbour|pier|town|city|place|dump|landfill)",group:0,tag:"Place",reason:"sydney-harbour"},{match:"(west|east|north|south) [%Person|Place%]",group:0,tag:"Place",reason:"east-sydney"},{match:"#Modal [%Person|Verb%]",group:0,tag:"Verb",reason:"would-mark"},{match:"#Adverb [%Person|Verb%]",group:0,tag:"Verb",reason:"really-mark"},{match:"[%Person|Verb%] (#Adverb|#Comparative)",group:0,tag:"Verb",reason:"drew-closer"},{match:"%Person|Verb% #Person",tag:"Person",reason:"rob-smith"},{match:"%Person|Verb% #Acronym #ProperNoun",tag:"Person",reason:"rob-a-smith"},{match:"[will] #Verb",group:0,tag:"Modal",reason:"will-verb"},{match:"(will && @isTitleCase) #ProperNoun",tag:"Person",reason:"will-name"},{match:"(#FirstName && !#Possessive) [#Singular] #Verb",group:0,safe:!0,tag:"LastName",reason:"jack-layton"},{match:"^[#Singular] #Person #Verb",group:0,safe:!0,tag:"Person",reason:"sherwood-anderson"},{match:"(a|an) [#Person]$",group:0,unTag:"Person",reason:"a-warhol"}],[{match:"#Copula (pretty|dead|full|well|sure) (#Adjective|#Noun)",tag:"#Copula #Adverb #Adjective",reason:"sometimes-adverb"},{match:"(#Pronoun|#Person) (had|#Adverb)? [better] #PresentTense",group:0,tag:"Modal",reason:"i-better"},{match:"(#Modal|i|they|we|do) not? [like]",group:0,tag:"PresentTense",reason:"modal-like"},{match:"#Noun #Adverb? [left]",group:0,tag:"PastTense",reason:"left-verb"},{match:"will #Adverb? not? #Adverb? [be] #Gerund",group:0,tag:"Copula",reason:"will-be-copula"},{match:"will #Adverb? not? #Adverb? [be] #Adjective",group:0,tag:"Copula",reason:"be-copula"},{match:"[march] (up|down|back|toward)",notIf:"#Date",group:0,tag:"Infinitive",reason:"march-to"},{match:"#Modal [march]",group:0,tag:"Infinitive",reason:"must-march"},{match:"[may] be",group:0,tag:"Verb",reason:"may-be"},{match:"[(subject|subjects|subjected)] to",group:0,tag:"Verb",reason:"subject to"},{match:"[home] to",group:0,tag:"PresentTense",reason:"home to"},{match:"[open] #Determiner",group:0,tag:"Infinitive",reason:"open-the"},{match:"(were|was) being [#PresentTense]",group:0,tag:"PastTense",reason:"was-being"},{match:"(had|has|have) [been /en$/]",group:0,tag:"Auxiliary Participle",reason:"had-been-broken"},{match:"(had|has|have) [been /ed$/]",group:0,tag:"Auxiliary PastTense",reason:"had-been-smoked"},{match:"(had|has) #Adverb? [been] #Adverb? #PastTense",group:0,tag:"Auxiliary",reason:"had-been-adj"},{match:"(had|has) to [#Noun] (#Determiner|#Possessive)",group:0,tag:"Infinitive",reason:"had-to-noun"},{match:"have [#PresentTense]",group:0,tag:"PastTense",notIf:"(come|gotten)",reason:"have-read"},{match:"(does|will|#Modal) that [work]",group:0,tag:"PastTense",reason:"does-that-work"},{match:"[(sound|sounds)] #Adjective",group:0,tag:"PresentTense",reason:"sounds-fun"},{match:"[(look|looks)] #Adjective",group:0,tag:"PresentTense",reason:"looks-good"},{match:"[(start|starts|stop|stops|begin|begins)] #Gerund",group:0,tag:"Verb",reason:"starts-thinking"},{match:"(have|had) read",tag:"Modal #PastTense",reason:"read-read"},{match:"(is|was|were) [(under|over) #PastTense]",group:0,tag:"Adverb Adjective",reason:"was-under-cooked"},{match:"[shit] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear1-verb"},{match:"[damn] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear2-verb"},{match:"[fuck] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear3-verb"},{match:"#Plural that %Noun|Verb%",tag:". #Preposition #Infinitive",reason:"jobs-that-work"},{match:"[works] for me",group:0,tag:"PresentTense",reason:"works-for-me"},{match:"as #Pronoun [please]",group:0,tag:"Infinitive",reason:"as-we-please"},{match:"[(co|mis|de|inter|intra|pre|re|un|out|under|over|counter)] #Verb",group:0,tag:["Verb","Prefix"],notIf:"(#Copula|#PhrasalVerb)",reason:"co-write"},{match:"#PastTense and [%Adj|Past%]",group:0,tag:"PastTense",reason:"dressed-and-left"},{match:"[%Adj|Past%] and #PastTense",group:0,tag:"PastTense",reason:"dressed-and-left"},{match:"#Copula #Pronoun [%Adj|Past%]",group:0,tag:"Adjective",reason:"is-he-stoked"},{match:"to [%Noun|Verb%] #Preposition",group:0,tag:"Infinitive",reason:"to-dream-of"}],[{match:"(slowly|quickly) [#Adjective]",group:0,tag:"Verb",reason:"slowly-adj"},{match:"does (#Adverb|not)? [#Adjective]",group:0,tag:"PresentTense",reason:"does-mean"},{match:"[(fine|okay|cool|ok)] by me",group:0,tag:"Adjective",reason:"okay-by-me"},{match:"i (#Adverb|do)? not? [mean]",group:0,tag:"PresentTense",reason:"i-mean"},{match:"will #Adjective",tag:"Auxiliary Infinitive",reason:"will-adj"},{match:"#Pronoun [#Adjective] #Determiner #Adjective? #Noun",group:0,tag:"Verb",reason:"he-adj-the"},{match:"#Copula [%Adj|Present%] to #Verb",group:0,tag:"Verb",reason:"adj-to"},{match:"#Copula [#Adjective] (well|badly|quickly|slowly)",group:0,tag:"Verb",reason:"done-well"},{match:"#Adjective and [#Gerund] !#Preposition?",group:0,tag:"Adjective",reason:"rude-and-x"},{match:"#Copula #Adverb? (over|under) [#PastTense]",group:0,tag:"Adjective",reason:"over-cooked"},{match:"#Copula #Adjective+ (and|or) [#PastTense]$",group:0,tag:"Adjective",reason:"bland-and-overcooked"},{match:"got #Adverb? [#PastTense] of",group:0,tag:"Adjective",reason:"got-tired-of"},{match:"(seem|seems|seemed|appear|appeared|appears|feel|feels|felt|sound|sounds|sounded) (#Adverb|#Adjective)? [#PastTense]",group:0,tag:"Adjective",reason:"felt-loved"},{match:"(seem|feel|seemed|felt) [#PastTense #Particle?]",group:0,tag:"Adjective",reason:"seem-confused"},{match:"a (bit|little|tad) [#PastTense #Particle?]",group:0,tag:"Adjective",reason:"a-bit-confused"},{match:"not be [%Adj|Past% #Particle?]",group:0,tag:"Adjective",reason:"do-not-be-confused"},{match:"#Copula just [%Adj|Past% #Particle?]",group:0,tag:"Adjective",reason:"is-just-right"},{match:"as [#Infinitive] as",group:0,tag:"Adjective",reason:"as-pale-as"},{match:"[%Adj|Past%] and #Adjective",group:0,tag:"Adjective",reason:"faled-and-oppressive"},{match:"or [#PastTense] #Noun",group:0,tag:"Adjective",notIf:"(#Copula|#Pronoun)",reason:"or-heightened-emotion"},{match:"(become|became|becoming|becomes) [#Verb]",group:0,tag:"Adjective",reason:"become-verb"},{match:"#Possessive [#PastTense] #Noun",group:0,tag:"Adjective",reason:"declared-intentions"},{match:"#Copula #Pronoun [%Adj|Present%]",group:0,tag:"Adjective",reason:"is-he-cool"},{match:"#Copula [%Adj|Past%] with",group:0,tag:"Adjective",notIf:"(associated|worn|baked|aged|armed|bound|fried|loaded|mixed|packed|pumped|filled|sealed)",reason:"is-crowded-with"},{match:"#Copula #Adverb? [%Adj|Present%]$",group:0,tag:"Adjective",reason:"was-empty$"}],[{match:"will (#Adverb|not)+? [have] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"will-have-vb"},{match:"[#Copula] (#Adverb|not)+? (#Gerund|#PastTense)",group:0,tag:"Auxiliary",reason:"copula-walking"},{match:"[(#Modal|did)+] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"modal-verb"},{match:"#Modal (#Adverb|not)+? [have] (#Adverb|not)+? [had] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"[(has|had)] (#Adverb|not)+? #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"[(do|does|did|will|have|had|has|got)] (not|#Adverb)+? #Verb",group:0,tag:"Auxiliary",reason:"have-had"},{match:"[about to] #Adverb? #Verb",group:0,tag:["Auxiliary","Verb"],reason:"about-to"},{match:"#Modal (#Adverb|not)+? [be] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"would-be"},{match:"[(#Modal|had|has)] (#Adverb|not)+? [been] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"had-been"},{match:"[(be|being|been)] #Participle",group:0,tag:"Auxiliary",reason:"being-driven"},{match:"[may] #Adverb? #Infinitive",group:0,tag:"Auxiliary",reason:"may-want"},{match:"#Copula (#Adverb|not)+? [(be|being|been)] #Adverb+? #PastTense",group:0,tag:"Auxiliary",reason:"being-walked"},{match:"will [be] #PastTense",group:0,tag:"Auxiliary",reason:"will-be-x"},{match:"[(be|been)] (#Adverb|not)+? #Gerund",group:0,tag:"Auxiliary",reason:"been-walking"},{match:"[used to] #PresentTense",group:0,tag:"Auxiliary",reason:"used-to-walk"},{match:"#Copula (#Adverb|not)+? [going to] #Adverb+? #PresentTense",group:0,tag:"Auxiliary",reason:"going-to-walk"},{match:"#Imperative [(me|him|her)]",group:0,tag:"Reflexive",reason:"tell-him"},{match:"(is|was) #Adverb? [no]",group:0,tag:"Negative",reason:"is-no"},{match:"[(been|had|became|came)] #PastTense",group:0,notIf:"#PhrasalVerb",tag:"Auxiliary",reason:"been-told"},{match:"[(being|having|getting)] #Verb",group:0,tag:"Auxiliary",reason:"being-born"},{match:"[be] #Gerund",group:0,tag:"Auxiliary",reason:"be-walking"},{match:"[better] #PresentTense",group:0,tag:"Modal",notIf:"(#Copula|#Gerund)",reason:"better-go"},{match:"even better",tag:"Adverb #Comparative",reason:"even-better"}],[{match:"(#Verb && @hasHyphen) up",tag:"PhrasalVerb",reason:"foo-up"},{match:"(#Verb && @hasHyphen) off",tag:"PhrasalVerb",reason:"foo-off"},{match:"(#Verb && @hasHyphen) over",tag:"PhrasalVerb",reason:"foo-over"},{match:"(#Verb && @hasHyphen) out",tag:"PhrasalVerb",reason:"foo-out"},{match:"[#Verb (in|out|up|down|off|back)] (on|in)",notIf:"#Copula",tag:"PhrasalVerb Particle",reason:"walk-in-on"},{match:"(lived|went|crept|go) [on] for",group:0,tag:"PhrasalVerb",reason:"went-on"},{match:"#Verb (up|down|in|on|for)$",tag:"PhrasalVerb #Particle",notIf:"#PhrasalVerb",reason:"come-down$"},{match:"help [(stop|end|make|start)]",group:0,tag:"Infinitive",reason:"help-stop"},{match:"#PhrasalVerb (in && #Particle) #Determiner",tag:"#Verb #Preposition #Determiner",unTag:"PhrasalVerb",reason:"work-in-the"},{match:"[(stop|start|finish|help)] #Gerund",group:0,tag:"Infinitive",reason:"start-listening"},{match:"#Verb (him|her|it|us|himself|herself|itself|everything|something) [(up|down)]",group:0,tag:"Adverb",reason:"phrasal-pronoun-advb"}],[{match:"^do not? [#Infinitive #Particle?]",notIf:ND,group:0,tag:"Imperative",reason:"do-eat"},{match:"^please do? not? [#Infinitive #Particle?]",group:0,tag:"Imperative",reason:"please-go"},{match:"^just do? not? [#Infinitive #Particle?]",group:0,tag:"Imperative",reason:"just-go"},{match:"^[#Infinitive] it #Comparative",notIf:ND,group:0,tag:"Imperative",reason:"do-it-better"},{match:"^[#Infinitive] it (please|now|again|plz)",notIf:ND,group:0,tag:"Imperative",reason:"do-it-please"},{match:"^[#Infinitive] (#Adjective|#Adverb)$",group:0,tag:"Imperative",notIf:"(so|such|rather|enough)",reason:"go-quickly"},{match:"^[#Infinitive] (up|down|over) #Determiner",group:0,tag:"Imperative",reason:"turn-down"},{match:"^[#Infinitive] (your|my|the|a|an|any|each|every|some|more|with|on)",group:0,notIf:"like",tag:"Imperative",reason:"eat-my-shorts"},{match:"^[#Infinitive] (him|her|it|us|me|there)",group:0,tag:"Imperative",reason:"tell-him"},{match:"^[#Infinitive] #Adjective #Noun$",group:0,tag:"Imperative",reason:"avoid-loud-noises"},{match:"^[#Infinitive] (#Adjective|#Adverb)? and #Infinitive",group:0,tag:"Imperative",reason:"call-and-reserve"},{match:"^(go|stop|wait|hurry) please?$",tag:"Imperative",reason:"go"},{match:"^(somebody|everybody) [#Infinitive]",group:0,tag:"Imperative",reason:"somebody-call"},{match:"^let (us|me) [#Infinitive]",group:0,tag:"Imperative",reason:"lets-leave"},{match:"^[(shut|close|open|start|stop|end|keep)] #Determiner #Noun",group:0,tag:"Imperative",reason:"shut-the-door"},{match:"^[#PhrasalVerb #Particle] #Determiner #Noun",group:0,tag:"Imperative",reason:"turn-off-the-light"},{match:"^[go] to .",group:0,tag:"Imperative",reason:"go-to-toronto"},{match:"^#Modal you [#Infinitive]",group:0,tag:"Imperative",reason:"would-you-"},{match:"^never [#Infinitive]",group:0,tag:"Imperative",reason:"never-stop"},{match:"^come #Infinitive",tag:"Imperative",notIf:"on",reason:"come-have"},{match:"^come and? #Infinitive",tag:"Imperative . Imperative",notIf:"#PhrasalVerb",reason:"come-and-have"},{match:"^stay (out|away|back)",tag:"Imperative",reason:"stay-away"},{match:"^[(stay|be|keep)] #Adjective",group:0,tag:"Imperative",reason:"stay-cool"},{match:"^[keep it] #Adjective",group:0,tag:"Imperative",reason:"keep-it-cool"},{match:"^do not [#Infinitive]",group:0,tag:"Imperative",reason:"do-not-be"},{match:"[#Infinitive] (yourself|yourselves)",group:0,tag:"Imperative",reason:"allow-yourself"},{match:"[#Infinitive] what .",group:0,tag:"Imperative",reason:"look-what"},{match:"^[#Infinitive] #Gerund",group:0,tag:"Imperative",reason:"keep-playing"},{match:"^[#Infinitive] (to|for|into|toward|here|there)",group:0,tag:"Imperative",reason:"go-to"},{match:"^[#Infinitive] (and|or) #Infinitive",group:0,tag:"Imperative",reason:"inf-and-inf"},{match:"^[%Noun|Verb%] to",group:0,tag:"Imperative",reason:"commit-to"},{match:"^[#Infinitive] #Adjective? #Singular #Singular",group:0,tag:"Imperative",reason:"maintain-eye-contact"},{match:"do not (forget|omit|neglect) to [#Infinitive]",group:0,tag:"Imperative",reason:"do-not-forget"},{match:"^[(ask|wear|pay|look|help|show|watch|act|fix|kill|stop|start|turn|try|win)] #Noun",group:0,tag:"Imperative",reason:"pay-attention"}],[{match:"(that|which) were [%Adj|Gerund%]",group:0,tag:"Gerund",reason:"that-were-growing"},{match:"#Gerund [#Gerund] #Plural",group:0,tag:"Adjective",reason:"hard-working-fam"}],[{match:"u r",tag:"#Pronoun #Copula",reason:"u r"},{match:"#Noun [(who|whom)]",group:0,tag:"Determiner",reason:"captain-who"},{match:"[had] #Noun+ #PastTense",group:0,tag:"Condition",reason:"had-he"},{match:"[were] #Noun+ to #Infinitive",group:0,tag:"Condition",reason:"were-he"},{match:"some sort of",tag:"Adjective Noun Conjunction",reason:"some-sort-of"},{match:"of some sort",tag:"Conjunction Adjective Noun",reason:"of-some-sort"},{match:"[such] (a|an|is)? #Noun",group:0,tag:"Determiner",reason:"such-skill"},{match:"[right] (before|after|in|into|to|toward)",group:0,tag:"#Adverb",reason:"right-into"},{match:"#Preposition [about]",group:0,tag:"Adjective",reason:"at-about"},{match:"(are|#Modal|see|do|for) [ya]",group:0,tag:"Pronoun",reason:"are-ya"},{match:"[long live] .",group:0,tag:"#Adjective #Infinitive",reason:"long-live"},{match:"[plenty] of",group:0,tag:"#Uncountable",reason:"plenty-of"},{match:"(always|nearly|barely|practically) [there]",group:0,tag:"Adjective",reason:"always-there"},{match:"[there] (#Adverb|#Pronoun)? #Copula",group:0,tag:"There",reason:"there-is"},{match:"#Copula [there] .",group:0,tag:"There",reason:"is-there"},{match:"#Modal #Adverb? [there]",group:0,tag:"There",reason:"should-there"},{match:"^[do] (you|we|they)",group:0,tag:"QuestionWord",reason:"do-you"},{match:"^[does] (he|she|it|#ProperNoun)",group:0,tag:"QuestionWord",reason:"does-he"},{match:"#Determiner #Noun+ [who] #Verb",group:0,tag:"Preposition",reason:"the-x-who"},{match:"#Determiner #Noun+ [which] #Verb",group:0,tag:"Preposition",reason:"the-x-which"},{match:"a [while]",group:0,tag:"Noun",reason:"a-while"},{match:"guess who",tag:"#Infinitive #QuestionWord",reason:"guess-who"},{match:"[fucking] !#Verb",group:0,tag:"#Gerund",reason:"f-as-gerund"}],[{match:"university of #Place",tag:"Organization",reason:"university-of-Foo"},{match:"#Noun (&|n) #Noun",tag:"Organization",reason:"Noun-&-Noun"},{match:"#Organization of the? #ProperNoun",tag:"Organization",reason:"org-of-place",safe:!0},{match:"#Organization #Country",tag:"Organization",reason:"org-country"},{match:"#ProperNoun #Organization",tag:"Organization",notIf:"#FirstName",reason:"titlecase-org"},{match:"#ProperNoun (ltd|co|inc|dept|assn|bros)",tag:"Organization",reason:"org-abbrv"},{match:"the [#Acronym]",group:0,tag:"Organization",reason:"the-acronym",safe:!0},{match:"government of the? [#Place+]",tag:"Organization",reason:"government-of-x"},{match:"(health|school|commerce) board",tag:"Organization",reason:"school-board"},{match:"(nominating|special|conference|executive|steering|central|congressional) committee",tag:"Organization",reason:"special-comittee"},{match:"(world|global|international|national|#Demonym) #Organization",tag:"Organization",reason:"global-org"},{match:"#Noun+ (public|private) school",tag:"School",reason:"noun-public-school"},{match:"#Place+ #SportsTeam",tag:"SportsTeam",reason:"place-sportsteam"},{match:"(dc|atlanta|minnesota|manchester|newcastle|sheffield) united",tag:"SportsTeam",reason:"united-sportsteam"},{match:"#Place+ fc",tag:"SportsTeam",reason:"fc-sportsteam"},{match:"#Place+ #Noun{0,2} (club|society|group|team|committee|commission|association|guild|crew)",tag:"Organization",reason:"place-noun-society"}],[{match:"(west|north|south|east|western|northern|southern|eastern)+ #Place",tag:"Region",reason:"west-norfolk"},{match:"#City [(al|ak|az|ar|ca|ct|dc|fl|ga|id|il|nv|nh|nj|ny|oh|pa|sc|tn|tx|ut|vt|pr)]",group:0,tag:"Region",reason:"us-state"},{match:"portland [or]",group:0,tag:"Region",reason:"portland-or"},{match:"#ProperNoun+ (cliff|place|range|pit|place|point|room|grounds|ruins)",tag:"Place",reason:"foo-point"},{match:"in [#ProperNoun] #Place",group:0,tag:"Place",reason:"propernoun-place"},{match:"#Value #Noun (st|street|rd|road|crescent|cr|way|tr|terrace|avenue|ave)",tag:"Address",reason:"address-st"},{match:"(port|mount|mt) #ProperName",tag:"Place",reason:"port-name"}],[{match:"[so] #Noun",group:0,tag:"Conjunction",reason:"so-conj"},{match:"[(who|what|where|why|how|when)] #Noun #Copula #Adverb? (#Verb|#Adjective)",group:0,tag:"Conjunction",reason:"how-he-is-x"},{match:"#Copula [(who|what|where|why|how|when)] #Noun",group:0,tag:"Conjunction",reason:"when-he"},{match:"#Verb [that] #Pronoun",group:0,tag:"Conjunction",reason:"said-that-he"},{match:"#Noun [that] #Copula",group:0,tag:"Conjunction",reason:"that-are"},{match:"#Noun [that] #Verb #Adjective",group:0,tag:"Conjunction",reason:"that-seem"},{match:"#Noun #Copula not? [that] #Adjective",group:0,tag:"Adverb",reason:"that-adj"},{match:"#Verb #Adverb? #Noun [(that|which)]",group:0,tag:"Preposition",reason:"that-prep"},{match:"@hasComma [which] (#Pronoun|#Verb)",group:0,tag:"Preposition",reason:"which-copula"},{match:"#Noun [like] #Noun",group:0,tag:"Preposition",reason:"noun-like"},{match:"^[like] #Determiner",group:0,tag:"Preposition",reason:"like-the"},{match:"a #Noun [like] (#Noun|#Determiner)",group:0,tag:"Preposition",reason:"a-noun-like"},{match:"#Adverb [like]",group:0,tag:"Verb",reason:"really-like"},{match:"(not|nothing|never) [like]",group:0,tag:"Preposition",reason:"nothing-like"},{match:"#Infinitive #Pronoun [like]",group:0,tag:"Preposition",reason:"treat-them-like"},{match:"[#QuestionWord] (#Pronoun|#Determiner)",group:0,tag:"Preposition",reason:"how-he"},{match:"[#QuestionWord] #Participle",group:0,tag:"Preposition",reason:"when-stolen"},{match:"[how] (#Determiner|#Copula|#Modal|#PastTense)",group:0,tag:"QuestionWord",reason:"how-is"},{match:"#Plural [(who|which|when)] .",group:0,tag:"Preposition",reason:"people-who"}],[{match:"holy (shit|fuck|hell)",tag:"Expression",reason:"swears-expression"},{match:"^[(well|so|okay|now)] !#Adjective?",group:0,tag:"Expression",reason:"well-"},{match:"^come on",tag:"Expression",reason:"come-on"},{match:"(say|says|said) [sorry]",group:0,tag:"Expression",reason:"say-sorry"},{match:"^(ok|alright|shoot|hell|anyways)",tag:"Expression",reason:"ok-"},{match:"^(say && @hasComma)",tag:"Expression",reason:"say-"},{match:"^(like && @hasComma)",tag:"Expression",reason:"like-"},{match:"^[(dude|man|girl)] #Pronoun",group:0,tag:"Expression",reason:"dude-i"}]),DD=null;const RD={postTagger:function(e){const{world:t}=e,{model:n,methods:r}=t;DD=DD||r.one.buildNet(n.two.matches,t);let i=r.two.quickSplit(e.document).map((e=>{let t=e[0];return[t.index[0],t.index[1],t.index[1]+e.length]})),a=e.update(i);return a.cache(),a.sweep(DD),e.uncache(),e.unfreeze(),e},tagger:e=>e.compute(["freeze","lexicon","preTagger","postTagger","unfreeze"])},LD={api:function(e){e.prototype.confidence=function(){let e=0,t=0;return this.docs.forEach((n=>{n.forEach((n=>{t+=1,e+=n.confidence||1}))})),0===t?1:(e=>Math.round(100*e)/100)(e/t)},e.prototype.tagger=function(){return this.compute(["tagger"])}},compute:RD,model:{two:{matches:jD}},hooks:["postTagger"]},MD=LD,$D={lib:{lazy:function(e,t){let n=t;"string"==typeof t&&(n=this.buildNet([{match:t}]));let r=this.tokenize(e),i=function(e,t){let n=function(e){return Object.keys(e.hooks).filter((e=>!e.startsWith("#")&&!e.startsWith("%")))}(t);if(0===n.length)return e;e._cache||e.cache();let r=e._cache;return e.filter(((e,t)=>n.some((e=>r[t].has(e)))))}(r,n);return i.found?(i.compute(["index","tagger"]),i.match(t)):r.none()}}},FD=function(e,t,n){let r=e.split(/ /g).map((e=>e.toLowerCase().trim()));r=r.filter((e=>e)),r=r.map((e=>`{${e}}`)).join(" ");let i=this.match(r);return n&&(i=i.if(n)),i.has("#Verb")?function(e,t){let n=t;return e.forEach((e=>{e.has("#Infinitive")||(n=function(e,t){let n=(0,e.methods.two.transform.verb.conjugate)(t,e.model);return e.has("#Gerund")?n.Gerund:e.has("#PastTense")?n.PastTense:e.has("#PresentTense")?n.PresentTense:e.has("#Gerund")?n.Gerund:t}(e,t)),e.replaceWith(n)})),e}(i,t):i.has("#Noun")?function(e,t){let n=t;e.has("#Plural")&&(n=(0,e.methods.two.transform.noun.toPlural)(t,e.model)),e.replaceWith(n,{possessives:!0})}(i,t):i.has("#Adverb")?function(e,t){const{toAdverb:n}=e.methods.two.transform.adjective;let r=n(t);r&&e.replaceWith(r)}(i,t):i.has("#Adjective")?function(e,t){const{toComparative:n,toSuperlative:r}=e.methods.two.transform.adjective;let i=t;e.has("#Comparative")?i=n(i,e.model):e.has("#Superlative")&&(i=r(i,e.model)),i&&e.replaceWith(i)}(i,t):this},VD={api:function(e){e.prototype.swap=FD}};kO.plugin(lD),kO.plugin(OD),kO.plugin(MD),kO.plugin($D),kO.plugin(VD);const zD=kO,BD=function(e){const{fromComparative:t,fromSuperlative:n}=e.methods.two.transform.adjective;let r=e.text("normal");return e.has("#Comparative")?t(r,e.model):e.has("#Superlative")?n(r,e.model):r},UD={api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Adjectives"}json(e={}){const{toAdverb:t,toNoun:n,toSuperlative:r,toComparative:i}=this.methods.two.transform.adjective;return e.normal=!0,this.map((a=>{let s=a.toView().json(e)[0]||{},o=BD(a);return s.adjective={adverb:t(o,this.model),noun:n(o,this.model),superlative:r(o,this.model),comparative:i(o,this.model)},s}),[])}adverbs(){return this.before("#Adverb+$").concat(this.after("^#Adverb+"))}conjugate(e){const{toComparative:t,toSuperlative:n,toNoun:r,toAdverb:i}=this.methods.two.transform.adjective;return this.getNth(e).map((e=>{let a=BD(e);return{Adjective:a,Comparative:t(a,this.model),Superlative:n(a,this.model),Noun:r(a,this.model),Adverb:i(a,this.model)}}),[])}toComparative(e){const{toComparative:t}=this.methods.two.transform.adjective;return this.getNth(e).map((e=>{let n=BD(e),r=t(n,this.model);return e.replaceWith(r)}))}toSuperlative(e){const{toSuperlative:t}=this.methods.two.transform.adjective;return this.getNth(e).map((e=>{let n=BD(e),r=t(n,this.model);return e.replaceWith(r)}))}toAdverb(e){const{toAdverb:t}=this.methods.two.transform.adjective;return this.getNth(e).map((e=>{let n=BD(e),r=t(n,this.model);return e.replaceWith(r)}))}toNoun(e){const{toNoun:t}=this.methods.two.transform.adjective;return this.getNth(e).map((e=>{let n=BD(e),r=t(n,this.model);return e.replaceWith(r)}))}}e.prototype.adjectives=function(e){let n=this.match("#Adjective");return n=n.getNth(e),new t(n.document,n.pointer)},e.prototype.superlatives=function(e){let n=this.match("#Superlative");return n=n.getNth(e),new t(n.document,n.pointer)},e.prototype.comparatives=function(e){let n=this.match("#Comparative");return n=n.getNth(e),new t(n.document,n.pointer)}}},HD=function(e){let t=this;t=function(e){let t=e.parentheses();return t=t.filter((e=>e.wordCount()>=3&&e.has("#Verb")&&e.has("#Noun"))),e.splitOn(t)}(t),t=function(e){let t=e.quotations();return t=t.filter((e=>e.wordCount()>=3&&e.has("#Verb")&&e.has("#Noun"))),e.splitOn(t)}(t),t=function(e){let t=e.match("@hasComma");return t=t.filter((e=>{if(1===e.growLeft(".").wordCount())return!1;if(1===e.growRight(". .").wordCount())return!1;let t=e.grow(".");return t=t.ifNo("@hasComma @hasComma"),t=t.ifNo("@hasComma (and|or) ."),t=t.ifNo("(#City && @hasComma) #Country"),t=t.ifNo("(#WeekDay && @hasComma) #Date"),t=t.ifNo("(#Date+ && @hasComma) #Value"),t=t.ifNo("(#Adjective && @hasComma) #Adjective"),t.found})),e.splitAfter(t)}(t),t=t.splitAfter("(@hasEllipses|@hasSemicolon|@hasDash|@hasColon)"),t=t.splitAfter("^#Pronoun (said|says)"),t=t.splitBefore("(said|says) #ProperNoun$"),t=t.splitBefore(". . if .{4}"),t=t.splitBefore("and while"),t=t.splitBefore("now that"),t=t.splitBefore("ever since"),t=t.splitBefore("(supposing|although)"),t=t.splitBefore("even (while|if|though)"),t=t.splitBefore("(whereas|whose)"),t=t.splitBefore("as (though|if)"),t=t.splitBefore("(til|until)");let n=t.match("#Verb .* [but] .* #Verb",0);n.found&&(t=t.splitBefore(n));let r=t.if("if .{2,9} then .").match("then");return t=t.splitBefore(r),"number"==typeof e&&(t=t.get(e)),t},GD={this:"Noun",then:"Pivot"},qD=[{match:"[that] #Determiner #Noun",group:0,chunk:"Pivot"},{match:"#PastTense [that]",group:0,chunk:"Pivot"},{match:"[so] #Determiner",group:0,chunk:"Pivot"},{match:"#Copula #Adverb+? [#Adjective]",group:0,chunk:"Adjective"},{match:"#Adjective and #Adjective",chunk:"Adjective"},{match:"#Adverb+ and #Adverb #Verb",chunk:"Verb"},{match:"#Gerund #Adjective$",chunk:"Verb"},{match:"#Gerund to #Verb",chunk:"Verb"},{match:"#PresentTense and #PresentTense",chunk:"Verb"},{match:"#Adverb #Negative",chunk:"Verb"},{match:"(want|wants|wanted) to #Infinitive",chunk:"Verb"},{match:"#Verb #Reflexive",chunk:"Verb"},{match:"#Verb [to] #Adverb? #Infinitive",group:0,chunk:"Verb"},{match:"[#Preposition] #Gerund",group:0,chunk:"Verb"},{match:"#Infinitive [that] <Noun>",group:0,chunk:"Verb"},{match:"#Noun of #Determiner? #Noun",chunk:"Noun"},{match:"#Value+ #Adverb? #Adjective",chunk:"Noun"},{match:"the [#Adjective] #Noun",chunk:"Noun"},{match:"#Singular in #Determiner? #Singular",chunk:"Noun"},{match:"#Plural [in] #Determiner? #Noun",group:0,chunk:"Pivot"},{match:"#Noun and #Determiner? #Noun",notIf:"(#Possessive|#Pronoun)",chunk:"Noun"}];let KD=null;const WD=function(e,t){if(("undefined"!=typeof process&&process.env?process.env:self.env||{}).DEBUG_CHUNKS){let n=(e.normal+"'").padEnd(8);console.log(`  | '${n}  →  [34m${t.padEnd(12)}[0m [2m -fallback- [0m`)}e.chunk=t},JD={chunks:function(e){const{document:t,world:n}=e;(function(e){for(let t=0;t<e.length;t+=1)for(let n=0;n<e[t].length;n+=1){let r=e[t][n];!0!==GD.hasOwnProperty(r.normal)?r.tags.has("Verb")?r.chunk="Verb":r.tags.has("Noun")||r.tags.has("Determiner")||r.tags.has("Value")?r.chunk="Noun":r.tags.has("QuestionWord")&&(r.chunk="Pivot"):r.chunk=GD[r.normal]}})(t),function(e){for(let t=0;t<e.length;t+=1)for(let n=0;n<e[t].length;n+=1){let r=e[t][n];if(r.chunk)continue;let i=e[t][n+1],a=e[t][n-1];if(r.tags.has("Adjective")){if(a&&a.tags.has("Copula")){r.chunk="Adjective";continue}if(a&&a.tags.has("Determiner")){r.chunk="Noun";continue}if(i&&i.tags.has("Noun")){r.chunk="Noun";continue}}else if(r.tags.has("Adverb")||r.tags.has("Negative")){if(a&&a.tags.has("Adjective")){r.chunk="Adjective";continue}if(a&&a.tags.has("Verb")){r.chunk="Verb";continue}if(i&&i.tags.has("Adjective")){r.chunk="Adjective";continue}if(i&&i.tags.has("Verb")){r.chunk="Verb";continue}}}}(t),function(e,t,n){const{methods:r}=n;KD=KD||r.one.buildNet(qD,n),e.sweep(KD)}(e,0,n),function(e){for(let t=0;t<e.length;t+=1)for(let n=0;n<e[t].length;n+=1){let r=e[t][n];void 0===r.chunk&&(r.tags.has("Conjunction")||r.tags.has("Preposition")?WD(r,"Pivot"):r.tags.has("Adverb")?WD(r,"Verb"):r.chunk="Noun")}}(t),function(e){let t=[],n=null;e.forEach((e=>{for(let r=0;r<e.length;r+=1){let i=e[r];n&&i.chunk===n?t[t.length-1].terms.push(i):(t.push({chunk:i.chunk,terms:[i]}),n=i.chunk)}})),t.forEach((e=>{if("Verb"===e.chunk){const t=e.terms.find((e=>e.tags.has("Verb")));t||e.terms.forEach((e=>e.chunk=null))}}))}(t)}},ZD={compute:JD,api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Chunks"}isVerb(){return this.filter((e=>e.has("<Verb>")))}isNoun(){return this.filter((e=>e.has("<Noun>")))}isAdjective(){return this.filter((e=>e.has("<Adjective>")))}isPivot(){return this.filter((e=>e.has("<Pivot>")))}debug(){return this.toView().debug("chunks"),this}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.chunks=function(e){let n=function(e){let t=[],n=null;return e.clauses().docs.forEach((e=>{e.forEach((e=>{e.chunk&&e.chunk===n?t[t.length-1][2]=e.index[1]+1:(n=e.chunk,t.push([e.index[0],e.index[1],e.index[1]+1]))})),n=null})),e.update(t)}(this);return n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.clauses=HD},hooks:["chunks"]},QD=/\./g,XD=/\(/,YD=/\)/,eR=function(e,t){for(;t<e.length;t+=1)if(e[t].post&&YD.test(e[t].post)){let[,n]=e[t].index;return n=n||0,n}return null},tR=/'s$/,nR={'"':'"',"＂":"＂","'":"'","“":"”","‘":"’","‟":"”","‛":"’","„":"”","⹂":"”","‚":"’","«":"»","‹":"›","‵":"′","‶":"″","‷":"‴","〝":"〞","`":"´","〟":"〞"},rR=RegExp("["+Object.keys(nR).join("")+"]"),iR=RegExp("["+Object.values(nR).join("")+"]"),aR=function(e,t){const n=e[t].pre.match(rR)[0]||"";if(!n||!nR[n])return null;const r=nR[n];for(;t<e.length;t+=1)if(e[t].post&&e[t].post.match(r))return t;return null},sR=function(e){let t=this.splitAfter("@hasComma");return t=t.match("#PhoneNumber+"),t=t.getNth(e),t},oR=[["hyphenated","@hasHyphen ."],["hashTags","#HashTag"],["emails","#Email"],["emoji","#Emoji"],["emoticons","#Emoticon"],["atMentions","#AtMention"],["urls","#Url"],["conjunctions","#Conjunction"],["prepositions","#Preposition"],["abbreviations","#Abbreviation"],["honorifics","#Honorific"]];let lR=[["emojis","emoji"],["atmentions","atMentions"]];const uR=/\//,cR={api:function(e){(function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Acronyms"}strip(){return this.docs.forEach((e=>{e.forEach((e=>{e.text=e.text.replace(QD,""),e.normal=e.normal.replace(QD,"")}))})),this}addPeriods(){return this.docs.forEach((e=>{e.forEach((e=>{e.text=e.text.replace(QD,""),e.normal=e.normal.replace(QD,""),e.text=e.text.split("").join(".")+".",e.normal=e.normal.split("").join(".")+"."}))})),this}}e.prototype.acronyms=function(e){let n=this.match("#Acronym");return n=n.getNth(e),new t(n.document,n.pointer)}})(e),function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Possessives"}strip(){return function(e){return e.docs.forEach((e=>{e[0].pre=e[0].pre.replace(XD,"");let t=e[e.length-1];t.post=t.post.replace(YD,"")})),e}(this)}}e.prototype.parentheses=function(e){let n=function(e){let t=[];return e.docs.forEach((e=>{for(let n=0;n<e.length;n+=1){let r=e[n];if(r.pre&&XD.test(r.pre)){let r=eR(e,n);if(null!==r){let[i,a]=e[n].index;t.push([i,a,r+1,e[n].id]),n=r}}}})),e.update(t)}(this);return n=n.getNth(e),new t(n.document,n.pointer)}}(e),function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Possessives"}strip(){return this.docs.forEach((e=>{e.forEach((e=>{e.text=e.text.replace(tR,""),e.normal=e.normal.replace(tR,"")}))})),this}}e.prototype.possessives=function(e){let n=function(e){let t=e.match("#Possessive+");return t.has("#Person")&&(t=t.growLeft("#Person+")),t.has("#Place")&&(t=t.growLeft("#Place+")),t.has("#Organization")&&(t=t.growLeft("#Organization+")),t}(this);return n=n.getNth(e),new t(n.document,n.pointer)}}(e),function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Possessives"}strip(){return function(e){e.docs.forEach((e=>{e[0].pre=e[0].pre.replace(rR,"");let t=e[e.length-1];t.post=t.post.replace(iR,"")}))}(this)}}e.prototype.quotations=function(e){let n=function(e){let t=[];return e.docs.forEach((e=>{for(let n=0;n<e.length;n+=1){let r=e[n];if(r.pre&&rR.test(r.pre)){let r=aR(e,n);if(null!==r){let[i,a]=e[n].index;t.push([i,a,r+1,e[n].id]),n=r}}}})),e.update(t)}(this);return n=n.getNth(e),new t(n.document,n.pointer)}}(e),function(e){oR.forEach((t=>{e.prototype[t[0]]=function(e){let n=this.match(t[1]);return"number"==typeof e?n.get(e):n}})),e.prototype.phoneNumbers=sR,lR.forEach((t=>{e.prototype[t[0]]=e.prototype[t[1]]}))}(e),function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Slashes"}split(){return this.map((e=>{let t=e.text().split(uR);return(e=e.replaceWith(t.join(" "))).growRight("("+t.join("|")+")+")}))}}e.prototype.slashes=function(e){let n=this.match("#SlashedTerm");return n=n.getNth(e),new t(n.document,n.pointer)}}(e)}},hR=function(e,t){e.docs.forEach((e=>{e.forEach(t)}))},dR={case:e=>{hR(e,(e=>{e.text=e.text.toLowerCase()}))},unicode:e=>{const t=e.world,n=t.methods.one.killUnicode;hR(e,(e=>e.text=n(e.text,t)))},whitespace:e=>{hR(e,(e=>{e.post=e.post.replace(/\s+/g," "),e.post=e.post.replace(/\s([.,?!:;])/g,"$1"),e.pre=e.pre.replace(/\s+/g,"")}))},punctuation:e=>{hR(e,(e=>{e.post=e.post.replace(/[–—-]/g," "),e.post=e.post.replace(/[,:;]/g,""),e.post=e.post.replace(/\.{2,}/g,""),e.post=e.post.replace(/\?{2,}/g,"?"),e.post=e.post.replace(/!{2,}/g,"!"),e.post=e.post.replace(/\?!+/g,"?")}));let t=e.docs,n=t[t.length-1];if(n&&n.length>0){let e=n[n.length-1];e.post=e.post.replace(/ /g,"")}},contractions:e=>{e.contractions().expand()},acronyms:e=>{e.acronyms().strip()},parentheses:e=>{e.parentheses().strip()},possessives:e=>{e.possessives().strip()},quotations:e=>{e.quotations().strip()},emoji:e=>{e.emojis().remove()},honorifics:e=>{e.match("#Honorific+ #Person").honorifics().remove()},adverbs:e=>{e.adverbs().remove()},nouns:e=>{e.nouns().toSingular()},verbs:e=>{e.verbs().toInfinitive()},numbers:e=>{e.numbers().toNumber()},debullet:e=>{const t=/^\s*([-–—*•])\s*$/;return e.docs.forEach((e=>{t.test(e[0].pre)&&(e[0].pre=e[0].pre.replace(t,""))})),e}},pR=e=>e.split("|").reduce(((e,t)=>(e[t]=!0,e)),{}),fR="unicode|punctuation|whitespace|acronyms",mR="|case|contractions|parentheses|quotations|emoji|honorifics|debullet",gR={light:pR(fR),medium:pR(fR+mR),heavy:pR(fR+mR+"|possessives|adverbs|nouns|verbs")},yR={api:function(e){e.prototype.normalize=function(e="light"){return"string"==typeof e&&(e=gR[e]),Object.keys(e).forEach((t=>{dR.hasOwnProperty(t)&&dR[t](this,e[t])})),this}}},vR=["after","although","as if","as long as","as","because","before","even if","even though","ever since","if","in order that","provided that","since","so that","than","that","though","unless","until","what","whatever","when","whenever","where","whereas","wherever","whether","which","whichever","who","whoever","whom","whomever","whose"],bR=function(e){if(e.before("#Preposition$").found)return!0;if(!e.before().found)return!1;for(let t=0;t<vR.length;t+=1)if(e.has(vR[t]))return!0;return!1},wR=function(e,t){if(e.has("#Plural"))return!0;if(e.has("#Noun and #Noun"))return!0;if(e.has("(we|they)"))return!0;if(!0===t.has("(#Pronoun|#Place|#Value|#Person|#Uncountable|#Month|#WeekDay|#Holiday|#Possessive)"))return!1;if(e.has("#Singular"))return!1;let n=t.text("normal");return n.length>3&&n.endsWith("s")&&!n.endsWith("ss")},_R=function(e){let t=function(e){let t=e.clone();return t=t.match("#Noun+"),t=t.remove("(#Adjective|#Preposition|#Determiner|#Value)"),t=t.not("#Possessive"),t=t.first(),t.found?t:e}(e);return{determiner:e.match("#Determiner").eq(0),adjectives:e.match("#Adjective"),number:e.values(),isPlural:wR(e,t),isSubordinate:bR(e),root:t}},kR=e=>e.text(),AR=e=>e.json({terms:!1,normal:!0}).map((e=>e.normal)),PR=function(e){if(!e.found)return null;let t=e.values(0);return t.found?(t.parse()[0]||{}).num:null},TR=function(e){return!e.has("^(#Uncountable|#ProperNoun|#Place|#Pronoun|#Acronym)+$")},IR={tags:!0},ER={tags:!0},xR={api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Nouns"}parse(e){return this.getNth(e).map(_R)}json(e){let t="object"==typeof e?e:{};return this.getNth(e).map((e=>{let n=e.toView().json(t)[0]||{};return t&&!1!==t.noun&&(n.noun=function(e){let t=_R(e);return{root:kR(t.root),number:PR(t.number),determiner:kR(t.determiner),adjectives:AR(t.adjectives),isPlural:t.isPlural,isSubordinate:t.isSubordinate}}(e)),n}),[])}conjugate(e){const t=this.world.methods.two.transform.noun;return this.getNth(e).map((e=>{let n=_R(e),r=n.root.compute("root").text("root"),i={Singular:r};return TR(n.root)&&(i.Plural=t.toPlural(r,this.model)),i.Singular===i.Plural&&delete i.Plural,i}),[])}isPlural(e){let t=this.filter((e=>_R(e).isPlural));return t.getNth(e)}isSingular(e){let t=this.filter((e=>!_R(e).isPlural));return t.getNth(e)}adjectives(e){let t=this.update([]);return this.forEach((e=>{let n=_R(e).adjectives;n.found&&(t=t.concat(n))})),t.getNth(e)}toPlural(e){return this.getNth(e).map((e=>function(e,t){if(!0===t.isPlural)return e;if(t.root.has("#Possessive")&&(t.root=t.root.possessives().strip()),!TR(t.root))return e;const{methods:n,model:r}=e.world,{toPlural:i}=n.two.transform.noun;let a=i(t.root.text({keepPunct:!1}),r);e.match(t.root).replaceWith(a,IR).tag("Plural","toPlural"),t.determiner.has("(a|an)")&&e.remove(t.determiner);let s=t.root.after("not? #Adverb+? [#Copula]",0);return s.found&&(s.has("is")?e.replace(s,"are"):s.has("was")&&e.replace(s,"were")),e}(e,_R(e))))}toSingular(e){return this.getNth(e).map((e=>function(e,t){if(!1===t.isPlural)return e;const{methods:n,model:r}=e.world,{toSingular:i}=n.two.transform.noun;let a=i(t.root.text("normal"),r);return e.replace(t.root,a,ER).tag("Singular","toPlural"),e}(e,_R(e))))}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.nouns=function(e){let n=function(e){let t=e.clauses().match("<Noun>"),n=t.match("@hasComma");return n=n.not("#Place"),n.found&&(t=t.splitAfter(n)),t=t.splitOn("#Expression"),t=t.splitOn("(he|she|we|you|they|i)"),t=t.splitOn("(#Noun|#Adjective) [(he|him|she|it)]",0),t=t.splitOn("[(he|him|she|it)] (#Determiner|#Value)",0),t=t.splitBefore("#Noun [(the|a|an)] #Adjective? #Noun",0),t=t.splitOn("[(here|there)] #Noun",0),t=t.splitOn("[#Noun] (here|there)",0),t=t.splitBefore("(our|my|their|your)"),t=t.splitOn("#Noun [#Determiner]",0),t=t.if("#Noun"),t}(this);return n=n.getNth(e),new t(this.document,n.pointer)}}},CR={ones:{zeroth:0,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},teens:{tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19},tens:{twentieth:20,thirtieth:30,fortieth:40,fourtieth:40,fiftieth:50,sixtieth:60,seventieth:70,eightieth:80,ninetieth:90,twenty:20,thirty:30,forty:40,fourty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},multiples:{hundredth:100,thousandth:1e3,millionth:1e6,billionth:1e9,trillionth:1e12,quadrillionth:1e15,quintillionth:1e18,sextillionth:1e21,septillionth:1e24,hundred:100,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24,grand:1e3}},OR=(e,t)=>{if(CR.ones.hasOwnProperty(e)){if(t.ones||t.teens)return!1}else if(CR.teens.hasOwnProperty(e)){if(t.ones||t.teens||t.tens)return!1}else if(CR.tens.hasOwnProperty(e)&&(t.ones||t.teens||t.tens))return!1;return!0},SR=function(e){let t="0.";for(let n=0;n<e.length;n++){let r=e[n];if(!0===CR.ones.hasOwnProperty(r))t+=CR.ones[r];else if(!0===CR.teens.hasOwnProperty(r))t+=CR.teens[r];else if(!0===CR.tens.hasOwnProperty(r))t+=CR.tens[r];else{if(!0!==/^[0-9]$/.test(r))return 0;t+=r}}return parseFloat(t)},NR=e=>(e=(e=(e=(e=(e=(e=(e=e.replace(/1st$/,"1")).replace(/2nd$/,"2")).replace(/3rd$/,"3")).replace(/([4567890])r?th$/,"$1")).replace(/^[$€¥£¢]/,"")).replace(/[%$€¥£¢]$/,"")).replace(/,/g,"")).replace(/([0-9])([a-z\u00C0-\u00FF]{1,2})$/,"$1"),jR=/^([0-9,. ]+)\/([0-9,. ]+)$/,DR={"a few":3,"a couple":2,"a dozen":12,"two dozen":24,zero:0},RR=e=>Object.keys(e).reduce(((t,n)=>t+e[n]),0),LR=function(e){if(!0===DR.hasOwnProperty(e))return DR[e];if("a"===e||"an"===e)return 1;const t=(e=>{const t=[{reg:/^(minus|negative)[\s-]/i,mult:-1},{reg:/^(a\s)?half[\s-](of\s)?/i,mult:.5}];for(let n=0;n<t.length;n++)if(!0===t[n].reg.test(e))return{amount:t[n].mult,str:e.replace(t[n].reg,"")};return{amount:1,str:e}})(e);let n=null,r={},i=0,a=!1;const s=(e=t.str).split(/[ -]/);for(let e=0;e<s.length;e++){let o=s[e];if(o=NR(o),!o||"and"===o)continue;if("-"===o||"negative"===o){a=!0;continue}if("-"===o.charAt(0)&&(a=!0,o=o.substring(1)),"point"===o)return i+=RR(r),i+=SR(s.slice(e+1,s.length)),i*=t.amount,i;const l=o.match(jR);if(l){const e=parseFloat(l[1].replace(/[, ]/g,"")),t=parseFloat(l[2].replace(/[, ]/g,""));t&&(i+=e/t||0)}else{if(CR.tens.hasOwnProperty(o)&&r.ones&&1===Object.keys(r).length&&(i=100*r.ones,r={}),!1===OR(o,r))return null;if(/^[0-9.]+$/.test(o))r.ones=parseFloat(o);else if(!0===CR.ones.hasOwnProperty(o))r.ones=CR.ones[o];else if(!0===CR.teens.hasOwnProperty(o))r.teens=CR.teens[o];else if(!0===CR.tens.hasOwnProperty(o))r.tens=CR.tens[o];else if(!0===CR.multiples.hasOwnProperty(o)){let t=CR.multiples[o];if(t===n)return null;if(100===t&&void 0!==s[e+1]){const n=s[e+1];CR.multiples[n]&&(t*=CR.multiples[n],e+=1)}null===n||t<n?(i+=(RR(r)||1)*t,n=t,r={}):(i+=RR(r),n=t,i=(i||1)*t,r={})}}}return i+=RR(r),i*=t.amount,i*=a?-1:1,0===i&&0===Object.keys(r).length?null:i},MR=/s$/,$R=function(e){let t=e.text("reduced");return LR(t)};let FR={half:2,halve:2,quarter:4};const VR=function(e){let t=function(e){let t=e.text("reduced");return FR.hasOwnProperty(t)?{numerator:1,denominator:FR[t]}:null}(e=e.clone())||function(e){let t=e.text("reduced").match(/^([-+]?[0-9]+)\/([-+]?[0-9]+)(st|nd|rd|th)?s?$/);return t&&t[1]&&t[0]?{numerator:Number(t[1]),denominator:Number(t[2])}:null}(e)||function(e){let t=e.match("[<num>#Value+] out of every? [<den>#Value+]");if(!0!==t.found)return null;let{num:n,den:r}=t.groups();return n&&r?(n=$R(n),r=$R(r),n&&r&&"number"==typeof n&&"number"==typeof r?{numerator:n,denominator:r}:null):null}(e)||function(e){let t=e.match("[<num>(#Cardinal|a)+] [<den>#Fraction+]");if(!0!==t.found)return null;let{num:n,den:r}=t.groups();n=n.has("a")?1:$R(n);let i=r.text("reduced");return MR.test(i)&&(i=i.replace(MR,""),r=r.replaceWith(i)),r=FR.hasOwnProperty(i)?FR[i]:$R(r),"number"==typeof n&&"number"==typeof r?{numerator:n,denominator:r}:null}(e)||function(e){let t=e.match("^#Ordinal$");return!0!==t.found?null:e.lookAhead("^of .")?{numerator:1,denominator:$R(t)}:null}(e)||null;return null!==t&&t.numerator&&t.denominator&&(t.decimal=t.numerator/t.denominator,t.decimal=(e=>{let t=Math.round(1e3*e)/1e3;return 0===t&&0!==e?e:t})(t.decimal)),t},zR=function(e){if(e<1e6)return String(e);let t;return t="number"==typeof e?e.toFixed(0):e,-1===t.indexOf("e+")?t:t.replace(".","").split("e+").reduce((function(e,t){return e+Array(t-e.length+2).join(0)}))},BR=[["ninety",90],["eighty",80],["seventy",70],["sixty",60],["fifty",50],["forty",40],["thirty",30],["twenty",20]],UR=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],HR=[[1e24,"septillion"],[1e20,"hundred sextillion"],[1e21,"sextillion"],[1e20,"hundred quintillion"],[1e18,"quintillion"],[1e17,"hundred quadrillion"],[1e15,"quadrillion"],[1e14,"hundred trillion"],[1e12,"trillion"],[1e11,"hundred billion"],[1e9,"billion"],[1e8,"hundred million"],[1e6,"million"],[1e5,"hundred thousand"],[1e3,"thousand"],[100,"hundred"],[1,"one"]],GR=function(e){let t=[];if(e>100)return t;for(let n=0;n<BR.length;n++)e>=BR[n][1]&&(e-=BR[n][1],t.push(BR[n][0]));return UR[e]&&t.push(UR[e]),t},qR=function(e){let t=e.num;if(0===t||"0"===t)return"zero";t>1e21&&(t=zR(t));let n=[];t<0&&(n.push("minus"),t=Math.abs(t));let r=function(e){let t=e,n=[];return HR.forEach((r=>{if(e>=r[0]){let e=Math.floor(t/r[0]);t-=e*r[0],e&&n.push({unit:r[1],count:e})}})),n}(t);for(let e=0;e<r.length;e++){let t=r[e].unit;"one"===t&&(t="",n.length>1&&n.push("and")),n=n.concat(GR(r[e].count)),n.push(t)}return n=n.concat((e=>{const t=["zero","one","two","three","four","five","six","seven","eight","nine"];let n=[],r=zR(e).match(/\.([0-9]+)/);if(!r||!r[0])return n;n.push("point");let i=r[0].split("");for(let e=0;e<i.length;e++)n.push(t[i[e]]);return n})(t)),n=n.filter((e=>e)),0===n.length&&(n[0]=""),n.join(" ")},KR={one:"first",two:"second",three:"third",five:"fifth",eight:"eighth",nine:"ninth",twelve:"twelfth",twenty:"twentieth",thirty:"thirtieth",forty:"fortieth",fourty:"fourtieth",fifty:"fiftieth",sixty:"sixtieth",seventy:"seventieth",eighty:"eightieth",ninety:"ninetieth"},WR=e=>{let t=qR(e).split(" "),n=t[t.length-1];return KR.hasOwnProperty(n)?t[t.length-1]=KR[n]:t[t.length-1]=n.replace(/y$/,"i")+"th",t.join(" ")},JR="twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety|fourty",ZR=function(e){let t=e.match("#Value+");if(t.has("#NumericValue #NumericValue")&&(t.has("#Value @hasComma #Value")?t.splitAfter("@hasComma"):t.has("#NumericValue #Fraction")?t.splitAfter("#NumericValue #Fraction"):t=t.splitAfter("#NumericValue")),t.has("#Value #Value #Value")&&!t.has("#Multiple")&&t.has("("+JR+") #Cardinal #Cardinal")&&(t=t.splitAfter("("+JR+") #Cardinal")),t.has("#Value #Value")){t.has("#NumericValue #NumericValue")&&(t=t.splitOn("#Year")),t.has("("+JR+") (eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen)")&&(t=t.splitAfter("("+JR+")"));let e=t.match("#Cardinal #Cardinal");if(e.found&&!t.has("(point|decimal|#Fraction)")&&!e.has("#Cardinal (#Multiple|point|decimal)")){let n=t.has(`(one|two|three|four|five|six|seven|eight|nine) (${JR})`),r=e.has("("+JR+") #Cardinal"),i=e.has("#Multiple #Value");n||r||i||e.terms().forEach((e=>{t=t.splitOn(e)}))}t.match("#Ordinal #Ordinal").match("#TextValue").found&&!t.has("#Multiple")&&(t.has("("+JR+") #Ordinal")||(t=t.splitAfter("#Ordinal"))),t=t.splitBefore("#Ordinal [#Cardinal]",0),t.has("#TextValue #NumericValue")&&!t.has("("+JR+"|#Multiple)")&&(t=t.splitBefore("#TextValue #NumericValue"))}return t=t.splitAfter("#NumberRange"),t=t.splitBefore("#Year"),t},QR=function(e){if("string"==typeof e)return{num:LR(e)};let t=e.text("reduced"),n=e.growRight("#Unit").match("#Unit$").text("machine"),r=/[0-9],[0-9]/.test(e.text("text"));if(1===e.terms().length&&!e.has("#Multiple")){let i=function(e,t){let n=(e=e.replace(/,/g,"")).split(/([0-9.,]*)/),[r,i]=n,a=n.slice(2).join("");return""!==i&&t.length<2?(i=Number(i||e),"number"!=typeof i&&(i=null),a=a||"","st"!==a&&"nd"!==a&&"rd"!==a&&"th"!==a||(a=""),{prefix:r||"",num:i,suffix:a}):null}(t,e);if(null!==i)return i.hasComma=r,i.unit=n,i}let i=e.match("#Fraction{2,}$");i=!1===i.found?e.match("^#Fraction$"):i;let a=null;i.found&&(i.has("#Value and #Value #Fraction")&&(i=i.match("and #Value #Fraction")),a=VR(i),t=(e=(e=e.not(i)).not("and$")).text("reduced"));let s=0;return t&&(s=LR(t)||0),a&&a.decimal&&(s+=a.decimal),{hasComma:r,prefix:"",num:s,suffix:"",isOrdinal:e.has("#Ordinal"),isText:e.has("#TextValue"),isFraction:e.has("#Fraction"),isMoney:e.has("#Money"),unit:n}},XR={"¢":"cents",$:"dollars","£":"pounds","¥":"yen","€":"euros","₡":"colón","฿":"baht","₭":"kip","₩":"won","₹":"rupees","₽":"ruble","₺":"liras"},YR={"%":"percent","°":"degrees"},eL=function(e){let t={suffix:"",prefix:e.prefix};return XR.hasOwnProperty(e.prefix)&&(t.suffix+=" "+XR[e.prefix],t.prefix=""),YR.hasOwnProperty(e.suffix)&&(t.suffix+=" "+YR[e.suffix]),t.suffix&&1===e.num&&(t.suffix=t.suffix.replace(/s$/,"")),!t.suffix&&e.suffix&&(t.suffix+=" "+e.suffix),t},tL=function(e,t){if("TextOrdinal"===t){let{prefix:t,suffix:n}=eL(e);return t+WR(e)+n}if("Ordinal"===t)return e.prefix+function(e){let t=e.num;if(!t&&0!==t)return null;let n=t%100;if(n>10&&n<20)return String(t)+"th";const r={0:"th",1:"st",2:"nd",3:"rd"};let i=zR(t),a=i.slice(i.length-1,i.length);return i+=r[a]?r[a]:"th",i}(e)+e.suffix;if("TextCardinal"===t){let{prefix:t,suffix:n}=eL(e);return t+qR(e)+n}let n=e.num;return e.hasComma&&(n=n.toLocaleString()),e.prefix+String(n)+e.suffix},nL={api:function(e){(function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Fractions"}parse(e){return this.getNth(e).map(VR)}get(e){return this.getNth(e).map(VR)}json(e){return this.getNth(e).map((t=>{let n=t.toView().json(e)[0],r=VR(t);return n.fraction=r,n}),[])}toDecimal(e){return this.getNth(e).forEach((e=>{let{decimal:t}=VR(e);(e=e.replaceWith(String(t),!0)).tag("NumericValue"),e.unTag("Fraction")})),this}toFraction(e){return this.getNth(e).forEach((e=>{let t=VR(e);if(t&&"number"==typeof t.numerator&&"number"==typeof t.denominator){let n=`${t.numerator}/${t.denominator}`;this.replace(e,n)}})),this}toOrdinal(e){return this.getNth(e).forEach((e=>{let t=function(e){if(!e.numerator||!e.denominator)return"";let t=qR({num:e.numerator}),n=WR({num:e.denominator});return 2===e.denominator&&(n="half"),t&&n?(1!==e.numerator&&(n+="s"),`${t} ${n}`):""}(VR(e));e.after("^#Noun").found&&(t+=" of"),e.replaceWith(t)})),this}toCardinal(e){return this.getNth(e).forEach((e=>{let t=function(e){return e.numerator&&e.denominator?`${qR({num:e.numerator})} out of ${qR({num:e.denominator})}`:""}(VR(e));e.replaceWith(t)})),this}toPercentage(e){return this.getNth(e).forEach((e=>{let{decimal:t}=VR(e),n=100*t;n=Math.round(100*n)/100,e.replaceWith(`${n}%`)})),this}}e.prototype.fractions=function(e){let n=function(e,t){let n=e.match("#Fraction+");return n=n.filter((e=>!e.lookBehind("#Value and$").found)),n=n.notIf("#Value seconds"),n}(this);return n=n.getNth(e),new t(this.document,n.pointer)}})(e),function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Numbers"}parse(e){return this.getNth(e).map(QR)}get(e){return this.getNth(e).map(QR).map((e=>e.num))}json(e){let t="object"==typeof e?e:{};return this.getNth(e).map((e=>{let n=e.toView().json(t)[0],r=QR(e);return n.number={prefix:r.prefix,num:r.num,suffix:r.suffix,hasComma:r.hasComma,unit:r.unit},n}),[])}units(){return this.growRight("#Unit").match("#Unit$")}isUnit(e){return function(e,t={}){return t=function(e){if("string"==typeof e||"number"==typeof e){let t={};return t[e]=!0,t}return t=e,"[object Array]"===Object.prototype.toString.call(t)?e.reduce(((e,t)=>(e[t]=!0,e)),{}):e||{};var t}(t),e.filter((e=>{let{unit:n}=QR(e);return!(!n||!0!==t[n])}))}(this,e)}isOrdinal(){return this.if("#Ordinal")}isCardinal(){return this.if("#Cardinal")}toNumber(){let e=this.map((e=>{if(!this.has("#TextValue"))return e;let t=QR(e);if(null===t.num)return e;let n=e.has("#Ordinal")?"Ordinal":"Cardinal",r=tL(t,n);return e.replaceWith(r,{tags:!0}),e.tag("NumericValue")}));return new t(e.document,e.pointer)}toLocaleString(){return this.forEach((e=>{let t=QR(e);if(null===t.num)return;let n=t.num.toLocaleString();if(e.has("#Ordinal")){let e=tL(t,"Ordinal").match(/[a-z]+$/);e&&(n+=e[0]||"")}e.replaceWith(n,{tags:!0})})),this}toText(){let e=this.map((e=>{if(e.has("#TextValue"))return e;let t=QR(e);if(null===t.num)return e;let n=e.has("#Ordinal")?"TextOrdinal":"TextCardinal",r=tL(t,n);return e.replaceWith(r,{tags:!0}),e.tag("TextValue"),e}));return new t(e.document,e.pointer)}toCardinal(){let e=this.map((e=>{if(!e.has("#Ordinal"))return e;let t=QR(e);if(null===t.num)return e;let n=e.has("#TextValue")?"TextCardinal":"Cardinal",r=tL(t,n);return e.replaceWith(r,{tags:!0}),e.tag("Cardinal"),e}));return new t(e.document,e.pointer)}toOrdinal(){let e=this.map((e=>{if(e.has("#Ordinal"))return e;let t=QR(e);if(null===t.num)return e;let n=e.has("#TextValue")?"TextOrdinal":"Ordinal",r=tL(t,n);return e.replaceWith(r,{tags:!0}),e.tag("Ordinal"),e}));return new t(e.document,e.pointer)}isEqual(e){return this.filter((t=>QR(t).num===e))}greaterThan(e){return this.filter((t=>QR(t).num>e))}lessThan(e){return this.filter((t=>QR(t).num<e))}between(e,t){return this.filter((n=>{let r=QR(n).num;return r>e&&r<t}))}set(e){if(void 0===e)return this;"string"==typeof e&&(e=QR(e).num);let n=this.map((t=>{let n=QR(t);if(n.num=e,null===n.num)return t;let r=t.has("#Ordinal")?"Ordinal":"Cardinal";t.has("#TextValue")&&(r=t.has("#Ordinal")?"TextOrdinal":"TextCardinal");let i=tL(n,r);return n.hasComma&&"Cardinal"===r&&(i=Number(i).toLocaleString()),(t=t.not("#Currency")).replaceWith(i,{tags:!0}),t}));return new t(n.document,n.pointer)}add(e){if(!e)return this;"string"==typeof e&&(e=QR(e).num);let n=this.map((t=>{let n=QR(t);if(null===n.num)return t;n.num+=e;let r=t.has("#Ordinal")?"Ordinal":"Cardinal";n.isText&&(r=t.has("#Ordinal")?"TextOrdinal":"TextCardinal");let i=tL(n,r);return t.replaceWith(i,{tags:!0}),t}));return new t(n.document,n.pointer)}subtract(e,t){return this.add(-1*e,t)}increment(e){return this.add(1,e)}decrement(e){return this.add(-1,e)}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}t.prototype.toNice=t.prototype.toLocaleString,t.prototype.isBetween=t.prototype.between,t.prototype.minus=t.prototype.subtract,t.prototype.plus=t.prototype.add,t.prototype.equals=t.prototype.isEqual,e.prototype.numbers=function(e){let n=ZR(this);return n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.percentages=function(e){let n=ZR(this);return n=n.filter((e=>e.has("#Percent")||e.after("^percent"))),n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.money=function(e){let n=ZR(this);return n=n.filter((e=>e.has("#Money")||e.after("^#Currency"))),n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.values=e.prototype.numbers}(e)}},rL={people:!0,emails:!0,phoneNumbers:!0,places:!0},iL=function(e={}){return!1!==(e=Object.assign({},rL,e)).people&&this.people().replaceWith("██████████"),!1!==e.emails&&this.emails().replaceWith("██████████"),!1!==e.places&&this.places().replaceWith("██████████"),!1!==e.phoneNumbers&&this.phoneNumbers().replaceWith("███████"),this},aL={api:function(e){e.prototype.redact=iL}},sL=aL,oL=function(e){let t=null;return e.has("#PastTense")?t="PastTense":e.has("#FutureTense")?t="FutureTense":e.has("#PresentTense")&&(t="PresentTense"),{tense:t}},lL=function(e){let t=function(e){let t=e;return 1===t.length?t:(t=t.if("#Verb"),1===t.length?t:(t=t.ifNo("(after|although|as|because|before|if|since|than|that|though|when|whenever|where|whereas|wherever|whether|while|why|unless|until|once)"),t=t.ifNo("^even (if|though)"),t=t.ifNo("^so that"),t=t.ifNo("^rather than"),t=t.ifNo("^provided that"),1===t.length?t:(t=t.ifNo("(that|which|whichever|who|whoever|whom|whose|whomever)"),1===t.length?t:(t=t.ifNo("(^despite|^during|^before|^through|^throughout)"),1===t.length?t:(t=t.ifNo("^#Gerund"),1===t.length?t:(0===t.length&&(t=e),t.eq(0)))))))}(e.clauses()).chunks(),n=e.none(),r=e.none(),i=e.none();return t.forEach(((e,t)=>{0!==t||e.has("<Verb>")?r.found||!e.has("<Verb>")?r.found&&(i=i.concat(e)):r=e:n=e})),r.found&&!n.found&&(n=r.before("<Noun>+").first()),{subj:n,verb:r,pred:i,grammar:oL(r)}},uL={api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Sentences"}json(e={}){return this.map((t=>{let n=t.toView().json(e)[0]||{},{subj:r,verb:i,pred:a,grammar:s}=lL(t);return n.sentence={subject:r.text("normal"),verb:i.text("normal"),predicate:a.text("normal"),grammar:s},n}),[])}toPastTense(e){return this.getNth(e).map((e=>(lL(e),function(e){let t=e.verbs(),n=t.eq(0);if(n.has("#PastTense"))return e;if(n.toPastTense(),t.length>1){t=t.slice(1),t=t.filter((e=>!e.lookBehind("to$").found)),t=t.if("#PresentTense"),t=t.notIf("#Gerund");let n=e.match("to #Verb+ #Conjunction #Verb").terms();t=t.not(n),t.found&&t.verbs().toPastTense()}return e}(e))))}toPresentTense(e){return this.getNth(e).map((e=>(lL(e),function(e){let t=e.verbs();return t.eq(0).toPresentTense(),t.length>1&&(t=t.slice(1),t=t.filter((e=>!e.lookBehind("to$").found)),t=t.notIf("#Gerund"),t.found&&t.verbs().toPresentTense()),e}(e))))}toFutureTense(e){return this.getNth(e).map((e=>(lL(e),function(e){let t=e.verbs();if(t.eq(0).toFutureTense(),t=(e=e.fullSentence()).verbs(),t.length>1){t=t.slice(1);let e=t.filter((e=>!(e.lookBehind("to$").found||!e.has("#Copula #Gerund")&&(e.has("#Gerund")||!e.has("#Copula")&&e.has("#PresentTense")&&!e.has("#Infinitive")&&e.lookBefore("(he|she|it|that|which)$").found))));e.found&&e.forEach((e=>{if(e.has("#Copula"))return e.match("was").replaceWith("is"),void e.match("is").replaceWith("will be");e.toInfinitive()}))}return e}(e))))}toInfinitive(e){return this.getNth(e).map((e=>(lL(e),function(e){return e.verbs().toInfinitive(),e}(e))))}toNegative(e){return this.getNth(e).map((e=>(lL(e),function(e){return e.verbs().first().toNegative().compute("chunks"),e}(e))))}toPositive(e){return this.getNth(e).map((e=>(lL(e),function(e){return e.verbs().first().toPositive().compute("chunks"),e}(e))))}isQuestion(e){return this.questions(e)}isExclamation(e){let t=this.filter((e=>e.lastTerm().has("@hasExclamation")));return t.getNth(e)}isStatement(e){let t=this.filter((e=>!e.isExclamation().found&&!e.isQuestion().found));return t.getNth(e)}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}t.prototype.toPresent=t.prototype.toPresentTense,t.prototype.toPast=t.prototype.toPastTense,t.prototype.toFuture=t.prototype.toFutureTense;const n={sentences:function(e){let n=this.map((e=>e.fullSentence()));return n=n.getNth(e),new t(this.document,n.pointer)},questions:function(e){return function(e){const t=/\?/,{document:n}=e;return e.filter((e=>{let r=e.docs[0]||[],i=r[r.length-1];return!(!i||n[i.index[0]].length!==r.length)&&(!!t.test(i.post)||function(e){let t=e.clauses();return!(/\.\.$/.test(e.out("text"))||e.has("^#QuestionWord")&&e.has("@hasComma")||!e.has("or not$")&&!e.has("^#QuestionWord")&&!e.has("^(do|does|did|is|was|can|could|will|would|may) #Noun")&&!e.has("^(have|must) you")&&!t.has("(do|does|is|was) #Noun+ #Adverb? (#Adjective|#Infinitive)$"))}(e))}))}(this).getNth(e)}};Object.assign(e.prototype,n)}},cL=function(e){let t={};t.firstName=e.match("#FirstName+"),t.lastName=e.match("#LastName+"),t.honorific=e.match("#Honorific+");let n=t.lastName,r=t.firstName;return r.found&&n.found||r.found||n.found||!e.has("^#Honorific .$")||(t.lastName=e.match(".$")),t},hL="male",dL="female",pL={mr:hL,mrs:dL,miss:dL,madam:dL,king:hL,queen:dL,duke:hL,duchess:dL,baron:hL,baroness:dL,count:hL,countess:dL,prince:hL,princess:dL,sire:hL,dame:dL,lady:dL,ayatullah:hL,congressman:hL,congresswoman:dL,"first lady":dL,mx:null},fL=function(e,t){let{firstName:n,honorific:r}=e;if(n.has("#FemaleName"))return dL;if(n.has("#MaleName"))return hL;if(r.found){let e=r.text("normal");if(e=e.replace(/\./g,""),pL.hasOwnProperty(e))return pL[e];if(/^her /.test(e))return dL;if(/^his /.test(e))return hL}let i=t.after();if(!i.has("#Person")&&i.has("#Pronoun")){let e=i.match("#Pronoun");if(e.has("(they|their)"))return null;let t=e.has("(he|his)"),n=e.has("(she|her|hers)");if(t&&!n)return hL;if(n&&!t)return dL}return null},mL=function(e){let t=this.clauses(),n=t.people();return n=n.concat(t.places()),n=n.concat(t.organizations()),n=n.not("(someone|man|woman|mother|brother|sister|father)"),n=n.sort("seq"),n=n.getNth(e),n},gL={api:function(e){(function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="People"}parse(e){return this.getNth(e).map(cL)}json(e){let t="object"==typeof e?e:{};return this.getNth(e).map((e=>{let n=e.toView().json(t)[0],r=cL(e);return n.person={firstName:r.firstName.text("normal"),lastName:r.lastName.text("normal"),honorific:r.honorific.text("normal"),presumed_gender:fL(r,e)},n}),[])}presumedMale(){return this.filter((e=>e.has("(#MaleName|mr|mister|sr|jr|king|pope|prince|sir)")))}presumedFemale(){return this.filter((e=>e.has("(#FemaleName|mrs|miss|queen|princess|madam)")))}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.people=function(e){let n=function(e){let t=e.splitAfter("@hasComma");t=t.match("#Honorific+? #Person+");let n=t.match("#Possessive").notIf("(his|her)");return t=t.splitAfter(n),t}(this);return n=n.getNth(e),new t(this.document,n.pointer)}})(e),function(e){e.prototype.places=function(t){let n=function(e){let t=e.match("(#Place|#Address)+"),n=t.match("@hasComma");return n=n.filter((e=>!!e.has("(asia|africa|europe|america)$")||!e.has("(#City|#Region|#ProperNoun)$")||!e.after("^(#Country|#Region)").found)),t=t.splitAfter(n),t}(this);return n=n.getNth(t),new e(this.document,n.pointer)}}(e),function(e){e.prototype.organizations=function(e){return this.match("#Organization+").getNth(e)}}(e),function(e){e.prototype.topics=mL}(e)}},yL=function(e,t){let n={pre:e.none(),post:e.none()};if(!e.has("#Adverb"))return n;let r=e.splitOn(t);return 3===r.length?{pre:r.eq(0).adverbs(),post:r.eq(2).adverbs()}:r.eq(0).isDoc(t)?(n.post=r.eq(1).adverbs(),n):(n.pre=r.eq(0).adverbs(),n)},vL=function(e,t){let n=e.splitBefore(t);if(n.length<=1)return e.none();let r=n.eq(0);return r=r.not("(#Adverb|#Negative|#Prefix)"),r},bL=function(e){return e.match("#Negative")},wL=function(e){if(!e.has("(#Particle|#PhrasalVerb)"))return{verb:e.none(),particle:e.none()};let t=e.match("#Particle$");return{verb:e.not(t),particle:t}},_L=function(e){let t=e.clone();t.contractions().expand();const n=function(e){let t=e;return e.wordCount()>1&&(t=e.not("(#Negative|#Auxiliary|#Modal|#Adverb|#Prefix)")),t.length>1&&!t.has("#Phrasal #Particle")&&(t=t.last()),t=t.not("(want|wants|wanted) to"),t.found||(t=e.not("#Negative")),t}(t);return{root:n,prefix:t.match("#Prefix"),adverbs:yL(t,n),auxiliary:vL(t,n),negative:bL(t),phrasal:wL(n)}},kL={tense:"PresentTense"},AL={conditional:!0},PL={tense:"FutureTense"},TL={progressive:!0},IL={tense:"PastTense"},EL={complete:!0,progressive:!1},xL={passive:!0},CL=function(e){let t={};return e.forEach((e=>{Object.assign(t,e)})),t},OL={imperative:[["#Imperative",[]]],"want-infinitive":[["^(want|wants|wanted) to #Infinitive$",[kL]],["^wanted to #Infinitive$",[IL]],["^will want to #Infinitive$",[PL]]],"gerund-phrase":[["^#PastTense #Gerund$",[IL]],["^#PresentTense #Gerund$",[kL]],["^#Infinitive #Gerund$",[kL]],["^will #Infinitive #Gerund$",[PL]],["^have #PastTense #Gerund$",[IL]],["^will have #PastTense #Gerund$",[IL]]],"simple-present":[["^#PresentTense$",[kL]],["^#Infinitive$",[kL]]],"simple-past":[["^#PastTense$",[IL]]],"simple-future":[["^will #Adverb? #Infinitive",[PL]]],"present-progressive":[["^(is|are|am) #Gerund$",[kL,TL]]],"past-progressive":[["^(was|were) #Gerund$",[IL,TL]]],"future-progressive":[["^will be #Gerund$",[PL,TL]]],"present-perfect":[["^(has|have) #PastTense$",[IL,EL]]],"past-perfect":[["^had #PastTense$",[IL,EL]],["^had #PastTense to #Infinitive",[IL,EL]]],"future-perfect":[["^will have #PastTense$",[PL,EL]]],"present-perfect-progressive":[["^(has|have) been #Gerund$",[IL,TL]]],"past-perfect-progressive":[["^had been #Gerund$",[IL,TL]]],"future-perfect-progressive":[["^will have been #Gerund$",[PL,TL]]],"passive-past":[["(got|were|was) #Passive",[IL,xL]],["^(was|were) being #Passive",[IL,xL]],["^(had|have) been #Passive",[IL,xL]]],"passive-present":[["^(is|are|am) #Passive",[kL,xL]],["^(is|are|am) being #Passive",[kL,xL]],["^has been #Passive",[kL,xL]]],"passive-future":[["will have been #Passive",[PL,xL,AL]],["will be being? #Passive",[PL,xL,AL]]],"present-conditional":[["would be #PastTense",[kL,AL]]],"past-conditional":[["would have been #PastTense",[IL,AL]]],"auxiliary-future":[["(is|are|am|was) going to (#Infinitive|#PresentTense)",[PL]]],"auxiliary-past":[["^did #Infinitive$",[IL,{plural:!1}]],["^used to #Infinitive$",[IL,EL]]],"auxiliary-present":[["^(does|do) #Infinitive$",[kL,EL,{plural:!0}]]],"modal-past":[["^(could|must|should|shall) have #PastTense$",[IL]]],"modal-infinitive":[["^#Modal #Infinitive$",[]]],infinitive:[["^#Infinitive$",[]]]};let SL=[];Object.keys(OL).map((e=>{OL[e].forEach((t=>{SL.push({name:e,match:t[0],data:CL(t[1])})}))}));const NL=SL,jL=function(e,t){let n={};e=function(e,t){return e=e.clone(),t.adverbs.post&&t.adverbs.post.found&&e.remove(t.adverbs.post),t.adverbs.pre&&t.adverbs.pre.found&&e.remove(t.adverbs.pre),e.has("#Negative")&&(e=e.remove("#Negative")),e.has("#Prefix")&&(e=e.remove("#Prefix")),t.root.has("#PhrasalVerb #Particle")&&e.remove("#Particle$"),e.not("#Adverb")}(e,t);for(let t=0;t<NL.length;t+=1){let r=NL[t];if(!0===e.has(r.match)){n.form=r.name,Object.assign(n,r.data);break}}return n.form||e.has("^#Verb$")&&(n.form="infinitive"),n.tense||(n.tense=t.root.has("#PastTense")?"PastTense":"PresentTense"),n.copula=t.root.has("#Copula"),n.isInfinitive=function(e){return!(!e.has("#Infinitive")||!e.growLeft("to").has("^to #Infinitive"))}(e),n},DL=function(e){return!(e.length<=1)&&(e.parse()[0]||{}).isSubordinate},RL=function(e,t){return!!t.has("(are|were|does)")||!!e.has("(those|they|we)")||!(!e.found||!e.isPlural)&&e.isPlural().found},LL=function(e){let t=function(e){let t=e.before();t=function(e){let t=e.clauses();return t=t.filter(((e,t)=>!(e.has("^(if|unless|while|but|for|per|at|by|that|which|who|from)")||t>0&&e.has("^#Verb . #Noun+$")||t>0&&e.has("^#Adverb")))),0===t.length?e:t}(t);let n=t.nouns(),r=n.last(),i=r.match("(i|he|she|we|you|they)");if(i.found)return i.nouns();let a=n.if("^(that|this|those)");return a.found||!1===n.found&&(a=t.match("^(that|this|those)"),a.found)?a:(r=n.last(),DL(r)&&(n.remove(r),r=n.last()),DL(r)&&(n.remove(r),r=n.last()),r)}(e);return{subject:t,plural:RL(t,e)}},ML=e=>e,$L=(e,t)=>{let n=LL(e),r=n.subject;return!(!r.has("i")&&!r.has("we"))||n.plural},FL=function(e,t){if(e.has("were"))return"are";let{subject:n,plural:r}=LL(e);return n.has("i")?"am":n.has("we")||r?"are":"is"},VL=function(e,t){let n=LL(e),r=n.subject;return r.has("i")||r.has("we")||n.plural?"do":"does"},zL=function(e){return e.has("#Infinitive")?"Infinitive":e.has("#Participle")?"Participle":e.has("#PastTense")?"PastTense":e.has("#Gerund")?"Gerund":e.has("#PresentTense")?"PresentTense":void 0},BL=function(e,t){const{toInfinitive:n}=e.methods.two.transform.verb;let r=t.root.text({keepPunct:!1});return r=n(r,e.model,zL(e)),r&&e.replace(t.root,r),e},UL=e=>e.has("will not")?e.replace("will not","have not"):e.remove("will"),HL=function(e){return e&&e.isView?e.json({normal:!0,terms:!1,text:!1}).map((e=>e.normal)):[]},GL=function(e){return e&&e.isView?e.text("normal"):""},qL=function(e){const{toInfinitive:t}=e.methods.two.transform.verb;return t(e.text("normal"),e.model,zL(e))},KL={tags:!0},WL={tags:!0},JL={noAux:(e,t)=>(t.auxiliary.found&&(e=e.remove(t.auxiliary)),e),simple:(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;if(i.has("#Modal"))return e;let a=i.text({keepPunct:!1});return a=r(a,e.model,zL(i)),a=n(a,e.model).PastTense,a="been"===a?"was":a,"was"===a&&(a=((e,t)=>{let{subject:n,plural:r}=LL(e);return r||n.has("we")?"were":"was"})(e)),a&&e.replace(i,a,WL),e},both:function(e,t){return t.negative.found?(e.replace("will","did"),e):(e=JL.simple(e,t),e=JL.noAux(e,t))},hasHad:e=>(e.replace("has","had",WL),e),hasParticiple:(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;let a=i.text("normal");return a=r(a,e.model,zL(i)),n(a,e.model).Participle}},ZL={infinitive:JL.simple,"simple-present":JL.simple,"simple-past":ML,"simple-future":JL.both,"present-progressive":e=>(e.replace("are","were",WL),e.replace("(is|are|am)","was",WL),e),"past-progressive":ML,"future-progressive":(e,t)=>(e.match(t.root).insertBefore("was"),e.remove("(will|be)"),e),"present-perfect":JL.hasHad,"past-perfect":ML,"future-perfect":(e,t)=>(e.match(t.root).insertBefore("had"),e.has("will")&&(e=UL(e)),e.remove("have"),e),"present-perfect-progressive":JL.hasHad,"past-perfect-progressive":ML,"future-perfect-progressive":e=>(e.remove("will"),e.replace("have","had",WL),e),"passive-past":e=>(e.replace("have","had",WL),e),"passive-present":e=>(e.replace("(is|are)","was",WL),e),"passive-future":(e,t)=>(t.auxiliary.has("will be")&&(e.match(t.root).insertBefore("had been"),e.remove("(will|be)")),t.auxiliary.has("will have been")&&(e.replace("have","had",WL),e.remove("will")),e),"present-conditional":e=>(e.replace("be","have been"),e),"past-conditional":ML,"auxiliary-future":e=>(e.replace("(is|are|am)","was",WL),e),"auxiliary-past":ML,"auxiliary-present":e=>(e.replace("(do|does)","did",WL),e),"modal-infinitive":(e,t)=>(e.has("can")?e.replace("can","could",WL):(JL.simple(e,t),e.match("#Modal").insertAfter("have").tag("Auxiliary")),e),"modal-past":ML,"want-infinitive":e=>(e.replace("(want|wants)","wanted",WL),e.remove("will"),e),"gerund-phrase":(e,t)=>(t.root=t.root.not("#Gerund$"),JL.simple(e,t),UL(e),e)},QL=function(e,t){let n=LL(e),r=n.subject;return r.has("(i|we|you)")?"have":!1===n.plural||r.has("he")||r.has("she")||r.has("#Person")?"has":"have"},XL=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,{root:i,auxiliary:a}=t;if(i.has("#Modal"))return e;let s=i.text({keepPunct:!1});s=r(s,e.model,zL(i));let o=n(s,e.model);if(s=o.Participle||o.PastTense,s){e=e.replace(i,s);let t=QL(e);e.prepend(t).match(t).tag("Auxiliary"),e.remove(a)}return e},YL={infinitive:XL,"simple-present":XL,"simple-future":(e,t)=>e.replace("will",QL(e)),"present-perfect":ML,"past-perfect":ML,"future-perfect":(e,t)=>e.replace("will have",QL(e)),"present-perfect-progressive":ML,"past-perfect-progressive":ML,"future-perfect-progressive":ML},eM={tags:!0},tM=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;let a=i.text("normal");return a=r(a,e.model,zL(i)),!1===$L(e)&&(a=n(a,e.model).PresentTense),i.has("#Copula")&&(a=FL(e)),a&&(e=e.replace(i,a,eM)).not("#Particle").tag("PresentTense"),e},nM=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;let a=i.text("normal");return a=r(a,e.model,zL(i)),!1===$L(e)&&(a=n(a,e.model).Gerund),a&&(e=e.replace(i,a,eM)).not("#Particle").tag("Gerund"),e},rM={infinitive:tM,"simple-present":(e,t)=>{const{conjugate:n}=e.methods.two.transform.verb;let{root:r}=t;if(!r.has("#Infinitive"))return tM(e,t);{let t=LL(e).subject;if($L(e)||t.has("i"))return e;let i=r.text("normal"),a=n(i,e.model).PresentTense;i!==a&&e.replace(r,a,eM)}return e},"simple-past":tM,"simple-future":(e,t)=>{const{root:n,auxiliary:r}=t;if(r.has("will")&&n.has("be")){let t=FL(e);e.replace(n,t),(e=e.remove("will")).replace("not "+t,t+" not")}else tM(e,t),e=e.remove("will");return e},"present-progressive":ML,"past-progressive":(e,t)=>{let n=FL(e);return e.replace("(were|was)",n,eM)},"future-progressive":e=>(e.match("will").insertBefore("is"),e.remove("be"),e.remove("will")),"present-perfect":(e,t)=>(tM(e,t),e.remove("(have|had|has)")),"past-perfect":(e,t)=>{let n=LL(e).subject;return $L(e)||n.has("i")?((e=BL(e,t)).remove("had"),e):(e.replace("had","has",eM),e)},"future-perfect":e=>(e.match("will").insertBefore("has"),e.remove("have").remove("will")),"present-perfect-progressive":ML,"past-perfect-progressive":e=>e.replace("had","has",eM),"future-perfect-progressive":e=>(e.match("will").insertBefore("has"),e.remove("have").remove("will")),"passive-past":(e,t)=>{let n=FL(e);return e.has("(had|have|has)")&&e.has("been")?(e.replace("(had|have|has)",n,eM),e.replace("been","being"),e):e.replace("(got|was|were)",n)},"passive-present":ML,"passive-future":e=>(e.replace("will","is"),e.replace("be","being")),"present-conditional":ML,"past-conditional":e=>(e.replace("been","be"),e.remove("have")),"auxiliary-future":(e,t)=>(nM(e,t),e.remove("(going|to)"),e),"auxiliary-past":(e,t)=>{if(t.auxiliary.has("did")){let n=VL(e);return e.replace(t.auxiliary,n),e}return nM(e,t),e.replace(t.auxiliary,"is"),e},"auxiliary-present":ML,"modal-infinitive":ML,"modal-past":(e,t)=>(((e,t)=>{const{toInfinitive:n}=e.methods.two.transform.verb,r=t.root;let i=t.root.text("normal");i=n(i,e.model,zL(r)),i&&(e=e.replace(t.root,i,eM))})(e,t),e.remove("have")),"gerund-phrase":(e,t)=>(t.root=t.root.not("#Gerund$"),tM(e,t),e.remove("(will|have)")),"want-infinitive":(e,t)=>{let n="wants";return $L(e)&&(n="want"),e.replace("(want|wanted|wants)",n,eM),e.remove("will"),e}},iM={tags:!0},aM=(e,t)=>{const{toInfinitive:n}=e.methods.two.transform.verb,{root:r,auxiliary:i}=t;if(r.has("#Modal"))return e;let a=r.text("normal");return a=n(a,e.model,zL(r)),a&&(e=e.replace(r,a,iM)).not("#Particle").tag("Verb"),e.prepend("will").match("will").tag("Auxiliary"),e.remove(i),e},sM=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,{root:i,auxiliary:a}=t;let s=i.text("normal");return s=r(s,e.model,zL(i)),s&&(s=n(s,e.model).Gerund,e.replace(i,s,iM),e.not("#Particle").tag("PresentTense")),e.remove(a),e.prepend("will be").match("will be").tag("Auxiliary"),e},oM={infinitive:aM,"simple-present":aM,"simple-past":aM,"simple-future":ML,"present-progressive":sM,"past-progressive":sM,"future-progressive":ML,"present-perfect":e=>(e.match("(have|has)").replaceWith("will have"),e),"past-perfect":e=>e.replace("(had|has)","will have"),"future-perfect":ML,"present-perfect-progressive":e=>e.replace("has","will have"),"past-perfect-progressive":e=>e.replace("had","will have"),"future-perfect-progressive":ML,"passive-past":e=>e.has("got")?e.replace("got","will get"):e.has("(was|were)")?(e.replace("(was|were)","will be"),e.remove("being")):e.has("(have|has|had) been")?e.replace("(have|has|had) been","will be"):e,"passive-present":e=>(e.replace("being","will be"),e.remove("(is|are|am)"),e),"passive-future":ML,"present-conditional":e=>e.replace("would","will"),"past-conditional":e=>e.replace("would","will"),"auxiliary-future":ML,"auxiliary-past":e=>e.has("used")&&e.has("to")?(e.replace("used","will"),e.remove("to")):(e.replace("did","will"),e),"auxiliary-present":e=>e.replace("(do|does)","will"),"modal-infinitive":ML,"modal-past":ML,"gerund-phrase":(e,t)=>(t.root=t.root.not("#Gerund$"),aM(e,t),e.remove("(had|have)")),"want-infinitive":e=>(e.replace("(want|wants|wanted)","will want"),e)},lM={tags:!0},uM={tags:!0},cM=function(e,t){let n=VL(e);return e.prepend(n+" not"),e},hM=function(e){let t=e.match("be");return t.found?(t.prepend("not"),e):(t=e.match("(is|was|am|are|will|were)"),t.found?(t.append("not"),e):e)},dM=e=>e.has("(is|was|am|are|will|were|be)"),pM={"simple-present":(e,t)=>!0===dM(e)?hM(e):(e=BL(e,t),e=cM(e)),"simple-past":(e,t)=>!0===dM(e)?hM(e):((e=BL(e,t)).prepend("did not"),e),imperative:e=>(e.prepend("do not"),e),infinitive:(e,t)=>!0===dM(e)?hM(e):cM(e),"passive-past":e=>{if(e.has("got"))return e.replace("got","get",uM),e.prepend("did not"),e;let t=e.match("(was|were|had|have)");return t.found&&t.append("not"),e},"auxiliary-past":e=>{if(e.has("used"))return e.prepend("did not"),e;let t=e.match("(did|does|do)");return t.found&&t.append("not"),e},"want-infinitive":(e,t)=>(e=cM(e)).replace("wants","want",uM)},fM={api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Verbs"}parse(e){return this.getNth(e).map(_L)}json(e,t){let n=this.getNth(t).map((t=>{let n=t.toView().json(e)[0]||{};return n.verb=function(e){let t=_L(e);e=e.clone().toView();const n=jL(e,t);return{root:t.root.text(),preAdverbs:HL(t.adverbs.pre),postAdverbs:HL(t.adverbs.post),auxiliary:GL(t.auxiliary),negative:t.negative.found,prefix:GL(t.prefix),infinitive:qL(t.root),grammar:n}}(t),n}),[]);return n}subjects(e){return this.getNth(e).map((e=>(_L(e),LL(e).subject)))}adverbs(e){return this.getNth(e).map((e=>e.match("#Adverb")))}isSingular(e){return this.getNth(e).filter((e=>!0!==LL(e).plural))}isPlural(e){return this.getNth(e).filter((e=>!0===LL(e).plural))}isImperative(e){return this.getNth(e).filter((e=>e.has("#Imperative")))}toInfinitive(e){return this.getNth(e).map((e=>{let t=_L(e);return function(e,t){const{toInfinitive:n}=e.methods.two.transform.verb,{root:r,auxiliary:i}=t;let a=i.terms().harden(),s=r.text("normal");if(s=n(s,e.model,zL(r)),s&&e.replace(r,s,KL).tag("Verb").firstTerm().tag("Infinitive"),a.found&&e.remove(a),t.negative.found){e.has("not")||e.prepend("not");let t=VL(e);e.prepend(t)}return e.fullSentence().compute(["freeze","lexicon","preTagger","postTagger","unfreeze","chunks"]),e}(e,t,jL(e,t).form)}))}toPresentTense(e){return this.getNth(e).map((e=>{let t=_L(e),n=jL(e,t);return n.isInfinitive?e:function(e,t,n){return rM.hasOwnProperty(n)?((e=rM[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):e}(e,t,n.form)}))}toPastTense(e){return this.getNth(e).map((e=>{let t=_L(e),n=jL(e,t);return n.isInfinitive?e:function(e,t,n){return ZL.hasOwnProperty(n)?((e=ZL[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):e}(e,t,n.form)}))}toFutureTense(e){return this.getNth(e).map((e=>{let t=_L(e),n=jL(e,t);return n.isInfinitive?e:function(e,t,n){return e.has("will")||e.has("going to")?e:oM.hasOwnProperty(n)?((e=oM[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):e}(e,t,n.form)}))}toGerund(e){return this.getNth(e).map((e=>{let t=_L(e),n=jL(e,t);return n.isInfinitive?e:function(e,t){const{toInfinitive:n,conjugate:r}=e.methods.two.transform.verb,{root:i,auxiliary:a}=t;if(e.has("#Gerund"))return e;let s=i.text("normal");s=n(s,e.model,zL(i));let o=r(s,e.model).Gerund;if(o){let t=FL(e);e.replace(i,o,lM),e.remove(a),e.prepend(t)}return e.replace("not is","is not"),e.replace("not are","are not"),e.fullSentence().compute(["tagger","chunks"]),e}(e,t,n.form)}))}toPastParticiple(e){return this.getNth(e).map((e=>{let t=_L(e),n=jL(e,t);return n.isInfinitive?e:function(e,t,n){return YL.hasOwnProperty(n)?((e=YL[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):((e=XL(e,t)).fullSentence().compute(["tagger","chunks"]),e)}(e,t,n.form)}))}conjugate(e){const{conjugate:t,toInfinitive:n}=this.world.methods.two.transform.verb;return this.getNth(e).map((e=>{let r=_L(e),i=jL(e,r);"imperative"===i.form&&(i.form="simple-present");let a=r.root.text("normal");if(!r.root.has("#Infinitive")){let t=zL(r.root);a=n(a,e.model,t)||a}return t(a,e.model)}),[])}isNegative(){return this.if("#Negative")}isPositive(){return this.ifNo("#Negative")}toPositive(){let e=this.match("do not #Verb");return e.found&&e.remove("do not"),this.remove("#Negative")}toNegative(e){return this.getNth(e).map((e=>{let t=_L(e);return function(e,t,n){if(e.has("#Negative"))return e;if(pM.hasOwnProperty(n))return pM[n](e,t);let r=e.matchOne("be");return r.found?(r.prepend("not"),e):!0===dM(e)?hM(e):(r=e.matchOne("(will|had|have|has|did|does|do|#Modal)"),r.found?(r.append("not"),e):e)}(e,t,jL(e,t).form)}))}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}t.prototype.toPast=t.prototype.toPastTense,t.prototype.toPresent=t.prototype.toPresentTense,t.prototype.toFuture=t.prototype.toFutureTense,e.prototype.verbs=function(e){let n=function(e){let t=e.match("<Verb>");return t=t.not("#Conjunction"),t=t.not("#Preposition"),t=t.splitAfter("@hasComma"),t=t.splitAfter("[(do|did|am|was|is|will)] (is|was)",0),t=t.splitBefore("(#Verb && !#Copula) [being] #Verb",0),t=t.splitBefore("#Verb [to be] #Verb",0),t=t.splitAfter("[help] #PresentTense",0),t=t.splitBefore("(#PresentTense|#PastTense) [#Copula]$",0),t=t.splitBefore("(#PresentTense|#PastTense) [will be]$",0),t=t.splitBefore("(#PresentTense|#PastTense) [(had|has)]",0),t=t.not("#Reflexive$"),t=t.not("#Adjective"),t=t.splitAfter("[#PastTense] #PastTense",0),t=t.splitAfter("[#PastTense] #Auxiliary+ #PastTense",0),t=t.splitAfter("#Copula [#Gerund] #PastTense",0),t=t.if("#Verb"),t.has("(#Verb && !#Auxiliary) #Adverb+? #Copula")&&(t=t.splitBefore("#Copula")),t}(this);return n=n.getNth(e),new t(this.document,n.pointer)}}},mM=function(e,t){let n=t.match(e);if(n.found){let e=n.pronouns().refersTo();if(e.found)return e}return t.none()},gM=function(e){if(!e.found)return e;let[t]=e.fullPointer[0];return t&&t>0?e.update([[t-1]]):e.none()},yM=function(e,t){let n=e.people();return n=function(e,t){return"m"===t?e.filter((e=>!e.presumedFemale().found)):"f"===t?e.filter((e=>!e.presumedMale().found)):e}(n,t),n.found?n.last():(n=e.nouns("#Actor"),n.found?n.last():"f"===t?mM("(she|her|hers)",e):"m"===t?mM("(he|him|his)",e):e.none())},vM=function(e){let t=e.nouns(),n=t.isPlural().notIf("#Pronoun");if(n.found)return n.last();let r=mM("(they|their|theirs)",e);return r.found?r:(n=t.match("(somebody|nobody|everybody|anybody|someone|noone|everyone|anyone)"),n.found?n.last():e.none())},bM=function(e,t){let n=e.before(),r=t(n);return r.found?r:(n=gM(e),r=t(n),r.found?r:(n=gM(n),r=t(n),r.found?r:e.none()))},wM={compute:{coreference:function(e){e.pronouns().if("(he|him|his|she|her|hers|they|their|theirs|it|its)").forEach((e=>{let t=null;e.has("(he|him|his)")?t=bM(e,(e=>yM(e,"m"))):e.has("(she|her|hers)")?t=bM(e,(e=>yM(e,"f"))):e.has("(they|their|theirs)")&&(t=bM(e,vM)),t&&t.found&&function(e,t){t&&t.found&&(e.docs[0][0].reference=t.ptrs[0])}(e,t)}))}},api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Pronouns"}hasReference(){return this.compute("coreference"),this.filter((e=>e.docs[0][0].reference))}refersTo(){return this.compute("coreference"),this.map((e=>{if(!e.found)return e.none();let t=e.docs[0][0];return t.reference?e.update([t.reference]):e.none()}))}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.pronouns=function(e){let n=this.match("#Pronoun");return n=n.getNth(e),new t(n.document,n.pointer)}}};zD.plugin(UD),zD.plugin({api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Adverbs"}conjugate(e){return this.getNth(e).map((e=>{let t=function(e){return e.compute("root").text("root")}(e);return{Adverb:e.text("normal"),Adjective:t}}),[])}json(e={}){const t=this.methods.two.transform.adjective.fromAdverb;return e.normal=!0,this.map((n=>{let r=n.toView().json(e)[0]||{};return r.adverb={adjective:t(r.normal)},r}),[])}}e.prototype.adverbs=function(e){let n=this.match("#Adverb");return n=n.getNth(e),new t(n.document,n.pointer)}}}),zD.plugin(ZD),zD.plugin(wM),zD.plugin(cR),zD.plugin(yR),zD.plugin(xR),zD.plugin(nL),zD.plugin(sL),zD.plugin(uL),zD.plugin(gL),zD.plugin(fM);const _M=zD;function kM(e){return _M(e).json()}function AM(e){return _M(e).fullSentences().out("array")}var PM=i(75),TM=i.n(PM);async function IM(e){const t=(new TextEncoder).encode(e);return EM(await crypto.subtle.digest("SHA-256",t))}function EM(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")}async function xM(e){return await IM(TM()(e))}async function CM(e){const t=(await IM(e)).slice(0,32);return[t.slice(0,8),t.slice(8,12),t.slice(12,16),t.slice(16,20),t.slice(20,32)].join("-")}const OM={top:"gpt-4o",top_think:"o4-mini",quick:"gpt-4.1-nano"};async function SM(e,t){let n=OM[t]||"gpt-4o",r=xP();return(await r.responses.create({model:n,input:e})).output_text}async function NM(e){let t=xP();return(await t.embeddings.create({model:"text-embedding-3-small",input:e,dimensions:1024,encoding_format:"float"})).data[0].embedding}async function jM(e,t,n){let r=xP(),i=OM[n]||"gpt-4o";return(await r.responses.parse({model:i,input:[{role:"system",content:"Provide the requested output."},{role:"user",content:e}],text:{format:t}})).output_parsed}class DM{constructor(e={}){this.config=Object.assign({enableStats:!0,verbose:!1,logPrefix:"cache"},e),this.logger=ft({id:e.logPrefix||"cache"}),this.stats={hits:0,misses:0,sets:0,deletes:0,hitRate:0},this.log("Cache instance created",{config:this.config})}buildKey(e){const t=[this.config.keyPrefix||"",this.config.namespace||"",e].filter(Boolean).join(":");return this.log("Built cache key",{originalKey:e,fullKey:t}),t}createCacheEntry(e,t){const n=Date.now(),r=(null==t?void 0:t.ttl)||this.config.defaultTtl,i={value:e,createdAt:n,expiresAt:r?n+r:void 0,metadata:null==t?void 0:t.metadata};return this.log("Created cache entry",{ttl:r,expiresAt:i.expiresAt,hasMetadata:!!(null==t?void 0:t.metadata)}),i}isExpired(e){const t=!!e.expiresAt&&Date.now()>e.expiresAt;return t&&this.log("Cache entry expired",{expiresAt:e.expiresAt,now:Date.now()}),t}updateStats(e,t){if(this.config.enableStats){if("hit"===e){this.stats.hits++,this.stats.hitRate=this.stats.hits/(this.stats.hits+this.stats.misses)||0;let e=mt("green","Cache hit");this.log(`${e}: key=${(null==t?void 0:t.key)||"unknown"} hitRate=${(100*this.stats.hitRate).toFixed(2)}%`)}else if("miss"===e){this.stats.misses++,this.stats.hitRate=this.stats.hits/(this.stats.hits+this.stats.misses)||0;let e=mt("red","Cache miss");this.log(`${e}: key=${(null==t?void 0:t.key)||"unknown"} reason=${(null==t?void 0:t.reason)||"unknown"} hitRate=${(100*this.stats.hitRate).toFixed(2)}%`)}else"set"===e?this.stats.sets++:"delete"===e&&this.stats.deletes++;this.log("Stats updated",{operation:e,stats:this.stats})}}log(e,t){if(this.config.onlyLogHitsMisses){if(!e.includes("Cache hit")&&!e.includes("Cache miss"))return}else if(!this.config.verbose)return;(new Date).toISOString(),this.config.logPrefix,t?(this.logger(e),this.logger(t)):this.logger(e)}getStats(){return Object.assign({},this.stats)}resetStats(){this.stats={hits:0,misses:0,sets:0,deletes:0,hitRate:0},this.log("Stats reset")}}class RM{static register(e,t){this.implementations.set(e,t)}static create(e,t){const n=this.implementations.get(e);if(!n)throw new Error(`Cache implementation '${e}' not found. Available: ${Array.from(this.implementations.keys()).join(", ")}`);return new n(t)}static getAvailableTypes(){return Array.from(this.implementations.keys())}}RM.implementations=new Map;class LM{static async generateKey(e){return await xM(e)}static generateKeySync(e){try{const t=JSON.stringify(e);let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return Math.abs(n).toString(36)}catch(e){return Math.random().toString(36).substring(2)}}static isAsyncFunction(e){return"AsyncFunction"===e.constructor.name||e.toString().includes("async ")||e.toString().includes("return new Promise")||e.toString().includes("await ")}static async batchGet(e,t){const n=new Map,r=t.map((async t=>{const r=await e.get(t);n.set(t,r)}));return await Promise.all(r),n}static async batchSet(e,t){const n=t.map((({key:t,value:n,options:r})=>e.set(t,n,r)));await Promise.all(n)}static memoize(e,t,n={}){const{ttl:r,keyGenerator:i,includeThis:a=!1,errorOnCacheFailure:s=!1}=n,o=async function(...n){var o;try{const o=e.name||"anonymous",l=a&&this?[this,...n]:n,u=`${o}:${i?i(l):await LM.generateKey(l)}`,c=await t.get(u);if(null!==c)return c;const h=await e.apply(this,n);try{await t.set(u,h,{ttl:r})}catch(e){if(s)throw new Error(`Cache storage failed: ${e}`)}return h}catch(t){if((null===(o=t.message)||void 0===o?void 0:o.includes("Cache"))&&!s)return await e.apply(this,n);throw t}};return Object.defineProperty(o,"name",{value:`memoized_${e.name}`}),Object.defineProperty(o,"length",{value:e.length}),o}static memoize2(e,t,n={}){const{ttl:r,keyGenerator:i,includeThis:a=!1,errorOnCacheFailure:s=!1}=n;return LM.isAsyncFunction(e)?async function(...n){var o;try{const o=e.name||"anonymous",l=a&&this?[this,...n]:n,u=`${o}:${i?i(l):await LM.generateKey(l)}`,c=await t.get(u);if(null!==c)return c;const h=e.apply(this,n),d=h instanceof Promise?await h:h;try{await t.set(u,d,{ttl:r})}catch(e){if(s)throw new Error(`Cache storage failed: ${e}`)}return d}catch(t){if((null===(o=t.message)||void 0===o?void 0:o.includes("Cache"))&&!s){const t=e.apply(this,n);return t instanceof Promise?await t:t}throw t}}:function(...t){e.name;const n=a&&this?[this,...t]:t;return LM.generateKeySync(n),e.apply(this,t)}}static createMemoizer(e,t={}){return(n,r={})=>{const i=Object.assign(Object.assign({},t),r);return LM.memoize(n,e,i)}}}class MM extends DM{constructor(e){super(Object.assign({logPrefix:"memoryCache"},e)),this.storage=new Map}async get(e){const t=this.buildKey(e),n=this.storage.get(t);return this.log("Get operation",{key:e,fullKey:t,found:!!n}),n?this.isExpired(n)?(this.log("Entry expired, removing",{key:e,fullKey:t}),this.storage.delete(t),this.updateStats("miss",{key:e,fullKey:t,reason:"expired"}),null):(this.updateStats("hit",{key:e,fullKey:t}),n.value):(this.updateStats("miss",{key:e,fullKey:t,reason:"not_found"}),null)}async set(e,t,n){const r=this.buildKey(e),i=this.createCacheEntry(t,n);this.log("Set operation",{key:e,fullKey:r,ttl:null==n?void 0:n.ttl,hasMetadata:!!(null==n?void 0:n.metadata)}),this.storage.set(r,i),this.updateStats("set")}async has(e){const t=this.buildKey(e),n=this.storage.get(t);return this.log("Has operation",{key:e,fullKey:t,found:!!n}),!(!n||this.isExpired(n)&&(this.log("Entry expired, removing",{key:e,fullKey:t}),this.storage.delete(t),1))}async delete(e){const t=this.buildKey(e),n=this.storage.delete(t);return this.log("Delete operation",{key:e,fullKey:t,deleted:n}),n&&this.updateStats("delete"),n}async clear(){const e=this.storage.size;this.storage.clear(),this.log("Clear operation",{previousSize:e})}async keys(){const e=[],t=[this.config.keyPrefix||"",this.config.namespace||""].filter(Boolean).join(":").length,n=t>0?1:0;for(const[r,i]of this.storage.entries())if(this.isExpired(i))this.storage.delete(r);else{const i=r.substring(t+n);e.push(i)}return this.log("Keys operation",{count:e.length}),e}async size(){let e=0;for(const[t,n]of this.storage.entries())this.isExpired(n)?this.storage.delete(t):e++;return this.log("Size operation",{size:e}),e}}RM.register("memory",MM);class $M{static async runAllTests(){console.log("🧪 Starting Memoization Tests...\n"),await this.testBasicMemoization(),await this.testTTLExpiration(),await this.testCustomKeyGeneration(),await this.testNamespaceIsolation(),await this.testErrorHandling(),await this.testMemoizerFactory(),await this.testThisContext(),await this.testFunctionPreservation(),console.log("🎉 All memoization tests completed successfully!")}static async testBasicMemoization(){console.log("📝 Test 1: Basic Memoization");const e=new MM;let t=0;const n=LM.memoize((async e=>(t++,await new Promise((e=>setTimeout(e,10))),2*e)),e),r=await n(5);console.log(`✅ First call result: ${r}, Call count: ${t}`);const i=await n(5);console.log(`✅ Second call result: ${i}, Call count: ${t}`);const a=await n(10);console.log(`✅ Third call result: ${a}, Call count: ${t}`),console.log(`✅ Expected: 10, 10, 20 | Got: ${r}, ${i}, ${a}`),console.log(`✅ Expected call count: 2 | Got: ${t}\n`)}static async testTTLExpiration(){console.log("⏰ Test 2: TTL Expiration");const e=new MM;let t=0;const n=LM.memoize((async e=>(t++,3*e)),e,{ttl:100}),r=await n(7);console.log(`✅ Before expiration: ${r}, Call count: ${t}`),await new Promise((e=>setTimeout(e,150)));const i=await n(7);console.log(`✅ After expiration: ${i}, Call count: ${t}`),console.log(`✅ Expected call count: 2 | Got: ${t}\n`)}static async testCustomKeyGeneration(){console.log("🔑 Test 3: Custom Key Generation");const e=new MM;let t=0;const n=LM.memoize((async e=>(t++,`${e.name}-${e.id}`)),e,{keyGenerator:e=>`obj:${e[0].id}`}),r=await n({id:1,name:"Alice"}),i=await n({id:1,name:"Bob"});console.log(`✅ First call: ${r}, Call count: ${t}`),console.log(`✅ Second call: ${i}, Call count: ${t}`),console.log(`✅ Expected call count: 1 | Got: ${t}\n`)}static async testNamespaceIsolation(){console.log("🏠 Test 4: Namespace Isolation");const e=new MM;let t=0,n=0;const r=LM.memoize((async e=>(t++,e+1)),e,{namespace:"ns1"}),i=LM.memoize((async e=>(n++,e+2)),e,{namespace:"ns2"}),a=await r(5),s=await i(5);console.log(`✅ Namespace 1 result: ${a}, Call count: ${t}`),console.log(`✅ Namespace 2 result: ${s}, Call count: ${n}`),console.log(`✅ Expected: 6, 7 | Got: ${a}, ${s}\n`)}static async testErrorHandling(){console.log("❌ Test 5: Error Handling");const e=new MM;let t=0;const n=LM.memoize((async e=>{if(t++,e)throw new Error("Function failed");return"success"}),e);try{await n(!0)}catch(e){console.log(`✅ Expected error caught: ${e.message}`)}const r=await n(!1);console.log(`✅ Success result: ${r}, Call count: ${t}\n`)}static async testMemoizerFactory(){console.log("🏭 Test 6: Memoizer Factory");const e=new MM,t=LM.createMemoizer(e,{namespace:"factory",ttl:1e3});let n=0;const r=t((async e=>(n++,4*e))),i=await r(3),a=await r(3);console.log(`✅ Factory memoized result: ${i}, ${a}`),console.log(`✅ Expected call count: 1 | Got: ${n}\n`)}static async testThisContext(){console.log("🎯 Test 7: This Context");const e=new MM;class t{constructor(e){this.callCount=0,this.multiplier=e}async calculate(e){return this.callCount++,e*this.multiplier}}const n=new t(5),r=(new t(10),LM.memoize(n.calculate.bind(n),e,{includeThis:!0})),i=await r(3),a=await r(3);console.log(`✅ This context result: ${i}, ${a}`),console.log(`✅ Expected call count: 1 | Got: ${n.callCount}\n`)}static async testFunctionPreservation(){console.log("🔧 Test 8: Function Property Preservation");const e=new MM;async function t(e,t,n){return e+t+n}const n=LM.memoize(t,e);console.log(`✅ Original name: ${t.name}, length: ${t.length}`),console.log(`✅ Memoized name: ${n.name}, length: ${n.length}`),console.log(`✅ Name includes 'memoized': ${n.name.includes("memoized")}\n`)}}function FM(e,t,n){return Uint8Array.from([144+e,t,n])}function VM(e,t,n){return Uint8Array.from([128+e,t,n])}function zM(e,t,n){return Uint8Array.from([176+e,t,n])}function BM(e){return e.toISOString()}function UM(){return BM(new Date)}function HM(e){return BM(e).split("T")[0].replace(/-/g,"_")}function GM(){return HM(new Date)}function qM(e){return Number(e)}function KM(){return qM(new Date)}function WM(e,t){return e.getTime()==t.getTime()}function JM(e){return new Date(e.getTime())}function ZM(e){return e.toString().split(" ").slice(0,4).join(" ").replace(" ","_")}function QM(e,t){let n=JM(e);switch(t){case"year":n.setMonth(0);case"month":n.setDate(1);case"day":n.setHours(0);case"hour":n.setMinutes(0);case"minute":n.setSeconds(0);case"second":n.setMilliseconds(0);case"millisecond":break;default:return n}return n}function XM(e,t,n){let r=JM(e);switch(n){case"year":r.setFullYear(r.getFullYear()+t);break;case"month":r.setMonth(r.getMonth()+t);break;case"day":r.setDate(r.getDate()+t);break;case"hour":r.setHours(r.getHours()+t);break;case"minute":r.setMinutes(r.getMinutes()+t);break;case"second":r.setSeconds(r.getSeconds()+t);break;case"millisecond":r.setMilliseconds(r.getMilliseconds()+t);break;default:return r}return r}var YM={"1sec":1e3,"5sec":5e3,"10sec":1e4,"30sec":3e4,"1min":6e4,"2min":12e4,"5min":3e5,"10min":6e5,"30min":18e5,"1hr":36e5,"1day":864e5},e$=class e{static initParams(e,t){return[e.replace(/\s+/g,"").toLowerCase(),t.replace(/\s+/g,"").toLowerCase()]}static checkThanosType(e){if("string"!=typeof e)throw new Error("first argument should be a string")}static checkRivalType(e){if("string"!=typeof e)throw new Error("second argument should be a string")}static checkAvengersType(e){if(!Array.isArray(e))throw new Error("second argument should be an array of strings");if(e.find((e=>"string"!=typeof e)))throw new Error("second argument should be an array of strings")}sortMatch(t,n){return e.checkThanosType(t),e.checkAvengersType(n),n.map(((e,n)=>({member:e,index:n,rating:this.similarity(t,e)}))).sort(((e,t)=>e.rating-t.rating))}},t$=new class extends e${similarity(e,t){e$.checkThanosType(e),e$.checkRivalType(t);let[n,r]=e$.initParams(e,t);if(!n.length&&!r.length)return 1;if(!n.length||!r.length)return 0;if(n===r)return 1;let i=Array.from(new Set(n.split("").concat(r.split("")))),a=this.stringVectorization(n.split(""),i),s=this.stringVectorization(r.split(""),i),[o,l,u]=[0,0,0];for(let e=0;e<a.length;++e)o+=a[e]*s[e],l+=a[e]*a[e],u+=s[e]*s[e];return l=Math.sqrt(l),u=Math.sqrt(u),Number(o)/(l*u)}distance(e,t){return 1-this.similarity(e,t)}stringVectorization(e,t){return t.map((t=>e.includes(t)?1:0))}},n$=new class extends e${similarity(e,t){e$.checkThanosType(e),e$.checkRivalType(t);let[n,r]=e$.initParams(e,t),[i,a]=[n.length,r.length];if(!n.length&&!r.length||n===r)return 1;if(i<2||a<2)return 0;let s=new Map;for(let e=0;e<i-1;e++){let t=n.slice(e,e+2),r=s.has(t)?s.get(t)+1:1;s.set(t,r)}let o=0;for(let e=0;e<a-1;e++){let t=r.slice(e,e+2),n=s.has(t)?s.get(t):0;n>0&&(s.set(t,n-1),++o)}return 2*o/(i+a-2)}distance(e,t){return 1-this.similarity(e,t)}},r$=new class extends e${similarity(e,t){e$.checkThanosType(e),e$.checkRivalType(t);let[n,r]=e$.initParams(e,t);if(!n.length&&!r.length||n===r)return 1;let i=new Set(n.split("").concat(r.split(""))),a=new Set(n.split("").filter((e=>new Set(r).has(e))));return Number(a.size)/i.size}distance(e,t){return 1-this.similarity(e,t)}},i$=new class extends e${similarity(e,t){e$.checkThanosType(e),e$.checkRivalType(t);let[n,r]=e$.initParams(e,t);return n.length||r.length?1-Number(this.distance(n,r))/Math.max(n.length,r.length):1}distance(e,t){e$.checkThanosType(e),e$.checkRivalType(t);let[n,r]=e$.initParams(e,t);if(n===r)return 0;let[i,a]=[n.length,r.length];if(!i)return a;if(!a)return i;let s,o=[...Array(i+1)].map((()=>Array(a+1).fill(0)));for(let e=0;e<=i;++e)o[e][0]=e;for(let e=0;e<=a;++e)o[0][e]=e;for(let e=1;e<=i;++e)for(let t=1;t<=a;++t)s=n[e-1]===r[t-1]?0:1,o[e][t]=Math.min(o[e-1][t]+1,o[e][t-1]+1,o[e-1][t-1]+s);return o[i][a]}},a$=new class e extends e${static lcsLength(e,t){e$.checkThanosType(e),e$.checkRivalType(t);let[n,r]=e$.initParams(e,t),[i,a]=[n.length,r.length],s=[...Array(i+1)].map((()=>Array(a+1).fill(0)));for(let e=1;e<=i;++e)for(let t=1;t<=a;++t)s[e][t]=n[e-1]===r[t-1]?s[e-1][t-1]+1:Math.max(s[e][t-1],s[e-1][t]);return s[i][a]}similarity(t,n){e$.checkThanosType(t),e$.checkRivalType(n);let[r,i]=e$.initParams(t,n);return!r.length&&!i.length||r===i?1:2*e.lcsLength(r,i)/(r.length+i.length)}distance(t,n){let[r,i]=e$.initParams(t,n);return r.length+i.length-2*e.lcsLength(r,i)}},s$=a$,o$=new class e extends e${static lcsLength(e,t){e$.checkThanosType(e),e$.checkRivalType(t);let[n,r]=[e.length,t.length],i=[...Array(n+1)].map((()=>Array(r+1).fill(0)));for(let a=1;a<=n;++a)for(let n=1;n<=r;++n)i[a][n]=e[a-1]===t[n-1]?i[a-1][n-1]+1:Math.max(i[a][n-1],i[a-1][n]);return i[n][r]}similarity(t,n){e$.checkThanosType(t),e$.checkRivalType(n);let[r,i]=e$.initParams(t,n);return!r.length&&!i.length||r===i?1:Number(e.lcsLength(r,i))/Math.max(r.length,i.length)}distance(e,t){e$.checkThanosType(e),e$.checkRivalType(t);let[n,r]=e$.initParams(e,t);return n===r?0:1-this.similarity(n,r)}},l$=o$,u$=new class extends e${distance(e,t){e$.checkThanosType(e),e$.checkRivalType(t);let[n,r]=e$.initParams(e,t);if(!n.length&&!r.length)return 1;if(!n.length||!r.length)return 0;if(n===r||n===r)return 1;let i=n.length,a=r.length;if(0===i||0===a)return 0;let s=Math.floor(Math.max(i,a)/2)-1,o=0,l=new Array(n.length).fill(0),u=new Array(r.length).fill(0);for(let e=0;e<i;e++)for(let t=Math.max(0,e-s);t<Math.min(a,e+s+1);t++)if(n[e]===r[t]&&0===u[t]){l[e]=1,u[t]=1,o++;break}if(0===o)return 0;let c=0,h=0;for(let e=0;e<i;e++)if(1===l[e]){for(;0===u[h];)h++;n[e]!==r[h++]&&c++}return c/=2,(o/i+o/a+(o-c)/o)/3}similarity(e,t){let n=this.distance(e,t);if(n>.7){let r=0;for(let n=0;n<Math.min(e.length,t.length)&&e[n]===t[n];n++)r++;r=Math.min(4,r),n+=.1*r*(1-n)}return n}},c$={cosine:t$,diceCoefficient:n$,jaccardIndex:r$,levenshtein:i$,lcs:a$,longestCommonSubsequence:s$,mlcs:o$,metricLcs:l$,jaroWinkler:u$};const h$=ft({id:"tes"}),d$="localhost",p$=8001;async function f$(e){const t=`http://${d$}:${p$}/call`;Ad("local_tes_call.request",e),h$(`POST ${t}`);const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const e=await n.text();throw h$(`Error response: ${n.status} ${n.statusText} - ${e}`),new Error(`TES call failed: ${n.status} ${n.statusText}`)}const r=await n.json();return Ad("local_tes_call.response",r),h$("Received result"),r}async function m$(e){const t="/api/tes";Ad("cloud_tes_call.request",e),h$(`POST ${t}`);const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const e=await n.text();throw h$(`Error response: ${n.status} ${n.statusText} - ${e}`),new Error(`TES call failed: ${n.status} ${n.statusText}`)}const r=await n.json();return Ad("cloud_tes_call.response",r),h$("Received result"),r}const g$=function e(t=[]){const n=()=>{};return new Proxy(n,{get(r,i){if("then"!==i||0!==t.length)return"symbol"==typeof i?Reflect.get(n,i):e(t.concat(i.toString()))},apply:(e,n,r)=>f$({fn_path:t,fn_args:r})})}(),y$=function e(t=[]){const n=()=>{};return new Proxy(n,{get(r,i){if("then"!==i||0!==t.length)return"symbol"==typeof i?Reflect.get(n,i):e(t.concat(i.toString()))},apply:(e,n,r)=>m$({fn_path:t,fn_args:r})})}(),v$=ft({id:"common"});async function b$(e,t){let n=`${e}?${new URLSearchParams(t)}`;return v$(`Querying with url= ${n}`),(await fetch(n,{method:"GET",cache:"no-cache",headers:{"Content-Type":"application/json"},redirect:"follow"})).json()}})();var s=t;for(var o in a)s[o]=a[o];a.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})}},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return r[e](n,n.exports,a),n.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};(()=>{a.r(s),a.d(s,{apis:()=>x,common:()=>N,components:()=>C,cryptocurrency:()=>g,umd:()=>S,util:()=>p});var e={};a.r(e),a.d(e,{_speak:()=>X,cancel_speech:()=>F,chunk_strategy:()=>Y,default_rate:()=>W,finished_speaking:()=>z,finished_utterance:()=>V,get_voice:()=>H,get_voice_by_name:()=>G,get_voices:()=>U,is_speaking:()=>B,pause_speech:()=>Z,resume_speech:()=>Q,set_chunk_strategy:()=>ee,set_default_rate:()=>J,speak:()=>te,speech_que:()=>$,tts:()=>M,voices_ready:()=>q,wait_until_voices_ready:()=>K});var t={};a.r(t),a.d(t,{get_recognition_object:()=>se});var r={};a.r(r),a.d(r,{audio_context:()=>ce,error:()=>_e,input_ready:()=>ke,m2f:()=>oe,note_obj_to_midi:()=>pe,note_to_freq:()=>ge,note_to_midi:()=>me,note_to_note_obj:()=>fe,play_note:()=>ye,play_notes:()=>ve,play_notes_delay:()=>be,proceed:()=>Ae,success:()=>we,tone:()=>de});var i={};a.r(i),a.d(i,{audio_primitives:()=>Te,connect:()=>Ee,disconnect:()=>xe});var o={};a.r(o),a.d(o,{_recorder:()=>Se,get_current_data:()=>Me,get_recorder_object:()=>Ne,get_recorder_state:()=>$e,is_supported:()=>Oe,pause_recording:()=>Re,resume_recording:()=>Le,start_recording:()=>je,stop_recording:()=>De});var l={};a.r(l),a.d(l,{audio_detector:()=>Ge,detection_threshold:()=>Ue,listeners:()=>Be,media_recorder:()=>o,mic:()=>i,set_detection_threshold:()=>He,start_power:()=>ze,stop:()=>qe});var u={};a.r(u),a.d(u,{dot_join:()=>Qe,full_name:()=>Xe,get:()=>et,get_header:()=>nt,get_keys:()=>tt,get_t:()=>it,set_storage_header:()=>Ze,store:()=>Ye,store_t:()=>rt});var c={};a.r(c),a.d(c,{RecognitionState:()=>at,ap:()=>l,initialize_recognition:()=>ht,listen_while_speaking:()=>lt,pause_recognition:()=>dt,recognition:()=>ot,recognition_state:()=>ut,set_default_tts_rate:()=>vt,set_default_voice_from_name_preference_list:()=>bt,set_default_voice_uri:()=>yt,set_listen_while_speaking:()=>ct,speak:()=>_t,speak_with_rate:()=>kt,speak_with_voice:()=>wt,sr:()=>t,start_recognition:()=>ft,start_recognition_and_detection:()=>gt,stop_recognition:()=>pt,stop_recognition_and_detection:()=>mt,tts:()=>e});var h={};a.r(h),a.d(h,{WebSocketMaker:()=>Pt});var d={};a.r(d),a.d(d,{set_value_by_id:()=>Tt});var p={};a.r(p),a.d(p,{add_css:()=>Dt,add_script:()=>Nt,alert:()=>Et,audio_processing:()=>l,define:()=>St,dom:()=>d,inject_script:()=>jt,is_chrome:()=>xt,is_mobile:()=>Ct,sounds:()=>r,speech_recognition:()=>t,tts:()=>e,uuid:()=>Ot,voice_interface:()=>c,ws:()=>h});var f={};a.r(f),a.d(f,{basic_spot_kine_socket:()=>Mt,basic_spot_trade_socket:()=>Ft,spot_kline_socket:()=>Lt,spot_trade_socket:()=>$t});var m={};a.r(m),a.d(m,{buy_beep:()=>Bt,sell_beep:()=>Ut,set_sound_options:()=>zt,sound_options:()=>Vt,trade_beeper:()=>Ht});var g={};a.r(g),a.d(g,{binance_listener:()=>m,binance_ws:()=>f});var y={};a.r(y),a.d(y,{load_key_handlers:()=>qt});var v={};a.r(v),a.d(v,{keys:()=>Yt,keys_to_notes_1:()=>en,load_sound_key_handler:()=>nn,sound_key_handler:()=>tn});var b={};a.r(b),a.d(b,{get_openai:()=>un,get_openai_tts_response:()=>dn,openai_davinci_prompt:()=>fn,proxied_chat_completion:()=>mn,sendAudioBlobToOpenAI:()=>gn,speak:()=>cn,text_to_audio:()=>hn,tts_response:()=>pn});var w={};a.r(w),a.d(w,{encode_json_to_uint8:()=>vn,get_datagram_writer:()=>bn,get_json_writer:()=>_n,init:()=>yn,write_json_datagram:()=>wn});var _={};a.r(_),a.d(_,{FacebookAuthProvider:()=>Qa,GithubAuthProvider:()=>Ya,GoogleAuthProvider:()=>Xa,addDoc:()=>Zf,collection:()=>df,doc:()=>pf,getDoc:()=>Kf,getFirestore:()=>gf,get_auth:()=>em,get_firestore_db:()=>tm,initialize_app:()=>Yf,initialize_firebase_auth_firestore:()=>nm,log_out:()=>rm,setDoc:()=>Jf,signInWithRedirect:()=>zs});var k={};a.r(k),a.d(k,{get_midi_writer:()=>im});var A={};a.r(A),a.d(A,{webtransport:()=>k});var P={};a.r(P),a.d(P,{log_motion:()=>cm,log_orientation:()=>hm,motion_handler:()=>gm,motion_subscribers:()=>lm,orientation_handler:()=>ym,orientation_subscribers:()=>um,start_device_motion:()=>vm,start_device_orientation:()=>bm,stop_device_motion:()=>wm,stop_device_orientation:()=>_m,subscribe_to_motion:()=>dm,subscribe_to_orientation:()=>pm,unsubscribe_motion_id:()=>fm,unsubscribe_orientation_id:()=>mm});var T={};a.r(T),a.d(T,{CACHE_CHECK_INTERVAL:()=>Cm,GET_DB:()=>Dm,LOCAL_DB_HANDLE_CACHE:()=>xm,START_CACHE_CHECK:()=>$m,STOP_CACHE_CHECK:()=>Fm,cache_check_interval_id:()=>Lm,default_db_header:()=>Sm,default_store_name:()=>Om,deleteDB:()=>Vm,do_cache_check:()=>Mm,exportDBString:()=>zm,importFromJson:()=>Bm,log:()=>Im,set_cache_check_interval:()=>Rm});var I={};a.r(I),a.d(I,{load_bokeh_scripts:()=>Gm,point_plt:()=>qm});var E={};a.r(E),a.d(E,{SoundEventDetector:()=>dg,a1:()=>pg,a2:()=>fg,analyser:()=>Zm,ctx:()=>Wm,data_array:()=>ug,decode_audio_array_buffer:()=>ig,decode_audio_blob:()=>ag,get_audio_context:()=>Ym,get_audio_stream:()=>ng,get_sampling_rate:()=>rg,get_sound_event_detector:()=>gg,initialize_microphone:()=>hg,mic_callbacks:()=>sg,mic_initialized:()=>cg,plot_data:()=>yg,register_mic_callback:()=>og,remove_mic_callbacks:()=>tg,run_mic_callbacks:()=>lg,shutdown:()=>eg,sound_event_detector:()=>Qm,stream:()=>Jm,test_diff:()=>mg});var x={};a.r(x),a.d(x,{bind_sounds_to_keys:()=>v,bokeh:()=>I,db:()=>T,firebase:()=>_,key_presses:()=>y,local_storage:()=>u,midi:()=>A,openai:()=>b,sensor:()=>P,web_audio:()=>E,webtransport:()=>w});var C={};a.r(C);var O={};a.r(O),a.d(O,{adjust_tts_rate:()=>Ng,click_input:()=>wg,configure_tts:()=>jg,default_monitoring_interval:()=>Dg,enter_input:()=>_g,finish_stream_handler:()=>xg,initialize_voice_system:()=>Rg,initialize_voice_system_with_tts:()=>Lg,input_area:()=>vg,monitor_responses:()=>Cg,new_text_handler:()=>Tg,set_input:()=>bg,speak:()=>Eg,speech_text_handler:()=>Ig,start_speech_recognition_and_link_to_input:()=>kg,stop_monitoring:()=>Sg,voice_preference_order:()=>Og});var S={};a.r(S),a.d(S,{chatgpt:()=>O});var N=a(78);let{asnc:j,fp:D,logger:R}=N,L=R.get_logger({id:"tts"});var M=function(){return window.speechSynthesis},$=[];function F(){L("Canceling speech, and queue"),$=[],M().cancel(),L("Done")}async function V(){await j.wait_until((()=>!M().speaking),1/0,200)}async function z(){await j.wait_until((()=>!M().speaking&&$.length<1),1/0,200)}function B(){return M().speaking||$.length>0}function U(){return M().getVoices()}function H(e){let t=M().getVoices().filter((t=>t.voiceURI==e));return t.length>0?t[0]:null}function G(e){let t=M().getVoices().filter((t=>t.name==e));return t.length>0?t[0]:null}function q(){try{return M().getVoices().length>0}catch(e){return!1}}async function K(){await N.asnc.wait_until(q,3e3,200),L("voices_ready")}var W=1;function J(e){W=e,L("Default rate set to: "+e)}async function Z(){L("pausing speech utterance");let e=M();e.speaking?(e.pause(),L("Speech paused.")):L("No speech is currently in progress to pause.")}async function Q(){L("resuming utterance");let e=M();e.paused?(e.resume(),L("Speech resumed.")):L("No speech is currently paused.")}async function X(e){let{voiceURI:t,rate:n=W,text:r}=e;if(M().speaking)L("Scheduling speech for later."),$.push(e);else{var i=new window.SpeechSynthesisUtterance(r);if(t){let e=H(t);e&&(i.voice=e)}i.rate=n,M().speak(i),await V();let e=$.shift();e?X(e):L("done with speech que")}}var Y="sentences";function ee(e){L(`Set chunk strategy: ${e}`),Y=e}function te(e){let{voiceURI:t,rate:n=W,text:r}=e;L("Request to speak  =:> "+r),L("With voice =:> "+t);var i=null;"sentences"==Y?(L("splitting text by sentences"),i=r.split(".")):(L("splitting text by words"),i=D.map(D.partition(D.split(r," "),20),D.joiner(" "))),i.forEach((function(t){let n=D.clone(e);n.text=t,X(n)}))}let{asnc:ne,fp:re,logger:ie}=N,ae=ie.get_logger({id:"speech"});function se(e={}){let{result_dispatch:t="tidyscripts_web_speech_recognition_result",interim_dispatch:n="tidyscripts_web_speech_recognition_interim"}=e,{continuous:r=!0,interimResults:i=!0,onStart:a=(()=>{ae("Recognition started")}),onSoundStart:s=(()=>{ae("Sound started...")}),onSoundEnd:o=(()=>{ae("Sound ended...")}),onSpeechStart:l=(()=>{ae("Speech started...")}),onSpeechEnd:u=(()=>{ae("Speech ended...")}),onResult:c=function(e){let r="",i="";for(let a=e.resultIndex;a<e.results.length;++a)e.results[a].isFinal?(ae("GOT FINAL RESULT"),i+=e.results[a][0].transcript,ae("Recognition result: "+i),window.dispatchEvent(new CustomEvent(t,{detail:i}))):(r+=e.results[a][0].transcript,window.dispatchEvent(new CustomEvent(n,{detail:r})))},onError:h=(e=>{ae("Recognition error: "),console.log(e)}),onEnd:d=(()=>{ae("Recognition ended")}),lang:p="en-US"}=e,f=new window.webkitSpeechRecognition;return f.onresult=c,f.onerror=h,f.onend=d,f.continuous=r,f.interimResults=i,f.onstart=a,f.onsoundstart=s,f.onsoundend=o,f.onspeechstart=l,f.onspeechend=u,f}var oe={12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:27.5,22:29.135,23:30.868,24:32.703,25:34.648,26:36.708,27:38.891,28:41.203,29:43.654,30:46.249,31:48.999,32:51.913,33:55,34:58.27,35:61.735,36:65.406,37:69.296,38:73.416,39:77.782,40:82.407,41:87.307,42:92.499,43:97.999,44:103.826,45:110,46:116.541,47:123.471,48:130.813,49:138.591,50:146.832,51:155.564,52:164.814,53:174.614,54:184.997,55:195.998,56:207.652,57:220,58:233.082,59:246.942,60:261.626,61:277.183,62:293.665,63:311.127,64:329.628,65:349.228,66:369.994,67:391.995,68:415.305,69:440,70:466.164,71:493.883,72:523.251,73:554.365,74:587.33,75:622.254,76:659.255,77:698.457,78:739.989,79:783.991,80:830.609,81:880,82:932.328,83:987.767,84:1046.502,85:1108.731,86:1174.659,87:1244.508,88:1318.51,89:1396.913,90:1479.978,91:1567.982,92:1661.219,93:1760,94:1864.655,95:1975.533,96:2093.005,97:2217.461,98:2349.318,99:2489.016,100:2637.021,101:2793.826,102:2959.956,103:3135.964,104:3322.438,105:3520,106:3729.31,107:3951.066,108:4186.009,109:4434.922,110:4698.637,111:4978.032,112:5274.042,113:5587.652,114:5919.912,115:6271.928,116:6644.876,117:7040,118:7458.62,119:7902.133,120:8372.019,121:8869.845,122:9397.273,123:9956.064,124:10548.083,125:11175.305,126:11839.823,127:12543.855};let{fp:le,asnc:ue}=N;var ce=null,he=function(){if(ce)return ce;{let e=window.AudioContext||window.webkitAudioContext;return ce=new e}};async function de(e){let{type:t="sine",duration:n=600,gain:r=.5,delay:i,freq:a}=e,s=he();var o=s.createOscillator();o.frequency.value=a,o.type=t;var l=s.createGain();if(i){var u=s.createDelay();u.delayTime.value=i,l.connect(u),u.connect(s.destination)}l.gain.value=r,o.connect(l),l.connect(s.destination),o.start(0),await ue.wait(n),o.stop()}function pe(e){let{num:t,mod:n,octave:r}=e,i=function(e){return le.nth([0,0,2,4,5,7,9,11,12],e)}(t)+12*r;return n&&(i+="#"==n?1:-1),i}function fe(e){let t=e.split(".");var n=0,r=null,i=null;return t.length>1&&(n=Number(t[1])),t[0].length>1?(r=t[0][0],i=Number(t[0][1])):i=Number(t[0][0]),{num:i,mod:r,octave:n}}function me(e){return pe(fe(e))}function ge(e){return oe[me(e)]}async function ye(e,t,n){console.log(le.format("note | n= {}, dur={}, k={}",[e,t,n]));let r=n?me(n):60,i=me(e),a=oe[String(r+i)],s=t||500;try{await de({freq:a,duration:s})}catch(e){console.log("Error playing. You likely played a note outside of currently supported range"),console.log(e),console.log("freq + duration:"),console.log({freq:a,duration:s})}}async function ve(e,t,n){e.map((e=>ye(e,t,n)))}async function be(e,t,n,r){for(var i of e)ye(i,n,r),await ue.wait(t)}function we(){ve(["1","3"],400,"3.5")}function _e(){ve(["1","b5"],200,"3.5")}function ke(){be(["1","3"],100,100,"3.5")}function Ae(){ve(["5.-1"],100,"3.5")}const Pe=N.logger.get_logger({id:"mic"});var Te={context:null,source:null,processor:null,stream:null,mic_sample_rate:null},Ie=function(e,t){return function(n){var r,i,a,s,o;Te.stream=n,Te.context=new window.AudioContext,Te.source=null===(r=Te.context)||void 0===r?void 0:r.createMediaStreamSource(n),Te.processor=null===(i=Te.context)||void 0===i?void 0:i.createScriptProcessor(1024,1,1),null===(a=Te.source)||void 0===a||a.connect(Te.processor),null===(s=Te.processor)||void 0===s||s.connect(null===(o=Te.context)||void 0===o?void 0:o.destination),Te.processor.onaudioprocess=function(n){let r=e(n.inputBuffer.getChannelData(0));const i=new window.CustomEvent(t,{detail:r});window.dispatchEvent(i)};let l=n.getAudioTracks()[0].getSettings().sampleRate;Te.mic_sample_rate=l,Pe(`Determined sample rate of mic : ${Te.mic_sample_rate}`)}};function Ee(e,t){let n=t||"tidyscripts_web_mic";window.navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(Ie(e,n))}function xe(){let e=Te.context;e&&e.close(),Te={context:null,source:null,processor:null,stream:null,mic_sample_rate:null}}const Ce=N.logger.get_logger({id:"media_recorder"});function Oe(){return!!window.navigator.mediaDevices}var Se=null;async function Ne(){if(Se)return Se;if(!Oe())return void Ce("NOT SUPPORTED");let e=await navigator.mediaDevices.getUserMedia({audio:!0});return Se=new MediaRecorder(e)}async function je(e,t){let n=await Ne();n.addEventListener("dataavailable",(async function(t){e(await t.data)})),n.start(t),Ce("Recording started")}async function De(){(await Ne()).stop(),Ce("Recording stopped")}async function Re(){(await Ne()).pause(),Ce("Recording paused")}async function Le(){(await Ne()).resume(),Ce("Recording resumed")}async function Me(){return(await Ne()).requestData()}async function $e(){return(await Ne()).state}let{dsp:Fe,performance:Ve}=N.util;function ze(){Ee((e=>Fe.power(e)),"tidyscripts_web_mic")}var Be=[],Ue=1e3;function He(e){Ue=e}function Ge(e,t){ze(),t&&He(t);var n=0,r=Ve.ms();let i=t=>{let i=t.detail;if(0==n)return void(n=i);let a=i/n*100;Ve.ms()-r>600&&a>Ue&&e(),n=i};window.addEventListener("tidyscripts_web_mic",i),Be.push(["tidyscripts_web_mic",i])}function qe(){for(var e of(xe(),Be))window.removeEventListener(e[0],e[1]);Be=[]}let{fp:Ke}=N,We=function(){return window.localStorage};var Je="tidyscripts";function Ze(e){Je=e}function Qe(e){return e.join(".")}function Xe(e){return Qe([Je,e])}function Ye(e,t){We()[Xe(t)]=JSON.stringify(e)}function et(e){let t=We()[Xe(e)];return t?JSON.parse(t):null}function tt(){return Object.keys(We())}function nt(e){let t=tt();return Ke.filter(t,(t=>t.startsWith(e)))}function rt(e,t){Ye({timestamp:Number(new Date),data:e},t)}function it(e){return et(e)}var at,st=N.logger.get_logger({id:"voice_interface"}),ot=null,lt=!1;!function(e){e.NULL="NULL",e.STOPPED="STOPPED",e.PAUSED="PAUSED",e.LISTENING="LISTENING",e.STOPPING="STOPPING"}(at||(at={}));var ut=at.NULL;function ct(e){st(`Set listen_while_speaking=${e}`),lt=e}function ht(e){pt();let t=(e=e||{}).onEnd;e.onEnd=function(){ut==at.STOPPING?(st("Recognition stopped"),ut=at.STOPPED):(ut=at.PAUSED,st("Recognition paused")),t&&t()},ot=se(e),ut=at.PAUSED,Ge(ft)}function dt(){ot&&(ot.abort(),ut=at.PAUSED)}function pt(){ot&&(st("Stopping recognition"),ut=at.STOPPING,ot.abort(),ot=null,qe())}async function ft(){ut!=at.LISTENING&&(B()&&st("Wont start recognition while tts active"),ot?ot.start():(ht(),st("Recognition initialized without args")),ut=at.LISTENING)}function mt(){let e=Ue;return dt(),He(1/0),e}function gt(e){ft(),He(e)}function yt(e){Ye("default_voice_uri",e)}function vt(e){J(e)}function bt(e){for(var t of e){let e=G(t);if(e)return yt(e.voiceURI),void st(`Set default voice to: ${e.name}`)}st("Unable to set default voice to any matching name in provided list")}async function wt(e,t,n){if(ot)if(lt)st("Listening while speaking"),te({text:e,voiceURI:t,rate:n}),await z();else{st("Stopping listening while speaking");let r=mt();te({text:e,voiceURI:t,rate:n}),await z(),gt(r)}else te({text:e,voiceURI:t,rate:n}),await z()}async function _t(e){wt(e,et("default_voice_uri"),W)}async function kt(e,t){wt(e,et("default_voice_uri"),t)}let At=N.logger.get_logger({id:"ws"});function Pt(e){var{url:t,handler:n,open:r,error:i,close:a}=e;r=r||(()=>{At(`ws to ${t} opened`)}),a=a||(()=>{At(`ws to ${t} closed`)}),i=i||(e=>{At(`ws to ${t} errored: ${JSON.stringify(e)}`)});let s=new WebSocket(t);return s.onopen=r,s.onclose=a,s.onerror=i,s.onmessage=e=>{n(e.data)},s}function Tt(e,t){document.getElementById(e).value=t}let It=N.logger.get_logger({id:"wutil"});function Et(e){It("Alerting web page!"),window.alert(e)}function xt(){return/Chrome/.test(window.navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function Ct(){return/Mobi/.test(window.navigator.userAgent)}function Ot(){var e=new Uint32Array(4);window.crypto.getRandomValues(e);var t=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){t++;var r=e[t>>3]>>t%8*4&15;return("x"==n?r:3&r|8).toString(16)}))}async function St(e,t){window[t]=await e,It(`Defined ${t} on the window object :)`)}function Nt(e){return new Promise(((t,n)=>{const r=window.document.createElement("script");r.setAttribute("src",e),r.addEventListener("load",t),r.addEventListener("error",n),document.body.appendChild(r)}))}function jt(e){return new Promise(((t,n)=>{const r=window.document.createElement("script");r.setAttribute("src",e.src);let i=e.attributes;if(i){let e=Object.keys(i);for(let t of e)r.setAttribute(t,i[t])}r.addEventListener("load",t),r.addEventListener("error",n),document.body.appendChild(r)}))}function Dt(e){return new Promise(((t,n)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=e,r.media="all",r.addEventListener("load",t),r.addEventListener("error",n),document.getElementsByTagName("head")[0].appendChild(r)}))}let Rt=N.logger.get_logger({id:"bws"});function Lt(e,t){let{sym:n,handler:r,error:i,close:a,open:s}=e;n=n.toLowerCase();let o=`wss://stream.binance.com:9443/ws/${n}@kline_${t=t||"1m"}`;return Rt("Using url for spot kline socket: "+o),Pt({url:o,handler:r,error:i,close:a,open:s})}function Mt(e,t){return Lt({sym:e,handler:t=t||(e=>{console.log(JSON.parse(e))})})}function $t(e){let{sym:t,handler:n,error:r,close:i,open:a}=e;t=t.toLowerCase();let s=`wss://stream.binance.com:9443/ws/${t}@aggTrade`;return Rt("Using url for spot trade socket: "+s),Pt({url:s,handler:n,error:r,close:i,open:a})}function Ft(e,t){return $t({sym:e,handler:t=t||(e=>{console.log(JSON.parse(e))})})}var Vt={freq:{buy:620,sell:580},duration:{buy:30,sell:30}};function zt(e){Vt=e}function Bt(e){de({freq:Vt.freq.buy,gain:e,duration:Vt.duration.buy})}function Ut(e){de({freq:Vt.freq.sell,gain:e,duration:Vt.duration.sell})}function Ht(e){return Ft(e,(function(e){let t=JSON.parse(e),{m:n,p:r,q:i}=t,a=Number(i),s=a>1?1:a;console.log(t),n?Ut(s):Bt(s)}))}let Gt=N.logger.get_logger({id:"key_presses"});function qt(e){window.onkeypress=function(t){Gt("Keypress!");let n=t.key;console.log(n),e[n]&&e[n]()}}N.fp,N.util.debug;let Kt=N.logger.get_logger({id:"key_sounds"}),Wt=N.fp,Jt=N.util.debug;var Zt=["q","w","e","r","t","y","u","i","o","p","["],Qt=["a","s","d","f","g","h","j","k","l",";"],Xt=["z","x","c","v","b","n","m",","],Yt={hi:Zt,mid:Qt,lo:Xt};function en(e){let t=Xt.concat(Qt).concat(Zt),n=0,r={};for(var i of Wt.enumerate(t)){i[0]%7==0&&(n+=1);let e=i[0]%7+1,t=Wt.format("{}.{}",[e,n]);r[i[1]]=t}return r}function tn(e,t=30,n="1.4"){let r={};for(var i of Wt.dict_to_list(e)){let e=i[0],a=i[1];r[e]=function(){Kt(String(a)),ye(String(a),t,n)}}return r}function nn(e=30,t="1.4"){let n=tn(en(),e,t);qt(n),Jt.add("km",n)}let{get_json_from_url:rn}=N,{OpenAI:an}=N.apis;var sn=null;const on=N.logger.get_logger({id:"open_ai_web"}),ln=N.util.debug;function un(){if(sn)return on("OpenAI already initialized"),sn;{on("Initializing open api in browser");let e=localStorage.OAAK;if(e)return sn=new an({apiKey:e,dangerouslyAllowBrowser:!0}),on("Complete"),sn;{let e='Unable to find API key; please make sure api key is under "OAAK" in local storage';return on(e),window.alert(e),1}}}async function cn(e){on(`Request to speak ${e}`);let t=await hn(e);return on("Retrieved audio data from openai"),on("Playing audio and returning data"),t.audio_element.play(),t}async function hn(e){let t=await pn(e),n=await t.blob(),r=URL.createObjectURL(n);return{audio_element:new Audio(r),blob:n}}async function dn(e){let t=un();return await t.audio.speech.create({model:"tts-1",voice:"alloy",input:e})}async function pn(e){let t=un();return await t.audio.speech.create(e)}async function fn(e,t){return await rn("https://www.tidyscripts.com/api/openai_davinci",{prompt:e,max_tokens:t})}async function mn(e){let t="/api/open_ai_chat_2";e.response_format&&(on("Detected request for structured completion"),t="/api/openai_structured_completion",on(`Switching URL to ${t}`),ln.add("chat_completion_args",e));let n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});ln.add("fetch_response",n);let r=await n.json();return ln.add("response",r),r}async function gn(e){un();let t=localStorage.OAAK;const n=new FormData;n.append("file",e,"audio.webm"),n.append("model","whisper-1");try{const e=await fetch("https://api.openai.com/v1/audio/transcriptions",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:n});if(!e.ok)throw new Error(`API request failed with status ${e.status}`);const r=await e.json();return on(`Transcription: ${r.text}`),r.text}catch(e){console.error("Error while sending audio to OpenAI:",e)}}function yn(e){return new WebTransport(e)}function vn(e){return(new TextEncoder).encode(JSON.stringify(e))}function bn(e){let t=yn(e);return{writer:t.datagrams.writable.getWriter(),transport:t}}async function wn(e,t){let n=vn(t);await e.write(n)}function _n(e){let{writer:t,transport:n}=bn(e);return t.write_json=async function(e){await t.write(vn(e))},t}const kn=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},An={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],a=t+1<e.length,s=a?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|s>>4;let h=(15&s)<<2|l>>6,d=63&l;o||(d=64,a||(h=64)),r.push(n[u],n[c],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(kn(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){const a=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{const a=e[n++],s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&a)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],a=t<e.length?n[e.charAt(t)]:0;++t;const s=t<e.length?n[e.charAt(t)]:64;++t;const o=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==a||null==s||null==o)throw new Pn;const l=i<<2|a>>4;if(r.push(l),64!==s){const e=a<<4&240|s>>2;if(r.push(e),64!==o){const e=s<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Pn extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Tn=function(e){return function(e){const t=kn(e);return An.encodeByteArray(t,!0)}(e).replace(/\./g,"")},In=function(e){try{return An.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},En=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==a.g)return a.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&In(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},xn=e=>{var t,n;return null===(n=null===(t=En())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},Cn=e=>{const t=xn(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},On=()=>{var e;return null===(e=En())||void 0===e?void 0:e.config},Sn=e=>{var t;return null===(t=En())||void 0===t?void 0:t[`_${e}`]};class Nn{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function jn(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class Dn extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Dn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Rn.prototype.create)}}class Rn{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],a=i?function(e,t){return e.replace(Ln,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",s=`${this.serviceName}: ${a} (${r}).`;return new Dn(r,s,n)}}const Ln=/\{\$([^}]+)}/g;function Mn(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],a=t[i];if($n(n)&&$n(a)){if(!Mn(n,a))return!1}else if(n!==a)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function $n(e){return null!==e&&"object"==typeof e}function Fn(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Vn(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function zn(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Bn{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=Un),void 0===r.error&&(r.error=Un),void 0===r.complete&&(r.complete=Un);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function Un(){}function Hn(e){return e&&e._delegate?e._delegate:e}class Gn{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const qn="[DEFAULT]";class Kn{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Nn;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const e=this.getOrInitializeService({instanceIdentifier:t});e&&n.resolve(e)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:qn})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(e){}}}}clearInstance(e=qn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=qn){return this.instances.has(e)}getOptions(e=qn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const a=this.instances.get(r);return a&&e(a,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===qn?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=qn){return this.component?this.component.multipleInstances?e:qn:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Wn{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Kn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Jn=[];var Zn;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Zn||(Zn={}));const Qn={debug:Zn.DEBUG,verbose:Zn.VERBOSE,info:Zn.INFO,warn:Zn.WARN,error:Zn.ERROR,silent:Zn.SILENT},Xn=Zn.INFO,Yn={[Zn.DEBUG]:"log",[Zn.VERBOSE]:"log",[Zn.INFO]:"info",[Zn.WARN]:"warn",[Zn.ERROR]:"error"},er=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=Yn[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class tr{constructor(e){this.name=e,this._logLevel=Xn,this._logHandler=er,this._userLogHandler=null,Jn.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Zn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Qn[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Zn.DEBUG,...e),this._logHandler(this,Zn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Zn.VERBOSE,...e),this._logHandler(this,Zn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Zn.INFO,...e),this._logHandler(this,Zn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Zn.WARN,...e),this._logHandler(this,Zn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Zn.ERROR,...e),this._logHandler(this,Zn.ERROR,...e)}}const nr=(e,t)=>t.some((t=>e instanceof t));let rr,ir;const ar=new WeakMap,sr=new WeakMap,or=new WeakMap,lr=new WeakMap,ur=new WeakMap;let cr={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return sr.get(e);if("objectStoreNames"===t)return e.objectStoreNames||or.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return hr(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function hr(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{t(hr(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)}));return t.then((t=>{t instanceof IDBCursor&&ar.set(t,e)})).catch((()=>{})),ur.set(t,e),t}(e);if(lr.has(e))return lr.get(e);const t=function(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ir||(ir=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(dr(this),e),hr(ar.get(this))}:function(...e){return hr(t.apply(dr(this),e))}:function(e,...n){const r=t.call(dr(this),e,...n);return or.set(r,e.sort?e.sort():[e]),hr(r)}:(e instanceof IDBTransaction&&function(e){if(sr.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{t(),r()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)}));sr.set(e,t)}(e),nr(e,rr||(rr=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,cr):e);var t}(e);return t!==e&&(lr.set(e,t),ur.set(t,e)),t}const dr=e=>ur.get(e),pr=["get","getKey","getAll","getAllKeys","count"],fr=["put","add","delete","clear"],mr=new Map;function gr(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(mr.get(t))return mr.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=fr.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!pr.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,i?"readwrite":"readonly");let s=a.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),i&&a.done]))[0]};return mr.set(t,a),a}var yr;yr=cr,cr={...yr,get:(e,t,n)=>gr(e,t)||yr.get(e,t,n),has:(e,t)=>!!gr(e,t)||yr.has(e,t)};class vr{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const br="@firebase/app",wr="0.10.13",_r=new tr("@firebase/app"),kr="@firebase/app-compat",Ar="@firebase/analytics-compat",Pr="@firebase/analytics",Tr="@firebase/app-check-compat",Ir="@firebase/app-check",Er="@firebase/auth",xr="@firebase/auth-compat",Cr="@firebase/database",Or="@firebase/data-connect",Sr="@firebase/database-compat",Nr="@firebase/functions",jr="@firebase/functions-compat",Dr="@firebase/installations",Rr="@firebase/installations-compat",Lr="@firebase/messaging",Mr="@firebase/messaging-compat",$r="@firebase/performance",Fr="@firebase/performance-compat",Vr="@firebase/remote-config",zr="@firebase/remote-config-compat",Br="@firebase/storage",Ur="@firebase/storage-compat",Hr="@firebase/firestore",Gr="@firebase/vertexai-preview",qr="@firebase/firestore-compat",Kr="firebase",Wr="[DEFAULT]",Jr={[br]:"fire-core",[kr]:"fire-core-compat",[Pr]:"fire-analytics",[Ar]:"fire-analytics-compat",[Ir]:"fire-app-check",[Tr]:"fire-app-check-compat",[Er]:"fire-auth",[xr]:"fire-auth-compat",[Cr]:"fire-rtdb",[Or]:"fire-data-connect",[Sr]:"fire-rtdb-compat",[Nr]:"fire-fn",[jr]:"fire-fn-compat",[Dr]:"fire-iid",[Rr]:"fire-iid-compat",[Lr]:"fire-fcm",[Mr]:"fire-fcm-compat",[$r]:"fire-perf",[Fr]:"fire-perf-compat",[Vr]:"fire-rc",[zr]:"fire-rc-compat",[Br]:"fire-gcs",[Ur]:"fire-gcs-compat",[Hr]:"fire-fst",[qr]:"fire-fst-compat",[Gr]:"fire-vertex","fire-js":"fire-js",[Kr]:"fire-js-all"},Zr=new Map,Qr=new Map,Xr=new Map;function Yr(e,t){try{e.container.addComponent(t)}catch(n){_r.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ei(e){const t=e.name;if(Xr.has(t))return _r.debug(`There were multiple attempts to register component ${t}.`),!1;Xr.set(t,e);for(const t of Zr.values())Yr(t,e);for(const t of Qr.values())Yr(t,e);return!0}function ti(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ni(e){return void 0!==e.settings}const ri=new Rn("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ii{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Gn("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ri.create("app-deleted",{appName:this._name})}}const ai="10.14.1";function si(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:Wr,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw ri.create("bad-app-name",{appName:String(i)});if(n||(n=On()),!n)throw ri.create("no-options");const a=Zr.get(i);if(a){if(Mn(n,a.options)&&Mn(r,a.config))return a;throw ri.create("duplicate-app",{appName:i})}const s=new Wn(i);for(const e of Xr.values())s.addComponent(e);const o=new ii(n,r,s);return Zr.set(i,o),o}function oi(e=Wr){const t=Zr.get(e);if(!t&&e===Wr&&On())return si();if(!t)throw ri.create("no-app",{appName:e});return t}function li(e,t,n){var r;let i=null!==(r=Jr[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const a=i.match(/\s|\//),s=t.match(/\s|\//);if(a||s){const e=[`Unable to register library "${i}" with version "${t}":`];return a&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void _r.warn(e.join(" "))}ei(new Gn(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const ui="firebase-heartbeat-database",ci=1,hi="firebase-heartbeat-store";let di=null;function pi(){return di||(di=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:a}={}){const s=indexedDB.open(e,t),o=hr(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(hr(s.result),e.oldVersion,e.newVersion,hr(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),o.then((e=>{a&&e.addEventListener("close",(()=>a())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),o}(ui,ci,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(hi)}catch(e){console.warn(e)}}}).catch((e=>{throw ri.create("idb-open",{originalErrorMessage:e.message})}))),di}async function fi(e,t){try{const n=(await pi()).transaction(hi,"readwrite"),r=n.objectStore(hi);await r.put(t,mi(e)),await n.done}catch(e){if(e instanceof Dn)_r.warn(e.message);else{const t=ri.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});_r.warn(t.message)}}}function mi(e){return`${e.name}!${e.options.appId}`}class gi{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new vi(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=yi();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(e){_r.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=yi(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),bi(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),bi(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=Tn(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return _r.warn(e),""}}}function yi(){return(new Date).toISOString().substring(0,10)}class vi{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await pi()).transaction(hi),n=await t.objectStore(hi).get(mi(e));return await t.done,n}catch(e){if(e instanceof Dn)_r.warn(e.message);else{const t=ri.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});_r.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return fi(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return fi(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function bi(e){return Tn(JSON.stringify({version:2,heartbeats:e})).length}function wi(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}ei(new Gn("platform-logger",(e=>new vr(e)),"PRIVATE")),ei(new Gn("heartbeat",(e=>new gi(e)),"PRIVATE")),li(br,wr,""),li(br,wr,"esm2017"),li("fire-js",""),li("firebase","10.14.1","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const _i=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ki=new Rn("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ai=new tr("@firebase/auth");function Pi(e,...t){Ai.logLevel<=Zn.ERROR&&Ai.error(`Auth (${ai}): ${e}`,...t)}function Ti(e,...t){throw Ci(e,...t)}function Ii(e,...t){return Ci(e,...t)}function Ei(e,t,n){const r=Object.assign(Object.assign({},_i()),{[t]:n});return new Rn("auth","Firebase",r).create(t,{appName:e.name})}function xi(e){return Ei(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ci(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return ki.create(e,...t)}function Oi(e,t,...n){if(!e)throw Ci(t,...n)}function Si(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Pi(t),new Error(t)}function Ni(e,t){e||Si(t)}function ji(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Di(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Ri{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ni(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(jn())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Di()||"https:"===Di()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Li(e,t){Ni(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Mi{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Si("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Si("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Si("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const $i={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Fi=new Ri(3e4,6e4);function Vi(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function zi(e,t,n,r,i={}){return Bi(e,i,(async()=>{let i={},a={};r&&("GET"===t?a=r:i={body:JSON.stringify(r)});const s=Fn(Object.assign({key:e.config.apiKey},a)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l=Object.assign({method:t,headers:o},i);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),Mi.fetch()(Hi(e,e.config.apiHost,n,s),l)}))}async function Bi(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},$i),t);try{const t=new qi(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Ki(e,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const t=i.ok?a.errorMessage:a.error.message,[n,s]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ki(e,"credential-already-in-use",a);if("EMAIL_EXISTS"===n)throw Ki(e,"email-already-in-use",a);if("USER_DISABLED"===n)throw Ki(e,"user-disabled",a);const o=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(s)throw Ei(e,o,s);Ti(e,o)}}catch(t){if(t instanceof Dn)throw t;Ti(e,"network-request-failed",{message:String(t)})}}async function Ui(e,t,n,r,i={}){const a=await zi(e,t,n,r,i);return"mfaPendingCredential"in a&&Ti(e,"multi-factor-auth-required",{_serverResponse:a}),a}function Hi(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?Li(e.config,i):`${e.config.apiScheme}://${i}`}function Gi(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qi{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Ii(this.auth,"network-request-failed"))),Fi.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ki(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Ii(e,t,r);return i.customData._tokenResponse=n,i}function Wi(e){return void 0!==e&&void 0!==e.enterprise}class Ji{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Gi(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function Zi(e,t){return zi(e,"POST","/v1/accounts:lookup",t)}function Qi(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Xi(e){return 1e3*Number(e)}function Yi(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Pi("JWT malformed, contained fewer than 3 sections"),null;try{const e=In(n);return e?JSON.parse(e):(Pi("Failed to decode base64 JWT payload"),null)}catch(e){return Pi("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function ea(e){const t=Yi(e);return Oi(t,"internal-error"),Oi(void 0!==t.exp,"internal-error"),Oi(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function ta(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof Dn&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class na{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class ra{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Qi(this.lastLoginAt),this.creationTime=Qi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ia(e){var t;const n=e.auth,r=await e.getIdToken(),i=await ta(e,Zi(n,{idToken:r}));Oi(null==i?void 0:i.users.length,n,"internal-error");const a=i.users[0];e._notifyReloadListener(a);const s=(null===(t=a.providerUserInfo)||void 0===t?void 0:t.length)?aa(a.providerUserInfo):[],o=(l=e.providerData,u=s,[...l.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var l,u;const c=e.isAnonymous,h=!(e.email&&a.passwordHash||(null==o?void 0:o.length)),d=!!c&&h,p={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:o,metadata:new ra(a.createdAt,a.lastLoginAt),isAnonymous:d};Object.assign(e,p)}function aa(e){return e.map((e=>{var{providerId:t}=e,n=wi(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class sa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Oi(e.idToken,"internal-error"),Oi(void 0!==e.idToken,"internal-error"),Oi(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):ea(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Oi(0!==e.length,"internal-error");const t=ea(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Oi(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await Bi(e,{},(async()=>{const n=Fn({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,a=Hi(e,r,"/v1/token",`key=${i}`),s=await e._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",Mi.fetch()(a,{method:"POST",headers:s,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,a=new sa;return n&&(Oi("string"==typeof n,"internal-error",{appName:e}),a.refreshToken=n),r&&(Oi("string"==typeof r,"internal-error",{appName:e}),a.accessToken=r),i&&(Oi("number"==typeof i,"internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new sa,this.toJSON())}_performRefresh(){return Si("not implemented")}}function oa(e,t){Oi("string"==typeof e||void 0===e,"internal-error",{appName:t})}class la{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=wi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new na(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new ra(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ta(this,this.stsTokenManager.getToken(this.auth,e));return Oi(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=Hn(e),r=await n.getIdToken(t),i=Yi(r);Oi(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const a="object"==typeof i.firebase?i.firebase:void 0,s=null==a?void 0:a.sign_in_provider;return{claims:i,token:r,authTime:Qi(Xi(i.auth_time)),issuedAtTime:Qi(Xi(i.iat)),expirationTime:Qi(Xi(i.exp)),signInProvider:s||null,signInSecondFactor:(null==a?void 0:a.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Hn(e);await ia(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Oi(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new la(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Oi(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ia(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ni(this.auth.app))return Promise.reject(xi(this.auth));const e=await this.getIdToken();return await ta(this,async function(e,t){return zi(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,a,s,o,l,u;const c=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(a=t.photoURL)&&void 0!==a?a:void 0,f=null!==(s=t.tenantId)&&void 0!==s?s:void 0,m=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:b,isAnonymous:w,providerData:_,stsTokenManager:k}=t;Oi(v&&k,e,"internal-error");const A=sa.fromJSON(this.name,k);Oi("string"==typeof v,e,"internal-error"),oa(c,e.name),oa(h,e.name),Oi("boolean"==typeof b,e,"internal-error"),Oi("boolean"==typeof w,e,"internal-error"),oa(d,e.name),oa(p,e.name),oa(f,e.name),oa(m,e.name),oa(g,e.name),oa(y,e.name);const P=new la({uid:v,auth:e,email:h,emailVerified:b,displayName:c,isAnonymous:w,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:A,createdAt:g,lastLoginAt:y});return _&&Array.isArray(_)&&(P.providerData=_.map((e=>Object.assign({},e)))),m&&(P._redirectEventId=m),P}static async _fromIdTokenResponse(e,t,n=!1){const r=new sa;r.updateFromServerResponse(t);const i=new la({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ia(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];Oi(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?aa(r.providerUserInfo):[],a=!(r.email&&r.passwordHash||(null==i?void 0:i.length)),s=new sa;s.updateFromIdToken(n);const o=new la({uid:r.localId,auth:e,stsTokenManager:s,isAnonymous:a}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new ra(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==i?void 0:i.length))};return Object.assign(o,l),o}}const ua=new Map;function ca(e){Ni(e instanceof Function,"Expected a class definition");let t=ua.get(e);return t?(Ni(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ua.set(e,t),t)}class ha{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ha.type="NONE";const da=ha;function pa(e,t,n){return`firebase:${e}:${t}:${n}`}class fa{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=pa(this.userKey,r.apiKey,i),this.fullPersistenceKey=pa("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?la._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new fa(ca(da),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||ca(da);const a=pa(n,e.config.apiKey,e.name);let s=null;for(const n of t)try{const t=await n._get(a);if(t){const r=la._fromJSON(e,t);n!==i&&(s=r),i=n;break}}catch(e){}const o=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&o.length?(i=o[0],s&&await i._set(a,s.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(a)}catch(e){}}))),new fa(i,e,n)):new fa(i,e,n)}}function ma(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ba(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ga(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(_a(t))return"Blackberry";if(ka(t))return"Webos";if(ya(t))return"Safari";if((t.includes("chrome/")||va(t))&&!t.includes("edge/"))return"Chrome";if(wa(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function ga(e=jn()){return/firefox\//i.test(e)}function ya(e=jn()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function va(e=jn()){return/crios\//i.test(e)}function ba(e=jn()){return/iemobile/i.test(e)}function wa(e=jn()){return/android/i.test(e)}function _a(e=jn()){return/blackberry/i.test(e)}function ka(e=jn()){return/webos/i.test(e)}function Aa(e=jn()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Pa(e=jn()){return Aa(e)||wa(e)||ka(e)||_a(e)||/windows phone/i.test(e)||ba(e)}function Ta(e,t=[]){let n;switch(e){case"Browser":n=ma(jn());break;case"Worker":n=`${ma(jn())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${ai}/${r}`}class Ia{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const n of t)try{n()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Ea{constructor(e){var t,n,r,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=a.minPasswordLength)&&void 0!==t?t:6,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),void 0!==a.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),void 0!==a.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),void 0!==a.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),void 0!==a.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,a,s;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(r=o.containsLowercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(i=o.containsUppercaseLetter)||void 0===i||i),o.isValid&&(o.isValid=null===(a=o.containsNumericCharacter)||void 0===a||a),o.isValid&&(o.isValid=null===(s=o.containsNonAlphanumericCharacter)||void 0===s||s),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class xa{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Oa(this),this.idTokenSubscription=new Oa(this),this.beforeStateQueue=new Ia(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ki,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ca(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await fa.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Zi(this,{idToken:e}),n=await la._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ni(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,a=null==r?void 0:r._redirectEventId,s=await this.tryRedirectSignIn(e);n&&n!==a||!(null==s?void 0:s.user)||(r=s.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Oi(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ia(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ni(this.app))return Promise.reject(xi(this));const t=e?Hn(e):null;return t&&Oi(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Oi(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return ni(this.app)?Promise.reject(xi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ni(this.app)?Promise.reject(xi(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(ca(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return zi(e,"GET","/v2/passwordPolicy",Vi(e,t))}(this),t=new Ea(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Rn("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return zi(e,"POST","/v2/accounts:revokeToken",Vi(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ca(e)||this._popupRedirectResolver;Oi(t,this,"argument-error"),this.redirectPersistenceManager=await fa.create(this,[ca(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let a=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(Oi(s,this,"internal-error"),s.then((()=>{a||i(this.currentUser)})),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{a=!0,i()}}{const n=e.addObserver(t);return()=>{a=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Oi(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ta(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Ai.logLevel<=Zn.WARN&&Ai.warn(`Auth (${ai}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Ca(e){return Hn(e)}class Oa{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new Bn(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Oi(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Sa={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Na(e){return Sa.loadJS(e)}function ja(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Da{constructor(e){this.type="recaptcha-enterprise",this.auth=Ca(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;Wi(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{(async function(e,t){return zi(e,"GET","/v2/recaptchaConfig",Vi(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}))})(e).then((r=>{if(void 0!==r.recaptchaKey){const n=new Ji(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&Wi(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Sa.recaptchaEnterpriseScript;0!==t.length&&(t+=i),Na(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Ra(e,t,n,r=!1){const i=new Da(e);let a;try{a=await i.verify(n)}catch(e){a=await i.verify(n,!0)}const s=Object.assign({},t);return r?Object.assign(s,{captchaResp:a}):Object.assign(s,{captchaResponse:a}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function La(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Ra(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await Ra(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}function Ma(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function $a(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Fa{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Si("not implemented")}_getIdTokenResponse(e){return Si("not implemented")}_linkToIdToken(e,t){return Si("not implemented")}_getReauthenticationResolver(e){return Si("not implemented")}}async function Va(e,t){return zi(e,"POST","/v1/accounts:signUp",t)}async function za(e,t){return Ui(e,"POST","/v1/accounts:signInWithPassword",Vi(e,t))}class Ba extends Fa{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Ba(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Ba(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return La(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",za);case"emailLink":return async function(e,t){return Ui(e,"POST","/v1/accounts:signInWithEmailLink",Vi(e,t))}(e,{email:this._email,oobCode:this._password});default:Ti(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return La(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Va);case"emailLink":return async function(e,t){return Ui(e,"POST","/v1/accounts:signInWithEmailLink",Vi(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Ti(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ua(e,t){return Ui(e,"POST","/v1/accounts:signInWithIdp",Vi(e,t))}class Ha extends Fa{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ha(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ti("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=wi(t,["providerId","signInMethod"]);if(!n||!r)return null;const a=new Ha(n,r);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){return Ua(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ua(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ua(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Fn(t)}return e}}const Ga={USER_NOT_FOUND:"user-not-found"};class qa extends Fa{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new qa({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new qa({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Ui(e,"POST","/v1/accounts:signInWithPhoneNumber",Vi(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Ui(e,"POST","/v1/accounts:signInWithPhoneNumber",Vi(e,t));if(n.temporaryProof)throw Ki(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Ui(e,"POST","/v1/accounts:signInWithPhoneNumber",Vi(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ga)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new qa({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Ka{constructor(e){var t,n,r,i,a,s;const o=Vn(zn(e)),l=null!==(t=o.apiKey)&&void 0!==t?t:null,u=null!==(n=o.oobCode)&&void 0!==n?n:null,c=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=o.mode)&&void 0!==r?r:null);Oi(l&&u&&c,"argument-error"),this.apiKey=l,this.operation=c,this.code=u,this.continueUrl=null!==(i=o.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(a=o.languageCode)&&void 0!==a?a:null,this.tenantId=null!==(s=o.tenantId)&&void 0!==s?s:null}static parseLink(e){const t=function(e){const t=Vn(zn(e)).link,n=t?Vn(zn(t)).deep_link_id:null,r=Vn(zn(e)).deep_link_id;return(r?Vn(zn(r)).link:null)||r||n||t||e}(e);try{return new Ka(t)}catch(e){return null}}}class Wa{constructor(){this.providerId=Wa.PROVIDER_ID}static credential(e,t){return Ba._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Ka.parseLink(t);return Oi(n,"argument-error"),Ba._fromEmailAndCode(e,n.code,n.tenantId)}}Wa.PROVIDER_ID="password",Wa.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Wa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ja{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Za extends Ja{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Qa extends Za{constructor(){super("facebook.com")}static credential(e){return Ha._fromParams({providerId:Qa.PROVIDER_ID,signInMethod:Qa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qa.credentialFromTaggedObject(e)}static credentialFromError(e){return Qa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Qa.credential(e.oauthAccessToken)}catch(e){return null}}}Qa.FACEBOOK_SIGN_IN_METHOD="facebook.com",Qa.PROVIDER_ID="facebook.com";class Xa extends Za{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ha._fromParams({providerId:Xa.PROVIDER_ID,signInMethod:Xa.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Xa.credentialFromTaggedObject(e)}static credentialFromError(e){return Xa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Xa.credential(t,n)}catch(e){return null}}}Xa.GOOGLE_SIGN_IN_METHOD="google.com",Xa.PROVIDER_ID="google.com";class Ya extends Za{constructor(){super("github.com")}static credential(e){return Ha._fromParams({providerId:Ya.PROVIDER_ID,signInMethod:Ya.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ya.credentialFromTaggedObject(e)}static credentialFromError(e){return Ya.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ya.credential(e.oauthAccessToken)}catch(e){return null}}}Ya.GITHUB_SIGN_IN_METHOD="github.com",Ya.PROVIDER_ID="github.com";class es extends Za{constructor(){super("twitter.com")}static credential(e,t){return Ha._fromParams({providerId:es.PROVIDER_ID,signInMethod:es.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return es.credentialFromTaggedObject(e)}static credentialFromError(e){return es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return es.credential(t,n)}catch(e){return null}}}es.TWITTER_SIGN_IN_METHOD="twitter.com",es.PROVIDER_ID="twitter.com";class ts{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await la._fromIdTokenResponse(e,n,r),a=ns(n);return new ts({user:i,providerId:a,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=ns(n);return new ts({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function ns(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class rs extends Dn{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,rs.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new rs(e,t,n,r)}}function is(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw rs._fromErrorAndOperation(e,n,t,r);throw n}))}new WeakMap;const as="__sak";class ss{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(as,"1"),this.storage.removeItem(as),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class os extends ss{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Pa(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=jn();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}os.type="LOCAL";const ls=os;class us extends ss{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}us.type="SESSION";const cs=us;class hs{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new hs(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,a=this.handlersMap[r];if(!(null==a?void 0:a.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const s=Array.from(a).map((async e=>e(t.origin,i))),o=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(s);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function ds(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}hs.receivers=[];class ps{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,a;return new Promise(((s,o)=>{const l=ds("",20);r.port1.start();const u=setTimeout((()=>{o(new Error("unsupported_event"))}),n);a={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{o(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),s(t.data.response);break;default:clearTimeout(u),clearTimeout(i),o(new Error("invalid_response"))}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])})).finally((()=>{a&&this.removeMessageHandler(a)}))}}function fs(){return window}function ms(){return void 0!==fs().WorkerGlobalScope&&"function"==typeof fs().importScripts}const gs="firebaseLocalStorageDb",ys="firebaseLocalStorage",vs="fbase_key";class bs{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function ws(e,t){return e.transaction([ys],t?"readwrite":"readonly").objectStore(ys)}function _s(){const e=indexedDB.open(gs,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(ys,{keyPath:vs})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(ys)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(gs);return new bs(e).toPromise()}(),t(await _s()))}))}))}async function ks(e,t,n){const r=ws(e,!0).put({[vs]:t,value:n});return new bs(r).toPromise()}function As(e,t){const n=ws(e,!0).delete(t);return new bs(n).toPromise()}class Ps{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await _s()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ms()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=hs._getInstance(ms()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new ps(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _s();return await ks(e,as,"1"),await As(e,as),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>ks(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=ws(e,!1).get(t),r=await new bs(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>As(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=ws(e,!1).getAll();return new bs(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ps.type="LOCAL";const Ts=Ps;ja("rcb"),new Ri(3e4,6e4);class Is{constructor(e){this.providerId=Is.PROVIDER_ID,this.auth=Ca(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const i=await n.verify();try{let a;if(Oi("string"==typeof i,e,"argument-error"),Oi("recaptcha"===n.type,e,"argument-error"),a="string"==typeof t?{phoneNumber:t}:t,"session"in a){const t=a.session;if("phoneNumber"in a){Oi("enroll"===t.type,e,"internal-error");const n=await function(e,t){return zi(e,"POST","/v2/accounts/mfaEnrollment:start",Vi(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:a.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{Oi("signin"===t.type,e,"internal-error");const n=(null===(r=a.multiFactorHint)||void 0===r?void 0:r.uid)||a.multiFactorUid;Oi(n,e,"missing-multi-factor-info");const s=await function(e,t){return zi(e,"POST","/v2/accounts/mfaSignIn:start",Vi(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return s.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return zi(e,"POST","/v1/accounts:sendVerificationCode",Vi(e,t))}(e,{phoneNumber:a.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}(this.auth,e,Hn(t))}static credential(e,t){return qa._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Is.credentialFromTaggedObject(t)}static credentialFromError(e){return Is.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?qa._fromTokenResponse(t,n):null}}function Es(e,t){return t?ca(t):(Oi(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Is.PROVIDER_ID="phone",Is.PHONE_SIGN_IN_METHOD="phone";class xs extends Fa{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ua(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ua(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ua(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Cs(e){return async function(e,t,n=!1){if(ni(e.app))return Promise.reject(xi(e));const r="signIn",i=await is(e,r,t),a=await ts._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(a.user),a}(e.auth,new xs(e),e.bypassAuthState)}function Os(e){const{auth:t,user:n}=e;return Oi(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e;if(ni(r.app))return Promise.reject(xi(r));const i="reauthenticate";try{const a=await ta(e,is(r,i,t,e),n);Oi(a.idToken,r,"internal-error");const s=Yi(a.idToken);Oi(s,r,"internal-error");const{sub:o}=s;return Oi(e.uid===o,r,"user-mismatch"),ts._forOperation(e,i,a)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Ti(r,"user-mismatch"),e}}(n,new xs(e),e.bypassAuthState)}async function Ss(e){const{auth:t,user:n}=e;return Oi(n,t,"internal-error"),async function(e,t,n=!1){const r=await ta(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ts._forOperation(e,"link",r)}(n,new xs(e),e.bypassAuthState)}class Ns{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:a,type:s}=e;if(a)return void this.reject(a);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Cs;case"linkViaPopup":case"linkViaRedirect":return Ss;case"reauthViaPopup":case"reauthViaRedirect":return Os;default:Ti(this.auth,"internal-error")}}resolve(e){Ni(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ni(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const js=new Ri(2e3,1e4);class Ds extends Ns{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Ds.currentPopupAction&&Ds.currentPopupAction.cancel(),Ds.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Oi(e,this.auth,"internal-error"),e}async onExecution(){Ni(1===this.filter.length,"Popup operations only handle one event");const e=ds();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Ii(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Ii(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ds.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Ii(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,js.get())};e()}}Ds.currentPopupAction=null;const Rs="pendingRedirect",Ls=new Map;class Ms extends Ns{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Ls.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Vs(t),r=Fs(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Ls.set(this.auth._key(),e)}return this.bypassAuthState||Ls.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function $s(e,t){Ls.set(e._key(),t)}function Fs(e){return ca(e._redirectPersistence)}function Vs(e){return pa(Rs,e.config.apiKey,e.name)}function zs(e,t,n){return async function(e,t,n){if(ni(e.app))return Promise.reject(xi(e));const r=Ca(e);(function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Ti(e,"argument-error"),Ei(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)})(e,t,Ja),await r._initializationPromise;const i=Es(r,n);return await async function(e,t){return Fs(e)._set(Vs(t),"true")}(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}async function Bs(e,t,n=!1){if(ni(e.app))return Promise.reject(xi(e));const r=Ca(e),i=Es(r,t),a=new Ms(r,i,n),s=await a.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}class Us{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Gs(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Gs(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Ii(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Hs(e))}saveEventToCache(e){this.cachedEventUids.add(Hs(e)),this.lastProcessedEventTime=Date.now()}}function Hs(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Gs({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const qs=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ks=/^https?/;function Ws(e){const t=ji(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Ks.test(n))return!1;if(qs.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Js=new Ri(3e4,6e4);function Zs(){const e=fs().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Qs=null;const Xs=new Ri(5e3,15e3),Ys={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},eo=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function to(e){const t=e.config;Oi(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Li(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:ai},i=eo.get(e.config.apiHost);i&&(r.eid=i);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${Fn(r).slice(1)}`}const no={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ro{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const io=encodeURIComponent("fac");async function ao(e,t,n,r,i,a){Oi(e.config.authDomain,e,"auth-domain-config-required"),Oi(e.config.apiKey,e,"invalid-api-key");const s={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:ai,eventId:i};if(t instanceof Ja){t.setDefaultLanguage(e.languageCode),s.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(s.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))s[e]=t}if(t instanceof Za){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(s.scopes=e.join(","))}e.tenantId&&(s.tid=e.tenantId);const o=s;for(const e of Object.keys(o))void 0===o[e]&&delete o[e];const l=await e._getAppCheckToken(),u=l?`#${io}=${encodeURIComponent(l)}`:"";return`${function({config:e}){return e.emulator?Li(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${Fn(o).slice(1)}${u}`}const so="webStorageSupport",oo=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=cs,this._completeRedirectFn=Bs,this._overrideRedirectResult=$s}async _openPopup(e,t,n,r){var i;return Ni(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),s=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=Object.assign(Object.assign({},no),{width:r.toString(),height:i.toString(),top:a,left:s}),u=jn().toLowerCase();n&&(o=va(u)?"_blank":n),ga(u)&&(t=t||"http://localhost",l.scrollbars="yes");const c=Object.entries(l).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=jn()){var t;return Aa(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new ro(null);const h=window.open(t||"",o,c);Oi(h,e,"popup-blocked");try{h.focus()}catch(e){}return new ro(h)}(e,await ao(e,t,n,ji(),r),ds())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await ao(e,t,n,ji(),r),fs().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Ni(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return Qs=Qs||function(e){return new Promise(((t,n)=>{var r,i,a;function s(){Zs(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Zs(),n(Ii(e,"network-request-failed"))},timeout:Js.get()})}if(null===(i=null===(r=fs().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(a=fs().gapi)||void 0===a?void 0:a.load)){const t=ja("iframefcb");return fs()[t]=()=>{gapi.load?s():n(Ii(e,"network-request-failed"))},Na(`${Sa.gapiScript}?onload=${t}`).catch((e=>n(e)))}s()}})).catch((e=>{throw Qs=null,e}))}(e),Qs}(e),n=fs().gapi;return Oi(n,e,"internal-error"),t.open({where:document.body,url:to(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ys,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Ii(e,"network-request-failed"),a=fs().setTimeout((()=>{r(i)}),Xs.get());function s(){fs().clearTimeout(a),n(t)}t.ping(s).then(s,(()=>{r(i)}))}))))}(e),n=new Us(e);return t.register("authEvent",(t=>(Oi(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(so,{type:so},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[so];void 0!==i&&t(!!i),Ti(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return zi(e,"GET","/v1/projects",t)}(e);for(const n of t)try{if(Ws(n))return}catch(e){}Ti(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Pa()||ya()||Aa()}};var lo="@firebase/auth",uo="1.7.9";class co{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Oi(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const ho=Sn("authIdTokenMaxAge")||300;let po=null;const fo=e=>async t=>{const n=t&&await t.getIdTokenResult(),r=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>ho)return;const i=null==n?void 0:n.token;po!==i&&(po=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};var mo,go;mo={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");var i,a;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Ii("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(a=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==a?a:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Sa=mo,go="Browser",ei(new Gn("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:s}=n.options;Oi(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const o={apiKey:a,authDomain:s,clientPlatform:go,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ta(go)},l=new xa(n,r,i,o);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ca);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(l,t),l}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ei(new Gn("auth-internal",(e=>{return t=Ca(e.getProvider("auth").getImmediate()),new co(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),li(lo,uo,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(go)),li(lo,uo,"esm2017");var yo,vo,bo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},wo={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var a=e.g[3],s=t+(a^n&(i^a))+r[0]+3614090360&4294967295;s=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=n+(s<<7&4294967295|s>>>25))+((s=a+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^a&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(a^t))+r[3]+3250441966&4294967295)<<22&4294967295|s>>>10))+((s=t+(a^n&(i^a))+r[4]+4118548399&4294967295)<<7&4294967295|s>>>25))+((s=a+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^a&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(a^t))+r[7]+4249261313&4294967295)<<22&4294967295|s>>>10))+((s=t+(a^n&(i^a))+r[8]+1770035416&4294967295)<<7&4294967295|s>>>25))+((s=a+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^a&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(a^t))+r[11]+2304563134&4294967295)<<22&4294967295|s>>>10))+((s=t+(a^n&(i^a))+r[12]+1804603682&4294967295)<<7&4294967295|s>>>25))+((s=a+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^a&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(a^t))+r[15]+1236535329&4294967295)<<22&4294967295|s>>>10))+((s=t+(i^a&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|s>>>27))+((s=a+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(a^t))+r[11]+643717713&4294967295)<<14&4294967295|s>>>18))+((s=n+(a^t&(i^a))+r[0]+3921069994&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^a&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|s>>>27))+((s=a+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(a^t))+r[15]+3634488961&4294967295)<<14&4294967295|s>>>18))+((s=n+(a^t&(i^a))+r[4]+3889429448&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^a&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|s>>>27))+((s=a+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(a^t))+r[3]+4107603335&4294967295)<<14&4294967295|s>>>18))+((s=n+(a^t&(i^a))+r[8]+1163531501&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^a&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|s>>>27))+((s=a+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(a^t))+r[7]+1735328473&4294967295)<<14&4294967295|s>>>18))+((s=n+(a^t&(i^a))+r[12]+2368359562&4294967295)<<20&4294967295|s>>>12))+((s=t+(n^i^a)+r[5]+4294588738&4294967295)<<4&4294967295|s>>>28))+((s=a+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|s>>>21))+((s=i+(a^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^a^t)+r[14]+4259657740&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^a)+r[1]+2763975236&4294967295)<<4&4294967295|s>>>28))+((s=a+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|s>>>21))+((s=i+(a^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^a^t)+r[10]+3200236656&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^a)+r[13]+681279174&4294967295)<<4&4294967295|s>>>28))+((s=a+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|s>>>21))+((s=i+(a^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^a^t)+r[6]+76029189&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^a)+r[9]+3654602809&4294967295)<<4&4294967295|s>>>28))+((s=a+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|s>>>21))+((s=i+(a^t^n)+r[15]+530742520&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^a^t)+r[2]+3299628645&4294967295)<<23&4294967295|s>>>9))+((s=t+(i^(n|~a))+r[0]+4096336452&4294967295)<<6&4294967295|s>>>26))+((s=a+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(a|~n))+r[14]+2878612391&4294967295)<<15&4294967295|s>>>17))+((s=n+(a^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|s>>>11))+((s=t+(i^(n|~a))+r[12]+1700485571&4294967295)<<6&4294967295|s>>>26))+((s=a+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(a|~n))+r[10]+4293915773&4294967295)<<15&4294967295|s>>>17))+((s=n+(a^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|s>>>11))+((s=t+(i^(n|~a))+r[8]+1873313359&4294967295)<<6&4294967295|s>>>26))+((s=a+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(a|~n))+r[6]+2734768916&4294967295)<<15&4294967295|s>>>17))+((s=n+(a^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|s>>>11))+((a=(t=n+((s=t+(i^(n|~a))+r[4]+4149444226&4294967295)<<6&4294967295|s>>>26))+((s=a+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|s>>>22))^((i=a+((s=i+(t^(a|~n))+r[2]+718787259&4294967295)<<15&4294967295|s>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(s<<21&4294967295|s>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+a&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var a=0|e[i];r&&a==t||(n[i]=a,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,a=this.h,s=0;s<t;){if(0==a)for(;s<=r;)n(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(i[a++]=e.charCodeAt(s++),a==this.blockSize){n(this,i),a=0;break}}else for(;s<t;)if(i[a++]=e[s++],a==this.blockSize){n(this,i),a=0;break}}this.h=a,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i={};function a(e){return-128<=e&&128>e?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new r([0|e],0>e?-1:0)}(e)}(e):new r([0|e],0>e?-1:0)}function s(e){if(isNaN(e)||!isFinite(e))return o;if(0>e)return d(s(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var o=a(0),l=a(1),u=a(16777216);function c(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(l)}function p(e,t){return e.add(d(t))}function f(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(c(t))throw Error("division by zero");if(c(e))return new m(o,o);if(h(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(h(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,r=t;0>=r.l(e);)n=y(n),r=y(r);var i=v(n,1),a=v(r,1);for(r=v(r,2),n=v(n,2);!c(r);){var u=a.add(r);0>=u.l(e)&&(i=i.add(n),a=u),r=v(r,1),n=v(n,1)}return t=p(e,i.j(t)),new m(i,t)}for(i=o;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(a=s(n)).j(t);h(u)||0<u.l(e);)u=(a=s(n-=r)).j(t);c(a)&&(a=l),i=i.add(a),e=p(e,u)}return new m(i,e)}function y(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function v(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,a=[],s=0;s<i;s++)a[s]=0<t?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new r(a,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(c(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=s(Math.pow(e,6)),n=this,r="";;){var i=g(n,t).g,a=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(c(n=i))return a+r;for(;6>a.length;)a="0"+a;r=a+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=p(this,e))?-1:c(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,a=0;a<=t;a++){var s=i+(65535&this.i(a))+(65535&e.i(a)),o=(s>>>16)+(this.i(a)>>>16)+(e.i(a)>>>16);i=o>>>16,s&=65535,o&=65535,n[a]=o<<16|s}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(c(this)||c(e))return o;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(u)&&0>e.l(u))return s(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var a=0;a<e.g.length;a++){var l=this.i(i)>>>16,p=65535&this.i(i),m=e.i(a)>>>16,g=65535&e.i(a);n[2*i+2*a]+=p*g,f(n,2*i+2*a),n[2*i+2*a+1]+=l*g,f(n,2*i+2*a+1),n[2*i+2*a+1]+=p*m,f(n,2*i+2*a+1),n[2*i+2*a+2]+=l*m,f(n,2*i+2*a+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,vo=wo.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=s,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=s(Math.pow(n,8)),i=o,a=0;a<t.length;a+=8){var l=Math.min(8,t.length-a),u=parseInt(t.substring(a,a+l),n);8>l?(l=s(Math.pow(n,l)),i=i.j(l).add(s(u))):i=(i=i.j(r)).add(s(u))}return i},yo=wo.Integer=r}).apply(void 0!==bo?bo:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var _o,ko,Ao,Po,To,Io,Eo,xo,Co="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},Oo={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Co&&Co];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var a=0;a<e.length-1;a++){var s=e[a];if(!(s in i))break e;i=i[s]}(r=r(a=i[e=e[e.length-1]]))!=a&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(0,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var r=r||{},i=this||self;function a(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function s(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function u(e,t,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?o:l).apply(null,arguments)}function c(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function p(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(a(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function f(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var y=!(-1==m().indexOf("Gecko")||-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge")||-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE")||-1!=m().indexOf("Edge"));function v(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function b(e){const t={};for(const n in e)t[n]=e[n];return t}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<w.length;t++)n=w[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function k(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function A(e){i.setTimeout((()=>{throw e}),0)}function P(){var e=C;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var T=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new I),(e=>e.reset()));class I{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let E,x=!1,C=new class{constructor(){this.h=this.g=null}add(e,t){const n=T.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},O=()=>{const e=i.Promise.resolve(void 0);E=()=>{e.then(S)}};var S=()=>{for(var e;e=P();){try{e.h.call(e.g)}catch(e){A(e)}var t=T;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}x=!1};function N(){this.s=this.s,this.C=this.C}function j(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.s=!1,N.prototype.ma=function(){this.s||(this.s=!0,this.N())},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},j.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(e){}return e}();function R(e,t){if(j.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{g(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:L[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&R.aa.h.call(this)}}h(R,j);var L={2:"touch",3:"pen",4:"mouse"};R.prototype.h=function(){R.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var M="closure_listenable_"+(1e6*Math.random()|0),$=0;function F(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++$,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function z(e){this.src=e,this.g={},this.h=0}function B(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=Array.prototype.indexOf.call(i,t,void 0);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(V(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function U(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.da&&a.listener==t&&a.capture==!!n&&a.ha==r)return i}return-1}z.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var s=U(e,t,r,i);return-1<s?(t=e[s],n||(t.fa=!1)):((t=new F(t,this.src,a,!!r,i)).fa=n,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),G={};function q(e,t,n,r,i){if(r&&r.once)return W(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)q(e,t[a],n,r,i);return null}return n=te(n),e&&e[M]?e.K(t,n,s(r)?!!r.capture:!!r,i):K(e,t,n,!1,r,i)}function K(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var o=s(i)?!!i.capture:!!i,l=Y(e);if(l||(e[H]=l=new z(e)),(n=l.add(t,n,r,o,a)).proxy)return n;if(r=function(){const e=X;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)D||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Q(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function W(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)W(e,t[a],n,r,i);return null}return n=te(n),e&&e[M]?e.L(t,n,s(r)?!!r.capture:!!r,i):K(e,t,n,!0,r,i)}function J(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)J(e,t[a],n,r,i);else r=s(r)?!!r.capture:!!r,n=te(n),e&&e[M]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=U(a=e.g[t],n,r,i))&&(V(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--))):e&&(e=Y(e))&&(t=e.g[t.toString()],e=-1,t&&(e=U(t,n,r,i)),(n=-1<e?t[e]:null)&&Z(n))}function Z(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[M])B(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Q(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Y(t))?(B(n,e),0==n.h&&(n.src=null,t[H]=null)):V(e)}}}function Q(e){return e in G?G[e]:G[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new R(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&Z(e),e=n.call(r,t)}return e}function Y(e){return(e=e[H])instanceof z?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"==typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){N.call(this),this.i=new z(this),this.M=this,this.F=null}function re(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new j(t,e);else if(t instanceof j)t.target=t.target||e;else{var i=t;_(t=new j(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var s=t.g=n[a];i=ie(s,r,!0,t)&&i}if(i=ie(s=t.g=e,r,!0,t)&&i,i=ie(s,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=ie(s=t.g=n[a],r,!1,t)&&i}function ie(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var s=t[a];if(s&&!s.da&&s.capture==n){var o=s.listener,l=s.ha||s.src;s.fa&&B(e.i,s),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function ae(e,t,n){if("function"==typeof e)n&&(e=u(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=u(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function se(e){e.g=ae((()=>{e.g=null,e.i&&(e.i=!1,se(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(ne,N),ne.prototype[M]=!0,ne.prototype.removeEventListener=function(e,t,n,r){J(this,e,t,n,r)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)V(n[r]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ne.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class oe extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:se(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function le(e){N.call(this),this.h=e,this.g={}}h(le,N);var ue=[];function ce(e){v(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Z(e)}),e),e.g={}}le.prototype.N=function(){le.aa.N.call(this),ce(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var he=i.JSON.stringify,de=i.JSON.parse,pe=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function fe(){}function me(e){return e.h||(e.h=e.i())}function ge(){}fe.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){j.call(this,"d")}function be(){j.call(this,"c")}h(ve,j),h(be,j);var we={},_e=null;function ke(){return _e=_e||new ne}function Ae(e){j.call(this,we.La,e)}function Pe(e){const t=ke();re(t,new Ae(t))}function Te(e,t){j.call(this,we.STAT_EVENT,e),this.stat=t}function Ie(e){const t=ke();re(t,new Te(t,e))}function Ee(e,t){j.call(this,we.Ma,e),this.size=t}function xe(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function Ce(){this.g=!0}function Oe(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var s=1;s<i.length;s++)i[s]=""}}}return he(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}we.La="serverreachability",h(Ae,j),we.STAT_EVENT="statevent",h(Te,j),we.Ma="timingevent",h(Ee,j),Ce.prototype.xa=function(){this.g=!1},Ce.prototype.info=function(){};var Se,Ne={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},je={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function De(){}function Re(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new le(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Le}function Le(){this.i=null,this.g="",this.h=!1}h(De,fe),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},Se=new De;var Me={},$e={};function Fe(e,t,n){e.L=1,e.v=ht(st(t)),e.m=n,e.P=!0,Ve(e,null)}function Ve(e,t){e.F=Date.now(),Ue(e),e.A=st(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Tt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Le,e.g=pn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new oe(u(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(ue[0]=i.toString()),i=ue);for(var a=0;a<i.length;a++){var s=q(n,i[a],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}t=e.H?b(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Pe(),function(e,t,n,r,i,a){e.info((function(){if(e.g)if(a)for(var s="",o=a.split("&"),l=0;l<o.length;l++){var u=o[l].split("=");if(1<u.length){var c=u[0];u=u[1];var h=c.split("_");s=2<=h.length&&"type"==h[1]?s+(c+"=")+u+"&":s+(c+"=redacted&")}}else s=null;else s=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+s}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function ze(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Be(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?$e:(n=Number(t.substring(n,r)),isNaN(n)?Me:(r+=1)+n>t.length?$e:(t=t.slice(r,r+n),e.C=r+n,t))}function Ue(e){e.S=Date.now()+e.I,He(e,e.I)}function He(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=xe(u(e.ba,e),t)}function Ge(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function qe(e){0==e.j.G||e.J||ln(e.j,e)}function Ke(e){Ge(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ce(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function We(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Ye(n.h,e)))if(!e.K&&Ye(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;on(n),Zt(n)}rn(n),Ie(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=xe(u(n.Za,n),6e3));if(1>=Xe(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else cn(n,11)}else if((e.K||n.g==e)&&on(n),!f(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const t=u[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const c=u[5];null!=c&&"number"==typeof c&&0<c&&(r=1.5*c,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var a=r.h;a.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(a.j=a.l,a.g=new Set,a.h&&(et(a,a.h),a.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,ct(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var s=e;if((r=n).qa=dn(r,r.J?r.ia:null,r.W),s.K){tt(r.h,s);var o=s,l=r.L;l&&(o.I=l),o.B&&(Ge(o),Ue(o)),r.g=s}else nn(r);0<n.i.length&&Xt(n)}else"stop"!=u[0]&&"close"!=u[0]||cn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?cn(n,7):Jt(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}Pe()}catch(e){}}Re.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Gt(e)?t.j():this.Y(e)},Re.prototype.Y=function(e){try{if(e==this.g)e:{const d=Gt(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||qt(this.g)))){this.J||4!=d||7==t||Pe(),Ge(this);var n=this.g.Z();this.X=n;t:if(ze(this)){var r=qt(this.g);e="";var a=r.length,s=4==Gt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ke(this),qe(this);var o="";break t}this.h.i=new i.TextDecoder}for(t=0;t<a;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==a-1)});r.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,a,s){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+s}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var l,u=this.g;if((l=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!f(l)){var c=l;break t}}c=null}if(!(n=c)){this.o=!1,this.s=3,Ie(12),Ke(this),qe(this);break e}Oe(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,We(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;){if(e=Be(this,o),e==$e){4==d&&(this.s=4,Ie(14),n=!1),Oe(this.i,this.l,null,"[Incomplete Response]");break}if(e==Me){this.s=4,Ie(15),Oe(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}Oe(this.i,this.l,e,null),We(this,e)}if(ze(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=o.length||this.h.h||(this.s=1,Ie(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),an(h),h.M=!0,Ie(11))}}else Oe(this.i,this.l,o,"[Invalid Chunked Response]"),Ke(this),qe(this)}else Oe(this.i,this.l,o,null),We(this,o);4==d&&Ke(this),this.o&&!this.J&&(4==d?ln(this.j,this):(this.o=!1,Ue(this)))}else(function(e){const t={};e=(e.g&&2<=Gt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(f(e[r]))continue;var n=k(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const a=t[i]||[];t[i]=a,a.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Ie(12)):(this.s=0,Ie(13)),Ke(this),qe(this)}}}catch(e){}},Re.prototype.cancel=function(){this.J=!0,Ke(this)},Re.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Pe(),Ie(17)),Ke(this),this.s=2,qe(this)):He(this,this.S-e)};var Je=class{constructor(e,t){this.g=e,this.map=t}};function Ze(e){this.l=e||10,e=i.PerformanceNavigationTiming?0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Xe(e){return e.h?1:e.g?e.g.size:0}function Ye(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function rt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(a(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(a(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(a(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}Ze.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var it=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function at(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof at){this.h=e.h,ot(this,e.j),this.o=e.o,this.g=e.g,lt(this,e.s),this.l=e.l;var t=e.i,n=new _t;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ut(this,n),this.m=e.m}else e&&(t=String(e).match(it))?(this.h=!1,ot(this,t[1]||"",!0),this.o=dt(t[2]||""),this.g=dt(t[3]||"",!0),lt(this,t[4]),this.l=dt(t[5]||"",!0),ut(this,t[6]||"",!0),this.m=dt(t[7]||"")):(this.h=!1,this.i=new _t(null,this.h))}function st(e){return new at(e)}function ot(e,t,n){e.j=n?dt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function lt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ut(e,t,n){t instanceof _t?(e.i=t,function(e,t){t&&!e.j&&(kt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(At(this,t),Tt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=pt(t,bt)),e.i=new _t(t,e.h))}function ct(e,t,n){e.i.set(t,n)}function ht(e){return ct(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function pt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ft),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ft(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}at.prototype.toString=function(){var e=[],t=this.j;t&&e.push(pt(t,gt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(pt(t,gt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(pt(n,"/"==n.charAt(0)?vt:yt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",pt(n,wt)),e.join("")};var mt,gt=/[#\/\?@]/g,yt=/[#\?:]/g,vt=/[#\?]/g,bt=/[#\?@]/g,wt=/#/g;function _t(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function kt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function At(e,t){kt(e),t=It(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Pt(e,t){return kt(e),t=It(e,t),e.g.has(t)}function Tt(e,t,n){At(e,t),0<n.length&&(e.i=null,e.g.set(It(e,t),d(n)),e.h+=n.length)}function It(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Et(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function xt(){this.g=new pe}function Ct(e,t,n){const r=n||"";try{rt(e,(function(e,n){let i=e;s(e)&&(i=he(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Ot(e){this.l=e.Ub||null,this.j=e.eb||!1}function St(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Nt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function jt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Dt(e)}function Dt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Rt(e){let t="";return v(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Lt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Rt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ct(e,t,n))}function Mt(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=_t.prototype).add=function(e,t){kt(this),this.i=null,e=It(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){kt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){kt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){kt(this);let t=[];if("string"==typeof e)Pt(this,e)&&(t=t.concat(this.g.get(It(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return kt(this),this.i=null,Pt(this,e=It(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const a=encodeURIComponent(String(r)),s=this.V(r);for(r=0;r<s.length;r++){var i=a;""!==s[r]&&(i+="="+encodeURIComponent(String(s[r]))),e.push(i)}}return this.i=e.join("&")},h(Ot,fe),Ot.prototype.g=function(){return new St(this.l,this.j)},Ot.prototype.i=(mt={},function(){return mt}),h(St,ne),(e=St.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Dt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Dt(this)),this.g&&(this.readyState=3,Dt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?jt(this):Dt(this),3==this.readyState&&Nt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,jt(this))},e.Qa=function(e){this.g&&(this.response=e,jt(this))},e.ga=function(){this.g&&jt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(St.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Mt,ne);var $t=/^https?$/i,Ft=["POST","PUT"];function Vt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,zt(e),Ut(e)}function zt(e){e.A||(e.A=!0,re(e,"complete"),re(e,"error"))}function Bt(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=Gt(e)||2!=e.Z()))if(e.u&&4==Gt(e))ae(e.Ea,0,e);else if(re(e,"readystatechange"),4==Gt(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var a;if(a=0===r){var s=String(e.D).match(it)[1]||null;!s&&i.self&&i.self.location&&(s=i.self.location.protocol.slice(0,-1)),a=!$t.test(s?s.toLowerCase():"")}n=a}if(n)re(e,"complete"),re(e,"success");else{e.m=6;try{var o=2<Gt(e)?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.Z()+"]",zt(e)}}finally{Ut(e)}}}function Ut(e,t){if(e.g){Ht(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||re(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Ht(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function Gt(e){return e.g?e.g.readyState:0}function qt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Kt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Wt(e){this.Aa=0,this.i=[],this.j=new Ce,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Kt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Kt("baseRetryDelayMs",5e3,e),this.cb=Kt("retryDelaySeedMs",1e4,e),this.Wa=Kt("forwardChannelMaxRetries",2,e),this.wa=Kt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Ze(e&&e.concurrentRequestLimit),this.Da=new xt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Jt(e){if(Qt(e),3==e.G){var t=e.U++,n=st(e.I);if(ct(n,"SID",e.K),ct(n,"RID",t),ct(n,"TYPE","terminate"),en(e,n),(t=new Re(e,e.j,t)).L=2,t.v=ht(st(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=pn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Ue(t)}hn(e)}function Zt(e){e.g&&(an(e),e.g.cancel(),e.g=null)}function Qt(e){Zt(e),e.u&&(i.clearTimeout(e.u),e.u=null),on(e),e.h.cancel(),e.s&&("number"==typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Xt(e){if(!Qe(e.h)&&!e.s){e.s=!0;var t=e.Ga;E||O(),x||(E(),x=!0),C.add(t,e),e.B=0}}function Yt(e,t){var n;n=t?t.l:e.U++;const r=st(e.I);ct(r,"SID",e.K),ct(r,"RID",n),ct(r,"AID",e.T),en(e,r),e.m&&e.o&&Lt(r,e.m,e.o),n=new Re(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),Fe(n,r,t)}function en(e,t){e.H&&v(e.H,(function(e,n){ct(t,n,e)})),e.l&&rt({},(function(e,n){ct(t,n,e)}))}function tn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?u(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const a=["count="+n];-1==t?0<n?(t=i[0].g,a.push("ofs="+t)):t=0:a.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const l=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{Ct(l,a,"req"+n+"_")}catch(e){r&&r(l)}}if(s){r=a.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function nn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;E||O(),x||(E(),x=!0),C.add(t,e),e.v=0}}function rn(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=xe(u(e.Fa,e),un(e,e.v)),e.v++,0))}function an(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function sn(e){e.g=new Re(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=st(e.qa);ct(t,"RID","rpc"),ct(t,"SID",e.K),ct(t,"AID",e.T),ct(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ct(t,"TO",e.ja),ct(t,"TYPE","xmlhttp"),en(e,t),e.m&&e.o&&Lt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ht(st(t)),n.m=null,n.P=!0,Ve(n,e)}function on(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function ln(e,t){var n=null;if(e.g==t){on(e),an(e),e.g=null;var r=2}else{if(!Ye(e.h,t))return;n=t.D,tt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;re(r=ke(),new Ee(r,n)),Xt(e)}else nn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(Xe(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=xe(u(e.Ga,e,t),un(e,e.B)),e.B++,0)))}(e,t)||2==r&&rn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:cn(e,5);break;case 4:cn(e,10);break;case 3:cn(e,6);break;default:cn(e,2)}}function un(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function cn(e,t){if(e.j.info("Error code "+t),2==t){var n=u(e.fb,e),r=e.Xa;const t=!r;r=new at(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ot(r,"https"),ht(r),t?function(e,t){const n=new Ce;if(i.Image){const r=new Image;r.onload=c(Et,n,"TestLoadImage: loaded",!0,t,r),r.onerror=c(Et,n,"TestLoadImage: error",!1,t,r),r.onabort=c(Et,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=c(Et,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ce;const n=new AbortController,r=setTimeout((()=>{n.abort(),Et(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?Et(0,0,!0,t):Et(0,0,!1,t)})).catch((()=>{clearTimeout(r),Et(0,0,!1,t)}))}(r.toString(),n)}else Ie(2);e.G=0,e.l&&e.l.sa(t),hn(e),Qt(e)}function hn(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(p(e.ka,t),p(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function dn(e,t,n){var r=n instanceof at?st(n):new at(n);if(""!=r.g)t&&(r.g=t+"."+r.g),lt(r,r.s);else{var a=i.location;r=a.protocol,t=t?t+"."+a.hostname:a.hostname,a=+a.port;var s=new at(null);r&&ot(s,r),t&&(s.g=t),a&&lt(s,a),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&ct(r,n,t),ct(r,"VER",e.la),en(e,r),r}function pn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Mt(new Ot({eb:n})):new Mt(e.pa)).Ha(e.J),t}function fn(){}function mn(){}function gn(e,t){ne.call(this),this.g=new Wt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!f(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!f(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new bn(this)}function yn(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function vn(){be.call(this),this.status=1}function bn(e){this.g=e}(e=Mt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Se.g(),this.v=this.o?me(this.o):me(Se),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Vt(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var a in r)n.set(a,r[a]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),a=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Ft,t,void 0))||r||a||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ht(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Vt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,re(this,"complete"),re(this,"abort"),Ut(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ut(this,!0)),Mt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Bt(this):this.bb())},e.bb=function(){Bt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Gt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),de(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Wt.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Ie(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=dn(this,null,this.W),Xt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Re(this,this.j,e);let a=this.o;if(this.S&&(a?(a=b(a),_(a,this.S)):a=this.S),null!==this.m||this.O||(i.H=a,a=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tn(this,i,t),ct(n=st(this.I),"RID",e),ct(n,"CVER",22),this.D&&ct(n,"X-HTTP-Session-Id",this.D),en(this,n),a&&(this.O?t="headers="+encodeURIComponent(String(Rt(a)))+"&"+t:this.m&&Lt(n,this.m,a)),et(this.h,i),this.Ua&&ct(n,"TYPE","init"),this.P?(ct(n,"$req",t),ct(n,"SID","null"),i.T=!0,Fe(i,n,null)):Fe(i,n,t),this.G=2}}else 3==this.G&&(e?Yt(this,e):0==this.i.length||Qe(this.h)||Yt(this))},e.Fa=function(){if(this.u=null,sn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=xe(u(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ie(10),Zt(this),sn(this))},e.Za=function(){null!=this.C&&(this.C=null,Zt(this),rn(this),Ie(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ie(2)):(this.j.info("Failed to ping google.com"),Ie(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=fn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},mn.prototype.g=function(e,t){return new gn(e,t)},h(gn,ne),gn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gn.prototype.close=function(){Jt(this.g)},gn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=he(e),e=n);t.i.push(new Je(t.Ya++,e)),3==t.G&&Xt(t)},gn.prototype.N=function(){this.g.l=null,delete this.j,Jt(this.g),delete this.g,gn.aa.N.call(this)},h(yn,ve),h(vn,be),h(bn,fn),bn.prototype.ua=function(){re(this.g,"a")},bn.prototype.ta=function(e){re(this.g,new yn(e))},bn.prototype.sa=function(e){re(this.g,new vn)},bn.prototype.ra=function(){re(this.g,"b")},mn.prototype.createWebChannel=mn.prototype.g,gn.prototype.send=gn.prototype.o,gn.prototype.open=gn.prototype.m,gn.prototype.close=gn.prototype.close,xo=Oo.createWebChannelTransport=function(){return new mn},Eo=Oo.getStatEventTarget=function(){return ke()},Io=Oo.Event=we,To=Oo.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ne.NO_ERROR=0,Ne.TIMEOUT=8,Ne.HTTP_ERROR=6,Po=Oo.ErrorCode=Ne,je.COMPLETE="complete",Ao=Oo.EventType=je,ge.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",ne.prototype.listen=ne.prototype.K,ko=Oo.WebChannel=ge,Oo.FetchXmlHttpFactory=Ot,Mt.prototype.listenOnce=Mt.prototype.L,Mt.prototype.getLastError=Mt.prototype.Ka,Mt.prototype.getLastErrorCode=Mt.prototype.Ba,Mt.prototype.getStatus=Mt.prototype.Z,Mt.prototype.getResponseJson=Mt.prototype.Oa,Mt.prototype.getResponseText=Mt.prototype.oa,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Ha,_o=Oo.XhrIo=Mt}).apply(void 0!==Co?Co:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const So="@firebase/firestore";class No{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}No.UNAUTHENTICATED=new No(null),No.GOOGLE_CREDENTIALS=new No("google-credentials-uid"),No.FIRST_PARTY=new No("first-party-uid"),No.MOCK_USER=new No("mock-user");let jo="10.14.0";const Do=new tr("@firebase/firestore");function Ro(){return Do.logLevel}function Lo(e,...t){if(Do.logLevel<=Zn.DEBUG){const n=t.map(Fo);Do.debug(`Firestore (${jo}): ${e}`,...n)}}function Mo(e,...t){if(Do.logLevel<=Zn.ERROR){const n=t.map(Fo);Do.error(`Firestore (${jo}): ${e}`,...n)}}function $o(e,...t){if(Do.logLevel<=Zn.WARN){const n=t.map(Fo);Do.warn(`Firestore (${jo}): ${e}`,...n)}}function Fo(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Vo(e="Unexpected state"){const t=`FIRESTORE (${jo}) INTERNAL ASSERTION FAILED: `+e;throw Mo(t),new Error(t)}function zo(e,t){e||Vo()}function Bo(e,t){return e}const Uo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ho extends Dn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Go{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class qo{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ko{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(No.UNAUTHENTICATED)))}shutdown(){}}class Wo{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Jo{constructor(e){this.t=e,this.currentUser=No.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){zo(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Go;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Go,e.enqueueRetryable((()=>r(this.currentUser)))};const a=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},s=e=>{Lo("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((e=>s(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?s(e):(Lo("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Go)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Lo("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(zo("string"==typeof t.accessToken),new qo(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return zo(null===e||"string"==typeof e),new No(e)}}class Zo{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=No.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Qo{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Zo(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(No.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Xo{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Yo{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){zo(void 0===this.o);const n=e=>{null!=e.error&&Lo("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,Lo("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Lo("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):Lo("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(zo("string"==typeof e.token),this.R=e.token,new Xo(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function el(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class tl{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=el(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function nl(e,t){return e<t?-1:e>t?1:0}function rl(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}class il{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ho(Uo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ho(Uo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ho(Uo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ho(Uo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return il.fromMillis(Date.now())}static fromDate(e){return il.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new il(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?nl(this.nanoseconds,e.nanoseconds):nl(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class al{constructor(e){this.timestamp=e}static fromTimestamp(e){return new al(e)}static min(){return new al(new il(0,0))}static max(){return new al(new il(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class sl{constructor(e,t,n){void 0===t?t=0:t>e.length&&Vo(),void 0===n?n=e.length-t:n>e.length-t&&Vo(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===sl.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof sl?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ol extends sl{construct(e,t,n){return new ol(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Ho(Uo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new ol(t)}static emptyPath(){return new ol([])}}const ll=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ul extends sl{construct(e,t,n){return new ul(e,t,n)}static isValidIdentifier(e){return ll.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ul.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ul(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Ho(Uo.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Ho(Uo.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Ho(Uo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(a=!a,r++):"."!==t||a?(n+=t,r++):(i(),r++)}if(i(),a)throw new Ho(Uo.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ul(t)}static emptyPath(){return new ul([])}}class cl{constructor(e){this.path=e}static fromPath(e){return new cl(ol.fromString(e))}static fromName(e){return new cl(ol.fromString(e).popFirst(5))}static empty(){return new cl(ol.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ol.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ol.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new cl(new ol(e.slice()))}}function hl(e){return new dl(e.readTime,e.key,-1)}class dl{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new dl(al.min(),cl.empty(),-1)}static max(){return new dl(al.max(),cl.empty(),-1)}}function pl(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=cl.comparator(e.documentKey,t.documentKey),0!==n?n:nl(e.largestBatchId,t.largestBatchId))}const fl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ml{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function gl(e){if(e.code!==Uo.FAILED_PRECONDITION||e.message!==fl)throw e;Lo("LocalStore","Unexpectedly lost primary lease")}class yl{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Vo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new yl(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof yl?t:yl.resolve(t)}catch(e){return yl.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):yl.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):yl.reject(t)}static resolve(e){return new yl(((t,n)=>{t(e)}))}static reject(e){return new yl(((t,n)=>{n(e)}))}static waitFor(e){return new yl(((t,n)=>{let r=0,i=0,a=!1;e.forEach((e=>{++r,e.next((()=>{++i,a&&i===r&&t()}),(e=>n(e)))})),a=!0,i===r&&t()}))}static or(e){let t=yl.resolve(!1);for(const n of e)t=t.next((e=>e?yl.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new yl(((n,r)=>{const i=e.length,a=new Array(i);let s=0;for(let o=0;o<i;o++){const l=o;t(e[l]).next((e=>{a[l]=e,++s,s===i&&n(a)}),(e=>r(e)))}}))}static doWhile(e,t){return new yl(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}function vl(e){return"IndexedDbTransactionError"===e.name}class bl{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function wl(e){return null==e}function _l(e){return 0===e&&1/e==-1/0}function kl(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Al(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Pl(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}bl.oe=-1;class Tl{constructor(e,t){this.comparator=e,this.root=t||El.EMPTY}insert(e,t){return new Tl(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,El.BLACK,null,null))}remove(e){return new Tl(this.comparator,this.root.remove(e,this.comparator).copy(null,null,El.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Il(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Il(this.root,e,this.comparator,!1)}getReverseIterator(){return new Il(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Il(this.root,e,this.comparator,!0)}}class Il{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class El{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:El.RED,this.left=null!=r?r:El.EMPTY,this.right=null!=i?i:El.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new El(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return El.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return El.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,El.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,El.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Vo();if(this.right.isRed())throw Vo();const e=this.left.check();if(e!==this.right.check())throw Vo();return e+(this.isRed()?0:1)}}El.EMPTY=null,El.RED=!0,El.BLACK=!1,El.EMPTY=new class{constructor(){this.size=0}get key(){throw Vo()}get value(){throw Vo()}get color(){throw Vo()}get left(){throw Vo()}get right(){throw Vo()}copy(e,t,n,r,i){return this}insert(e,t,n){return new El(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class xl{constructor(e){this.comparator=e,this.data=new Tl(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Cl(this.data.getIterator())}getIteratorFrom(e){return new Cl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof xl))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new xl(this.comparator);return t.data=e,t}}class Cl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ol{constructor(e){this.fields=e,e.sort(ul.comparator)}static empty(){return new Ol([])}unionWith(e){let t=new xl(ul.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ol(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rl(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Sl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Nl{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Sl("Invalid base64 string: "+e):e}}(e);return new Nl(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Nl(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return nl(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Nl.EMPTY_BYTE_STRING=new Nl("");const jl=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Dl(e){if(zo(!!e),"string"==typeof e){let t=0;const n=jl.exec(e);if(zo(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Rl(e.seconds),nanos:Rl(e.nanos)}}function Rl(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ll(e){return"string"==typeof e?Nl.fromBase64String(e):Nl.fromUint8Array(e)}function Ml(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function $l(e){const t=e.mapValue.fields.__previous_value__;return Ml(t)?$l(t):t}function Fl(e){const t=Dl(e.mapValue.fields.__local_write_time__.timestampValue);return new il(t.seconds,t.nanos)}class Vl{constructor(e,t,n,r,i,a,s,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=s,this.longPollingOptions=o,this.useFetchStreams=l}}class zl{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new zl("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof zl&&e.projectId===this.projectId&&e.database===this.database}}const Bl={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ul(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ml(e)?4:iu(e)?9007199254740991:nu(e)?10:11:Vo()}function Hl(e,t){if(e===t)return!0;const n=Ul(e);if(n!==Ul(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Fl(e).isEqual(Fl(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Dl(e.timestampValue),r=Dl(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ll(e.bytesValue).isEqual(Ll(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Rl(e.geoPointValue.latitude)===Rl(t.geoPointValue.latitude)&&Rl(e.geoPointValue.longitude)===Rl(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Rl(e.integerValue)===Rl(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Rl(e.doubleValue),r=Rl(t.doubleValue);return n===r?_l(n)===_l(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return rl(e.arrayValue.values||[],t.arrayValue.values||[],Hl);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(kl(n)!==kl(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Hl(n[e],r[e])))return!1;return!0}(e,t);default:return Vo()}}function Gl(e,t){return void 0!==(e.values||[]).find((e=>Hl(e,t)))}function ql(e,t){if(e===t)return 0;const n=Ul(e),r=Ul(t);if(n!==r)return nl(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return nl(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Rl(e.integerValue||e.doubleValue),r=Rl(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Kl(e.timestampValue,t.timestampValue);case 4:return Kl(Fl(e),Fl(t));case 5:return nl(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ll(e),r=Ll(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=nl(n[e],r[e]);if(0!==t)return t}return nl(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=nl(Rl(e.latitude),Rl(t.latitude));return 0!==n?n:nl(Rl(e.longitude),Rl(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Wl(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,a;const s=e.fields||{},o=t.fields||{},l=null===(n=s.value)||void 0===n?void 0:n.arrayValue,u=null===(r=o.value)||void 0===r?void 0:r.arrayValue,c=nl((null===(i=null==l?void 0:l.values)||void 0===i?void 0:i.length)||0,(null===(a=null==u?void 0:u.values)||void 0===a?void 0:a.length)||0);return 0!==c?c:Wl(l,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Bl.mapValue&&t===Bl.mapValue)return 0;if(e===Bl.mapValue)return 1;if(t===Bl.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(let e=0;e<r.length&&e<a.length;++e){const t=nl(r[e],a[e]);if(0!==t)return t;const s=ql(n[r[e]],i[a[e]]);if(0!==s)return s}return nl(r.length,a.length)}(e.mapValue,t.mapValue);default:throw Vo()}}function Kl(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return nl(e,t);const n=Dl(e),r=Dl(t),i=nl(n.seconds,r.seconds);return 0!==i?i:nl(n.nanos,r.nanos)}function Wl(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=ql(n[e],r[e]);if(t)return t}return nl(n.length,r.length)}function Jl(e){return Zl(e)}function Zl(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Dl(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Ll(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return cl.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Zl(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Zl(e.fields[i])}`;return n+"}"}(e.mapValue):Vo()}function Ql(e){return!!e&&"integerValue"in e}function Xl(e){return!!e&&"arrayValue"in e}function Yl(e){return!!e&&"nullValue"in e}function eu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function tu(e){return!!e&&"mapValue"in e}function nu(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ru(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Al(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=ru(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ru(e.arrayValue.values[n]);return t}return Object.assign({},e)}function iu(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class au{constructor(e){this.value=e}static empty(){return new au({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!tu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ru(t)}setAll(e){let t=ul.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=ru(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());tu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Hl(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];tu(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Al(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new au(ru(this.value))}}function su(e){const t=[];return Al(e.fields,((e,n)=>{const r=new ul([e]);if(tu(n)){const e=su(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Ol(t)}class ou{constructor(e,t,n,r,i,a,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=a,this.documentState=s}static newInvalidDocument(e){return new ou(e,0,al.min(),al.min(),al.min(),au.empty(),0)}static newFoundDocument(e,t,n,r){return new ou(e,1,t,al.min(),n,r,0)}static newNoDocument(e,t){return new ou(e,2,t,al.min(),al.min(),au.empty(),0)}static newUnknownDocument(e,t){return new ou(e,3,t,al.min(),al.min(),au.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(al.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=au.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=au.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=al.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ou&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ou(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class lu{constructor(e,t){this.position=e,this.inclusive=t}}function uu(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const a=t[i],s=e.position[i];if(r=a.field.isKeyField()?cl.comparator(cl.fromName(s.referenceValue),n.key):ql(s,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function cu(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Hl(e.position[n],t.position[n]))return!1;return!0}class hu{constructor(e,t="asc"){this.field=e,this.dir=t}}function du(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class pu{}class fu extends pu{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new _u(e,t,n):"array-contains"===t?new Tu(e,n):"in"===t?new Iu(e,n):"not-in"===t?new Eu(e,n):"array-contains-any"===t?new xu(e,n):new fu(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ku(e,n):new Au(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(ql(t,this.value)):null!==t&&Ul(this.value)===Ul(t)&&this.matchesComparison(ql(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Vo()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class mu extends pu{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new mu(e,t)}matches(e){return gu(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function gu(e){return"and"===e.op}function yu(e){return function(e){for(const t of e.filters)if(t instanceof mu)return!1;return!0}(e)&&gu(e)}function vu(e){if(e instanceof fu)return e.field.canonicalString()+e.op.toString()+Jl(e.value);if(yu(e))return e.filters.map((e=>vu(e))).join(",");{const t=e.filters.map((e=>vu(e))).join(",");return`${e.op}(${t})`}}function bu(e,t){return e instanceof fu?function(e,t){return t instanceof fu&&e.op===t.op&&e.field.isEqual(t.field)&&Hl(e.value,t.value)}(e,t):e instanceof mu?function(e,t){return t instanceof mu&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&bu(n,t.filters[r])),!0)}(e,t):void Vo()}function wu(e){return e instanceof fu?function(e){return`${e.field.canonicalString()} ${e.op} ${Jl(e.value)}`}(e):e instanceof mu?function(e){return e.op.toString()+" {"+e.getFilters().map(wu).join(" ,")+"}"}(e):"Filter"}class _u extends fu{constructor(e,t,n){super(e,t,n),this.key=cl.fromName(n.referenceValue)}matches(e){const t=cl.comparator(e.key,this.key);return this.matchesComparison(t)}}class ku extends fu{constructor(e,t){super(e,"in",t),this.keys=Pu(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Au extends fu{constructor(e,t){super(e,"not-in",t),this.keys=Pu(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Pu(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>cl.fromName(e.referenceValue)))}class Tu extends fu{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Xl(t)&&Gl(t.arrayValue,this.value)}}class Iu extends fu{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Gl(this.value.arrayValue,t)}}class Eu extends fu{constructor(e,t){super(e,"not-in",t)}matches(e){if(Gl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Gl(this.value.arrayValue,t)}}class xu extends fu{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Xl(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Gl(this.value.arrayValue,e)))}}class Cu{constructor(e,t=null,n=[],r=[],i=null,a=null,s=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=a,this.endAt=s,this.ue=null}}function Ou(e,t=null,n=[],r=[],i=null,a=null,s=null){return new Cu(e,t,n,r,i,a,s)}function Su(e){const t=Bo(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>vu(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),wl(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Jl(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Jl(e))).join(",")),t.ue=e}return t.ue}function Nu(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!du(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!bu(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!cu(e.startAt,t.startAt)&&cu(e.endAt,t.endAt)}function ju(e){return cl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Du{constructor(e,t=null,n=[],r=[],i=null,a="F",s=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=a,this.startAt=s,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ru(e){return new Du(e)}function Lu(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Mu(e){const t=Bo(e);if(null===t.ce){t.ce=[];const e=new Set;for(const n of t.explicitOrderBy)t.ce.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new xl(ul.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new hu(r,n))})),e.has(ul.keyField().canonicalString())||t.ce.push(new hu(ul.keyField(),n))}return t.ce}function $u(e){const t=Bo(e);return t.le||(t.le=function(e,t){if("F"===e.limitType)return Ou(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new hu(e.field,t)}));const n=e.endAt?new lu(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new lu(e.startAt.position,e.startAt.inclusive):null;return Ou(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,Mu(e))),t.le}function Fu(e,t,n){return new Du(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Vu(e,t){return Nu($u(e),$u(t))&&e.limitType===t.limitType}function zu(e){return`${Su($u(e))}|lt:${e.limitType}`}function Bu(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>wu(e))).join(", ")}]`),wl(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Jl(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Jl(e))).join(",")),`Target(${t})`}($u(e))}; limitType=${e.limitType})`}function Uu(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):cl.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Mu(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=uu(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Mu(e),t)||e.endAt&&!function(e,t,n){const r=uu(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Mu(e),t))}(e,t)}function Hu(e){return(t,n)=>{let r=!1;for(const i of Mu(e)){const e=Gu(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Gu(e,t,n){const r=e.field.isKeyField()?cl.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?ql(r,i):Vo()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Vo()}}class qu{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Al(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Pl(this.inner)}size(){return this.innerSize}}const Ku=new Tl(cl.comparator);function Wu(){return Ku}const Ju=new Tl(cl.comparator);function Zu(...e){let t=Ju;for(const n of e)t=t.insert(n.key,n);return t}function Qu(e){let t=Ju;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Xu(){return ec()}function Yu(){return ec()}function ec(){return new qu((e=>e.toString()),((e,t)=>e.isEqual(t)))}const tc=new Tl(cl.comparator),nc=new xl(cl.comparator);function rc(...e){let t=nc;for(const n of e)t=t.add(n);return t}const ic=new xl(nl);function ac(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_l(t)?"-0":t}}function sc(e){return{integerValue:""+e}}class oc{constructor(){this._=void 0}}function lc(e,t,n){return e instanceof hc?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Ml(t)&&(t=$l(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof dc?pc(e,t):e instanceof fc?mc(e,t):function(e,t){const n=cc(e,t),r=yc(n)+yc(e.Pe);return Ql(n)&&Ql(e.Pe)?sc(r):ac(e.serializer,r)}(e,t)}function uc(e,t,n){return e instanceof dc?pc(e,t):e instanceof fc?mc(e,t):n}function cc(e,t){return e instanceof gc?function(e){return Ql(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class hc extends oc{}class dc extends oc{constructor(e){super(),this.elements=e}}function pc(e,t){const n=vc(t);for(const t of e.elements)n.some((e=>Hl(e,t)))||n.push(t);return{arrayValue:{values:n}}}class fc extends oc{constructor(e){super(),this.elements=e}}function mc(e,t){let n=vc(t);for(const t of e.elements)n=n.filter((e=>!Hl(e,t)));return{arrayValue:{values:n}}}class gc extends oc{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function yc(e){return Rl(e.integerValue||e.doubleValue)}function vc(e){return Xl(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class bc{constructor(e,t){this.version=e,this.transformResults=t}}class wc{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new wc}static exists(e){return new wc(void 0,e)}static updateTime(e){return new wc(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function _c(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class kc{}function Ac(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new jc(e.key,wc.none()):new xc(e.key,e.data,wc.none());{const n=e.data,r=au.empty();let i=new xl(ul.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Cc(e.key,r,new Ol(i.toArray()),wc.none())}}function Pc(e,t,n){e instanceof xc?function(e,t,n){const r=e.value.clone(),i=Sc(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Cc?function(e,t,n){if(!_c(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Sc(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Oc(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Tc(e,t,n,r){return e instanceof xc?function(e,t,n,r){if(!_c(e.precondition,t))return n;const i=e.value.clone(),a=Nc(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Cc?function(e,t,n,r){if(!_c(e.precondition,t))return n;const i=Nc(e.fieldTransforms,r,t),a=t.data;return a.setAll(Oc(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return _c(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Ic(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=cc(r.transform,e||null);null!=i&&(null===n&&(n=au.empty()),n.set(r.field,i))}return n||null}function Ec(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&rl(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof dc&&t instanceof dc||e instanceof fc&&t instanceof fc?rl(e.elements,t.elements,Hl):e instanceof gc&&t instanceof gc?Hl(e.Pe,t.Pe):e instanceof hc&&t instanceof hc}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class xc extends kc{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Cc extends kc{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Oc(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Sc(e,t,n){const r=new Map;zo(e.length===n.length);for(let i=0;i<n.length;i++){const a=e[i],s=a.transform,o=t.data.field(a.field);r.set(a.field,uc(s,o,n[i]))}return r}function Nc(e,t,n){const r=new Map;for(const i of e){const e=i.transform,a=n.data.field(i.field);r.set(i.field,lc(e,a,t))}return r}class jc extends kc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Dc extends kc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Rc{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Pc(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Tc(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Tc(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Yu();return this.mutations.forEach((r=>{const i=e.get(r.key),a=i.overlayedDocument;let s=this.applyToLocalView(a,i.mutatedFields);s=t.has(r.key)?null:s;const o=Ac(a,s);null!==o&&n.set(r.key,o),a.isValidDocument()||a.convertToNoDocument(al.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),rc())}isEqual(e){return this.batchId===e.batchId&&rl(this.mutations,e.mutations,((e,t)=>Ec(e,t)))&&rl(this.baseMutations,e.baseMutations,((e,t)=>Ec(e,t)))}}class Lc{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){zo(e.mutations.length===n.length);let r=tc;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Lc(e,t,n,r)}}class Mc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class $c{constructor(e,t){this.count=e,this.unchangedNames=t}}var Fc,Vc;function zc(e){if(void 0===e)return Mo("GRPC error has no .code"),Uo.UNKNOWN;switch(e){case Fc.OK:return Uo.OK;case Fc.CANCELLED:return Uo.CANCELLED;case Fc.UNKNOWN:return Uo.UNKNOWN;case Fc.DEADLINE_EXCEEDED:return Uo.DEADLINE_EXCEEDED;case Fc.RESOURCE_EXHAUSTED:return Uo.RESOURCE_EXHAUSTED;case Fc.INTERNAL:return Uo.INTERNAL;case Fc.UNAVAILABLE:return Uo.UNAVAILABLE;case Fc.UNAUTHENTICATED:return Uo.UNAUTHENTICATED;case Fc.INVALID_ARGUMENT:return Uo.INVALID_ARGUMENT;case Fc.NOT_FOUND:return Uo.NOT_FOUND;case Fc.ALREADY_EXISTS:return Uo.ALREADY_EXISTS;case Fc.PERMISSION_DENIED:return Uo.PERMISSION_DENIED;case Fc.FAILED_PRECONDITION:return Uo.FAILED_PRECONDITION;case Fc.ABORTED:return Uo.ABORTED;case Fc.OUT_OF_RANGE:return Uo.OUT_OF_RANGE;case Fc.UNIMPLEMENTED:return Uo.UNIMPLEMENTED;case Fc.DATA_LOSS:return Uo.DATA_LOSS;default:return Vo()}}(Vc=Fc||(Fc={}))[Vc.OK=0]="OK",Vc[Vc.CANCELLED=1]="CANCELLED",Vc[Vc.UNKNOWN=2]="UNKNOWN",Vc[Vc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vc[Vc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vc[Vc.NOT_FOUND=5]="NOT_FOUND",Vc[Vc.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vc[Vc.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vc[Vc.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vc[Vc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vc[Vc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vc[Vc.ABORTED=10]="ABORTED",Vc[Vc.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vc[Vc.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vc[Vc.INTERNAL=13]="INTERNAL",Vc[Vc.UNAVAILABLE=14]="UNAVAILABLE",Vc[Vc.DATA_LOSS=15]="DATA_LOSS";const Bc=new yo([4294967295,4294967295],0);function Uc(e){const t=(new TextEncoder).encode(e),n=new vo;return n.update(t),new Uint8Array(n.digest())}function Hc(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new yo([n,r],0),new yo([i,a],0)]}class Gc{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new qc(`Invalid padding: ${t}`);if(n<0)throw new qc(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new qc(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new qc(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=yo.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(yo.fromNumber(n)));return 1===r.compare(Bc)&&(r=new yo([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Uc(e),[n,r]=Hc(t);for(let e=0;e<this.hashCount;e++){const t=this.Ee(n,r,e);if(!this.de(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Gc(i,r,t);return n.forEach((e=>a.insert(e))),a}insert(e){if(0===this.Ie)return;const t=Uc(e),[n,r]=Hc(t);for(let e=0;e<this.hashCount;e++){const t=this.Ee(n,r,e);this.Ae(t)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class qc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Kc{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Wc.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Kc(al.min(),r,new Tl(nl),Wu(),rc())}}class Wc{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Wc(n,t,rc(),rc(),rc())}}class Jc{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class Zc{constructor(e,t){this.targetId=e,this.me=t}}class Qc{constructor(e,t,n=Nl.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Xc{constructor(){this.fe=0,this.ge=th(),this.pe=Nl.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=rc(),t=rc(),n=rc();return this.ge.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Vo()}})),new Wc(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=th()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,zo(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Yc{constructor(e){this.Le=e,this.Be=new Map,this.ke=Wu(),this.qe=eh(),this.Qe=new Tl(nl)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Vo()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((e,n)=>{this.ze(n)&&t(n)}))}He(e){const t=e.targetId,n=e.me.count,r=this.Je(t);if(r){const i=r.target;if(ju(i))if(0===n){const e=new cl(i.path);this.Ue(t,e,ou.newNoDocument(e,al.min()))}else zo(1===n);else{const r=this.Ye(t);if(r!==n){const n=this.Ze(e),i=n?this.Xe(n,e,r):1;if(0!==i){this.je(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let a,s;try{a=Ll(n).toUint8Array()}catch(e){if(e instanceof Sl)return $o("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{s=new Gc(a,r,i)}catch(e){return $o(e instanceof qc?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===s.Ie?null:s}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Le.tt(),a=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,n,null),r++)})),r}rt(e){const t=new Map;this.Be.forEach(((n,r)=>{const i=this.Je(r);if(i){if(n.current&&ju(i.target)){const t=new cl(i.target.path);null!==this.ke.get(t)||this.it(r,t)||this.Ue(r,t,ou.newNoDocument(t,e))}n.be&&(t.set(r,n.ve()),n.Ce())}}));let n=rc();this.qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.ke.forEach(((t,n)=>n.setReadTime(e)));const r=new Kc(e,t,this.Qe,this.ke,n);return this.ke=Wu(),this.qe=eh(),this.Qe=new Tl(nl),r}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Xc,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new xl(nl),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||Lo("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Xc),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function eh(){return new Tl(cl.comparator)}function th(){return new Tl(cl.comparator)}const nh={asc:"ASCENDING",desc:"DESCENDING"},rh={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ih={and:"AND",or:"OR"};class ah{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function sh(e,t){return e.useProto3Json||wl(t)?t:{value:t}}function oh(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function lh(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function uh(e,t){return oh(e,t.toTimestamp())}function ch(e){return zo(!!e),al.fromTimestamp(function(e){const t=Dl(e);return new il(t.seconds,t.nanos)}(e))}function hh(e,t){return dh(e,t).canonicalString()}function dh(e,t){const n=function(e){return new ol(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function ph(e){const t=ol.fromString(e);return zo(Sh(t)),t}function fh(e,t){return hh(e.databaseId,t.path)}function mh(e,t){const n=ph(t);if(n.get(1)!==e.databaseId.projectId)throw new Ho(Uo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Ho(Uo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new cl(vh(n))}function gh(e,t){return hh(e.databaseId,t)}function yh(e){return new ol(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function vh(e){return zo(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function bh(e,t,n){return{name:fh(e,t),fields:n.value.mapValue.fields}}function wh(e,t){return{documents:[gh(e,t.path)]}}function _h(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=gh(e,i);const a=function(e){if(0!==e.length)return Ch(mu.create(e,"and"))}(t.filters);a&&(n.structuredQuery.where=a);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Eh(e.field),direction:Ph(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=sh(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:i}}function kh(e){let t=function(e){const t=ph(e);return 4===t.length?ol.emptyPath():vh(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){zo(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let a=[];n.where&&(a=function(e){const t=Ah(e);return t instanceof mu&&yu(t)?t.getFilters():[t]}(n.where));let s=[];n.orderBy&&(s=function(e){return e.map((e=>function(e){return new hu(xh(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,wl(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new lu(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new lu(n,t)}(n.endAt)),function(e,t,n,r,i,a,s,o){return new Du(e,t,n,r,i,"F",s,o)}(t,i,s,a,o,0,l,u)}function Ah(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=xh(e.unaryFilter.field);return fu.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=xh(e.unaryFilter.field);return fu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=xh(e.unaryFilter.field);return fu.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=xh(e.unaryFilter.field);return fu.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Vo()}}(e):void 0!==e.fieldFilter?function(e){return fu.create(xh(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Vo()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return mu.create(e.compositeFilter.filters.map((e=>Ah(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Vo()}}(e.compositeFilter.op))}(e):Vo()}function Ph(e){return nh[e]}function Th(e){return rh[e]}function Ih(e){return ih[e]}function Eh(e){return{fieldPath:e.canonicalString()}}function xh(e){return ul.fromServerFormat(e.fieldPath)}function Ch(e){return e instanceof fu?function(e){if("=="===e.op){if(eu(e.value))return{unaryFilter:{field:Eh(e.field),op:"IS_NAN"}};if(Yl(e.value))return{unaryFilter:{field:Eh(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(eu(e.value))return{unaryFilter:{field:Eh(e.field),op:"IS_NOT_NAN"}};if(Yl(e.value))return{unaryFilter:{field:Eh(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Eh(e.field),op:Th(e.op),value:e.value}}}(e):e instanceof mu?function(e){const t=e.getFilters().map((e=>Ch(e)));return 1===t.length?t[0]:{compositeFilter:{op:Ih(e.op),filters:t}}}(e):Vo()}function Oh(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Sh(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Nh{constructor(e,t,n,r,i=al.min(),a=al.min(),s=Nl.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=s,this.expectedCount=o}withSequenceNumber(e){return new Nh(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Nh(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Nh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Nh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class jh{constructor(e){this.ct=e}}function Dh(e){const t=kh({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Fu(t,t.limit,"L"):t}class Rh{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Rl(e.integerValue));else if("doubleValue"in e){const n=Rl(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),_l(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Dl(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Ll(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?iu(e)?this.dt(t,Number.MAX_SAFE_INTEGER):nu(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Vo()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const e of Object.keys(n))this.Vt(e,t),this.Tt(n[e],t)}wt(e,t){var n,r;const i=e.fields||{};this.dt(t,53);const a="value",s=(null===(r=null===(n=i[a].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.dt(t,15),t.At(Rl(s)),this.Vt(a,t),this.Tt(i[a],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const e of n)this.Tt(e,t)}yt(e,t){this.dt(t,37),cl.fromName(e).path.forEach((e=>{this.dt(t,60),this.Dt(e,t)}))}dt(e,t){e.At(t)}ft(e){e.At(2)}}Rh.vt=new Rh;class Lh{constructor(){this.un=new Mh}addToCollectionParentIndex(e,t){return this.un.add(t),yl.resolve()}getCollectionParents(e,t){return yl.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return yl.resolve()}deleteFieldIndex(e,t){return yl.resolve()}deleteAllFieldIndexes(e){return yl.resolve()}createTargetIndexes(e,t){return yl.resolve()}getDocumentsMatchingTarget(e,t){return yl.resolve(null)}getIndexType(e,t){return yl.resolve(0)}getFieldIndexes(e,t){return yl.resolve([])}getNextCollectionGroupToUpdate(e){return yl.resolve(null)}getMinOffset(e,t){return yl.resolve(dl.min())}getMinOffsetFromCollectionGroup(e,t){return yl.resolve(dl.min())}updateCollectionGroup(e,t,n){return yl.resolve()}updateIndexEntries(e,t){return yl.resolve()}}class Mh{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new xl(ol.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new xl(ol.comparator)).toArray()}}new Uint8Array(0);class $h{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new $h(e,$h.DEFAULT_COLLECTION_PERCENTILE,$h.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}$h.DEFAULT_COLLECTION_PERCENTILE=10,$h.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$h.DEFAULT=new $h(41943040,$h.DEFAULT_COLLECTION_PERCENTILE,$h.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$h.DISABLED=new $h(-1,0,0);class Fh{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Fh(0)}static kn(){return new Fh(-1)}}class Vh{constructor(){this.changes=new qu((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ou.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?yl.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zh{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Bh{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Tc(n.mutation,e,Ol.empty(),il.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,rc()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=rc()){const r=Xu();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Zu();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Xu();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,rc())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Wu();const a=ec(),s=ec();return t.forEach(((e,t)=>{const s=n.get(t.key);r.has(t.key)&&(void 0===s||s.mutation instanceof Cc)?i=i.insert(t.key,t):void 0!==s?(a.set(t.key,s.mutation.getFieldMask()),Tc(s.mutation,t,s.mutation.getFieldMask(),il.now())):a.set(t.key,Ol.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>a.set(e,t))),t.forEach(((e,t)=>{var n;return s.set(e,new zh(t,null!==(n=a.get(e))&&void 0!==n?n:null))})),s)))}recalculateAndSaveOverlays(e,t){const n=ec();let r=new Tl(((e,t)=>e-t)),i=rc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const a=t.get(e);if(null===a)return;let s=n.get(e)||Ol.empty();s=i.applyToLocalView(a,s),n.set(e,s);const o=(r.get(i.batchId)||rc()).add(e);r=r.insert(i.batchId,o)}))})).next((()=>{const a=[],s=r.getReverseIterator();for(;s.hasNext();){const r=s.getNext(),o=r.key,l=r.value,u=Yu();l.forEach((e=>{if(!i.has(e)){const r=Ac(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),a.push(this.documentOverlayCache.saveOverlays(e,o,u))}return yl.waitFor(a)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return cl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const a=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):yl.resolve(Xu());let s=-1,o=i;return a.next((t=>yl.forEach(t,((t,n)=>(s<n.largestBatchId&&(s=n.largestBatchId),i.get(t)?yl.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{o=o.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,o,t,rc()))).next((e=>({batchId:s,changes:Qu(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new cl(t)).next((e=>{let t=Zu();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let a=Zu();return this.indexManager.getCollectionParents(e,i).next((s=>yl.forEach(s,(s=>{const o=function(e,t){return new Du(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next((e=>{e.forEach(((e,t)=>{a=a.insert(e,t)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,ou.newInvalidDocument(r)))}));let n=Zu();return e.forEach(((e,r)=>{const a=i.get(e);void 0!==a&&Tc(a.mutation,r,Ol.empty(),il.now()),Uu(t,r)&&(n=n.insert(e,r))})),n}))}}class Uh{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return yl.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:ch(e.createTime)}}(t)),yl.resolve()}getNamedQuery(e,t){return yl.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(e){return{name:e.name,query:Dh(e.bundledQuery),readTime:ch(e.readTime)}}(t)),yl.resolve()}}class Hh{constructor(){this.overlays=new Tl(cl.comparator),this.Ir=new Map}getOverlay(e,t){return yl.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Xu();return yl.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),yl.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Ir.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Ir.delete(n)),yl.resolve()}getOverlaysForCollection(e,t,n){const r=Xu(),i=t.length+1,a=new cl(t.child("")),s=this.overlays.getIteratorFrom(a);for(;s.hasNext();){const e=s.getNext().value,a=e.getKey();if(!t.isPrefixOf(a.path))break;a.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return yl.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Tl(((e,t)=>e-t));const a=this.overlays.getIterator();for(;a.hasNext();){const e=a.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Xu(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const s=Xu(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach(((e,t)=>s.set(e,t))),!(s.size()>=r)););return yl.resolve(s)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Mc(t,n));let i=this.Ir.get(t);void 0===i&&(i=rc(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}class Gh{constructor(){this.sessionToken=Nl.EMPTY_BYTE_STRING}getSessionToken(e){return yl.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,yl.resolve()}}class qh{constructor(){this.Tr=new xl(Kh.Er),this.dr=new xl(Kh.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Kh(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Vr(new Kh(e,t))}mr(e,t){e.forEach((e=>this.removeReference(e,t)))}gr(e){const t=new cl(new ol([])),n=new Kh(t,e),r=new Kh(t,e+1),i=[];return this.dr.forEachInRange([n,r],(e=>{this.Vr(e),i.push(e.key)})),i}pr(){this.Tr.forEach((e=>this.Vr(e)))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new cl(new ol([])),n=new Kh(t,e),r=new Kh(t,e+1);let i=rc();return this.dr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Kh(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Kh{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return cl.comparator(e.key,t.key)||nl(e.wr,t.wr)}static Ar(e,t){return nl(e.wr,t.wr)||cl.comparator(e.key,t.key)}}class Wh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new xl(Kh.Er)}checkEmpty(e){return yl.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Rc(i,t,n,r);this.mutationQueue.push(a);for(const t of r)this.br=this.br.add(new Kh(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return yl.resolve(a)}lookupMutationBatch(e,t){return yl.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.vr(n),i=r<0?0:r;return yl.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return yl.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return yl.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Kh(t,0),r=new Kh(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,r],(e=>{const t=this.Dr(e.wr);i.push(t)})),yl.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new xl(nl);return t.forEach((e=>{const t=new Kh(e,0),r=new Kh(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,r],(e=>{n=n.add(e.wr)}))})),yl.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;cl.isDocumentKey(i)||(i=i.child(""));const a=new Kh(new cl(i),0);let s=new xl(nl);return this.br.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e.wr)),!0)}),a),yl.resolve(this.Cr(s))}Cr(e){const t=[];return e.forEach((e=>{const n=this.Dr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){zo(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return yl.forEach(t.mutations,(r=>{const i=new Kh(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.br=n}))}On(e){}containsKey(e,t){const n=new Kh(t,0),r=this.br.firstAfterOrEqual(n);return yl.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,yl.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Jh{constructor(e){this.Mr=e,this.docs=new Tl(cl.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return yl.resolve(n?n.document.mutableCopy():ou.newInvalidDocument(t))}getEntries(e,t){let n=Wu();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ou.newInvalidDocument(e))})),yl.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Wu();const a=t.path,s=new cl(a.child("")),o=this.docs.getIteratorFrom(s);for(;o.hasNext();){const{key:e,value:{document:s}}=o.getNext();if(!a.isPrefixOf(e.path))break;e.path.length>a.length+1||pl(hl(s),n)<=0||(r.has(s.key)||Uu(t,s))&&(i=i.insert(s.key,s.mutableCopy()))}return yl.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Vo()}Or(e,t){return yl.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Zh(this)}getSize(e){return yl.resolve(this.size)}}class Zh extends Vh{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)})),yl.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class Qh{constructor(e){this.persistence=e,this.Nr=new qu((e=>Su(e)),Nu),this.lastRemoteSnapshotVersion=al.min(),this.highestTargetId=0,this.Lr=0,this.Br=new qh,this.targetCount=0,this.kr=Fh.Bn()}forEachTarget(e,t){return this.Nr.forEach(((e,n)=>t(n))),yl.resolve()}getLastRemoteSnapshotVersion(e){return yl.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return yl.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),yl.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),yl.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Fh(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,yl.resolve()}updateTargetData(e,t){return this.Kn(t),yl.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,yl.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Nr.forEach(((a,s)=>{s.sequenceNumber<=t&&null===n.get(s.targetId)&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,s.targetId)),r++)})),yl.waitFor(i).next((()=>r))}getTargetCount(e){return yl.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return yl.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),yl.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),yl.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),yl.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return yl.resolve(n)}containsKey(e,t){return yl.resolve(this.Br.containsKey(t))}}class Xh{constructor(e,t){this.qr={},this.overlays={},this.Qr=new bl(0),this.Kr=!1,this.Kr=!0,this.$r=new Gh,this.referenceDelegate=e(this),this.Ur=new Qh(this),this.indexManager=new Lh,this.remoteDocumentCache=function(e){return new Jh(e)}((e=>this.referenceDelegate.Wr(e))),this.serializer=new jh(t),this.Gr=new Uh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Hh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Wh(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){Lo("MemoryPersistence","Starting transaction:",e);const r=new Yh(this.Qr.next());return this.referenceDelegate.zr(),n(r).next((e=>this.referenceDelegate.jr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Hr(e,t){return yl.or(Object.values(this.qr).map((n=>()=>n.containsKey(e,t))))}}class Yh extends ml{constructor(e){super(),this.currentSequenceNumber=e}}class ed{constructor(e){this.persistence=e,this.Jr=new qh,this.Yr=null}static Zr(e){return new ed(e)}get Xr(){if(this.Yr)return this.Yr;throw Vo()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),yl.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),yl.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),yl.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach((e=>this.Xr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Xr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return yl.forEach(this.Xr,(n=>{const r=cl.fromPath(n);return this.ei(e,r).next((e=>{e||t.removeEntry(r,al.min())}))})).next((()=>(this.Yr=null,t.apply(e))))}updateLimboDocument(e,t){return this.ei(e,t).next((e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())}))}Wr(e){return 0}ei(e,t){return yl.or([()=>yl.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class td{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=rc(),r=rc();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new td(e,t.fromCache,n,r)}}class nd{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class rd{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=!function(){var e;const t=null===(e=En())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(a.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}(jn())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.Yi(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Zi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new nd;return this.Xi(e,t,n).next((r=>{if(i.result=r,this.zi)return this.es(e,t,n,r.size)}))})).next((()=>i.result))}es(e,t,n,r){return n.documentReadCount<this.ji?(Ro()<=Zn.DEBUG&&Lo("QueryEngine","SDK will not create cache indexes for query:",Bu(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),yl.resolve()):(Ro()<=Zn.DEBUG&&Lo("QueryEngine","Query:",Bu(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(Ro()<=Zn.DEBUG&&Lo("QueryEngine","The SDK decides to create cache indexes for query:",Bu(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$u(t))):yl.resolve())}Yi(e,t){if(Lu(t))return yl.resolve(null);let n=$u(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Fu(t,null,"F"),n=$u(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=rc(...r);return this.Ji.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const a=this.ts(t,r);return this.ns(t,a,i,n.readTime)?this.Yi(e,Fu(t,null,"F")):this.rs(e,a,t,n)}))))})))))}Zi(e,t,n,r){return Lu(t)||r.isEqual(al.min())?yl.resolve(null):this.Ji.getDocuments(e,n).next((i=>{const a=this.ts(t,i);return this.ns(t,a,n,r)?yl.resolve(null):(Ro()<=Zn.DEBUG&&Lo("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Bu(t)),this.rs(e,a,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=al.fromTimestamp(1e9===r?new il(n+1,0):new il(n,r));return new dl(i,cl.empty(),-1)}(r)).next((e=>e)))}))}ts(e,t){let n=new xl(Hu(e));return t.forEach(((t,r)=>{Uu(e,r)&&(n=n.add(r))})),n}ns(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Xi(e,t,n){return Ro()<=Zn.DEBUG&&Lo("QueryEngine","Using full collection scan to execute query:",Bu(t)),this.Ji.getDocumentsMatchingQuery(e,t,dl.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class id{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new Tl(nl),this._s=new qu((e=>Su(e)),Nu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Bh(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.os)))}}async function ad(e,t){const n=Bo(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.ls(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],a=[];let s=rc();for(const e of r){i.push(e.batchId);for(const t of e.mutations)s=s.add(t.key)}for(const e of t){a.push(e.batchId);for(const t of e.mutations)s=s.add(t.key)}return n.localDocuments.getDocuments(e,s).next((e=>({hs:e,removedBatchIds:i,addedBatchIds:a})))}))}))}function sd(e){const t=Bo(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Ur.getLastRemoteSnapshotVersion(e)))}function od(e,t){const n=Bo(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function ld(e,t,n){const r=Bo(e),i=r.os.get(t),a=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",a,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!vl(e))throw e;Lo("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.os=r.os.remove(t),r._s.delete(i.target)}function ud(e,t,n){const r=Bo(e);let i=al.min(),a=rc();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=Bo(e),i=r._s.get(n);return void 0!==i?yl.resolve(r.os.get(i)):r.Ur.getTargetData(t,n)}(r,e,$u(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(e,t.targetId).next((e=>{a=e}))})).next((()=>r.ss.getDocumentsMatchingQuery(e,t,n?i:al.min(),n?a:rc()))).next((e=>(function(e,t,n){let r=e.us.get(t)||al.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.us.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Ts:a})))))}class cd{constructor(){this.activeTargetIds=ic}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class hd{constructor(){this.so=new cd,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new cd,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class dd{_o(e){}shutdown(){}}class pd{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Lo("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Lo("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let fd=null;function md(){return null===fd?fd=268435456+Math.round(2147483648*Math.random()):fd++,"0x"+fd.toString(16)}const gd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class yd{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const vd="WebChannelConnection";class bd extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo=`projects/${n}/databases/${r}`,this.Co="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get Fo(){return!1}Mo(e,t,n,r,i){const a=md(),s=this.xo(e,t.toUriEncodedString());Lo("RestConnection",`Sending RPC '${e}' ${a}:`,s,n);const o={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(o,r,i),this.No(e,s,o,n).then((t=>(Lo("RestConnection",`Received RPC '${e}' ${a}: `,t),t)),(t=>{throw $o("RestConnection",`RPC '${e}' ${a} failed with error: `,t,"url: ",s,"request:",n),t}))}Lo(e,t,n,r,i,a){return this.Mo(e,t,n,r,i)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+jo,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}xo(e,t){const n=gd[e];return`${this.Do}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){const i=md();return new Promise(((a,s)=>{const o=new _o;o.setWithCredentials(!0),o.listenOnce(Ao.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Po.NO_ERROR:const t=o.getResponseJson();Lo(vd,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),a(t);break;case Po.TIMEOUT:Lo(vd,`RPC '${e}' ${i} timed out`),s(new Ho(Uo.DEADLINE_EXCEEDED,"Request time out"));break;case Po.HTTP_ERROR:const n=o.getStatus();if(Lo(vd,`RPC '${e}' ${i} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Uo).indexOf(t)>=0?t:Uo.UNKNOWN}(t.status);s(new Ho(e,t.message))}else s(new Ho(Uo.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Ho(Uo.UNAVAILABLE,"Connection failed."));break;default:Vo()}}finally{Lo(vd,`RPC '${e}' ${i} completed.`)}}));const l=JSON.stringify(r);Lo(vd,`RPC '${e}' ${i} sending request:`,r),o.send(t,"POST",l,n,15)}))}Bo(e,t,n){const r=md(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=xo(),s=Eo(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const u=i.join("");Lo(vd,`Creating RPC '${e}' stream ${r}: ${u}`,o);const c=a.createWebChannel(u,o);let h=!1,d=!1;const p=new yd({Io:t=>{d?Lo(vd,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(Lo(vd,`Opening RPC '${e}' stream ${r} transport.`),c.open(),h=!0),Lo(vd,`RPC '${e}' stream ${r} sending:`,t),c.send(t))},To:()=>c.close()}),f=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(c,ko.EventType.OPEN,(()=>{d||(Lo(vd,`RPC '${e}' stream ${r} transport opened.`),p.yo())})),f(c,ko.EventType.CLOSE,(()=>{d||(d=!0,Lo(vd,`RPC '${e}' stream ${r} transport closed`),p.So())})),f(c,ko.EventType.ERROR,(t=>{d||(d=!0,$o(vd,`RPC '${e}' stream ${r} transport errored:`,t),p.So(new Ho(Uo.UNAVAILABLE,"The operation could not be completed")))})),f(c,ko.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];zo(!!i);const a=i,s=a.error||(null===(n=a[0])||void 0===n?void 0:n.error);if(s){Lo(vd,`RPC '${e}' stream ${r} received error:`,s);const t=s.status;let n=function(e){const t=Fc[e];if(void 0!==t)return zc(t)}(t),i=s.message;void 0===n&&(n=Uo.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),d=!0,p.So(new Ho(n,i)),c.close()}else Lo(vd,`RPC '${e}' stream ${r} received:`,i),p.bo(i)}})),f(s,Io.STAT_EVENT,(t=>{t.stat===To.PROXY?Lo(vd,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===To.NOPROXY&&Lo(vd,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{p.wo()}),0),p}}function wd(){return"undefined"!=typeof document?document:null}function _d(e){return new ah(e,!0)}class kd{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);r>0&&Lo("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,(()=>(this.Uo=Date.now(),e()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Ad{constructor(e,t,n,r,i,a,s,o){this.ui=e,this.Ho=n,this.Jo=r,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=s,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new kd(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===Uo.RESOURCE_EXHAUSTED?(Mo(t.toString()),Mo("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Uo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Yo===t&&this.P_(e,n)}),(t=>{e((()=>{const e=new Ho(Uo.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)}))}))}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((()=>{n((()=>this.listener.Eo()))})),this.stream.Ro((()=>{n((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((e=>{n((()=>this.I_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.e_?this.E_(e):this.onNext(e)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(e){return Lo("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget((()=>this.Yo===e?t():(Lo("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Pd extends Ad{constructor(e,t,n,r,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,a),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Vo()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.useProto3Json?(zo(void 0===t||"string"==typeof t),Nl.fromBase64String(t||"")):(zo(void 0===t||t instanceof Buffer||t instanceof Uint8Array),Nl.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),s=t.targetChange.cause,o=s&&function(e){const t=void 0===e.code?Uo.UNKNOWN:zc(e.code);return new Ho(t,e.message||"")}(s);n=new Qc(r,i,a,o||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=mh(e,r.document.name),a=ch(r.document.updateTime),s=r.document.createTime?ch(r.document.createTime):al.min(),o=new au({mapValue:{fields:r.document.fields}}),l=ou.newFoundDocument(i,a,s,o),u=r.targetIds||[],c=r.removedTargetIds||[];n=new Jc(u,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=mh(e,r.document),a=r.readTime?ch(r.readTime):al.min(),s=ou.newNoDocument(i,a),o=r.removedTargetIds||[];n=new Jc([],o,s.key,s)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=mh(e,r.document),a=r.removedTargetIds||[];n=new Jc([],a,i,null)}else{if(!("filter"in t))return Vo();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,a=new $c(r,i),s=e.targetId;n=new Zc(s,a)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return al.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?al.min():t.readTime?ch(t.readTime):al.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=yh(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=ju(r)?{documents:wh(e,r)}:{query:_h(e,r)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=lh(e,t.resumeToken);const r=sh(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(al.min())>0){n.readTime=oh(e,t.snapshotVersion.toTimestamp());const r=sh(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Vo()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=yh(this.serializer),t.removeTarget=e,this.a_(t)}}class Td extends Ad{constructor(e,t,n,r,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return zo(!!e.streamToken),this.lastStreamToken=e.streamToken,zo(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){zo(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function(e,t){return e&&e.length>0?(zo(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?ch(e.updateTime):ch(t);return n.isEqual(al.min())&&(n=ch(t)),new bc(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=ch(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=yh(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof xc)n={update:bh(e,t.key,t.value)};else if(t instanceof jc)n={delete:fh(e,t.key)};else if(t instanceof Cc)n={update:bh(e,t.key,t.data),updateMask:Oh(t.fieldMask)};else{if(!(t instanceof Dc))return Vo();n={verify:fh(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof hc)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof dc)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof fc)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof gc)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw Vo()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:uh(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Vo()}(e,t.precondition)),n}(this.serializer,e)))};this.a_(t)}}class Id extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new Ho(Uo.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Mo(e,dh(t,n),r,i,a))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Uo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ho(Uo.UNKNOWN,e.toString())}))}Lo(e,t,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,s])=>this.connection.Lo(e,dh(t,n),r,a,s,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Uo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ho(Uo.UNKNOWN,e.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class Ed{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Mo(t),this.D_=!1):Lo("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class xd{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o((e=>{n.enqueueAndForget((async()=>{Md(this)&&(Lo("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Bo(e);t.L_.add(4),await Od(t),t.q_.set("Unknown"),t.L_.delete(4),await Cd(t)}(this))}))})),this.q_=new Ed(n,r)}}async function Cd(e){if(Md(e))for(const t of e.B_)await t(!0)}async function Od(e){for(const t of e.B_)await t(!1)}function Sd(e,t){const n=Bo(e);n.N_.has(t.targetId)||(n.N_.set(t.targetId,t),Ld(n)?Rd(n):tp(n).r_()&&jd(n,t))}function Nd(e,t){const n=Bo(e),r=tp(n);n.N_.delete(t),r.r_()&&Dd(n,t),0===n.N_.size&&(r.r_()?r.o_():Md(n)&&n.q_.set("Unknown"))}function jd(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(al.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}tp(e).A_(t)}function Dd(e,t){e.Q_.xe(t),tp(e).R_(t)}function Rd(e){e.Q_=new Yc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),tp(e).start(),e.q_.v_()}function Ld(e){return Md(e)&&!tp(e).n_()&&e.N_.size>0}function Md(e){return 0===Bo(e).L_.size}function $d(e){e.Q_=void 0}async function Fd(e){e.q_.set("Online")}async function Vd(e){e.N_.forEach(((t,n)=>{jd(e,t)}))}async function zd(e,t){$d(e),Ld(e)?(e.q_.M_(t),Rd(e)):e.q_.set("Unknown")}async function Bd(e,t,n){if(e.q_.set("Online"),t instanceof Qc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.N_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.N_.delete(r),e.Q_.removeTarget(r))}(e,t)}catch(n){Lo("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Ud(e,n)}else if(t instanceof Jc?e.Q_.Ke(t):t instanceof Zc?e.Q_.He(t):e.Q_.We(t),!n.isEqual(al.min()))try{const t=await sd(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Q_.rt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.N_.get(r);i&&e.N_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.N_.get(t);if(!r)return;e.N_.set(t,r.withResumeToken(Nl.EMPTY_BYTE_STRING,r.snapshotVersion)),Dd(e,t);const i=new Nh(r.target,t,n,r.sequenceNumber);jd(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Lo("RemoteStore","Failed to raise snapshot:",t),await Ud(e,t)}}async function Ud(e,t,n){if(!vl(t))throw t;e.L_.add(1),await Od(e),e.q_.set("Offline"),n||(n=()=>sd(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Lo("RemoteStore","Retrying IndexedDB access"),await n(),e.L_.delete(1),await Cd(e)}))}function Hd(e,t){return t().catch((n=>Ud(e,n,t)))}async function Gd(e){const t=Bo(e),n=np(t);let r=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;qd(t);)try{const e=await od(t.localStore,r);if(null===e){0===t.O_.length&&n.o_();break}r=e.batchId,Kd(t,e)}catch(e){await Ud(t,e)}Wd(t)&&Jd(t)}function qd(e){return Md(e)&&e.O_.length<10}function Kd(e,t){e.O_.push(t);const n=np(e);n.r_()&&n.V_&&n.m_(t.mutations)}function Wd(e){return Md(e)&&!np(e).n_()&&e.O_.length>0}function Jd(e){np(e).start()}async function Zd(e){np(e).p_()}async function Qd(e){const t=np(e);for(const n of e.O_)t.m_(n.mutations)}async function Xd(e,t,n){const r=e.O_.shift(),i=Lc.from(r,t,n);await Hd(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Gd(e)}async function Yd(e,t){t&&np(e).V_&&await async function(e,t){if(function(e){return function(e){switch(e){default:return Vo();case Uo.CANCELLED:case Uo.UNKNOWN:case Uo.DEADLINE_EXCEEDED:case Uo.RESOURCE_EXHAUSTED:case Uo.INTERNAL:case Uo.UNAVAILABLE:case Uo.UNAUTHENTICATED:return!1;case Uo.INVALID_ARGUMENT:case Uo.NOT_FOUND:case Uo.ALREADY_EXISTS:case Uo.PERMISSION_DENIED:case Uo.FAILED_PRECONDITION:case Uo.ABORTED:case Uo.OUT_OF_RANGE:case Uo.UNIMPLEMENTED:case Uo.DATA_LOSS:return!0}}(e)&&e!==Uo.ABORTED}(t.code)){const n=e.O_.shift();np(e).s_(),await Hd(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Gd(e)}}(e,t),Wd(e)&&Jd(e)}async function ep(e,t){const n=Bo(e);n.asyncQueue.verifyOperationInProgress(),Lo("RemoteStore","RemoteStore received new credentials");const r=Md(n);n.L_.add(3),await Od(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.L_.delete(3),await Cd(n)}function tp(e){return e.K_||(e.K_=function(e,t,n){const r=Bo(e);return r.w_(),new Pd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:Fd.bind(null,e),Ro:Vd.bind(null,e),mo:zd.bind(null,e),d_:Bd.bind(null,e)}),e.B_.push((async t=>{t?(e.K_.s_(),Ld(e)?Rd(e):e.q_.set("Unknown")):(await e.K_.stop(),$d(e))}))),e.K_}function np(e){return e.U_||(e.U_=function(e,t,n){const r=Bo(e);return r.w_(),new Td(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Zd.bind(null,e),mo:Yd.bind(null,e),f_:Qd.bind(null,e),g_:Xd.bind(null,e)}),e.B_.push((async t=>{t?(e.U_.s_(),await Gd(e)):(await e.U_.stop(),e.O_.length>0&&(Lo("RemoteStore",`Stopping write stream with ${e.O_.length} pending writes`),e.O_=[]))}))),e.U_}class rp{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Go,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const a=Date.now()+n,s=new rp(e,t,a,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ho(Uo.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ip(e,t){if(Mo("AsyncQueue",`${t}: ${e}`),vl(e))return new Ho(Uo.UNAVAILABLE,`${t}: ${e}`);throw e}class ap{constructor(e){this.comparator=e?(t,n)=>e(t,n)||cl.comparator(t.key,n.key):(e,t)=>cl.comparator(e.key,t.key),this.keyedMap=Zu(),this.sortedSet=new Tl(this.comparator)}static emptySet(e){return new ap(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ap))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new ap;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class sp{constructor(){this.W_=new Tl(cl.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Vo():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class op{constructor(e,t,n,r,i,a,s,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=s,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){const a=[];return t.forEach((e=>{a.push({type:0,doc:e})})),new op(e,t,ap.emptySet(t),a,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Vu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class lp{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((e=>e.J_()))}}class up{constructor(){this.queries=cp(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=Bo(e),r=n.queries;n.queries=cp(),r.forEach(((e,n)=>{for(const e of n.j_)e.onError(t)}))}(this,new Ho(Uo.ABORTED,"Firestore shutting down"))}}function cp(){return new qu((e=>zu(e)),Vu)}function hp(e,t){const n=Bo(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.j_)t.X_(e)&&(r=!0);i.z_=e}}r&&pp(n)}function dp(e,t,n){const r=Bo(e),i=r.queries.get(t);if(i)for(const e of i.j_)e.onError(n);r.queries.delete(t)}function pp(e){e.Y_.forEach((e=>{e.next()}))}var fp,mp;(mp=fp||(fp={})).ea="default",mp.Cache="cache";class gp{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new op(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache)return!0;if(!this.J_())return!0;const n="Offline"!==t;return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}oa(e){e=op.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==fp.Cache}}class yp{constructor(e){this.key=e}}class vp{constructor(e){this.key=e}}class bp{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=rc(),this.mutatedKeys=rc(),this.Aa=Hu(e),this.Ra=new ap(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new sp,r=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,a=r,s=!1;const o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),c=Uu(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations);let p=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(n.track({type:3,doc:c}),p=!0):this.ga(u,c)||(n.track({type:2,doc:c}),p=!0,(o&&this.Aa(c,o)>0||l&&this.Aa(c,l)<0)&&(s=!0)):!u&&c?(n.track({type:0,doc:c}),p=!0):u&&!c&&(n.track({type:1,doc:u}),p=!0,(o||l)&&(s=!0)),p&&(c?(a=a.add(c),i=d?i.add(e):i.delete(e)):(a=a.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;a.size>this.query.limit;){const e="F"===this.query.limitType?a.last():a.first();a=a.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ra:a,fa:n,ns:s,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Vo()}};return n(e)-n(t)}(e.type,t.type)||this.Aa(e.doc,t.doc))),this.pa(n),r=null!=r&&r;const s=t&&!r?this.ya():[],o=0===this.da.size&&this.current&&!r?1:0,l=o!==this.Ea;return this.Ea=o,0!==a.length||l?{snapshot:new op(this.query,e.Ra,i,a,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:s}:{wa:s}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new sp,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach((e=>this.Ta=this.Ta.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ta=this.Ta.delete(e))),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=rc(),this.Ra.forEach((e=>{this.Sa(e.key)&&(this.da=this.da.add(e.key))}));const t=[];return e.forEach((e=>{this.da.has(e)||t.push(new vp(e))})),this.da.forEach((n=>{e.has(n)||t.push(new yp(n))})),t}ba(e){this.Ta=e.Ts,this.da=rc();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return op.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class wp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class _p{constructor(e){this.key=e,this.va=!1}}class kp{constructor(e,t,n,r,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new qu((e=>zu(e)),Vu),this.Ma=new Map,this.xa=new Set,this.Oa=new Tl(cl.comparator),this.Na=new Map,this.La=new qh,this.Ba={},this.ka=new Map,this.qa=Fh.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function Ap(e,t,n=!0){const r=Up(e);let i;const a=r.Fa.get(t);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.Da()):i=await Tp(r,t,n,!0),i}async function Pp(e,t){const n=Up(e);await Tp(n,t,!0,!1)}async function Tp(e,t,n,r){const i=await function(e,t){const n=Bo(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Ur.getTargetData(e,t).next((i=>i?(r=i,yl.resolve(r)):n.Ur.allocateTargetId(e).next((i=>(r=new Nh(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Ur.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.os.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.os=n.os.insert(e.targetId,e),n._s.set(t,e.targetId)),e}))}(e.localStore,$u(t)),a=i.targetId,s=e.sharedClientState.addLocalQueryTarget(a,n);let o;return r&&(o=await async function(e,t,n,r,i){e.Ka=(t,n,r)=>async function(e,t,n,r){let i=t.view.ma(n);i.ns&&(i=await ud(e.localStore,t.query,!1).then((({documents:e})=>t.view.ma(e,i))));const a=r&&r.targetChanges.get(t.targetId),s=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,a,s);return Mp(e,t.targetId,o.wa),o.snapshot}(e,t,n,r);const a=await ud(e.localStore,t,!0),s=new bp(t,a.Ts),o=s.ma(a.documents),l=Wc.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=s.applyChanges(o,e.isPrimaryClient,l);Mp(e,n,u.wa);const c=new wp(t,n,s);return e.Fa.set(t,c),e.Ma.has(n)?e.Ma.get(n).push(t):e.Ma.set(n,[t]),u.snapshot}(e,t,a,"current"===s,i.resumeToken)),e.isPrimaryClient&&n&&Sd(e.remoteStore,i),o}async function Ip(e,t,n){const r=Bo(e),i=r.Fa.get(t),a=r.Ma.get(i.targetId);if(a.length>1)return r.Ma.set(i.targetId,a.filter((e=>!Vu(e,t)))),void r.Fa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await ld(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Nd(r.remoteStore,i.targetId),Rp(r,i.targetId)})).catch(gl)):(Rp(r,i.targetId),await ld(r.localStore,i.targetId,!0))}async function Ep(e,t){const n=Bo(e),r=n.Fa.get(t),i=n.Ma.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Nd(n.remoteStore,r.targetId))}async function xp(e,t){const n=Bo(e);try{const e=await function(e,t){const n=Bo(e),r=t.snapshotVersion;let i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const a=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;const s=[];t.targetChanges.forEach(((a,o)=>{const l=i.get(o);if(!l)return;s.push(n.Ur.removeMatchingKeys(e,a.removedDocuments,o).next((()=>n.Ur.addMatchingKeys(e,a.addedDocuments,o))));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(Nl.EMPTY_BYTE_STRING,al.min()).withLastLimboFreeSnapshotVersion(al.min()):a.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(a.resumeToken,r)),i=i.insert(o,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(l,u,a)&&s.push(n.Ur.updateTargetData(e,u))}));let o=Wu(),l=rc();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),s.push(function(e,t,n){let r=rc(),i=rc();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Wu();return n.forEach(((n,a)=>{const s=e.get(n);a.isFoundDocument()!==s.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(al.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!s.isValidDocument()||a.version.compareTo(s.version)>0||0===a.version.compareTo(s.version)&&s.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):Lo("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",a.version)})),{Ps:r,Is:i}}))}(e,a,t.documentUpdates).next((e=>{o=e.Ps,l=e.Is}))),!r.isEqual(al.min())){const t=n.Ur.getLastRemoteSnapshotVersion(e).next((t=>n.Ur.setTargetsMetadata(e,e.currentSequenceNumber,r)));s.push(t)}return yl.waitFor(s).next((()=>a.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,o,l))).next((()=>o))})).then((e=>(n.os=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Na.get(t);r&&(zo(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.va=!0:e.modifiedDocuments.size>0?zo(r.va):e.removedDocuments.size>0&&(zo(r.va),r.va=!1))})),await Vp(n,e,t)}catch(e){await gl(e)}}function Cp(e,t,n){const r=Bo(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Fa.forEach(((n,r)=>{const i=r.view.Z_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Bo(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.j_)e.Z_(t)&&(r=!0)})),r&&pp(n)}(r.eventManager,t),e.length&&r.Ca.d_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Op(e,t,n){const r=Bo(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Na.get(t),a=i&&i.key;if(a){let e=new Tl(cl.comparator);e=e.insert(a,ou.newNoDocument(a,al.min()));const n=rc().add(a),i=new Kc(al.min(),new Map,new Tl(nl),e,n);await xp(r,i),r.Oa=r.Oa.remove(a),r.Na.delete(t),Fp(r)}else await ld(r.localStore,t,!1).then((()=>Rp(r,t,n))).catch(gl)}async function Sp(e,t){const n=Bo(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Bo(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,a=i.keys();let s=yl.resolve();return a.forEach((e=>{s=s.next((()=>r.getEntry(t,e))).next((t=>{const a=n.docVersions.get(e);zo(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),s.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=rc();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Dp(n,r,null),jp(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Vp(n,e)}catch(e){await gl(e)}}async function Np(e,t,n){const r=Bo(e);try{const e=await function(e,t){const n=Bo(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(zo(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Dp(r,t,n),jp(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Vp(r,e)}catch(n){await gl(n)}}function jp(e,t){(e.ka.get(t)||[]).forEach((e=>{e.resolve()})),e.ka.delete(t)}function Dp(e,t,n){const r=Bo(e);let i=r.Ba[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ba[r.currentUser.toKey()]=i}}function Rp(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Ma.get(t))e.Fa.delete(r),n&&e.Ca.$a(r,n);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach((t=>{e.La.containsKey(t)||Lp(e,t)}))}function Lp(e,t){e.xa.delete(t.path.canonicalString());const n=e.Oa.get(t);null!==n&&(Nd(e.remoteStore,n),e.Oa=e.Oa.remove(t),e.Na.delete(n),Fp(e))}function Mp(e,t,n){for(const r of n)r instanceof yp?(e.La.addReference(r.key,t),$p(e,r)):r instanceof vp?(Lo("SyncEngine","Document no longer in limbo: "+r.key),e.La.removeReference(r.key,t),e.La.containsKey(r.key)||Lp(e,r.key)):Vo()}function $p(e,t){const n=t.key,r=n.path.canonicalString();e.Oa.get(n)||e.xa.has(r)||(Lo("SyncEngine","New document in limbo: "+n),e.xa.add(r),Fp(e))}function Fp(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){const t=e.xa.values().next().value;e.xa.delete(t);const n=new cl(ol.fromString(t)),r=e.qa.next();e.Na.set(r,new _p(n)),e.Oa=e.Oa.insert(n,r),Sd(e.remoteStore,new Nh($u(Ru(n.path)),r,"TargetPurposeLimboResolution",bl.oe))}}async function Vp(e,t,n){const r=Bo(e),i=[],a=[],s=[];r.Fa.isEmpty()||(r.Fa.forEach(((e,o)=>{s.push(r.Ka(o,t,n).then((e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(o.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(o.targetId,i?"current":"not-current")}if(e){i.push(e);const t=td.Wi(o.targetId,e);a.push(t)}})))})),await Promise.all(s),r.Ca.d_(i),await async function(e,t){const n=Bo(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>yl.forEach(t,(t=>yl.forEach(t.$i,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>yl.forEach(t.Ui,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!vl(e))throw e;Lo("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.os.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.os=n.os.insert(t,i)}}}(r.localStore,a))}async function zp(e,t){const n=Bo(e);if(!n.currentUser.isEqual(t)){Lo("SyncEngine","User change. New user:",t.toKey());const e=await ad(n.localStore,t);n.currentUser=t,function(e,t){e.ka.forEach((e=>{e.forEach((e=>{e.reject(new Ho(Uo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.ka.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Vp(n,e.hs)}}function Bp(e,t){const n=Bo(e),r=n.Na.get(t);if(r&&r.va)return rc().add(r.key);{let e=rc();const r=n.Ma.get(t);if(!r)return e;for(const t of r){const r=n.Fa.get(t);e=e.unionWith(r.view.Va)}return e}}function Up(e){const t=Bo(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=xp.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Bp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Op.bind(null,t),t.Ca.d_=hp.bind(null,t.eventManager),t.Ca.$a=dp.bind(null,t.eventManager),t}function Hp(e){const t=Bo(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Sp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Np.bind(null,t),t}class Gp{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=_d(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return function(e,t,n,r){return new id(e,t,n,r)}(this.persistence,new rd,e.initialUser,this.serializer)}Ga(e){return new Xh(ed.Zr,this.serializer)}Wa(e){return new hd}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gp.provider={build:()=>new Gp};class qp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Cp(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=zp.bind(null,this.syncEngine),await async function(e,t){const n=Bo(e);t?(n.L_.delete(2),await Cd(n)):t||(n.L_.add(2),await Od(n),n.q_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new up}createDatastore(e){const t=_d(e.databaseInfo.databaseId),n=function(e){return new bd(e)}(e.databaseInfo);return function(e,t,n,r){return new Id(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new xd(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Cp(this.syncEngine,e,0)),pd.D()?new pd:new dd)}createSyncEngine(e,t){return function(e,t,n,r,i,a,s){const o=new kp(e,t,n,r,i,a);return s&&(o.Qa=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=Bo(e);Lo("RemoteStore","RemoteStore shutting down."),t.L_.add(5),await Od(t),t.k_.shutdown(),t.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}qp.provider={build:()=>new qp};class Kp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Mo("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class Wp{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=No.UNAUTHENTICATED,this.clientId=tl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{Lo("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Lo("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Go;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=ip(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Jp(e,t){e.asyncQueue.verifyOperationInProgress(),Lo("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await ad(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Zp(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Lo("FirestoreClient","Using user provided OfflineComponentProvider");try{await Jp(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===Uo.FAILED_PRECONDITION||e.code===Uo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;$o("Error using user provided cache. Falling back to memory cache: "+n),await Jp(e,new Gp)}}else Lo("FirestoreClient","Using default OfflineComponentProvider"),await Jp(e,new Gp);return e._offlineComponents}(e);Lo("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>ep(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>ep(t.remoteStore,n))),e._onlineComponents=t}async function Qp(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Lo("FirestoreClient","Using user provided OnlineComponentProvider"),await Zp(e,e._uninitializedComponentsProvider._online)):(Lo("FirestoreClient","Using default OnlineComponentProvider"),await Zp(e,new qp))),e._onlineComponents}async function Xp(e){const t=await Qp(e),n=t.eventManager;return n.onListen=Ap.bind(null,t.syncEngine),n.onUnlisten=Ip.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Pp.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Ep.bind(null,t.syncEngine),n}function Yp(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const ef=new Map;function tf(e,t,n){if(!n)throw new Ho(Uo.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function nf(e){if(!cl.isDocumentKey(e))throw new Ho(Uo.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function rf(e){if(cl.isDocumentKey(e))throw new Ho(Uo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function af(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Vo()}function sf(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Ho(Uo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=af(e);throw new Ho(Uo.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class of{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Ho(Uo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Ho(Uo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new Ho(Uo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Yp(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Ho(Uo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Ho(Uo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Ho(Uo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lf{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new of({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ho(Uo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Ho(Uo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new of(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Ko;switch(e.type){case"firstParty":return new Qo(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Ho(Uo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ef.get(e);t&&(Lo("ComponentProvider","Removing Datastore"),ef.delete(e),t.terminate())}(this),Promise.resolve()}}class uf{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new uf(this.firestore,e,this._query)}}class cf{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cf(this.firestore,e,this._key)}}class hf extends uf{constructor(e,t,n){super(e,t,Ru(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new cf(this.firestore,null,new cl(e))}withConverter(e){return new hf(this.firestore,e,this._path)}}function df(e,t,...n){if(e=Hn(e),tf("collection","path",t),e instanceof lf){const r=ol.fromString(t,...n);return rf(r),new hf(e,null,r)}{if(!(e instanceof cf||e instanceof hf))throw new Ho(Uo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ol.fromString(t,...n));return rf(r),new hf(e.firestore,null,r)}}function pf(e,t,...n){if(e=Hn(e),1===arguments.length&&(t=tl.newId()),tf("doc","path",t),e instanceof lf){const r=ol.fromString(t,...n);return nf(r),new cf(e,null,new cl(r))}{if(!(e instanceof cf||e instanceof hf))throw new Ho(Uo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ol.fromString(t,...n));return nf(r),new cf(e.firestore,e instanceof hf?e.converter:null,new cl(r))}}class ff{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new kd(this,"async_queue_retry"),this.Vu=()=>{const e=wd();e&&Lo("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=wd();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=wd();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise((()=>{}));const t=new Go;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Pu.push(e),this.pu())))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!vl(e))throw e;Lo("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go((()=>this.pu()))}}gu(e){const t=this.mu.then((()=>(this.du=!0,e().catch((e=>{this.Eu=e,this.du=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Mo("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.du=!1,e))))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const r=rp.createAndSchedule(this,e,t,n,(e=>this.yu(e)));return this.Tu.push(r),r}fu(){this.Eu&&Vo()}verifyOperationInProgress(){}async wu(){let e;do{e=this.mu,await e}while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then((()=>{this.Tu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()}))}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class mf extends lf{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new ff,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ff(e),this._firestoreClient=void 0,await e}}}function gf(e,t){const n="string"==typeof e?e:t||"(default)",r=ti("object"==typeof e?e:oi(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=Cn("firestore");e&&function(e,t,n,r={}){var i;const a=(e=sf(e,lf))._getSettings(),s=`${t}:${n}`;if("firestore.googleapis.com"!==a.host&&a.host!==s&&$o("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},a),{host:s,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=No.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Tn(JSON.stringify({alg:"none",type:"JWT"})),Tn(JSON.stringify(a)),""].join(".")}(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const a=r.mockUserToken.sub||r.mockUserToken.user_id;if(!a)throw new Ho(Uo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new No(a)}e._authCredentials=new Wo(new qo(t,n))}}(r,...e)}return r}function yf(e){if(e._terminated)throw new Ho(Uo.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r;const i=e._freezeSettings(),a=function(e,t,n,r){return new Vl(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Yp(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Wp(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class vf{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vf(Nl.fromBase64String(e))}catch(e){throw new Ho(Uo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new vf(Nl.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class bf{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Ho(Uo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ul(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class wf{constructor(e){this._methodName=e}}class _f{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ho(Uo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ho(Uo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return nl(this._lat,e._lat)||nl(this._long,e._long)}}class kf{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const Af=/^__.*__$/;class Pf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Cc(e,this.data,this.fieldMask,t,this.fieldTransforms):new xc(e,this.data,t,this.fieldTransforms)}}function Tf(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Vo()}}class If{constructor(e,t,n,r,i,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new If(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Mf(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(Tf(this.Cu)&&Af.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Ef{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||_d(e)}Qu(e,t,n,r=!1){return new If({Cu:e,methodName:t,qu:n,path:ul.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function xf(e){const t=e._freezeSettings(),n=_d(e._databaseId);return new Ef(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Cf(e,t,n,r,i,a={}){const s=e.Qu(a.merge||a.mergeFields?2:0,t,n,i);jf("Data must be an object, but it was:",s,r);const o=Sf(r,s);let l,u;if(a.merge)l=new Ol(s.fieldMask),u=s.fieldTransforms;else if(a.mergeFields){const e=[];for(const r of a.mergeFields){const i=Df(t,r,n);if(!s.contains(i))throw new Ho(Uo.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);$f(e,i)||e.push(i)}l=new Ol(e),u=s.fieldTransforms.filter((e=>l.covers(e.field)))}else l=null,u=s.fieldTransforms;return new Pf(new au(o),l,u)}function Of(e,t){if(Nf(e=Hn(e)))return jf("Unsupported field value:",t,e),Sf(e,t);if(e instanceof wf)return function(e,t){if(!Tf(t.Cu))throw t.Bu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Bu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Of(i,t.Lu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Hn(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return function(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!_l(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?sc(t):ac(e,t)}(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=il.fromDate(e);return{timestampValue:oh(t.serializer,n)}}if(e instanceof il){const n=new il(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:oh(t.serializer,n)}}if(e instanceof _f)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof vf)return{bytesValue:lh(t.serializer,e._byteString)};if(e instanceof cf){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Bu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:hh(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof kf)return function(e,t){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.Bu("VectorValues must only contain numeric values.");return ac(t.serializer,e)}))}}}}}}(e,t);throw t.Bu(`Unsupported field value: ${af(e)}`)}(e,t)}function Sf(e,t){const n={};return Pl(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Al(e,((e,r)=>{const i=Of(r,t.Mu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Nf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof il||e instanceof _f||e instanceof vf||e instanceof cf||e instanceof wf||e instanceof kf)}function jf(e,t,n){if(!Nf(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=af(n);throw"an object"===r?t.Bu(e+" a custom object"):t.Bu(e+" "+r)}}function Df(e,t,n){if((t=Hn(t))instanceof bf)return t._internalPath;if("string"==typeof t)return Lf(e,t);throw Mf("Field path arguments must be of type string or ",e,!1,void 0,n)}const Rf=new RegExp("[~\\*/\\[\\]]");function Lf(e,t,n){if(t.search(Rf)>=0)throw Mf(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new bf(...t.split("."))._internalPath}catch(r){throw Mf(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Mf(e,t,n,r,i){const a=r&&!r.isEmpty(),s=void 0!==i;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(a||s)&&(l+=" (found",a&&(l+=` in field ${r}`),s&&(l+=` in document ${i}`),l+=")"),new Ho(Uo.INVALID_ARGUMENT,o+e+l)}function $f(e,t){return e.some((e=>e.isEqual(t)))}class Ff{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new cf(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Vf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(zf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Vf extends Ff{data(){return super.data()}}function zf(e,t){return"string"==typeof t?Lf(e,t):t instanceof bf?t._internalPath:t._delegate._internalPath}class Bf{convertValue(e,t="none"){switch(Ul(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Rl(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ll(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Vo()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Al(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((e=>Rl(e.doubleValue)));return new kf(i)}convertGeoPoint(e){return new _f(Rl(e.latitude),Rl(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=$l(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Fl(e));default:return null}}convertTimestamp(e){const t=Dl(e);return new il(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ol.fromString(e);zo(Sh(n));const r=new zl(n.get(1),n.get(3)),i=new cl(n.popFirst(5));return r.isEqual(t)||Mo(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Uf(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Hf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gf extends Ff{constructor(e,t,n,r,i,a){super(e,t,n,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new qf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(zf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class qf extends Gf{data(e={}){return super.data(e)}}function Kf(e){e=sf(e,cf);const t=sf(e.firestore,mf);return function(e,t,n={}){const r=new Go;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const a=new Kp({next:o=>{a.Za(),t.enqueueAndForget((()=>async function(e,t){const n=Bo(e),r=t.query;let i=3;const a=n.queries.get(r);if(a){const e=a.j_.indexOf(t);e>=0&&(a.j_.splice(e,1),0===a.j_.length?i=t.J_()?0:1:!a.H_()&&t.J_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(e,s)));const l=o.docs.has(n);!l&&o.fromCache?i.reject(new Ho(Uo.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&"server"===r.source?i.reject(new Ho(Uo.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),s=new gp(Ru(n.path),a,{includeMetadataChanges:!0,_a:!0});return async function(e,t){const n=Bo(e);let r=3;const i=t.query;let a=n.queries.get(i);a?!a.H_()&&t.J_()&&(r=2):(a=new lp,r=t.J_()?0:1);try{switch(r){case 0:a.z_=await n.onListen(i,!0);break;case 1:a.z_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=ip(e,`Initialization of query '${Bu(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,a),a.j_.push(t),t.Z_(n.onlineState),a.z_&&t.X_(a.z_)&&pp(n)}(e,s)}(await Xp(e),e.asyncQueue,t,n,r))),r.promise}(yf(t),e._key).then((n=>function(e,t,n){const r=n.docs.get(t._key),i=new Wf(e);return new Gf(e,i,t._key,r,new Hf(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}class Wf extends Bf{constructor(e){super(),this.firestore=e}convertBytes(e){return new vf(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new cf(this.firestore,null,t)}}function Jf(e,t,n){e=sf(e,cf);const r=sf(e.firestore,mf),i=Uf(e.converter,t,n);return Qf(r,[Cf(xf(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,wc.none())])}function Zf(e,t){const n=sf(e.firestore,mf),r=pf(e),i=Uf(e.converter,t);return Qf(n,[Cf(xf(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,wc.exists(!1))]).then((()=>r))}function Qf(e,t){return function(e,t){const n=new Go;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Hp(e);try{const e=await function(e,t){const n=Bo(e),r=il.now(),i=t.reduce(((e,t)=>e.add(t.key)),rc());let a,s;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let o=Wu(),l=rc();return n.cs.getEntries(e,i).next((e=>{o=e,o.forEach(((e,t)=>{t.isValidDocument()||(l=l.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,o))).next((i=>{a=i;const s=[];for(const e of t){const t=Ic(e,a.get(e.key).overlayedDocument);null!=t&&s.push(new Cc(e.key,t,su(t.value.mapValue),wc.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,s,t)})).next((t=>{s=t;const r=t.applyToLocalDocumentSet(a,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:s.batchId,changes:Qu(a)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ba[e.currentUser.toKey()];r||(r=new Tl(nl)),r=r.insert(t,n),e.Ba[e.currentUser.toKey()]=r}(r,e.batchId,n),await Vp(r,e.changes),await Gd(r.remoteStore)}catch(e){const t=ip(e,"Failed to persist write");n.reject(t)}}(await function(e){return Qp(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(yf(e),t)}new WeakMap,function(e,t=!0){!function(e){jo=e}(ai),ei(new Gn("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),a=new mf(new Jo(e.getProvider("auth-internal")),new Yo(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Ho(Uo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zl(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a}),"PUBLIC").setMultipleInstances(!0)),li(So,"4.7.3",e),li(So,"4.7.3","esm2017")}();const Xf=N.logger.get_logger({id:"firebase"});function Yf(e){return si(e)}function em(e){return function(e=oi()){const t=ti(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=ti(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Mn(n.getOptions(),null!=t?t:{}))return e;Ti(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:oo,persistence:[Ts,ls,cs]}),r=Sn("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=fo(e.toString());!function(e,t,n){Hn(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,n,r,i){Hn(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}}const i=xn("auth");return i&&function(e,t,n){const r=Ca(e);Oi(r._canInitEmulator,r,"emulator-config-failed"),Oi(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=Ma(t),{host:a,port:s}=function(e){const t=Ma(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:$a(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:$a(t)}}}(t),o=null===s?"":`:${s}`;r.config.emulator={url:`${i}//${a}${o}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:s,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})}),function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${i}`),n}(e)}function tm(e){return gf(e)}function nm(e){let t=Yf(e);return{app:t,auth:em(t),db:tm(t)}}function rm(e){(function(e){return Hn(e).signOut()})(e).then((()=>{Xf("User signed out")})).catch((e=>{Xf("Signout error")}))}function im(e){let t=bn(e);return t.note_on=function(e,n,r){let i=N.midi_encoder.note_on(e,n,r);t.write(i)},t.note_off=function(e,n,r){let i=Uint8Array.from([128+e,n,r]);t.write(i)},t.control_change=function(e,n,r){let i=N.midi_encoder.control_change(e,n,r);t.write(i)},t}const am=N.logger.get_logger({id:"sensors"});var sm=!1,om=!1,lm={},um={};function cm(e){let t="default.motion.logger";dm(t,(function(e){let{acceleration:t,rotationRate:n}=e,{x:r,y:i,z:a}=t,{alpha:s,beta:o,gamma:l}=n;am(`x,y,z,alpha,beta,gamma=${r},${i},${a},${s},${o},${l}`)})),window.setTimeout((function(){fm(t)}),1e3*e)}function hm(e){let t="default.orientation.logger";pm(t,(function(e){let{alpha:t,beta:n,gamma:r}=e;am(`alpha,beta,gamma=${t},${n},${r}`)})),window.setTimeout((function(){mm(t)}),1e3*e)}function dm(e,t){vm(),lm[e]&&am(`WARNING! motion subscription id ${e} has already been used`),lm[e]=t}function pm(e,t){bm(),um[e]&&am(`WARNING! orientation subscription id ${e} has already been used`),um[e]=t}function fm(e){delete lm[e],am(`Unsubscribed motion id: ${e}`),N.fp.is_empty_array(N.fp.keys(lm))&&(am("No more motion subscribers; so listener will be detached"),wm())}function mm(e){delete um[e],am(`Unsubscribed orientation id: ${e}`),N.fp.is_empty_array(N.fp.keys(um))&&(am("No more orientation subscribers; so listener will be detached"),_m())}function gm(e){N.fp.values(lm).map((t=>t(e)))}function ym(e){N.fp.values(um).map((t=>t(e)))}function vm(){sm||(window.addEventListener("devicemotion",gm),am("Started listening to device motion (registered handler"),sm=!0)}function bm(){om||(window.addEventListener("deviceorientation",ym),am("Started listening to device orientation (registered handler"),om=!0)}function wm(){window.removeEventListener("devicemotion",gm),sm=!1,am("Unregistered device motion handler")}function _m(){window.removeEventListener("deviceorientation",ym),om=!1,am("Unregistered device orientation handler")}const km=N.logger.get_logger({id:"idbmod"});class Am{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._db=null,this._dbp=new Promise(((n,r)=>{let i=this;const a=indexedDB.open(e,1);a.onerror=()=>r(a.error),a.onsuccess=function(){n(a.result),i._db=a.result},a.onupgradeneeded=()=>{km(`creating store: ${e},  ${t}`),a.result.createObjectStore(t)}}))}_withIDBStore(e,t){return this._dbp.then((n=>new Promise(((r,i)=>{const a=n.transaction(this.storeName,e);a.oncomplete=()=>r(),a.onabort=a.onerror=()=>i(a.error),t(a.objectStore(this.storeName))}))))}get_db(){return this._db}}let Pm;function Tm(){return Pm||(Pm=new Am),Pm}const Im=N.logger.get_logger({id:"db"}),Em=N.dates,xm={};var Cm=5e3;const Om="main_store",Sm="TIDYSCRIPTS_WEB_";var Nm=null,jm=!1;function Dm(e,t=!0){if(jm||(Im("initializing TTL"),jm=!0,Nm=Dm("TTL")),xm[e])return t&&Im(`getting db from local cache: ${e}`),xm[e];var n=new Am(Sm+e,Om);function r(e,t){return function(e,t,n=Tm()){return n._withIDBStore("readwrite",(n=>{n.put(t,e)}))}(e,t,n)}let i={store:n,set:r,get:function(e){return function(e,t=Tm()){let n;return t._withIDBStore("readonly",(t=>{n=t.get(e)})).then((()=>n.result))}(e,n)},del:function(e){return function(e,t=Tm()){return t._withIDBStore("readwrite",(t=>{t.delete(e)}))}(e,n)},keys:function(){return function(e=Tm()){const t=[];return e._withIDBStore("readonly",(e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}})).then((()=>t))}(n)},clear:function(){return function(e=Tm()){return e._withIDBStore("readwrite",(e=>{e.clear()}))}(n)},set_with_ttl:async function(t){let{id:n,ttl_ms:i,value:a}=t,s=i+Em.ms_now();Im(`In db "${e}" setting "${n}" with ttl_ms ${i}, expiration = ${s}`),await r(n,a),await Nm.set(s,{db_id:e,del_id:n}),Im("done setting with ttl \\(^.^)/")},get_db_store:function(){return n},ready:function(){return n._dbp}};return xm[e]=i,t&&Im(`getting db: ${e}`),i}function Rm(e){Cm=e,Im("Updated cache check interval to "+e+" ms")}var Lm=null;async function Mm(){let e=await Nm.keys(),t=e.length,n=e.filter((e=>e<Em.ms_now())),r=n.length,i=[];for(var a of n){let{db_id:e,del_id:t}=await Nm.get(a),n=Dm(e,!1);await n.del(t),await Nm.del(a),i.push({db_id:e,del_id:t})}Im(`CacheCheck |> ${r}/${t} expired:`),r>0&&Im(i)}function $m(e){Lm&&(Im("Already checking, will clear old interval."),Fm()),Rm(e),Lm=setInterval(Mm,Cm)}function Fm(){clearInterval(Lm),Im("Stopped cache check")}function Vm(e){return window.indexedDB.deleteDatabase(Sm+e)}async function zm(e){let t=Dm(e).get_db_store()._db;return await(n=t,new Promise(((e,t)=>{const r={};if(0===n.objectStoreNames.length)e(JSON.stringify(r));else{const i=n.transaction(n.objectStoreNames,"readonly");i.addEventListener("error",t);for(const t of n.objectStoreNames){const a=[];i.objectStore(t).openCursor().addEventListener("success",(i=>{const s=i.target.result;s?(a.push([s.key,s.value]),s.continue()):(r[t]=a,n.objectStoreNames.length===Object.keys(r).length&&e(JSON.stringify(r)))}))}}})));var n}async function Bm(e,t){let n=Dm(e);await n.ready();let r=n.get_db_store()._db;return await(i=r,a=t,new Promise(((e,t)=>{const n=i.transaction(i.objectStoreNames,"readwrite");n.addEventListener("error",t);var r=JSON.parse(a);for(const t of i.objectStoreNames){let i=0;for(const a of r[t]){let[s,o]=a;n.objectStore(t).add(o,s).addEventListener("success",(()=>{i++,i===r[t].length&&(delete r[t],0===Object.keys(r).length&&e("ok"))}))}}})));var i,a}const Um=N.logger.get_logger({id:"bokeh"});var Hm=!1;async function Gm(){if(window.Bokeh)return void Um("Bokeh is already loaded! Skipping load for now...");if(Hm)return void Um("Bokeh is already loading! Skipping load for now...");Hm=!0;let e="3.0.0",t=[`https://cdn.bokeh.org/bokeh/release/bokeh-${e}.min.js`,`https://cdn.bokeh.org/bokeh/release/bokeh-widgets-${e}.min.js`,`https://cdn.bokeh.org/bokeh/release/bokeh-tables-${e}.min.js`,`https://cdn.bokeh.org/bokeh/release/bokeh-api-${e}.min.js`,`https://cdn.bokeh.org/bokeh/release/bokeh-gl-${e}.min.js`,`https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-${e}.min.js`];for(var n of(Um("Loading scripts"),t))Um(`Loading ${n}`),await jt({src:n,attributes:{crossorigin:"anonymous"}});Um("Done")}function qm(){const e=new Bokeh.ColumnDataSource({data:{x:[0],y:[0]}});let t={width:300,height:100};t.y_range=new Bokeh.Range1d({start:-1,end:1}),t.x_range=new Bokeh.Range1d({start:-1,end:1});const n=new Bokeh.Plot(t),r=new Bokeh.LinearAxis({axis_line_color:null}),i=new Bokeh.LinearAxis({axis_line_color:null});n.add_layout(r,"below"),n.add_layout(i,"left");const a=new Bokeh.Grid({ticker:r.ticker,dimension:0}),s=new Bokeh.Grid({ticker:i.ticker,dimension:1});n.add_layout(a),n.add_layout(s);const o=new Bokeh.Line({x:{field:"x"},y:{field:"y"},line_color:"#666699",line_width:2});return n.add_glyph(o,e),{plot:n,source:e}}const Km=N.util.dsp;N.util.debug;var Wm=null,Jm=null,Zm=null,Qm=null;const Xm=N.logger.get_logger({id:"web_audio"});async function Ym(){return Wm||(Wm=new window.AudioContext,Jm=await window.navigator.mediaDevices.getUserMedia({audio:!0}),Wm)}async function eg(){return Wm?(Xm("Shutting down audio context"),await Wm.close(),tg(),Xm("Done"),null):void Xm("no ctx is active")}function tg(){Xm("Removing mic_callbacks"),sg={}}async function ng(){return Jm||(await Ym(),await window.navigator.mediaDevices.getUserMedia({audio:!0}))}async function rg(){return(await ng()).getAudioTracks()[0].getSettings().sampleRate}async function ig(e){let t=await Ym();return await t.decodeAudioData(e)}async function ag(e){return await ig(await e.arrayBuffer())}var sg={};function og(e,t){sg[e]=t}function lg(e){Object.keys(sg).length>0&&N.fp.apply_function_dictionary_to_object(sg,e)}var ug,cg=!1;async function hg(){if(cg)return Xm("mic already initialized");let e=await Ym(),t=await ng(),n=e.createMediaStreamSource(t);(Zm=e.createAnalyser()).fftSize=2048,ug=new Float32Array(Zm.frequencyBinCount),n.connect(Zm),cg=!0,function e(){requestAnimationFrame(e),Zm.getFloatTimeDomainData(ug),lg(ug)}()}var dg,pg=new Float32Array(1024),fg=new Float32Array(1024);async function mg(e){Xm(`testing diff with ${e} ms`),Zm.getFloatTimeDomainData(pg),window.setTimeout((function(){Zm.getFloatTimeDomainData(fg);let e=JSON.stringify(pg)==JSON.stringify(fg);Xm(`Equality = ${e}`)}),e)}async function gg(e){if(await hg(),Qm)return Xm("sound event detector already initialized"),Qm;let t={threshold:.2,margin:600,audio_buffer_size:ug.length,register_fn:og},n=Object.assign(t,e);return Qm=new dg(n),await Qm.init(),Qm}async function yg(e,t){await Gm();const n=N.fp.range(0,e.length),r=Array.from(e),i=new Bokeh.ColumnDataSource({data:{x:n,y:r}}),a=new Bokeh.Plot({width:300,height:100}),s=new Bokeh.LinearAxis({axis_line_color:null}),o=new Bokeh.LinearAxis({axis_line_color:null});a.add_layout(s,"below"),a.add_layout(o,"left");const l=new Bokeh.Grid({ticker:s.ticker,dimension:0}),u=new Bokeh.Grid({ticker:o.ticker,dimension:1});a.add_layout(l),a.add_layout(u);const c=new Bokeh.Line({x:{field:"x"},y:{field:"y"},line_color:"#666699",line_width:2});a.add_glyph(c,i),Bokeh.Plotting.show(a,document.getElementById(t))}function vg(){return document.querySelector("textarea")}function bg(e){vg().value=e}function wg(){vg().parentElement.querySelector("button").click()}function _g(e){bg(e),wg()}function kg(){window.addEventListener("tidyscripts_web_speech_recognition_result",(function(e){_g(e.detail)})),ht()}"undefined"!=typeof window&&(dg=class extends window.EventTarget{constructor(e){super();let{threshold:t,margin:n,register_fn:r,audio_buffer_size:i}=e;this.threshold=t,this.margin=n,this.register_fn=r,this.log=N.logger.get_logger({id:"snd_evt"}),this.sampling_rate=48e3,this.audio_buffer_size=i,this.tmp_buffer=[],this.tmp_buffer_max_length=10,this.recording_event=!1,this.event_start_time=0,this.time_of_last_detection=performance.now(),this.media_recorder=null}async init(){let e=this;this.register_fn("SED",(function(t){e.handle_data(t)})),this.log("Linked sound event detector to audio source"),this.sampling_rate=await rg(),this.log(`Got sampling rate ${this.sampling_rate}`);let t=this.num_buffers_to_cover_margin();this.log(`Created tmp buffer of size ${t}`),this.tmp_buffer_max_length=t,this.tmp_buffer=N.fp.range(0,t).map((e=>new Float32Array(this.audio_buffer_size)));let n=await ng();this.media_recorder=new window.MediaRecorder(n),this.log("Initialized media recorder")}handle_data(e){this.tmp_buffer.shift(),this.tmp_buffer.push(e),this.analyze_tmp_buffer()}analyze_tmp_buffer(){let e=this.tmp_buffer,t=N.fp.all_true(e.map((e=>Km.mean_abs(e)>this.threshold)));if(this.recording_event){if(t)return void(this.time_of_last_detection=performance.now());let n=N.fp.all_true(e.map((e=>Km.mean_abs(e)<this.threshold))),r=performance.now()-this.time_of_last_detection>this.margin;n&&r&&(this.log("Detected quiet while recording event..."),this.recording_event=!1,this.media_recorder.stop(),this.log("Stopped recording"))}else if(t){let e=this;this.media_recorder.ondataavailable=function(t){let n=t.data,r=new window.CustomEvent("sound_event_ended",{detail:n});e.dispatchEvent(r)},this.media_recorder.start(),this.log("Detected event start"),this.time_since_last_detection=performance.now();let t=new window.Event("sound_event_started");this.dispatchEvent(t),this.recording_event=!0,this.event_start_time=N.util.unix_timestamp_ms()}}samples_to_ms(e){return 1e3*e/this.sampling_rate}ms_to_samples(e){return e*this.sampling_rate/1e3}num_buffers_to_cover_margin(){let e=this.ms_to_samples(this.margin);return Math.ceil(e/this.audio_buffer_size)}});var Ag=null,Pg="";function Tg(e){console.log("new text:"+e)}function Ig(e){_t(e)}function Eg(e){_t(e)}function xg(){console.log("finished stream"),ht()}function Cg(e,t){let n=e;Ag=window.setInterval((function(){let e=document.querySelector(".result-streaming");if(e){let n=e.innerText,r=n.replace(Pg,"");t?Ig(r):Tg(r),Pg=n}else if(""==Pg);else{let e=N.fp.last(Array.from(document.querySelectorAll("div.markdown"))).innerText.replace(Pg,"");t?Ig(e):Tg(e),Pg="",xg()}}),n)}var Og=["Google UK English Female","Google UK English Male","Google UK English","Karen","Rishi"];function Sg(){window.clearInterval(Ag)}function Ng(e){vt(e)}async function jg(){await K(),vt(1.3),bt(Og)}var Dg=2e3;async function Rg(){kg(),await jg(),Cg(Dg,!1)}async function Lg(){kg(),await jg(),Cg(Dg,!0)}})();var o=t;for(var l in s)o[l]=s[l];s.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r);var e=n(515);window.tsw=e})(),r})()));