/*! For license information please see tidyscripts_web_umd.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tidyscripts_web=t():e.tidyscripts_web=t()}(this,(()=>(()=>{var e={515:(e,t,n)=>{var r={78:(e,t)=>{var n={749:(e,t,n)=>{e=n.nmd(e);const r=(e=0)=>t=>`[${38+e};5;${t}m`,i=(e=0)=>(t,n,r)=>`[${38+e};2;${t};${n};${r}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[n,r]of Object.entries(t)){for(const[n,i]of Object.entries(r))t[n]={open:`[${i[0]}m`,close:`[${i[1]}m`},r[n]=t[n],e.set(i[0],i[1]);Object.defineProperty(t,n,{value:r,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=r(),t.color.ansi16m=i(),t.bgColor.ansi256=r(10),t.bgColor.ansi16m=i(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,n)=>e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:n}=t.groups;3===n.length&&(n=n.split("").map((e=>e+e)).join(""));const r=Number.parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},991:(e,t)=>{t.byteLength=function(e){var t=o(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,s=o(e),a=s[0],l=s[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,a,l)),u=0,h=l>0?a-4:a;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===l&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[u++]=255&t),1===l&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],a=16383,o=0,c=r-i;o<c;o+=a)s.push(l(e,o,o+a>c?c:o+a));return 1===i?(t=e[r-1],s.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],s.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),s.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0;a<64;++a)n[a]=s[a],r[s.charCodeAt(a)]=a;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,r){for(var i,s,a=[],o=t;o<r;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(n[(s=i)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},832:e=>{const t=/[\p{Lu}]/u,n=/[\p{Ll}]/u,r=/^[\p{Lu}](?![\p{Lu}])/gu,i=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,a=new RegExp("^"+s.source),o=new RegExp(s.source+i.source,"gu"),l=new RegExp("\\d+"+i.source,"gu"),c=(e,i)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(i={pascalCase:!1,preserveConsecutiveUppercase:!1,...i},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const s=!1===i.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(i.locale),c=!1===i.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(i.locale);return 1===e.length?i.pascalCase?c(e):s(e):(e!==s(e)&&(e=((e,r,i)=>{let s=!1,a=!1,o=!1;for(let l=0;l<e.length;l++){const c=e[l];s&&t.test(c)?(e=e.slice(0,l)+"-"+e.slice(l),s=!1,o=a,a=!0,l++):a&&o&&n.test(c)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=a,a=!1,s=!0):(s=r(c)===c&&i(c)!==c,o=a,a=i(c)===c&&r(c)!==c)}return e})(e,s,c)),e=e.replace(a,""),e=i.preserveConsecutiveUppercase?((e,t)=>(r.lastIndex=0,e.replace(r,(e=>t(e)))))(e,s):s(e),i.pascalCase&&(e=c(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,((e,n)=>t(n))).replace(l,(e=>t(e)))))(e,c))};e.exports=c,e.exports.default=c},409:e=>{e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},985:e=>{var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,r,s,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new i(r,s||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=new Array(s);i<s;i++)a[i]=r[i].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,i,s,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,s),!0;case 6:return u.fn.call(u.context,t,r,i,s,a),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||i&&!o.once||r&&o.context!==r||a(this,s);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||i&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[s]=1===c.length?c[0]:c:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o},46:e=>{var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,s),r(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}m(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,s,a;if(o(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]),void 0===a)a=s[t]=n,++e._eventsCount;else if("function"==typeof a?a=s[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,function(e){console&&console.warn&&console.warn(e)}(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=u.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){r.once&&e.removeEventListener(t,i),n(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var c=l.length,u=f(l,c);for(n=0;n<c;++n)r(u[n],this,t)}return!0},s.prototype.addListener=function(e,t){return c(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return c(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,s,a;if(o(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},75:e=>{e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){var i={key:t,value:e[t]},s={key:r,value:e[r]};return n(i,s)}}),s=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,a;if(Array.isArray(t)){for(a="[",n=0;n<t.length;n++)n&&(a+=","),a+=e(t[n])||"null";return a+"]"}if(null===t)return"null";if(-1!==s.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=s.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(a="",n=0;n<l.length;n++){var c=l[n],u=e(t[c]);u&&(a&&(a+=","),a+=JSON.stringify(c)+":"+u)}return s.splice(o,1),"{"+a+"}"}}(e)}},425:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(985),i=n(856),s=n(147),a=()=>{},o=new i.TimeoutError;t.default=class extends r{constructor(e){var t,n,r,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=a,this._resolveIdle=a,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:s.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(n=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==n?n:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(r=e.interval)||void 0===r?void 0:r.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=a,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=a,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((n,r)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const s=void 0===this._timeout&&void 0===t.timeout?e():i.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&r(o)}));n(await s)}catch(e){r(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},657:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){let r=0,i=e.length;for(;i>0;){const s=i/2|0;let a=r+s;n(e[a],t)<=0?(r=++a,i-=s+1):i=s}return r}},147:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(657);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const n={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(n);const i=r.default(this._queue,n,((e,t)=>t.priority-e.priority));this._queue.splice(i,0,n)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},201:(e,t,n)=>{const r=n(364),i=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class s extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const a=(e,t)=>new Promise(((n,a)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=r.operation(t);o.attempt((async r=>{try{n(await e(r))}catch(e){if(!(e instanceof Error))return void a(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof s)o.stop(),a(e.originalError);else if(e instanceof TypeError&&(l=e.message,!i.includes(l)))o.stop(),a(e);else{((e,t,n)=>{const r=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=r})(e,r,t);try{await t.onFailedAttempt(e)}catch(e){return void a(e)}o.retry(e)||a(o.mainError())}}var l}))}));e.exports=a,e.exports.default=a,e.exports.AbortError=s},856:(e,t,n)=>{const r=n(70);class i extends Error{constructor(e){super(e),this.name="TimeoutError"}}const s=(e,t,n)=>new Promise(((s,a)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void s(e);const o=setTimeout((()=>{if("function"==typeof n){try{s(n())}catch(e){a(e)}return}const r=n instanceof Error?n:new i("string"==typeof n?n:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),a(r)}),t);r(e.then(s,a),(()=>{clearTimeout(o)}))}));e.exports=s,e.exports.default=s,e.exports.TimeoutError=i},70:e=>{e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},364:(e,t,n)=>{e.exports=n(386)},386:(e,t,n)=>{var r=n(884);t.operation=function(e){var n=t.timeouts(e);return new r(n,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<t.retries;i++)r.push(this.createTimeout(i,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(i,t)),r.sort((function(e,t){return e-t})),r},t.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},t.wrap=function(e,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var i in r=[],e)"function"==typeof e[i]&&r.push(i);for(var s=0;s<r.length;s++){var a=r[s],o=e[a];e[a]=function(r){var i=t.operation(n),s=Array.prototype.slice.call(arguments,1),a=s.pop();s.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),a.apply(this,arguments))})),i.attempt((function(){r.apply(e,s)}))}.bind(e,o),e[a].options=n}}},884:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],s=i.message,a=(e[s]||0)+1;e[s]=a,a>=n&&(t=i,n=a)}return t}},236:e=>{e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={id:e,loaded:!1,exports:{}};return n[e](s,s.exports,i),s.loaded=!0,s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var s={};(()=>{i.r(s),i.d(s,{R:()=>n,apis:()=>B,asnc:()=>p,dates:()=>z,external:()=>H,fp:()=>t,get_json_from_url:()=>qF,insights:()=>G,logger:()=>e,midi_encoder:()=>V,reflections:()=>F,tes:()=>q,tobi:()=>K,trading:()=>o,util:()=>d});var e={};i.r(e),i.d(e,{clear_all_logs:()=>At,color_string:()=>Pt,colors:()=>Tt,export_logs:()=>kt,get_logger:()=>_t,suppress:()=>bt,unsuppress:()=>wt});var t={};i.r(t),i.d(t,{add:()=>tr,adder:()=>sr,all_false:()=>rn,all_true:()=>tn,any_false:()=>sn,any_is_array:()=>jn,any_true:()=>nn,apply_function_dictionary_to_object:()=>dr,async_apply_function_dictionary_to_object:()=>pr,clone:()=>fn,clone_array:()=>Kt,concat:()=>wn,concat_accross_index:()=>pn,dict_to_list:()=>Ht,diff:()=>cr,divide:()=>ir,divider:()=>or,enumerate:()=>un,enumermap:()=>bn,equals:()=>ur,filter:()=>Cn,filter_key:()=>On,filter_key_equals:()=>Sn,first:()=>Wt,flat_once:()=>Dn,format:()=>er,fourth:()=>Qt,get:()=>Rt,getter:()=>Mt,im_arr_rm:()=>gn,im_push:()=>mn,indexer:()=>en,invert_dictionary:()=>qt,is_array:()=>Hn,is_empty:()=>xn,is_empty_array:()=>En,is_empty_map:()=>Bt,is_empty_string:()=>Wn,is_map:()=>Kn,is_null:()=>Bn,is_object:()=>qn,is_something:()=>zn,is_string:()=>Gn,is_undefined:()=>Vn,is_zero:()=>Pn,join:()=>Qn,joiner:()=>Xn,keys:()=>Ot,last:()=>Xt,len:()=>Tn,list_to_dict:()=>Fn,make_debouncer:()=>hr,map:()=>cn,map_get:()=>_n,map_indexed:()=>It,map_items:()=>zt,map_over_dic_values:()=>Gt,map_prop:()=>hn,map_prop_reduce:()=>dn,map_set:()=>kn,map_set_im:()=>An,merge_dictionaries:()=>Dt,merge_dictionary:()=>jt,multiplier:()=>lr,multiply:()=>rr,nchars:()=>Zn,not_empty:()=>In,nth:()=>Yt,partition:()=>vn,rand_element:()=>on,range:()=>ln,recursive_flat:()=>Rn,recursive_flat_remove_empty:()=>$n,remove_empty:()=>Nn,repeat:()=>an,second:()=>Jt,set:()=>$t,set_im:()=>Lt,setter:()=>Ft,setter_im:()=>Ut,shallow_copy:()=>Ct,sort_by_prop:()=>yn,split:()=>Yn,substring:()=>Jn,subtract:()=>nr,subtractor:()=>ar,third:()=>Zt,update_at:()=>Vt,values:()=>Nt,values_cloned:()=>St,zip:()=>Mn,zip2:()=>Ln,zip_map:()=>Un});var n={};i.r(n),i.d(n,{F:()=>fr,T:()=>mr,__:()=>gr,add:()=>vr,addIndex:()=>ne,addIndexRight:()=>wr,adjust:()=>kr,all:()=>Er,allPass:()=>Nr,always:()=>jr,and:()=>Rr,andThen:()=>hh,any:()=>Mr,anyPass:()=>Ur,ap:()=>zr,aperture:()=>Gr,append:()=>Kr,apply:()=>Wr,applySpec:()=>Yr,applyTo:()=>ti,ascend:()=>ri,assoc:()=>ui,assocPath:()=>li,binary:()=>pi,bind:()=>lt,both:()=>yi,call:()=>vi,chain:()=>Ei,clamp:()=>Ii,clone:()=>ji,collectBy:()=>Ri,comparator:()=>Li,complement:()=>Ui,compose:()=>Ji,composeWith:()=>ns,concat:()=>Ze,cond:()=>is,construct:()=>ls,constructN:()=>os,converge:()=>us,count:()=>ds,countBy:()=>gs,curry:()=>ss,curryN:()=>ee,dec:()=>ys,defaultTo:()=>bs,descend:()=>_s,difference:()=>Ts,differenceWith:()=>xs,dissoc:()=>js,dissocPath:()=>Ss,divide:()=>Rs,drop:()=>Ms,dropLast:()=>zs,dropLastWhile:()=>Gs,dropRepeats:()=>Qs,dropRepeatsBy:()=>ta,dropRepeatsWith:()=>Zs,dropWhile:()=>ia,either:()=>la,empty:()=>ua,endsWith:()=>fa,eqBy:()=>Ys,eqProps:()=>ga,equals:()=>je,evolve:()=>va,filter:()=>Ge,find:()=>_a,findIndex:()=>Pa,findLast:()=>xa,findLastIndex:()=>Oa,flatten:()=>Sa,flip:()=>ja,forEach:()=>Ra,forEachObjIndexed:()=>La,fromPairs:()=>Fa,groupBy:()=>Ua,groupWith:()=>Va,gt:()=>Ha,gte:()=>qa,has:()=>Za,hasIn:()=>Xa,hasPath:()=>Wa,head:()=>Zi,identical:()=>eo,identity:()=>Xi,ifElse:()=>to,inc:()=>no,includes:()=>ro,indexBy:()=>io,indexOf:()=>so,init:()=>ao,innerJoin:()=>lo,insert:()=>uo,insertAll:()=>po,intersection:()=>bo,intersperse:()=>_o,into:()=>Co,invert:()=>So,invertObj:()=>jo,invoker:()=>Do,is:()=>Ro,isEmpty:()=>Lo,isNil:()=>ai,isNotNil:()=>Fo,join:()=>Uo,juxt:()=>Vo,keys:()=>_e,keysIn:()=>Ho,last:()=>Ws,lastIndexOf:()=>Go,length:()=>Wo,lens:()=>Zo,lensIndex:()=>el,lensPath:()=>al,lensProp:()=>ll,lift:()=>mi,liftN:()=>fi,lt:()=>ul,lte:()=>dl,map:()=>Ae,mapAccum:()=>fl,mapAccumRight:()=>gl,mapObjIndexed:()=>vl,match:()=>wl,mathMod:()=>kl,max:()=>Ir,maxBy:()=>Pl,mean:()=>xl,median:()=>Cl,memoizeWith:()=>Sl,mergeAll:()=>jl,mergeDeepLeft:()=>Ml,mergeDeepRight:()=>Fl,mergeDeepWith:()=>Ul,mergeDeepWithKey:()=>Ll,mergeLeft:()=>Vl,mergeRight:()=>Hl,mergeWith:()=>ql,mergeWithKey:()=>Rl,min:()=>Wl,minBy:()=>Zl,modify:()=>ec,modifyPath:()=>Xl,modulo:()=>nc,move:()=>ic,multiply:()=>ac,nAry:()=>di,negate:()=>uc,none:()=>hc,not:()=>Fi,nth:()=>Ye,nthArg:()=>pc,o:()=>mc,objOf:()=>Po,of:()=>gc,omit:()=>vc,on:()=>wc,once:()=>_c,or:()=>aa,otherwise:()=>Pc,over:()=>xc,pair:()=>Ic,partial:()=>Oc,partialObject:()=>lc,partialRight:()=>Sc,partition:()=>Nc,path:()=>il,pathEq:()=>Dc,pathOr:()=>$c,pathSatisfies:()=>Mc,paths:()=>nl,pick:()=>Uc,pickAll:()=>Vc,pickBy:()=>Hc,pipe:()=>qi,pipeWith:()=>es,pluck:()=>Or,prepend:()=>qc,product:()=>Kc,project:()=>Jc,promap:()=>Xc,prop:()=>tt,propEq:()=>eu,propIs:()=>nu,propOr:()=>iu,propSatisfies:()=>au,props:()=>lu,range:()=>uu,reduce:()=>pt,reduceBy:()=>ms,reduceRight:()=>du,reduceWhile:()=>fu,reduced:()=>mu,reject:()=>qe,remove:()=>Cs,repeat:()=>bu,replace:()=>_u,reverse:()=>Wi,scan:()=>Eu,sequence:()=>Iu,set:()=>Ou,slice:()=>Hi,sort:()=>Nu,sortBy:()=>Du,sortWith:()=>$u,split:()=>Lu,splitAt:()=>Fu,splitEvery:()=>Bu,splitWhen:()=>zu,splitWhenever:()=>Gu,startsWith:()=>Ku,subtract:()=>Ju,sum:()=>Tl,swap:()=>Xu,symmetricDifference:()=>Yu,symmetricDifferenceWith:()=>eh,tail:()=>Gi,take:()=>Bs,takeLast:()=>da,takeLastWhile:()=>th,takeWhile:()=>ih,tap:()=>oh,test:()=>ch,thunkify:()=>yd,times:()=>yu,toLower:()=>dh,toPairs:()=>fh,toPairsIn:()=>gh,toString:()=>We,toUpper:()=>yh,transduce:()=>bh,transpose:()=>_h,traverse:()=>Ah,trim:()=>Eh,tryCatch:()=>Ih,type:()=>Ce,unapply:()=>Ch,unary:()=>Oh,uncurryN:()=>Nh,unfold:()=>Dh,union:()=>Rh,unionWith:()=>Fh,uniq:()=>yo,uniqBy:()=>go,uniqWith:()=>Mh,unless:()=>Bh,unnest:()=>Vh,until:()=>Hh,unwind:()=>qh,update:()=>Xo,useWith:()=>Wc,values:()=>Zr,valuesIn:()=>Wh,view:()=>Qh,when:()=>Yh,where:()=>td,whereAny:()=>rd,whereEq:()=>id,without:()=>ad,xor:()=>ld,xprod:()=>ud,zip:()=>dd,zipObj:()=>fd,zipWith:()=>gd});var r={};i.r(r),i.d(r,{MarketTradeType:()=>vd,PortfolioBalancer:()=>bd});var a={};i.r(a),i.d(a,{BacktestBalancer:()=>wd});var o={};i.r(o),i.d(o,{backtest_balancer:()=>a,portfolio_balancer_lib:()=>r});var l={};i.r(l),i.d(l,{abs:()=>Pd,flat_float32_array:()=>Id,length:()=>_d,mean:()=>Td,mean_abs:()=>Ed,min_max_mean:()=>xd,power:()=>kd,sum:()=>Ad});var c={};i.r(c),i.d(c,{ms:()=>Cd});var u={};i.r(u),i.d(u,{add:()=>Nd,db:()=>Sd,get:()=>jd,log:()=>Od});var h={};i.r(h),i.d(h,{prepend_timestamp_as_bytes:()=>Rd,timestampToByteArray:()=>Dd});var d={};i.r(d),i.d(d,{bytes:()=>h,debug:()=>u,dsp:()=>l,is_browser:()=>$d,is_json_string:()=>Fd,is_node:()=>Ld,performance:()=>c,unix_timestamp_ms:()=>Md});var p={};i.r(p),i.d(p,{status:()=>Bd,wait:()=>Hd,wait_until:()=>zd});var f={};i.r(f),i.d(f,{ai_cds:()=>Jd,ask_ai:()=>qd,clean_json_string:()=>Gd,example_patient:()=>Kd,generate_patient_data:()=>Zd,generate_prompt:()=>Wd});var m={};i.r(m),i.d(m,{code:()=>Qd});var g={};i.r(g),i.d(g,{build_index:()=>op,get_medications:()=>np,index:()=>tp,init:()=>rp,medications:()=>ep,parse_ar_text:()=>up,parse_subsection_1:()=>lp,parse_subsection_2:()=>cp,raw_medications:()=>Yd,search_for_medication:()=>ip,search_for_side_effect:()=>sp});var y={};i.r(y),i.d(y,{JsonPatchError:()=>ak,_areEquals:()=>gk,applyOperation:()=>hk,applyPatch:()=>dk,applyReducer:()=>pk,deepClone:()=>ok,getValueByPointer:()=>uk,validate:()=>mk,validator:()=>fk});var v={};i.r(v),i.d(v,{get_chat_model:()=>aP});var b={};i.r(b),i.d(b,{clean_json_string:()=>pP,generate_loinc:()=>dP,generate_random_fhir_patient:()=>uP,generic_completion_json:()=>cP,get_fhir_data:()=>hP,get_openai:()=>lP});var w={};i.r(w),i.d(w,{call_structured_completion:()=>VP,generic_completion_json_structured:()=>HP,get_embedding:()=>GP,get_openai:()=>BP,test_1:()=>zP});var _={};i.r(_),i.d(_,{empty_prompt:()=>qP});var k={};i.r(k),i.d(k,{evaluation:()=>rT,evaluation_without_supplementary_data:()=>iT,extraction:()=>XP,medication_evaluation_prompt:()=>YP,medication_evaluation_prompt_without_supplementary_data:()=>eT,medication_evaluation_response_format:()=>nT,medication_extraction_prompt:()=>JP,medication_extraction_response_format:()=>QP,patient_information_placeholder:()=>KP,supplementary_information_placeholder:()=>WP});var A={};i.r(A),i.d(A,{general:()=>_,medications:()=>k});var P={};i.r(P),i.d(P,{empty_data:()=>sT});var T={};i.r(T),i.d(T,{hp:()=>lT,info:()=>oT,name:()=>aT});var E={};i.r(E),i.d(E,{copd_vap:()=>cT,hp:()=>hT,info:()=>uT});var x={};i.r(x),i.d(x,{copd_vap:()=>E,esrd_hyperkalemia_losartan:()=>T});var I={};i.r(I),i.d(I,{ap:()=>P,hp:()=>x});var C={};i.r(C),i.d(C,{BaseEngine:()=>fT,base_llm_args:()=>pT});var O={};i.r(O),i.d(O,{MedicationEngine:()=>wT});var S={};i.r(S),i.d(S,{base_engine:()=>C,medications:()=>O});var N={};i.r(N),i.d(N,{init:()=>kT,main:()=>AT});var j={};i.r(j),i.d(j,{engines:()=>S,init:()=>TT,prompting:()=>A,tamie:()=>N,test_data:()=>I});var D={};i.r(D),i.d(D,{get_sentences:()=>$L,nlp:()=>DL,parse:()=>RL});var $={};i.r($),i.d($,{buffer_to_hex:()=>UL,object_hash_short:()=>VL,object_sha256:()=>BL,sha256:()=>FL,uuid_from_text:()=>zL});var L={};i.r(L),i.d(L,{embedding1024:()=>qL,embedding1536:()=>JL,get_cloud_embedding:()=>WL,prompt:()=>GL,structured_prompt:()=>KL});var M={};i.r(M),i.d(M,{BaseCache:()=>ZL,CacheFactory:()=>QL,CacheUtils:()=>XL,MemoizationTests:()=>eM,MemoryCache:()=>YL});var F={};i.r(F),i.d(F,{ReflectionsClient:()=>nM,createClient:()=>iM,getDefaultClient:()=>sM,setDefaultClient:()=>aM});var U={};i.r(U),i.d(U,{Channel:()=>gM,CodeOutputResponseFormat:()=>$M,CodeOutputSchema:()=>LM,CodeOutputSchemaName:()=>MM,Cortex:()=>HM,CortexOutputResponseFormat:()=>jM,CortexOutputSchema:()=>DM,CortexOutputSchemaName:()=>RM,DEFAULT_CORTEX_SECTIONS:()=>fM,DEFAULT_SANDBOX_TIMEOUT:()=>yM,LEGACY_CORTEX_SECTIONS:()=>pM,MODEL_REGISTRY:()=>EM,PromptManager:()=>mM,buildPrompt:()=>dM,calculateDrift:()=>PM,codeOutputFormat:()=>hM,cortexOutputFormat:()=>uM,countMessageTokens:()=>kM,countTokens:()=>wM,countTokensEstimate:()=>_M,extractJsonSchema:()=>FM,generate_system_msg:()=>VM,getModelInfo:()=>IM,getRegisteredModels:()=>CM,getTokenBreakdown:()=>AM,get_function_dictionary:()=>UM,get_functions_string:()=>BM,get_variable_hash_id:()=>zM,sections:()=>cM,suggestRatioAdjustment:()=>TM,syntax:()=>oM});var B={};i.r(B),i.d(B,{OpenAI:()=>dv,aidx:()=>f,ailand:()=>L,amie:()=>j,cache:()=>M,cortex:()=>U,cryptography:()=>$,data_generator:()=>b,langchain:()=>v,loinc:()=>m,medications:()=>g,oai:()=>w,reflections:()=>F,tnlp:()=>D});var V={};i.r(V),i.d(V,{control_change:()=>KM,note_off:()=>qM,note_on:()=>GM});var z={};i.r(z),i.d(z,{copy_date:()=>tF,dates_eq:()=>eF,day_string:()=>nF,iso_day_filename:()=>QM,iso_now:()=>JM,ms_now:()=>YM,round_date:()=>rF,shift_date:()=>iF,times_in_ms:()=>sF,to_iso:()=>WM,to_iso_day_filename:()=>ZM,to_ms:()=>XM});var H={};i.r(H),i.d(H,{string_comparison:()=>gF});var G={};i.r(G),i.d(G,{CommonEventTypes:()=>yF,InsightsClient:()=>PF,createClient:()=>EF,generateEventId:()=>_F,generateSessionId:()=>wF,generateTraceId:()=>kF,getDefaultClient:()=>xF,setDefaultClient:()=>IF});var q={};i.r(q),i.d(q,{cloud:()=>RF,cloud_tes_call:()=>jF,local_tes_call:()=>NF,localhost:()=>DF});var K={};function W(e,t){var n;t=t||[];var r=(e=e||[]).length,i=t.length,s=[];for(n=0;n<r;)s[s.length]=e[n],n+=1;for(n=0;n<i;)s[s.length]=t[n],n+=1;return s}function J(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function Z(e){return function t(n){return 0===arguments.length||J(n)?t:e.apply(this,arguments)}}function Q(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,r){return t.apply(this,arguments)};case 4:return function(e,n,r,i){return t.apply(this,arguments)};case 5:return function(e,n,r,i,s){return t.apply(this,arguments)};case 6:return function(e,n,r,i,s,a){return t.apply(this,arguments)};case 7:return function(e,n,r,i,s,a,o){return t.apply(this,arguments)};case 8:return function(e,n,r,i,s,a,o,l){return t.apply(this,arguments)};case 9:return function(e,n,r,i,s,a,o,l,c){return t.apply(this,arguments)};case 10:return function(e,n,r,i,s,a,o,l,c,u){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function X(e){return function t(n,r){switch(arguments.length){case 0:return t;case 1:return J(n)?t:Z((function(t){return e(n,t)}));default:return J(n)&&J(r)?t:J(n)?Z((function(t){return e(t,r)})):J(r)?Z((function(t){return e(n,t)})):e(n,r)}}}function Y(e,t,n){return function(){for(var r=[],i=0,s=e,a=0,o=!1;a<t.length||i<arguments.length;){var l;a<t.length&&(!J(t[a])||i>=arguments.length)?l=t[a]:(l=arguments[i],i+=1),r[a]=l,J(l)?o=!0:s-=1,a+=1}return!o&&s<=0?n.apply(this,r):Q(Math.max(0,s),Y(e,r,n))}}i.r(K),i.d(K,{TobiClient:()=>LF,bar_chart:()=>VF,createClient:()=>MF,display_object:()=>HF,getDefaultClient:()=>UF,send:()=>BF,time_series_chart:()=>zF});const ee=X((function(e,t){return 1===e?Z(t):Q(e,Y(e,[],t))}));var te=Z((function(e){return ee(e.length,(function(){var t=0,n=arguments[0],r=arguments[arguments.length-1],i=Array.prototype.slice.call(arguments,0);return i[0]=function(){var e=n.apply(this,W(arguments,[t,r]));return t+=1,e},e.apply(this,i)}))}));const ne=te;function re(e,t,n){for(var r=0,i=n.length;r<i;)t=e(t,n[r]),r+=1;return t}const ie=Array.isArray||function(e){return null!=e&&e.length>=0&&"[object Array]"===Object.prototype.toString.call(e)};function se(e){return null!=e&&"function"==typeof e["@@transducer/step"]}function ae(e,t,n){return function(){if(0===arguments.length)return n();var r=arguments[arguments.length-1];if(!ie(r)){for(var i=0;i<e.length;){if("function"==typeof r[e[i]])return r[e[i]].apply(r,Array.prototype.slice.call(arguments,0,-1));i+=1}if(se(r))return t.apply(null,Array.prototype.slice.call(arguments,0,-1))(r)}return n.apply(this,arguments)}}function oe(e,t){for(var n=0,r=t.length,i=Array(r);n<r;)i[n]=e(t[n]),n+=1;return i}const le=function(){return this.xf["@@transducer/init"]()},ce=function(e){return this.xf["@@transducer/result"](e)};var ue=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,this.f(t))},e}();const he=function(e){return function(t){return new ue(e,t)}};function de(e,t){return Object.prototype.hasOwnProperty.call(t,e)}var pe=Object.prototype.toString,fe=function(){return"[object Arguments]"===pe.call(arguments)?function(e){return"[object Arguments]"===pe.call(e)}:function(e){return de("callee",e)}}();const me=fe;var ge=!{toString:null}.propertyIsEnumerable("toString"),ye=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],ve=function(){return arguments.propertyIsEnumerable("length")}(),be=function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1},we="function"!=typeof Object.keys||ve?Z((function(e){if(Object(e)!==e)return[];var t,n,r=[],i=ve&&me(e);for(t in e)!de(t,e)||i&&"length"===t||(r[r.length]=t);if(ge)for(n=ye.length-1;n>=0;)de(t=ye[n],e)&&!be(r,t)&&(r[r.length]=t),n-=1;return r})):Z((function(e){return Object(e)!==e?[]:Object.keys(e)}));const _e=we;var ke=X(ae(["fantasy-land/map","map"],he,(function(e,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return ee(t.length,(function(){return e.call(this,t.apply(this,arguments))}));case"[object Object]":return re((function(n,r){return n[r]=e(t[r]),n}),{},_e(t));default:return oe(e,t)}})));const Ae=ke;function Pe(e){var t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t||"[object GeneratorFunction]"===t||"[object AsyncGeneratorFunction]"===t}function Te(e){return"[object String]"===Object.prototype.toString.call(e)}function Ee(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}function xe(e,t,n){for(var r=0,i=n.length;r<i;){if(e(t,n[r]))return!0;r+=1}return!1}const Ie="function"==typeof Object.is?Object.is:function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},Ce=Z((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function Oe(e,t,n,r){var i=Ee(e);function s(e,t){return Se(e,t,n.slice(),r.slice())}return!xe((function(e,t){return!xe(s,t,e)}),Ee(t),i)}function Se(e,t,n,r){if(Ie(e,t))return!0;var i=Ce(e);if(i!==Ce(t))return!1;if("function"==typeof e["fantasy-land/equals"]||"function"==typeof t["fantasy-land/equals"])return"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t)&&"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e);if("function"==typeof e.equals||"function"==typeof t.equals)return"function"==typeof e.equals&&e.equals(t)&&"function"==typeof t.equals&&t.equals(e);switch(i){case"Arguments":case"Array":case"Object":if("function"==typeof e.constructor&&"Promise"===function(e){var t=String(e).match(/^function (\w*)/);return null==t?"":t[1]}(e.constructor))return e===t;break;case"Boolean":case"Number":case"String":if(typeof e!=typeof t||!Ie(e.valueOf(),t.valueOf()))return!1;break;case"Date":if(!Ie(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(e.source!==t.source||e.global!==t.global||e.ignoreCase!==t.ignoreCase||e.multiline!==t.multiline||e.sticky!==t.sticky||e.unicode!==t.unicode)return!1}for(var s=n.length-1;s>=0;){if(n[s]===e)return r[s]===t;s-=1}switch(i){case"Map":return e.size===t.size&&Oe(e.entries(),t.entries(),n.concat([e]),r.concat([t]));case"Set":return e.size===t.size&&Oe(e.values(),t.values(),n.concat([e]),r.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var a=_e(e);if(a.length!==_e(t).length)return!1;var o=n.concat([e]),l=r.concat([t]);for(s=a.length-1;s>=0;){var c=a[s];if(!de(c,t)||!Se(t[c],e[c],o,l))return!1;s-=1}return!0}var Ne=X((function(e,t){return Se(e,t,[],[])}));const je=Ne;function De(e,t,n){var r,i;if("function"==typeof e.indexOf)switch(typeof t){case"number":if(0===t){for(r=1/t;n<e.length;){if(0===(i=e[n])&&1/i===r)return n;n+=1}return-1}if(t!=t){for(;n<e.length;){if("number"==typeof(i=e[n])&&i!=i)return n;n+=1}return-1}return e.indexOf(t,n);case"string":case"boolean":case"function":case"undefined":return e.indexOf(t,n);case"object":if(null===t)return e.indexOf(t,n)}for(;n<e.length;){if(je(e[n],t))return n;n+=1}return-1}function Re(e,t){return De(t,e,0)>=0}function $e(e){return'"'+e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0").replace(/"/g,'\\"')+'"'}var Le=function(e){return(e<10?"0":"")+e},Me="function"==typeof Date.prototype.toISOString?function(e){return e.toISOString()}:function(e){return e.getUTCFullYear()+"-"+Le(e.getUTCMonth()+1)+"-"+Le(e.getUTCDate())+"T"+Le(e.getUTCHours())+":"+Le(e.getUTCMinutes())+":"+Le(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};const Fe=Me;function Ue(e){return function(){return!e.apply(this,arguments)}}function Be(e,t){for(var n=0,r=t.length,i=[];n<r;)e(t[n])&&(i[i.length]=t[n]),n+=1;return i}function Ve(e){return"[object Object]"===Object.prototype.toString.call(e)}var ze=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){return this.f(t)?this.xf["@@transducer/step"](e,t):e},e}(),He=X(ae(["fantasy-land/filter","filter"],(function(e){return function(t){return new ze(e,t)}}),(function(e,t){return Ve(t)?re((function(n,r){return e(t[r])&&(n[r]=t[r]),n}),{},_e(t)):Be(e,t)})));const Ge=He,qe=X((function(e,t){return Ge(Ue(e),t)}));function Ke(e,t){var n=function(n){var r=t.concat([e]);return Re(n,r)?"<Circular>":Ke(n,r)},r=function(e,t){return oe((function(t){return $e(t)+": "+n(e[t])}),t.slice().sort())};switch(Object.prototype.toString.call(e)){case"[object Arguments]":return"(function() { return arguments; }("+oe(n,e).join(", ")+"))";case"[object Array]":return"["+oe(n,e).concat(r(e,qe((function(e){return/^\d+$/.test(e)}),_e(e)))).join(", ")+"]";case"[object Boolean]":return"object"==typeof e?"new Boolean("+n(e.valueOf())+")":e.toString();case"[object Date]":return"new Date("+(isNaN(e.valueOf())?n(NaN):$e(Fe(e)))+")";case"[object Map]":return"new Map("+n(Array.from(e))+")";case"[object Null]":return"null";case"[object Number]":return"object"==typeof e?"new Number("+n(e.valueOf())+")":1/e==-1/0?"-0":e.toString(10);case"[object Set]":return"new Set("+n(Array.from(e).sort())+")";case"[object String]":return"object"==typeof e?"new String("+n(e.valueOf())+")":$e(e);case"[object Undefined]":return"undefined";default:if("function"==typeof e.toString){var i=e.toString();if("[object Object]"!==i)return i}return"{"+r(e,_e(e)).join(", ")+"}"}}const We=Z((function(e){return Ke(e,[])}));var Je=X((function(e,t){if(ie(e)){if(ie(t))return e.concat(t);throw new TypeError(We(t)+" is not an array")}if(Te(e)){if(Te(t))return e+t;throw new TypeError(We(t)+" is not a string")}if(null!=e&&Pe(e["fantasy-land/concat"]))return e["fantasy-land/concat"](t);if(null!=e&&Pe(e.concat))return e.concat(t);throw new TypeError(We(e)+' does not have a method named "concat" or "fantasy-land/concat"')}));const Ze=Je,Qe=Number.isInteger||function(e){return(0|e)===e};var Xe=X((function(e,t){var n=e<0?t.length+e:e;return Te(t)?t.charAt(n):t[n]}));const Ye=Xe;var et=X((function(e,t){if(null!=t)return Qe(e)?Ye(e,t):t[e]}));const tt=et;function nt(e){return function t(n,r,i){switch(arguments.length){case 0:return t;case 1:return J(n)?t:X((function(t,r){return e(n,t,r)}));case 2:return J(n)&&J(r)?t:J(n)?X((function(t,n){return e(t,r,n)})):J(r)?X((function(t,r){return e(n,t,r)})):Z((function(t){return e(n,r,t)}));default:return J(n)&&J(r)&&J(i)?t:J(n)&&J(r)?X((function(t,n){return e(t,n,i)})):J(n)&&J(i)?X((function(t,n){return e(t,r,n)})):J(r)&&J(i)?X((function(t,r){return e(n,t,r)})):J(n)?Z((function(t){return e(t,r,i)})):J(r)?Z((function(t){return e(n,t,i)})):J(i)?Z((function(t){return e(n,r,t)})):e(n,r,i)}}}var rt=Z((function(e){return!!ie(e)||!!e&&"object"==typeof e&&!Te(e)&&(0===e.length||e.length>0&&e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1))}));const it=rt;var st="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function at(e,t,n){return function(r,i,s){if(it(s))return e(r,i,s);if(null==s)return i;if("function"==typeof s["fantasy-land/reduce"])return t(r,i,s,"fantasy-land/reduce");if(null!=s[st])return n(r,i,s[st]());if("function"==typeof s.next)return n(r,i,s);if("function"==typeof s.reduce)return t(r,i,s,"reduce");throw new TypeError("reduce: list must be array or iterable")}}function ot(e,t,n){for(var r=0,i=n.length;r<i;){if((t=e["@@transducer/step"](t,n[r]))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r+=1}return e["@@transducer/result"](t)}const lt=X((function(e,t){return Q(e.length,(function(){return e.apply(t,arguments)}))})),ct=at(ot,(function(e,t,n,r){return e["@@transducer/result"](n[r](lt(e["@@transducer/step"],e),t))}),(function(e,t,n){for(var r=n.next();!r.done;){if((t=e["@@transducer/step"](t,r.value))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r=n.next()}return e["@@transducer/result"](t)}));var ut=function(){function e(e){this.f=e}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(e){return e},e.prototype["@@transducer/step"]=function(e,t){return this.f(e,t)},e}();function ht(e){return new ut(e)}var dt=nt((function(e,t,n){return ct("function"==typeof e?ht(e):e,t,n)}));const pt=dt,ft=[];function mt(){const e=new Date;return`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}.${String(e.getMilliseconds()).padStart(3,"0")}`}function gt(e){if(null==e||null==e)return String(e);if("object"==typeof e)try{return JSON.stringify(e)}catch(e){return"[unstringifiable object]"}return String(e)}function yt(e){return`[${e.time_str}] ${e.msg}`}var vt={};function bt(e,t){vt[e]=!0,_t({id:"log"})(`Suppressing ${e}, reason=${t||"none_given"}`)}function wt(e){vt[e]=!1,_t({id:"log"})(`Unsuppressing ${e}`)}function _t(e){let{id:t}=e;const n=function(...e){const n=e.map(gt),r=`[${t}]:: ${n.join(" ")}`;ft.push({id:t,timestamp:Date.now(),time_str:mt(),msg:r}),vt[t]||console.log(`[${t}]::`,...e)};return n.id=t,n.export_logs=function(){const e=ft.filter((e=>e.id===t));return 0===e.length?`No logs for id: ${t}`:e.map(yt).join("\n")},n.clear_logs=function(){for(let e=ft.length-1;e>=0;e--)ft[e].id===t&&ft.splice(e,1)},n}function kt(e){let t=ft;if(null==e?void 0:e.include){const n=new Set(e.include);t=t.filter((e=>n.has(e.id)))}if(null==e?void 0:e.exclude){const n=new Set(e.exclude);t=t.filter((e=>!n.has(e.id)))}return 0===t.length?"No logs found":t.map(yt).join("\n")}function At(){ft.length=0}function Pt(e,t){return`${Tt[e]}${t}${Tt.reset}`}var Tt={red:"[31m",green:"[32m",reset:"[0m"};const Et=_t({id:"fp"}),xt=ne(Ae);function It(e,t){return xt(((t,n)=>e(n,t)),t)}function Ct(e){return Hn(e)?Kt(e):Kn(e)?fn(e):e}function Ot(e){return Object.keys(e)}function St(e){let t=Ot(e),n=fn(e);return xn(t)?[]:cn(t,(e=>n[e]))}function Nt(e){let t=Ot(e);return xn(t)?[]:cn(t,(t=>e[t]))}function jt(e,t){return Object.assign(fn(e),t)}function Dt(e){return e.reduce(jt,{})}function Rt(e,t){return e[t]}function $t(e,t,n){return e[t]=n,e}function Lt(e,t,n){let r=fn(e);return r[t]=n,r}function Mt(e){return function(t){return t[e]}}function Ft(e,t){return function(n){return $t(n,e,t)}}function Ut(e,t){return function(n){return $t(n,e,t)}}function Bt(e){return Kn(e)&&Pn(Tn(Ot(e)))}function Vt(e,t,n){for(var r=e,i=0;i<t.length-1;i++)r=r[i];let s=Xt(t);return r[s]=n(r[s]),fn(e)}function zt(e){return Ln(Ot(e),Nt(e))}var Ht=zt;function Gt(e,t){let n=cn(Nt(e),t);return Un(Ot(e),n)}function qt(e,t=[]){let n=_e(e),r=[];for(var i of n){let n=e[i];if(Kn(n))qt(n,Ze(t,[i])).map((e=>r.push(e)));else{let e=Ze(t,[i]);r.push({value:n,path:e})}}return r}function Kt(e){return JSON.parse(JSON.stringify(e))}function Wt(e){return e[0]}function Jt(e){return e[1]}function Zt(e){return e[2]}function Qt(e){return e[3]}function Xt(e){return e[e.length-1]}function Yt(e,t){return e[t]}function en(e){return function(t){return Yt(t,e)}}function tn(e){return e.reduce(((e,t)=>e&&t))}function nn(e){return!xn(e)&&e.reduce(((e,t)=>e||t))}function rn(e){return!nn(e)}function sn(e){return!tn(e)}function an(e,t){let n=[];for(var r of ln(t))n.push(Ct(e));return n}function on(e){return e[Math.floor(Math.random()*e.length)]}function ln(e,t=null){if(t){for(var n=Array(t-e).fill(0),r=0;r<n.length;r++)n[r]=r+e;return n}for(n=Array(e).fill(0),r=0;r<n.length;r++)n[r]=r;return n}function cn(e,t){return e.map(t)}function un(e){return It(((e,t)=>[e,t]),e)}function hn(e,t){return Ae(tt(e))(t)}function dn(e,t,n,r){return pt(t,n,hn(e,r))}function pn(e){let t=[],n=e[0].length,r=e.length;for(var i=0;i<n;i++){for(var s=new Array,a=0;a<r;a++)s.push(e[a][i]);t.push(s)}return t}function fn(e){return JSON.parse(JSON.stringify(e))}function mn(e,t){let n=fn(e);return n.push(t),n}function gn(e,t){return fn(e).filter((e=>!(e==t)))}function yn(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,r){return(n[e]<r[e]?-1:n[e]>r[e]?1:0)*t}}function vn(e,t){let n=Math.ceil(e.length/t),r=Array(n).fill(null).map((e=>new Array)),i=0;for(var s=0;s<e.length;s++)s%t==0&&0!=s&&(i+=1),r[i].push(e[s]);return r}function bn(e,t){let n=[];for(var[r,i]of un(e))n.push(t(r,i));return n}function wn(e,t){return e.concat(t)}function _n(e,t){return cn(e,Mt(t))}function kn(e,t,n){return cn(e,Ft(t,n))}function An(e,t,n){return cn(e,Ut(t,n))}function Pn(e){return 0==e}function Tn(e){return e.length}function En(e){return Hn(e)&&Pn(Tn(e))}function xn(e){return Bn(e)||Vn(e)||En(e)||Wn(e)||Bt(e)}function In(e){return!xn(e)}function Cn(e,t){return e.filter(t)}function On(e,t,n){return Cn(e,(e=>n(Rt(e,t))))}function Sn(e,t,n){return On(e,t,(e=>e==n))}function Nn(e){return Cn(e,In)}function jn(e){return nn(cn(e,Hn))}function Dn(e){return e.flat()}function Rn(e){return jn(e)?Rn(Dn(e)):e}function $n(e){return Nn(Rn(e))}function Ln(e,t){let n=[];for(var r=0;r<e.length;r++)n.push([e[r],t[r]]);return n}var Mn=Ln;function Fn(e){let t={};for(var[n,r]of e)t[n]=r;return t}function Un(e,t){return Fn(Mn(e,t))}function Bn(e){return null==e}function Vn(e){return null==e}function zn(e){return!(Bn(e)||Vn(e))}function Hn(e){return zn(e)&&e.constructor==Array}function Gn(e){return zn(e)&&e.constructor==String}function qn(e){return zn(e)&&e.constructor==Object}function Kn(e){return zn(e)&&qn(e)&&!Hn(e)}function Wn(e){return""==e}function Jn(e,t,n){return e.substring(t,n)}function Zn(e,t){return Jn(e,0,t)}function Qn(e,t){return e.join(t)}function Xn(e){return function(t){return Qn(t,e)}}function Yn(e,t){return e.split(t)}function er(e,t){let n=Kt(t),r=n.shift(),i=e;for(;r;)i=i.replace("{}",String(r)),r=n.shift();return i}function tr(e,t){return e+t}function nr(e,t){return e-t}function rr(e,t){return e*t}function ir(e,t){return e/t}function sr(e){return function(t){return t+e}}function ar(e){return function(t){return t-e}}function or(e){return function(t){return t/e}}function lr(e){return function(t){return t*e}}function cr(e){let t=[];for(var n=1;n<e.length;n++)t.push(e[n]-e[n-1]);return t}function ur(e,t){return e==t}function hr(e,t){var n={attempt_ref:null};return r=>{n.attempt_ref&&clearTimeout(n.attempt_ref),n.attempt_ref=setTimeout((function(){t(r)}),e)}}function dr(e,t){let n={},r=[];return _e(e).map((i=>{try{n[i]=e[i](t)}catch(e){r.push(e),n[i]=null}})),r.length&&(Et("Error while applying function to dictionary"),Et(r),Et(n)),n}async function pr(e,t){let n={},r=[],i=_e(e).map((async i=>{try{n[i]=await e[i](t)}catch(e){r.push(e),n[i]=null}}));return await Promise.all(i),r.length&&(Et("Error while applying function to dictionary"),Et(r),Et(n)),n}const fr=function(){return!1},mr=function(){return!0},gr={"@@functional/placeholder":!0};var yr=X((function(e,t){return Number(e)+Number(t)}));const vr=yr;var br=Z((function(e){return ee(e.length,(function(){var t=arguments[0],n=arguments[arguments.length-1],r=n.length-1,i=Array.prototype.slice.call(arguments,0);return i[0]=function(){var e=t.apply(this,W(arguments,[r,n]));return r-=1,e},e.apply(this,i)}))}));const wr=br;var _r=nt((function(e,t,n){var r=n.length;if(e>=r||e<-r)return n;var i=(r+e)%r,s=W(n);return s[i]=t(n[i]),s}));const kr=_r;function Ar(e){return e&&e["@@transducer/reduced"]?e:{"@@transducer/value":e,"@@transducer/reduced":!0}}var Pr=function(){function e(e,t){this.xf=t,this.f=e,this.all=!0}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=function(e){return this.all&&(e=this.xf["@@transducer/step"](e,!0)),this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)||(this.all=!1,e=Ar(this.xf["@@transducer/step"](e,!1))),e},e}(),Tr=X(ae(["all"],(function(e){return function(t){return new Pr(e,t)}}),(function(e,t){for(var n=0;n<t.length;){if(!e(t[n]))return!1;n+=1}return!0})));const Er=Tr;var xr=X((function(e,t){if(e===t)return t;function n(e,t){if(e>t!=t>e)return t>e?t:e}var r=n(e,t);if(void 0!==r)return r;var i=n(typeof e,typeof t);if(void 0!==i)return i===typeof e?e:t;var s=We(e),a=n(s,We(t));return void 0!==a&&a===s?e:t}));const Ir=xr;var Cr=X((function(e,t){return Ae(tt(e),t)}));const Or=Cr;var Sr=Z((function(e){return ee(pt(Ir,0,Or("length",e)),(function(){for(var t=0,n=e.length;t<n;){if(!e[t].apply(this,arguments))return!1;t+=1}return!0}))}));const Nr=Sr,jr=Z((function(e){return function(){return e}}));var Dr=X((function(e,t){return e&&t}));const Rr=Dr;var $r=function(){function e(e,t){this.xf=t,this.f=e,this.any=!1}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=function(e){return this.any||(e=this.xf["@@transducer/step"](e,!1)),this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)&&(this.any=!0,e=Ar(this.xf["@@transducer/step"](e,!0))),e},e}(),Lr=X(ae(["any"],(function(e){return function(t){return new $r(e,t)}}),(function(e,t){for(var n=0;n<t.length;){if(e(t[n]))return!0;n+=1}return!1})));const Mr=Lr;var Fr=Z((function(e){return ee(pt(Ir,0,Or("length",e)),(function(){for(var t=0,n=e.length;t<n;){if(e[t].apply(this,arguments))return!0;t+=1}return!1}))}));const Ur=Fr,Br=at(re,(function(e,t,n,r){return n[r](e,t)}),(function(e,t,n){for(var r=n.next();!r.done;)t=e(t,r.value),r=n.next();return t}));var Vr=X((function(e,t){return"function"==typeof t["fantasy-land/ap"]?t["fantasy-land/ap"](e):"function"==typeof e.ap?e.ap(t):"function"==typeof e?function(n){return e(n)(t(n))}:Br((function(e,n){return W(e,Ae(n,t))}),[],e)}));const zr=Vr;var Hr=function(){function e(e,t){this.xf=t,this.pos=0,this.full=!1,this.acc=new Array(e)}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=function(e){return this.acc=null,this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.store(t),this.full?this.xf["@@transducer/step"](e,this.getCopy()):e},e.prototype.store=function(e){this.acc[this.pos]=e,this.pos+=1,this.pos===this.acc.length&&(this.pos=0,this.full=!0)},e.prototype.getCopy=function(){return W(Array.prototype.slice.call(this.acc,this.pos),Array.prototype.slice.call(this.acc,0,this.pos))},e}();const Gr=X(ae([],(function(e){return function(t){return new Hr(e,t)}}),(function(e,t){for(var n=0,r=t.length-(e-1),i=new Array(r>=0?r:0);n<r;)i[n]=Array.prototype.slice.call(t,n,n+e),n+=1;return i})));var qr=X((function(e,t){return W(t,[e])}));const Kr=qr,Wr=X((function(e,t){return e.apply(this,t)}));var Jr=Z((function(e){for(var t=_e(e),n=t.length,r=[],i=0;i<n;)r[i]=e[t[i]],i+=1;return r}));const Zr=Jr;function Qr(e,t){return ie(t)?t.map(e):_e(t).reduce((function(n,r){return n[r]=e(t[r]),n}),{})}var Xr=Z((function e(t){return t=Qr((function(t){return"function"==typeof t?t:e(t)}),t),ee(pt(Ir,0,Or("length",Zr(t))),(function(){var e=arguments;return Qr((function(t){return Wr(t,e)}),t)}))}));const Yr=Xr;var ei=X((function(e,t){return t(e)}));const ti=ei;var ni=nt((function(e,t,n){var r=e(t),i=e(n);return r<i?-1:r>i?1:0}));const ri=ni;function ii(e,t,n){if(Qe(e)&&ie(n)){var r=[].concat(n);return r[e]=t,r}var i={};for(var s in n)i[s]=n[s];return i[e]=t,i}var si=Z((function(e){return null==e}));const ai=si;var oi=nt((function e(t,n,r){if(0===t.length)return n;var i=t[0];if(t.length>1){var s=!ai(r)&&de(i,r)&&"object"==typeof r[i]?r[i]:Qe(t[1])?[]:{};n=e(Array.prototype.slice.call(t,1),n,s)}return ii(i,n,r)}));const li=oi;var ci=nt((function(e,t,n){return li([e],t,n)}));const ui=ci;var hi=X((function(e,t){switch(e){case 0:return function(){return t.call(this)};case 1:return function(e){return t.call(this,e)};case 2:return function(e,n){return t.call(this,e,n)};case 3:return function(e,n,r){return t.call(this,e,n,r)};case 4:return function(e,n,r,i){return t.call(this,e,n,r,i)};case 5:return function(e,n,r,i,s){return t.call(this,e,n,r,i,s)};case 6:return function(e,n,r,i,s,a){return t.call(this,e,n,r,i,s,a)};case 7:return function(e,n,r,i,s,a,o){return t.call(this,e,n,r,i,s,a,o)};case 8:return function(e,n,r,i,s,a,o,l){return t.call(this,e,n,r,i,s,a,o,l)};case 9:return function(e,n,r,i,s,a,o,l,c){return t.call(this,e,n,r,i,s,a,o,l,c)};case 10:return function(e,n,r,i,s,a,o,l,c,u){return t.call(this,e,n,r,i,s,a,o,l,c,u)};default:throw new Error("First argument to nAry must be a non-negative integer no greater than ten")}}));const di=hi,pi=Z((function(e){return di(2,e)})),fi=X((function(e,t){var n=ee(e,t);return ee(e,(function(){return re(zr,Ae(n,arguments[0]),Array.prototype.slice.call(arguments,1))}))})),mi=Z((function(e){return fi(e.length,e)}));var gi=X((function(e,t){return Pe(e)?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:mi(Rr)(e,t)}));const yi=gi,vi=Z((function(e){return e.apply(this,Array.prototype.slice.call(arguments,1))}));function bi(e){return function t(n){for(var r,i,s,a=[],o=0,l=n.length;o<l;){if(it(n[o]))for(s=0,i=(r=e?t(n[o]):n[o]).length;s<i;)a[a.length]=r[s],s+=1;else a[a.length]=n[o];o+=1}return a}}var wi="@@transducer/init",_i="@@transducer/step",ki="@@transducer/result",Ai=function(){function e(e){this.xf=e}return e.prototype[wi]=le,e.prototype[ki]=ce,e.prototype[_i]=function(e,t){var n=this.xf[_i](e,t);return n["@@transducer/reduced"]?function(e){return{"@@transducer/value":e,"@@transducer/reduced":!0}}(n):n},e}(),Pi=function(){function e(e){this.xf=new Ai(e)}return e.prototype[wi]=le,e.prototype[ki]=ce,e.prototype[_i]=function(e,t){return it(t)?ct(this.xf,e,t):ot(this.xf,e,[t])},e}(),Ti=X(ae(["fantasy-land/chain","chain"],(function(e){return function(t){return he(e)(function(e){return new Pi(e)}(t))}}),(function(e,t){return"function"==typeof t?function(n){return e(t(n))(n)}:bi(!1)(Ae(e,t))})));const Ei=Ti;var xi=nt((function(e,t,n){if(e>t)throw new Error("min must not be greater than max in clamp(min, max, value)");return n<e?e:n>t?t:n}));const Ii=xi;function Ci(e){return new RegExp(e.source,e.flags?e.flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":"")+(e.dotAll?"s":""))}function Oi(e,t,n){if(n||(n=new Si),function(e){var t=typeof e;return null==e||"object"!=t&&"function"!=t}(e))return e;var r=function(r){var i=n.get(e);if(i)return i;for(var s in n.set(e,r),e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=t?Oi(e[s],!0,n):e[s]);return r};switch(Ce(e)){case"Object":return r(Object.create(Object.getPrototypeOf(e)));case"Array":return r([]);case"Date":return new Date(e.valueOf());case"RegExp":return Ci(e);case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return e.slice();default:return e}}var Si=function(){function e(){this.map={},this.length=0}return e.prototype.set=function(e,t){const n=this.hash(e);let r=this.map[n];r||(this.map[n]=r=[]),r.push([e,t]),this.length+=1},e.prototype.hash=function(e){let t=[];for(var n in e)t.push(Object.prototype.toString.call(e[n]));return t.join()},e.prototype.get=function(e){if(this.length<=180){for(const t in this.map){const n=this.map[t];for(let t=0;t<n.length;t+=1){const r=n[t];if(r[0]===e)return r[1]}}return}const t=this.hash(e),n=this.map[t];if(n)for(let t=0;t<n.length;t+=1){const r=n[t];if(r[0]===e)return r[1]}},e}(),Ni=Z((function(e){return null!=e&&"function"==typeof e.clone?e.clone():Oi(e,!0)}));const ji=Ni;var Di=X((function(e,t){var n=Br((function(t,n){var r=e(n);return void 0===t[r]&&(t[r]=[]),t[r].push(n),t}),{},t),r=[];for(var i in n)r.push(n[i]);return r}));const Ri=Di;var $i=Z((function(e){return function(t,n){return e(t,n)?-1:e(n,t)?1:0}}));const Li=$i;var Mi=Z((function(e){return!e}));const Fi=Mi,Ui=mi(Fi);function Bi(e,t){return function(){return t.call(this,e.apply(this,arguments))}}function Vi(e,t){return function(){var n=arguments.length;if(0===n)return t();var r=arguments[n-1];return ie(r)||"function"!=typeof r[e]?t.apply(this,arguments):r[e].apply(r,Array.prototype.slice.call(arguments,0,n-1))}}var zi=nt(Vi("slice",(function(e,t,n){return Array.prototype.slice.call(n,e,t)})));const Hi=zi,Gi=Z(Vi("tail",Hi(1,1/0)));function qi(){if(0===arguments.length)throw new Error("pipe requires at least one argument");return Q(arguments[0].length,pt(Bi,arguments[0],Gi(arguments)))}var Ki=Z((function(e){return Te(e)?e.split("").reverse().join(""):Array.prototype.slice.call(e,0).reverse()}));const Wi=Ki;function Ji(){if(0===arguments.length)throw new Error("compose requires at least one argument");return qi.apply(this,Wi(arguments))}const Zi=Ye(0);function Qi(e){return e}const Xi=Z(Qi);var Yi=X((function(e,t){if(t.length<=0)return Xi;var n=Zi(t),r=Gi(t);return Q(n.length,(function(){return Br((function(t,n){return e.call(this,n,t)}),n.apply(this,arguments),r)}))}));const es=Yi;var ts=X((function(e,t){return es.apply(this,[e,Wi(t)])}));const ns=ts;var rs=Z((function(e){return Q(pt(Ir,0,Ae((function(e){return e[0].length}),e)),(function(){for(var t=0;t<e.length;){if(e[t][0].apply(this,arguments))return e[t][1].apply(this,arguments);t+=1}}))}));const is=rs,ss=Z((function(e){return ee(e.length,e)}));var as=X((function(e,t){if(e>10)throw new Error("Constructor with greater than ten arguments");return 0===e?function(){return new t}:ss(di(e,(function(n,r,i,s,a,o,l,c,u,h){switch(e){case 1:return new t(n);case 2:return new t(n,r);case 3:return new t(n,r,i);case 4:return new t(n,r,i,s);case 5:return new t(n,r,i,s,a);case 6:return new t(n,r,i,s,a,o);case 7:return new t(n,r,i,s,a,o,l);case 8:return new t(n,r,i,s,a,o,l,c);case 9:return new t(n,r,i,s,a,o,l,c,u);case 10:return new t(n,r,i,s,a,o,l,c,u,h)}})))}));const os=as,ls=Z((function(e){return os(e.length,e)}));var cs=X((function(e,t){return ee(pt(Ir,0,Or("length",t)),(function(){var n=arguments,r=this;return e.apply(r,oe((function(e){return e.apply(r,n)}),t))}))}));const us=cs;var hs=ss((function(e,t){return Br((function(t,n){return e(n)?t+1:t}),0,t)}));const ds=hs;var ps=function(){function e(e,t,n,r){this.valueFn=e,this.valueAcc=t,this.keyFn=n,this.xf=r,this.inputs={}}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=function(e){var t;for(t in this.inputs)if(de(t,this.inputs)&&(e=this.xf["@@transducer/step"](e,this.inputs[t]))["@@transducer/reduced"]){e=e["@@transducer/value"];break}return this.inputs=null,this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){var n=this.keyFn(t);return this.inputs[n]=this.inputs[n]||[n,Oi(this.valueAcc,!1)],this.inputs[n][1]=this.valueFn(this.inputs[n][1],t),e},e}(),fs=Y(4,[],ae([],(function(e,t,n){return function(r){return new ps(e,t,n,r)}}),(function(e,t,n,r){var i=ht((function(r,i){var s=n(i),a=e(de(s,r)?r[s]:Oi(t,!1),i);return a&&a["@@transducer/reduced"]?Ar(r):(r[s]=a,r)}));return ct(i,{},r)})));const ms=fs,gs=ms((function(e,t){return e+1}),0),ys=vr(-1);var vs=X((function(e,t){return null==t||t!=t?e:t}));const bs=vs;var ws=nt((function(e,t,n){var r=e(t),i=e(n);return r>i?-1:r<i?1:0}));const _s=ws;function ks(e,t,n){var r,i=typeof e;switch(i){case"string":case"number":return 0===e&&1/e==-1/0?!!n._items["-0"]||(t&&(n._items["-0"]=!0),!1):null!==n._nativeSet?t?(r=n._nativeSet.size,n._nativeSet.add(e),n._nativeSet.size===r):n._nativeSet.has(e):i in n._items?e in n._items[i]||(t&&(n._items[i][e]=!0),!1):(t&&(n._items[i]={},n._items[i][e]=!0),!1);case"boolean":if(i in n._items){var s=e?1:0;return!!n._items[i][s]||(t&&(n._items[i][s]=!0),!1)}return t&&(n._items[i]=e?[!1,!0]:[!0,!1]),!1;case"function":return null!==n._nativeSet?t?(r=n._nativeSet.size,n._nativeSet.add(e),n._nativeSet.size===r):n._nativeSet.has(e):i in n._items?!!Re(e,n._items[i])||(t&&n._items[i].push(e),!1):(t&&(n._items[i]=[e]),!1);case"undefined":return!!n._items[i]||(t&&(n._items[i]=!0),!1);case"object":if(null===e)return!!n._items.null||(t&&(n._items.null=!0),!1);default:return(i=Object.prototype.toString.call(e))in n._items?!!Re(e,n._items[i])||(t&&n._items[i].push(e),!1):(t&&(n._items[i]=[e]),!1)}}const As=function(){function e(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}return e.prototype.add=function(e){return!ks(e,!0,this)},e.prototype.has=function(e){return ks(e,!1,this)},e}();var Ps=X((function(e,t){for(var n=[],r=0,i=e.length,s=t.length,a=new As,o=0;o<s;o+=1)a.add(t[o]);for(;r<i;)a.add(e[r])&&(n[n.length]=e[r]),r+=1;return n}));const Ts=Ps;var Es=nt((function(e,t,n){for(var r=[],i=0,s=t.length;i<s;)xe(e,t[i],n)||xe(e,t[i],r)||r.push(t[i]),i+=1;return r}));const xs=Es;var Is=nt((function(e,t,n){var r=Array.prototype.slice.call(n,0);return r.splice(e,t),r}));const Cs=Is;var Os=X((function e(t,n){if(null==n)return n;switch(t.length){case 0:return n;case 1:return function(e,t){if(null==t)return t;if(Qe(e)&&ie(t))return Cs(e,1,t);var n={};for(var r in t)n[r]=t[r];return delete n[e],n}(t[0],n);default:var r=t[0],i=Array.prototype.slice.call(t,1);return null==n[r]?function(e,t){if(Qe(e)&&ie(t))return[].concat(t);var n={};for(var r in t)n[r]=t[r];return n}(r,n):ui(r,e(i,n[r]),n)}}));const Ss=Os;var Ns=X((function(e,t){return Ss([e],t)}));const js=Ns;var Ds=X((function(e,t){return e/t}));const Rs=Ds;var $s=function(){function e(e,t){this.xf=t,this.n=e}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){return this.n>0?(this.n-=1,e):this.xf["@@transducer/step"](e,t)},e}(),Ls=X(ae(["drop"],(function(e){return function(t){return new $s(e,t)}}),(function(e,t){return Hi(Math.max(0,e),1/0,t)})));const Ms=Ls;var Fs=function(){function e(e,t){this.xf=t,this.n=e,this.i=0}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){this.i+=1;var n=0===this.n?e:this.xf["@@transducer/step"](e,t);return this.n>=0&&this.i>=this.n?Ar(n):n},e}(),Us=X(ae(["take"],(function(e){return function(t){return new Fs(e,t)}}),(function(e,t){return Hi(0,e<0?1/0:e,t)})));const Bs=Us;var Vs=function(){function e(e,t){if(e<=0)return t;this.xf=t,this.pos=0,this.full=!1,this.acc=new Array(e)}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=function(e){return this.acc=null,this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.full&&(e=this.xf["@@transducer/step"](e,this.acc[this.pos])),this.store(t),e},e.prototype.store=function(e){this.acc[this.pos]=e,this.pos+=1,this.pos===this.acc.length&&(this.pos=0,this.full=!0)},e}();const zs=X(ae([],(function(e){return function(t){return new Vs(e,t)}}),(function(e,t){return Bs(e<t.length?t.length-e:0,t)})));var Hs=function(){function e(e,t){this.f=e,this.retained=[],this.xf=t}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=function(e){return this.retained=null,this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)?this.retain(e,t):this.flush(e,t)},e.prototype.flush=function(e,t){return e=ct(this.xf,e,this.retained),this.retained=[],this.xf["@@transducer/step"](e,t)},e.prototype.retain=function(e,t){return this.retained.push(t),e},e}();const Gs=X(ae([],(function(e){return function(t){return new Hs(e,t)}}),(function(e,t){for(var n=t.length-1;n>=0&&e(t[n]);)n-=1;return Hi(0,n+1,t)})));var qs=function(){function e(e,t){this.xf=t,this.pred=e,this.lastValue=void 0,this.seenFirstValue=!1}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){var n=!1;return this.seenFirstValue?this.pred(this.lastValue,t)&&(n=!0):this.seenFirstValue=!0,this.lastValue=t,n?e:this.xf["@@transducer/step"](e,t)},e}();function Ks(e){return function(t){return new qs(e,t)}}const Ws=Ye(-1);var Js=X(ae([],Ks,(function(e,t){var n=[],r=1,i=t.length;if(0!==i)for(n[0]=t[0];r<i;)e(Ws(n),t[r])||(n[n.length]=t[r]),r+=1;return n})));const Zs=Js,Qs=Z(ae([],(function(){return Ks(je)}),Zs(je)));var Xs=nt((function(e,t,n){return je(e(t),e(n))}));const Ys=Xs;var ea=X((function(e,t){return ae([],(function(){return Ks(Ys(e))}),Zs(Ys(e)))(t)}));const ta=ea;var na=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){if(this.f){if(this.f(t))return e;this.f=null}return this.xf["@@transducer/step"](e,t)},e}(),ra=X(ae(["dropWhile"],(function(e){return function(t){return new na(e,t)}}),(function(e,t){for(var n=0,r=t.length;n<r&&e(t[n]);)n+=1;return Hi(n,1/0,t)})));const ia=ra;var sa=X((function(e,t){return e||t}));const aa=sa;var oa=X((function(e,t){return Pe(e)?function(){return e.apply(this,arguments)||t.apply(this,arguments)}:mi(aa)(e,t)}));const la=oa;var ca=Z((function(e){return null!=e&&"function"==typeof e["fantasy-land/empty"]?e["fantasy-land/empty"]():null!=e&&null!=e.constructor&&"function"==typeof e.constructor["fantasy-land/empty"]?e.constructor["fantasy-land/empty"]():null!=e&&"function"==typeof e.empty?e.empty():null!=e&&null!=e.constructor&&"function"==typeof e.constructor.empty?e.constructor.empty():ie(e)?[]:Te(e)?"":Ve(e)?{}:me(e)?function(){return arguments}():function(e){var t=Object.prototype.toString.call(e);return"[object Uint8ClampedArray]"===t||"[object Int8Array]"===t||"[object Uint8Array]"===t||"[object Int16Array]"===t||"[object Uint16Array]"===t||"[object Int32Array]"===t||"[object Uint32Array]"===t||"[object Float32Array]"===t||"[object Float64Array]"===t||"[object BigInt64Array]"===t||"[object BigUint64Array]"===t}(e)?e.constructor.from(""):void 0}));const ua=ca;var ha=X((function(e,t){return Ms(e>=0?t.length-e:0,t)}));const da=ha;var pa=X((function(e,t){return je(da(e.length,t),e)}));const fa=pa;var ma=nt((function(e,t,n){return je(t[e],n[e])}));const ga=ma;var ya=X((function e(t,n){if(!Ve(n)&&!ie(n))return n;var r,i,s,a=n instanceof Array?[]:{};for(i in n)s=typeof(r=t[i]),a[i]="function"===s?r(n[i]):r&&"object"===s?e(r,n[i]):n[i];return a}));const va=ya;var ba=function(){function e(e,t){this.xf=t,this.f=e,this.found=!1}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=function(e){return this.found||(e=this.xf["@@transducer/step"](e,void 0)),this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)&&(this.found=!0,e=Ar(this.xf["@@transducer/step"](e,t))),e},e}(),wa=X(ae(["find"],(function(e){return function(t){return new ba(e,t)}}),(function(e,t){for(var n=0,r=t.length;n<r;){if(e(t[n]))return t[n];n+=1}})));const _a=wa;var ka=function(){function e(e,t){this.xf=t,this.f=e,this.idx=-1,this.found=!1}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=function(e){return this.found||(e=this.xf["@@transducer/step"](e,-1)),this.xf["@@transducer/result"](e)},e.prototype["@@transducer/step"]=function(e,t){return this.idx+=1,this.f(t)&&(this.found=!0,e=Ar(this.xf["@@transducer/step"](e,this.idx))),e},e}(),Aa=X(ae([],(function(e){return function(t){return new ka(e,t)}}),(function(e,t){for(var n=0,r=t.length;n<r;){if(e(t[n]))return n;n+=1}return-1})));const Pa=Aa;var Ta=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=function(e){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](e,this.last))},e.prototype["@@transducer/step"]=function(e,t){return this.f(t)&&(this.last=t),e},e}(),Ea=X(ae([],(function(e){return function(t){return new Ta(e,t)}}),(function(e,t){for(var n=t.length-1;n>=0;){if(e(t[n]))return t[n];n-=1}})));const xa=Ea;var Ia=function(){function e(e,t){this.xf=t,this.f=e,this.idx=-1,this.lastIdx=-1}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=function(e){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](e,this.lastIdx))},e.prototype["@@transducer/step"]=function(e,t){return this.idx+=1,this.f(t)&&(this.lastIdx=this.idx),e},e}(),Ca=X(ae([],(function(e){return function(t){return new Ia(e,t)}}),(function(e,t){for(var n=t.length-1;n>=0;){if(e(t[n]))return n;n-=1}return-1})));const Oa=Ca,Sa=Z(bi(!0));var Na=Z((function(e){return ee(e.length,(function(t,n){var r=Array.prototype.slice.call(arguments,0);return r[0]=n,r[1]=t,e.apply(this,r)}))}));const ja=Na;var Da=X(Vi("forEach",(function(e,t){for(var n=t.length,r=0;r<n;)e(t[r]),r+=1;return t})));const Ra=Da;var $a=X((function(e,t){for(var n=_e(t),r=0;r<n.length;){var i=n[r];e(t[i],i,t),r+=1}return t}));const La=$a;var Ma=Z((function(e){for(var t={},n=0;n<e.length;)t[e[n][0]]=e[n][1],n+=1;return t}));const Fa=Ma,Ua=X(Vi("groupBy",ms((function(e,t){return e.push(t),e}),[])));var Ba=X((function(e,t){for(var n=[],r=0,i=t.length;r<i;){for(var s=r+1;s<i&&e(t[s-1],t[s]);)s+=1;n.push(t.slice(r,s)),r=s}return n}));const Va=Ba;var za=X((function(e,t){return e>t}));const Ha=za;var Ga=X((function(e,t){return e>=t}));const qa=Ga;var Ka=X((function(e,t){if(0===e.length||ai(t))return!1;for(var n=t,r=0;r<e.length;){if(ai(n)||!de(e[r],n))return!1;n=n[e[r]],r+=1}return!0}));const Wa=Ka;var Ja=X((function(e,t){return Wa([e],t)}));const Za=Ja;var Qa=X((function(e,t){return!ai(t)&&e in t}));const Xa=Qa;var Ya=function(e,t){switch(arguments.length){case 0:return Ya;case 1:return function t(n){return 0===arguments.length?t:Ie(e,n)};default:return Ie(e,t)}};const eo=Ya,to=nt((function(e,t,n){return ee(Math.max(e.length,t.length,n.length),(function(){return e.apply(this,arguments)?t.apply(this,arguments):n.apply(this,arguments)}))})),no=vr(1),ro=X(Re),io=ms((function(e,t){return t}),null),so=X((function(e,t){return"function"!=typeof t.indexOf||ie(t)?De(t,e,0):t.indexOf(e)})),ao=Hi(0,-1);var oo=nt((function(e,t,n){return Be((function(t){return xe(e,t,n)}),t)}));const lo=oo;var co=nt((function(e,t,n){e=e<n.length&&e>=0?e:n.length;var r=Array.prototype.slice.call(n,0);return r.splice(e,0,t),r}));const uo=co;var ho=nt((function(e,t,n){return e=e<n.length&&e>=0?e:n.length,[].concat(Array.prototype.slice.call(n,0,e),t,Array.prototype.slice.call(n,e))}));const po=ho;var fo=function(){function e(e,t){this.xf=t,this.f=e,this.set=new As}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){return this.set.add(this.f(t))?this.xf["@@transducer/step"](e,t):e},e}(),mo=X(ae([],(function(e){return function(t){return new fo(e,t)}}),(function(e,t){for(var n,r,i=new As,s=[],a=0;a<t.length;)n=e(r=t[a]),i.add(n)&&s.push(r),a+=1;return s})));const go=mo,yo=go(Xi);var vo=X((function(e,t){for(var n=new As,r=0;r<e.length;r+=1)n.add(e[r]);return yo(Be(n.has.bind(n),t))}));const bo=vo;var wo=X(Vi("intersperse",(function(e,t){for(var n=[],r=0,i=t.length;r<i;)r===i-1?n.push(t[r]):n.push(t[r],e),r+=1;return n})));const _o=wo,ko="function"==typeof Object.assign?Object.assign:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1,r=arguments.length;n<r;){var i=arguments[n];if(null!=i)for(var s in i)de(s,i)&&(t[s]=i[s]);n+=1}return t};var Ao=X((function(e,t){var n={};return n[e]=t,n}));const Po=Ao;var To={"@@transducer/init":Array,"@@transducer/step":function(e,t){return e.push(t),e},"@@transducer/result":Qi},Eo={"@@transducer/init":String,"@@transducer/step":function(e,t){return e+t},"@@transducer/result":Qi},xo={"@@transducer/init":Object,"@@transducer/step":function(e,t){return ko(e,it(t)?Po(t[0],t[1]):t)},"@@transducer/result":Qi},Io=nt((function(e,t,n){var r=t(se(e)?e:function(e){if(se(e))return e;if(it(e))return To;if("string"==typeof e)return Eo;if("object"==typeof e)return xo;throw new Error("Cannot create transformer for "+e)}(e));return ct(r,r["@@transducer/init"](),n)}));const Co=Io;var Oo=Z((function(e){for(var t=_e(e),n=t.length,r=0,i={};r<n;){var s=t[r],a=e[s],o=de(a,i)?i[a]:i[a]=[];o[o.length]=s,r+=1}return i}));const So=Oo;var No=Z((function(e){for(var t=_e(e),n=t.length,r=0,i={};r<n;){var s=t[r];i[e[s]]=s,r+=1}return i}));const jo=No,Do=X((function(e,t){return ee(e+1,(function(){var n=arguments[e];if(null!=n&&Pe(n[t]))return n[t].apply(n,Array.prototype.slice.call(arguments,0,e));throw new TypeError(We(n)+' does not have a method named "'+t+'"')}))})),Ro=X((function(e,t){return t instanceof e||null!=t&&(t.constructor===e||"Object"===e.name&&"object"==typeof t)}));var $o=Z((function(e){return null!=e&&je(e,ua(e))}));const Lo=$o;var Mo=Z((function(e){return!ai(e)}));const Fo=Mo,Uo=Do(1,"join");var Bo=Z((function(e){return us((function(){return Array.prototype.slice.call(arguments,0)}),e)}));const Vo=Bo;var zo=Z((function(e){var t,n=[];for(t in e)n[n.length]=t;return n}));const Ho=zo,Go=X((function(e,t){if("function"!=typeof t.lastIndexOf||ie(t)){for(var n=t.length-1;n>=0;){if(je(t[n],e))return n;n-=1}return-1}return t.lastIndexOf(e)}));function qo(e){return"[object Number]"===Object.prototype.toString.call(e)}var Ko=Z((function(e){return null!=e&&qo(e.length)?e.length:NaN}));const Wo=Ko;var Jo=X((function(e,t){return function(n){return function(r){return Ae((function(e){return t(e,r)}),n(e(r)))}}}));const Zo=Jo;var Qo=nt((function(e,t,n){return kr(e,jr(t),n)}));const Xo=Qo;var Yo=Z((function(e){return Zo(Ye(e),Xo(e))}));const el=Yo;var tl=X((function(e,t){return e.map((function(e){for(var n,r=t,i=0;i<e.length;){if(null==r)return;n=e[i],r=Qe(n)?Ye(n,r):r[n],i+=1}return r}))}));const nl=tl;var rl=X((function(e,t){return nl([e],t)[0]}));const il=rl;var sl=Z((function(e){return Zo(il(e),li(e))}));const al=sl;var ol=Z((function(e){return Zo(tt(e),ui(e))}));const ll=ol;var cl=X((function(e,t){return e<t}));const ul=cl;var hl=X((function(e,t){return e<=t}));const dl=hl;var pl=nt((function(e,t,n){for(var r=0,i=n.length,s=[],a=[t];r<i;)a=e(a[0],n[r]),s[r]=a[1],r+=1;return[a[0],s]}));const fl=pl;var ml=nt((function(e,t,n){for(var r=n.length-1,i=[],s=[t];r>=0;)s=e(s[0],n[r]),i[r]=s[1],r-=1;return[s[0],i]}));const gl=ml;var yl=X((function(e,t){return re((function(n,r){return n[r]=e(t[r],r,t),n}),{},_e(t))}));const vl=yl;var bl=X((function(e,t){return t.match(e)||[]}));const wl=bl;var _l=X((function(e,t){return Qe(e)?!Qe(t)||t<1?NaN:(e%t+t)%t:NaN}));const kl=_l;var Al=nt((function(e,t,n){var r=e(n);return Ir(e(t),r)===r?n:t}));const Pl=Al,Tl=pt(vr,0);var El=Z((function(e){return Tl(e)/e.length}));const xl=El;var Il=Z((function(e){var t=e.length;if(0===t)return NaN;var n=2-t%2,r=(t-n)/2;return xl(Array.prototype.slice.call(e,0).sort((function(e,t){return e<t?-1:e>t?1:0})).slice(r,r+n))}));const Cl=Il;var Ol=X((function(e,t){var n={};return Q(t.length,(function(){var r=e.apply(this,arguments);return de(r,n)||(n[r]=t.apply(this,arguments)),n[r]}))}));const Sl=Ol;var Nl=Z((function(e){return ko.apply(null,[{}].concat(e))}));const jl=Nl;var Dl=nt((function(e,t,n){var r,i={};for(r in n=n||{},t=t||{})de(r,t)&&(i[r]=de(r,n)?e(r,t[r],n[r]):t[r]);for(r in n)de(r,n)&&!de(r,i)&&(i[r]=n[r]);return i}));const Rl=Dl;var $l=nt((function e(t,n,r){return Rl((function(n,r,i){return Ve(r)&&Ve(i)?e(t,r,i):t(n,r,i)}),n,r)}));const Ll=$l,Ml=X((function(e,t){return Ll((function(e,t,n){return t}),e,t)})),Fl=X((function(e,t){return Ll((function(e,t,n){return n}),e,t)})),Ul=nt((function(e,t,n){return Ll((function(t,n,r){return e(n,r)}),t,n)}));var Bl=X((function(e,t){return ko({},t,e)}));const Vl=Bl;var zl=X((function(e,t){return ko({},e,t)}));const Hl=zl;var Gl=nt((function(e,t,n){return Rl((function(t,n,r){return e(n,r)}),t,n)}));const ql=Gl;var Kl=X((function(e,t){if(e===t)return e;function n(e,t){if(e<t!=t<e)return t<e?t:e}var r=n(e,t);if(void 0!==r)return r;var i=n(typeof e,typeof t);if(void 0!==i)return i===typeof e?e:t;var s=We(e),a=n(s,We(t));return void 0!==a?a===s?e:t:e}));const Wl=Kl;var Jl=nt((function(e,t,n){var r=e(n);return Wl(e(t),r)===r?n:t}));const Zl=Jl;var Ql=nt((function e(t,n,r){if(!Ve(r)&&!ie(r))return r;if(0===t.length)return n(r);var i=t[0];if(!de(i,r))return r;if(1===t.length)return function(e,t,n){if(Qe(e)&&ie(n)){var r=[].concat(n);return r[e]=t(r[e]),r}var i={};for(var s in n)i[s]=n[s];return i[e]=t(i[e]),i}(i,n,r);var s=e(Array.prototype.slice.call(t,1),n,r[i]);return s===r[i]?r:ii(i,s,r)}));const Xl=Ql;var Yl=nt((function(e,t,n){return Xl([e],t,n)}));const ec=Yl;var tc=X((function(e,t){return e%t}));const nc=tc;var rc=nt((function(e,t,n){var r=n.length,i=n.slice(),s=e<0?r+e:e,a=t<0?r+t:t,o=i.splice(s,1);return s<0||s>=n.length||a<0||a>=n.length?n:[].concat(i.slice(0,a)).concat(o).concat(i.slice(a,n.length))}));const ic=rc;var sc=X((function(e,t){return e*t}));const ac=sc;var oc=X(((e,t)=>n=>e.call(void 0,Fl(t,n))));const lc=oc;var cc=Z((function(e){return-e}));const uc=cc,hc=X((function(e,t){return Er(Ue(e),t)}));var dc=Z((function(e){return ee(e<0?1:e+1,(function(){return Ye(e,arguments)}))}));const pc=dc;var fc=nt((function(e,t,n){return e(t(n))}));const mc=fc,gc=X((function(e,t){return"function"==typeof e["fantasy-land/of"]?e["fantasy-land/of"](t):"function"==typeof e.of?e.of(t):[t]}));var yc=X((function(e,t){for(var n={},r={},i=0,s=e.length;i<s;)r[e[i]]=1,i+=1;for(var a in t)r.hasOwnProperty(a)||(n[a]=t[a]);return n}));const vc=yc;var bc=Y(4,[],(function(e,t,n,r){return e(t(n),t(r))}));const wc=bc,_c=Z((function(e){var t,n=!1;return Q(e.length,(function(){return n?t:(n=!0,t=e.apply(this,arguments))}))}));function kc(e,t){if(null==t||!Pe(t.then))throw new TypeError("`"+e+"` expected a Promise, received "+Ke(t,[]))}var Ac=X((function(e,t){return kc("otherwise",t),t.then(null,e)}));const Pc=Ac;var Tc=function(e){return{value:e,map:function(t){return Tc(t(e))}}},Ec=nt((function(e,t,n){return e((function(e){return Tc(t(e))}))(n).value}));const xc=Ec,Ic=X((function(e,t){return[e,t]}));function Cc(e){return X((function(t,n){return Q(Math.max(0,t.length-n.length),(function(){return t.apply(this,e(n,arguments))}))}))}const Oc=Cc(W),Sc=Cc(ja(W)),Nc=Vo([Ge,qe]);var jc=nt((function(e,t,n){return je(il(t,n),e)}));const Dc=jc;var Rc=nt((function(e,t,n){return bs(e,il(t,n))}));const $c=Rc;var Lc=nt((function(e,t,n){return e(il(t,n))}));const Mc=Lc;var Fc=X((function(e,t){for(var n={},r=0;r<e.length;)e[r]in t&&(n[e[r]]=t[e[r]]),r+=1;return n}));const Uc=Fc;var Bc=X((function(e,t){for(var n={},r=0,i=e.length;r<i;){var s=e[r];n[s]=t[s],r+=1}return n}));const Vc=Bc;var zc=X((function(e,t){var n={};for(var r in t)e(t[r],r,t)&&(n[r]=t[r]);return n}));const Hc=zc;var Gc=X((function(e,t){return W([e],t)}));const qc=Gc,Kc=pt(ac,1),Wc=X((function(e,t){return ee(t.length,(function(){for(var n=[],r=0;r<t.length;)n.push(t[r].call(this,arguments[r])),r+=1;return e.apply(this,n.concat(Array.prototype.slice.call(arguments,t.length)))}))})),Jc=Wc(oe,[Vc,Xi]);function Zc(e,t,n){return function(r){return t(n(e(r)))}}var Qc=function(){function e(e,t,n){this.xf=n,this.f=e,this.g=t}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,Zc(this.f,this.g,t))},e}();const Xc=nt(ae(["fantasy-land/promap","promap"],(function(e,t){return function(n){return new Qc(e,t,n)}}),Zc));var Yc=nt((function(e,t,n){return je(e,tt(t,n))}));const eu=Yc;var tu=nt((function(e,t,n){return Ro(e,tt(t,n))}));const nu=tu;var ru=nt((function(e,t,n){return bs(e,tt(t,n))}));const iu=ru;var su=nt((function(e,t,n){return e(tt(t,n))}));const au=su;var ou=X((function(e,t){return e.map((function(e){return il([e],t)}))}));const lu=ou;var cu=X((function(e,t){if(!qo(e)||!qo(t))throw new TypeError("Both arguments to range must be numbers");for(var n=[],r=e;r<t;)n.push(r),r+=1;return n}));const uu=cu;var hu=nt((function(e,t,n){for(var r=n.length-1;r>=0;){if((t=e(n[r],t))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r-=1}return t}));const du=hu;var pu=Y(4,[],(function(e,t,n,r){var i=ht((function(n,r){return e(n,r)?t(n,r):Ar(n)}));return ct(i,n,r)}));const fu=pu,mu=Z(Ar);var gu=X((function(e,t){var n,r=Number(t),i=0;if(r<0||isNaN(r))throw new RangeError("n must be a non-negative number");for(n=[];i<r;)n.push(e(i)),i+=1;return n}));const yu=gu;var vu=X((function(e,t){return yu(jr(e),t)}));const bu=vu;var wu=nt((function(e,t,n){return n.replace(e,t)}));const _u=wu;var ku="@@transducer/init",Au="@@transducer/step",Pu=function(){function e(e,t,n){this.xf=n,this.f=e,this.acc=t}return e.prototype[ku]=function(){return this.xf[Au](this.xf[ku](),this.acc)},e.prototype["@@transducer/result"]=ce,e.prototype[Au]=function(e,t){return e["@@transducer/reduced"]?e:(this.acc=this.f(this.acc,t),this.xf[Au](e,this.acc))},e}(),Tu=nt(ae([],nt((function(e,t,n){return new Pu(e,t,n)})),(function(e,t,n){for(var r=0,i=n.length,s=[t];r<i;)t=e(t,n[r]),s[r+1]=t,r+=1;return s})));const Eu=Tu;var xu=X((function(e,t){var n="function"==typeof e["fantasy-land/of"]?e["fantasy-land/of"]:"function"==typeof e.of?e.of:e,r={"fantasy-land/of":n};return"function"==typeof t["fantasy-land/traverse"]?t["fantasy-land/traverse"](r,Qi):"function"==typeof t.traverse?t.traverse(r,Qi):du((function(e,t){return zr(Ae(qc,e),t)}),n([]),t)}));const Iu=xu;var Cu=nt((function(e,t,n){return xc(e,jr(t),n)}));const Ou=Cu;var Su=X((function(e,t){return Array.prototype.slice.call(t,0).sort(e)}));const Nu=Su;var ju=X((function(e,t){return Array.prototype.slice.call(t,0).sort((function(t,n){var r=e(t),i=e(n);return r<i?-1:r>i?1:0}))}));const Du=ju;var Ru=X((function(e,t){return Array.prototype.slice.call(t,0).sort((function(t,n){for(var r=0,i=0;0===r&&i<e.length;)r=e[i](t,n),i+=1;return r}))}));const $u=Ru,Lu=Do(1,"split");var Mu=X((function(e,t){return[Hi(0,e,t),Hi(e,Wo(t),t)]}));const Fu=Mu;var Uu=X((function(e,t){if(e<=0)throw new Error("First argument to splitEvery must be a positive integer");for(var n=[],r=0;r<t.length;)n.push(Hi(r,r+=e,t));return n}));const Bu=Uu;var Vu=X((function(e,t){for(var n=0,r=t.length,i=[];n<r&&!e(t[n]);)i.push(t[n]),n+=1;return[i,Array.prototype.slice.call(t,n)]}));const zu=Vu;var Hu=Y(2,[],(function(e,t){for(var n=[],r=[],i=0;i<t.length;i+=1)e(t[i])||r.push(t[i]),(i<t.length-1&&e(t[i+1])||i===t.length-1)&&r.length>0&&(n.push(r),r=[]);return n}));const Gu=Hu;var qu=X((function(e,t){return je(Bs(e.length,t),e)}));const Ku=qu;var Wu=X((function(e,t){return Number(e)-Number(t)}));const Ju=Wu;var Zu=function(e,t,n){var r=n.length,i=n.slice(),s=e<0?r+e:e,a=t<0?r+t:t,o=Math.min(s,a),l=Math.max(s,a);return s<0||s>r||a<0||a>r||s===a?i:i=[].concat(i.slice(0,o)).concat([i[l]]).concat(i.slice(o+1,l)).concat([i[o]]).concat(i.slice(l+1,r))},Qu=nt((function(e,t,n){return ie(n)?Zu(e,t,n):Te(n)?function(e,t,n){var r=Zu(e,t,n);return ie(r)?r.join(""):r}(e,t,n):function(e,t,n){var r=ji(n),i=Object.getOwnPropertyNames(r);if(i.includes(e)&&i.includes(t)){var s=r[e];r[e]=r[t],r[t]=s}return r}(e,t,n)}));const Xu=Qu,Yu=X((function(e,t){return Ze(Ts(e,t),Ts(t,e))})),eh=nt((function(e,t,n){return Ze(xs(e,t,n),xs(e,n,t))})),th=X((function(e,t){for(var n=t.length-1;n>=0&&e(t[n]);)n-=1;return Hi(n+1,1/0,t)}));var nh=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){return this.f(t)?this.xf["@@transducer/step"](e,t):Ar(e)},e}(),rh=X(ae(["takeWhile"],(function(e){return function(t){return new nh(e,t)}}),(function(e,t){for(var n=0,r=t.length;n<r&&e(t[n]);)n+=1;return Hi(0,n,t)})));const ih=rh;var sh=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){return this.f(t),this.xf["@@transducer/step"](e,t)},e}(),ah=X(ae([],(function(e){return function(t){return new sh(e,t)}}),(function(e,t){return e(t),t})));const oh=ah;var lh=X((function(e,t){if(!function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(e))throw new TypeError("‘test’ requires a value of type RegExp as its first argument; received "+We(e));return Ci(e).test(t)}));const ch=lh;var uh=X((function(e,t){return kc("andThen",t),t.then(e)}));const hh=uh,dh=Do(0,"toLowerCase");var ph=Z((function(e){var t=[];for(var n in e)de(n,e)&&(t[t.length]=[n,e[n]]);return t}));const fh=ph;var mh=Z((function(e){var t=[];for(var n in e)t[t.length]=[n,e[n]];return t}));const gh=mh,yh=Do(0,"toUpperCase");var vh=ee(4,(function(e,t,n,r){return ct(e("function"==typeof t?ht(t):t),n,r)}));const bh=vh;var wh=Z((function(e){for(var t=0,n=[];t<e.length;){for(var r=e[t],i=0;i<r.length;)void 0===n[i]&&(n[i]=[]),n[i].push(r[i]),i+=1;t+=1}return n}));const _h=wh;var kh=nt((function(e,t,n){var r={"fantasy-land/of":"function"==typeof e["fantasy-land/of"]?e["fantasy-land/of"]:"function"==typeof e.of?e.of:e};return"function"==typeof n["fantasy-land/traverse"]?n["fantasy-land/traverse"](r,t):"function"==typeof n.traverse?n.traverse(r,t):Iu(r,Ae(t,n))}));const Ah=kh;var Ph="\t\n\v\f\r                　\u2028\u2029\ufeff",Th=Z("function"==typeof String.prototype.trim&&!Ph.trim()&&"​".trim()?function(e){return e.trim()}:function(e){var t=new RegExp("^["+Ph+"]["+Ph+"]*"),n=new RegExp("["+Ph+"]["+Ph+"]*$");return e.replace(t,"").replace(n,"")});const Eh=Th;var xh=X((function(e,t){return Q(e.length,(function(){try{return e.apply(this,arguments)}catch(e){return t.apply(this,W([e],arguments))}}))}));const Ih=xh,Ch=Z((function(e){return function(){return e(Array.prototype.slice.call(arguments,0))}})),Oh=Z((function(e){return di(1,e)}));var Sh=X((function(e,t){return ee(e,(function(){for(var n,r=1,i=t,s=0;r<=e&&"function"==typeof i;)n=r===e?arguments.length:s+i.length,i=i.apply(this,Array.prototype.slice.call(arguments,s,n)),r+=1,s=n;return i}))}));const Nh=Sh;var jh=X((function(e,t){for(var n=e(t),r=[];n&&n.length;)r[r.length]=n[0],n=e(n[1]);return r}));const Dh=jh,Rh=X(Ji(yo,W));var $h=function(){function e(e,t){this.xf=t,this.pred=e,this.items=[]}return e.prototype["@@transducer/init"]=le,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){return xe(this.pred,t,this.items)?e:(this.items.push(t),this.xf["@@transducer/step"](e,t))},e}(),Lh=X(ae([],(function(e){return function(t){return new $h(e,t)}}),(function(e,t){for(var n,r=0,i=t.length,s=[];r<i;)xe(e,n=t[r],s)||(s[s.length]=n),r+=1;return s})));const Mh=Lh,Fh=nt((function(e,t,n){return Mh(e,W(t,n))}));var Uh=nt((function(e,t,n){return e(n)?n:t(n)}));const Bh=Uh,Vh=Ei(Qi);var zh=nt((function(e,t,n){for(var r=n;!e(r);)r=t(r);return r}));const Hh=zh;var Gh=X((function(e,t){return e in t&&ie(t[e])?oe((function(n){return ii(e,n,t)}),t[e]):[t]}));const qh=Gh;var Kh=Z((function(e){var t,n=[];for(t in e)n[n.length]=e[t];return n}));const Wh=Kh;var Jh=function(e){return{value:e,"fantasy-land/map":function(){return this}}},Zh=X((function(e,t){return e(Jh)(t).value}));const Qh=Zh;var Xh=nt((function(e,t,n){return e(n)?t(n):n}));const Yh=Xh;var ed=X((function(e,t){for(var n in e)if(de(n,e)&&!e[n](t[n]))return!1;return!0}));const td=ed;var nd=X((function(e,t){for(var n in e)if(de(n,e)&&e[n](t[n]))return!0;return!1}));const rd=nd,id=X((function(e,t){return td(Ae(je,e),t)}));var sd=X((function(e,t){for(var n=new As,r=0;r<e.length;r+=1)n.add(e[r]);return qe(n.has.bind(n),t)}));const ad=sd;var od=X((function(e,t){return Boolean(!e^!t)}));const ld=od;var cd=X((function(e,t){for(var n,r=0,i=e.length,s=t.length,a=[];r<i;){for(n=0;n<s;)a[a.length]=[e[r],t[n]],n+=1;r+=1}return a}));const ud=cd;var hd=X((function(e,t){for(var n=[],r=0,i=Math.min(e.length,t.length);r<i;)n[r]=[e[r],t[r]],r+=1;return n}));const dd=hd;var pd=X((function(e,t){for(var n=0,r=Math.min(e.length,t.length),i={};n<r;)i[e[n]]=t[n],n+=1;return i}));const fd=pd;var md=nt((function(e,t,n){for(var r=[],i=0,s=Math.min(t.length,n.length);i<s;)r[i]=e(t[i],n[i]),i+=1;return r}));const gd=md,yd=Z((function(e){return ee(e.length,(function(){var t=arguments;return function(){return e.apply(this,t)}}))}));var vd;!function(e){e[e.BUY=0]="BUY",e[e.SELL=1]="SELL"}(vd||(vd={}));class bd{constructor(e){this.Params=e,this.Logger=_t({id:e.logger_id}),this.last_balance_data={},this.log_mode="verbose",this.state={price_history:[],last_price:null,r:e.target_ratio},this.Params.alpha=this.Params.alpha||.01}log(e){this.Logger(e)}async balance_portfolio(){let{base_asset:e,quote_asset:t}=this.Params;"verbose"==this.log_mode&&this.log("Balancing...");let n=await this.get_balance_data(),{base_amt:r,quote_amt:i,base_price:s,portfolio_value:a,current_ratio:o,ratio_error:l,target_achieved:c,target_base_amt:u,base_delta:h,trade_type:d,base_market_amt:p}=n;if("verbose"==this.log_mode&&this.log(n),this.Params.adaptive&&this.state.last_price){let e=s-this.state.last_price,t=e=>Math.max(Math.min(1,e),0);this.state.r=t(this.state.r-this.Params.alpha*e),this.Params.target_ratio=this.state.r}if(this.state.last_price=s,this.state.price_history.push(s),c)return"verbose"==this.log_mode&&this.log("Target ratio already achieved. Returning"),{balanced:!1,balance_needed:!1,info:null};{"verbose"==this.log_mode&&(this.log("Target ratio NOT achieved. Continuing."),this.log(`Processing order to ${d} ${p} ${e}`));let t=await this.do_market_trade(d,p),{error:n,info:r}=t;return{balanced:!n,balance_needed:!0,info:r}}}async get_balance_data(){let{target_ratio:e,target_precision:t,quote_asset:n,base_asset:r}=this.Params,i=await this.get_base_balance(r),s=await this.get_quote_balance(n),a=await this.get_base_price(r,n),o=i*a+s,l=i*a/o,c=e-l,u=o*e/a,h=u-i,d={base_amt:i,quote_amt:s,base_price:a,portfolio_value:o,current_ratio:l,ratio_error:c,target_achieved:Math.abs(c)<t,target_ratio:e,target_precision:t,target_base_amt:u,base_delta:h,trade_type:h>=0?vd.BUY:vd.SELL,base_market_amt:Math.abs(h)};return this.last_balance_data=d,d}set_log_mode(e){"verbose"==this.log_mode&&(this.log(`Setting log mode to ${e}`),this.log_mode=e)}}class wd extends bd{constructor(e){super(e),this.data=e.data,this.current_index=-1,this.portfolio=Object.assign({},e.initial_portfolio),this.initial_portfolio=Object.assign({},e.initial_portfolio),this.rebalances=[],this.slippage=e.slippage,this.fee=e.fee,this.transactions_costs={fees:{base:0,quote:0},slippage:{base:0,quote:0}},this.balance_portfolio_series=[],this.hodl_portfolio_series=[],this.ratio_series=[]}async get_quote_balance(e){return this.portfolio.quote_balance}async get_base_balance(e){return this.portfolio.base_balance}async get_base_price(e,t){return this.data[this.current_index].p}async do_market_trade(e,t){let n=await this.get_base_price("",""),r=this.data[this.current_index];n!=r.p&&(this.log("Sanity check failed! - there is a problem with price indexing"),process.exit(1));let{p:i,t:s}=r;var a,o;switch(e){case vd.BUY:a=t*(1-this.fee),o=-t*i*(1+this.slippage),this.transactions_costs.fees.base+=t*this.fee,this.transactions_costs.slippage.quote+=t*i*this.slippage;break;case vd.SELL:a=-t,o=t*i*(1-this.fee)*(1-this.slippage),this.transactions_costs.fees.quote+=t*i*this.fee,this.transactions_costs.slippage.quote+=t*i*this.slippage}let l=this.portfolio.base_balance+=a,c=this.portfolio.quote_balance+=o;return this.portfolio={base_balance:l,quote_balance:c},this.rebalances.push({index:this.current_index,p:i,t:s,trade_type:e,base_amt:t,quote_amt:t*i,portfolio:this.get_portfolio_value_and_time(this.portfolio,i,s),hodl_portfolio:this.get_portfolio_value_and_time(this.initial_portfolio,i,s),cummulative_transactions_costs:{raw:Object.assign({},this.transactions_costs),values:this.get_transactions_costs_values(this.transactions_costs,i)}}),{error:!1,info:null}}symbol_generator(e,t){return"BACKTESTER"}async process_data(){this.current_index+=1,await this.balance_portfolio();let{p:e,t}=this.data[this.current_index];this.hodl_portfolio_series.push(this.get_portfolio_value_and_time(this.initial_portfolio,e,t)),this.balance_portfolio_series.push(this.get_portfolio_value_and_time(this.portfolio,e,t)),this.ratio_series.push(this.Params.target_ratio)}get_portfolio_value_and_time(e,t,n){let r=e.base_balance*t+e.quote_balance;return{base_balance:e.base_balance,quote_balance:e.quote_balance,value:r,p:t,t:n}}get_transactions_costs_values(e,t){let{fees:n,slippage:r}=e,i=n.base*t+n.quote,s=r.base*t+r.quote;return{fee_cost:i,slippage_cost:s,total:i+s}}async backtest(){this.log("Starting backtest...");let e=this.data.length;for(var t=0;t<e;t++)await this.process_data(),t%100==0&&this.log(`Progress = ${t}/${e}`);this.log("Done")}}function _d(e){return e.length}function kd(e){let t=0;for(var n=0;n<e.length;n++)t+=window.Math.pow(e[n],2);return Math.pow(t,.5)}function Ad(e){let t=0;for(var n=0;n<e.length;n++)t+=e[n];return t}function Pd(e){let t=[];for(var n=0;n<e.length;n++)t[n]=Math.abs(e[n]);return t}function Td(e){return Ad(e)/_d(e)}function Ed(e){return Td(Pd(e))}function xd(e){return{max:Math.max.apply(null,e),min:Math.min.apply(null,e),mean:Td(e)}}function Id(e){const t=e.reduce(((e,t)=>e+t.length),0),n=new Float32Array(t);let r=0;return e.forEach((e=>{n.set(e,r),r+=e.length})),n}function Cd(){return performance.now()}var Od=_t({id:"debug"}),Sd={};function Nd(e,t){Sd[e]=t,Od(`Added :${e}`)}function jd(e){return Sd[e]}function Dd(e){let t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,BigInt(e),!1),new Uint8Array(t)}function Rd(e){let t=Dd(Date.now()),n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function $d(){return"undefined"!=typeof window&&void 0!==window.document}function Ld(){return"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node}function Md(){return Number(new Date)}function Fd(e){try{return JSON.parse(e),!0}catch(e){return!1}}let Ud=()=>performance.now();var Bd,Vd;function zd(e,t,n){var r=Ud();return n=n||200,new Promise(((i,s)=>{let a=setInterval((function(){let n=Ud();e()?(i(!1),clearInterval(a)):t&&n-r>=t&&(i(!0),clearInterval(a))}),n)}))}function Hd(e){return new Promise(((t,n)=>{setTimeout((function(){t(Bd.TIMEOUT)}),e)}))}function Gd(e){Nd("pre_clean",e);let t=e.split("\n").join("").replace(/  /g,"").replace(",}","}"),n=t.indexOf("{"),r=t.indexOf("[");var i;return i=n<0?r:r<0?n:Math.min(n,r),t=t.slice(i,t.length),Od(`extracting json starting at index ${i}=${t[i]}`),Nd("post_clean",t),Od(`Cleaned ${e} to \n\n\n ${t}`),t}async function qd(e,t){try{var n;n=$d()?`${window.origin}/api/openai_davinci`:"https://www.tidyscripts.com/api/openai_davinci";let i=await qF(n,{prompt:e,max_tokens:t});Nd("api_response",i),Od("Logged the api repsonse"),Od("Cleaning json string");var r=Gd(i.text);return Od(`Got cleaned response: ${r}`),{error:!1,data:JSON.parse(r)}}catch(e){return Nd("api_error",e),Od("api_error experienced"),{error:!0,data:"api error"}}}(Vd=Bd||(Bd={}))[Vd.TIMEOUT=0]="TIMEOUT";const Kd={demographics:{age:35,gender:"Male",ethnicity:"Caucasian",occupation:"Software Engineer"},symptoms:["Fever","Cough","Fatigue"],lab_values:[{lab:"Magnesium",value:1.5},{lab:"Calcium",value:9.2},{lab:"Potassium",value:4},{lab:"Sodium",value:138}],medical_history:["Asthma","Seasonal Allergies"],medications:[{medication:"Albuterol",dose:{value:"2 puffs",frequency:"as needed"}},{medication:"Fluticasone",dose:{value:"1 spray",frequency:"daily"}}],tests:[{test:"Chest X-ray",result:"Negative"}],physical_exam:["Mild wheezing on auscultation"]};function Wd(e){const{demographics:t,symptoms:n,lab_values:r,medical_history:i,medications:s,tests:a,physical_exam:o}=e;return`\n    Given the following patient information:\n    Demographics: ${JSON.stringify(t)}\n    Symptoms: ${JSON.stringify(n)}\n    Lab values: ${JSON.stringify(r)}\n    Medical history: ${JSON.stringify(i)}\n    Medications: ${JSON.stringify(s)}\n    Tests: ${JSON.stringify(a)}\n    Physical exam: ${JSON.stringify(o)}\n\n    Please generate a list of the most likely diagnoses, along with their likelihood and any potential further workup needed to confirm or exclude each diagnosis.\nThe returned value should be a stringified JSON object that is an Array of objects that each have  "diagnosis", "likelihood", "reasoning",  and "suggested_workup" fields. \n    The suggested_workup field should be an array of strings where each string is a single suggested workup, such as "echocardiogram" or "chest x-ray" or "Basic metabolic panel (BMP)".\n    The likelihood field should be a number from 0 to 1 that estimates the probability that this is the diagnosis.\nThe reasoning field provides reasoning for ONLY the diagnosis and NOT for the suggested workup. It should be a string of atleast 5 sentences that directly references the provided information and specific numbers that went into your decision making process, and the logic behind the decision. If you conclude a lab value is high or low please provide a reference range in your explanation.\n    The returned array should have atleast 10 elements that are ranked with the highest likelihood first. \n  `}async function Jd(e){let t=Wd(e);return await qd(t,2048)}async function Zd(e){try{const t=`Given the medical one-liner "${e.one_liner}" and History and Physical "${e.hp}", generate a patient_data object which conforms\nto the following PatientData type definition in typescript:\n\ntype PatientData = {\n  demographics: {\n    age: number,\n    gender?: string,\n    ethnicity?: string,\n    occupation?: string\n  },\n  symptoms: string[],\n  lab_values: {\n    lab : string ,\n    value : any \n  }[],\n  medical_history: string[],\n  medications: {\n    medication : string,\n    dose : { value : string, frequency : string } \n  }[],\n  tests: {\n    test: string,\n    result: string\n  }[],\n  physical_exam: string[]\n}\n\nThe repsonse should be a json string. \nOnly include the optional fields in the response if that information is explicity present in the one_liner or hp\nDo not include any text in the response other than the json string itself \n\n\nEXAMPLE RESPONSE: \n\n{\n  "demographics": {\n    "age": 30,\n    "gender": "Female",\n    "occupation": "Software Engineer"\n  },\n  "symptoms": ["Fever", "Cough", "Fatigue"],\n  "lab_values": [\n    {\n      "lab": "Magnesium",\n      "value": 1.5\n    },\n    {\n      "lab": "Calcium",\n      "value": 9.2\n    },\n    {\n      "lab": "Potassium",\n      "value": 4.0\n    },\n    {\n      "lab": "Sodium",\n      "value": 138\n    }\n  ],\n  "medical_history": ["Asthma", "Seasonal Allergies"],\n  "medications": [\n    {\n      "medication": "Albuterol",\n      "dose": {\n        "value": "2 puffs",\n        "frequency": "as needed"\n      }\n    },\n    {\n      "medication": "Fluticasone",\n      "dose": {\n        "value": "1 spray",\n        "frequency": "daily"\n      }\n    }\n  ],\n  "tests": [\n    {\n      "test": "Chest X-ray",\n      "result": "Negative"\n    }\n  ],\n  "physical_exam": ["Mild wheezing on auscultation"]\n}\n`;return(await qd(t,2048)).data}catch(e){return Od("An error occurred"),Nd("generate_error",e),null}}var Qd="1111";const Xd=_t({id:"medications"});var Yd=[],ep=[],tp=null;async function np(){return await rp(),ep}async function rp(){ep.length&&tp||(Xd("Downloading medications"),Yd=await qF("https://storage.googleapis.com/tidyscripts/medication_data.json",{}),Xd("Parsing medications"),(ep=fn(Yd)).map((function(e){try{e.adverse_reactions=up(e.adverse_reactions),e.name=e.name.replace("-drug-information","")}catch(t){Xd("error parsing med:"),console.log(e),process.exit()}})),Xd("Building index"),tp=op(ep),Xd("Done"))}function ip(e){return ep.filter((function(t){return t.name.match(e)}))}function sp(e){let t=R.keys(tp).filter((t=>t.match(e)));return Object.fromEntries(t.map((e=>[e,tp[e]])))}function ap(e,t){if(!e.adverse_reactions)return t;let n=qt(e.adverse_reactions);for(var r of n){let{value:n,path:s}=r,a=s[0];for(var i of n)t[i]||(t[i]={}),t[i][a]||(t[i][a]=[]),t[i][a].push(e.name)}return t}function op(e){let t={};for(var n of e)t=ap(n,t);return t}function lp(e){let t=e.split("\n\n").filter((e=>e.length>1));var n={};return t.map((function(e){let t=e.split(":"),r=t[0].trim(),i=t.slice(1).join("").replace(/\([\s\S]*?\)/g,"").split(",").map((e=>e.toLowerCase().trim()));n[r]=i})),n}function cp(e){return e.replace(/\([\s\S]*?\)/g,"").split(",").map((e=>e.toLowerCase().trim()))}function up(e){if(!e)return null;let t=new RegExp([">10%:","1% to 10%:","2% to 10%:","Frequency not defined:","Frequency not defined.\n\n","<1%, postmarketing, and/or case reports:","<2%, postmarketing, and/or case reports:","<2%:","<1%:","Postmarketing:","Postmarketing and/or case reports:","Case Reports:"].join("|"),"g"),n=e.match(t);if(!n)return null;let r=e.split(t);var i={};return It((function(e,t){try{let n=r[e+1];"<1%, postmarketing, and/or case reports:"==t.trim()||"<2%, postmarketing, and/or case reports:"==t.trim()?i[t]=cp(n):i[t]=lp(n)}catch(e){i[t]=!1}}),n),i}const hp="RFC3986",dp={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},pp=(Object.prototype.hasOwnProperty,Array.isArray),fp=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),mp=1024;function gp(e,t){if(pp(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const yp=Object.prototype.hasOwnProperty,vp={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},bp=Array.isArray,wp=Array.prototype.push,_p=function(e,t){wp.apply(e,bp(t)?t:[t])},kp=Date.prototype.toISOString,Ap={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,i)=>{if(0===e.length)return e;let s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let a="";for(let e=0;e<s.length;e+=mp){const t=s.length>=mp?s.slice(e,e+mp):s,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===i&&(40===r||41===r)?n[n.length]=t.charAt(e):r<128?n[n.length]=fp[r]:r<2048?n[n.length]=fp[192|r>>6]+fp[128|63&r]:r<55296||r>=57344?n[n.length]=fp[224|r>>12]+fp[128|r>>6&63]+fp[128|63&r]:(e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),n[n.length]=fp[240|r>>18]+fp[128|r>>12&63]+fp[128|r>>6&63]+fp[128|63&r])}a+=n.join("")}return a},encodeValuesOnly:!1,format:hp,formatter:dp[hp],indices:!1,serializeDate:e=>kp.call(e),skipNulls:!1,strictNullHandling:!1},Pp={};function Tp(e,t,n,r,i,s,a,o,l,c,u,h,d,p,f,m,g,y){let v=e,b=y,w=0,_=!1;for(;void 0!==(b=b.get(Pp))&&!_;){const t=b.get(e);if(w+=1,void 0!==t){if(t===w)throw new RangeError("Cyclic object value");_=!0}void 0===b.get(Pp)&&(w=0)}if("function"==typeof c?v=c(t,v):v instanceof Date?v=d?.(v):"comma"===n&&bp(v)&&(v=gp(v,(function(e){return e instanceof Date?d?.(e):e}))),null===v){if(s)return l&&!m?l(t,Ap.encoder,g,"key",p):t;v=""}if(function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==typeof e||"bigint"==typeof e}(v)||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(v)){if(l){const e=m?t:l(t,Ap.encoder,g,"key",p);return[f?.(e)+"="+f?.(l(v,Ap.encoder,g,"value",p))]}return[f?.(t)+"="+f?.(String(v))]}const k=[];if(void 0===v)return k;let A;if("comma"===n&&bp(v))m&&l&&(v=gp(v,l)),A=[{value:v.length>0?v.join(",")||null:void 0}];else if(bp(c))A=c;else{const e=Object.keys(v);A=u?e.sort(u):e}const P=o?String(t).replace(/\./g,"%2E"):String(t),T=r&&bp(v)&&1===v.length?P+"[]":P;if(i&&bp(v)&&0===v.length)return T+"[]";for(let t=0;t<A.length;++t){const b=A[t],_="object"==typeof b&&void 0!==b.value?b.value:v[b];if(a&&null===_)continue;const P=h&&o?b.replace(/\./g,"%2E"):b,E=bp(v)?"function"==typeof n?n(T,P):T:T+(h?"."+P:"["+P+"]");y.set(e,w);const x=new WeakMap;x.set(Pp,y),_p(k,Tp(_,E,n,r,i,s,a,o,"comma"===n&&m&&bp(v)?null:l,c,u,h,d,p,f,m,g,x))}return k}const Ep="4.104.0";let xp,Ip,Cp,Op,Sp,Np,jp,Dp,Rp,$p=!1,Lp=null,Mp=null,Fp=null,Up=null;class Bp{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}const Vp=()=>{xp||function(e,t={auto:!1}){if($p)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(xp)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${xp}'\``);$p=t.auto,xp=e.kind,Ip=e.fetch,Lp=e.Request,Mp=e.Response,Fp=e.Headers,Cp=e.FormData,Up=e.Blob,Op=e.File,Sp=e.ReadableStream,Np=e.getMultipartRequestOptions,jp=e.getDefaultAgent,Dp=e.fileFromPath,Rp=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,i,s;try{n=fetch,r=Request,i=Response,s=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:i,Headers:s,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new Bp(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0})};Vp();class zp extends Error{}class Hp extends zp{constructor(e,t,n,r){super(`${Hp.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"],this.error=t;const i=t;this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new qp({message:n,cause:zf(t)});const i=t?.error;return 400===e?new Wp(e,i,n,r):401===e?new Jp(e,i,n,r):403===e?new Zp(e,i,n,r):404===e?new Qp(e,i,n,r):409===e?new Xp(e,i,n,r):422===e?new Yp(e,i,n,r):429===e?new ef(e,i,n,r):e>=500?new tf(e,i,n,r):new Hp(e,i,n,r)}}class Gp extends Hp{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class qp extends Hp{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Kp extends qp{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Wp extends Hp{}class Jp extends Hp{}class Zp extends Hp{}class Qp extends Hp{}class Xp extends Hp{}class Yp extends Hp{}class ef extends Hp{}class tf extends Hp{}class nf extends zp{constructor(){super("Could not parse response content as the length limit was reached")}}class rf extends zp{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var sf,af=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},of=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class lf{constructor(){sf.set(this,void 0),this.buffer=new Uint8Array,af(this,sf,null,"f")}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?(new TextEncoder).encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const r=[];let i;for(;null!=(i=cf(this.buffer,of(this,sf,"f")));){if(i.carriage&&null==of(this,sf,"f")){af(this,sf,i.index,"f");continue}if(null!=of(this,sf,"f")&&(i.index!==of(this,sf,"f")+1||i.carriage)){r.push(this.decodeText(this.buffer.slice(0,of(this,sf,"f")-1))),this.buffer=this.buffer.slice(of(this,sf,"f")),af(this,sf,null,"f");continue}const e=null!==of(this,sf,"f")?i.preceding-1:i.preceding,t=this.decodeText(this.buffer.slice(0,e));r.push(t),this.buffer=this.buffer.slice(i.index),af(this,sf,null,"f")}return r}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new zp(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new zp(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new zp("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function cf(e,t){for(let n=t??0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function uf(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}function hf(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}sf=new WeakMap,lf.NEWLINE_CHARS=new Set(["\n","\r"]),lf.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class df{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;return new df((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const n of async function*(e,t){if(!e.body)throw t.abort(),new zp("Attempted to iterate over a response with no body");const n=new pf,r=new lf,i=hf(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?(new TextEncoder).encode(n):n;let r,i=new Uint8Array(t.length+e.length);for(i.set(t),i.set(e,t.length),t=i;-1!==(r=uf(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(i))for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of r.flush()){const t=n.decode(e);t&&(yield t)}}(e,t))if(!r)if(n.data.startsWith("[DONE]"))r=!0;else if(null===n.event||n.event.startsWith("response.")||n.event.startsWith("transcript.")){let t;try{t=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(t&&t.error)throw new Hp(void 0,t.error,void 0,Sf(e.headers));yield t}else{let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new Hp(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new df((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*(){const t=new lf,n=hf(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new df((()=>r(e)),this.controller),new df((()=>r(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Sp({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:i}=await t.next();if(i)return e.close();const s=n.encode(JSON.stringify(r)+"\n");e.enqueue(s)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}class pf{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(":");return-1!==n?[e.substring(0,n),":",e.substring(n+1)]:[e,"",""]}(e);return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}const ff=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,mf=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&gf(e),gf=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function yf(e,t,n){if(e=await e,mf(e))return e;if(ff(e)){const r=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=gf(r)?[await r.arrayBuffer()]:[r];return new Op(i,t,n)}const r=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(gf(e))t.push(await e.arrayBuffer());else{if(!bf(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){return`[${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const n of e)t.push(n)}return t}(e);if(t||(t=function(e){return vf(e.name)||vf(e.filename)||vf(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!n?.type){const e=r[0]?.type;"string"==typeof e&&(n={...n,type:e})}return new Op(r,t,n)}const vf=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,bf=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],wf=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],_f=async e=>{const t=await kf(e.body);return Np(t,e)},kf=async e=>{const t=new Cp;return await Promise.all(Object.entries(e||{}).map((([e,n])=>Af(t,e,n)))),t},Af=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if((e=>mf(e)||ff(e)||Rp(e))(n)){const r=await yf(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map((n=>Af(e,t+"[]",n))));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map((([n,r])=>Af(e,`${t}[${n}]`,r))))}}};var Pf;async function Tf(e){const{response:t}=e;if(e.options.stream)return Jf("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):df.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type"),r=n?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){const e=await t.json();return Jf("response",t.status,t.url,t.headers,e),Ef(e,t)}const i=await t.text();return Jf("response",t.status,t.url,t.headers,i),i}function Ef(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}Vp();class xf extends Promise{constructor(e,t=Tf){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new xf(this.responsePromise,(async t=>Ef(e(await this.parseResponse(t),t),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class If{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:i}){this.baseURL=e,this.maxRetries=Vf("maxRetries",t),this.timeout=Vf("timeout",n),this.httpAgent=r,this.fetch=i??Ip}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Lf(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Zf()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((async n=>{const r=n&&gf(n?.body)?new DataView(await n.body.arrayBuffer()):n?.body instanceof DataView?n.body:n?.body instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n?.body)?new DataView(n.body.buffer):n?.body;return{method:e,path:t,...n,body:r}})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:i,query:s,headers:a={}}=n,o=ArrayBuffer.isView(n.body)||n.__binaryRequest&&"string"==typeof n.body?n.body:wf(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(i,s);"timeout"in n&&Vf("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const u=n.httpAgent??this.httpAgent??jp(c),h=n.timeout+1e3;return"number"==typeof u?.options?.timeout&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&"get"!==r&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey),{req:{method:r,...o&&{body:o},headers:this.buildHeaders({options:n,headers:a,contentLength:l,retryCount:t}),...u&&{agent:u},signal:n.signal??null},url:c,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const i={};n&&(i["content-length"]=n);const s=this.defaultHeaders(e);return Kf(i,s),Kf(i,t),wf(e.body)&&"node"!==xp&&delete i["content-type"],void 0===Qf(s,"x-stainless-retry-count")&&void 0===Qf(t,"x-stainless-retry-count")&&(i["x-stainless-retry-count"]=String(r)),void 0===Qf(s,"x-stainless-timeout")&&void 0===Qf(t,"x-stainless-timeout")&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,r){return Hp.generate(e,t,n,r)}request(e,t=null){return new xf(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);const{req:i,url:s,timeout:a}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(i,{url:s,options:n}),Jf("request",s,n,i.headers),n.signal?.aborted)throw new Gp;const o=new AbortController,l=await this.fetchWithTimeout(s,i,a,o).catch(zf);if(l instanceof Error){if(n.signal?.aborted)throw new Gp;if(t)return this.retryRequest(n,t);if("AbortError"===l.name)throw new Kp;throw new qp({cause:l})}const c=Sf(l.headers);if(!l.ok){if(t&&this.shouldRetry(l))return Jf(`response (error; retrying, ${t} attempts remaining)`,l.status,s,c),this.retryRequest(n,t,c);const e=await l.text().catch((e=>zf(e).message)),r=Mf(e),i=r?void 0:e;throw Jf(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,s,c,i),this.makeStatusError(l.status,r,i,c)}return{response:l,options:n,controller:o}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Of(this,n,e)}buildURL(e,t){const n=Uf(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return Gf(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new zp(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:i,...s}=t||{};i&&i.addEventListener("abort",(()=>r.abort()));const a=setTimeout((()=>r.abort()),n),o={signal:r.signal,...s};return o.method&&(o.method=o.method.toUpperCase()),this.fetch.call(void 0,e,o).finally((()=>{clearTimeout(a)}))}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,n){let r;const i=n?.["retry-after-ms"];if(i){const e=parseFloat(i);Number.isNaN(e)||(r=e)}const s=n?.["retry-after"];if(s&&!r){const e=parseFloat(s);r=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await Bf(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ep}`}}class Cf{constructor(e,t,n,r){Pf.set(this,void 0),function(e,t,n,r,i){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");t.set(e,n)}(this,Pf,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new zp("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await function(e,t,n,r){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}(this,Pf).requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Pf=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Of extends xf{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await Tf(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const Sf=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Nf={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},jf=e=>"object"==typeof e&&null!==e&&!Gf(e)&&Object.keys(e).every((e=>qf(Nf,e))),Df=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Rf=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let $f;const Lf=()=>$f??($f=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ep,"X-Stainless-OS":Rf(Deno.build.os),"X-Stainless-Arch":Df(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ep,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ep,"X-Stainless-OS":Rf(process.platform),"X-Stainless-Arch":Df(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ep,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ep,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),Mf=e=>{try{return JSON.parse(e)}catch(e){return}},Ff=/^[a-z][a-z0-9+.-]*:/i,Uf=e=>Ff.test(e),Bf=e=>new Promise((t=>setTimeout(t,e))),Vf=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new zp(`${e} must be an integer`);if(t<0)throw new zp(`${e} must be a positive integer`);return t},zf=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},Hf=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function Gf(e){if(!e)return!0;for(const t in e)return!1;return!0}function qf(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Kf(e,t){for(const n in t){if(!qf(t,n))continue;const r=n.toLowerCase();if(!r)continue;const i=t[n];null===i?delete e[r]:void 0!==i&&(e[r]=i)}}const Wf=new Set(["authorization","api-key"]);function Jf(e,...t){if("undefined"!=typeof process&&"true"===process?.env?.DEBUG){const n=t.map((e=>{if(!e)return e;if(e.headers){const t={...e,headers:{...e.headers}};for(const n in e.headers)Wf.has(n.toLowerCase())&&(t.headers[n]="REDACTED");return t}let t=null;for(const n in e)Wf.has(n.toLowerCase())&&(t??(t={...e}),t[n]="REDACTED");return t??e}));console.log(`OpenAI:DEBUG:${e}`,...n)}}const Zf=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),Qf=(e,t)=>{const n=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const r=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,((e,t,n)=>t+n.toUpperCase()));for(const i of[t,n,t.toUpperCase(),r]){const t=e.get(i);if(t)return t}}for(const[r,i]of Object.entries(e))if(r.toLowerCase()===n)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${t} header, using the first entry.`),i[0]):i};function Xf(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class Yf{constructor(e){this._client=e}}class em extends Yf{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class tm extends Yf{list(e,t={},n){return jf(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,am,{query:t,...n})}}class nm extends Cf{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class rm extends Cf{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class im extends Yf{constructor(){super(...arguments),this.messages=new tm(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return jf(e)?this.list({},e):this._client.getAPIList("/chat/completions",sm,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}}class sm extends rm{}class am extends rm{}im.ChatCompletionsPage=sm,im.Messages=tm;class om extends Yf{constructor(){super(...arguments),this.completions=new im(this._client)}}om.Completions=im,om.ChatCompletionsPage=sm;class lm extends Yf{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&Jf("Request","User defined encoding_format:",e.encoding_format);const i=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?i:(Jf("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap((e=>(e&&e.data&&e.data.forEach((e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)})),e))))}}class cm extends Yf{create(e,t){return this._client.post("/files",_f({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return jf(e)?this.list({},e):this._client.getAPIList("/files",um,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),i=Date.now();let s=await this.retrieve(e);for(;!s.status||!r.has(s.status);)if(await Bf(t),s=await this.retrieve(e),Date.now()-i>n)throw new Kp({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return s}}class um extends rm{}cm.FileObjectsPage=um;class hm extends Yf{createVariation(e,t){return this._client.post("/images/variations",_f({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",_f({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class dm extends Yf{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class pm extends Yf{create(e,t){return this._client.post("/audio/transcriptions",_f({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class fm extends Yf{create(e,t){return this._client.post("/audio/translations",_f({body:e,...t,__metadata:{model:e.model}}))}}class mm extends Yf{constructor(){super(...arguments),this.transcriptions=new pm(this._client),this.translations=new fm(this._client),this.speech=new dm(this._client)}}mm.Transcriptions=pm,mm.Translations=fm,mm.Speech=dm;class gm extends Yf{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class ym extends Yf{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",vm,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class vm extends nm{}ym.ModelsPage=vm;class bm extends Yf{}class wm extends Yf{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class _m extends Yf{constructor(){super(...arguments),this.graders=new wm(this._client)}}_m.Graders=wm;class km extends Yf{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Am,{body:t,method:"post",...n})}retrieve(e,t={},n){return jf(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}}class Am extends nm{}km.PermissionCreateResponsesPage=Am;class Pm extends Yf{constructor(){super(...arguments),this.permissions=new km(this._client)}}Pm.Permissions=km,Pm.PermissionCreateResponsesPage=Am;class Tm extends Yf{list(e,t={},n){return jf(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Em,{query:t,...n})}}class Em extends rm{}Tm.FineTuningJobCheckpointsPage=Em;class xm extends Yf{constructor(){super(...arguments),this.checkpoints=new Tm(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return jf(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Im,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return jf(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Cm,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class Im extends rm{}class Cm extends rm{}xm.FineTuningJobsPage=Im,xm.FineTuningJobEventsPage=Cm,xm.Checkpoints=Tm,xm.FineTuningJobCheckpointsPage=Em;class Om extends Yf{constructor(){super(...arguments),this.methods=new bm(this._client),this.jobs=new xm(this._client),this.checkpoints=new Pm(this._client),this.alpha=new _m(this._client)}}Om.Methods=bm,Om.Jobs=xm,Om.FineTuningJobsPage=Im,Om.FineTuningJobEventsPage=Cm,Om.Checkpoints=Pm,Om.Alpha=_m;class Sm extends Yf{}class Nm extends Yf{constructor(){super(...arguments),this.graderModels=new Sm(this._client)}}Nm.GraderModels=Sm;class jm extends Yf{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return jf(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Dm,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...n,headers:r}).withResponse(),s=i.data;switch(s.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=i.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Bf(e);break;case"failed":case"completed":return s}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Rm,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class Dm extends rm{}class Rm extends nm{}jm.VectorStoreFilesPage=Dm,jm.FileContentResponsesPage=Rm;class $m extends Yf{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return jf(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Dm,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:s}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(i.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Bf(e);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=r?.maxConcurrency??5,s=Math.min(i,t.length),a=this._client,o=t.values(),l=[...n],c=Array(s).fill(o).map((async function(e){for(let t of e){const e=await a.files.create({file:t,purpose:"assistants"},r);l.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),n=t.filter((e=>"rejected"===e.status));if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const e of t)"fulfilled"===e.status&&r.push(e.value);return r})(c),await this.createAndPoll(e,{file_ids:l})}}class Lm extends Yf{constructor(){super(...arguments),this.files=new jm(this._client),this.fileBatches=new $m(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return jf(e)?this.list({},e):this._client.getAPIList("/vector_stores",Mm,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,Fm,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class Mm extends rm{}class Fm extends nm{}Lm.VectorStoresPage=Mm,Lm.VectorStoreSearchResponsesPage=Fm,Lm.Files=jm,Lm.VectorStoreFilesPage=Dm,Lm.FileContentResponsesPage=Rm,Lm.FileBatches=$m;class Um extends Yf{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return jf(e)?this.list({},e):this._client.getAPIList("/assistants",Bm,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Bm extends rm{}function Vm(e){return"function"==typeof e.parse}Um.AssistantsPage=Bm;const zm=e=>"assistant"===e?.role,Hm=e=>"function"===e?.role,Gm=e=>"tool"===e?.role;var qm,Km,Wm,Jm,Zm,Qm,Xm,Ym,eg,tg,ng,rg,ig,sg=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},ag=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class og{constructor(){qm.add(this),this.controller=new AbortController,Km.set(this,void 0),Wm.set(this,(()=>{})),Jm.set(this,(()=>{})),Zm.set(this,void 0),Qm.set(this,(()=>{})),Xm.set(this,(()=>{})),Ym.set(this,{}),eg.set(this,!1),tg.set(this,!1),ng.set(this,!1),rg.set(this,!1),sg(this,Km,new Promise(((e,t)=>{sg(this,Wm,e,"f"),sg(this,Jm,t,"f")})),"f"),sg(this,Zm,new Promise(((e,t)=>{sg(this,Qm,e,"f"),sg(this,Xm,t,"f")})),"f"),ag(this,Km,"f").catch((()=>{})),ag(this,Zm,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),ag(this,qm,"m",ig).bind(this))}),0)}_connected(){this.ended||(ag(this,Wm,"f").call(this),this._emit("connect"))}get ended(){return ag(this,eg,"f")}get errored(){return ag(this,tg,"f")}get aborted(){return ag(this,ng,"f")}abort(){this.controller.abort()}on(e,t){return(ag(this,Ym,"f")[e]||(ag(this,Ym,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=ag(this,Ym,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(ag(this,Ym,"f")[e]||(ag(this,Ym,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{sg(this,rg,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){sg(this,rg,!0,"f"),await ag(this,Zm,"f")}_emit(e,...t){if(ag(this,eg,"f"))return;"end"===e&&(sg(this,eg,!0,"f"),ag(this,Qm,"f").call(this));const n=ag(this,Ym,"f")[e];if(n&&(ag(this,Ym,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return ag(this,rg,"f")||n?.length||Promise.reject(e),ag(this,Jm,"f").call(this,e),ag(this,Xm,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];ag(this,rg,"f")||n?.length||Promise.reject(e),ag(this,Jm,"f").call(this,e),ag(this,Xm,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function lg(e){return"auto-parseable-response-format"===e?.$brand}function cg(e){return"auto-parseable-tool"===e?.$brand}function ug(e,t){const n=e.choices.map((e=>{if("length"===e.finish_reason)throw new nf;if("content_filter"===e.finish_reason)throw new rf;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map((e=>function(e,t){const n=e.tools?.find((e=>e.function?.name===t.function.name));return{...t,function:{...t.function,parsed_arguments:cg(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e)))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?hg(t,e.message.content):null}}}));return{...e,choices:n}}function hg(e,t){return"json_schema"!==e.response_format?.type?null:"json_schema"===e.response_format?.type?"$parseRaw"in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function dg(e,t){if(!e)return!1;const n=e.tools?.find((e=>e.function?.name===t.function.name));return cg(n)||n?.function.strict||!1}function pg(e){return!!lg(e.response_format)||(e.tools?.some((e=>cg(e)||"function"===e.type&&!0===e.function.strict))??!1)}Km=new WeakMap,Wm=new WeakMap,Jm=new WeakMap,Zm=new WeakMap,Qm=new WeakMap,Xm=new WeakMap,Ym=new WeakMap,eg=new WeakMap,tg=new WeakMap,ng=new WeakMap,rg=new WeakMap,qm=new WeakSet,ig=function(e){if(sg(this,tg,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new Gp),e instanceof Gp)return sg(this,ng,!0,"f"),this._emit("abort",e);if(e instanceof zp)return this._emit("error",e);if(e instanceof Error){const t=new zp(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new zp(String(e)))};var fg,mg,gg,yg,vg,bg,wg,_g,kg=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const Ag=10;class Pg extends og{constructor(){super(...arguments),fg.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(Hm(e)||Gm(e))&&e.content)this._emit("functionCallResult",e.content);else if(zm(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(zm(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new zp("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),kg(this,fg,"m",mg).call(this)}async finalMessage(){return await this.done(),kg(this,fg,"m",gg).call(this)}async finalFunctionCall(){return await this.done(),kg(this,fg,"m",yg).call(this)}async finalFunctionCallResult(){return await this.done(),kg(this,fg,"m",vg).call(this)}async totalUsage(){return await this.done(),kg(this,fg,"m",bg).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=kg(this,fg,"m",gg).call(this);t&&this._emit("finalMessage",t);const n=kg(this,fg,"m",mg).call(this);n&&this._emit("finalContent",n);const r=kg(this,fg,"m",yg).call(this);r&&this._emit("finalFunctionCall",r);const i=kg(this,fg,"m",vg).call(this);null!=i&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",kg(this,fg,"m",bg).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),kg(this,fg,"m",wg).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(ug(i,t))}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const r="function",{function_call:i="auto",stream:s,...a}=t,o="string"!=typeof i&&i?.name,{maxChatCompletions:l=Ag}=n||{},c={};for(const e of t.functions)c[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...a,function_call:i,functions:u,messages:[...this.messages]},n),s=t.choices[0]?.message;if(!s)throw new zp("missing message in ChatCompletion response");if(!s.function_call)return;const{name:l,arguments:h}=s.function_call,d=c[l];if(!d){const e=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:r,name:l,content:e});continue}if(o&&o!==l){const e=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,name:l,content:e});continue}let p;try{p=Vm(d)?await d.parse(h):h}catch(e){this._addMessage({role:r,name:l,content:e instanceof Error?e.message:String(e)});continue}const f=await d.function(p,this),m=kg(this,fg,"m",_g).call(this,f);if(this._addMessage({role:r,name:l,content:m}),o)return}}async _runTools(e,t,n){const r="tool",{tool_choice:i="auto",stream:s,...a}=t,o="string"!=typeof i&&i?.function?.name,{maxChatCompletions:l=Ag}=n||{},c=t.tools.map((e=>{if(cg(e)){if(!e.$callback)throw new zp("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),u={};for(const e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);const h="tools"in t?c.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...a,tool_choice:i,tools:h,messages:[...this.messages]},n),s=t.choices[0]?.message;if(!s)throw new zp("missing message in ChatCompletion response");if(!s.tool_calls?.length)return;for(const t of s.tool_calls){if("function"!==t.type)continue;const n=t.id,{name:i,arguments:s}=t.function,a=u[i];if(!a){const e=`Invalid tool_call: ${JSON.stringify(i)}. Available options are: ${Object.keys(u).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:n,content:e});continue}if(o&&o!==i){const e=`Invalid tool_call: ${JSON.stringify(i)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:n,content:e});continue}let l;try{l=Vm(a)?await a.parse(s):s}catch(e){const t=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:n,content:t});continue}const c=await a.function(l,this),h=kg(this,fg,"m",_g).call(this,c);if(this._addMessage({role:r,tool_call_id:n,content:h}),o)return}}}}fg=new WeakSet,mg=function(){return kg(this,fg,"m",gg).call(this).content??null},gg=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(zm(t)){const{function_call:e,...n}=t,r={...n,content:t.content??null,refusal:t.refusal??null};return e&&(r.function_call=e),r}}throw new zp("stream ended without producing a ChatCompletionMessage with role=assistant")},yg=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(zm(t)&&t?.function_call)return t.function_call;if(zm(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},vg=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Hm(t)&&null!=t.content)return t.content;if(Gm(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},bg=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},wg=function(e){if(null!=e.n&&e.n>1)throw new zp("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},_g=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Tg extends Pg{static runFunctions(e,t,n){const r=new Tg,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,i))),r}static runTools(e,t,n){const r=new Tg,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,i))),r}_addMessage(e,t=!0){super._addMessage(e,t),zm(e)&&e.content&&this._emit("content",e.content)}}class Eg extends Error{}class xg extends Error{}const Ig=e=>function(e,t=511){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return((e,t)=>{const n=e.length;let r=0;const i=e=>{throw new Eg(`${e} at position ${r}`)},s=e=>{throw new xg(`${e} at position ${r}`)},a=()=>(h(),r>=n&&i("Unexpected end of input"),'"'===e[r]?o():"{"===e[r]?l():"["===e[r]?c():"null"===e.substring(r,r+4)||16&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||32&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||32&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||128&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||256&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||64&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),o=()=>{const a=r;let o=!1;for(r++;r<n&&('"'!==e[r]||o&&"\\"===e[r-1]);)o="\\"===e[r]&&!o,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(a,++r-Number(o)))}catch(e){s(String(e))}else if(1&t)try{return JSON.parse(e.substring(a,r-Number(o))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},l=()=>{r++,h();const s={};try{for(;"}"!==e[r];){if(h(),r>=n&&8&t)return s;const i=o();h(),r++;try{const e=a();Object.defineProperty(s,i,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(8&t)return s;throw e}h(),","===e[r]&&r++}}catch(e){if(8&t)return s;i("Expected '}' at end of object")}return r++,s},c=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(a()),h(),","===e[r]&&r++}catch(e){if(4&t)return n;i("Expected ']' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&2&t&&i("Not sure what '-' is");try{return JSON.parse(e)}catch(n){if(2&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}s(String(n))}}const a=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||2&t||i("Unterminated number literal");try{return JSON.parse(e.substring(a,r))}catch(n){"-"===e.substring(a,r)&&2&t&&i("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){s(String(e))}}},h=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return a()})(e.trim(),t)}(e,509);var Cg,Og,Sg,Ng,jg,Dg,Rg,$g,Lg,Mg,Fg,Ug,Bg=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},Vg=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class zg extends Pg{constructor(e){super(),Cg.add(this),Og.set(this,void 0),Sg.set(this,void 0),Ng.set(this,void 0),Bg(this,Og,e,"f"),Bg(this,Sg,[],"f")}get currentChatCompletionSnapshot(){return Vg(this,Ng,"f")}static fromReadableStream(e){const t=new zg(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const r=new zg(t);return r._run((()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),Vg(this,Cg,"m",jg).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of i)Vg(this,Cg,"m",Rg).call(this,e);if(i.controller.signal?.aborted)throw new Gp;return this._addChatCompletion(Vg(this,Cg,"m",Mg).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),Vg(this,Cg,"m",jg).call(this),this._connected();const r=df.fromReadableStream(e,this.controller);let i;for await(const e of r)i&&i!==e.id&&this._addChatCompletion(Vg(this,Cg,"m",Mg).call(this)),Vg(this,Cg,"m",Rg).call(this,e),i=e.id;if(r.controller.signal?.aborted)throw new Gp;return this._addChatCompletion(Vg(this,Cg,"m",Mg).call(this))}[(Og=new WeakMap,Sg=new WeakMap,Ng=new WeakMap,Cg=new WeakSet,jg=function(){this.ended||Bg(this,Ng,void 0,"f")},Dg=function(e){let t=Vg(this,Sg,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Vg(this,Sg,"f")[e.index]=t,t)},Rg=function(e){if(this.ended)return;const t=Vg(this,Cg,"m",Ug).call(this,e);this._emit("chunk",e,t);for(const n of e.choices){const e=t.choices[n.index];null!=n.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),null!=n.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=n.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const r=Vg(this,Cg,"m",Dg).call(this,e);e.finish_reason&&(Vg(this,Cg,"m",Lg).call(this,e),null!=r.current_tool_call_index&&Vg(this,Cg,"m",$g).call(this,e,r.current_tool_call_index));for(const t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(Vg(this,Cg,"m",Lg).call(this,e),null!=r.current_tool_call_index&&Vg(this,Cg,"m",$g).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(const t of n.delta.tool_calls??[]){const n=e.message.tool_calls?.[t.index];n?.type&&"function"===n?.type&&this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""})}}},$g=function(e,t){if(Vg(this,Cg,"m",Dg).call(this,e).done_tool_calls.has(t))return;const n=e.message.tool_calls?.[t];if(!n)throw new Error("no tool call snapshot");if(!n.type)throw new Error("tool call snapshot missing `type`");if("function"===n.type){const e=Vg(this,Og,"f")?.tools?.find((e=>"function"===e.type&&e.function.name===n.function.name));this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:cg(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},Lg=function(e){const t=Vg(this,Cg,"m",Dg).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const n=Vg(this,Cg,"m",Fg).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Mg=function(){if(this.ended)throw new zp("stream has ended, this shouldn't happen");const e=Vg(this,Ng,"f");if(!e)throw new zp("request ended without sending any chunks");return Bg(this,Ng,void 0,"f"),Bg(this,Sg,[],"f"),function(e,t){const{id:n,choices:r,created:i,model:s,system_fingerprint:a,...o}=e,l={...o,id:n,choices:r.map((({message:t,finish_reason:n,index:r,logprobs:i,...s})=>{if(!n)throw new zp(`missing finish_reason for choice ${r}`);const{content:a=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new zp(`missing role for choice ${r}`);if(o){const{arguments:e,name:l}=o;if(null==e)throw new zp(`missing function_call.arguments for choice ${r}`);if(!l)throw new zp(`missing function_call.name for choice ${r}`);return{...s,message:{content:a,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}return l?{...s,index:r,finish_reason:n,logprobs:i,message:{...c,role:u,content:a,refusal:t.refusal??null,tool_calls:l.map(((t,n)=>{const{function:i,type:s,id:a,...o}=t,{arguments:l,name:c,...u}=i||{};if(null==a)throw new zp(`missing choices[${r}].tool_calls[${n}].id\n${Hg(e)}`);if(null==s)throw new zp(`missing choices[${r}].tool_calls[${n}].type\n${Hg(e)}`);if(null==c)throw new zp(`missing choices[${r}].tool_calls[${n}].function.name\n${Hg(e)}`);if(null==l)throw new zp(`missing choices[${r}].tool_calls[${n}].function.arguments\n${Hg(e)}`);return{...o,id:a,type:s,function:{...u,name:c,arguments:l}}}))}}:{...s,message:{...c,content:a,role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}})),created:i,model:s,object:"chat.completion",...a?{system_fingerprint:a}:{}};return function(e,t){return t&&pg(t)?ug(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}})))}}(l,t)}(e,Vg(this,Og,"f"))},Fg=function(){const e=Vg(this,Og,"f")?.response_format;return lg(e)?e:null},Ug=function(e){var t,n,r,i;let s=Vg(this,Ng,"f");const{choices:a,...o}=e;s?Object.assign(s,o):s=Bg(this,Ng,{...o,choices:[]},"f");for(const{delta:a,finish_reason:o,index:l,logprobs:c=null,...u}of e.choices){let e=s.choices[l];if(e||(e=s.choices[l]={finish_reason:o,index:l,message:{},logprobs:c,...u}),c)if(e.logprobs){const{content:r,refusal:i,...s}=c;Object.assign(e.logprobs,s),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),i&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...i))}else e.logprobs=Object.assign({},c);if(o&&(e.finish_reason=o,Vg(this,Og,"f")&&pg(Vg(this,Og,"f")))){if("length"===o)throw new nf;if("content_filter"===o)throw new rf}if(Object.assign(e,u),!a)continue;const{content:h,refusal:d,function_call:p,role:f,tool_calls:m,...g}=a;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),h&&(e.message.content=(e.message.content||"")+h,!e.message.refusal&&Vg(this,Cg,"m",Fg).call(this)&&(e.message.parsed=Ig(e.message.content))),m){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:r,function:s,...a}of m){const o=(i=e.message.tool_calls)[t]??(i[t]={});Object.assign(o,a),n&&(o.id=n),r&&(o.type=r),s&&(o.function??(o.function={name:s.name??"",arguments:""})),s?.name&&(o.function.name=s.name),s?.arguments&&(o.function.arguments+=s.arguments,dg(Vg(this,Og,"f"),o)&&(o.function.parsed_arguments=Ig(o.function.arguments)))}}}return s},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new df(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Hg(e){return JSON.stringify(e)}class Gg extends zg{static fromReadableStream(e){const t=new Gg(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const r=new Gg(null),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,i))),r}static runTools(e,t,n){const r=new Gg(t),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,i))),r}}class qg extends Yf{parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new zp(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new zp(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap((t=>ug(t,e)))}runFunctions(e,t){return e.stream?Gg.runFunctions(this._client,e,t):Tg.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Gg.runTools(this._client,e,t):Tg.runTools(this._client,e,t)}stream(e,t){return zg.createChatCompletion(this._client,e,t)}}class Kg extends Yf{constructor(){super(...arguments),this.completions=new qg(this._client)}}!function(e){e.Completions=qg}(Kg||(Kg={}));class Wg extends Yf{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Jg extends Yf{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Zg extends Yf{constructor(){super(...arguments),this.sessions=new Wg(this._client),this.transcriptionSessions=new Jg(this._client)}}Zg.Sessions=Wg,Zg.TranscriptionSessions=Jg;var Qg,Xg,Yg,ey,ty,ny,ry,iy,sy,ay,oy,ly,cy,uy,hy,dy,py,fy,my,gy,yy,vy,by=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},wy=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};class _y extends og{constructor(){super(...arguments),Qg.add(this),Xg.set(this,[]),Yg.set(this,{}),ey.set(this,{}),ty.set(this,void 0),ny.set(this,void 0),ry.set(this,void 0),iy.set(this,void 0),sy.set(this,void 0),ay.set(this,void 0),oy.set(this,void 0),ly.set(this,void 0),cy.set(this,void 0)}[(Xg=new WeakMap,Yg=new WeakMap,ey=new WeakMap,ty=new WeakMap,ny=new WeakMap,ry=new WeakMap,iy=new WeakMap,sy=new WeakMap,ay=new WeakMap,oy=new WeakMap,ly=new WeakMap,cy=new WeakMap,Qg=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new _y;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const r=df.fromReadableStream(e,this.controller);for await(const e of r)by(this,Qg,"m",uy).call(this,e);if(r.controller.signal?.aborted)throw new Gp;return this._addRun(by(this,Qg,"m",hy).call(this))}toReadableStream(){return new df(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,i){const s=new _y;return s._run((()=>s._runToolAssistantStream(e,t,n,r,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}}))),s}async _createToolAssistantStream(e,t,n,r,i){const s=i?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort())));const a={...r,stream:!0},o=await e.submitToolOutputs(t,n,a,{...i,signal:this.controller.signal});this._connected();for await(const e of o)by(this,Qg,"m",uy).call(this,e);if(o.controller.signal?.aborted)throw new Gp;return this._addRun(by(this,Qg,"m",hy).call(this))}static createThreadAssistantStream(e,t,n){const r=new _y;return r._run((()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}static createAssistantStream(e,t,n,r){const i=new _y;return i._run((()=>i._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),i}currentEvent(){return by(this,oy,"f")}currentRun(){return by(this,ly,"f")}currentMessageSnapshot(){return by(this,ty,"f")}currentRunStepSnapshot(){return by(this,cy,"f")}async finalRunSteps(){return await this.done(),Object.values(by(this,Yg,"f"))}async finalMessages(){return await this.done(),Object.values(by(this,ey,"f"))}async finalRun(){if(await this.done(),!by(this,ny,"f"))throw Error("Final run was not received.");return by(this,ny,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const i={...t,stream:!0},s=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(const e of s)by(this,Qg,"m",uy).call(this,e);if(s.controller.signal?.aborted)throw new Gp;return this._addRun(by(this,Qg,"m",hy).call(this))}async _createAssistantStream(e,t,n,r){const i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort())));const s={...n,stream:!0},a=await e.create(t,s,{...r,signal:this.controller.signal});this._connected();for await(const e of a)by(this,Qg,"m",uy).call(this,e);if(a.controller.signal?.aborted)throw new Gp;return this._addRun(by(this,Qg,"m",hy).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else{if(!Xf(t)||!Xf(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...r);continue}for(const e of r){if(!Xf(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,i){return await this._createToolAssistantStream(n,e,t,r,i)}}uy=function(e){if(!this.ended)switch(wy(this,oy,e,"f"),by(this,Qg,"m",fy).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":by(this,Qg,"m",vy).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":by(this,Qg,"m",py).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":by(this,Qg,"m",dy).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},hy=function(){if(this.ended)throw new zp("stream has ended, this shouldn't happen");if(!by(this,ny,"f"))throw Error("Final run has not been received");return by(this,ny,"f")},dy=function(e){const[t,n]=by(this,Qg,"m",gy).call(this,e,by(this,ty,"f"));wy(this,ty,t,"f"),by(this,ey,"f")[t.id]=t;for(const e of n){const n=t.content[e.index];"text"==n?.type&&this._emit("textCreated",n.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=by(this,ry,"f")){if(by(this,iy,"f"))switch(by(this,iy,"f").type){case"text":this._emit("textDone",by(this,iy,"f").text,by(this,ty,"f"));break;case"image_file":this._emit("imageFileDone",by(this,iy,"f").image_file,by(this,ty,"f"))}wy(this,ry,n.index,"f")}wy(this,iy,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==by(this,ry,"f")){const t=e.data.content[by(this,ry,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,by(this,ty,"f"));break;case"text":this._emit("textDone",t.text,by(this,ty,"f"))}}by(this,ty,"f")&&this._emit("messageDone",e.data),wy(this,ty,void 0,"f")}},py=function(e){const t=by(this,Qg,"m",my).call(this,e);switch(wy(this,cy,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==by(this,sy,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(by(this,ay,"f")&&this._emit("toolCallDone",by(this,ay,"f")),wy(this,sy,e.index,"f"),wy(this,ay,t.step_details.tool_calls[e.index],"f"),by(this,ay,"f")&&this._emit("toolCallCreated",by(this,ay,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":wy(this,cy,void 0,"f"),"tool_calls"==e.data.step_details.type&&by(this,ay,"f")&&(this._emit("toolCallDone",by(this,ay,"f")),wy(this,ay,void 0,"f")),this._emit("runStepDone",e.data,t)}},fy=function(e){by(this,Xg,"f").push(e),this._emit("event",e)},my=function(e){switch(e.event){case"thread.run.step.created":return by(this,Yg,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=by(this,Yg,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=_y.accumulateDelta(t,n.delta);by(this,Yg,"f")[e.data.id]=r}return by(this,Yg,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":by(this,Yg,"f")[e.data.id]=e.data}if(by(this,Yg,"f")[e.data.id])return by(this,Yg,"f")[e.data.id];throw new Error("No snapshot available")},gy=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=by(this,Qg,"m",yy).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},yy=function(e,t){return _y.accumulateDelta(t,e)},vy=function(e){switch(wy(this,ly,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":wy(this,ny,e.data,"f"),by(this,ay,"f")&&(this._emit("toolCallDone",by(this,ay,"f")),wy(this,ay,void 0,"f"))}};class ky extends Yf{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return jf(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Ay,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class Ay extends rm{}ky.MessagesPage=Ay;class Py extends Yf{retrieve(e,t,n,r={},i){return jf(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}list(e,t,n={},r){return jf(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Ty,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class Ty extends rm{}Py.RunStepsPage=Ty;class Ey extends Yf{constructor(){super(...arguments),this.steps=new Py(this._client)}create(e,t,n){const{include:r,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return jf(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,xy,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return _y.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:i,response:s}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Bf(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return _y.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const i=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,i.id,r)}submitToolOutputsStream(e,t,n,r){return _y.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}}class xy extends rm{}Ey.RunsPage=xy,Ey.Steps=Py,Ey.RunStepsPage=Ty;class Iy extends Yf{constructor(){super(...arguments),this.runs=new Ey(this._client),this.messages=new ky(this._client)}create(e={},t){return jf(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return _y.createThreadAssistantStream(e,this._client.beta.threads,t)}}Iy.Runs=Ey,Iy.RunsPage=xy,Iy.Messages=ky,Iy.MessagesPage=Ay;class Cy extends Yf{constructor(){super(...arguments),this.realtime=new Zg(this._client),this.chat=new Kg(this._client),this.assistants=new Um(this._client),this.threads=new Iy(this._client)}}Cy.Realtime=Zg,Cy.Assistants=Um,Cy.AssistantsPage=Bm,Cy.Threads=Iy;class Oy extends Yf{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return jf(e)?this.list({},e):this._client.getAPIList("/batches",Sy,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Sy extends rm{}Oy.BatchesPage=Sy;class Ny extends Yf{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,_f({body:t,...n}))}}class jy extends Yf{constructor(){super(...arguments),this.parts=new Ny(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}function Dy(e,t){const n=e.output.map((e=>{if("function_call"===e.type)return{...e,parsed_arguments:Ly(t,e)};if("message"===e.type){const n=e.content.map((e=>"output_text"===e.type?{...e,parsed:Ry(t,e.text)}:e));return{...e,content:n}}return e})),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||My(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const e of r.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),r}function Ry(e,t){if("json_schema"!==e.text?.format?.type)return null;if("$parseRaw"in e.text?.format){const n=e.text?.format;return n.$parseRaw(t)}return JSON.parse(t)}function $y(e){return"auto-parseable-tool"===e?.$brand}function Ly(e,t){const n=function(e,t){return e.find((e=>"function"===e.type&&e.name===t))}(e.tools??[],t.name);return{...t,...t,parsed_arguments:$y(n)?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}function My(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}jy.Parts=Ny;class Fy extends Yf{list(e,t={},n){return jf(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,Yy,{query:t,...n})}}var Uy,By,Vy,zy,Hy,Gy,qy,Ky,Wy,Jy=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},Zy=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Qy extends og{constructor(e){super(),Uy.add(this),By.set(this,void 0),Vy.set(this,void 0),zy.set(this,void 0),Jy(this,By,e,"f")}static createResponse(e,t,n){const r=new Qy(t);return r._run((()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createOrRetrieveResponse(e,t,n){const r=n?.signal;let i;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),Zy(this,Uy,"m",Hy).call(this);let s=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),s=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const e of i)Zy(this,Uy,"m",Gy).call(this,e,s);if(i.controller.signal?.aborted)throw new Gp;return Zy(this,Uy,"m",qy).call(this)}[(By=new WeakMap,Vy=new WeakMap,zy=new WeakMap,Uy=new WeakSet,Hy=function(){this.ended||Jy(this,Vy,void 0,"f")},Gy=function(e,t){if(this.ended)return;const n=(e,n)=>{(null==t||n.sequence_number>t)&&this._emit(e,n)},r=Zy(this,Uy,"m",Ky).call(this,e);switch(n("event",e),e.type){case"response.output_text.delta":{const t=r.output[e.output_index];if(!t)throw new zp(`missing output at index ${e.output_index}`);if("message"===t.type){const r=t.content[e.content_index];if(!r)throw new zp(`missing content at index ${e.content_index}`);if("output_text"!==r.type)throw new zp(`expected content to be 'output_text', got ${r.type}`);n("response.output_text.delta",{...e,snapshot:r.text})}break}case"response.function_call_arguments.delta":{const t=r.output[e.output_index];if(!t)throw new zp(`missing output at index ${e.output_index}`);"function_call"===t.type&&n("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:n(e.type,e)}},qy=function(){if(this.ended)throw new zp("stream has ended, this shouldn't happen");const e=Zy(this,Vy,"f");if(!e)throw new zp("request ended without sending any events");Jy(this,Vy,void 0,"f");const t=function(e,t){return function(e,t){return t&&function(e){return!!lg(e.text?.format)}(t)?Dy(e,t):{...e,output_parsed:null,output:e.output.map((e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map((e=>({...e,parsed:null})))}:e))}}(e,t)}(e,Zy(this,By,"f"));return Jy(this,zy,t,"f"),t},Ky=function(e){let t=Zy(this,Vy,"f");if(!t){if("response.created"!==e.type)throw new zp(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=Jy(this,Vy,e.response,"f"),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new zp(`missing output at index ${e.output_index}`);"message"===n.type&&n.content.push(e.part);break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new zp(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new zp(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new zp(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new zp(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.completed":Jy(this,Vy,e.response,"f")}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Zy(this,zy,"f");if(!e)throw new zp("stream ended without producing a ChatCompletion");return e}}class Xy extends Yf{constructor(){super(...arguments),this.inputItems=new Fy(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap((e=>("object"in e&&"response"===e.object&&My(e),e)))}retrieve(e,t={},n){return this._client.get(`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap((t=>Dy(t,e)))}stream(e,t){return Qy.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class Yy extends rm{}Xy.InputItems=Fy;class ev extends Yf{retrieve(e,t,n,r){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,r)}list(e,t,n={},r){return jf(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,tv,{query:n,...r})}}class tv extends rm{}ev.OutputItemListResponsesPage=tv;class nv extends Yf{constructor(){super(...arguments),this.outputItems=new ev(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return jf(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,rv,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class rv extends rm{}nv.RunListResponsesPage=rv,nv.OutputItems=ev,nv.OutputItemListResponsesPage=tv;class iv extends Yf{constructor(){super(...arguments),this.runs=new nv(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return jf(e)?this.list({},e):this._client.getAPIList("/evals",sv,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class sv extends rm{}iv.EvalListResponsesPage=sv,iv.Runs=nv,iv.RunListResponsesPage=rv;class av extends Yf{retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n?.headers},__binaryResponse:!0})}}class ov extends Yf{constructor(){super(...arguments),this.content=new av(this._client)}create(e,t,n){return this._client.post(`/containers/${e}/files`,_f({body:t,...n}))}retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}`,n)}list(e,t={},n){return jf(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,lv,{query:t,...n})}del(e,t,n){return this._client.delete(`/containers/${e}/files/${t}`,{...n,headers:{Accept:"*/*",...n?.headers}})}}class lv extends rm{}ov.FileListResponsesPage=lv,ov.Content=av;class cv extends Yf{constructor(){super(...arguments),this.files=new ov(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return jf(e)?this.list({},e):this._client.getAPIList("/containers",uv,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class uv extends rm{}cv.ContainerListResponsesPage=uv,cv.Files=ov,cv.FileListResponsesPage=lv;class hv extends If{constructor({baseURL:e=Hf("OPENAI_BASE_URL"),apiKey:t=Hf("OPENAI_API_KEY"),organization:n=Hf("OPENAI_ORG_ID")??null,project:r=Hf("OPENAI_PROJECT_ID")??null,...i}={}){if(void 0===t)throw new zp("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const s={apiKey:t,organization:n,project:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!s.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new zp("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:s.baseURL,timeout:s.timeout??6e5,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.completions=new em(this),this.chat=new om(this),this.embeddings=new lm(this),this.files=new cm(this),this.images=new hm(this),this.audio=new mm(this),this.moderations=new gm(this),this.models=new ym(this),this.fineTuning=new Om(this),this.graders=new Nm(this),this.vectorStores=new Lm(this),this.beta=new Cy(this),this.batches=new Oy(this),this.uploads=new jy(this),this.responses=new Xy(this),this.evals=new iv(this),this.containers=new cv(this),this._options=s,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return function(e,t={}){let n=e;const r=function(e=Ap){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||Ap.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=hp;if(void 0!==e.format){if(!yp.call(dp,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=dp[n];let i,s=Ap.filter;if(("function"==typeof e.filter||bp(e.filter))&&(s=e.filter),i=e.arrayFormat&&e.arrayFormat in vp?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":Ap.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=void 0===e.allowDots?1==!!e.encodeDotInKeys||Ap.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:Ap.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:Ap.allowEmptyArrays,arrayFormat:i,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:Ap.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?Ap.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:Ap.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:Ap.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:Ap.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:Ap.encodeValuesOnly,filter:s,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:Ap.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:Ap.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:Ap.strictNullHandling}}(t);let i,s;"function"==typeof r.filter?(s=r.filter,n=s("",n)):bp(r.filter)&&(s=r.filter,i=s);const a=[];if("object"!=typeof n||null===n)return"";const o=vp[r.arrayFormat],l="comma"===o&&r.commaRoundTrip;i||(i=Object.keys(n)),r.sort&&i.sort(r.sort);const c=new WeakMap;for(let e=0;e<i.length;++e){const t=i[e];r.skipNulls&&null===n[t]||_p(a,Tp(n[t],t,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const u=a.join(r.delimiter);let h=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""}(e,{arrayFormat:"brackets"})}}Wy=hv,hv.OpenAI=Wy,hv.DEFAULT_TIMEOUT=6e5,hv.OpenAIError=zp,hv.APIError=Hp,hv.APIConnectionError=qp,hv.APIConnectionTimeoutError=Kp,hv.APIUserAbortError=Gp,hv.NotFoundError=Qp,hv.ConflictError=Xp,hv.RateLimitError=ef,hv.BadRequestError=Wp,hv.AuthenticationError=Jp,hv.InternalServerError=tf,hv.PermissionDeniedError=Zp,hv.UnprocessableEntityError=Yp,hv.toFile=yf,hv.fileFromPath=Dp,hv.Completions=em,hv.Chat=om,hv.ChatCompletionsPage=sm,hv.Embeddings=lm,hv.Files=cm,hv.FileObjectsPage=um,hv.Images=hm,hv.Audio=mm,hv.Moderations=gm,hv.Models=ym,hv.ModelsPage=vm,hv.FineTuning=Om,hv.Graders=Nm,hv.VectorStores=Lm,hv.VectorStoresPage=Mm,hv.VectorStoreSearchResponsesPage=Fm,hv.Beta=Cy,hv.Batches=Oy,hv.BatchesPage=Sy,hv.Uploads=jy,hv.Responses=Xy,hv.Evals=iv,hv.EvalListResponsesPage=sv,hv.Containers=cv,hv.ContainerListResponsesPage=uv,new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/images/edits"]);const dv=hv;function pv(e,t=fv){e=e.trim();const n=/```(json)?(.*)```/s.exec(e);return t(n?n[2]:e)}function fv(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="";const n=[];let r=!1,i=!1;for(let s of e){if(r)'"'!==s||i?"\n"!==s||i?i="\\"===s&&!i:s="\\n":r=!1;else if('"'===s)r=!0,i=!1;else if("{"===s)n.push("}");else if("["===s)n.push("]");else if("}"===s||"]"===s){if(!n||n[n.length-1]!==s)return null;n.pop()}t+=s}r&&(t+='"');for(let e=n.length-1;e>=0;e-=1)t+=n[e];try{return JSON.parse(t)}catch(e){return null}}var mv=i(409);function gv(e,t){return t?.[e]||mv(e)}function yv(e,t,n){const r={};for(const i in e)Object.hasOwn(e,i)&&(r[t(i,n)]=e[i]);return r}function vv(e){return Array.isArray(e)?[...e]:{...e}}function bv(e,t){const n=vv(e);for(const[e,r]of Object.entries(t)){const[t,...i]=e.split(".").reverse();let s=n;for(const e of i.reverse()){if(void 0===s[e])break;s[e]=vv(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[r]})}return n}function wv(e){const t=Object.getPrototypeOf(e);return"function"!=typeof e.lc_name||"function"==typeof t.lc_name&&e.lc_name()===t.lc_name()?e.name:e.lc_name()}i(832);class _v{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,wv(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof _v||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let r=Object.getPrototypeOf(this);r;r=Object.getPrototypeOf(r))Object.assign(e,Reflect.get(r,"lc_aliases",this)),Object.assign(t,Reflect.get(r,"lc_secrets",this)),Object.assign(n,Reflect.get(r,"lc_attributes",this));return Object.keys(t).forEach((e=>{let t=this,r=n;const[i,...s]=e.split(".").reverse();for(const e of s.reverse()){if(!(e in t)||void 0===t[e])return;e in r&&void 0!==r[e]||("object"==typeof t[e]&&null!=t[e]?r[e]={}:Array.isArray(t[e])&&(r[e]=[])),t=t[e],r=r[e]}i in t&&void 0!==t[i]&&(r[i]=r[i]||t[i])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:yv(Object.keys(t).length?bv(n,t):n,gv,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function kv(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}class Av extends _v{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}function Pv(e,t){const n={...e};for(const[e,r]of Object.entries(t))if(null==n[e])n[e]=r;else{if(null==r)continue;if(typeof n[e]!=typeof r||Array.isArray(n[e])!==Array.isArray(r))throw new Error(`field[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof n[e])n[e]=n[e]+r;else if(Array.isArray(n[e])||"object"!=typeof n[e])if(Array.isArray(n[e]))n[e]=Tv(n[e],r);else{if(n[e]===r)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else n[e]=Pv(n[e],r)}return n}function Tv(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{const n=[...e];for(const e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){const t=n.findIndex((t=>t.index===e.index));-1!==t?n[t]=Pv(n[t],e):n.push(e)}else n.push(e);return n}}}class Ev extends Av{}function xv(e){return"function"==typeof e?._getType}class Iv extends Ev{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Iv({content:kv(this.content,e.content),additional_kwargs:Pv(this.additional_kwargs,e.additional_kwargs),response_metadata:Pv(this.response_metadata,e.response_metadata),tool_call_id:this.tool_call_id})}}class Cv extends Av{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let n;if("string"==typeof e)n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const t=n.additional_kwargs?.tool_calls,r=n.tool_calls;null!=t&&t.length>0&&(void 0===r||0===r.length)&&console.warn(["New LangChain packages are available that more efficiently handle","tool calling.\n\nPlease upgrade your packages to versions that set","message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(null!=t&&void 0===r){const[e,r]=function(e){const t=[],n=[];for(const r of e)if(r.function){const e=r.function.name;try{const n={name:e||"",args:JSON.parse(r.function.arguments)||{},id:r.id};t.push(n)}catch(t){n.push({name:e,args:r.function.arguments,id:r.id,error:"Malformed args."})}}return[t,n]}(t);n.tool_calls=e??[],n.invalid_tool_calls=r??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch(e){n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),"string"!=typeof n&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls)}static lc_name(){return"AIMessage"}_getType(){return"ai"}}class Ov extends Ev{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{const n=[],r=[];for(const t of e.tool_call_chunks){let i={};try{if(i=fv(t.args??"{}")??{},"object"!=typeof i||Array.isArray(i))throw new Error("Malformed tool call chunk args.");n.push({name:t.name??"",args:i,id:t.id})}catch(e){r.push({name:t.name,args:t.args,id:t.id,error:"Malformed args."})}}t={...e,tool_calls:n,invalid_tool_calls:r}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.tool_call_chunks=t?.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t?.tool_calls??this.tool_calls,this.invalid_tool_calls=t?.invalid_tool_calls??this.invalid_tool_calls}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){const t={content:kv(this.content,e.content),additional_kwargs:Pv(this.additional_kwargs,e.additional_kwargs),response_metadata:Pv(this.response_metadata,e.response_metadata),tool_call_chunks:[]};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){const n=Tv(this.tool_call_chunks,e.tool_call_chunks);void 0!==n&&n.length>0&&(t.tool_call_chunks=n)}return new Ov(t)}}class Sv extends Av{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Sv}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}class Nv extends Ev{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Nv({content:kv(this.content,e.content),additional_kwargs:Pv(this.additional_kwargs,e.additional_kwargs),response_metadata:Pv(this.response_metadata,e.response_metadata),role:this.role})}}class jv extends Ev{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new jv({content:kv(this.content,e.content),additional_kwargs:Pv(this.additional_kwargs,e.additional_kwargs),response_metadata:Pv(this.response_metadata,e.response_metadata),name:this.name??""})}}class Dv extends Av{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Rv extends Ev{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Rv({content:kv(this.content,e.content),additional_kwargs:Pv(this.additional_kwargs,e.additional_kwargs),response_metadata:Pv(this.response_metadata,e.response_metadata)})}}class $v extends Av{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class Lv extends Ev{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new Lv({content:kv(this.content,e.content),additional_kwargs:Pv(this.additional_kwargs,e.additional_kwargs),response_metadata:Pv(this.response_metadata,e.response_metadata)})}}function Mv(e){if("string"==typeof e)return new Dv(e);if(xv(e))return e;const[t,n]=e;if("human"===t||"user"===t)return new Dv({content:n});if("ai"===t||"assistant"===t)return new Cv({content:n});if("system"===t)return new $v({content:n});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function Fv(e,t="Human",n="AI"){const r=[];for(const i of e){let e;if("human"===i._getType())e=t;else if("ai"===i._getType())e=n;else if("system"===i._getType())e="System";else if("function"===i._getType())e="Function";else if("tool"===i._getType())e="Tool";else{if("generic"!==i._getType())throw new Error(`Got unsupported message type: ${i._getType()}`);e=i.role}const s=i.name?`${i.name}, `:"";r.push(`${e}: ${s}${i.content}`)}return r.join("\n")}function Uv(e){const t=e._getType();if("human"===t)return new Rv({...e});if("ai"===t)return new Ov({...e});if("system"===t)return new Lv({...e});if("function"===t)return new jv({...e});if(Sv.isInstance(e))return new Nv({...e});throw new Error("Unknown message type.")}const Bv="__run";class Vv{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Vv({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class zv extends Vv{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new zv({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}const Hv=()=>"undefined"!=typeof Deno;let Gv;async function qv(){if(void 0===Gv){const e=(()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||Hv()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":Hv()?"deno":"other":"node",e})();Gv={library:"langchain-js",runtime:e}}return Gv}function Kv(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}var Wv="object"==typeof window?window:{},Jv="0123456789abcdef".split(""),Zv=[-2147483648,8388608,32768,128],Qv=[24,16,8,0],Xv=[];function Yv(e){e?(Xv[0]=Xv[16]=Xv[1]=Xv[2]=Xv[3]=Xv[4]=Xv[5]=Xv[6]=Xv[7]=Xv[8]=Xv[9]=Xv[10]=Xv[11]=Xv[12]=Xv[13]=Xv[14]=Xv[15]=0,this.blocks=Xv):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Yv.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===Wv.ArrayBuffer&&(e=new Uint8Array(e));for(var n,r,i=0,s=e.length||0,a=this.blocks;i<s;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)for(r=this.start;i<s&&r<64;++i)a[r>>2]|=e[i]<<Qv[3&r++];else for(r=this.start;i<s&&r<64;++i)(n=e.charCodeAt(i))<128?a[r>>2]|=n<<Qv[3&r++]:n<2048?(a[r>>2]|=(192|n>>6)<<Qv[3&r++],a[r>>2]|=(128|63&n)<<Qv[3&r++]):n<55296||n>=57344?(a[r>>2]|=(224|n>>12)<<Qv[3&r++],a[r>>2]|=(128|n>>6&63)<<Qv[3&r++],a[r>>2]|=(128|63&n)<<Qv[3&r++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++i)),a[r>>2]|=(240|n>>18)<<Qv[3&r++],a[r>>2]|=(128|n>>12&63)<<Qv[3&r++],a[r>>2]|=(128|n>>6&63)<<Qv[3&r++],a[r>>2]|=(128|63&n)<<Qv[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=a[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}},Yv.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=Zv[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Yv.prototype.hash=function(){var e,t,n=this.h0,r=this.h1,i=this.h2,s=this.h3,a=this.h4,o=this.blocks;for(e=16;e<80;++e)t=o[e-3]^o[e-8]^o[e-14]^o[e-16],o[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)n=(t=(r=(t=(i=(t=(s=(t=(a=(t=n<<5|n>>>27)+(r&i|~r&s)+a+1518500249+o[e]|0)<<5|a>>>27)+(n&(r=r<<30|r>>>2)|~n&i)+s+1518500249+o[e+1]|0)<<5|s>>>27)+(a&(n=n<<30|n>>>2)|~a&r)+i+1518500249+o[e+2]|0)<<5|i>>>27)+(s&(a=a<<30|a>>>2)|~s&n)+r+1518500249+o[e+3]|0)<<5|r>>>27)+(i&(s=s<<30|s>>>2)|~i&a)+n+1518500249+o[e+4]|0,i=i<<30|i>>>2;for(;e<40;e+=5)n=(t=(r=(t=(i=(t=(s=(t=(a=(t=n<<5|n>>>27)+(r^i^s)+a+1859775393+o[e]|0)<<5|a>>>27)+(n^(r=r<<30|r>>>2)^i)+s+1859775393+o[e+1]|0)<<5|s>>>27)+(a^(n=n<<30|n>>>2)^r)+i+1859775393+o[e+2]|0)<<5|i>>>27)+(s^(a=a<<30|a>>>2)^n)+r+1859775393+o[e+3]|0)<<5|r>>>27)+(i^(s=s<<30|s>>>2)^a)+n+1859775393+o[e+4]|0,i=i<<30|i>>>2;for(;e<60;e+=5)n=(t=(r=(t=(i=(t=(s=(t=(a=(t=n<<5|n>>>27)+(r&i|r&s|i&s)+a-1894007588+o[e]|0)<<5|a>>>27)+(n&(r=r<<30|r>>>2)|n&i|r&i)+s-1894007588+o[e+1]|0)<<5|s>>>27)+(a&(n=n<<30|n>>>2)|a&r|n&r)+i-1894007588+o[e+2]|0)<<5|i>>>27)+(s&(a=a<<30|a>>>2)|s&n|a&n)+r-1894007588+o[e+3]|0)<<5|r>>>27)+(i&(s=s<<30|s>>>2)|i&a|s&a)+n-1894007588+o[e+4]|0,i=i<<30|i>>>2;for(;e<80;e+=5)n=(t=(r=(t=(i=(t=(s=(t=(a=(t=n<<5|n>>>27)+(r^i^s)+a-899497514+o[e]|0)<<5|a>>>27)+(n^(r=r<<30|r>>>2)^i)+s-899497514+o[e+1]|0)<<5|s>>>27)+(a^(n=n<<30|n>>>2)^r)+i-899497514+o[e+2]|0)<<5|i>>>27)+(s^(a=a<<30|a>>>2)^n)+r-899497514+o[e+3]|0)<<5|r>>>27)+(i^(s=s<<30|s>>>2)^a)+n-899497514+o[e+4]|0,i=i<<30|i>>>2;this.h0=this.h0+n|0,this.h1=this.h1+r|0,this.h2=this.h2+i|0,this.h3=this.h3+s|0,this.h4=this.h4+a|0},Yv.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,i=this.h4;return Jv[e>>28&15]+Jv[e>>24&15]+Jv[e>>20&15]+Jv[e>>16&15]+Jv[e>>12&15]+Jv[e>>8&15]+Jv[e>>4&15]+Jv[15&e]+Jv[t>>28&15]+Jv[t>>24&15]+Jv[t>>20&15]+Jv[t>>16&15]+Jv[t>>12&15]+Jv[t>>8&15]+Jv[t>>4&15]+Jv[15&t]+Jv[n>>28&15]+Jv[n>>24&15]+Jv[n>>20&15]+Jv[n>>16&15]+Jv[n>>12&15]+Jv[n>>8&15]+Jv[n>>4&15]+Jv[15&n]+Jv[r>>28&15]+Jv[r>>24&15]+Jv[r>>20&15]+Jv[r>>16&15]+Jv[r>>12&15]+Jv[r>>8&15]+Jv[r>>4&15]+Jv[15&r]+Jv[i>>28&15]+Jv[i>>24&15]+Jv[i>>20&15]+Jv[i>>16&15]+Jv[i>>12&15]+Jv[i>>8&15]+Jv[i>>4&15]+Jv[15&i]},Yv.prototype.toString=Yv.prototype.hex,Yv.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,i=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24&255,i>>16&255,i>>8&255,255&i]},Yv.prototype.array=Yv.prototype.digest,Yv.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};const eb=(...e)=>{return t=e.join("_"),new Yv(!0).update(t).hex();var t};class tb{}const nb=new Map;class rb extends tb{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(eb(e,t))??null)}async update(e,t,n){this.cache.set(eb(e,t),n)}static global(){return new rb(nb)}}class ib extends _v{}class sb extends ib{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Dv(this.value)]}}class ab extends ib{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return Fv(this.messages)}toChatMessages(){return this.messages}}var ob=i(201),lb=i(425);const cb=[400,401,402,403,404,405,406,407,409],ub=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&cb.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};class hb{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??ub;const t=lb.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>ob((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise(((t,n)=>{e.signal?.addEventListener("abort",(()=>{n(new Error("AbortError"))}))}))]):this.call(t,...n)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}var db=i(991),pb=Object.defineProperty;function fb(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let n=Array.from({length:e.length},((e,t)=>({start:t,end:t+1})));for(;n.length>1;){let r=null;for(let i=0;i<n.length-1;i++){const s=e.slice(n[i].start,n[i+1].end),a=t.get(s.join(","));null!=a&&(null==r||a<r[0])&&(r=[a,i])}if(null==r)break;{const e=r[1];n[e]={start:n[e].start,end:n[e+1].end},n.splice(e+1,1)}}return n}(e,t).map((n=>t.get(e.slice(n.start,n.end).join(",")))).filter((e=>null!=e))}var mb,gb,yb=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const n=e.bpe_ranks.split("\n").filter(Boolean).reduce(((e,t)=>{const[n,r,...i]=t.split(" "),s=Number.parseInt(r,10);return i.forEach(((t,n)=>e[t]=s+n)),e}),{});for(const[e,t]of Object.entries(n)){const n=db.toByteArray(e);this.rankMap.set(n.join(","),t),this.textMap.set(t,n)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((e,[t,n])=>(e[n]=this.textEncoder.encode(t),e)),{})}encode(e,t=[],n="all"){const r=new RegExp(this.patStr,"ug"),i=yb.specialTokenRegex(Object.keys(this.specialTokens)),s=[],a=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===n?Object.keys(this.specialTokens).filter((e=>!a.has(e))):n);if(o.size>0){const t=yb.specialTokenRegex([...o]),n=e.match(t);if(null!=n)throw new Error(`The text contains a special token that is not allowed: ${n[0]}`)}let l=0;for(;;){let t=null,n=l;for(;i.lastIndex=n,t=i.exec(e),null!=t&&!a.has(t[0]);)n=t.index+1;const o=t?.index??e.length;for(const t of e.substring(l,o).matchAll(r)){const e=this.textEncoder.encode(t[0]),n=this.rankMap.get(e.join(","));null==n?s.push(...fb(e,this.rankMap)):s.push(n)}if(null==t)break;let c=this.specialTokens[t[0]];s.push(c),l=t.index+t[0].length}return s}decode(e){const t=[];let n=0;for(let r=0;r<e.length;++r){const i=e[r],s=this.textMap.get(i)??this.inverseSpecialTokens[i];null!=s&&(t.push(s),n+=s.length)}const r=new Uint8Array(n);let i=0;for(const e of t)r.set(e,i),i+=e.length;return this.textDecoder.decode(r)}},vb=yb;gb=e=>new RegExp(e.map((e=>function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}(e))).join("|"),"g"),((e,t,n)=>{t in e?pb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(vb,"symbol"!=typeof(mb="specialTokenRegex")?mb+"":mb,gb);const bb={},wb=new hb({});var _b,kb;!function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(_b||(_b={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(kb||(kb={}));const Ab=_b.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pb=e=>{switch(typeof e){case"undefined":return Ab.undefined;case"string":return Ab.string;case"number":return Number.isNaN(e)?Ab.nan:Ab.number;case"boolean":return Ab.boolean;case"function":return Ab.function;case"bigint":return Ab.bigint;case"symbol":return Ab.symbol;case"object":return Array.isArray(e)?Ab.array:null===e?Ab.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Ab.promise:"undefined"!=typeof Map&&e instanceof Map?Ab.map:"undefined"!=typeof Set&&e instanceof Set?Ab.set:"undefined"!=typeof Date&&e instanceof Date?Ab.date:Ab.object;default:return Ab.unknown}},Tb=_b.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Eb extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(r);else if("invalid_return_type"===i.code)r(i.returnTypeError);else if("invalid_arguments"===i.code)r(i.argumentsError);else if(0===i.path.length)n._errors.push(t(i));else{let e=n,r=0;for(;r<i.path.length;){const n=i.path[r];r===i.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(i))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}static assert(e){if(!(e instanceof Eb))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,_b.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},n=[];for(const r of this.issues)if(r.path.length>0){const n=r.path[0];t[n]=t[n]||[],t[n].push(e(r))}else n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Eb.create=e=>new Eb(e);const xb=(e,t)=>{let n;switch(e.code){case Tb.invalid_type:n=e.received===Ab.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Tb.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,_b.jsonStringifyReplacer)}`;break;case Tb.unrecognized_keys:n=`Unrecognized key(s) in object: ${_b.joinValues(e.keys,", ")}`;break;case Tb.invalid_union:n="Invalid input";break;case Tb.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${_b.joinValues(e.options)}`;break;case Tb.invalid_enum_value:n=`Invalid enum value. Expected ${_b.joinValues(e.options)}, received '${e.received}'`;break;case Tb.invalid_arguments:n="Invalid function arguments";break;case Tb.invalid_return_type:n="Invalid function return type";break;case Tb.invalid_date:n="Invalid date";break;case Tb.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:_b.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Tb.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Tb.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Tb.custom:n="Invalid input";break;case Tb.invalid_intersection_types:n="Intersection results could not be merged";break;case Tb.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case Tb.not_finite:n="Number must be finite";break;default:n=t.defaultError,_b.assertNever(e)}return{message:n}};let Ib=xb;var Cb;function Ob(e,t){const n=Ib,r=(e=>{const{data:t,path:n,errorMaps:r,issueData:i}=e,s=[...n,...i.path||[]],a={...i,path:s};if(void 0!==i.message)return{...i,path:s,message:i.message};let o="";const l=r.filter((e=>!!e)).slice().reverse();for(const e of l)o=e(a,{data:t,defaultError:o}).message;return{...i,path:s,message:o}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===xb?void 0:xb].filter((e=>!!e))});e.common.issues.push(r)}!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(Cb||(Cb={}));class Sb{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return Nb;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t){const t=await e.key,r=await e.value;n.push({key:t,value:r})}return Sb.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:i}=r;if("aborted"===t.status)return Nb;if("aborted"===i.status)return Nb;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"===t.value||void 0===i.value&&!r.alwaysSet||(n[t.value]=i.value)}return{status:e.value,value:n}}}const Nb=Object.freeze({status:"aborted"}),jb=e=>({status:"dirty",value:e}),Db=e=>({status:"valid",value:e}),Rb=e=>"aborted"===e.status,$b=e=>"dirty"===e.status,Lb=e=>"valid"===e.status,Mb=e=>"undefined"!=typeof Promise&&e instanceof Promise;class Fb{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ub=(e,t)=>{if(Lb(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Eb(e.common.issues);return this._error=t,this._error}}};function Bb(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:i}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{const{message:s}=e;return"invalid_enum_value"===t.code?{message:s??i.defaultError}:void 0===i.data?{message:s??r??i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:s??n??i.defaultError}},description:i}}class Vb{get description(){return this._def.description}_getType(e){return Pb(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Pb(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Sb,ctx:{common:e.parent.common,data:e.data,parsedType:Pb(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Mb(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pb(e)},r=this._parseSync({data:e,path:n.path,parent:n});return Ub(n,r)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pb(e)};if(!this["~standard"].async)try{const n=this._parseSync({data:e,path:[],parent:t});return Lb(n)?{value:n.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then((e=>Lb(e)?{value:e.value}:{issues:t.common.issues}))}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pb(e)},r=this._parse({data:e,path:n.path,parent:n}),i=await(Mb(r)?r:Promise.resolve(r));return Ub(n,i)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,r)=>{const i=e(t),s=()=>r.addIssue({code:Tb.custom,...n(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then((e=>!!e||(s(),!1))):!!i||(s(),!1)}))}refinement(e,t){return this._refinement(((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1)))}_refinement(e){return new Fw({schema:this,typeName:Ww.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Uw.create(this,this._def)}nullable(){return Bw.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Aw.create(this)}promise(){return Mw.create(this,this._def)}or(e){return Ew.create([this,e],this._def)}and(e){return Iw.create(this,e,this._def)}transform(e){return new Fw({...Bb(this._def),schema:this,typeName:Ww.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Vw({...Bb(this._def),innerType:this,defaultValue:t,typeName:Ww.ZodDefault})}brand(){return new Gw({typeName:Ww.ZodBranded,type:this,...Bb(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new zw({...Bb(this._def),innerType:this,catchValue:t,typeName:Ww.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return qw.create(this,e)}readonly(){return Kw.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const zb=/^c[^\s-]{8,}$/i,Hb=/^[0-9a-z]+$/,Gb=/^[0-9A-HJKMNP-TV-Z]{26}$/i,qb=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Kb=/^[a-z0-9_-]{21}$/i,Wb=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Jb=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Zb=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Qb;const Xb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Yb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ew=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,tw=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,nw=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,rw=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,iw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",sw=new RegExp(`^${iw}$`);function aw(e){let t="[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function ow(e){let t=`${iw}T${aw(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function lw(e,t){if(!Wb.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));return!("object"!=typeof i||null===i||"typ"in i&&"JWT"!==i?.typ||!i.alg||t&&i.alg!==t)}catch{return!1}}function cw(e,t){return!("v4"!==t&&t||!Yb.test(e))||!("v6"!==t&&t||!tw.test(e))}class uw extends Vb{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Ab.string){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.string,received:t.parsedType}),Nb}const t=new Sb;let n;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(n=this._getOrReturnCtx(e,n),Ob(n,{code:Tb.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(n=this._getOrReturnCtx(e,n),Ob(n,{code:Tb.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("length"===s.kind){const r=e.data.length>s.value,i=e.data.length<s.value;(r||i)&&(n=this._getOrReturnCtx(e,n),r?Ob(n,{code:Tb.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&Ob(n,{code:Tb.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),t.dirty())}else if("email"===s.kind)Zb.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"email",code:Tb.invalid_string,message:s.message}),t.dirty());else if("emoji"===s.kind)Qb||(Qb=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Qb.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"emoji",code:Tb.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)qb.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"uuid",code:Tb.invalid_string,message:s.message}),t.dirty());else if("nanoid"===s.kind)Kb.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"nanoid",code:Tb.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)zb.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"cuid",code:Tb.invalid_string,message:s.message}),t.dirty());else if("cuid2"===s.kind)Hb.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"cuid2",code:Tb.invalid_string,message:s.message}),t.dirty());else if("ulid"===s.kind)Gb.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"ulid",code:Tb.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),Ob(n,{validation:"url",code:Tb.invalid_string,message:s.message}),t.dirty()}else"regex"===s.kind?(s.regex.lastIndex=0,s.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"regex",code:Tb.invalid_string,message:s.message}),t.dirty())):"trim"===s.kind?e.data=e.data.trim():"includes"===s.kind?e.data.includes(s.value,s.position)||(n=this._getOrReturnCtx(e,n),Ob(n,{code:Tb.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),t.dirty()):"toLowerCase"===s.kind?e.data=e.data.toLowerCase():"toUpperCase"===s.kind?e.data=e.data.toUpperCase():"startsWith"===s.kind?e.data.startsWith(s.value)||(n=this._getOrReturnCtx(e,n),Ob(n,{code:Tb.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty()):"endsWith"===s.kind?e.data.endsWith(s.value)||(n=this._getOrReturnCtx(e,n),Ob(n,{code:Tb.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty()):"datetime"===s.kind?ow(s).test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{code:Tb.invalid_string,validation:"datetime",message:s.message}),t.dirty()):"date"===s.kind?sw.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{code:Tb.invalid_string,validation:"date",message:s.message}),t.dirty()):"time"===s.kind?new RegExp(`^${aw(s)}$`).test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{code:Tb.invalid_string,validation:"time",message:s.message}),t.dirty()):"duration"===s.kind?Jb.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"duration",code:Tb.invalid_string,message:s.message}),t.dirty()):"ip"===s.kind?(r=e.data,("v4"!==(i=s.version)&&i||!Xb.test(r))&&("v6"!==i&&i||!ew.test(r))&&(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"ip",code:Tb.invalid_string,message:s.message}),t.dirty())):"jwt"===s.kind?lw(e.data,s.alg)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"jwt",code:Tb.invalid_string,message:s.message}),t.dirty()):"cidr"===s.kind?cw(e.data,s.version)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"cidr",code:Tb.invalid_string,message:s.message}),t.dirty()):"base64"===s.kind?nw.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"base64",code:Tb.invalid_string,message:s.message}),t.dirty()):"base64url"===s.kind?rw.test(e.data)||(n=this._getOrReturnCtx(e,n),Ob(n,{validation:"base64url",code:Tb.invalid_string,message:s.message}),t.dirty()):_b.assertNever(s);var r,i;return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement((t=>e.test(t)),{validation:t,code:Tb.invalid_string,...Cb.errToObj(n)})}_addCheck(e){return new uw({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Cb.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Cb.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Cb.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Cb.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Cb.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Cb.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Cb.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Cb.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Cb.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Cb.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Cb.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Cb.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Cb.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...Cb.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...Cb.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Cb.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Cb.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...Cb.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Cb.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Cb.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Cb.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Cb.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Cb.errToObj(t)})}nonempty(e){return this.min(1,Cb.errToObj(e))}trim(){return new uw({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new uw({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new uw({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function hw(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,i=n>r?n:r;return Number.parseInt(e.toFixed(i).replace(".",""))%Number.parseInt(t.toFixed(i).replace(".",""))/10**i}uw.create=e=>new uw({checks:[],typeName:Ww.ZodString,coerce:e?.coerce??!1,...Bb(e)});class dw extends Vb{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Ab.number){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.number,received:t.parsedType}),Nb}let t;const n=new Sb;for(const r of this._def.checks)"int"===r.kind?_b.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Ob(t,{code:Tb.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),Ob(t,{code:Tb.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),Ob(t,{code:Tb.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"multipleOf"===r.kind?0!==hw(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),Ob(t,{code:Tb.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Ob(t,{code:Tb.not_finite,message:r.message}),n.dirty()):_b.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Cb.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Cb.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Cb.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Cb.toString(t))}setLimit(e,t,n,r){return new dw({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Cb.toString(r)}]})}_addCheck(e){return new dw({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Cb.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Cb.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Cb.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Cb.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Cb.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Cb.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Cb.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Cb.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Cb.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&_b.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}dw.create=e=>new dw({checks:[],typeName:Ww.ZodNumber,coerce:e?.coerce||!1,...Bb(e)});class pw extends Vb{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Ab.bigint)return this._getInvalidInput(e);let t;const n=new Sb;for(const r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),Ob(t,{code:Tb.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),Ob(t,{code:Tb.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Ob(t,{code:Tb.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):_b.assertNever(r);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.bigint,received:t.parsedType}),Nb}gte(e,t){return this.setLimit("min",e,!0,Cb.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Cb.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Cb.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Cb.toString(t))}setLimit(e,t,n,r){return new pw({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Cb.toString(r)}]})}_addCheck(e){return new pw({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Cb.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Cb.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Cb.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Cb.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Cb.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}pw.create=e=>new pw({checks:[],typeName:Ww.ZodBigInt,coerce:e?.coerce??!1,...Bb(e)});class fw extends Vb{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==Ab.boolean){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.boolean,received:t.parsedType}),Nb}return Db(e.data)}}fw.create=e=>new fw({typeName:Ww.ZodBoolean,coerce:e?.coerce||!1,...Bb(e)});class mw extends Vb{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Ab.date){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.date,received:t.parsedType}),Nb}if(Number.isNaN(e.data.getTime()))return Ob(this._getOrReturnCtx(e),{code:Tb.invalid_date}),Nb;const t=new Sb;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),Ob(n,{code:Tb.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),Ob(n,{code:Tb.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):_b.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new mw({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Cb.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Cb.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}mw.create=e=>new mw({checks:[],coerce:e?.coerce||!1,typeName:Ww.ZodDate,...Bb(e)});class gw extends Vb{_parse(e){if(this._getType(e)!==Ab.symbol){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.symbol,received:t.parsedType}),Nb}return Db(e.data)}}gw.create=e=>new gw({typeName:Ww.ZodSymbol,...Bb(e)});class yw extends Vb{_parse(e){if(this._getType(e)!==Ab.undefined){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.undefined,received:t.parsedType}),Nb}return Db(e.data)}}yw.create=e=>new yw({typeName:Ww.ZodUndefined,...Bb(e)});class vw extends Vb{_parse(e){if(this._getType(e)!==Ab.null){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.null,received:t.parsedType}),Nb}return Db(e.data)}}vw.create=e=>new vw({typeName:Ww.ZodNull,...Bb(e)});class bw extends Vb{constructor(){super(...arguments),this._any=!0}_parse(e){return Db(e.data)}}bw.create=e=>new bw({typeName:Ww.ZodAny,...Bb(e)});class ww extends Vb{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Db(e.data)}}ww.create=e=>new ww({typeName:Ww.ZodUnknown,...Bb(e)});class _w extends Vb{_parse(e){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.never,received:t.parsedType}),Nb}}_w.create=e=>new _w({typeName:Ww.ZodNever,...Bb(e)});class kw extends Vb{_parse(e){if(this._getType(e)!==Ab.undefined){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.void,received:t.parsedType}),Nb}return Db(e.data)}}kw.create=e=>new kw({typeName:Ww.ZodVoid,...Bb(e)});class Aw extends Vb{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==Ab.array)return Ob(t,{code:Tb.invalid_type,expected:Ab.array,received:t.parsedType}),Nb;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,i=t.data.length<r.exactLength.value;(e||i)&&(Ob(t,{code:e?Tb.too_big:Tb.too_small,minimum:i?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(Ob(t,{code:Tb.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(Ob(t,{code:Tb.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map(((e,n)=>r.type._parseAsync(new Fb(t,e,t.path,n))))).then((e=>Sb.mergeArray(n,e)));const i=[...t.data].map(((e,n)=>r.type._parseSync(new Fb(t,e,t.path,n))));return Sb.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new Aw({...this._def,minLength:{value:e,message:Cb.toString(t)}})}max(e,t){return new Aw({...this._def,maxLength:{value:e,message:Cb.toString(t)}})}length(e,t){return new Aw({...this._def,exactLength:{value:e,message:Cb.toString(t)}})}nonempty(e){return this.min(1,e)}}function Pw(e){if(e instanceof Tw){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Uw.create(Pw(r))}return new Tw({...e._def,shape:()=>t})}return e instanceof Aw?new Aw({...e._def,type:Pw(e.element)}):e instanceof Uw?Uw.create(Pw(e.unwrap())):e instanceof Bw?Bw.create(Pw(e.unwrap())):e instanceof Cw?Cw.create(e.items.map((e=>Pw(e)))):e}Aw.create=(e,t)=>new Aw({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Ww.ZodArray,...Bb(t)});class Tw extends Vb{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=_b.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Ab.object){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.object,received:t.parsedType}),Nb}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof _w&&"strip"===this._def.unknownKeys))for(const e in n.data)i.includes(e)||s.push(e);const a=[];for(const e of i){const t=r[e],i=n.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new Fb(n,i,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof _w){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of s)a.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)s.length>0&&(Ob(n,{code:Tb.unrecognized_keys,keys:s}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of s){const r=n.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new Fb(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of a){const n=await t.key,r=await t.value;e.push({key:n,value:r,alwaysSet:t.alwaysSet})}return e})).then((e=>Sb.mergeObjectSync(t,e))):Sb.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return Cb.errToObj,new Tw({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{const r=this._def.errorMap?.(t,n).message??n.defaultError;return"unrecognized_keys"===t.code?{message:Cb.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new Tw({...this._def,unknownKeys:"strip"})}passthrough(){return new Tw({...this._def,unknownKeys:"passthrough"})}extend(e){return new Tw({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Tw({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ww.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Tw({...this._def,catchall:e})}pick(e){const t={};for(const n of _b.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new Tw({...this._def,shape:()=>t})}omit(e){const t={};for(const n of _b.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new Tw({...this._def,shape:()=>t})}deepPartial(){return Pw(this)}partial(e){const t={};for(const n of _b.objectKeys(this.shape)){const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}return new Tw({...this._def,shape:()=>t})}required(e){const t={};for(const n of _b.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof Uw;)e=e._def.innerType;t[n]=e}return new Tw({...this._def,shape:()=>t})}keyof(){return Rw(_b.objectKeys(this.shape))}}Tw.create=(e,t)=>new Tw({shape:()=>e,unknownKeys:"strip",catchall:_w.create(),typeName:Ww.ZodObject,...Bb(t)}),Tw.strictCreate=(e,t)=>new Tw({shape:()=>e,unknownKeys:"strict",catchall:_w.create(),typeName:Ww.ZodObject,...Bb(t)}),Tw.lazycreate=(e,t)=>new Tw({shape:e,unknownKeys:"strip",catchall:_w.create(),typeName:Ww.ZodObject,...Bb(t)});class Ew extends Vb{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map((async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map((e=>new Eb(e.ctx.common.issues)));return Ob(t,{code:Tb.invalid_union,unionErrors:n}),Nb}));{let e;const r=[];for(const i of n){const n={...t,common:{...t.common,issues:[]},parent:null},s=i._parseSync({data:t.data,path:t.path,parent:n});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const i=r.map((e=>new Eb(e)));return Ob(t,{code:Tb.invalid_union,unionErrors:i}),Nb}}get options(){return this._def.options}}function xw(e,t){const n=Pb(e),r=Pb(t);if(e===t)return{valid:!0,data:e};if(n===Ab.object&&r===Ab.object){const n=_b.objectKeys(t),r=_b.objectKeys(e).filter((e=>-1!==n.indexOf(e))),i={...e,...t};for(const n of r){const r=xw(e[n],t[n]);if(!r.valid)return{valid:!1};i[n]=r.data}return{valid:!0,data:i}}if(n===Ab.array&&r===Ab.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const i=xw(e[r],t[r]);if(!i.valid)return{valid:!1};n.push(i.data)}return{valid:!0,data:n}}return n===Ab.date&&r===Ab.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}Ew.create=(e,t)=>new Ew({options:e,typeName:Ww.ZodUnion,...Bb(t)});class Iw extends Vb{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(Rb(e)||Rb(r))return Nb;const i=xw(e.value,r.value);return i.valid?(($b(e)||$b(r))&&t.dirty(),{status:t.value,value:i.data}):(Ob(n,{code:Tb.invalid_intersection_types}),Nb)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then((([e,t])=>r(e,t))):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Iw.create=(e,t,n)=>new Iw({left:e,right:t,typeName:Ww.ZodIntersection,...Bb(n)});class Cw extends Vb{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Ab.array)return Ob(n,{code:Tb.invalid_type,expected:Ab.array,received:n.parsedType}),Nb;if(n.data.length<this._def.items.length)return Ob(n,{code:Tb.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Nb;!this._def.rest&&n.data.length>this._def.items.length&&(Ob(n,{code:Tb.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map(((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new Fb(n,e,n.path,t)):null})).filter((e=>!!e));return n.common.async?Promise.all(r).then((e=>Sb.mergeArray(t,e))):Sb.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new Cw({...this._def,rest:e})}}Cw.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Cw({items:e,typeName:Ww.ZodTuple,rest:null,...Bb(t)})};class Ow extends Vb{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Ab.object)return Ob(n,{code:Tb.invalid_type,expected:Ab.object,received:n.parsedType}),Nb;const r=[],i=this._def.keyType,s=this._def.valueType;for(const e in n.data)r.push({key:i._parse(new Fb(n,e,n.path,e)),value:s._parse(new Fb(n,n.data[e],n.path,e)),alwaysSet:e in n.data});return n.common.async?Sb.mergeObjectAsync(t,r):Sb.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,n){return new Ow(t instanceof Vb?{keyType:e,valueType:t,typeName:Ww.ZodRecord,...Bb(n)}:{keyType:uw.create(),valueType:e,typeName:Ww.ZodRecord,...Bb(t)})}}class Sw extends Vb{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Ab.map)return Ob(n,{code:Tb.invalid_type,expected:Ab.map,received:n.parsedType}),Nb;const r=this._def.keyType,i=this._def.valueType,s=[...n.data.entries()].map((([e,t],s)=>({key:r._parse(new Fb(n,e,n.path,[s,"key"])),value:i._parse(new Fb(n,t,n.path,[s,"value"]))})));if(n.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const n of s){const r=await n.key,i=await n.value;if("aborted"===r.status||"aborted"===i.status)return Nb;"dirty"!==r.status&&"dirty"!==i.status||t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const n of s){const r=n.key,i=n.value;if("aborted"===r.status||"aborted"===i.status)return Nb;"dirty"!==r.status&&"dirty"!==i.status||t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}}}}Sw.create=(e,t,n)=>new Sw({valueType:t,keyType:e,typeName:Ww.ZodMap,...Bb(n)});class Nw extends Vb{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Ab.set)return Ob(n,{code:Tb.invalid_type,expected:Ab.set,received:n.parsedType}),Nb;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(Ob(n,{code:Tb.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(Ob(n,{code:Tb.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const i=this._def.valueType;function s(e){const n=new Set;for(const r of e){if("aborted"===r.status)return Nb;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const a=[...n.data.values()].map(((e,t)=>i._parse(new Fb(n,e,n.path,t))));return n.common.async?Promise.all(a).then((e=>s(e))):s(a)}min(e,t){return new Nw({...this._def,minSize:{value:e,message:Cb.toString(t)}})}max(e,t){return new Nw({...this._def,maxSize:{value:e,message:Cb.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Nw.create=(e,t)=>new Nw({valueType:e,minSize:null,maxSize:null,typeName:Ww.ZodSet,...Bb(t)});class jw extends Vb{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}jw.create=(e,t)=>new jw({getter:e,typeName:Ww.ZodLazy,...Bb(t)});class Dw extends Vb{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Ob(t,{received:t.data,code:Tb.invalid_literal,expected:this._def.value}),Nb}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Rw(e,t){return new $w({values:e,typeName:Ww.ZodEnum,...Bb(t)})}Dw.create=(e,t)=>new Dw({value:e,typeName:Ww.ZodLiteral,...Bb(t)});class $w extends Vb{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return Ob(t,{expected:_b.joinValues(n),received:t.parsedType,code:Tb.invalid_type}),Nb}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return Ob(t,{received:t.data,code:Tb.invalid_enum_value,options:n}),Nb}return Db(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return $w.create(e,{...this._def,...t})}exclude(e,t=this._def){return $w.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}$w.create=Rw;class Lw extends Vb{_parse(e){const t=_b.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Ab.string&&n.parsedType!==Ab.number){const e=_b.objectValues(t);return Ob(n,{expected:_b.joinValues(e),received:n.parsedType,code:Tb.invalid_type}),Nb}if(this._cache||(this._cache=new Set(_b.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=_b.objectValues(t);return Ob(n,{received:n.data,code:Tb.invalid_enum_value,options:e}),Nb}return Db(e.data)}get enum(){return this._def.values}}Lw.create=(e,t)=>new Lw({values:e,typeName:Ww.ZodNativeEnum,...Bb(t)});class Mw extends Vb{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ab.promise&&!1===t.common.async)return Ob(t,{code:Tb.invalid_type,expected:Ab.promise,received:t.parsedType}),Nb;const n=t.parsedType===Ab.promise?t.data:Promise.resolve(t.data);return Db(n.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Mw.create=(e,t)=>new Mw({type:e,typeName:Ww.ZodPromise,...Bb(t)});class Fw extends Vb{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ww.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:e=>{Ob(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===r.type){const e=r.transform(n.data,i);if(n.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return Nb;const r=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===r.status?Nb:"dirty"===r.status||"dirty"===t.value?jb(r.value):r}));{if("aborted"===t.value)return Nb;const r=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===r.status?Nb:"dirty"===r.status||"dirty"===t.value?jb(r.value):r}}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,i);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?Nb:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((n=>"aborted"===n.status?Nb:("dirty"===n.status&&t.dirty(),e(n.value).then((()=>({status:t.value,value:n.value}))))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Lb(e))return Nb;const s=r.transform(e.value,i);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((e=>Lb(e)?Promise.resolve(r.transform(e.value,i)).then((e=>({status:t.value,value:e}))):Nb))}_b.assertNever(r)}}Fw.create=(e,t,n)=>new Fw({schema:e,typeName:Ww.ZodEffects,effect:t,...Bb(n)}),Fw.createWithPreprocess=(e,t,n)=>new Fw({schema:t,effect:{type:"preprocess",transform:e},typeName:Ww.ZodEffects,...Bb(n)});class Uw extends Vb{_parse(e){return this._getType(e)===Ab.undefined?Db(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Uw.create=(e,t)=>new Uw({innerType:e,typeName:Ww.ZodOptional,...Bb(t)});class Bw extends Vb{_parse(e){return this._getType(e)===Ab.null?Db(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Bw.create=(e,t)=>new Bw({innerType:e,typeName:Ww.ZodNullable,...Bb(t)});class Vw extends Vb{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Ab.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Vw.create=(e,t)=>new Vw({innerType:e,typeName:Ww.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Bb(t)});class zw extends Vb{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Mb(r)?r.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Eb(n.common.issues)},input:n.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new Eb(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}zw.create=(e,t)=>new zw({innerType:e,typeName:Ww.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Bb(t)});class Hw extends Vb{_parse(e){if(this._getType(e)!==Ab.nan){const t=this._getOrReturnCtx(e);return Ob(t,{code:Tb.invalid_type,expected:Ab.nan,received:t.parsedType}),Nb}return{status:"valid",value:e.data}}}Hw.create=e=>new Hw({typeName:Ww.ZodNaN,...Bb(e)}),Symbol("zod_brand");class Gw extends Vb{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class qw extends Vb{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Nb:"dirty"===e.status?(t.dirty(),jb(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Nb:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new qw({in:e,out:t,typeName:Ww.ZodPipeline})}}class Kw extends Vb{_parse(e){const t=this._def.innerType._parse(e),n=e=>(Lb(e)&&(e.value=Object.freeze(e.value)),e);return Mb(t)?t.then((e=>n(e))):n(t)}unwrap(){return this._def.innerType}}var Ww;Kw.create=(e,t)=>new Kw({innerType:e,typeName:Ww.ZodReadonly,...Bb(t)}),Tw.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Ww||(Ww={}));const Jw=uw.create,Zw=dw.create,Qw=(Hw.create,pw.create,fw.create,mw.create,gw.create,yw.create,vw.create),Xw=bw.create,Yw=(ww.create,_w.create,kw.create,Aw.create),e_=Tw.create,t_=(Tw.strictCreate,Ew.create),n_=(Iw.create,Cw.create,Ow.create),r_=(Sw.create,Nw.create,jw.create,Dw.create,$w.create,Lw.create,Mw.create,Fw.create,Uw.create,Bw.create,Fw.createWithPreprocess,qw.create,{randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)});let i_;const s_=new Uint8Array(16);function a_(){if(!i_&&(i_="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!i_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i_(s_)}const o_=[];for(let e=0;e<256;++e)o_.push((e+256).toString(16).slice(1));const l_=function(e,t,n){if(r_.randomUUID&&!t&&!e)return r_.randomUUID();const r=(e=e||{}).random||(e.rng||a_)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return o_[e[t+0]]+o_[e[t+1]]+o_[e[t+2]]+o_[e[t+3]]+"-"+o_[e[t+4]]+o_[e[t+5]]+"-"+o_[e[t+6]]+o_[e[t+7]]+"-"+o_[e[t+8]]+o_[e[t+9]]+"-"+o_[e[t+10]]+o_[e[t+11]]+o_[e[t+12]]+o_[e[t+13]]+o_[e[t+14]]+o_[e[t+15]]}(r)};class c_{}class u_ extends c_{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,wv(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"true"!==Kv("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.awaitHandlers=e._awaitHandler??this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return _v.prototype.toJSON.call(this)}toJSONNotImplemented(){return _v.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends u_{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:l_()}),Object.assign(this,e)}}}}var h_=i(749);function d_(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class p_ extends u_{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`\n\n${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){const t=function(e,t,n){const r=n.toFixed(0).slice(0,3).padStart(3,"0");return function(e){return e.replace(/[-:.]/g,"")}(`${new Date(e).toISOString().slice(0,-1)}${r}Z`)+t}(e.start_time,e.id,e.execution_order),n={...e};if(void 0!==n.parent_run_id){const e=this.runMap.get(n.parent_run_id);e&&(this._addChildRun(e,n),e.child_execution_order=Math.max(e.child_execution_order,n.child_execution_order),n.trace_id=e.trace_id,void 0!==e.dotted_order&&(n.dotted_order=[e.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;this.runMap.set(n.id,n),await(this.onRunCreate?.(n))}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,n,r,i,s,a,o){const l=this._getExecutionOrder(r),c=Date.now(),u=a?{...i,metadata:a}:i,h={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:s||[]};return await this._startTrace(h),await(this.onLLMStart?.(h)),h}async handleChatModelStart(e,t,n,r,i,s,a,o){const l=this._getExecutionOrder(r),c=Date.now(),u=a?{...i,metadata:a}:i,h={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:s||[]};return await this._startTrace(h),await(this.onLLMStart?.(h)),h}async handleLLMEnd(e,t){const n=this.runMap.get(t);if(!n||"llm"!==n?.run_type)throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onLLMEnd?.(n)),await this._endTrace(n),n}async handleLLMError(e,t){const n=this.runMap.get(t);if(!n||"llm"!==n?.run_type)throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onLLMError?.(n)),await this._endTrace(n),n}async handleChainStart(e,t,n,r,i,s,a,o){const l=this._getExecutionOrder(r),c=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:a??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return await this._startTrace(u),await(this.onChainStart?.(u)),u}async handleChainEnd(e,t,n,r,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=d_(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=d_(i.inputs,"input")),await(this.onChainEnd?.(s)),await this._endTrace(s),s}async handleChainError(e,t,n,r,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=d_(i.inputs,"input")),await(this.onChainError?.(s)),await this._endTrace(s),s}async handleToolStart(e,t,n,r,i,s,a){const o=this._getExecutionOrder(r),l=Date.now(),c={id:n,name:a??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return await this._startTrace(c),await(this.onToolStart?.(c)),c}async handleToolEnd(e,t){const n=this.runMap.get(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onToolEnd?.(n)),await this._endTrace(n),n}async handleToolError(e,t){const n=this.runMap.get(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onToolError?.(n)),await this._endTrace(n),n}async handleAgentAction(e,t){const n=this.runMap.get(t);if(!n||"chain"!==n?.run_type)return;const r=n;r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(n))}async handleAgentEnd(e,t){const n=this.runMap.get(t);n&&"chain"===n?.run_type&&(n.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(n)))}async handleRetrieverStart(e,t,n,r,i,s,a){const o=this._getExecutionOrder(r),l=Date.now(),c={id:n,name:a??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return await this._startTrace(c),await(this.onRetrieverStart?.(c)),c}async handleRetrieverEnd(e,t){const n=this.runMap.get(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverEnd?.(n)),await this._endTrace(n),n}async handleRetrieverError(e,t){const n=this.runMap.get(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverError?.(n)),await this._endTrace(n),n}async handleText(e,t){const n=this.runMap.get(t);n&&"chain"===n?.run_type&&(n.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(n)))}async handleLLMNewToken(e,t,n,r,i,s){const a=this.runMap.get(n);if(!a||"llm"!==a?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return a.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:s?.chunk}}),await(this.onLLMNewToken?.(a,e,{chunk:s?.chunk})),a}}function f_(e,t){return`${e.open}${t}${e.close}`}function m_(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function g_(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:y_}=h_;class v_ extends p_{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const e=this.runMap.get(n.parent_run_id);if(!e)break;t.push(e),n=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,n)=>{const r=`${e.execution_order}:${e.run_type}:${e.name}`;return t===n.length-1?f_(h_.bold,r):r})).join(" > ");return f_(y_.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.green,"[chain/start]")} [${t}] Entering Chain run with input: ${m_(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.cyan,"[chain/end]")} [${t}] [${g_(e)}] Exiting Chain run with output: ${m_(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.red,"[chain/error]")} [${t}] [${g_(e)}] Chain run errored with error: ${m_(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${f_(y_.green,"[llm/start]")} [${t}] Entering LLM run with input: ${m_(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.cyan,"[llm/end]")} [${t}] [${g_(e)}] Exiting LLM run with output: ${m_(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.red,"[llm/error]")} [${t}] [${g_(e)}] LLM run errored with error: ${m_(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.cyan,"[tool/end]")} [${t}] [${g_(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.red,"[tool/error]")} [${t}] [${g_(e)}] Tool run errored with error: ${m_(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${m_(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.cyan,"[retriever/end]")} [${t}] [${g_(e)}] Exiting Retriever run with output: ${m_(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${f_(y_.red,"[retriever/error]")} [${t}] [${g_(e)}] Retriever run errored with error: ${m_(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${f_(y_.blue,"[agent/action]")} [${n}] Agent selected action: ${m_(t.actions[t.actions.length-1],"[action]")}`)}}const b_=[400,401,403,404,405,406,407,408],w_=[409];class __{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.queue=new lb.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add((()=>ob((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response,r=t?.status;if(r){if(b_.includes(+r))throw e;if(w_.includes(+r))return;n&&await n(t)}},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise(((t,n)=>{e.signal?.addEventListener("abort",(()=>{n(new Error("AbortError"))}))}))]):this.call(t,...n)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}function k_(e){return"function"==typeof e?._getType}function A_(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}let P_;const T_=()=>"undefined"!=typeof Deno;let E_,x_;function I_(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}const C_=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,O_=function(e){return"string"==typeof e&&C_.test(e)};function S_(e){if(!O_(e))throw new Error(`Invalid UUID: ${e}`)}async function N_(e){const t=await async function(){if(void 0===E_){const e=P_||(P_="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||T_()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":T_()?"deno":"other":"node",P_),t=function(){if(void 0!==x_)return x_;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const n of e){const e=I_(n);void 0!==e&&(t[n]=e)}return x_=t,t}();E_={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:M_,...t}}return E_}(),n=function(){const e=function(){try{return"undefined"!=typeof process&&process.env?Object.entries(process.env).reduce(((e,[t,n])=>(e[t]=String(n),e)),{}):void 0}catch(e){return}}()||{},t={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,i]of Object.entries(e))!r.startsWith("LANGCHAIN_")||"string"!=typeof i||n.includes(r)||r.toLowerCase().includes("key")||r.toLowerCase().includes("secret")||r.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===r?t.revision_id=i:t[r]=i);return t}();return e.map((e=>{const r=e.extra??{},i=r.metadata;return e.extra={...r,runtime:{...t,...r?.runtime},metadata:{...n,...n.revision_id||e.revision_id?{revision_id:e.revision_id??n.revision_id}:{},...i}},e}))}const j_=async(e,t)=>{const n=await e.text();if(!e.ok)throw new Error(`Failed to ${t}: ${e.status} ${e.statusText} ${n}`)};function D_(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const R_=async e=>{if(429===e?.status){const t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise((e=>setTimeout(e,t))),!0}return!1};class $_{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise((t=>{this.items.push([e,t])}))}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");const t=[];for(;t.length<e&&this.items.length;){const e=this.items.shift();if(!e)break;t.push(e)}return[t.map((e=>e[0])),()=>t.forEach((e=>e[1]()))]}}class L_{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new $_}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=L_.getDefaultClientConfig();this.tracingSampleRate=(()=>{const e=I_("LANGCHAIN_TRACING_SAMPLING_RATE");if(void 0===e)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t})(),this.apiUrl=D_(e.apiUrl??t.apiUrl)??"",this.apiKey=D_(e.apiKey??t.apiKey),this.webUrl=D_(e.webUrl??t.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new __(e.callerOptions??{}),this.batchIngestCaller=new __({...e.callerOptions??{},onFailedResponseHook:R_}),this.hideInputs=e.hideInputs??t.hideInputs,this.hideOutputs=e.hideOutputs??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=I_("LANGCHAIN_API_KEY");return{apiUrl:I_("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===I_("LANGCHAIN_HIDE_INPUTS"),hideOutputs:"true"===I_("LANGCHAIN_HIDE_OUTPUTS")}}getHostUrl(){return this.webUrl?this.webUrl:(e=>{const t=this.apiUrl.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t})()?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${M_}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=t?.toString()??"",r=`${this.apiUrl}${e}?${n}`,i=await this.caller.call(fetch,r,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let n=Number(t.get("offset"))||0;const r=Number(t.get("limit"))||100;for(;;){t.set("offset",String(n)),t.set("limit",String(r));const i=`${this.apiUrl}${e}?${t}`,s=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!s.ok)throw new Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);const a=await s.json();if(0===a.length)break;if(yield a,a.length<r)break;n+=a.length}}async*_getCursorPaginatedList(e,t=null,n="POST",r="runs"){const i=t?{...t}:{};for(;;){const t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)}),s=await t.json();if(!s)break;if(!s[r])break;yield s[r];const a=s.cursors;if(!a)break;if(!a.next)break;i.cursor=a.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){const t=[];for(const n of e)this.sampledPostUuids.has(n.id)&&(t.push(n),this.sampledPostUuids.delete(n.id));return t}{const t=[];for(const n of e)Math.random()<this.tracingSampleRate&&(t.push(n),this.sampledPostUuids.add(n.id));return t}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){const[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length)return void t();try{await this.batchIngestRuns({runCreates:e.filter((e=>"create"===e.action)).map((e=>e.item)),runUpdates:e.filter((e=>"update"===e.action)).map((e=>e.item))})}finally{t()}}}async processRunOperation(e,t){const n=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;const r=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout((()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)}),n?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),r}async _getServerInfo(){const e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),new Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch(e){return!1}return!0}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const r=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order)return void this.processRunOperation({action:"create",item:r}).catch(console.error);const i=await N_([r]),s=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(i[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await j_(s,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let n=e?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[],r=t?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[];if(n.length>0&&r.length>0){const e=n.reduce(((e,t)=>t.id?(e[t.id]=t,e):e),{}),t=[];for(const n of r)void 0!==n.id&&e[n.id]?e[n.id]={...e[n.id],...n}:t.push(n);n=Object.values(e),r=t}const i={post:this._filterForSampling(n),patch:this._filterForSampling(r,!0)};if(!i.post.length&&!i.patch.length)return;if(n=await N_(n),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const e of i.post)await this.createRun(e);for(const e of i.patch)void 0!==e.id&&await this.updateRun(e.id,e);return}const s=this.serverInfo?.batch_ingest_config?.size_limit_bytes??20971520,a={post:[],patch:[]};let o=0;for(const e of["post","patch"]){const t=e,n=i[t].reverse();let r=n.pop();for(;void 0!==r;){const e=JSON.stringify(r);o>0&&o+e.length>s&&(await this._postBatchIngestRuns(JSON.stringify(a)),o=0,a.post=[],a.patch=[]),o+=e.length,a[t].push(r),r=n.pop()}}(a.post.length>0||a.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(a))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await j_(n,"batch create run")}async updateRun(e,t){S_(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&void 0!==n.trace_id&&void 0!==n.dotted_order)return void 0!==t.end_time&&void 0===n.parent_run_id?void await this.processRunOperation({action:"update",item:n},!0):void this.processRunOperation({action:"update",item:n}).catch(console.error);const r={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await j_(i,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){S_(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(void 0!==t){let e;e=t.session_id?t.session_id:n?.projectName?(await this.readProject({projectName:n?.projectName})).id:n?.projectId?n?.projectId:(await this.readProject({projectName:I_("LANGCHAIN_PROJECT")||"default"})).id;const r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(this.listRuns({id:e.child_run_ids})),n={},r={};t.sort(((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in n||(n[e.parent_run_id]=[]),n[e.parent_run_id].push(e),r[e.id]=e}e.child_runs=n[e.id]||[];for(const t in n)t!==e.id&&(r[t].child_runs=n[t]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:r,traceId:i,referenceExampleId:s,startTime:a,executionOrder:o,isRoot:l,runType:c,error:u,id:h,query:d,filter:p,traceFilter:f,treeFilter:m,limit:g,select:y}=e;let v=[];if(t&&(v=Array.isArray(t)?t:[t]),n){const e=Array.isArray(n)?n:[n],t=await Promise.all(e.map((e=>this.readProject({projectName:e}).then((e=>e.id)))));v.push(...t)}const b={session:v.length?v:null,run_type:c,reference_example:s,query:d,filter:p,trace_filter:f,tree_filter:m,execution_order:o,parent_run:r,start_time:a?a.toISOString():null,error:u,id:h,limit:g,trace:i,select:y||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l};let w=0;for await(const e of this._getCursorPaginatedList("/runs/query",b))if(g){if(w>=g)break;if(e.length+w>g){const t=e.slice(0,g-w);yield*t;break}w+=e.length,yield*e}else yield*e}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||l_()};S_(e);const r=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await r.json();if(null===i||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){S_(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await j_(t,"unshare run")}async readRunSharedLink(e){S_(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(null!==n&&"share_token"in n)return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)n.append("id",e);S_(e);const r=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await r.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),S_(e);const n=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await n.json();return r.url=`${this.getHostUrl()}/public/${r.share_token}/d`,r}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};S_(e);const r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await r.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){S_(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await j_(t,"unshare dataset")}async readSharedDataset(e){S_(e);const t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:r=!1,projectExtra:i=null,referenceDatasetId:s=null}){const a=r?"?upsert=true":"",o=`${this.apiUrl}/sessions${a}`,l=i||{};n&&(l.metadata=n);const c={name:e,extra:l,description:t};null!==s&&(c.reference_dataset_id=s);const u=await this.caller.call(fetch,o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),h=await u.json();if(!u.ok)throw new Error(`Failed to create session ${e}: ${u.status} ${u.statusText}`);return h}async updateProject(e,{name:t=null,description:n=null,metadata:r=null,projectExtra:i=null,endTime:s=null}){const a=`${this.apiUrl}/sessions/${e}`;let o=i;r&&(o={...o||{},metadata:r});const l={name:t,extra:o,description:n,end_time:s?new Date(s).toISOString():null},c=await this.caller.call(fetch,a,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),u=await c.json();if(!c.ok)throw new Error(`Failed to update project ${e}: ${c.status} ${c.statusText}`);return u}async hasProject({projectId:e,projectName:t}){let n="/sessions";const r=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)S_(e),n+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");r.append("name",t)}const i=await this.caller.call(fetch,`${this.apiUrl}${n}?${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const e=await i.json();return!!i.ok&&(!Array.isArray(e)||e.length>0)}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let r="/sessions";const i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)S_(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");i.append("name",t)}void 0!==n&&i.append("include_stats",n.toString());const s=await this._get(r,i);let a;if(Array.isArray(s)){if(0===s.length)throw new Error(`Project[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/datasets/${n.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:r,referenceDatasetName:i,referenceFree:s}={}){const a=new URLSearchParams;if(void 0!==e)for(const t of e)a.append("id",t);if(void 0!==t&&a.append("name",t),void 0!==n&&a.append("name_contains",n),void 0!==r)a.append("reference_dataset",r);else if(void 0!==i){const e=await this.readDataset({datasetName:i});a.append("reference_dataset",e.id)}void 0!==s&&a.append("reference_free",s.toString());for await(const e of this._getPaginated("/sessions",a))yield*e}async deleteProject({projectId:e,projectName:t}){let n;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");n=void 0===e?(await this.readProject({projectName:t})).id:e,S_(n);const r=await this.caller.call(fetch,`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await j_(r,`delete session ${n} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:r,description:i,dataType:s,name:a}){const o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),n.forEach((e=>{l.append("input_keys",e)})),r.forEach((e=>{l.append("output_keys",e)})),i&&l.append("description",i),s&&l.append("data_type",s),a&&l.append("name",a);const c=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!c.ok){const e=await c.json();if(e.detail&&e.detail.includes("already exists"))throw new Error(`Dataset ${t} already exists`);throw new Error(`Failed to upload CSV: ${c.status} ${c.statusText}`)}return await c.json()}async createDataset(e,{description:t,dataType:n}={}){const r={name:e,description:t};n&&(r.data_type=n);const i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok){const t=await i.json();if(t.detail&&t.detail.includes("already exists"))throw new Error(`Dataset ${e} already exists`);throw new Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const r=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)S_(e),n+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");r.append("name",t)}const i=await this._get(n,r);let s;if(Array.isArray(i)){if(0===i.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);s=i[0]}else s=i;return s}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:r}){let i=e;if(void 0===i&&void 0===t)throw new Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:t})).id);const s=new URLSearchParams({from_version:"string"==typeof n?n:n.toISOString(),to_version:"string"==typeof r?r:r.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const n=await this._getResponse(`/datasets/${e}/openai_ft`);return(await n.text()).trim().split("\n").map((e=>JSON.parse(e)))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:r,datasetNameContains:i}={}){const s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==n)for(const e of n)s.append("id",e);void 0!==r&&s.append("name",r),void 0!==i&&s.append("name_contains",i);for await(const e of this._getPaginated("/datasets",s))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",r=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(r=(await this.readDataset({datasetName:t})).id),void 0===r)throw new Error("Must provide datasetName or datasetId");S_(r),n+=`/${r}`;const i=await this.caller.call(fetch,this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to delete ${n}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:n,datasetName:r,createdAt:i,exampleId:s,metadata:a,split:o}){let l=n;if(void 0===l&&void 0===r)throw new Error("Must provide either datasetName or datasetId");if(void 0!==l&&void 0!==r)throw new Error("Must provide either datasetName or datasetId, not both");void 0===l&&(l=(await this.readDataset({datasetName:r})).id);const c=i||new Date,u={dataset_id:l,inputs:e,outputs:t,created_at:c?.toISOString(),id:s,metadata:a,split:o},h=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!h.ok)throw new Error(`Failed to create example: ${h.status} ${h.statusText}`);return await h.json()}async createExamples(e){const{inputs:t,outputs:n,metadata:r,sourceRunIds:i,exampleIds:s,datasetId:a,datasetName:o}=e;let l=a;if(void 0===l&&void 0===o)throw new Error("Must provide either datasetName or datasetId");if(void 0!==l&&void 0!==o)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===l){const e=await this.readDataset({datasetName:o});l=e.id}const c=t.map(((t,a)=>({dataset_id:l,inputs:t,outputs:n?n[a]:void 0,metadata:r?r[a]:void 0,split:e.splits?e.splits[a]:void 0,id:s?s[a]:void 0,source_run_id:i?i[a]:void 0}))),u=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!u.ok)throw new Error(`Failed to create examples: ${u.status} ${u.statusText}`);return await u.json()}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const r=e.map((e=>k_(e)?A_(e):e)),i=k_(t)?A_(t):t;return this.createExample({input:r},{output:i},n)}async readExample(e){S_(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:r,splits:i,inlineS3Urls:s,metadata:a}={}){let o;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)o=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");o=(await this.readDataset({datasetName:t})).id}const l=new URLSearchParams({dataset:o}),c=r?"string"==typeof r?r:r?.toISOString():void 0;c&&l.append("as_of",c);const u=s??!0;if(l.append("inline_s3_urls",u.toString()),void 0!==n)for(const e of n)l.append("id",e);if(void 0!==i)for(const e of i)l.append("splits",e);if(void 0!==a){const e=JSON.stringify(a);l.append("metadata",e)}for await(const e of this._getPaginated("/examples",l))yield*e}async deleteExample(e){S_(e);const t=`/examples/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async updateExample(e,t){S_(e);const n=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to update example ${e}: ${n.status} ${n.statusText}`);return await n.json()}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:r,referenceExample:i}={loadChildRuns:!1}){let s;if("string"==typeof e)s=await this.readRun(e,{loadChildRuns:r});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);s=e}null!==s.reference_example_id&&void 0!==s.reference_example_id&&(i=await this.readExample(s.reference_example_id));const a=await t.evaluateRun(s,i);let o=n??{};a.evaluatorInfo&&(o={...o,...a.evaluatorInfo});const l=a.targetRunId??s.id;return await this.createFeedback(l,a.key,{score:a?.score,value:a?.value,comment:a?.comment,correction:a?.correction,sourceInfo:o,feedbackSourceType:"model",sourceRunId:a?.sourceRunId})}async createFeedback(e,t,{score:n,value:r,correction:i,comment:s,sourceInfo:a,feedbackSourceType:o="api",sourceRunId:l,feedbackId:c,feedbackConfig:u,projectId:h,comparativeExperimentId:d}){if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const p={type:o??"api",metadata:a??{}};void 0===l||void 0===p?.metadata||p.metadata.__run||(p.metadata.__run={run_id:l}),void 0!==p?.metadata&&void 0!==p.metadata.__run?.run_id&&S_(p.metadata.__run.run_id);const f={id:c??l_(),run_id:e,key:t,score:n,value:r,correction:i,comment:s,feedback_source:p,comparative_experiment_id:d,feedbackConfig:u,session_id:h},m=`${this.apiUrl}/feedback`,g=await this.caller.call(fetch,m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await j_(g,"create feedback"),f}async updateFeedback(e,{score:t,value:n,correction:r,comment:i}){const s={};null!=t&&(s.score=t),null!=n&&(s.value=n),null!=r&&(s.correction=r),null!=i&&(s.comment=i),S_(e);const a=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await j_(a,"update feedback")}async readFeedback(e){S_(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){S_(e);const t=`/feedback/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const r=new URLSearchParams;if(e&&r.append("run",e.join(",")),t)for(const e of t)r.append("key",e);if(n)for(const e of n)r.append("source",e);for await(const e of this._getPaginated("/feedback",r))yield*e}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:r}={}){const i={run_id:e,feedback_key:t,feedback_config:r};n?"string"==typeof n?i.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(i.expires_in=n):i.expires_in={hours:3};const s=await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await s.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:r,description:i,metadata:s,id:a}){if(0===t.length)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!n)throw new Error("A reference dataset is required");const o={id:a,name:e,experiment_ids:t,reference_dataset_id:n,description:i,created_at:(r??new Date)?.toISOString(),extra:{}};s&&(o.extra.metadata=s);const l=await this.caller.call(fetch,`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await l.json()}async*listPresignedFeedbackTokens(e){S_(e);const t=new URLSearchParams({run_id:e});for await(const e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){let t;return t="results"in e?e.results:[e],t}async logEvaluationFeedback(e,t,n){const r=this._selectEvalResults(e);for(const e of r){let r=n||{};e.evaluatorInfo&&(r={...e.evaluatorInfo,...r});let i=null;e.targetRunId?i=e.targetRunId:t&&(i=t.id),await this.createFeedback(i,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:r,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"})}return r}}const M_="0.1.30";class F_ extends p_{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:r}=e;this.projectName=n??Kv("LANGCHAIN_PROJECT")??Kv("LANGCHAIN_SESSION"),this.exampleId=t,this.client=r??new L_({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await qv()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}}let U_;async function B_(e,t){!0===t?await e():(void 0===U_&&(U_=new(0,lb.default)({autoStart:!0,concurrency:1})),U_.add(e))}"true"===Kv("LANGCHAIN_TRACING_V2")&&"true"!==Kv("LANGCHAIN_CALLBACKS_BACKGROUND")&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join("\n");class V_{setHandler(e){return this.setHandlers([e])}}class z_{constructor(e,t,n,r,i,s,a,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map((t=>B_((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}}),t.awaitHandlers))))}}class H_ extends z_{getChild(e){const t=new W_(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>B_((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>B_((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}}),t.awaitHandlers))))}}class G_ extends z_{async handleLLMNewToken(e,t,n,r,i,s){await Promise.all(this.handlers.map((n=>B_((async()=>{if(!n.ignoreLLM)try{await(n.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMNewToken: ${e}`)}}),n.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>B_((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>B_((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}}),t.awaitHandlers))))}}class q_ extends z_{getChild(e){const t=new W_(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,r,i){await Promise.all(this.handlers.map((t=>B_((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}}),t.awaitHandlers))))}async handleChainEnd(e,t,n,r,i){await Promise.all(this.handlers.map((t=>B_((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>B_((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>B_((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}}),t.awaitHandlers))))}}class K_ extends z_{getChild(e){const t=new W_(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>B_((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>B_((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}}),t.awaitHandlers))))}}class W_ extends V_{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,r=void 0,i=void 0,s=void 0,a=void 0,o=void 0){return Promise.all(t.map((async(t,r)=>{const s=0===r&&n?n:l_();return await Promise.all(this.handlers.map((n=>B_((async()=>{if(!n.ignoreLLM)try{await(n.handleLLMStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new G_(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,n=void 0,r=void 0,i=void 0,s=void 0,a=void 0,o=void 0){return Promise.all(t.map((async(t,r)=>{const s=0===r&&n?n:l_();return await Promise.all(this.handlers.map((n=>B_((async()=>{if(!n.ignoreLLM)try{if(n.handleChatModelStart)await(n.handleChatModelStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,o));else if(n.handleLLMStart){const r=Fv(t);await(n.handleLLMStart?.(e,[r],s,this._parentRunId,i,this.tags,this.metadata,o))}}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new G_(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,n=l_(),r=void 0,i=void 0,s=void 0,a=void 0){return await Promise.all(this.handlers.map((i=>B_((async()=>{if(!i.ignoreChain)try{await(i.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,r,a))}catch(e){console.error(`Error in handler ${i.constructor.name}, handleChainStart: ${e}`)}}),i.awaitHandlers)))),new q_(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=l_(),r=void 0,i=void 0,s=void 0,a=void 0){return await Promise.all(this.handlers.map((r=>B_((async()=>{if(!r.ignoreAgent)try{await(r.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,a))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleToolStart: ${e}`)}}),r.awaitHandlers)))),new K_(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=l_(),r=void 0,i=void 0,s=void 0,a=void 0){return await Promise.all(this.handlers.map((r=>B_((async()=>{if(!r.ignoreRetriever)try{await(r.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,a))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleRetrieverStart: ${e}`)}}),r.awaitHandlers)))),new H_(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new W_(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);n.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);n.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);n.addMetadata({[e]:this.metadata[e]},t)}for(const r of e)n.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===r.name))||n.addHandler(r,t);return n}static fromHandlers(e){const t=new this;return t.addHandler(new class extends u_{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:l_()}),Object.assign(this,e)}}),t}static async configure(e,t,n,r,i,s,a){let o;(e||t)&&(Array.isArray(e)||!e?(o=new W_,o.setHandlers(e?.map(J_)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(J_):t?.handlers,!1));const l="true"===Kv("LANGCHAIN_VERBOSE")||a?.verbose,c="true"===Kv("LANGCHAIN_TRACING_V2"),u=c||(Kv("LANGCHAIN_TRACING")??!1);if(l||u){if(o||(o=new W_),l&&!o.handlers.some((e=>e.name===v_.prototype.name))){const e=new v_;o.addHandler(e,!0)}u&&!o.handlers.some((e=>"langchain_tracer"===e.name))&&c&&o.addHandler(await async function(){return new F_}(),!0)}return(n||r)&&o&&(o.addTags(n??[]),o.addTags(r??[],!1)),(i||s)&&o&&(o.addMetadata(i??{}),o.addMetadata(s??{},!1)),o}}function J_(e){return"name"in e?e:u_.fromMethods(e)}const Z_=Object.prototype.hasOwnProperty;function Q_(e,t){return Z_.call(e,t)}function X_(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let n in e)Q_(e,n)&&t.push(n);return t}function Y_(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ek(e){let t=0;const n=e.length;let r;for(;t<n;){if(r=e.charCodeAt(t),!(r>=48&&r<=57))return!1;t++}return!0}function tk(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function nk(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function rk(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(rk(e[t]))return!0}else if("object"==typeof e){const n=X_(e),r=n.length;for(var t=0;t<r;t++)if(rk(e[n[t]]))return!0}return!1}function ik(e,t){const n=[e];for(const e in t){const r="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==r&&n.push(`${e}: ${r}`)}return n.join("\n")}class sk extends Error{constructor(e,t,n,r,i){super(ik(e,{name:t,index:n,operation:r,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=ik(e,{name:t,index:n,operation:r,tree:i})}}const ak=sk,ok=Y_,lk={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){let r=uk(n,this.path);r&&(r=Y_(r));const i=hk(n,{op:"remove",path:this.from}).removed;return hk(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){const r=uk(n,this.from);return hk(n,{op:"add",path:this.path,value:Y_(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:gk(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}};var ck={add:function(e,t,n){return ek(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:lk.move,copy:lk.copy,test:lk.test,_get:lk._get};function uk(e,t){if(""==t)return e;var n={op:"_get",path:t};return hk(e,n),n.value}function hk(e,t,n=!1,r=!0,i=!0,s=0){if(n&&("function"==typeof n?n(t,0,e,t.path):fk(t,0)),""===t.path){let r={newDocument:e};if("add"===t.op)return r.newDocument=t.value,r;if("replace"===t.op)return r.newDocument=t.value,r.removed=e,r;if("move"===t.op||"copy"===t.op)return r.newDocument=uk(e,t.from),"move"===t.op&&(r.removed=e),r;if("test"===t.op){if(r.test=gk(e,t.value),!1===r.test)throw new ak("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return r.newDocument=e,r}if("remove"===t.op)return r.removed=e,r.newDocument=null,r;if("_get"===t.op)return t.value=e,r;if(n)throw new ak("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return r}{r||(e=Y_(e));const a=(t.path||"").split("/");let o,l,c,u=e,h=1,d=a.length;for(c="function"==typeof n?n:fk;;){if(l=a[h],l&&-1!=l.indexOf("~")&&(l=nk(l)),i&&("__proto__"==l||"prototype"==l&&h>0&&"constructor"==a[h-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===o&&(void 0===u[l]?o=a.slice(0,h).join("/"):h==d-1&&(o=t.path),void 0!==o&&c(t,0,e,o)),h++,Array.isArray(u)){if("-"===l)l=u.length;else{if(n&&!ek(l))throw new ak("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);ek(l)&&(l=~~l)}if(h>=d){if(n&&"add"===t.op&&l>u.length)throw new ak("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);const r=ck[t.op].call(t,u,l,e);if(!1===r.test)throw new ak("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return r}}else if(h>=d){const n=lk[t.op].call(t,u,l,e);if(!1===n.test)throw new ak("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return n}if(u=u[l],n&&h<d&&(!u||"object"!=typeof u))throw new ak("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function dk(e,t,n,r=!0,i=!0){if(n&&!Array.isArray(t))throw new ak("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Y_(e));const s=new Array(t.length);for(let r=0,a=t.length;r<a;r++)s[r]=hk(e,t[r],n,!0,i,r),e=s[r].newDocument;return s.newDocument=e,s}function pk(e,t,n){const r=hk(e,t);if(!1===r.test)throw new ak("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function fk(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new ak("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!lk[e.op])throw new ak("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new ak("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new ak('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new ak("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new ak("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&rk(e.value))throw new ak("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ak("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new ak("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var a=mk([{op:"_get",path:e.from,value:void 0}],n);if(a&&"OPERATION_PATH_UNRESOLVABLE"===a.name)throw new ak("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function mk(e,t,n){try{if(!Array.isArray(e))throw new ak("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)dk(Y_(t),Y_(e),n||!0);else{n=n||fk;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof ak)return e;throw e}}function gk(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,s=Array.isArray(e),a=Array.isArray(t);if(s&&a){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!gk(e[n],t[n]))return!1;return!0}if(s!=a)return!1;var o=Object.keys(e);if((r=o.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(o[n]))return!1;for(n=r;0!=n--;)if(!gk(e[i=o[n]],t[i]))return!1;return!0}return e!=e&&t!=t}function yk(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var s=X_(t),a=X_(e),o=!1,l=a.length-1;l>=0;l--){var c=e[h=a[l]];if(!Q_(t,h)||void 0===t[h]&&void 0!==c&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+tk(h),value:Y_(c)}),n.push({op:"remove",path:r+"/"+tk(h)}),o=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var u=t[h];"object"==typeof c&&null!=c&&"object"==typeof u&&null!=u&&Array.isArray(c)===Array.isArray(u)?yk(c,u,n,r+"/"+tk(h),i):c!==u&&(i&&n.push({op:"test",path:r+"/"+tk(h),value:Y_(c)}),n.push({op:"replace",path:r+"/"+tk(h),value:Y_(u)}))}}if(o||s.length!=a.length)for(l=0;l<s.length;l++){var h;Q_(e,h=s[l])||void 0===t[h]||n.push({op:"add",path:r+"/"+tk(h),value:Y_(t[h])})}}}function vk(e,t,n=!1){var r=[];return yk(e,t,r,"",n),r}new WeakMap;class bk extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new bk({start:e=>function n(){return t.read().then((({done:t,value:r})=>{if(!t)return e.enqueue(r),n();e.close()}))}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new bk({async pull(t){const{value:n,done:r}=await e.next();r&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function wk(e,t=2){const n=Array.from({length:t},(()=>[]));return n.map((async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of n)e.push(t)}else{if(t[0].done)return;yield t.shift().value}}))}function _k(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){const n={...e};for(const[e,r]of Object.entries(t))e in n&&!Array.isArray(n[e])?n[e]=_k(n[e],r):n[e]=r;return n}throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}class kk{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise(((n,r)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(n,r):this.firstResult.then((e=>n(void 0)),r)}))}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}class Ak{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=dk({},t);return new Pk({ops:t,state:n[n.length-1].newDocument})}}class Pk extends Ak{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=dk(this.state,e.ops);return new Pk({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=dk({},e.ops);return new Pk({ops:e.ops,state:t[t.length-1].newDocument})}}async function Tk(e,t){if("original"===t)throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=e;return["retriever","llm","prompt"].includes(e.run_type)?n:1!==Object.keys(n).length||""!==n?.input?n.input:void 0}async function Ek(e,t){const{outputs:n}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?n:void 0!==n&&1===Object.keys(n).length&&void 0!==n?.output?n.output:n}class xk extends p_{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=bk.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(n=n||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(n=n&&t.every((e=>!this.excludeTags?.includes(e)))),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const t=this.keyMapByRunId[e];t&&await this.writer.write(new Ak({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new Ak({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(n.inputs=await Tk(e,this._schemaFormat)),await this.writer.write(new Ak({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const n=[];"streaming_events"===this._schemaFormat&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await Tk(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await Ek(e,this._schemaFormat)}),void 0!==e.end_time&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const r=new Ak({ops:n});await this.writer.write(r)}finally{if(e.id===this.rootId){const t=new Ak({ops:[{op:"replace",path:"/final_output",value:await Ek(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const r=this.keyMapByRunId[e.id];if(void 0===r)return;let i;i=void 0!==e.inputs.messages?function(e){return void 0!==e&&void 0!==e.message}(n?.chunk)?n?.chunk:new Ov(t):t;const s=new Ak({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${r}/streamed_output/-`,value:i}]});await this.writer.write(s)}}class Ik{getStore(){}run(e,t){return t()}}const Ck=new class{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new Ik}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}};async function Ok(e){return W_.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function Sk(...e){const t={};for(const n of e.filter((e=>!!e)))for(const e of Object.keys(n))if("metadata"===e)t[e]={...t[e],...n[e]};else if("tags"===e){const r=t[e]??[];t[e]=[...new Set(r.concat(n[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...n[e]};else if("callbacks"===e){const e=t.callbacks,r=n.callbacks;if(Array.isArray(r))if(e)if(Array.isArray(e))t.callbacks=e.concat(r);else{const n=e.copy();for(const e of r)n.addHandler(J_(e),!0);t.callbacks=n}else t.callbacks=r;else if(r)if(e)if(Array.isArray(e)){const n=r.copy();for(const t of e)n.addHandler(J_(t),!0);t.callbacks=n}else t.callbacks=new W_(r._parentRunId,{handlers:e.handlers.concat(r.handlers),inheritableHandlers:e.inheritableHandlers.concat(r.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(r.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(r.inheritableTags))),metadata:{...e.metadata,...r.metadata}});else t.callbacks=r}else{const r=e;t[r]=n[r]??t[r]}return t}const Nk=new Set(["string","number","boolean"]);function jk(e){const t=e??Ck.getInstance().getStore();let n={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(t&&(n={...n,...t}),t?.configurable)for(const e of Object.keys(t.configurable))Nk.has(typeof t.configurable[e])&&!n.metadata?.[e]&&(n.metadata||(n.metadata={}),n.metadata[e]=t.configurable[e]);return n}function Dk(e={},{callbacks:t,maxConcurrency:n,recursionLimit:r,runName:i,configurable:s,runId:a}={}){const o=jk(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==r&&(o.recursionLimit=r),void 0!==n&&(o.maxConcurrency=n),void 0!==i&&(o.runName=i),void 0!==s&&(o.configurable={...o.configurable,...s}),void 0!==a&&delete o.runId,o}class Rk extends p_{constructor({config:e,onStart:t,onEnd:n,onError:r}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=r}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}function $k(e){return!!e&&e.lc_runnable}class Lk{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags;const r=e.tags??[];return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(t)),void 0!==this.includeTags&&(n=n||r.some((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(n=n&&r.every((e=>!this.excludeTags?.includes(e)))),n}}const Mk=Symbol("Let zodToJsonSchema decide on which parser to use"),Fk={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Uk=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};function Bk(e){if("openAi"!==e.target)return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?Uk(t,e.currentPath):t.join("/")}}function Vk(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function zk(e,t,n,r,i){e[t]=n,Vk(e,t,r,i)}function Hk(e,t){return aA(e.type._def,t)}function Gk(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map(((n,r)=>Gk(e,t,n)))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return qk(e,t)}}const qk=(e,t)=>{const n={type:"integer",format:"unix-time"};if("openApi3"===t.target)return n;for(const r of e.checks)switch(r.kind){case"min":zk(n,"minimum",r.value,r.message,t);break;case"max":zk(n,"maximum",r.value,r.message,t)}return n};let Kk;const Wk={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===Kk&&(Kk=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Kk),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Jk(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":zk(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":zk(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Xk(n,"email",r.message,t);break;case"format:idn-email":Xk(n,"idn-email",r.message,t);break;case"pattern:zod":Yk(n,Wk.email,r.message,t)}break;case"url":Xk(n,"uri",r.message,t);break;case"uuid":Xk(n,"uuid",r.message,t);break;case"regex":Yk(n,r.regex,r.message,t);break;case"cuid":Yk(n,Wk.cuid,r.message,t);break;case"cuid2":Yk(n,Wk.cuid2,r.message,t);break;case"startsWith":Yk(n,RegExp(`^${Zk(r.value,t)}`),r.message,t);break;case"endsWith":Yk(n,RegExp(`${Zk(r.value,t)}$`),r.message,t);break;case"datetime":Xk(n,"date-time",r.message,t);break;case"date":Xk(n,"date",r.message,t);break;case"time":Xk(n,"time",r.message,t);break;case"duration":Xk(n,"duration",r.message,t);break;case"length":zk(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value,r.message,t),zk(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":Yk(n,RegExp(Zk(r.value,t)),r.message,t);break;case"ip":"v6"!==r.version&&Xk(n,"ipv4",r.message,t),"v4"!==r.version&&Xk(n,"ipv6",r.message,t);break;case"base64url":Yk(n,Wk.base64url,r.message,t);break;case"jwt":Yk(n,Wk.jwt,r.message,t);break;case"cidr":"v6"!==r.version&&Yk(n,Wk.ipv4Cidr,r.message,t),"v4"!==r.version&&Yk(n,Wk.ipv6Cidr,r.message,t);break;case"emoji":Yk(n,Wk.emoji(),r.message,t);break;case"ulid":Yk(n,Wk.ulid,r.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":Xk(n,"binary",r.message,t);break;case"contentEncoding:base64":zk(n,"contentEncoding","base64",r.message,t);break;case"pattern:zod":Yk(n,Wk.base64,r.message,t)}break;case"nanoid":Yk(n,Wk.nanoid,r.message,t)}return n}function Zk(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let n=0;n<e.length;n++)Qk.has(e[n])||(t+="\\"),t+=e[n];return t}(e):e}const Qk=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Xk(e,t,n,r){e.format||e.anyOf?.some((e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):zk(e,"format",t,n,r)}function Yk(e,t,n,r){e.pattern||e.allOf?.some((e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:eA(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):zk(e,"pattern",eA(t,r),n,r)}function eA(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const n=e.flags.includes("i"),r=e.flags.includes("m"),i=e.flags.includes("s"),s=n?e.source.toLowerCase():e.source;let a="",o=!1,l=!1,c=!1;for(let e=0;e<s.length;e++)if(o)a+=s[e],o=!1;else{if(n)if(l){if(s[e].match(/[a-z]/)){c?(a+=s[e],a+=`${s[e-2]}-${s[e]}`.toUpperCase(),c=!1):"-"===s[e+1]&&s[e+2]?.match(/[a-z]/)?(a+=s[e],c=!0):a+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){a+=`[${s[e]}${s[e].toUpperCase()}]`;continue}if(r){if("^"===s[e]){a+="(^|(?<=[\r\n]))";continue}if("$"===s[e]){a+="($|(?=[\r\n]))";continue}}i&&"."===s[e]?a+=l?`${s[e]}\r\n`:`[${s[e]}\r\n]`:(a+=s[e],"\\"===s[e]?o=!0:l&&"]"===s[e]?l=!1:l||"["!==s[e]||(l=!0))}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function tA(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===Ww.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((n,r)=>({...n,[r]:aA(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??Bk(t)})),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:aA(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return n;if(e.keyType?._def.typeName===Ww.ZodString&&e.keyType._def.checks?.length){const{type:r,...i}=Jk(e.keyType._def,t);return{...n,propertyNames:i}}if(e.keyType?._def.typeName===Ww.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===Ww.ZodBranded&&e.keyType._def.type._def.typeName===Ww.ZodString&&e.keyType._def.type._def.checks?.length){const{type:r,...i}=Hk(e.keyType._def,t);return{...n,propertyNames:i}}return n}const nA={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},rA=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,n)=>aA(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]}))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return n.length?{anyOf:n}:void 0};function iA(e){try{return e.isOptional()}catch{return!0}}const sA=(e,t,n)=>{switch(t){case Ww.ZodString:return Jk(e,n);case Ww.ZodNumber:return function(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",Vk(n,"type",r.message,t);break;case"min":"jsonSchema7"===t.target?r.inclusive?zk(n,"minimum",r.value,r.message,t):zk(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),zk(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?zk(n,"maximum",r.value,r.message,t):zk(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),zk(n,"maximum",r.value,r.message,t));break;case"multipleOf":zk(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case Ww.ZodObject:return function(e,t){const n="openAi"===t.target,r={type:"object",properties:{}},i=[],s=e.shape();for(const e in s){let a=s[e];if(void 0===a||void 0===a._def)continue;let o=iA(a);o&&n&&("ZodOptional"===a._def.typeName&&(a=a._def.innerType),a.isNullable()||(a=a.nullable()),o=!1);const l=aA(a._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(r.properties[e]=l,o||i.push(e))}i.length&&(r.required=i);const a=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return aA(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==a&&(r.additionalProperties=a),r}(e,n);case Ww.ZodBigInt:return function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":"jsonSchema7"===t.target?r.inclusive?zk(n,"minimum",r.value,r.message,t):zk(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),zk(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?zk(n,"maximum",r.value,r.message,t):zk(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),zk(n,"maximum",r.value,r.message,t));break;case"multipleOf":zk(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case Ww.ZodBoolean:return{type:"boolean"};case Ww.ZodDate:return Gk(e,n);case Ww.ZodUndefined:return function(e){return{not:Bk(e)}}(n);case Ww.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(n);case Ww.ZodArray:return function(e,t){const n={type:"array"};return e.type?._def&&e.type?._def?.typeName!==Ww.ZodAny&&(n.items=aA(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&zk(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&zk(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(zk(n,"minItems",e.exactLength.value,e.exactLength.message,t),zk(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}(e,n);case Ww.ZodUnion:case Ww.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return rA(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every((e=>e._def.typeName in nA&&(!e._def.checks||!e._def.checks.length)))){const e=n.reduce(((e,t)=>{const n=nA[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e}),[]);return{type:e.length>1?e:e[0]}}if(n.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=n.reduce(((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===n.length){const t=e.filter(((e,t,n)=>n.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:n.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(n.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:n.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return rA(e,t)}(e,n);case Ww.ZodIntersection:return function(e,t){const n=[aA(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),aA(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter((e=>!!e));let r="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const i=[];return n.forEach((e=>{if((e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e)(e))i.push(...e.allOf),void 0===e.unevaluatedProperties&&(r=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...r}=e;t=r}else r=void 0;i.push(t)}})),i.length?{allOf:i,...r}:void 0}(e,n);case Ww.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,n)=>aA(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:aA(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,n)=>aA(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}(e,n);case Ww.ZodRecord:return tA(e,n);case Ww.ZodLiteral:return function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}(e,n);case Ww.ZodEnum:return function(e){return{type:"string",enum:Array.from(e.values)}}(e);case Ww.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),r=Array.from(new Set(n.map((e=>typeof e))));return{type:1===r.length?"string"===r[0]?"string":"number":["string","number"],enum:n}}(e);case Ww.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:nA[e.innerType._def.typeName],nullable:!0}:{type:[nA[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=aA(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=aA(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case Ww.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return aA(e.innerType._def,t);const n=aA(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:Bk(t)},n]}:Bk(t)})(e,n);case Ww.ZodMap:return function(e,t){return"record"===t.mapStrategy?tA(e,t):{type:"array",maxItems:125,items:{type:"array",items:[aA(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Bk(t),aA(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Bk(t)],minItems:2,maxItems:2}}}(e,n);case Ww.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:aA(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&zk(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&zk(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}(e,n);case Ww.ZodLazy:return()=>e.getter()._def;case Ww.ZodPromise:return function(e,t){return aA(e.type._def,t)}(e,n);case Ww.ZodNaN:case Ww.ZodNever:return function(e){return"openAi"===e.target?void 0:{not:Bk({...e,currentPath:[...e.currentPath,"not"]})}}(n);case Ww.ZodEffects:return function(e,t){return"input"===t.effectStrategy?aA(e.schema._def,t):Bk(t)}(e,n);case Ww.ZodAny:return Bk(n);case Ww.ZodUnknown:return function(e){return Bk(e)}(n);case Ww.ZodDefault:return function(e,t){return{...aA(e.innerType._def,t),default:e.defaultValue()}}(e,n);case Ww.ZodBranded:return Hk(e,n);case Ww.ZodReadonly:case Ww.ZodCatch:return((e,t)=>aA(e.innerType._def,t))(e,n);case Ww.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return aA(e.in._def,t);if("output"===t.pipeStrategy)return aA(e.out._def,t);const n=aA(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,aA(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter((e=>void 0!==e))}})(e,n);case Ww.ZodFunction:case Ww.ZodVoid:case Ww.ZodSymbol:default:return}};function aA(e,t,n=!1){const r=t.seen.get(e);if(t.override){const i=t.override?.(e,t,r,n);if(i!==Mk)return i}if(r&&!n){const e=oA(r,t);if(void 0!==e)return e}const i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);const s=sA(e,e.typeName,t),a="function"==typeof s?aA(s(),t):s;if(a&&lA(e,t,a),t.postProcess){const n=t.postProcess(a,e,t);return i.jsonSchema=a,n}return i.jsonSchema=a,a}const oA=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Uk(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,n)=>t.currentPath[n]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Bk(t)):"seen"===t.$refStrategy?Bk(t):void 0}},lA=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),cA=(e,t)=>{const n=(e=>{const t=(e=>"string"==typeof e?{...Fk,name:e}:{...Fk,...e})(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map((([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))}})(t);let r="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,r])=>({...e,[t]:aA(r._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??Bk(n)})),{}):void 0;const i="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,s=aA(e._def,void 0===i?n:{...n,currentPath:[...n.basePath,n.definitionPath,i]},!1)??Bk(n),a="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==a&&(s.title=a),n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===n.$refStrategy?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const o=void 0===i?r?{...s,[n.definitionPath]:r}:s:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,i].join("/"),[n.definitionPath]:{...r,[i]:s}};return"jsonSchema7"===n.target?o.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"!==n.target&&"openAi"!==n.target||(o.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===n.target&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};function uA(e){return $k(e.data)?{type:"runnable",data:{id:e.data.lc_id,name:e.data.getName()}}:{type:"schema",data:{...cA(e.data.schema),title:e.data.name}}}class hA{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach(((t,n)=>{e[t.id]=O_(t.id)?n:t.id})),{nodes:Object.values(this.nodes).map((t=>({id:e[t.id],...uA(t)}))),edges:this.edges.map((t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]}))}}addNode(e,t){if(void 0!==t&&void 0!==this.nodes[t])throw new Error(`Node with id ${t} already exists`);const n=t||l_(),r={id:n,data:e};return this.nodes[n]=r,r}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter((t=>t.source!==e.id&&t.target!==e.id))}addEdge(e,t,n){if(void 0===this.nodes[e.id])throw new Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw new Error(`Target node ${t.id} not in graph`);const r={source:e.id,target:t.id,data:n};return this.edges.push(r),r}firstNode(){const e=new Set(this.edges.map((e=>e.target))),t=[];return Object.values(this.nodes).forEach((n=>{e.has(n.id)||t.push(n)})),t[0]}lastNode(){const e=new Set(this.edges.map((e=>e.source))),t=[];return Object.values(this.nodes).forEach((n=>{e.has(n.id)||t.push(n)})),t[0]}extend(e){Object.entries(e.nodes).forEach((([e,t])=>{this.nodes[e]=t})),this.edges=[...this.edges,...e.edges]}trimFirstNode(){const e=this.firstNode();if(e){const t=this.edges.filter((t=>t.source===e.id));1!==Object.keys(this.nodes).length&&1!==t.length||this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const t=this.edges.filter((t=>t.target===e.id));1!==Object.keys(this.nodes).length&&1!==t.length||this.removeNode(e)}}}function dA(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}function pA(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*fA(e,t){const n=Ck.getInstance();for(;;){const{value:r,done:i}=n.run(e,t.next.bind(t));if(i)break;yield r}}async function*mA(e,t){const n=Ck.getInstance(),r=t[Symbol.asyncIterator]();for(;;){const{value:i,done:s}=await n.run(e,r.next.bind(t));if(s)break;yield i}}function gA(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class yA extends _v{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new vA({bound:this,kwargs:e,config:{}})}map(){return new bA({bound:this})}withRetry(e){return new wA({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new vA({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new PA({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(jk);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter((([e])=>"runId"!==e)));return Array.from({length:t},((t,r)=>jk(0===r?e:n)))}return Array.from({length:t},(()=>jk(e)))}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),i=r[0]?.maxConcurrency??n?.maxConcurrency,s=new hb({maxConcurrency:i,onFailedAttempt:e=>{throw e}}),a=e.map(((e,t)=>s.call((async()=>{try{return await this.invoke(e,r[t])}catch(e){if(n?.returnExceptions)return e;throw e}}))));return Promise.all(a)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=new kk(this._streamIterator(e,jk(t)));return await n.setup,bk.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(e){let t;t=jk(void 0===e?e:{callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,[t,n]}async _callWithConfig(e,t,n){const r=jk(n),i=await Ok(r),s=await(i?.handleChainStart(this.toJSON(),gA(t,"input"),r.runId,r?.runType,void 0,void 0,r?.runName??this.getName()));let a;delete r.runId;try{a=await e.call(this,t,r,s)}catch(e){throw await(s?.handleChainError(e)),e}return await(s?.handleChainEnd(gA(a,"output"))),a}async _batchWithConfig(e,t,n,r){const i=this._getOptionsList(n??{},t.length),s=await Promise.all(i.map(Ok)),a=await Promise.all(s.map((async(e,n)=>{const r=await(e?.handleChainStart(this.toJSON(),gA(t[n],"input"),i[n].runId,i[n].runType,void 0,void 0,i[n].runName??this.getName()));return delete i[n].runId,r})));let o;try{o=await e.call(this,t,i,a,r)}catch(e){throw await Promise.all(a.map((t=>t?.handleChainError(e)))),e}return await Promise.all(a.map((e=>e?.handleChainEnd(gA(o,"output"))))),o}async*_transformStreamWithConfig(e,t,n){let r,i,s=!0,a=!0;const o=jk(n),l=await Ok(o);let c;try{const n=await async function(e,t,n,...r){const i=new kk(t,n),s=await i.setup;return{output:e(i,s,...r),setup:s}}(t.bind(this),async function*(){for await(const t of e){if(s)if(void 0===r)r=t;else try{r=_k(r,t)}catch{r=void 0,s=!1}yield t}}(),(async()=>l?.handleChainStart(this.toJSON(),{input:""},o.runId,o.runType,void 0,void 0,o.runName??this.getName())),o);delete o.runId,c=n.setup;const u=e=>"log_stream_tracer"===e.name,h=c?.handlers.find(u);let d=n.output;void 0!==h&&void 0!==c&&(d=await h.tapOutputIterable(c.runId,n.output));for await(const e of d)if(yield e,a)if(void 0===i)i=e;else try{i=_k(i,e)}catch{i=void 0,a=!1}}catch(e){throw await(c?.handleChainError(e,void 0,void 0,void 0,{inputs:gA(r,"input")})),e}await(c?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:gA(r,"input")}))}getGraph(e){const t=new hA,n=t.addNode({name:`${this.getName()}Input`,schema:Xw()}),r=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:Xw()});return t.addEdge(n,r),t.addEdge(r,i),t}pipe(e){return new _A({first:this,last:TA(e)})}pick(e){return this.pipe(new xA(e))}assign(e){return this.pipe(new EA(new kA({steps:e})))}async*transform(e,t){let n;for await(const t of e)n=void 0===n?t:_k(n,t);yield*this._streamIterator(n,jk(t))}async*streamLog(e,t,n){const r=new xk({...n,autoClose:!1,_schemaFormat:"original"}),i=jk(t);yield*this._streamLog(e,r,i)}async*_streamLog(e,t,n){const{callbacks:r}=n;if(void 0===r)n.callbacks=[t];else if(Array.isArray(r))n.callbacks=r.concat([t]);else{const e=r.copy();e.inheritableHandlers.push(t),n.callbacks=e}const i=this.stream(e,n),s=async function(){try{const e=await i;for await(const n of e){const e=new Ak({ops:[{op:"add",path:"/streamed_output/-",value:n}]});await t.writer.write(e)}}finally{await t.writer.close()}}();try{for await(const e of t)yield e}finally{await s}}async*streamEvents(e,t,n){if("text/event-stream"===t.encoding){const r=await this._streamEvents(e,t,n);yield*function(e){const t=new TextEncoder,n=new ReadableStream({async start(n){for await(const r of e)n.enqueue(t.encode(`event: data\ndata: ${JSON.stringify(r)}\n\n`));n.enqueue(t.encode("event: end\n\n")),n.close()}});return bk.fromReadableStream(n)}(r)}else yield*this._streamEvents(e,t,n)}async*_streamEvents(e,t,n){if("v1"!==t.version)throw new Error('Only version "v1" of the events schema is currently supported.');let r,i=!1;const s=jk(t),a=s.tags??[],o=s.metadata??{},l=s.runName??this.getName(),c=new xk({...n,autoClose:!1,_schemaFormat:"streaming_events"}),u=new Lk({...n}),h=this._streamLog(e,c,s);for await(const t of h){if(r=r?r.concat(t):Pk.fromRunLogPatch(t),void 0===r.state)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const t={...r.state},n={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:a,metadata:o,data:{input:e}};u.includeEvent(n,t.type)&&(yield n)}const n=t.ops.filter((e=>e.path.startsWith("/logs/"))).map((e=>e.path.split("/")[2])),s=[...new Set(n)];for(const e of s){let t,n={};const i=r.state.logs[e];if(t=void 0===i.end_time?i.streamed_output.length>0?"stream":"start":"end","start"===t)void 0!==i.inputs&&(n.input=i.inputs);else if("end"===t)void 0!==i.inputs&&(n.input=i.inputs),n.output=i.final_output;else if("stream"===t){const e=i.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${i.name}"`);n={chunk:i.streamed_output[0]},i.streamed_output=[]}yield{event:`on_${i.type}_${t}`,name:i.name,run_id:i.id,tags:i.tags,metadata:i.metadata,data:n}}const{state:c}=r;if(c.streamed_output.length>0){const e=c.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${c.name}"`);const t={chunk:c.streamed_output[0]};c.streamed_output=[];const n={event:`on_${c.type}_stream`,run_id:c.id,tags:a,metadata:o,name:l,data:t};u.includeEvent(n,c.type)&&(yield n)}}const d=r?.state;if(void 0!==d){const e={event:`on_${d.type}_end`,name:l,run_id:d.id,tags:a,metadata:o,data:{output:d.final_output}};u.includeEvent(e,d.type)&&(yield e)}}static isRunnable(e){return $k(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new vA({bound:this,config:{},configFactories:[r=>({callbacks:[new Rk({config:r,onStart:e,onEnd:t,onError:n})]})]})}}class vA extends yA{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=Sk(this.config,...e);return Sk(t,...this.configFactories?await Promise.all(this.configFactories.map((async e=>await e(t)))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(jk(t),this.kwargs))}async batch(e,t,n){const r=Array.isArray(t)?await Promise.all(t.map((async e=>this._mergeConfig(jk(e),this.kwargs)))):await this._mergeConfig(jk(t),this.kwargs);return this.bound.batch(e,r,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(jk(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(jk(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(jk(t),this.kwargs))}async*streamEvents(e,t,n){yield*this.bound.streamEvents(e,{...await this._mergeConfig(jk(t),this.kwargs),version:t.version},n)}static isRunnableBinding(e){return e.bound&&yA.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new vA({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[r=>({callbacks:[new Rk({config:r,onStart:e,onEnd:t,onError:n})]})]})}}class bA extends yA{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new bA({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,n){return this.bound.batch(e,Dk(t,{callbacks:n?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new bA({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class wA extends vA{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const r=e>1?`retry:attempt:${e}`:void 0;return Dk(t,{callbacks:n?.getChild(r)})}async _invoke(e,t,n){return ob((r=>super.invoke(e,this._patchConfigForRetry(r,t,n))),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,n,r){const i={};try{await ob((async s=>{const a=e.map(((e,t)=>t)).filter((e=>void 0===i[e.toString()]||i[e.toString()]instanceof Error)),o=a.map((t=>e[t])),l=a.map((e=>this._patchConfigForRetry(s,t?.[e],n?.[e]))),c=await super.batch(o,l,{...r,returnExceptions:!0});let u;for(let e=0;e<c.length;e+=1){const t=c[e],n=a[e];t instanceof Error&&void 0===u&&(u=t,u.input=o[e]),i[n.toString()]=t}if(u)throw u;return c}),{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==r?.returnExceptions)throw e}return Object.keys(i).sort(((e,t)=>parseInt(e,10)-parseInt(t,10))).map((e=>i[parseInt(e,10)]))}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class _A extends yA{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const n=jk(t),r=await Ok(n),i=await(r?.handleChainStart(this.toJSON(),gA(e,"input"),n.runId,void 0,void 0,void 0,n?.runName));delete n.runId;let s,a=e;try{const e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){const r=e[t];a=await r.invoke(a,Dk(n,{callbacks:i?.getChild(`seq:step:${t+1}`)}))}s=await this.last.invoke(a,Dk(n,{callbacks:i?.getChild(`seq:step:${this.steps.length}`)}))}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(gA(s,"output"))),s}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),i=await Promise.all(r.map(Ok)),s=await Promise.all(i.map((async(t,n)=>{const i=await(t?.handleChainStart(this.toJSON(),gA(e[n],"input"),r[n].runId,void 0,void 0,void 0,r[n].runName));return delete r[n].runId,i})));let a=e;try{for(let e=0;e<this.steps.length;e+=1){const t=this.steps[e];a=await t.batch(a,s.map(((t,n)=>{const i=t?.getChild(`seq:step:${e+1}`);return Dk(r[n],{callbacks:i})})),n)}}catch(e){throw await Promise.all(s.map((t=>t?.handleChainError(e)))),e}return await Promise.all(s.map((e=>e?.handleChainEnd(gA(a,"output"))))),a}async*_streamIterator(e,t){const n=await Ok(t),{runId:r,...i}=t??{},s=await(n?.handleChainStart(this.toJSON(),gA(e,"input"),r,void 0,void 0,void 0,i?.runName)),a=[this.first,...this.middle,this.last];let o,l=!0;try{let t=a[0].transform(async function*(){yield e}(),Dk(i,{callbacks:s?.getChild("seq:step:1")}));for(let e=1;e<a.length;e+=1){const n=a[e];t=await n.transform(t,Dk(i,{callbacks:s?.getChild(`seq:step:${e+1}`)}))}for await(const n of t)if(yield n,l)if(void 0===o)o=n;else try{o=_k(o,n)}catch(e){o=void 0,l=!1}}catch(e){throw await(s?.handleChainError(e)),e}await(s?.handleChainEnd(gA(o,"output")))}getGraph(e){const t=new hA;let n=null;return this.steps.forEach(((r,i)=>{const s=r.getGraph(e);0!==i&&s.trimFirstNode(),i!==this.steps.length-1&&s.trimLastNode(),t.extend(s);const a=s.firstNode();if(!a)throw new Error(`Runnable ${r} has no first node`);n&&t.addEdge(n,a),n=s.lastNode()})),t}pipe(e){return _A.isRunnableSequence(e)?new _A({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new _A({first:this.first,middle:[...this.middle,this.last],last:TA(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&yA.isRunnable(e)}static from([e,...t],n){return new _A({first:TA(e),middle:t.slice(0,-1).map(TA),last:TA(t[t.length-1]),name:n})}}class kA extends yA{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=TA(n)}static from(e){return new kA({steps:e})}async invoke(e,t){const n=jk(t),r=await Ok(n),i=await(r?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName));delete n.runId;const s={};try{await Promise.all(Object.entries(this.steps).map((async([t,r])=>{s[t]=await r.invoke(e,Dk(n,{callbacks:i?.getChild(`map:key:${t}`)}))})))}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(s)),s}async*_transform(e,t,n){const r={...this.steps},i=wk(e,Object.keys(r).length),s=new Map(Object.entries(r).map((([e,r],s)=>{const a=r.transform(i[s],Dk(n,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,a.next().then((t=>({key:e,gen:a,result:t})))]})));for(;s.size;){const{key:e,result:t,gen:n}=await Promise.race(s.values());s.delete(e),t.done||(yield{[e]:t.value},s.set(e,n.next().then((t=>({key:e,gen:n,result:t})))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new kk(this.transform(async function*(){yield e}(),t));return await n.setup,bk.fromAsyncGenerator(n)}}class AA extends yA{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new AA({func:e})}async _invoke(e,t,n){return new Promise(((r,i)=>{const s=Dk(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??25)-1});Ck.getInstance().run(s,(async()=>{try{let n=await this.func(e,{...s,config:s});if(n&&yA.isRunnable(n)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");n=await n.invoke(e,{...s,recursionLimit:(s.recursionLimit??25)-1})}else if(pA(n)){let e;for await(const t of mA(s,n))if(void 0===e)e=t;else try{e=_k(e,t)}catch(n){e=t}n=e}else if(dA(n)){let e;for(const t of fA(s,n))if(void 0===e)e=t;else try{e=_k(e,t)}catch(n){e=t}n=e}r(n)}catch(e){i(e)}}))}))}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,n){let r;for await(const t of e)if(void 0===r)r=t;else try{r=_k(r,t)}catch(e){r=t}const i=await new Promise(((e,t)=>{Ck.getInstance().run(n,(async()=>{try{const t=await this.func(r,{...n,config:n});e(t)}catch(e){t(e)}}))}));if(i&&yA.isRunnable(i)){if(0===n?.recursionLimit)throw new Error("Recursion limit reached.");const e=await i.stream(r,Dk(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??25)-1}));for await(const t of e)yield t}else if(pA(i))for await(const e of mA(n,i))yield e;else if(dA(i))for(const e of fA(n,i))yield e;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new kk(this.transform(async function*(){yield e}(),t));return await n.setup,bk.fromAsyncGenerator(n)}}class PA extends yA{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=await W_.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),{runId:r,...i}=t??{},s=await(n?.handleChainStart(this.toJSON(),gA(e,"input"),r,void 0,void 0,void 0,i?.runName));let a;for(const t of this.runnables())try{const n=await t.invoke(e,Dk(i,{callbacks:s?.getChild()}));return await(s?.handleChainEnd(gA(n,"output"))),n}catch(e){void 0===a&&(a=e)}if(void 0===a)throw new Error("No error stored at end of fallback.");throw await(s?.handleChainError(a)),a}async batch(e,t,n){if(n?.returnExceptions)throw new Error("Not implemented.");const r=this._getOptionsList(t??{},e.length),i=await Promise.all(r.map((e=>W_.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)))),s=await Promise.all(i.map((async(t,n)=>{const i=await(t?.handleChainStart(this.toJSON(),gA(e[n],"input"),r[n].runId,void 0,void 0,void 0,r[n].runName));return delete r[n].runId,i})));let a;for(const t of this.runnables())try{const i=await t.batch(e,s.map(((e,t)=>Dk(r[t],{callbacks:e?.getChild()}))),n);return await Promise.all(s.map(((e,t)=>e?.handleChainEnd(gA(i[t],"output"))))),i}catch(e){void 0===a&&(a=e)}if(!a)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(s.map((e=>e?.handleChainError(a)))),a}}function TA(e){if("function"==typeof e)return new AA({func:e});if(yA.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[n,r]of Object.entries(e))t[n]=TA(r);return new kA({steps:t})}}class EA extends yA{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof kA&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const r=this.mapper.getStepsKeys(),[i,s]=wk(e),a=this.mapper.transform(s,Dk(n,{callbacks:t?.getChild()})),o=a.next();for await(const e of i){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter((([e])=>!r.includes(e))));Object.keys(t).length>0&&(yield t)}yield(await o).value;for await(const e of a)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new kk(this.transform(async function*(){yield e}(),t));return await n.setup,bk.fromAsyncGenerator(n)}}class xA extends yA{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map((t=>[t,e[t]])).filter((e=>void 0!==e[1]));return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new kk(this.transform(async function*(){yield e}(),t));return await n.setup,bk.fromAsyncGenerator(n)}}class IA extends yA{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class CA extends IA{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){super({callbacks:e??t,...n}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof n.cache?this.cache=n.cache:n.cache?this.cache=rb.global():this.cache=void 0,this.caller=new hb(n??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await async function(e){return async function(e){return e in bb||(bb[e]=wb.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then((e=>e.json())).then((e=>new vb(e))).catch((t=>{throw delete bb[e],t}))),await bb[e]}(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}(e))}("modelName"in this?(e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e.startsWith("gpt-4o")?"gpt-4o":e)(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new sb(e):Array.isArray(e)?new ab(e.map(Mv)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()},r=Object.entries(n).filter((([e,t])=>void 0!==t)),i=r.map((([e,t])=>`${e}:${JSON.stringify(t)}`)).sort().join(",");return i}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class OA extends CA{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n?.timeout&&!n.signal&&(n.signal=AbortSignal.timeout(n.timeout)),[t,n]}async invoke(e,t){const n=OA._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===OA.prototype._streamResponseChunks)yield this.invoke(e,t);else{const n=OA._convertInputToPromptValue(e).toChatMessages(),[r,i]=this._separateRunnableConfigFromCallOptions(t),s=await W_.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),a={options:i,invocation_params:this?.invocationParams(i),batch_size:1},o=await(s?.handleChatModelStart(this.toJSON(),[n],r.runId,void 0,a,void 0,void 0,r.runName));let l;try{for await(const e of this._streamResponseChunks(n,i,o?.[0]))e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},yield e.message,l=l?l.concat(e):e}catch(e){throw await Promise.all((o??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((o??[]).map((e=>e?.handleLLMEnd({generations:[[l]]}))))}}async _generateUncached(e,t,n){const r=e.map((e=>e.map(Mv))),i=await W_.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),s={options:t,invocation_params:this?.invocationParams(t),batch_size:1},a=await(i?.handleChatModelStart(this.toJSON(),r,n.runId,void 0,s,void 0,void 0,n.runName)),o=await Promise.allSettled(r.map(((e,n)=>this._generate(e,{...t,promptIndex:n},a?.[n])))),l=[],c=[];await Promise.all(o.map((async(e,t)=>{if("fulfilled"===e.status){const n=e.value;for(const e of n.generations)e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};return 1===n.generations.length&&(n.generations[0].message.response_metadata={...n.llmOutput,...n.generations[0].message.response_metadata}),l[t]=n.generations,c[t]=n.llmOutput,a?.[t]?.handleLLMEnd({generations:[n.generations],llmOutput:n.llmOutput})}return await(a?.[t]?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const u={generations:l,llmOutput:c.length?this._combineLLMOutput?.(...c):void 0};return Object.defineProperty(u,Bv,{value:a?{runIds:a?.map((e=>e.runId))}:void 0,configurable:!0}),u}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:r,handledOptions:i}){const s=e.map((e=>e.map(Mv))),a=await W_.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o={options:r,invocation_params:this?.invocationParams(r),batch_size:1,cached:!0},l=await(a?.handleChatModelStart(this.toJSON(),s,i.runId,void 0,o,void 0,void 0,i.runName)),c=[],u=await Promise.allSettled(s.map((async(e,r)=>{const i=OA._convertInputToPromptValue(e).toString(),s=await t.lookup(i,n);return null==s&&c.push(r),s}))),h=u.map(((e,t)=>({result:e,runManager:l?.[t]}))).filter((({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status)),d=[];await Promise.all(h.map((async({result:e,runManager:t},n)=>{if("fulfilled"===e.status){const r=e.value;return d[n]=r,r.length&&await(t?.handleLLMNewToken(r[0].text)),t?.handleLLMEnd({generations:[r]})}return await(t?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const p={generations:d,missingPromptIndices:c};return Object.defineProperty(p,Bv,{value:l?{runIds:l?.map((e=>e.runId))}:void 0,configurable:!0}),p}async generate(e,t,n){let r;r=Array.isArray(t)?{stop:t}:t;const i=e.map((e=>e.map(Mv))),[s,a]=this._separateRunnableConfigFromCallOptions(r);if(s.callbacks=s.callbacks??n,!this.cache)return this._generateUncached(i,a,s);const{cache:o}=this,l=this._getSerializedCacheKeyParametersForCall(a),{generations:c,missingPromptIndices:u}=await this._generateCached({messages:i,cache:o,llmStringKey:l,parsedOptions:a,handledOptions:s});let h={};if(u.length>0){const e=await this._generateUncached(u.map((e=>i[e])),a,s);await Promise.all(e.generations.map((async(e,t)=>{const n=u[t];c[n]=e;const r=OA._convertInputToPromptValue(i[n]).toString();return o.update(r,l,e)}))),h=e.llmOutput??{}}return{generations:c,llmOutput:h}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const r=e.map((e=>e.toChatMessages()));return this.generate(r,t,n)}async call(e,t,n){return(await this.generate([e.map(Mv)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const r=e.toChatMessages();return this.call(r,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const r=new Dv(e),i=await this.call([r],t,n);if("string"!=typeof i.content)throw new Error("Cannot use predict when output is not a string.");return i.content}}function SA(e){return{name:e.name,description:e.description,parameters:cA(e.schema)}}function NA(e){return function(e){return void 0!==e&&Array.isArray(e.lc_namespace)}(e)?{type:"function",function:SA(e)}:e}class jA extends yA{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=jk(t);return this.func&&await this.func(e,n),this._callWithConfig((e=>Promise.resolve(e)),e,n)}async*transform(e,t){const n=jk(t);let r,i=!0;for await(const t of this._transformStreamWithConfig(e,(e=>e),n))if(yield t,i)if(void 0===r)r=t;else try{r=_k(r,t)}catch{r=void 0,i=!1}this.func&&void 0!==r&&await this.func(r,n)}static assign(e){return new EA(new kA({steps:e}))}}class DA extends yA{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return"string"==typeof e.content?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return"string"==typeof e?this._callWithConfig((async(e,t)=>this.parseResult([{text:e}],t?.callbacks)),e,{...t,runType:"parser"}):this._callWithConfig((async(e,t)=>this.parseResult([{message:e,text:this._baseMessageToString(e)}],t?.callbacks)),e,{...t,runType:"parser"})}}class RA extends DA{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class $A extends Error{constructor(e,t,n,r=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=r,r&&(void 0===n||void 0===t))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}function LA(e,t){const n=typeof e;if(n!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(!LA(e[r],t[r]))return!1;return!0}if("object"===n){if(!e||!t)return e===t;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const r of n)if(!LA(e[r],t[r]))return!1;return!0}return e===t}"undefined"!=typeof self&&self.location&&"null"!==self.location.origin&&(self.location.origin,self.location.pathname,location.search);const MA=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function FA(e){return e.test.bind(e)}(function(e,t){const n=t.match(MA);if(!n)return!1;const r=+n[1],i=+n[2],s=+n[3],a=!!n[5];return(r<=23&&i<=59&&s<=59||23==r&&59==i&&60==s)&&(!e||a)}).bind(void 0,!1),FA(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),FA(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),FA(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),FA(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),FA(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),FA(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),FA(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),FA(/^(?:\/(?:[^~/]|~0|~1)*)*$/),FA(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),FA(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/);class UA extends RA{async*_transform(e){for await(const t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class BA extends UA{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let t,n;for await(const i of e){if("string"!=typeof i&&"string"!=typeof i.content)throw new Error("Cannot handle non-string output.");let e;if(xv(r=i)&&"function"==typeof r.concat){if("string"!=typeof i.content)throw new Error("Cannot handle non-string message output.");e=new zv({message:i,text:i.content})}else if(xv(i)){if("string"!=typeof i.content)throw new Error("Cannot handle non-string message output.");e=new zv({message:Uv(i),text:i.content})}else e=new Vv({text:i});n=void 0===n?e:n.concat(e);const s=await this.parsePartialResult([n]);null==s||LA(s,t)||(this.diff?yield this._diff(t,s):yield s,t=s)}var r}}class VA extends RA{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(e_(Object.fromEntries(Object.entries(e).map((([e,t])=>[e,Jw().describe(t)])))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.\n\n"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.\n\nFor example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}\nwould match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.\nThus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.\n\nYour output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!\n\nHere is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:\n\`\`\`json\n${JSON.stringify(cA(this.schema))}\n\`\`\`\n`}async parse(e){try{const t=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,((e,t)=>`"${t.replace(/\n/g,"\\n")}"`)).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(t))}catch(t){throw new $A(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class zA extends BA{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?vk(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return pv(e[0].text)}async parse(e){return pv(e,JSON.parse)}getFormatInstructions(){return""}}function HA(e,t){if(void 0===e.function)return;let n;if(t?.partial)try{n=fv(e.function.arguments??"{}")}catch(e){return}else try{n=JSON.parse(e.function.arguments)}catch(t){throw new $A([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"","are not valid JSON.",`Error: ${t.message}`].join("\n"))}const r={name:e.function.name,args:n};return t?.returnId&&(r.id=e.id),r}function GA(e){if(void 0===e.id)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}function qA(e,t){return{name:e.function?.name,args:e.function?.arguments,id:e.id,error:t}}class KA extends DA{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}async parseResult(e){const t=e[0].message.additional_kwargs.tool_calls;if(!t)throw new Error(`No tools_call in message ${JSON.stringify(e)}`);const n=JSON.parse(JSON.stringify(t)),r=[];for(const e of n){const t=HA(e,{partial:!0});if(void 0!==t){const e={type:t.name,args:t.args,id:t.id};Object.defineProperty(e,"name",{get(){return this.type}}),Object.defineProperty(e,"arguments",{get(){return this.args}}),r.push(e)}}return r}}class WA extends DA{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.initialParser=new KA(e),this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new $A(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){const t=(await this.initialParser.parseResult(e)).filter((e=>e.type===this.keyName));let n=t;if(this.returnId||(n=t.map((e=>e.args))),this.returnSingle)return this._validateResult(n[0]);const r=await Promise.all(n.map((e=>this._validateResult(e))));return r}}function JA(e,t){const n=[];for(const[r,i]of Object.entries(e.properties??{}))i.description&&t<2&&n.push(`// ${i.description}`),e.required?.includes(r)?n.push(`${r}: ${ZA(i,t)},`):n.push(`${r}?: ${ZA(i,t)},`);return n.map((e=>" ".repeat(t)+e)).join("\n")}function ZA(e,t){if(function(e){return void 0!==e.anyOf&&Array.isArray(e.anyOf)}(e))return e.anyOf.map((e=>ZA(e,t))).join(" | ");switch(e.type){case"string":return e.enum?e.enum.map((e=>`"${e}"`)).join(" | "):"string";case"number":case"integer":return e.enum?e.enum.map((e=>`${e}`)).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",JA(e,t+2),"}"].join("\n");case"array":return e.items?`${ZA(e.items,t)}[]`:"any[]";default:return""}}function QA(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!Sv.isInstance(e))throw new Error("Invalid generic chat message");return function(e){return"system"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role}(e);default:throw new Error(`Unknown message type: ${t}`)}}function XA(e){const t=e.tool_calls;if("assistant"===e.role){const n=[],r=[];for(const e of t??[])try{n.push(HA(e,{returnId:!0}))}catch(t){r.push(qA(e,t.message))}return new Cv({content:e.content||"",tool_calls:n,invalid_tool_calls:r,additional_kwargs:{function_call:e.function_call,tool_calls:t}})}return new Sv(e.content||"",e.role??"unknown")}function YA(e,t){const n=e.role??t,r=e.content??"";let i;if(i=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},"user"===n)return new Rv({content:r});if("assistant"===n){const t=[];if(Array.isArray(e.tool_calls))for(const n of e.tool_calls)t.push({name:n.function?.name,args:n.function?.arguments,id:n.id,index:n.index});return new Ov({content:r,tool_call_chunks:t,additional_kwargs:i})}return"system"===n?new Lv({content:r}):"function"===n?new jv({content:r,additional_kwargs:i,name:e.name}):"tool"===n?new Iv({content:r,additional_kwargs:i,tool_call_id:e.tool_call_id}):new Nv({content:r,role:n})}function eP(e){return e.map((e=>{const t={role:QA(e),content:e.content};return null!=e.name&&(t.name=e.name),null!=e.additional_kwargs.function_call&&(t.function_call=e.additional_kwargs.function_call),function(e){return"ai"===e._getType()}(e)&&e.tool_calls?.length?t.tool_calls=e.tool_calls.map(GA):(null!=e.additional_kwargs.tool_calls&&(t.tool_calls=e.additional_kwargs.tool_calls),null!=e.tool_call_id&&(t.tool_call_id=e.tool_call_id)),t}))}class tP extends OA{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??Kv("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=e?.azureOpenAIApiKey??Kv("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.apiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??Kv("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??Kv("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??Kv("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??Kv("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??Kv("OPENAI_ORGANIZATION"),this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}bindTools(e,t){return this.bind({tools:e.map(NA),...t})}invocationParams(e){return{model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:function(e){return void 0!==e&&e.every((e=>Array.isArray(e.lc_namespace)))}(e?.tools)?e?.tools.map(NA):e?.tools,tool_choice:e?.tool_choice,response_format:e?.response_format,seed:e?.seed,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){const r=eP(e),i={...this.invocationParams(t),messages:r,stream:!0};let s;const a=await this.completionWithRetry(i,t);for await(const e of a){const r=e?.choices[0];if(!r)continue;const{delta:i}=r;if(!i)continue;const a=YA(i,s);s=i.role??s;const o={prompt:t.promptIndex??0,completion:r.index??0};if("string"!=typeof a.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const l={...o};void 0!==r.finish_reason&&(l.finish_reason=r.finish_reason),this.logprobs&&(l.logprobs=r.logprobs);const c=new zv({message:a,text:a.content,generationInfo:l});yield c,n?.handleLLMNewToken(c.text??"",o,void 0,void 0,void 0,{chunk:c})}if(t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,n){const r={},i=this.invocationParams(t),s=eP(e);if(i.stream){const i=this._streamResponseChunks(e,t,n),s={};for await(const e of i){e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};const t=e.generationInfo?.completion??0;void 0===s[t]?s[t]=e:s[t]=s[t].concat(e)}const a=Object.entries(s).sort((([e],[t])=>parseInt(e,10)-parseInt(t,10))).map((([e,t])=>t)),{functions:o,function_call:l}=this.invocationParams(t),c=await this.getEstimatedTokenCountFromPrompt(e,o,l),u=await this.getNumTokensFromGenerations(a);return r.promptTokens=c,r.completionTokens=u,r.totalTokens=c+u,{generations:a,llmOutput:{estimatedTokenUsage:r}}}{const e=await this.completionWithRetry({...i,stream:!1,messages:s},{signal:t?.signal,...t?.options}),{completion_tokens:n,prompt_tokens:a,total_tokens:o}=e?.usage??{};n&&(r.completionTokens=(r.completionTokens??0)+n),a&&(r.promptTokens=(r.promptTokens??0)+a),o&&(r.totalTokens=(r.totalTokens??0)+o);const l=[];for(const t of e?.choices??[]){const e={text:t.message?.content??"",message:XA(t.message??{role:"assistant"})};e.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},l.push(e)}return{generations:l,llmOutput:{tokenUsage:r}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let r=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==n){const e=function(e){const t=["namespace functions {",""];for(const n of e)n.description&&t.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(t.push(`type ${n.name} = (_: {`),t.push(JA(n.parameters,0)),t.push("}) => any;")):t.push(`type ${n.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}(t);r+=await this.getNumTokens(e),r+=9}return t&&e.find((e=>"system"===e._getType()))&&(r-=4),"none"===n?r+=1:"object"==typeof n&&(r+=await this.getNumTokens(n.name)+4),r}async getNumTokensFromGenerations(e){return(await Promise.all(e.map((async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content))))).reduce(((e,t)=>e+t),0)}async getNumTokensFromMessages(e){let t=0,n=0,r=0;"gpt-3.5-turbo-0301"===this.model?(n=4,r=-1):(n=3,r=1);const i=await Promise.all(e.map((async e=>{const i=await this.getNumTokens(e.content),s=await this.getNumTokens(QA(e)),a=void 0!==e.name?r+await this.getNumTokens(e.name):0;let o=i+n+s+a;const l=e;if("function"===l._getType()&&(o-=2),l.additional_kwargs?.function_call&&(o+=3),l?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(l.additional_kwargs.function_call?.name)),l.additional_kwargs.function_call?.arguments)try{o+=await this.getNumTokens(JSON.stringify(JSON.parse(l.additional_kwargs.function_call?.arguments)))}catch(e){console.error("Error parsing function arguments",e,JSON.stringify(l.additional_kwargs.function_call)),o+=await this.getNumTokens(l.additional_kwargs.function_call?.arguments)}return t+=o,o})));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call((async()=>{try{return await this.client.chat.completions.create(e,n)}catch(e){throw function(e){let t;return e.constructor.name===Kp.name?(t=new Error(e.message),t.name="TimeoutError"):e.constructor.name===Gp.name?(t=new Error(e.message),t.name="AbortError"):t=e,t}(e)}}))}_getClientOptions(e){if(!this.client){const e=function(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:i,baseURL:s}=e;if(r&&i&&t)return`${i}/${t}`;if(r){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${t}`}return s}({azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new hv(t)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce(((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e)),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,r,i,s,a,o;if(function(e){return void 0!==e&&"object"==typeof e.schema}(e)?(n=e.schema,r=e.name,i=e.method,s=e.includeRaw):(n=e,r=t?.name,i=t?.method,s=t?.includeRaw),"jsonMode"===i)a=this.bind({response_format:{type:"json_object"}}),o=nP(n)?VA.fromZodSchema(n):new zA;else{let e=r??"extract";if(nP(n)){const t=cA(n);a=this.bind({tools:[{type:"function",function:{name:e,description:t.description,parameters:t}}],tool_choice:{type:"function",function:{name:e}}}),o=new WA({returnSingle:!0,keyName:e,zodSchema:n})}else{let t;"string"==typeof n.name&&"object"==typeof n.parameters&&null!=n.parameters?(t=n,e=n.name):(e=n.title??e,t={name:e,description:n.description??"",parameters:n}),a=this.bind({tools:[{type:"function",function:t}],tool_choice:{type:"function",function:{name:e}}}),o=new WA({returnSingle:!0,keyName:e})}}if(!s)return a.pipe(o);const l=jA.assign({parsed:(e,t)=>o.invoke(e.raw,t)}),c=jA.assign({parsed:()=>null}),u=l.withFallbacks({fallbacks:[c]});return _A.from([{raw:a},u])}}function nP(e){return"function"==typeof e?.parse}class rP extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}class iP extends IA{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(e,t){return this.call(e,jk(t))}async call(e,t,n){let r;try{r=await this.schema.parseAsync(e)}catch(t){throw new rP("Received tool input did not match expected schema",JSON.stringify(e))}const i=function(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}(t),s=await W_.configure(i.callbacks,this.callbacks,i.tags||n,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),a=await(s?.handleToolStart(this.toJSON(),"string"==typeof r?r:JSON.stringify(r),i.runId,void 0,void 0,void 0,i.runName));let o;delete i.runId;try{o=await this._call(r,a,i)}catch(e){throw await(a?.handleToolError(e)),e}return await(a?.handleToolEnd(o)),o}}class sP extends iP{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e_({input:Jw().optional()}).transform((e=>e.input))})}call(e,t){return super.call("string"!=typeof e&&e?e:{input:e},t)}}function aP(){return new tP({})}Object.defineProperty(class extends sP{static lc_name(){return"DallEAPIWrapper"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t={apiKey:e?.apiKey??e?.openAIApiKey??Kv("OPENAI_API_KEY"),organization:e?.organization??Kv("OPENAI_ORGANIZATION"),dangerouslyAllowBrowser:!0};this.client=new hv(t),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.responseFormat=e?.responseFormat??this.responseFormat,this.user=e?.user}async _call(e){const t=await this.client.images.generate({model:this.model,prompt:e,n:this.n,size:this.size,response_format:this.responseFormat,style:this.style,quality:this.quality,user:this.user});let n="";return"url"===this.responseFormat?[n]=t.data.map((e=>e.url)).filter((e=>"undefined"!==e)):[n]=t.data.map((e=>e.b64_json)).filter((e=>"undefined"!==e)),n}},"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});const oP=_t({id:"dgen"});function lP(){return function(){if($d()){oP("running openai in browser");let e=localStorage.OAAK;if(e)return new hv({apiKey:e,dangerouslyAllowBrowser:!0});{let e="The OAAK localStorage variable is missing, please set it to proceed";throw window.alert(e),e}}return oP("running openai NOT in browser"),new hv}()}async function cP(e){oP(`Using prompt: ${e}`),Nd("prompt",e),oP("Requesting chat completion");const t=await lP().chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:e}]});oP("Accesing chat response...");let n=t.choices[0].message.content;Nd("data_str",n),oP(`String= ${n}`),oP("Cleaning string");let r=pP(n);Nd("cleaned_str",r),oP("Attempting parse");let i=JSON.parse(r);return Nd("data",i),oP('Successfully parsed json data, available from debug.get("data")'),i}async function uP(e){const t=`Given the following text: "${e}", generate  (in JSON format) a random FHIR R4 Patient (with attributes such as name, gender, birthDate, and address) as well as a random set of 10 fhir resources (Observations, DiagnosticReports, DocumentReferences, etc) that match that patient's profile. Do not return anything other than the JSON string\n\n        It is absolutely ESSENTIAL THAT YOU RETURN THE RESULT AS A JSON OBJECT that represents a FHIR bundle and with the first character of output as "{" and the last character as "}". \n\n\n`;return await cP(t)}async function hP(e){try{const t=await uP(e);return oP(`Generated FHIR Patient data: ${JSON.stringify(t,null,2)}`),t}catch(e){console.error("Error generating FHIR data:",e)}}async function dP(e){try{const t=`Generate a set of loinc codes in JSON format (only output the json string, nothing else) which can be used to represent the following free text: ${e} . \n\n        It is absolutely ESSENTIAL THAT YOU RETURN THE RESULT AS A JSON ARRAY OF LOINC OBECTS with the first character of output as "[" and the last character as "]". \n\n  `,n=await cP(t);return oP("Received the following loinc objects"),console.log(n),n}catch(e){console.error("Error:",e)}}function pP(e){return(e=(e=(e=e.replace(/\\n/g,"").replace(/\\"/g,'"')).replace(/\n/g,"")).replace("```json","")).replace("```","")}function fP(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function mP(e,t,n,r,i){e[t]=n,fP(e,t,r,i)}function gP(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map(((n,r)=>gP(e,t,n)))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return yP(e,t)}}const yP=(e,t)=>{const n={type:"integer",format:"unix-time"};if("openApi3"===t.target)return n;for(const r of e.checks)switch(r.kind){case"min":mP(n,"minimum",r.value,r.message,t);break;case"max":mP(n,"maximum",r.value,r.message,t)}return n};let vP;const bP={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===vP&&(vP=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),vP),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function wP(e,t){const n={type:"string"};function r(e){return"escape"===t.patternStrategy?_P(e):e}if(e.checks)for(const i of e.checks)switch(i.kind){case"min":mP(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,i.value):i.value,i.message,t);break;case"max":mP(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":kP(n,"email",i.message,t);break;case"format:idn-email":kP(n,"idn-email",i.message,t);break;case"pattern:zod":AP(n,bP.email,i.message,t)}break;case"url":kP(n,"uri",i.message,t);break;case"uuid":kP(n,"uuid",i.message,t);break;case"regex":AP(n,i.regex,i.message,t);break;case"cuid":AP(n,bP.cuid,i.message,t);break;case"cuid2":AP(n,bP.cuid2,i.message,t);break;case"startsWith":AP(n,RegExp(`^${r(i.value)}`),i.message,t);break;case"endsWith":AP(n,RegExp(`${r(i.value)}$`),i.message,t);break;case"datetime":kP(n,"date-time",i.message,t);break;case"date":kP(n,"date",i.message,t);break;case"time":kP(n,"time",i.message,t);break;case"duration":kP(n,"duration",i.message,t);break;case"length":mP(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,i.value):i.value,i.message,t),mP(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,i.value):i.value,i.message,t);break;case"includes":AP(n,RegExp(r(i.value)),i.message,t);break;case"ip":"v6"!==i.version&&kP(n,"ipv4",i.message,t),"v4"!==i.version&&kP(n,"ipv6",i.message,t);break;case"emoji":AP(n,bP.emoji,i.message,t);break;case"ulid":AP(n,bP.ulid,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":kP(n,"binary",i.message,t);break;case"contentEncoding:base64":mP(n,"contentEncoding","base64",i.message,t);break;case"pattern:zod":AP(n,bP.base64,i.message,t)}break;case"nanoid":AP(n,bP.nanoid,i.message,t)}return n}const _P=e=>Array.from(e).map((e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`)).join(""),kP=(e,t,n,r)=>{e.format||e.anyOf?.some((e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):mP(e,"format",t,n,r)},AP=(e,t,n,r)=>{e.pattern||e.allOf?.some((e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:PP(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):mP(e,"pattern",PP(t,r),n,r)},PP=(e,t)=>{const n="function"==typeof e?e():e;if(!t.applyRegexFlags||!n.flags)return n.source;const r=n.flags.includes("i"),i=n.flags.includes("m"),s=n.flags.includes("s"),a=r?n.source.toLowerCase():n.source;let o="",l=!1,c=!1,u=!1;for(let e=0;e<a.length;e++)if(l)o+=a[e],l=!1;else{if(r)if(c){if(a[e].match(/[a-z]/)){u?(o+=a[e],o+=`${a[e-2]}-${a[e]}`.toUpperCase(),u=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(o+=a[e],u=!0):o+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){o+=`[${a[e]}${a[e].toUpperCase()}]`;continue}if(i){if("^"===a[e]){o+="(^|(?<=[\r\n]))";continue}if("$"===a[e]){o+="($|(?=[\r\n]))";continue}}s&&"."===a[e]?o+=c?`${a[e]}\r\n`:`[${a[e]}\r\n]`:(o+=a[e],"\\"===a[e]?l=!0:c&&"]"===a[e]?c=!1:c||"["!==a[e]||(c=!0))}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return o};function TP(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===Ww.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((n,r)=>({...n,[r]:SP(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??{}})),{}),additionalProperties:!1};const n={type:"object",additionalProperties:SP(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return n;if(e.keyType?._def.typeName===Ww.ZodString&&e.keyType._def.checks?.length){const r=Object.entries(wP(e.keyType._def,t)).reduce(((e,[t,n])=>"type"===t?e:{...e,[t]:n}),{});return{...n,propertyNames:r}}return e.keyType?._def.typeName===Ww.ZodEnum?{...n,propertyNames:{enum:e.keyType._def.values}}:n}const EP={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},xP=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,n)=>SP(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]}))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return n.length?{anyOf:n}:void 0};function IP(e,t){return"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:SP(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:SP(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}const CP=Symbol("Let zodToJsonSchema decide on which parser to use"),OP={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function SP(e,t,n=!1){const r=t.seen.get(e);if(t.override){const i=t.override?.(e,t,r,n);if(i!==CP)return i}if(r&&!n){const e=NP(r,t);if(void 0!==e)return"$ref"in e&&t.seenRefs.add(e.$ref),e}const i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);const s=DP(e,e.typeName,t,n);return s&&RP(e,t,s),i.jsonSchema=s,s}const NP=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":const n=e.path.slice(t.basePath.length+1).join("_");return n!==t.name&&"duplicate-ref"===t.nameStrategy&&(t.definitions[n]=e.def),{$ref:[...t.basePath,t.definitionPath,n].join("/")};case"relative":return{$ref:jP(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,n)=>t.currentPath[n]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},jP=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},DP=(e,t,n,r)=>{switch(t){case Ww.ZodString:return wP(e,n);case Ww.ZodNumber:return function(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",fP(n,"type",r.message,t);break;case"min":"jsonSchema7"===t.target?r.inclusive?mP(n,"minimum",r.value,r.message,t):mP(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),mP(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?mP(n,"maximum",r.value,r.message,t):mP(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),mP(n,"maximum",r.value,r.message,t));break;case"multipleOf":mP(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case Ww.ZodObject:return function(e,t){const n={type:"object",...Object.entries(e.shape()).reduce(((e,[n,r])=>{if(void 0===r||void 0===r._def)return e;const i=[...t.currentPath,"properties",n],s=SP(r._def,{...t,currentPath:i,propertyPath:i});return void 0===s?e:(t.openaiStrictMode&&r.isOptional()&&!r.isNullable()&&console.warn(`Zod field at \`${i.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required\nThis will become an error in a future version of the SDK.`),{properties:{...e.properties,[n]:s},required:r.isOptional()&&!t.openaiStrictMode?e.required:[...e.required,n]})}),{properties:{},required:[]}),additionalProperties:IP(e,t)};return n.required.length||delete n.required,n}(e,n);case Ww.ZodBigInt:return function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":"jsonSchema7"===t.target?r.inclusive?mP(n,"minimum",r.value,r.message,t):mP(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),mP(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?mP(n,"maximum",r.value,r.message,t):mP(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),mP(n,"maximum",r.value,r.message,t));break;case"multipleOf":mP(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case Ww.ZodBoolean:return{type:"boolean"};case Ww.ZodDate:return gP(e,n);case Ww.ZodUndefined:return{not:{}};case Ww.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(n);case Ww.ZodArray:return function(e,t){const n={type:"array"};return e.type?._def?.typeName!==Ww.ZodAny&&(n.items=SP(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&mP(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&mP(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(mP(n,"minItems",e.exactLength.value,e.exactLength.message,t),mP(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}(e,n);case Ww.ZodUnion:case Ww.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return xP(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every((e=>e._def.typeName in EP&&(!e._def.checks||!e._def.checks.length)))){const e=n.reduce(((e,t)=>{const n=EP[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e}),[]);return{type:e.length>1?e:e[0]}}if(n.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=n.reduce(((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===n.length){const t=e.filter(((e,t,n)=>n.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:n.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(n.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:n.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return xP(e,t)}(e,n);case Ww.ZodIntersection:return function(e,t){const n=[SP(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),SP(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter((e=>!!e));let r="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const i=[];return n.forEach((e=>{if((e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e)(e))i.push(...e.allOf),void 0===e.unevaluatedProperties&&(r=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...r}=e;t=r}else r=void 0;i.push(t)}})),i.length?{allOf:i,...r}:void 0}(e,n);case Ww.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,n)=>SP(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:SP(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,n)=>SP(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}(e,n);case Ww.ZodRecord:return TP(e,n);case Ww.ZodLiteral:return function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}(e,n);case Ww.ZodEnum:return function(e){return{type:"string",enum:[...e.values]}}(e);case Ww.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),r=Array.from(new Set(n.map((e=>typeof e))));return{type:1===r.length?"string"===r[0]?"string":"number":["string","number"],enum:n}}(e);case Ww.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target||"property"===t.nullableStrategy?{type:EP[e.innerType._def.typeName],nullable:!0}:{type:[EP[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=SP(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=SP(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case Ww.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return SP(e.innerType._def,t);const n=SP(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}})(e,n);case Ww.ZodMap:return function(e,t){return"record"===t.mapStrategy?TP(e,t):{type:"array",maxItems:125,items:{type:"array",items:[SP(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},SP(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,n);case Ww.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:SP(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&mP(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&mP(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}(e,n);case Ww.ZodLazy:return SP(e.getter()._def,n);case Ww.ZodPromise:return function(e,t){return SP(e.type._def,t)}(e,n);case Ww.ZodNaN:case Ww.ZodNever:return{not:{}};case Ww.ZodEffects:return function(e,t,n){return"input"===t.effectStrategy?SP(e.schema._def,t,n):{}}(e,n,r);case Ww.ZodAny:case Ww.ZodUnknown:return{};case Ww.ZodDefault:return function(e,t){return{...SP(e.innerType._def,t),default:e.defaultValue()}}(e,n);case Ww.ZodBranded:return function(e,t){return SP(e.type._def,t)}(e,n);case Ww.ZodReadonly:case Ww.ZodCatch:return((e,t)=>SP(e.innerType._def,t))(e,n);case Ww.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return SP(e.in._def,t);if("output"===t.pipeStrategy)return SP(e.out._def,t);const n=SP(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,SP(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter((e=>void 0!==e))}})(e,n);case Ww.ZodFunction:case Ww.ZodVoid:case Ww.ZodSymbol:default:return}},RP=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),$P=e=>"_def"in e?e._def:e,LP=(e,t)=>{const n=(e=>{const t=(e=>"string"==typeof e?{...OP,basePath:["#"],definitions:{},name:e}:{...OP,basePath:["#"],definitions:{},...e})(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(t.definitions).map((([e,n])=>[$P(n),{def:$P(n),path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))}})(t),r="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,i=SP(e._def,void 0===r?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1)??{},s="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==s&&(i.title=s);const a=(()=>{if(function(e){if(!e)return!0;for(const t in e)return!1;return!0}(n.definitions))return;const e={},t=new Set;for(let r=0;r<500;r++){const r=Object.entries(n.definitions).filter((([e])=>!t.has(e)));if(0===r.length)break;for(const[i,s]of r)e[i]=SP($P(s),{...n,currentPath:[...n.basePath,n.definitionPath,i]},!0)??{},t.add(i)}return e})(),o=void 0===r?a?{...i,[n.definitionPath]:a}:i:"duplicate-ref"===n.nameStrategy?{...i,...a||n.seenRefs.size?{[n.definitionPath]:{...a,...n.seenRefs.size?{[r]:i}:void 0}}:void 0}:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...a,[r]:i}};return"jsonSchema7"===n.target?o.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===n.target&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function MP(e,t){return LP(e,{openaiStrictMode:!0,name:t.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function FP(e,t,n){return function(e,t){const n={...e};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),n}({type:"json_schema",json_schema:{...n,name:t,strict:!0,schema:MP(e,{name:t})}},(t=>e.parse(JSON.parse(t))))}const UP=_t({id:"oai"});function BP(){return function(){if($d()){UP("running openai in browser");let e=localStorage.OAAK;if(e)return new hv({apiKey:e,dangerouslyAllowBrowser:!0});{let e="The OAAK localStorage variable is missing, please set it to proceed";throw window.alert(e),e}}return UP("running openai NOT in browser"),new hv}()}async function VP(){}async function zP(){let e=e_({name:Jw(),balance:Zw()}),t=Yw(e),n=FP(e_({rooms:Yw(t)}),"zr");return await HP({prompt:"Randomly Generate 3 separate Rooms with 3 unique users per room and return all results as json. Make the user balance in each room add to 1000",zrf:n})}async function HP(e){var t;let n=BP();UP("Generating structured json query"),UP("Requesting chat completion");const r=null===(t=(await n.beta.chat.completions.parse(e)).choices[0])||void 0===t?void 0:t.message;return(null==r?void 0:r.parsed)?(UP("Successfully parsed the message"),r.parsed):(UP("Failed to parse response"),UP(r),null)}async function GP(e,t){try{let n=BP();return(await n.embeddings.create({input:e,model:"text-embedding-3-large",dimensions:t})).data[0].embedding}catch(e){throw console.error("Error fetching embedding:",e),e}}var qP="\n";const KP="{patientInformation}",WP="{supplementaryInformation}";var JP=` \nYou are an expert clinical decision support pharmacist that identifies medications within a patient patientInformationn text and providesextracts the medications along with supplemental data in structured format.  \n\n<patientInformation> \n${KP} \n</patientInformation> \n\nYour json output consists of an array of medication objects. \nEach objects contains the fields: name, medication_class, intended_effects, adverse_effects , interacts_with_medication , interacts_with_class. \nname is the name of the medication. \nmedication_class is the medication's class or pharmacologic category \nintended_effects is a list of the intended effect of the medication. \nadverse_effects is a list of the most common adverse effects of the medication.\ninteracts_with_medication is a short list of the medications which can interact with this medication to create a dangerous effect. \ninteracts_with_class is a short list of the medication classes which can interact with this medication to create a dangerous effect.  \n\nDo not guess or extrapolate. \n`;let ZP=e_({name:Jw(),medication_class:Jw(),intended_effects:Yw(Jw()),adverse_effects:Yw(Jw()),interacts_with_medication:Yw(Jw()),interacts_with_class:Yw(Jw())});var QP=FP(e_({data:Yw(ZP)}),"medication_extraction"),XP={prompt:JP,rf:QP},YP=`\nYou are an expert clinical decision support pharmacist that provides unique and valuable feedback to the user. \nYou focus on identifying medication adverse effects and interactions that should be noted.\nCarefully consider this patient and supplementary information:\n\n<patientInformation> \n${KP}\n</patientInformation> \n\n<supplementaryInformation> \n${WP}\n</supplementaryInformation> \n\nProvide a list of recommendations for the user in the following format:\n\nThe json output consists of an array of recommendation objects. \nEach object contains the fields: action, data, reasoning, caveat. \naction is one of the following: start, stop, increase, decrease \ndata is the name of the medication \nreasoning is a concise explanation of your thought process \ncaveat is additional information that should be taken into consideration, or an alternative viewpoint \n\nDo not recommend actions that that the user is already taking. \n`,eT=`\nYou are an expert clinical decision support pharmacist that provides unique and valuable feedback to the user. \nYou focus on identifying medication adverse effects and interactions that should be noted.\nCarefully consider this patient and supplementary information:\n\n<patientInformation> \n${KP}\n</patientInformation> \n\nProvide a list of recommendations for the user in the following format:\n\nThe json output consists of an array of recommendation objects. \nEach object contains the fields: action, data, reasoning, caveat. \naction is one of the following: start, stop, increase, decrease \ndata is the name of the medication \nreasoning is a concise explanation of your thought process \ncaveat is additional information that should be taken into consideration, or an alternative viewpoint \n\nDo not recommend actions that that the user is already taking. \n`;let tT=e_({action:Jw(),data:Jw(),reasoning:Jw(),caveat:Jw()});var nT=FP(e_({data:Yw(tT)}),"medication_extraction"),rT={prompt:YP,rf:nT},iT={prompt:eT,rf:nT},sT="\n",aT="esrd_hyperkalemia_losartan",oT="This test case describes a patient with ESRD on HD and HTN that is admitted with hyperkalemia. The plan states to continue losartan however it should be identified that losartan should be held in order to prevent further episodes of hyperkalemia",lT="\n# History and Physical\n\n## Chief Complaint\nHyperkalemia and hypertension\n\n## One-liner\nA 46-year-old male with end-stage renal disease (ESRD) on hemodialysis (HD) presents with hyperkalemia and hypertension.\n\n## History of Present Illness\nThe patient is a 46-year-old male with a known history of end-stage renal disease on thrice-weekly hemodialysis who presents to the emergency department with laboratory-confirmed hyperkalemia. He reports that he missed his last dialysis session three days ago due to transportation issues, and since then, he has experienced intermittent palpitations and mild fatigue but denies any chest pain, shortness of breath, muscle weakness, or sensory changes. The patient also reports poorly controlled blood pressure over the past week despite adherence to his home antihypertensive regimen. He denies any recent dietary indiscretions or changes in liquid intake. No recent episodes of fever, cough, or diarrhea. \n\n## Emergency Department Course\nUpon presentation, the patient's vital signs were as follows: blood pressure 178/96 mmHg, heart rate 88 bpm, respiratory rate 18 breaths/min, temperature 98.4°F, and oxygen saturation 96% on room air. Laboratory tests revealed a serum potassium level of 6.8 mmol/L, elevated blood urea nitrogen (BUN) at 60 mg/dL, and creatinine at 9.5 mg/dL, consistent with ESRD. An EKG showed peaked T waves suggestive of hyperkalemia but no arrhythmias were present. The patient was given calcium gluconate 10% intravenously to stabilize cardiac membranes, insulin with dextrose for shifting potassium intracellularly, and received his scheduled dialysis session to remove excess potassium. Additionally, he was given furosemide to aid in the management of blood pressure and hyperkalemia.\n\n## Medications\n- Amlodipine 10 mg daily\n- Hydrochlorothiazide 25 mg daily\n- Losartan 50 mg daily\n\n## Allergies\nNo known drug allergies\n\n## Past Surgical History\nNone\n\n## Social History\nThe patient is a former smoker, quitting 5 years ago, and denies any illicit drug use. He occasionally consumes alcohol but denies drinking in the past month. He lives alone in an apartment and relies on public transportation.\n\n## Objective Data\n- **Vital Signs:** Blood Pressure: 150/94 mmHg, Heart Rate: 82 bpm, Respiratory Rate: 18 breaths/min, Temperature: 98.4°F, O2 Saturation: 96% on room air.\n- **Physical Exam:**\n  - **General:** The patient appears alert, oriented, and in no acute distress.\n  - **Cardiovascular:** Regular rate and rhythm, no murmurs, rubs, or gallops.\n  - **Respiratory:** Breath sounds clear bilaterally, no wheezes, rales, or rhonchi.\n  - **Abdomen:** Soft, non-tender, nondistended, normal bowel sounds.\n  - **Neurological:** No focal deficits, cranial nerves intact, strength 5/5 in all extremities.\n- **Laboratory Results:**\n  - Potassium: 6.8 mmol/L (decreased post-HD to 4.9 mmol/L)\n  - BUN: 60 mg/dL\n  - Creatinine: 9.5 mg/dL\n- **EKG Findings:** Peaked T waves, no ST-elevation or arrhythmias.\n\n## Assessment and Plan\n\n1. **Hyperkalemia**\n   - **Assessment:** The patient's hyperkalemia is likely due to missed dialysis in the context of ESRD. Initial treatment in the emergency department has been effective in lowering potassium levels.\n   - **Plan:** Continue regular dialysis sessions to manage potassium levels. Monitor potassium post-dialysis. Educate the patient on the importance of adherence to dialysis schedule.\n\n2. **Hypertension**\n   - **Assessment:** Poorly controlled hypertension, likely exacerbated by volume overload due to missed dialysis. \n   - **Plan:** Continue home antihypertensive regimen including amlodipine, hydrochlorothiazide, and losartan\n\n3. **End-Stage Renal Disease**\n   - **Assessment:** Stable ESRD on HD, complications related to missed dialysis.\n   - **Plan:** Optimize dialysis schedule adherence. Consider social work referral for transportation assistance or home dialysis evaluation. Regular follow-ups with nephrology.\n\nThe patient will be admitted for continuous monitoring and further management of hypertension post-dialysis.\n",cT="copd_vap",uT="This test describes a COPD patient who presents with a COPD exacerbation and is intubated on admission. Several days later he develops pneumonia and is started on ceftriaxone. The correct response should suggest broadening antibiotics to include coverage for ventilaor acquired pneumonia",hT="\n# History and Physical\n\n## Chief Complaint\n**Pneumonia**\n\n## One-Liner\nA 65-year-old male with a history of COPD and hypertension is admitted with respiratory failure, currently on a ventilator due to suspected pneumonia.\n\n## History of Present Illness\nThe patient is a 65-year-old male with a significant medical history of chronic obstructive pulmonary disease (COPD) and hypertension, who was admitted to the hospital one week ago due to acute respiratory failure. Upon admission, the patient was intubated and placed on a mechanical ventilator. Over the past several days, the patient's respiratory status has shown minimal improvement, prompting further investigation. A chest X-ray revealed diffuse bilateral infiltrates suggestive of pneumonia. Given these findings, the decision was made to start the patient on ceftriaxone for suspected bacterial pneumonia. The patient has been febrile intermittently and has noted an increase in respiratory secretions, which are purulent in appearance. Blood cultures were obtained, and sputum samples were sent for gram stain and culture to identify any infectious organisms.\n\n## Emergency Department Course\nOn presentation, the patient's vital signs were significant for hypoxia and tachycardia. Initial labs revealed leukocytosis with a WBC count of 14,000/mm³ and an elevated C-reactive protein. Arterial blood gas showed severe hypoxemia. A chest X-ray demonstrated bilateral interstitial infiltrates. The patient was intubated for respiratory failure and started on ceftriaxone. Continuous monitoring of the patient's condition was conducted, with repeat chest imaging and labs every 48 hours to assess for changes in the clinical picture.\n\n## Medications\n- **Ceftriaxone** 1g IV every 24 hours  \n- **Lisinopril** 10mg PO daily  \n- **Albuterol inhaler** 2 puffs every 4 hours as needed  \n- **Prednisone** 40mg PO daily  \n\n## Allergies\n- **Penicillin** (rash)\n\n## Past Surgical History\n- Appendectomy at age 22  \n- Right total knee replacement 3 years ago  \n\n## Social History\n- Former smoker, quit 10 years ago, 30 pack-year history  \n- No illicit drug use  \n- Alcohol: occasional, 1-2 drinks per month  \n- Lives with spouse in a single-family home  \n\n## Objective Data\n\n### Vital Signs\n- **Temperature:** 100.4°F  \n- **Heart rate:** 98 bpm  \n- **Respiratory rate:** 18 breaths/min (ventilated)  \n- **Blood pressure:** 135/85 mmHg  \n- **Oxygen saturation:** 94% on ventilator settings of FiO2 40%  \n\n### Physical Exam\n- **General:** Sedated and intubated, appearing mildly distressed  \n- **Lungs:** Decreased breath sounds bilaterally, rhonchi present  \n- **Cardiovascular:** Regular rate and rhythm, no murmurs  \n- **Abdomen:** Soft, non-tender, no organomegaly  \n- **Extremities:** No edema  \n\n### Laboratory/Imaging\n- **WBC:** 14,000/mm³  \n- **C-reactive protein:** Elevated  \n- **Chest X-ray:** Bilateral diffuse infiltrates consistent with pneumonia  \n- **Arterial Blood Gas:** pH 7.32, PaCO2 55 mmHg, PaO2 60 mmHg  \n\n## Assessment and Plan\n\n1. **Suspected Bacterial Pneumonia**\n   - **Assessment:** Bilateral infiltrates on chest X-ray and clinical presentation suggest pneumonia, likely bacterial in origin. Purulent respiratory secretions and recent intubation history further support this diagnosis.\n   - **Plan:** Continue ceftriaxone.  \n\n2. **Acute Respiratory Failure**\n   - **Assessment:** Respiratory failure necessitated intubation and mechanical ventilation, likely secondary to pneumonia on a background of COPD.\n   - **Plan:** Continue ventilatory support with daily ABG checks, titrate FiO2 to maintain adequate oxygenation, pulmonary hygiene, and physiotherapy as tolerated.  \n\n3. **COPD Exacerbation**\n   - **Assessment:** Underlying COPD may have been exacerbated by pneumonia, contributing to respiratory failure.\n   - **Plan:** Continue bronchodilator therapy, taper prednisone as patient stabilizes, monitor for signs of improvement in lung function.  \n\n4. **Hypertension**\n   - **Assessment:** Previously well-controlled on lisinopril. Blood pressure within normal limits currently.\n   - **Plan:** Continue lisinopril, monitor blood pressure daily. Adjust anti-hypertensive therapy if necessary.\n",dT=i(46),pT={temperature:0};class fT extends dT.EventEmitter{constructor(e){super(),this.name=e.name,this.model=e.model,this.logger=_t({id:`amie:${e.name}`})}init(){this.log(`Created engine ${this.name} with model ${this.model}`)}log(e){this.logger(e),this.emit("log",{data:e})}async structured_completion(e){let{prompt:t,response_format:n}=e,r=[{role:"user",content:t}],i=this.model,s=Object.assign(Object.assign({},pT),{messages:r,model:i,response_format:n});this.log("Request to call structured completion"),Nd("SC_ARGS",s);let a=await fetch("https://www.tidyscripts.com/api/openai_structured_completion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await a.json()}}const{patient_information_placeholder:mT,supplementary_information_placeholder:gT,extraction:yT,evaluation:vT,evaluation_without_supplementary_data:bT}=k;class wT extends fT{constructor(e){let{supplementary_data:t,verbose:n=!0}=e;!function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}}(e,["supplementary_data","verbose"]),super(e),this.supplementary_data=t,this.verbose=n}async extract_medication_information(e){let t=yT.prompt.replace(mT,e),n=yT.rf,r=await this.structured_completion({prompt:t,response_format:n});return this.log("Got extraction result"),Nd("extraction_result",r),this.verbose&&this.log(r),r}async build_prompt(e){var t;if(this.supplementary_data){this.log("running WITH supplementary data");let n=await this.extract_medication_information(e);t=vT.prompt.replace(mT,e).replace(gT,JSON.stringify(n))}else this.log("running WITHOUT supplementary data"),t=bT.prompt.replace(mT,e);return t}async evaluate(e){let t=await this.build_prompt(e),n=vT.rf,r=await this.structured_completion({prompt:t,response_format:n});return this.log("Got evaluation result"),Nd("evaluation_result",r),this.verbose&&this.log(r),r}}const _T=_t({id:"tamie"});function kT(){_T("init")}async function AT(){kT();let e=T,t=new wT({model:"gpt-4o",name:"me-4o-data",supplementary_data:!0}),n=new wT({model:"gpt-4o",name:"me-4o",supplementary_data:!1}),r=await t.evaluate(e.hp),i=await n.evaluate(e.hp);return{me_4o_data:t,me_4o:n,me_4o_data_result:r,me_4o_result:i}}const PT=_t({id:"amie"});function TT(){PT("init")}const ET={methods:{one:{},two:{},three:{},four:{}},model:{one:{},two:{},three:{}},compute:{},hooks:[]},xT={compute:function(e){const{world:t}=this,n=t.compute;return"string"==typeof e&&n.hasOwnProperty(e)?n[e](this):(e=>"[object Array]"===Object.prototype.toString.call(e))(e)?e.forEach((r=>{t.compute.hasOwnProperty(r)?n[r](this):console.warn("no compute:",e)})):"function"==typeof e?e(this):console.warn("no compute:",e),this}},IT=xT,CT={forEach:function(e){return this.fullPointer.forEach(((t,n)=>{let r=this.update([t]);e(r,n)})),this},map:function(e,t){let n=this.fullPointer.map(((t,n)=>{let r=this.update([t]),i=e(r,n);return void 0===i?this.none():i}));if(0===n.length)return t||this.update([]);if(void 0!==n[0]){if("string"==typeof n[0])return n;if("object"==typeof n[0]&&(null===n[0]||!n[0].isView))return n}let r=[];return n.forEach((e=>{r=r.concat(e.fullPointer)})),this.toView(r)},filter:function(e){let t=this.fullPointer;return t=t.filter(((t,n)=>{let r=this.update([t]);return e(r,n)})),this.update(t)},find:function(e){let t=this.fullPointer.find(((t,n)=>{let r=this.update([t]);return e(r,n)}));return this.update([t])},some:function(e){return this.fullPointer.some(((t,n)=>{let r=this.update([t]);return e(r,n)}))},random:function(e=1){let t=this.fullPointer,n=Math.floor(Math.random()*t.length);return n+e>this.length&&(n=this.length-e,n=n<0?0:n),t=t.slice(n,n+e),this.update(t)}},OT={termList:function(){return this.methods.one.termList(this.docs)},terms:function(e){let t=this.match(".");return"number"==typeof e?t.eq(e):t},groups:function(e){if(e||0===e)return this.update(this._groups[e]||[]);let t={};return Object.keys(this._groups).forEach((e=>{t[e]=this.update(this._groups[e])})),t},eq:function(e){let t=this.pointer;return t||(t=this.docs.map(((e,t)=>[t]))),t[e]?this.update([t[e]]):this.none()},first:function(){return this.eq(0)},last:function(){let e=this.fullPointer.length-1;return this.eq(e)},firstTerms:function(){return this.match("^.")},lastTerms:function(){return this.match(".$")},slice:function(e,t){let n=this.pointer||this.docs.map(((e,t)=>[t]));return n=n.slice(e,t),this.update(n)},all:function(){return this.update().toView()},fullSentences:function(){let e=this.fullPointer.map((e=>[e[0]]));return this.update(e).toView()},none:function(){return this.update([])},isDoc:function(e){if(!e||!e.isView)return!1;let t=this.fullPointer,n=e.fullPointer;return!t.length!==n.length&&t.every(((e,t)=>!!n[t]&&e[0]===n[t][0]&&e[1]===n[t][1]&&e[2]===n[t][2]))},wordCount:function(){return this.docs.reduce(((e,t)=>e+t.filter((e=>""!==e.text)).length),0)},isFull:function(){let e=this.pointer;if(!e)return!0;if(0===e.length||0!==e[0][0])return!1;let t=0,n=0;return this.document.forEach((e=>t+=e.length)),this.docs.forEach((e=>n+=e.length)),t===n},getNth:function(e){return"number"==typeof e?this.eq(e):"string"==typeof e?this.if(e):this}};OT.group=OT.groups,OT.fullSentence=OT.fullSentences,OT.sentence=OT.fullSentences,OT.lastTerm=OT.lastTerms,OT.firstTerm=OT.firstTerms;const ST=OT,NT=Object.assign({},ST,IT,CT);NT.get=NT.eq;const jT=NT;class DT{constructor(e,t,n={}){[["document",e],["world",ET],["_groups",n],["_cache",null],["viewType","View"]].forEach((e=>{Object.defineProperty(this,e[0],{value:e[1],writable:!0})})),this.ptrs=t}get docs(){let e=this.document;return this.ptrs&&(e=ET.methods.one.getDoc(this.ptrs,this.document)),e}get pointer(){return this.ptrs}get methods(){return this.world.methods}get model(){return this.world.model}get hooks(){return this.world.hooks}get isView(){return!0}get found(){return this.docs.length>0}get length(){return this.docs.length}get fullPointer(){let{docs:e,ptrs:t,document:n}=this,r=t||e.map(((e,t)=>[t]));return r.map((e=>{let[t,r,i,s,a]=e;return r=r||0,i=i||(n[t]||[]).length,n[t]&&n[t][r]&&(s=s||n[t][r].id,n[t][i-1]&&(a=a||n[t][i-1].id)),[t,r,i,s,a]}))}update(e){let t=new DT(this.document,e);if(this._cache&&e&&e.length>0){let n=[];e.forEach(((e,t)=>{let[r,i,s]=e;(1===e.length||0===i&&this.document[r].length===s)&&(n[t]=this._cache[r])})),n.length>0&&(t._cache=n)}return t.world=this.world,t}toView(e){return new DT(this.document,e||this.pointer)}fromText(e){const{methods:t}=this;let n=t.one.tokenize.fromString(e,this.world),r=new DT(n);return r.world=this.world,r.compute(["normal","freeze","lexicon"]),this.world.compute.preTagger&&r.compute("preTagger"),r.compute("unfreeze"),r}clone(){let e=this.document.slice(0);e=e.map((e=>e.map((e=>((e=Object.assign({},e)).tags=new Set(e.tags),e)))));let t=this.update(this.pointer);return t.document=e,t._cache=this._cache,t}}Object.assign(DT.prototype,jT);const RT=DT,$T=function(e){return e&&"object"==typeof e&&!Array.isArray(e)};function LT(e,t){if($T(t))for(const n in t)$T(t[n])?(e[n]||Object.assign(e,{[n]:{}}),LT(e[n],t[n])):Object.assign(e,{[n]:t[n]});return e}const MT=function(e,t,n,r){const{methods:i,model:s,compute:a,hooks:o}=t;e.methods&&function(e,t){for(const n in t)e[n]=e[n]||{},Object.assign(e[n],t[n])}(i,e.methods),e.model&&LT(s,e.model),e.irregulars&&function(e,t){let n=e.two.models||{};Object.keys(t).forEach((e=>{t[e].pastTense&&(n.toPast&&(n.toPast.ex[e]=t[e].pastTense),n.fromPast&&(n.fromPast.ex[t[e].pastTense]=e)),t[e].presentTense&&(n.toPresent&&(n.toPresent.ex[e]=t[e].presentTense),n.fromPresent&&(n.fromPresent.ex[t[e].presentTense]=e)),t[e].gerund&&(n.toGerund&&(n.toGerund.ex[e]=t[e].gerund),n.fromGerund&&(n.fromGerund.ex[t[e].gerund]=e)),t[e].comparative&&(n.toComparative&&(n.toComparative.ex[e]=t[e].comparative),n.fromComparative&&(n.fromComparative.ex[t[e].comparative]=e)),t[e].superlative&&(n.toSuperlative&&(n.toSuperlative.ex[e]=t[e].superlative),n.fromSuperlative&&(n.fromSuperlative.ex[t[e].superlative]=e))}))}(s,e.irregulars),e.compute&&Object.assign(a,e.compute),o&&(t.hooks=o.concat(e.hooks||[])),e.api&&e.api(n),e.lib&&Object.keys(e.lib).forEach((t=>r[t]=e.lib[t])),e.tags&&r.addTags(e.tags),e.words&&r.addWords(e.words),e.frozen&&r.addWords(e.frozen,!0),e.mutate&&e.mutate(t,r)},FT=function(e){return"[object Array]"===Object.prototype.toString.call(e)},UT=function(e,t,n){const{methods:r}=n;let i=new t([]);if(i.world=n,"number"==typeof e&&(e=String(e)),!e)return i;if("string"==typeof e)return new t(r.one.tokenize.fromString(e,n));if(s=e,"[object Object]"===Object.prototype.toString.call(s)&&e.isView)return new t(e.document,e.ptrs);var s;if(FT(e)){if(FT(e[0])){let n=e.map((e=>e.map((e=>({text:e,normal:e,pre:"",post:" ",tags:new Set})))));return new t(n)}let n=function(e){return e.map((e=>e.terms.map((e=>(FT(e.tags)&&(e.tags=new Set(e.tags)),e)))))}(e);return new t(n)}return i};let BT=Object.assign({},ET);const VT=function(e,t){t&&VT.addWords(t);let n=UT(e,RT,BT);return e&&n.compute(BT.hooks),n};Object.defineProperty(VT,"_world",{value:BT,writable:!0}),VT.tokenize=function(e,t){const{compute:n}=this._world;t&&VT.addWords(t);let r=UT(e,RT,BT);return n.contractions&&r.compute(["alias","normal","machine","contractions"]),r},VT.plugin=function(e){return MT(e,this._world,RT,this),this},VT.extend=VT.plugin,VT.world=function(){return this._world},VT.model=function(){return this._world.model},VT.methods=function(){return this._world.methods},VT.hooks=function(){return this._world.hooks},VT.verbose=function(e){const t="undefined"!=typeof process&&process.env?process.env:self.env||{};return t.DEBUG_TAGS="tagger"===e||!0===e||"",t.DEBUG_MATCH="match"===e||!0===e||"",t.DEBUG_CHUNKS="chunker"===e||!0===e||"",this},VT.version="14.14.4";const zT=VT,HT={cache:function(){return this._cache=this.methods.one.cacheDoc(this.document),this},uncache:function(){return this._cache=null,this}},GT={api:function(e){Object.assign(e.prototype,HT)},compute:{cache:function(e){e._cache=e.methods.one.cacheDoc(e.document)}},methods:{one:{cacheDoc:function(e){let t=e.map((e=>{let t=new Set;return e.forEach((e=>{""!==e.normal&&t.add(e.normal),e.switch&&t.add(`%${e.switch}%`),e.implicit&&t.add(e.implicit),e.machine&&t.add(e.machine),e.root&&t.add(e.root),e.alias&&e.alias.forEach((e=>t.add(e)));let n=Array.from(e.tags);for(let e=0;e<n.length;e+=1)t.add("#"+n[e])})),t}));return t}}}},qT=e=>/^\p{Lu}[\p{Ll}'’]/u.test(e)||/^\p{Lu}$/u.test(e),KT=(e,t,n)=>{if(n.forEach((e=>e.dirty=!0)),e){let r=[t,0].concat(n);Array.prototype.splice.apply(e,r)}return e},WT=function(e){let t=e[e.length-1];!t||/ $/.test(t.post)||/[-–—]/.test(t.post)||(t.post+=" ")},JT=(e,t,n)=>{const r=/[-.?!,;:)–—'"]/g;let i=e[t-1];if(!i)return;let s=i.post;if(r.test(s)){let e=s.match(r).join(""),t=n[n.length-1];t.post=e+t.post,i.post=i.post.replace(r,"")}};let ZT=0;const QT=e=>(e=e.length<3?"0"+e:e).length<3?"0"+e:e,XT=function(e){let[t,n]=e.index||[0,0];ZT+=1,ZT=ZT>46655?0:ZT,t=t>46655?0:t,n=n>1294?0:n;let r=QT(ZT.toString(36));r+=QT(t.toString(36));let i=n.toString(36);return i=i.length<2?"0"+i:i,r+=i,r+=parseInt(36*Math.random(),10).toString(36),e.normal+"|"+r.toUpperCase()},YT=function(e){e.has("@hasContraction")&&"function"==typeof e.contractions&&e.grow("@hasContraction").contractions().expand()},eE=e=>"[object Array]"===Object.prototype.toString.call(e),tE=function(e,t,n){const{document:r,world:i}=t;t.uncache();let s=t.fullPointer,a=t.fullPointer;t.forEach(((o,l)=>{let c=o.fullPointer[0],[u]=c,h=r[u],d=function(e,t){const{methods:n}=t;return"string"==typeof e?n.one.tokenize.fromString(e,t)[0]:"object"==typeof e&&e.isView?e.clone().docs[0]||[]:eE(e)?eE(e[0])?e[0]:e:[]}(e,i);0!==d.length&&(d=function(e){return e.map((e=>(e.id=XT(e),e)))}(d),n?(YT(t.update([c]).firstTerm()),function(e,t,n,r){let[i,s,a]=t;0===s||a===r[i].length?WT(n):(WT(n),WT([e[t[1]]])),function(e,t,n){let r=e[t];if(0!==t||!qT(r.text))return;n[0].text=(e=>e.replace(/^\p{Ll}/u,(e=>e.toUpperCase())))(n[0].text);let i=e[t];i.tags.has("ProperNoun")||i.tags.has("Acronym")||qT(i.text)&&i.text.length>1&&(i.text=(e=>e.replace(/^\p{Lu}/u,(e=>e.toLowerCase())))(i.text))}(e,s,n),KT(e,s,n)}(h,c,d,r)):(YT(t.update([c]).lastTerm()),function(e,t,n,r){let[i,,s]=t,a=(r[i]||[]).length;s<a?(JT(e,s,n),WT(n)):a===s&&(WT(e),JT(e,s,n),r[i+1]&&(n[n.length-1].post+=" ")),KT(e,t[2],n),t[4]=n[n.length-1].id}(h,c,d,r)),r[u]&&r[u][c[1]]&&(c[3]=r[u][c[1]].id),a[l]=c,c[2]+=d.length,s[l]=c)}));let o=t.toView(s);return t.ptrs=a,o.compute(["id","index","freeze","lexicon"]),o.world.compute.preTagger&&o.compute("preTagger"),o.compute("unfreeze"),o},nE={insertAfter:function(e){return tE(e,this,!1)},insertBefore:function(e){return tE(e,this,!0)}};nE.append=nE.insertAfter,nE.prepend=nE.insertBefore,nE.insert=nE.insertAfter;const rE=nE,iE=/\$[0-9a-z]+/g,sE={},aE=e=>e.replace(/^\p{Ll}/u,(e=>e.toUpperCase())),oE=e=>e.replace(/^\p{Lu}/u,(e=>e.toLowerCase()));sE.replaceWith=function(e,t={}){let n=this.fullPointer,r=this;if(this.uncache(),"function"==typeof e)return function(e,t,n){return e.forEach((e=>{let r=t(e);e.replaceWith(r,n)})),e}(r,e,t);let i=r.docs[0];if(!i)return r;let s=t.possessives&&i[i.length-1].tags.has("Possessive"),a=t.case&&(e=>/^\p{Lu}[\p{Ll}'’]/u.test(e)||/^\p{Lu}$/u.test(e))(i[0].text);e=function(e,t){if("string"!=typeof e)return e;let n=t.groups();return e=e.replace(iE,(e=>{let t=e.replace(/\$/,"");return n.hasOwnProperty(t)?n[t].text():e})),e}(e,r);let o=this.update(n);n=n.map((e=>e.slice(0,3)));let l=(o.docs[0]||[]).map((e=>Array.from(e.tags))),c=o.docs[0][0].pre,u=o.docs[0][o.docs[0].length-1].post;if("string"==typeof e&&(e=this.fromText(e).compute("id")),r.insertAfter(e),o.has("@hasContraction")&&r.contractions&&r.grow("@hasContraction+").contractions().expand(),r.delete(o),s){let e=r.docs[0],t=e[e.length-1];t.tags.has("Possessive")||(t.text+="'s",t.normal+="'s",t.tags.add("Possessive"))}if(c&&r.docs[0]&&(r.docs[0][0].pre=c),u&&r.docs[0]){let e=r.docs[0][r.docs[0].length-1];e.post.trim()||(e.post=u)}let h=r.toView(n).compute(["index","freeze","lexicon"]);if(h.world.compute.preTagger&&h.compute("preTagger"),h.compute("unfreeze"),t.tags&&h.terms().forEach(((e,t)=>{e.tagSafe(l[t])})),!h.docs[0]||!h.docs[0][0])return h;if(t.case){let e=a?aE:oE;h.docs[0][0].text=e(h.docs[0][0].text)}return h},sE.replace=function(e,t,n){if(e&&!t)return this.replaceWith(e,n);let r=this.match(e);return r.found?(this.soften(),r.replaceWith(t,n)):this};const lE=sE,cE={remove:function(e){const{indexN:t}=this.methods.one.pointer;this.uncache();let n=this.all(),r=this;e&&(n=this,r=this.match(e));let i=!n.ptrs;r.has("@hasContraction")&&r.contractions&&r.grow("@hasContraction").contractions().expand();let s=n.fullPointer,a=r.fullPointer.reverse(),o=function(e,t){t.forEach((t=>{let[n,r,i]=t,s=i-r;e[n]&&(i===e[n].length&&i>1&&function(e,t){let n=e.length-1,r=e[n],i=e[n-t];i&&r&&(i.post+=r.post,i.post=i.post.replace(/ +([.?!,;:])/,"$1"),i.post=i.post.replace(/[,;:]+([.?!])/,"$1"))}(e[n],s),e[n].splice(r,s))}));for(let t=e.length-1;t>=0;t-=1)if(0===e[t].length&&(e.splice(t,1),t===e.length&&e[t-1])){let n=e[t-1],r=n[n.length-1];r&&(r.post=r.post.trimEnd())}return e}(this.document,a);return s=function(e,t){return e=e.map((e=>{let[n]=e;return t[n]?(t[n].forEach((t=>{let n=t[2]-t[1];e[1]<=t[1]&&e[2]>=t[2]&&(e[2]-=n)})),e):e})),e.forEach(((t,n)=>{if(0===t[1]&&0==t[2])for(let t=n+1;t<e.length;t+=1)e[t][0]-=1,e[t][0]<0&&(e[t][0]=0)})),e=(e=e.filter((e=>e[2]-e[1]>0))).map((e=>(e[3]=null,e[4]=null,e)))}(s,t(a)),n.ptrs=s,n.document=o,n.compute("index"),i&&(n.ptrs=void 0),e?n.toView(s):(this.ptrs=[],n.none())}};cE.delete=cE.remove;const uE=cE,hE={pre:function(e,t){return void 0===e&&this.found?this.docs[0][0].pre:(this.docs.forEach((n=>{let r=n[0];!0===t?r.pre+=e:r.pre=e})),this)},post:function(e,t){if(void 0===e){let e=this.docs[this.docs.length-1];return e[e.length-1].post}return this.docs.forEach((n=>{let r=n[n.length-1];!0===t?r.post+=e:r.post=e})),this},trim:function(){if(!this.found)return this;let e=this.docs,t=e[0][0];t.pre=t.pre.trimStart();let n=e[e.length-1],r=n[n.length-1];return r.post=r.post.trimEnd(),this},hyphenate:function(){return this.docs.forEach((e=>{e.forEach(((t,n)=>{0!==n&&(t.pre=""),e[n+1]&&(t.post="-")}))})),this},dehyphenate:function(){const e=/[-–—]/;return this.docs.forEach((t=>{t.forEach((t=>{e.test(t.post)&&(t.post=" ")}))})),this},toQuotations:function(e,t){return e=e||'"',t=t||'"',this.docs.forEach((n=>{n[0].pre=e+n[0].pre;let r=n[n.length-1];r.post=t+r.post})),this},toParentheses:function(e,t){return e=e||"(",t=t||")",this.docs.forEach((n=>{n[0].pre=e+n[0].pre;let r=n[n.length-1];r.post=t+r.post})),this}};hE.deHyphenate=hE.dehyphenate,hE.toQuotation=hE.toQuotations;const dE=hE,pE={alpha:(e,t)=>e.normal<t.normal?-1:e.normal>t.normal?1:0,length:(e,t)=>{let n=e.normal.trim().length,r=t.normal.trim().length;return n<r?1:n>r?-1:0},wordCount:(e,t)=>e.words<t.words?1:e.words>t.words?-1:0,sequential:(e,t)=>e[0]<t[0]?1:e[0]>t[0]?-1:e[1]>t[1]?1:-1,byFreq:function(e){let t={};return e.forEach((e=>{t[e.normal]=t[e.normal]||0,t[e.normal]+=1})),e.sort(((e,n)=>{let r=t[e.normal],i=t[n.normal];return r<i?1:r>i?-1:0})),e}},fE=new Set(["index","sequence","seq","sequential","chron","chronological"]),mE=new Set(["freq","frequency","topk","repeats"]),gE=new Set(["alpha","alphabetical"]),yE={unique:function(){let e=new Set,t=this.filter((t=>{let n=t.text("machine");return!e.has(n)&&(e.add(n),!0)}));return t},reverse:function(){let e=this.pointer||this.docs.map(((e,t)=>[t]));return e=[].concat(e),e=e.reverse(),this._cache&&(this._cache=this._cache.reverse()),this.update(e)},sort:function(e){let{docs:t,pointer:n}=this;if(this.uncache(),"function"==typeof e)return function(e,t){let n=e.fullPointer;return n=n.sort(((n,r)=>(n=e.update([n]),r=e.update([r]),t(n,r)))),e.ptrs=n,e}(this,e);e=e||"alpha";let r=n||t.map(((e,t)=>[t])),i=t.map(((e,t)=>({index:t,words:e.length,normal:e.map((e=>e.machine||e.normal||"")).join(" "),pointer:r[t]})));return fE.has(e)&&(e="sequential"),gE.has(e)&&(e="alpha"),mE.has(e)?(i=pE.byFreq(i),this.update(i.map((e=>e.pointer)))):"function"==typeof pE[e]?(i=i.sort(pE[e]),this.update(i.map((e=>e.pointer)))):this}},vE=function(e,t){if(e.length>0){let t=e[e.length-1],n=t[t.length-1];!1===/ /.test(n.post)&&(n.post+=" ")}return e.concat(t)},bE={concat:function(e){if("string"==typeof e){let t=this.fromText(e);if(this.found&&this.ptrs){let e=this.fullPointer,n=e[e.length-1][0];this.document.splice(n,0,...t.document)}else this.document=this.document.concat(t.document);return this.all().compute("index")}if("object"==typeof e&&e.isView)return function(e,t){if(e.document===t.document){let n=e.fullPointer.concat(t.fullPointer);return e.toView(n).compute("index")}return t.fullPointer.forEach((t=>{t[0]+=e.document.length})),e.document=vE(e.document,t.docs),e.all()}(this,e);if(t=e,"[object Array]"===Object.prototype.toString.call(t)){let t=vE(this.document,e);return this.document=t,this.all()}var t;return this}},wE=Object.assign({},{toLowerCase:function(){return this.termList().forEach((e=>{e.text=e.text.toLowerCase()})),this},toUpperCase:function(){return this.termList().forEach((e=>{e.text=e.text.toUpperCase()})),this},toTitleCase:function(){return this.termList().forEach((e=>{e.text=e.text.replace(/^ *[a-z\u00C0-\u00FF]/,(e=>e.toUpperCase()))})),this},toCamelCase:function(){return this.docs.forEach((e=>{e.forEach(((t,n)=>{0!==n&&(t.text=t.text.replace(/^ *[a-z\u00C0-\u00FF]/,(e=>e.toUpperCase()))),n!==e.length-1&&(t.post="")}))})),this}},rE,lE,uE,dE,yE,bE,{harden:function(){return this.ptrs=this.fullPointer,this},soften:function(){let e=this.ptrs;return!e||e.length<1||(e=e.map((e=>e.slice(0,3))),this.ptrs=e),this}}),_E={id:function(e){let t=e.docs;for(let e=0;e<t.length;e+=1)for(let n=0;n<t[e].length;n+=1){let r=t[e][n];r.id=r.id||XT(r)}}},kE={api:function(e){Object.assign(e.prototype,wE)},compute:_E},AE=!0,PE={one:{contractions:[{word:"@",out:["at"]},{word:"arent",out:["are","not"]},{word:"alot",out:["a","lot"]},{word:"brb",out:["be","right","back"]},{word:"cannot",out:["can","not"]},{word:"dun",out:["do","not"]},{word:"can't",out:["can","not"]},{word:"shan't",out:["should","not"]},{word:"won't",out:["will","not"]},{word:"that's",out:["that","is"]},{word:"what's",out:["what","is"]},{word:"let's",out:["let","us"]},{word:"dunno",out:["do","not","know"]},{word:"gonna",out:["going","to"]},{word:"gotta",out:["have","got","to"]},{word:"gimme",out:["give","me"]},{word:"outta",out:["out","of"]},{word:"tryna",out:["trying","to"]},{word:"gtg",out:["got","to","go"]},{word:"im",out:["i","am"]},{word:"imma",out:["I","will"]},{word:"imo",out:["in","my","opinion"]},{word:"irl",out:["in","real","life"]},{word:"ive",out:["i","have"]},{word:"rn",out:["right","now"]},{word:"tbh",out:["to","be","honest"]},{word:"wanna",out:["want","to"]},{word:"c'mere",out:["come","here"]},{word:"c'mon",out:["come","on"]},{word:"shoulda",out:["should","have"]},{word:"coulda",out:["coulda","have"]},{word:"woulda",out:["woulda","have"]},{word:"musta",out:["must","have"]},{word:"tis",out:["it","is"]},{word:"twas",out:["it","was"]},{word:"y'know",out:["you","know"]},{word:"ne'er",out:["never"]},{word:"o'er",out:["over"]},{after:"ll",out:["will"]},{after:"ve",out:["have"]},{after:"re",out:["are"]},{after:"m",out:["am"]},{before:"c",out:["ce"]},{before:"m",out:["me"]},{before:"n",out:["ne"]},{before:"qu",out:["que"]},{before:"s",out:["se"]},{before:"t",out:["tu"]},{word:"shouldnt",out:["should","not"]},{word:"couldnt",out:["could","not"]},{word:"wouldnt",out:["would","not"]},{word:"hasnt",out:["has","not"]},{word:"wasnt",out:["was","not"]},{word:"isnt",out:["is","not"]},{word:"cant",out:["can","not"]},{word:"dont",out:["do","not"]},{word:"wont",out:["will","not"]},{word:"howd",out:["how","did"]},{word:"whatd",out:["what","did"]},{word:"whend",out:["when","did"]},{word:"whered",out:["where","did"]}],numberSuffixes:{st:AE,nd:AE,rd:AE,th:AE,am:AE,pm:AE,max:AE,"°":AE,s:AE,e:AE,er:AE,ère:AE,ème:AE}}},TE=function(e,t,n){let[r,i]=t;n&&0!==n.length&&(n=n.map(((e,t)=>(e.implicit=e.text,e.machine=e.text,e.pre="",e.post="",e.text="",e.normal="",e.index=[r,i+t],e))),n[0]&&(n[0].pre=e[r][i].pre,n[n.length-1].post=e[r][i].post,n[0].text=e[r][i].text,n[0].normal=e[r][i].normal),e[r].splice(i,1,...n))},EE=/'/,xE=new Set(["what","how","when","where","why"]),IE=new Set(["be","go","start","think","need"]),CE=new Set(["been","gone"]),OE=/'/,SE=/(e|é|aison|sion|tion)$/,NE=/(age|isme|acle|ege|oire)$/,jE=/^([0-9.]{1,4}[a-z]{0,2}) ?[-–—] ?([0-9]{1,4}[a-z]{0,2})$/i,DE=/^([0-9]{1,2}(:[0-9][0-9])?(am|pm)?) ?[-–—] ?([0-9]{1,2}(:[0-9][0-9])?(am|pm)?)$/i,RE=/^[0-9]{3}-[0-9]{4}$/,$E=function(e,t){let n=e[t],r=n.text.match(jE);return null!==r?!0===n.tags.has("PhoneNumber")||RE.test(n.text)?null:[r[1],"to",r[2]]:(r=n.text.match(DE),null!==r?[r[1],"to",r[4]]:null)},LE=/^([+-]?[0-9][.,0-9]*)([a-z°²³µ/]+)$/,ME=function(e,t,n){const r=n.model.one.numberSuffixes||{};let i=e[t].text.match(LE);if(null!==i){let e=i[2].toLowerCase().trim();return r.hasOwnProperty(e)?null:[i[1],e]}return null},FE=/'/,UE=/^[0-9][^-–—]*[-–—].*?[0-9]/,BE=function(e,t,n,r){let i=t.update();i.document=[e];let s=n+r;n>0&&(n-=1),e[s]&&(s+=1),i.ptrs=[[0,n,s]]},VE={t:(e,t)=>function(e,t){return"ain't"===e[t].normal||"aint"===e[t].normal?null:[e[t].normal.replace(/n't/,""),"not"]}(e,t),d:(e,t)=>function(e,t){let n=e[t].normal.split(EE)[0];if(xE.has(n))return[n,"did"];if(e[t+1]){if(CE.has(e[t+1].normal))return[n,"had"];if(IE.has(e[t+1].normal))return[n,"would"]}return null}(e,t)},zE={j:(e,t)=>((e,t)=>["je",e[t].normal.split(OE)[1]])(e,t),l:(e,t)=>((e,t)=>{let n=e[t].normal.split(OE)[1];return n&&n.endsWith("e")?["la",n]:["le",n]})(e,t),d:(e,t)=>((e,t)=>{let n=e[t].normal.split(OE)[1];return n&&SE.test(n)&&!NE.test(n)?["du",n]:n&&n.endsWith("s")?["des",n]:["de",n]})(e,t)},HE=function(e,t,n,r){for(let i=0;i<e.length;i+=1){let s=e[i];if(s.word===t.normal)return s.out;if(null!==r&&r===s.after)return[n].concat(s.out);if(null!==n&&n===s.before&&r&&r.length>2)return s.out.concat(r)}return null},GE=function(e,t){let n=t.fromText(e.join(" "));return n.compute(["id","alias"]),n.docs[0]},qE=function(e,t){for(let n=t+1;n<5&&e[n];n+=1)if("been"===e[n].normal)return["there","has"];return["there","is"]},KE={model:PE,compute:{contractions:e=>{let{world:t,document:n}=e;const{model:r,methods:i}=t;let s=r.one.contractions||[];n.forEach(((r,a)=>{for(let o=r.length-1;o>=0;o-=1){let l=null,c=null;if(!0===FE.test(r[o].normal)){let e=r[o].normal.split(FE);l=e[0],c=e[1]}let u=HE(s,r[o],l,c);!u&&VE.hasOwnProperty(c)&&(u=VE[c](r,o,t)),!u&&zE.hasOwnProperty(l)&&(u=zE[l](r,o)),"there"===l&&"s"===c&&(u=qE(r,o)),u?(u=GE(u,e),TE(n,[a,o],u),BE(n[a],e,o,u.length)):UE.test(r[o].normal)?(u=$E(r,o),u&&(u=GE(u,e),TE(n,[a,o],u),i.one.setTag(u,"NumberRange",t),u[2]&&u[2].tags.has("Time")&&i.one.setTag([u[0]],"Time",t,null,"time-range"),BE(n[a],e,o,u.length))):(u=ME(r,o,t),u&&(u=GE(u,e),TE(n,[a,o],u),i.one.setTag([u[1]],"Unit",t,null,"contraction-unit")))}}))}},hooks:["contractions"]},WE=function(e){const t=e.world,{model:n,methods:r}=e.world,i=r.one.setTag,{frozenLex:s}=n.one,a=n.one._multiCache||{};e.docs.forEach((e=>{for(let n=0;n<e.length;n+=1){let r=e[n],o=r.machine||r.normal;if(void 0!==a[o]&&e[n+1])for(let r=n+a[o]-1;r>n;r-=1){let a=e.slice(n,r+1),o=a.map((e=>e.machine||e.normal)).join(" ");!0!==s.hasOwnProperty(o)||(i(a,s[o],t,!1,"1-frozen-multi-lexicon"),a.forEach((e=>e.frozen=!0)))}void 0!==s[o]&&s.hasOwnProperty(o)&&(i([r],s[o],t,!1,"1-freeze-lexicon"),r.frozen=!0)}}))},JE={frozen:WE,freeze:WE,unfreeze:function(e){return e.docs.forEach((e=>{e.forEach((e=>{delete e.frozen}))})),e}},ZE=e=>"[34m"+e+"[0m",QE=e=>"[3m[2m"+e+"[0m",XE=function(e){e.docs.forEach((e=>{console.log(ZE("\n  ┌─────────")),e.forEach((e=>{let t=`  ${QE("│")}  `,n=e.implicit||e.text||"-";!0===e.frozen?t+=`${ZE(n)} ❄️`:t+=QE(n),console.log(t)}))}))},YE={compute:JE,mutate:e=>{const t=e.methods.one;t.termMethods.isFrozen=e=>!0===e.frozen,t.debug.freeze=XE,t.debug.frozen=XE},api:function(e){e.prototype.freeze=function(){return this.docs.forEach((e=>{e.forEach((e=>{e.frozen=!0}))})),this},e.prototype.unfreeze=function(){this.compute("unfreeze")},e.prototype.isFrozen=function(){return this.match("@isFrozen+")}},hooks:["freeze"]},ex=function(e,t,n){const{model:r,methods:i}=n,s=i.one.setTag,a=r.one._multiCache||{},{lexicon:o}=r.one||{};let l=e[t],c=l.machine||l.normal;if(void 0!==a[c]&&e[t+1]){for(let r=t+a[c]-1;r>t;r-=1){let i=e.slice(t,r+1);if(i.length<=1)return!1;let a=i.map((e=>e.machine||e.normal)).join(" ");if(!0===o.hasOwnProperty(a)){let e=o[a];return s(i,e,n,!1,"1-multi-lexicon"),!e||2!==e.length||"PhrasalVerb"!==e[0]&&"PhrasalVerb"!==e[1]||s([i[1]],"Particle",n,!1,"1-phrasal-particle"),!0}}return!1}return null},tx=/^(under|over|mis|re|un|dis|semi|pre|post)-?/,nx=new Set(["Verb","Infinitive","PastTense","Gerund","PresentTense","Adjective","Participle"]),rx=function(e,t,n){const{model:r,methods:i}=n,s=i.one.setTag,{lexicon:a}=r.one;let o=e[t],l=o.machine||o.normal;if(void 0!==a[l]&&a.hasOwnProperty(l))return s([o],a[l],n,!1,"1-lexicon"),!0;if(o.alias){let e=o.alias.find((e=>a.hasOwnProperty(e)));if(e)return s([o],a[e],n,!1,"1-lexicon-alias"),!0}if(!0===tx.test(l)){let e=l.replace(tx,"");if(a.hasOwnProperty(e)&&e.length>3&&nx.has(a[e]))return s([o],a[e],n,!1,"1-lexicon-prefix"),!0}return null},ix={lexicon:function(e){const t=e.world;e.docs.forEach((e=>{for(let n=0;n<e.length;n+=1)if(0===e[n].tags.size){let r=null;r=r||ex(e,n,t),r=r||rx(e,n,t)}}))}},sx={addWords:function(e,t=!1){const n=this.world(),{methods:r,model:i}=n;if(!e)return;if(Object.keys(e).forEach((t=>{"string"==typeof e[t]&&e[t].startsWith("#")&&(e[t]=e[t].replace(/^#/,""))})),!0===t){let{lex:t,_multi:s}=r.one.expandLexicon(e,n);return Object.assign(i.one._multiCache,s),void Object.assign(i.one.frozenLex,t)}if(r.two.expandLexicon){let{lex:t,_multi:s}=r.two.expandLexicon(e,n);Object.assign(i.one.lexicon,t),Object.assign(i.one._multiCache,s)}let{lex:s,_multi:a}=r.one.expandLexicon(e,n);Object.assign(i.one.lexicon,s),Object.assign(i.one._multiCache,a)}},ax={model:{one:{lexicon:{},_multiCache:{},frozenLex:{}}},methods:{one:{expandLexicon:function(e){let t={},n={};return Object.keys(e).forEach((r=>{let i=e[r],s=(r=(r=r.toLowerCase().trim()).replace(/'s\b/,"")).split(/ /);s.length>1&&(void 0===n[s[0]]||s.length>n[s[0]])&&(n[s[0]]=s.length),t[r]=t[r]||i})),delete t[""],delete t.null,delete t[" "],{lex:t,_multi:n}}}},compute:ix,lib:sx,hooks:["lexicon"]},ox=function(e,t){let n=[{}],r=[null],i=[0],s=[],a=0;e.forEach((function(e){let i=0,s=function(e,t){const{methods:n,model:r}=t;return n.one.tokenize.splitTerms(e,r).map((e=>n.one.tokenize.splitWhitespace(e,r))).map((e=>e.text.toLowerCase()))}(e,t);for(let e=0;e<s.length;e++){let t=s[e];n[i]&&n[i].hasOwnProperty(t)?i=n[i][t]:(a++,n[i][t]=a,n[a]={},i=a,r[a]=null)}r[i]=[s.length]}));for(let e in n[0])a=n[0][e],i[a]=0,s.push(a);for(;s.length;){let e=s.shift(),t=Object.keys(n[e]);for(let o=0;o<t.length;o+=1){let l=t[o],c=n[e][l];for(s.push(c),a=i[e];a>0&&!n[a].hasOwnProperty(l);)a=i[a];if(n.hasOwnProperty(a)){let e=n[a][l];i[c]=e,r[e]&&(r[c]=r[c]||[],r[c]=r[c].concat(r[e]))}else i[c]=0}}return{goNext:n,endAs:r,failTo:i}},lx=function(e,t,n){let r=0,i=[];for(let s=0;s<e.length;s++){let a=e[s][n.form]||e[s].normal;for(;r>0&&(void 0===t.goNext[r]||!t.goNext[r].hasOwnProperty(a));)r=t.failTo[r]||0;if(t.goNext[r].hasOwnProperty(a)&&(r=t.goNext[r][a],t.endAs[r])){let n=t.endAs[r];for(let t=0;t<n.length;t++){let r=n[t],a=e[s-r+1],[o,l]=a.index;i.push([o,l,l+r,a.id])}}}return i},cx=function(e,t){for(let n=0;n<e.length;n+=1)if(!0===t.has(e[n]))return!1;return!0},ux=(e,t)=>{for(let n=e.length-1;n>=0;n-=1)if(e[n]!==t)return e.slice(0,n+1);return e},hx={buildTrie:function(e){return function(e){return e.goNext=e.goNext.map((e=>{if(0!==Object.keys(e).length)return e})),e.goNext=ux(e.goNext,void 0),e.failTo=ux(e.failTo,0),e.endAs=ux(e.endAs,null),e}(ox(e,this.world()))}};hx.compile=hx.buildTrie;const dx={api:function(e){e.prototype.lookup=function(e,t={}){if(!e)return this.none();var n;"string"==typeof e&&(e=[e]);let r=function(e,t,n){let r=[];n.form=n.form||"normal";let i=e.docs;if(!t.goNext||!t.goNext[0])return console.error("Compromise invalid lookup trie"),e.none();let s=Object.keys(t.goNext[0]);for(let a=0;a<i.length;a++){if(e._cache&&e._cache[a]&&!0===cx(s,e._cache[a]))continue;let o=i[a],l=lx(o,t,n);l.length>0&&(r=r.concat(l))}return e.update(r)}(this,(n=e,"[object Object]"===Object.prototype.toString.call(n)?e:ox(e,this.world)),t);return r=r.settle(),r}},lib:hx},px=function(e,t){return t?(e.forEach((e=>{let n=e[0];t[n]&&(e[0]=t[n][0],e[1]+=t[n][1],e[2]+=t[n][1])})),e):e},fx=function(e,t){let{ptrs:n,byGroup:r}=e;return n=px(n,t),Object.keys(r).forEach((e=>{r[e]=px(r[e],t)})),{ptrs:n,byGroup:r}},mx=function(e,t,n){const r=n.methods.one;return"number"==typeof e&&(e=String(e)),"string"==typeof e&&(e=r.killUnicode(e,n),e=r.parseMatch(e,t,n)),e},gx=e=>"[object Object]"===Object.prototype.toString.call(e),yx=e=>e&&gx(e)&&!0===e.isView,vx=e=>e&&gx(e)&&!0===e.isNet,bx={matchOne:function(e,t,n){const r=this.methods.one;if(yx(e))return this.intersection(e).eq(0);if(vx(e))return this.sweep(e,{tagger:!1,matchOne:!0}).view;let i={regs:e=mx(e,n,this.world),group:t,justOne:!0},s=r.match(this.docs,i,this._cache),{ptrs:a,byGroup:o}=fx(s,this.fullPointer),l=this.toView(a);return l._groups=o,l},match:function(e,t,n){const r=this.methods.one;if(yx(e))return this.intersection(e);if(vx(e))return this.sweep(e,{tagger:!1}).view.settle();let i={regs:e=mx(e,n,this.world),group:t},s=r.match(this.docs,i,this._cache),{ptrs:a,byGroup:o}=fx(s,this.fullPointer),l=this.toView(a);return l._groups=o,l},has:function(e,t,n){const r=this.methods.one;if(yx(e))return this.intersection(e).fullPointer.length>0;if(vx(e))return this.sweep(e,{tagger:!1}).view.found;let i={regs:e=mx(e,n,this.world),group:t,justOne:!0};return r.match(this.docs,i,this._cache).ptrs.length>0},if:function(e,t,n){const r=this.methods.one;if(yx(e))return this.filter((t=>t.intersection(e).found));if(vx(e)){let t=this.sweep(e,{tagger:!1}).view.settle();return this.if(t)}let i={regs:e=mx(e,n,this.world),group:t,justOne:!0},s=this.fullPointer,a=this._cache||[];s=s.filter(((e,t)=>{let n=this.update([e]);return r.match(n.docs,i,a[t]).ptrs.length>0}));let o=this.update(s);return this._cache&&(o._cache=s.map((e=>a[e[0]]))),o},ifNo:function(e,t,n){const{methods:r}=this,i=r.one;if(yx(e))return this.filter((t=>!t.intersection(e).found));if(vx(e)){let t=this.sweep(e,{tagger:!1}).view.settle();return this.ifNo(t)}e=mx(e,n,this.world);let s=this._cache||[],a=this.filter(((n,r)=>{let a={regs:e,group:t,justOne:!0};return 0===i.match(n.docs,a,s[r]).ptrs.length}));return this._cache&&(a._cache=a.ptrs.map((e=>s[e[0]]))),a}},wx={before:function(e,t,n){const{indexN:r}=this.methods.one.pointer;let i=[],s=r(this.fullPointer);Object.keys(s).forEach((e=>{let t=s[e].sort(((e,t)=>e[1]>t[1]?1:-1))[0];t[1]>0&&i.push([t[0],0,t[1]])}));let a=this.toView(i);return e?a.match(e,t,n):a},after:function(e,t,n){const{indexN:r}=this.methods.one.pointer;let i=[],s=r(this.fullPointer),a=this.document;Object.keys(s).forEach((e=>{let t=s[e].sort(((e,t)=>e[1]>t[1]?-1:1))[0],[n,,r]=t;r<a[n].length&&i.push([n,r,a[n].length])}));let o=this.toView(i);return e?o.match(e,t,n):o},growLeft:function(e,t,n){"string"==typeof e&&(e=this.world.methods.one.parseMatch(e,n,this.world)),e[e.length-1].end=!0;let r=this.fullPointer;return this.forEach(((n,i)=>{let s=n.before(e,t);if(s.found){let e=s.terms();r[i][1]-=e.length,r[i][3]=e.docs[0][0].id}})),this.update(r)},growRight:function(e,t,n){"string"==typeof e&&(e=this.world.methods.one.parseMatch(e,n,this.world)),e[0].start=!0;let r=this.fullPointer;return this.forEach(((n,i)=>{let s=n.after(e,t);if(s.found){let e=s.terms();r[i][2]+=e.length,r[i][4]=null}})),this.update(r)},grow:function(e,t,n){return this.growRight(e,t,n).growLeft(e,t,n)}},_x=function(e,t){return[e[0],e[1],t[2]]},kx=(e,t,n)=>{return"string"==typeof e||(r=e,"[object Array]"===Object.prototype.toString.call(r))?t.match(e,n):e||t.none();var r},Ax=function(e,t){let[n,r,i]=e;return t.document[n]&&t.document[n][r]&&(e[3]=e[3]||t.document[n][r].id,t.document[n][i-1]&&(e[4]=e[4]||t.document[n][i-1].id)),e},Px={splitOn:function(e,t){const{splitAll:n}=this.methods.one.pointer;let r=kx(e,this,t).fullPointer,i=n(this.fullPointer,r),s=[];return i.forEach((e=>{s.push(e.passthrough),s.push(e.before),s.push(e.match),s.push(e.after)})),s=s.filter((e=>e)),s=s.map((e=>Ax(e,this))),this.update(s)},splitBefore:function(e,t){const{splitAll:n}=this.methods.one.pointer;let r=kx(e,this,t).fullPointer,i=n(this.fullPointer,r);for(let e=0;e<i.length;e+=1)!i[e].after&&i[e+1]&&i[e+1].before&&i[e].match&&i[e].match[0]===i[e+1].before[0]&&(i[e].after=i[e+1].before,delete i[e+1].before);let s=[];return i.forEach((e=>{s.push(e.passthrough),s.push(e.before),e.match&&e.after?s.push(_x(e.match,e.after)):s.push(e.match)})),s=s.filter((e=>e)),s=s.map((e=>Ax(e,this))),this.update(s)},splitAfter:function(e,t){const{splitAll:n}=this.methods.one.pointer;let r=kx(e,this,t).fullPointer,i=n(this.fullPointer,r),s=[];return i.forEach((e=>{s.push(e.passthrough),e.before&&e.match?s.push(_x(e.before,e.match)):(s.push(e.before),s.push(e.match)),s.push(e.after)})),s=s.filter((e=>e)),s=s.map((e=>Ax(e,this))),this.update(s)}};Px.split=Px.splitAfter;const Tx=Px,Ex=function(e,t){return!(!e||!t)&&e[0]===t[0]&&e[2]===t[1]},xx=function(e,t,n){const r=e.world,i=r.methods.one.parseMatch;n=n||"^.";let s=i(t=t||".$",{},r),a=i(n,{},r);s[s.length-1].end=!0,a[0].start=!0;let o=e.fullPointer,l=[o[0]];for(let t=1;t<o.length;t+=1){let n=l[l.length-1],r=o[t],i=e.update([n]),c=e.update([r]);Ex(n,r)&&i.has(s)&&c.has(a)?l[l.length-1]=[n[0],n[1],r[2],n[3],r[4]]:l.push(r)}return e.update(l)},Ix={joinIf:function(e,t){return xx(this,e,t)},join:function(){return xx(this)}},Cx=Object.assign({},bx,wx,Tx,Ix);Cx.lookBehind=Cx.before,Cx.lookBefore=Cx.before,Cx.lookAhead=Cx.after,Cx.lookAfter=Cx.after,Cx.notIf=Cx.ifNo;const Ox=/(?:^|\s)([![^]*(?:<[^<]*>)?\/.*?[^\\/]\/[?\]+*$~]*)(?:\s|$)/,Sx=/([!~[^]*(?:<[^<]*>)?\([^)]+[^\\)]\)[?\]+*$~]*)(?:\s|$)/,Nx=/ /g,jx=e=>/^[![^]*(<[^<]*>)?\//.test(e)&&/\/[?\]+*$~]*$/.test(e),Dx=function(e){return(e=e.map((e=>e.trim()))).filter((e=>e))},Rx=/\{([0-9]+)?(, *[0-9]*)?\}/,$x=/&&/,Lx=new RegExp(/^<\s*(\S+)\s*>/),Mx=e=>e.charAt(0).toUpperCase()+e.substring(1),Fx=e=>e.charAt(e.length-1),Ux=e=>e.charAt(0),Bx=e=>e.substring(1),Vx=e=>e.substring(0,e.length-1),zx=function(e){return e=Bx(e),Vx(e)},Hx=function(e,t){let n={};for(let r=0;r<2;r+=1){if("$"===Fx(e)&&(n.end=!0,e=Vx(e)),"^"===Ux(e)&&(n.start=!0,e=Bx(e)),"?"===Fx(e)&&(n.optional=!0,e=Vx(e)),("["===Ux(e)||"]"===Fx(e))&&(n.group=null,"["===Ux(e)&&(n.groupStart=!0),"]"===Fx(e)&&(n.groupEnd=!0),e=(e=e.replace(/^\[/,"")).replace(/\]$/,""),"<"===Ux(e))){const t=Lx.exec(e);t.length>=2&&(n.group=t[1],e=e.replace(t[0],""))}if("+"===Fx(e)&&(n.greedy=!0,e=Vx(e)),"*"!==e&&"*"===Fx(e)&&"\\*"!==e&&(n.greedy=!0,e=Vx(e)),"!"===Ux(e)&&(n.negative=!0,e=Bx(e)),"~"===Ux(e)&&"~"===Fx(e)&&e.length>2&&(e=zx(e),n.fuzzy=!0,n.min=t.fuzzy||.85,!1===/\(/.test(e)))return n.word=e,n;if("/"===Ux(e)&&"/"===Fx(e))return e=zx(e),t.caseSensitive&&(n.use="text"),n.regex=new RegExp(e),n;if(!0===Rx.test(e)&&(e=e.replace(Rx,((e,t,r)=>(void 0===r?(n.min=Number(t),n.max=Number(t)):(r=r.replace(/, */,""),void 0===t?(n.min=0,n.max=Number(r)):(n.min=Number(t),n.max=Number(r||999))),n.greedy=!0,n.min||(n.optional=!0),"")))),"("===Ux(e)&&")"===Fx(e)){$x.test(e)?(n.choices=e.split($x),n.operator="and"):(n.choices=e.split("|"),n.operator="or"),n.choices[0]=Bx(n.choices[0]);let r=n.choices.length-1;n.choices[r]=Vx(n.choices[r]),n.choices=n.choices.map((e=>e.trim())),n.choices=n.choices.filter((e=>e)),n.choices=n.choices.map((e=>e.split(/ /g).map((e=>Hx(e,t))))),e=""}if("{"===Ux(e)&&"}"===Fx(e)){if(e=zx(e),n.root=e,/\//.test(e)){let e=n.root.split(/\//);n.root=e[0],n.pos=e[1],"adj"===n.pos&&(n.pos="Adjective"),n.pos=n.pos.charAt(0).toUpperCase()+n.pos.substr(1).toLowerCase(),void 0!==e[2]&&(n.sense=e[2])}return n}if("<"===Ux(e)&&">"===Fx(e))return e=zx(e),n.chunk=Mx(e),n.greedy=!0,n;if("%"===Ux(e)&&"%"===Fx(e))return e=zx(e),n.switch=e,n}return"#"===Ux(e)?(n.tag=Bx(e),n.tag=Mx(n.tag),n):"@"===Ux(e)?(n.method=Bx(e),n):"."===e?(n.anything=!0,n):"*"===e?(n.anything=!0,n.greedy=!0,n.optional=!0,n):(e&&(e=(e=e.replace("\\*","*")).replace("\\.","."),t.caseSensitive?n.use="text":e=e.toLowerCase(),n.word=e),n)},Gx=Hx,qx=/[a-z0-9][-–—][a-z]/i,Kx=function(e,t){let{all:n}=t.methods.two.transform.verb||{},r=e.root;return n?n(r,t.model):[]},Wx=function(e,t){let{all:n}=t.methods.two.transform.noun||{};return n?n(e.root,t.model):[e.root]},Jx=function(e,t){let{all:n}=t.methods.two.transform.adjective||{};return n?n(e.root,t.model):[e.root]},Zx=function(e,t){for(let n of t)if(e.has(n))return!0;return!1},Qx=function(e,t){for(let n=0;n<e.length;n+=1){let r=e[n];if(!0!==r.optional&&!0!==r.negative&&!0!==r.fuzzy){if(void 0!==r.word&&!1===t.has(r.word))return!0;if(void 0!==r.tag&&!1===t.has("#"+r.tag))return!0;if(r.fastOr&&!1===Zx(r.fastOr,t))return!1}}return!1},Xx=/([\u0022\uFF02\u0027\u201C\u2018\u201F\u201B\u201E\u2E42\u201A\u00AB\u2039\u2035\u2036\u2037\u301D\u0060\u301F])/,Yx=/([\u0022\uFF02\u0027\u201D\u2019\u00BB\u203A\u2032\u2033\u2034\u301E\u00B4])/,eI=/^[-–—]$/,tI=/ [-–—]{1,3} /,nI=(e,t)=>-1!==e.post.indexOf(t),rI={hasQuote:e=>Xx.test(e.pre)||Yx.test(e.post),hasComma:e=>nI(e,","),hasPeriod:e=>!0===nI(e,".")&&!1===nI(e,"..."),hasExclamation:e=>nI(e,"!"),hasQuestionMark:e=>nI(e,"?")||nI(e,"¿"),hasEllipses:e=>nI(e,"..")||nI(e,"…"),hasSemicolon:e=>nI(e,";"),hasColon:e=>nI(e,":"),hasSlash:e=>/\//.test(e.text),hasHyphen:e=>eI.test(e.post)||eI.test(e.pre),hasDash:e=>tI.test(e.post)||tI.test(e.pre),hasContraction:e=>Boolean(e.implicit),isAcronym:e=>e.tags.has("Acronym"),isKnown:e=>e.tags.size>0,isTitleCase:e=>/^\p{Lu}[a-z'\u00C0-\u00FF]/u.test(e.text),isUpperCase:e=>/^\p{Lu}+$/u.test(e.text)};rI.hasQuotation=rI.hasQuote;const iI=rI;let sI=function(){};sI=function(e,t,n,r){let i=function(e,t,n,r){if(!0===t.anything)return!0;if(!0===t.start&&0!==n)return!1;if(!0===t.end&&n!==r-1)return!1;if(void 0!==t.id&&t.id===e.id)return!0;if(void 0!==t.word){if(t.use)return t.word===e[t.use];if(null!==e.machine&&e.machine===t.word)return!0;if(void 0!==e.alias&&e.alias.hasOwnProperty(t.word))return!0;if(!0===t.fuzzy){if(t.word===e.root)return!0;if(function(e,t,n=3){if(e===t)return 1;if(e.length<n||t.length<n)return 0;const r=function(e,t){let n=e.length,r=t.length;if(0===n)return r;if(0===r)return n;let i=(r>n?r:n)+1;if(Math.abs(n-r)>(i||100))return i||100;let s,a,o,l,c,u,h=[];for(let e=0;e<i;e++)h[e]=[e],h[e].length=i;for(let e=0;e<i;e++)h[0][e]=e;for(let i=1;i<=n;++i)for(a=e[i-1],s=1;s<=r;++s){if(i===s&&h[i][s]>4)return n;o=t[s-1],l=a===o?0:1,c=h[i-1][s]+1,(u=h[i][s-1]+1)<c&&(c=u),(u=h[i-1][s-1]+l)<c&&(c=u);let r=i>1&&s>1&&a===t[s-2]&&e[i-2]===o&&(u=h[i-2][s-2]+l)<c;h[i][s]=r?u:c}return h[n][r]}(e,t);let i=Math.max(e.length,t.length);return 1-(0===i?0:r/i)}(t.word,e.normal)>=t.min)return!0}return!(!e.alias||!e.alias.some((e=>e===t.word)))||t.word===e.text||t.word===e.normal}if(void 0!==t.tag)return!0===e.tags.has(t.tag);if(void 0!==t.method)return"function"==typeof iI[t.method]&&!0===iI[t.method](e);if(void 0!==t.pre)return e.pre&&e.pre.includes(t.pre);if(void 0!==t.post)return e.post&&e.post.includes(t.post);if(void 0!==t.regex){let n=e.normal;return t.use&&(n=e[t.use]),t.regex.test(n)}if(void 0!==t.chunk)return e.chunk===t.chunk;if(void 0!==t.switch)return e.switch===t.switch;if(void 0!==t.machine)return e.normal===t.machine||e.machine===t.machine||e.root===t.machine;if(void 0!==t.sense)return e.sense===t.sense;if(void 0!==t.fastOr){if(t.pos&&!e.tags.has(t.pos))return null;let n=e.root||e.implicit||e.machine||e.normal;return t.fastOr.has(n)||t.fastOr.has(e.text)}return void 0!==t.choices&&("and"===t.operator?t.choices.every((t=>sI(e,t,n,r))):t.choices.some((t=>sI(e,t,n,r))))}(e,t,n,r);return!0===t.negative?!i:i};const aI=sI,oI=function(e,t){if(!0===e.end&&!0===e.greedy&&t.start_i+t.t<t.phrase_length-1){let n=Object.assign({},e,{end:!1});if(!0===aI(t.terms[t.t],n,t.start_i+t.t,t.phrase_length))return!0}return!1},lI=function(e,t){return e.groups[e.inGroup]||(e.groups[e.inGroup]={start:t,length:0}),e.groups[e.inGroup]},cI=function(e){let{regs:t}=e,n=t[e.r],r=function(e,t){let n=e.t;if(!t)return e.terms.length;for(;n<e.terms.length;n+=1)if(!0===aI(e.terms[n],t,e.start_i+n,e.phrase_length))return n;return null}(e,t[e.r+1]);return null===r||0===r||void 0!==n.min&&r-e.t<n.min?null:void 0!==n.max&&r-e.t>n.max?(e.t=e.t+n.max,!0):(!0===e.hasGroup&&(lI(e,e.t).length=r-e.t),e.t=r,!0)},uI=function(e,t=0){let n=e.regs[e.r],r=!1;for(let s=0;s<n.choices.length;s+=1){let a=n.choices[s];if(i=a,"[object Array]"!==Object.prototype.toString.call(i))return!1;if(r=a.every(((n,r)=>{let i=0,s=e.t+r+t+i;if(void 0===e.terms[s])return!1;let a=aI(e.terms[s],n,s+e.start_i,e.phrase_length);if(!0===a&&!0===n.greedy)for(let t=1;t<e.terms.length;t+=1){let r=e.terms[s+t];if(r){if(!0!==aI(r,n,e.start_i+t,e.phrase_length))break;i+=1}}return t+=i,a})),r){t+=a.length;break}}var i;return r&&!0===n.greedy?uI(e,t):t},hI=function(e){const{regs:t}=e;let n=t[e.r],r=uI(e);if(r){if(!0===n.negative)return null;if(!0===e.hasGroup&&(lI(e,e.t).length+=r),!0===n.end){let t=e.phrase_length;if(e.t+e.start_i+r!==t)return null}return e.t+=r,!0}return!!n.optional||null},dI=function(e){const{regs:t}=e;let n=t[e.r],r=function(e){let t=0;return!0===e.regs[e.r].choices.every((n=>{let r=n.every(((t,n)=>{let r=e.t+n;return void 0!==e.terms[r]&&aI(e.terms[r],t,r,e.phrase_length)}));return!0===r&&n.length>t&&(t=n.length),r}))&&t}(e);if(r){if(!0===n.negative)return null;if(!0===e.hasGroup&&(lI(e,e.t).length+=r),!0===n.end){let t=e.phrase_length-1;if(e.t+e.start_i!==t)return null}return e.t+=r,!0}return!!n.optional||null},pI=function(e){const{regs:t}=e;let n=t[e.r],r=Object.assign({},n);if(r.negative=!1,aI(e.terms[e.t],r,e.start_i+e.t,e.phrase_length))return!1;if(n.optional){let n=t[e.r+1];n&&(aI(e.terms[e.t],n,e.start_i+e.t,e.phrase_length)?e.r+=1:n.optional&&t[e.r+2]&&aI(e.terms[e.t],t[e.r+2],e.start_i+e.t,e.phrase_length)&&(e.r+=2))}return n.greedy?function(e,t,n){let r=0;for(let i=e.t;i<e.terms.length;i+=1){let s=aI(e.terms[i],t,e.start_i+e.t,e.phrase_length);if(s)break;if(n&&(s=aI(e.terms[i],n,e.start_i+e.t,e.phrase_length),s))break;if(r+=1,void 0!==t.max&&r===t.max)break}return!(0===r||t.min&&t.min>r||(e.t+=r,0))}(e,r,t[e.r+1]):(e.t+=1,!0)},fI=function(e){const{regs:t}=e;let n=t[e.r],r=e.terms[e.t],i=e.t;return!!(n.optional&&t[e.r+1]&&n.negative)||(n.optional&&t[e.r+1]&&function(e){const{regs:t}=e;let n=t[e.r],r=e.terms[e.t],i=aI(r,t[e.r+1],e.start_i+e.t,e.phrase_length);if(n.negative||i){let n=e.terms[e.t+1];n&&aI(n,t[e.r+1],e.start_i+e.t,e.phrase_length)||(e.r+=1)}}(e),r.implicit&&e.terms[e.t+1]&&function(e){let t=e.terms[e.t],n=e.regs[e.r];if(t.implicit&&e.terms[e.t+1]){if(!e.terms[e.t+1].implicit)return;n.word===t.normal&&(e.t+=1),"hasContraction"===n.method&&(e.t+=1)}}(e),e.t+=1,!0===n.end&&e.t!==e.terms.length&&!0!==n.greedy?null:!0!==n.greedy||function(e){const{regs:t,phrase_length:n}=e;let r=t[e.r];return e.t=function(e,t){let n=Object.assign({},e.regs[e.r],{start:!1,end:!1}),r=e.t;for(;e.t<e.terms.length;e.t+=1){if(t&&aI(e.terms[e.t],t,e.start_i+e.t,e.phrase_length))return e.t;let i=e.t-r+1;if(void 0!==n.max&&i===n.max)return e.t;if(!1===aI(e.terms[e.t],n,e.start_i+e.t,e.phrase_length))return void 0!==n.min&&i<n.min?null:e.t}return e.t}(e,t[e.r+1]),null===e.t||r.min&&r.min>e.t?null:!0!==r.end||e.start_i+e.t===n||null}(e)?(!0===e.hasGroup&&function(e,t){let n=e.regs[e.r];const r=lI(e,t);e.t>1&&n.greedy?r.length+=e.t-t:r.length++}(e,i),!0):null)},mI=function(e,t,n,r){if(0===e.length||0===t.length)return null;let i={t:0,terms:e,r:0,regs:t,groups:{},start_i:n,phrase_length:r,inGroup:null};for(;i.r<t.length;i.r+=1){let e=t[i.r];if(i.hasGroup=Boolean(e.group),!0===i.hasGroup?i.inGroup=e.group:i.inGroup=null,!i.terms[i.t]){if(!1===t.slice(i.r).some((e=>!e.optional)))break;return null}if(!0!==e.anything||!0!==e.greedy){if(void 0===e.choices||"or"!==e.operator){if(void 0===e.choices||"and"!==e.operator)if(!0!==e.anything){if(!0!==oI(e,i)){if(e.negative){if(!pI(i))return null}else if(!0!==aI(i.terms[i.t],e,i.start_i+i.t,i.phrase_length)){if(!0!==e.optional)return null}else if(!fI(i))return null}else if(!fI(i))return null}else{if(e.negative&&e.anything)return null;if(!fI(i))return null}else if(!dI(i))return null}else if(!hI(i))return null}else if(!cI(i))return null}let s=[null,n,i.t+n];if(s[1]===s[2])return null;let a={};return Object.keys(i.groups).forEach((e=>{let t=i.groups[e],r=n+t.start;a[e]=[null,r,r+t.length]})),{pointer:s,groups:a}},gI=function(e,t){return e.pointer[0]=t,Object.keys(e.groups).forEach((n=>{e.groups[n][0]=t})),e},yI=function(e,t,n){let r=mI(e,t,0,e.length);return r?(r=gI(r,n),r):null},vI={api:function(e){Object.assign(e.prototype,Cx)},methods:{one:{termMethods:iI,parseMatch:function(e,t,n){if(null==e||""===e)return[];t=t||{},"number"==typeof e&&(e=String(e));let r=function(e){let t=e.split(Ox),n=[];t.forEach((e=>{jx(e)?n.push(e):n=n.concat(e.split(Sx))})),n=Dx(n);let r=[];return n.forEach((e=>{(e=>/^[![^]*(<[^<]*>)?\(/.test(e)&&/\)[?\]+*$~]*$/.test(e))(e)||jx(e)?r.push(e):r=r.concat(e.split(Nx))})),r=Dx(r),r}(e);return r=r.map((e=>Gx(e,t))),r=function(e,t){let n=t.model.one.prefixes;for(let t=e.length-1;t>=0;t-=1){let r=e[t];if(r.word&&qx.test(r.word)){let i=r.word.split(/[-–—]/g);if(n.hasOwnProperty(i[0]))continue;i=i.filter((e=>e)).reverse(),e.splice(t,1),i.forEach((n=>{let i=Object.assign({},r);i.word=n,e.splice(t,0,i)}))}}return e}(r,n),r=function(e,t){return e=e.map((e=>{if(e.root)if(t.methods.two&&t.methods.two.transform){let n=[];e.pos?"Verb"===e.pos?n=n.concat(Kx(e,t)):"Noun"===e.pos?n=n.concat(Wx(e,t)):"Adjective"===e.pos&&(n=n.concat(Jx(e,t))):(n=n.concat(Kx(e,t)),n=n.concat(Wx(e,t)),n=n.concat(Jx(e,t))),n=n.filter((e=>e)),n.length>0&&(e.operator="or",e.fastOr=new Set(n))}else e.machine=e.root,delete e.id,delete e.root;return e})),e}(r,n),r=function(e){return e=function(e){let t=0,n=null;for(let r=0;r<e.length;r++){const i=e[r];!0===i.groupStart&&(n=i.group,null===n&&(n=String(t),t+=1)),null!==n&&(i.group=n),!0===i.groupEnd&&(n=null)}return e}(e),e=function(e){return e.map((e=>(e.fuzzy&&e.choices&&e.choices.forEach((t=>{1===t.length&&t[0].word&&(t[0].fuzzy=!0,t[0].min=e.min)})),e)))}(e=e.map((e=>{if(void 0!==e.choices){if("or"!==e.operator)return e;if(!0===e.fuzzy)return e;!0===e.choices.every((e=>{if(1!==e.length)return!1;let t=e[0];return!0!==t.fuzzy&&!t.start&&!t.end&&void 0!==t.word&&!0!==t.negative&&!0!==t.optional&&!0!==t.method}))&&(e.fastOr=new Set,e.choices.forEach((t=>{e.fastOr.add(t[0].word)})),delete e.choices)}return e}))),e}(r),r},match:function(e,t,n){n=n||[];let{regs:r,group:i,justOne:s}=t,a=[];if(!r||0===r.length)return{ptrs:[],byGroup:{}};const o=r.filter((e=>!0!==e.optional&&!0!==e.negative)).length;e:for(let t=0;t<e.length;t+=1){let i=e[t];if(!n[t]||!Qx(r,n[t]))if(!0!==r[0].start)for(let e=0;e<i.length;e+=1){let n=i.slice(e);if(n.length<o)break;let l=mI(n,r,e,i.length);if(l){if(l=gI(l,t),a.push(l),!0===s)break e;let n=l.pointer[2];Math.abs(n-1)>e&&(e=Math.abs(n-1))}}else{let e=yI(i,r,t);e&&a.push(e)}}return!0===r[r.length-1].end&&(a=a.filter((t=>{let n=t.pointer[0];return e[n].length===t.pointer[2]}))),t.notIf&&(a=function(e,t,n){return e=e.filter((e=>{let[r,i,s]=e.pointer,a=n[r].slice(i,s);for(let e=0;e<a.length;e+=1){let n=a.slice(e);if(null!==mI(n,t,e,a.length))return!1}return!0})),e}(a,t.notIf,e)),a=function(e,t){let n=[],r={};return 0===e.length||("number"==typeof t&&(t=String(t)),t?e.forEach((e=>{e.groups[t]&&n.push(e.groups[t])})):e.forEach((e=>{n.push(e.pointer),Object.keys(e.groups).forEach((t=>{r[t]=r[t]||[],r[t].push(e.groups[t])}))}))),{ptrs:n,byGroup:r}}(a,i),a.ptrs.forEach((t=>{let[n,r,i]=t;t[3]=e[n][r].id,t[4]=e[n][i-1].id})),a}}},lib:{parseMatch:function(e,t){const n=this.world();let r=n.methods.one.killUnicode;return r&&(e=r(e,n)),n.methods.one.parseMatch(e,t,n)}}},bI=/^\../,wI=/^#./,_I={html:function(e){let{starts:t,ends:n}=function(e,t){let n={},r={};return Object.keys(t).forEach((i=>{let s=t[i],a=function(e){let t="",n="</span>";return e=(e=>(e=(e=(e=(e=e.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/"/g,"&quot;")).replace(/'/g,"&apos;"))(e),bI.test(e)?t=`<span class="${e.replace(/^\./,"")}"`:wI.test(e)?t=`<span id="${e.replace(/^#/,"")}"`:(t=`<${e}`,n=`</${e}>`),t+=">",{start:t,end:n}}(i);"string"==typeof s&&(s=e.match(s)),s.docs.forEach((e=>{if(e.every((e=>e.implicit)))return;let t=e[0].id;n[t]=n[t]||[],n[t].push(a.start);let i=e[e.length-1].id;r[i]=r[i]||[],r[i].push(a.end)}))})),{starts:n,ends:r}}(this,e),r="";return this.docs.forEach((e=>{for(let i=0;i<e.length;i+=1){let s=e[i];t.hasOwnProperty(s.id)&&(r+=t[s.id].join("")),r+=s.pre||"",r+=s.text||"",n.hasOwnProperty(s.id)&&(r+=n[s.id].join("")),r+=s.post||""}})),r}},kI=/[,:;)\]*.?~!\u0022\uFF02\u201D\u2019\u00BB\u203A\u2032\u2033\u2034\u301E\u00B4—-]+$/,AI=/^[(['"*~\uFF02\u201C\u2018\u201F\u201B\u201E\u2E42\u201A\u00AB\u2039\u2035\u2036\u2037\u301D\u0060\u301F]+/,PI=/[,:;)('"\u201D\]]/,TI=/^[-–—]$/,EI=/ /,xI=function(e,t,n=!0){let r="";return e.forEach((e=>{let n=e.pre||"",i=e.post||"";"some"===t.punctuation&&(n=n.replace(AI,""),TI.test(i)&&(i=" "),i=i.replace(PI,""),i=i.replace(/\?!+/,"?"),i=i.replace(/!+/,"!"),i=i.replace(/\?+/,"?"),i=i.replace(/\.{2,}/,""),e.tags.has("Abbreviation")&&(i=i.replace(/\./,""))),"some"===t.whitespace&&(n=n.replace(/\s/,""),i=i.replace(/\s+/," ")),t.keepPunct||(n=n.replace(AI,""),i="-"===i?" ":i.replace(kI,""));let s=e[t.form||"text"]||e.normal||"";"implicit"===t.form&&(s=e.implicit||e.text),"root"===t.form&&e.implicit&&(s=e.root||e.implicit||e.normal),"machine"!==t.form&&"implicit"!==t.form&&"root"!==t.form||!e.implicit||i&&EI.test(i)||(i+=" "),r+=n+s+i})),!1===n&&(r=r.trim()),!0===t.lowerCase&&(r=r.toLowerCase()),r},II={text:{form:"text"},normal:{whitespace:"some",punctuation:"some",case:"some",unicode:"some",form:"normal"},machine:{keepSpace:!1,whitespace:"some",punctuation:"some",case:"none",unicode:"some",form:"machine"},root:{keepSpace:!1,whitespace:"some",punctuation:"some",case:"some",unicode:"some",form:"root"},implicit:{form:"implicit"}};II.clean=II.normal,II.reduced=II.root;const CI=II;let OI=[],SI=0;for(;SI<64;)OI[SI]=0|4294967296*Math.sin(++SI%Math.PI);const NI=function(e){let t,n,r,i=[t=1732584193,n=4023233417,~t,~n],s=[],a=decodeURI(encodeURI(e))+"",o=a.length;for(e=--o/4+2|15,s[--e]=8*o;~o;)s[o>>2]|=a.charCodeAt(o)<<8*o--;for(SI=a=0;SI<e;SI+=16){for(o=i;a<64;o=[r=o[3],t+((r=o[0]+[t&n|~t&r,r&t|~r&n,t^n^r,n^(t|~r)][o=a>>4]+OI[a]+~~s[SI|15&[a,5*a+1,3*a+5,7*a][o]])<<(o=[7,12,17,22,5,9,14,20,4,11,16,23,6,10,15,21][4*o+a++%4])|r>>>-o),t,n])t=0|o[1],n=o[2];for(a=4;a;)i[--a]+=o[a]}for(e="";a<32;)e+=(i[a>>3]>>4*(1^a++)&15).toString(16);return e},jI={text:!0,terms:!0};let DI={case:"none",unicode:"some",form:"machine",punctuation:"some"};const RI=function(e,t){return Object.assign({},e,t)},$I={text:e=>xI(e,{keepPunct:!0},!1),normal:e=>xI(e,RI(CI.normal,{keepPunct:!0}),!1),implicit:e=>xI(e,RI(CI.implicit,{keepPunct:!0}),!1),machine:e=>xI(e,DI,!1),root:e=>xI(e,RI(DI,{form:"root"}),!1),hash:e=>NI(xI(e,{keepPunct:!0},!1)),offset:e=>{let t=$I.text(e).length;return{index:e[0].offset.index,start:e[0].offset.start,length:t}},terms:e=>e.map((e=>{let t=Object.assign({},e);return t.tags=Array.from(e.tags),t})),confidence:(e,t,n)=>t.eq(n).confidence(),syllables:(e,t,n)=>t.eq(n).syllables(),sentence:(e,t,n)=>t.eq(n).fullSentence().text(),dirty:e=>e.some((e=>!0===e.dirty))};$I.sentences=$I.sentence,$I.clean=$I.normal,$I.reduced=$I.root;const LI={json:function(e){let t=function(e,t){return"string"==typeof(t=t||{})&&(t={}),(t=Object.assign({},jI,t)).offset&&e.compute("offset"),e.docs.map(((n,r)=>{let i={};return Object.keys(t).forEach((s=>{t[s]&&$I[s]&&(i[s]=$I[s](n,e,r))})),i}))}(this,e);return"number"==typeof e?t[e]:t}};LI.data=LI.json;const MI=LI,FI=function(e){let t=e.pre||"",n=e.post||"";return t+e.text+n},UI=function(e,t){let n=function(e,t){let n={};return Object.keys(t).forEach((r=>{e.match(r).fullPointer.forEach((e=>{n[e[3]]={fn:t[r],end:e[2]}}))})),n}(e,t),r="";return e.docs.forEach(((t,i)=>{for(let s=0;s<t.length;s+=1){let a=t[s];if(n.hasOwnProperty(a.id)){let{fn:o,end:l}=n[a.id],c=e.update([[i,s,l]]);r+=t[s].pre||"",r+=o(c),s=l-1,r+=t[s].post||""}else r+=FI(a)}})),r},BI={debug:function(e){let t=this.methods.one.debug||{};return e&&t.hasOwnProperty(e)?(t[e](this),this):"undefined"!=typeof window&&window.document?(t.clientSide(this),this):(t.tags(this),this)},out:function(e){if(t=e,"[object Object]"===Object.prototype.toString.call(t))return UI(this,e);var t;if("text"===e)return this.text();if("normal"===e)return this.text("normal");if("root"===e)return this.text("root");if("machine"===e||"reduced"===e)return this.text("machine");if("hash"===e||"md5"===e)return NI(this.text());if("json"===e)return this.json();if("offset"===e||"offsets"===e)return this.compute("offset"),this.json({offset:!0});if("array"===e){let e=this.docs.map((e=>e.reduce(((e,t)=>e+t.pre+t.text+t.post),"").trim()));return e.filter((e=>e))}if("freq"===e||"frequency"===e||"topk"===e)return function(e){let t={};e.forEach((e=>{t[e]=t[e]||0,t[e]+=1}));let n=Object.keys(t).map((e=>({normal:e,count:t[e]})));return n.sort(((e,t)=>e.count>t.count?-1:0))}(this.json({normal:!0}).map((e=>e.normal)));if("terms"===e){let e=[];return this.docs.forEach((t=>{let n=t.map((e=>e.text));n=n.filter((e=>e)),e=e.concat(n)})),e}return"tags"===e?this.docs.map((e=>e.reduce(((e,t)=>(e[t.implicit||t.normal]=Array.from(t.tags),e)),{}))):"debug"===e?this.debug():this.text()},wrap:function(e){return UI(this,e)}},VI=BI,zI={text:function(e){let t={};var n;if(e&&"string"==typeof e&&CI.hasOwnProperty(e)?t=Object.assign({},CI[e]):e&&(n=e,"[object Object]"===Object.prototype.toString.call(n))&&(t=Object.assign({},e)),void 0!==t.keepSpace||this.isFull()||(t.keepSpace=!1),void 0===t.keepEndPunct&&this.pointer){let e=this.pointer[0];e&&e[1]?t.keepEndPunct=!1:t.keepEndPunct=!0}return void 0===t.keepPunct&&(t.keepPunct=!0),void 0===t.keepSpace&&(t.keepSpace=!0),function(e,t){let n="";if(!e||!e[0]||!e[0][0])return n;for(let r=0;r<e.length;r+=1)n+=xI(e[r],t,!0);if(t.keepSpace||(n=n.trim()),!1===t.keepEndPunct){e[0][0].tags.has("Emoticon")||(n=n.replace(AI,""));let t=e[e.length-1];t[t.length-1].tags.has("Emoticon")||(n=n.replace(kI,"")),n.endsWith("'")&&!n.endsWith("s'")&&(n=n.replace(/'/,""))}return!0===t.cleanWhitespace&&(n=n.trim()),n}(this.docs,t)}},HI=Object.assign({},VI,zI,MI,_I),GI="[0m",qI={green:e=>"[32m"+e+GI,red:e=>"[31m"+e+GI,blue:e=>"[34m"+e+GI,magenta:e=>"[35m"+e+GI,cyan:e=>"[36m"+e+GI,yellow:e=>"[33m"+e+GI,black:e=>"[30m"+e+GI,dim:e=>"[2m"+e+GI,i:e=>"[3m"+e+GI},KI=qI,WI={api:function(e){Object.assign(e.prototype,HI)},methods:{one:{hash:NI,debug:{tags:function(e){let{docs:t,model:n}=e;0===t.length&&console.log(KI.blue("\n     ──────")),t.forEach((t=>{console.log(KI.blue("\n  ┌─────────")),t.forEach((t=>{let r=[...t.tags||[]],i=t.text||"-";t.sense&&(i=`{${t.normal}/${t.sense}}`),t.implicit&&(i="["+t.implicit+"]"),i=KI.yellow(i);let s="'"+i+"'";if(t.reference){let n=e.update([t.reference]).text("normal");s+=` - ${KI.dim(KI.i("["+n+"]"))}`}s=s.padEnd(18);let a=KI.blue("  │ ")+KI.i(s)+"  - "+function(e,t){return t.one.tagSet&&(e=e.map((e=>{if(!t.one.tagSet.hasOwnProperty(e))return e;const n=t.one.tagSet[e].color||"blue";return KI[n](e)}))),e.join(", ")}(r,n);console.log(a)}))})),console.log("\n")},clientSide:function(e){console.log("%c -=-=- ","background-color:#6699cc;"),e.forEach((e=>{console.groupCollapsed(e.text());let t=e.docs[0].map((e=>{let t=e.text||"-";return e.implicit&&(t="["+e.implicit+"]"),{text:t,tags:"["+Array.from(e.tags).join(", ")+"]"}}));console.table(t,["text","tags"]),console.groupEnd()}))},chunks:function(e){let{docs:t}=e;console.log(""),t.forEach((e=>{let t=[];e.forEach((e=>{"Noun"===e.chunk?t.push(KI.blue(e.implicit||e.normal)):"Verb"===e.chunk?t.push(KI.green(e.implicit||e.normal)):"Adjective"===e.chunk?t.push(KI.yellow(e.implicit||e.normal)):"Pivot"===e.chunk?t.push(KI.red(e.implicit||e.normal)):t.push(e.implicit||e.normal)})),console.log(t.join(" "),"\n")})),console.log("\n")},highlight:function(e){if(!e.found)return;let t={};e.fullPointer.forEach((e=>{t[e[0]]=t[e[0]]||[],t[e[0]].push(e)})),Object.keys(t).forEach((n=>{let r=e.update([[Number(n)]]).text();e.update(t[n]).json({offset:!0}).forEach(((e,t)=>{r=function(e,t,n){let r=((e,t,n)=>{let r=9*n,i=t.start+r,s=i+t.length;return[e.substring(0,i),e.substring(i,s),e.substring(s,e.length)]})(e,t,n);return`${r[0]}${KI.blue(r[1])}${r[2]}`}(r,e.offset,t)})),console.log(r)})),console.log("\n")}}}}},JI=function(e,t){if(e[0]!==t[0])return!1;let[,n,r]=e,[,i,s]=t;return n<=i&&r>i||i<=n&&s>n},ZI=function(e){let t={};return e.forEach((e=>{t[e[0]]=t[e[0]]||[],t[e[0]].push(e)})),t},QI=function(e,t){let n=ZI(t),r=[];return e.forEach((e=>{let[t]=e,i=n[t]||[];if(i=i.filter((t=>function(e,t){return e[1]<=t[1]&&t[2]<=e[2]}(e,t))),0===i.length)return void r.push({passthrough:e});i=i.sort(((e,t)=>e[1]-t[1]));let s=e;i.forEach(((e,t)=>{let n=function(e,t){let[n,r]=e,i=t[1],s=t[2],a={};if(r<i){let t=i<e[2]?i:e[2];a.before=[n,r,t]}return a.match=t,e[2]>s&&(a.after=[n,s,e[2]]),a}(s,e);i[t+1]?(r.push({before:n.before,match:n.match}),n.after&&(s=n.after)):r.push(n)}))})),r},XI={one:{termList:function(e){let t=[];for(let n=0;n<e.length;n+=1)for(let r=0;r<e[n].length;r+=1)t.push(e[n][r]);return t},getDoc:function(e,t){let n=[];return e.forEach(((r,i)=>{if(!r)return;let[s,a,o,l,c]=r,u=t[s]||[];if(void 0===a&&(a=0),void 0===o&&(o=u.length),!l||u[a]&&u[a].id===l)u=u.slice(a,o);else{let n=function(e,t,n){for(let r=0;r<20;r+=1){if(t[n-r]){let i=t[n-r].findIndex((t=>t.id===e));if(-1!==i)return[n-r,i]}if(t[n+r]){let i=t[n+r].findIndex((t=>t.id===e));if(-1!==i)return[n+r,i]}}return null}(l,t,s);if(null!==n){let r=o-a;u=t[n[0]].slice(n[1],n[1]+r);let s=u[0]?u[0].id:null;e[i]=[n[0],n[1],n[1]+r,s]}}0!==u.length&&a!==o&&(c&&u[u.length-1].id!==c&&(u=function(e,t){let[n,r,,,i]=e,s=t[n],a=s.findIndex((e=>e.id===i));return-1===a?(e[2]=t[n].length,e[4]=s.length?s[s.length-1].id:null):e[2]=a,t[n].slice(r,e[2]+1)}(r,t)),n.push(u))})),n=n.filter((e=>e.length>0)),n},pointer:{indexN:ZI,splitAll:QI}}},YI=function(e,t){let n=e.concat(t),r=ZI(n),i=[];return n.forEach((e=>{let[t]=e;if(1===r[t].length)return void i.push(e);let n=r[t].filter((t=>JI(e,t)));n.push(e);let s=function(e){let t=e[0][1],n=e[0][2];return e.forEach((e=>{e[1]<t&&(t=e[1]),e[2]>n&&(n=e[2])})),[e[0][0],t,n]}(n);i.push(s)})),i=function(e){let t={};for(let n=0;n<e.length;n+=1)t[e[n].join(",")]=e[n];return Object.values(t)}(i),i},eC=function(e,t){let n=[];return QI(e,t).forEach((e=>{e.passthrough&&n.push(e.passthrough),e.before&&n.push(e.before),e.after&&n.push(e.after)})),n},tC=(e,t)=>{return"string"==typeof e||(n=e,"[object Array]"===Object.prototype.toString.call(n))?t.match(e):e||t.none();var n},nC=function(e,t){return e.map((e=>{let[n,r]=e;return t[n]&&t[n][r]&&(e[3]=t[n][r].id),e}))},rC={union:function(e){e=tC(e,this);let t=YI(this.fullPointer,e.fullPointer);return t=nC(t,this.document),this.toView(t)}};rC.and=rC.union,rC.intersection=function(e){e=tC(e,this);let t=function(e,t){let n=ZI(t),r=[];return e.forEach((e=>{let t=n[e[0]]||[];t=t.filter((t=>JI(e,t))),0!==t.length&&t.forEach((t=>{let n=function(e,t){let n=e[1]<t[1]?t[1]:e[1],r=e[2]>t[2]?t[2]:e[2];return n<r?[e[0],n,r]:null}(e,t);n&&r.push(n)}))})),r}(this.fullPointer,e.fullPointer);return t=nC(t,this.document),this.toView(t)},rC.not=function(e){e=tC(e,this);let t=eC(this.fullPointer,e.fullPointer);return t=nC(t,this.document),this.toView(t)},rC.difference=rC.not,rC.complement=function(){let e=this.all(),t=eC(e.fullPointer,this.fullPointer);return t=nC(t,this.document),this.toView(t)},rC.settle=function(){let e=this.fullPointer;return e.forEach((t=>{e=YI(e,[t])})),e=nC(e,this.document),this.update(e)};const iC={methods:XI,api:function(e){Object.assign(e.prototype,rC)}},sC=function(e){return!0===e.optional||!0===e.negative?null:e.tag?"#"+e.tag:e.word?e.word:e.switch?`%${e.switch}%`:null},aC={lib:{buildNet:function(e){let t=this.methods().one.buildNet(e,this.world());return t.isNet=!0,t}},api:function(e){e.prototype.sweep=function(e,t={}){const{world:n,docs:r}=this,{methods:i}=n;let s=i.one.bulkMatch(r,e,this.methods,t);!1!==t.tagger&&i.one.bulkTagger(s,r,this.world),s=s.map((e=>{let t=e.pointer,n=r[t[0]][t[1]],i=t[2]-t[1];return n.index&&(e.pointer=[n.index[0],n.index[1],t[1]+i]),e}));let a=s.map((e=>e.pointer));return s=s.map((e=>(e.view=this.update([e.pointer]),delete e.regs,delete e.needs,delete e.pointer,delete e._expanded,e))),{view:this.update(a),found:s}}},methods:{one:{buildNet:function(e,t){e=function(e,t){const n=t.methods.one.parseMatch;return e.forEach((e=>{e.regs=n(e.match,{},t),"string"==typeof e.ifNo&&(e.ifNo=[e.ifNo]),e.notIf&&(e.notIf=n(e.notIf,{},t)),e.needs=function(e){let t=[];return e.forEach((e=>{t.push(sC(e)),"and"===e.operator&&e.choices&&e.choices.forEach((e=>{e.forEach((e=>{t.push(sC(e))}))}))})),t.filter((e=>e))}(e.regs);let{wants:r,count:i}=function(e){let t=[],n=0;return e.forEach((e=>{"or"!==e.operator||e.optional||e.negative||(e.fastOr&&Array.from(e.fastOr).forEach((e=>{t.push(e)})),e.choices&&e.choices.forEach((e=>{e.forEach((e=>{let n=sC(e);n&&t.push(n)}))})),n+=1)})),{wants:t,count:n}}(e.regs);e.wants=r,e.minWant=i,e.minWords=e.regs.filter((e=>!e.optional)).length})),e}(e,t);let n={};e.forEach((e=>{e.needs.forEach((t=>{n[t]=Array.isArray(n[t])?n[t]:[],n[t].push(e)})),e.wants.forEach((t=>{n[t]=Array.isArray(n[t])?n[t]:[],n[t].push(e)}))})),Object.keys(n).forEach((e=>{let t={};n[e]=n[e].filter((e=>"boolean"!=typeof t[e.match]&&(t[e.match]=!0,!0)))}));let r=e.filter((e=>0===e.needs.length&&0===e.wants.length));return{hooks:n,always:r}},bulkMatch:function(e,t,n,r={}){let i=n.one.cacheDoc(e),s=function(e,t){return e.map(((n,r)=>{let i=[];Object.keys(t).forEach((n=>{e[r].has(n)&&(i=i.concat(t[n]))}));let s={};return i=i.filter((e=>"boolean"!=typeof s[e.match]&&(s[e.match]=!0,!0))),i}))}(i,t.hooks);return s=function(e,t){return e.map(((e,n)=>{let r=t[n];return(e=(e=e.filter((e=>e.needs.every((e=>r.has(e)))))).filter((e=>void 0===e.ifNo||!0!==e.ifNo.some((e=>r.has(e)))))).filter((e=>0===e.wants.length||e.wants.filter((e=>r.has(e))).length>=e.minWant))}))}(s,i),t.always.length>0&&(s=s.map((e=>e.concat(t.always)))),s=function(e,t){return e.map(((e,n)=>{let r=t[n].length;return e.filter((e=>r>=e.minWords))}))}(s,e),function(e,t,n,r,i){let s=[];for(let n=0;n<e.length;n+=1)for(let a=0;a<e[n].length;a+=1){let o=e[n][a],l=r.one.match([t[n]],o);if(l.ptrs.length>0&&(l.ptrs.forEach((e=>{e[0]=n;let t=Object.assign({},o,{pointer:e});void 0!==o.unTag&&(t.unTag=o.unTag),s.push(t)})),!0===i.matchOne))return[s[0]]}return s}(s,e,0,n,r)},bulkTagger:function(e,t,n){const{model:r,methods:i}=n,{getDoc:s,setTag:a,unTag:o}=i.one,l=i.two.looksPlural;return 0===e.length?e:(("undefined"!=typeof process&&process.env?process.env:self.env||{}).DEBUG_TAGS&&console.log(`\n\n  [32m→ ${e.length} post-tagger:[0m`),e.map((e=>{if(!e.tag&&!e.chunk&&!e.unTag)return;let i=e.reason||e.match,c=s([e.pointer],t)[0];if(!0===e.safe){if(!1===function(e,t,n){let r=n.one.tagSet;if(!r.hasOwnProperty(t))return!0;let i=r[t].not||[];for(let t=0;t<e.length;t+=1){let n=e[t];for(let e=0;e<i.length;e+=1)if(!0===n.tags.has(i[e]))return!1}return!0}(c,e.tag,r))return;if("-"===c[c.length-1].post)return}if(void 0!==e.tag){if(a(c,e.tag,n,e.safe,`[post] '${i}'`),"Noun"===e.tag&&l){let t=c[c.length-1];l(t.text)?a([t],"Plural",n,e.safe,"quick-plural"):a([t],"Singular",n,e.safe,"quick-singular")}!0===e.freeze&&c.forEach((e=>e.frozen=!0))}void 0!==e.unTag&&o(c,e.unTag,n,e.safe,i),e.chunk&&c.forEach((t=>t.chunk=e.chunk))})))}}}},oC=/ /,lC=function(e,t){"Noun"===t&&(e.chunk=t),"Verb"===t&&(e.chunk=t)},cC=function(e,t,n,r){if(!0===e.tags.has(t))return null;if("."===t)return null;!0===e.frozen&&(r=!0);let i=n[t];if(i){if(i.not&&i.not.length>0)for(let t=0;t<i.not.length;t+=1){if(!0===r&&e.tags.has(i.not[t]))return null;e.tags.delete(i.not[t])}if(i.parents&&i.parents.length>0)for(let t=0;t<i.parents.length;t+=1)e.tags.add(i.parents[t]),lC(e,i.parents[t])}return e.tags.add(t),e.dirty=!0,lC(e,t),!0},uC=function(e,t,n={},r,i){const s=n.model.one.tagSet||{};if(!t)return;const a="undefined"!=typeof process&&process.env?process.env:self.env||{};var o;if(a&&a.DEBUG_TAGS&&((e,t,n="")=>{let r=e.map((e=>e.text||"["+e.implicit+"]")).join(" ");"string"!=typeof t&&t.length>2&&(t=t.slice(0,2).join(", #")+" +"),t="string"!=typeof t?t.join(", #"):t,console.log(` ${(e=>"[33m[3m"+e+"[0m")(r).padEnd(24)} [32m→[0m #${t.padEnd(22)}  ${(e=>"[3m"+e+"[0m")(n)}`)})(e,t,i),1!=(o=t,"[object Array]"===Object.prototype.toString.call(o)))if("string"==typeof t)if(t=t.trim(),oC.test(t))!function(e,t,n,r){let i=t.split(oC);e.forEach(((e,t)=>{let s=i[t];s&&(s=s.replace(/^#/,""),cC(e,s,n,r))}))}(e,t,s,r);else{t=t.replace(/^#/,"");for(let n=0;n<e.length;n+=1)cC(e[n],t,s,r)}else console.warn(`compromise: Invalid tag '${t}'`);else t.forEach((t=>uC(e,t,n,r)))},hC=uC,dC=function(e){return e.children=e.children||[],e._cache=e._cache||{},e.props=e.props||{},e._cache.parents=e._cache.parents||[],e._cache.children=e._cache.children||[],e},pC=/^ *(#|\/\/)/,fC=function(e){let t=e.trim().split(/->/),n=[];t.forEach((e=>{n=n.concat(function(e){if(!(e=e.trim()))return null;if(/^\[/.test(e)&&/\]$/.test(e)){let t=(e=(e=e.replace(/^\[/,"")).replace(/\]$/,"")).split(/,/);return t=t.map((e=>e.trim())).filter((e=>e)),t=t.map((e=>dC({id:e}))),t}return[dC({id:e})]}(e))})),n=n.filter((e=>e));let r=n[0];for(let e=1;e<n.length;e+=1)r.children.push(n[e]),r=n[e];return n[0]},mC=(e,t)=>{let n=[],r=[e];for(;r.length>0;){let e=r.pop();n.push(e),e.children&&e.children.forEach((n=>{t&&t(e,n),r.push(n)}))}return n},gC=e=>"[object Array]"===Object.prototype.toString.call(e),yC=e=>(e=e||"").trim(),vC=function(e,t){let n="-> ";t&&(n="[2m→ [0m");let r="";return mC(e).forEach(((e,i)=>{let s=e.id||"";if(t&&(s=(e=>"[31m"+e+"[0m")(s)),0===i&&!e.id)return;let a=e._cache.parents.length;r+="    ".repeat(a)+n+s+"\n"})),r},bC=function(e){let t=mC(e);t.forEach((e=>{delete(e=Object.assign({},e)).children}));let n=t[0];return n&&!n.id&&0===Object.keys(n.props).length&&t.shift(),t},wC={text:vC,txt:vC,array:bC,flat:bC},_C=function(e,t){return"nested"===t||"json"===t?e:"debug"===t?(console.log(vC(e,!0)),null):wC.hasOwnProperty(t)?wC[t](e):e},kC=e=>{mC(e,((e,t)=>{e.id&&(e._cache.parents=e._cache.parents||[],t._cache.parents=e._cache.parents.concat([e.id]))}))},AC=/\//;class PC{constructor(e={}){Object.defineProperty(this,"json",{enumerable:!1,value:e,writable:!0})}get children(){return this.json.children}get id(){return this.json.id}get found(){return this.json.id||this.json.children.length>0}props(e={}){let t=this.json.props||{};return"string"==typeof e&&(t[e]=!0),this.json.props=Object.assign(t,e),this}get(e){if(e=yC(e),!AC.test(e)){let t=this.json.children.find((t=>t.id===e));return new PC(t)}let t=((e,t)=>{let n=(e=>"string"!=typeof e?e:(e=e.replace(/^\//,"")).split(/\//))(t=t||"");for(let t=0;t<n.length;t+=1){let r=e.children.find((e=>e.id===n[t]));if(!r)return null;e=r}return e})(this.json,e)||dC({});return new PC(t)}add(e,t={}){if(gC(e))return e.forEach((e=>this.add(yC(e),t))),this;e=yC(e);let n=dC({id:e,props:t});return this.json.children.push(n),new PC(n)}remove(e){return e=yC(e),this.json.children=this.json.children.filter((t=>t.id!==e)),this}nodes(){return mC(this.json).map((e=>(delete(e=Object.assign({},e)).children,e)))}cache(){return(e=>{let t=mC(e,((e,t)=>{e.id&&(e._cache.parents=e._cache.parents||[],e._cache.children=e._cache.children||[],t._cache.parents=e._cache.parents.concat([e.id]))})),n={};t.forEach((e=>{e.id&&(n[e.id]=e)})),t.forEach((e=>{e._cache.parents.forEach((t=>{n.hasOwnProperty(t)&&n[t]._cache.children.push(e.id)}))})),e._cache.children=Object.keys(n)})(this.json),this}list(){return mC(this.json)}fillDown(){var e;return e=this.json,mC(e,((e,t)=>{t.props=((e,t)=>(Object.keys(t).forEach((n=>{if(t[n]instanceof Set){let r=e[n]||new Set;e[n]=new Set([...r,...t[n]])}else if((e=>e&&"object"==typeof e&&!Array.isArray(e))(t[n])){let r=e[n]||{};e[n]=Object.assign({},t[n],r)}else gC(t[n])?e[n]=t[n].concat(e[n]||[]):void 0===e[n]&&(e[n]=t[n])})),e))(t.props,e.props)})),this}depth(){kC(this.json);let e=mC(this.json),t=e.length>1?1:0;return e.forEach((e=>{if(0===e._cache.parents.length)return;let n=e._cache.parents.length+1;n>t&&(t=n)})),t}out(e){return kC(this.json),_C(this.json,e)}debug(){return kC(this.json),_C(this.json,"debug"),this}}const TC=function(e){let t=function(e=[]){return"string"==typeof e?function(e){let t=e.split(/\r?\n/),n=[];t.forEach((e=>{if(!e.trim()||pC.test(e))return;let t=(e=>{const t=/^( {2}|\t)/;let n=0;for(;t.test(e);)e=e.replace(t,""),n+=1;return n})(e);n.push({indent:t,node:fC(e)})}));let r=function(e){let t={children:[]};return e.forEach(((n,r)=>{0===n.indent?t.children=t.children.concat(n.node):e[r-1]&&function(e,t){let n=e[t].indent;for(;t>=0;t-=1)if(e[t].indent<n)return e[t];return e[0]}(e,r).node.children.push(n.node)})),t}(n);return r=dC(r),r}(e):gC(e)?function(e){let t={};e.forEach((e=>{t[e.id]=e}));let n=dC({});return e.forEach((e=>{if((e=dC(e)).parent)if(t.hasOwnProperty(e.parent)){let n=t[e.parent];delete e.parent,n.children.push(e)}else console.warn(`[Grad] - missing node '${e.parent}'`);else n.children.push(e)})),n}(e):(mC(t=e).forEach(dC),t);var t}(e);return new PC(t)};TC.prototype.plugin=function(e){e(this)};const EC={Noun:"blue",Verb:"green",Negative:"green",Date:"red",Value:"red",Adjective:"magenta",Preposition:"cyan",Conjunction:"cyan",Determiner:"cyan",Hyphenated:"cyan",Adverb:"cyan"},xC=function(e){if(EC.hasOwnProperty(e.id))return EC[e.id];if(EC.hasOwnProperty(e.is))return EC[e.is];let t=e._cache.parents.find((e=>EC[e]));return EC[t]},IC=function(e){return e?"string"==typeof e?[e]:e:[]},CC={one:{setTag:hC,unTag:function(e,t,n){t=t.trim().replace(/^#/,"");for(let r=0;r<e.length;r+=1){let i=e[r];if(!0===i.frozen)continue;if("*"===t){i.tags.clear();continue}let s=n[t];if(s&&s.children.length>0)for(let e=0;e<s.children.length;e+=1)i.tags.delete(s.children[e]);i.tags.delete(t)}},addTags:function(e,t){Object.keys(t).length>0&&(e=function(e){return Object.keys(e).forEach((t=>{e[t]=Object.assign({},e[t]),e[t].novel=!0})),e}(e)),e=function(e,t){return e=function(e,t){return Object.keys(e).forEach((n=>{e[n].isA&&(e[n].is=e[n].isA),e[n].notA&&(e[n].not=e[n].notA),e[n].is&&"string"==typeof e[n].is&&(t.hasOwnProperty(e[n].is)||e.hasOwnProperty(e[n].is)||(e[e[n].is]={})),e[n].not&&"string"==typeof e[n].not&&!e.hasOwnProperty(e[n].not)&&(t.hasOwnProperty(e[n].not)||e.hasOwnProperty(e[n].not)||(e[e[n].not]={}))})),e}(e,t),Object.keys(e).forEach((t=>{e[t].children=IC(e[t].children),e[t].not=IC(e[t].not)})),Object.keys(e).forEach((t=>{(e[t].not||[]).forEach((n=>{e[n]&&e[n].not&&e[n].not.push(t)}))})),e}(e,t);const n=function(e){const t=Object.keys(e).map((t=>{let n=e[t];const r={not:new Set(n.not),also:n.also,is:n.is,novel:n.novel};return{id:t,parent:n.is,props:r,children:[]}}));return TC(t).cache().fillDown().out("array")}(Object.assign({},t,e));return function(e){const t={};return e.forEach((e=>{let{not:n,also:r,is:i,novel:s}=e.props,a=e._cache.parents;r&&(a=a.concat(r)),t[e.id]={is:i,not:n,novel:s,also:r,parents:a,children:e._cache.children,color:xC(e)}})),Object.keys(t).forEach((e=>{let n=new Set(t[e].not);t[e].not.forEach((e=>{t[e]&&t[e].children.forEach((e=>n.add(e)))})),t[e].not=Array.from(n)})),t}(n)},canBe:function(e,t,n){if(!n.hasOwnProperty(t))return!0;let r=n[t].not||[];for(let t=0;t<r.length;t+=1)if(e.tags.has(r[t]))return!1;return!0}}},OC=function(e){return"[object Array]"===Object.prototype.toString.call(e)},SC={tag:function(e,t="",n){if(!this.found||!e)return this;let r=this.termList();if(0===r.length)return this;const{methods:i,verbose:s,world:a}=this;return!0===s&&console.log(" +  ",e,t||""),OC(e)?e.forEach((e=>i.one.setTag(r,e,a,n,t))):i.one.setTag(r,e,a,n,t),this.uncache(),this},tagSafe:function(e,t=""){return this.tag(e,t,!0)},unTag:function(e,t){if(!this.found||!e)return this;let n=this.termList();if(0===n.length)return this;const{methods:r,verbose:i,model:s}=this;!0===i&&console.log(" -  ",e,t||"");let a=s.one.tagSet;return OC(e)?e.forEach((e=>r.one.unTag(n,e,a))):r.one.unTag(n,e,a),this.uncache(),this},canBe:function(e){e=e.replace(/^#/,"");let t=this.model.one.tagSet,n=this.methods.one.canBe,r=[];this.document.forEach(((i,s)=>{i.forEach(((i,a)=>{n(i,e,t)||r.push([s,a,a+1])}))}));let i=this.update(r);return this.difference(i)}},NC=SC,jC=new Set(["Auxiliary","Possessive"]),DC={model:{one:{tagSet:{}}},compute:{tagRank:function(e){const{document:t,world:n}=e,r=n.model.one.tagSet;t.forEach((e=>{e.forEach((e=>{let t=Array.from(e.tags);e.tagRank=function(e,t){return e=e.sort(((e,n)=>{if(jC.has(e)||!t.hasOwnProperty(n))return 1;if(jC.has(n)||!t.hasOwnProperty(e))return-1;let r=t[e].children||[],i=r.length;return r=t[n].children||[],i-r.length})),e}(t,r)}))}))}},methods:CC,api:function(e){Object.assign(e.prototype,NC)},lib:{addTags:function(e){const{model:t,methods:n}=this.world(),r=t.one.tagSet;let i=(0,n.one.addTags)(e,r);return t.one.tagSet=i,this}}},RC=/([.!?\u203D\u2E18\u203C\u2047-\u2049\u3002]+\s)/g,$C=/^[.!?\u203D\u2E18\u203C\u2047-\u2049\u3002]+\s$/,LC=/((?:\r?\n|\r)+)/,MC=/[a-z0-9\u00C0-\u00FF\u00a9\u00ae\u2000-\u3300\ud000-\udfff]/i,FC=/\S/,UC={'"':'"',"＂":"＂","“":"”","‟":"”","„":"”","⹂":"”","‚":"’","«":"»","‹":"›","‵":"′","‶":"″","‷":"‴","〝":"〞","〟":"〞"},BC=RegExp("["+Object.keys(UC).join("")+"]","g"),VC=RegExp("["+Object.values(UC).join("")+"]","g"),zC=function(e){if(!e)return!1;let t=e.match(VC);return null!==t&&1===t.length},HC=/\(/g,GC=/\)/g,qC=/\S/,KC=/^\s+/,WC=function(e,t){let n=e.split(/[-–—]/);if(n.length<=1)return!1;const{prefixes:r,suffixes:i}=t.one;return!(1===n[0].length&&/[a-z]/i.test(n[0])||r.hasOwnProperty(n[0])||(n[1]=n[1].trim().replace(/[.?!]$/,""),i.hasOwnProperty(n[1])||!0!==/^([a-z\u00C0-\u00FF`"'/]+)[-–—]([a-z0-9\u00C0-\u00FF].*)/i.test(e)&&!0!==/^[('"]?([0-9]{1,4})[-–—]([a-z\u00C0-\u00FF`"'/-]+[)'"]?$)/i.test(e)))},JC=function(e){let t=[];const n=e.split(/[-–—]/);let r="-",i=e.match(/[-–—]/);i&&i[0]&&(r=i);for(let e=0;e<n.length;e++)e===n.length-1?t.push(n[e]):t.push(n[e]+r);return t},ZC=/\p{L} ?\/ ?\p{L}+$/u,QC=/\S/,XC=/^[!?.]+$/,YC=/(\S+)/;let eO=[".","?","!",":",";","-","–","—","--","...","(",")","[","]",'"',"'","`","«","»","*","•"];eO=eO.reduce(((e,t)=>(e[t]=!0,e)),{});const tO=/\p{Letter}/u,nO=/[\p{Number}\p{Currency_Symbol}]/u,rO=/^[a-z]\.([a-z]\.)+/i,iO=/[sn]['’]$/,sO=/([A-Z]\.)+[A-Z]?,?$/,aO=/^[A-Z]\.,?$/,oO=/[A-Z]{2,}('s|,)?$/,lO=/([a-z]\.)+[a-z]\.?$/,cO=function(e,t){const n=t.methods.one.killUnicode;let r=e.text||"";r=function(e){let t=e=(e=(e=e||"").toLowerCase()).trim();return e=(e=(e=e.replace(/[,;.!?]+$/,"")).replace(/\u2026/g,"...")).replace(/\u2013/g,"-"),!1===/^[:;]/.test(e)&&(e=(e=(e=e.replace(/\.{3,}$/g,"")).replace(/[",.!:;?)]+$/g,"")).replace(/^['"(]+/g,"")),""===(e=(e=e.replace(/[\u200B-\u200D\uFEFF]/g,"")).trim())&&(e=t),e.replace(/([0-9]),([0-9])/g,"$1$2")}(r),r=n(r,t),r=function(e){return function(e){return!0===sO.test(e)||!0===lO.test(e)||!0===aO.test(e)||!0===oO.test(e)}(e)&&(e=e.replace(/\./g,"")),e}(r),e.normal=r},uO=/[ .][A-Z]\.? *$/i,hO=/(?:\u2026|\.{2,}) *$/,dO=/\p{L}/u,pO=/\. *$/,fO=/^[A-Z]\. $/,mO={one:{killUnicode:function(e,t){const n=t.model.one.unicode||{};let r=(e=e||"").split("");return r.forEach(((e,t)=>{n[e]&&(r[t]=n[e])})),r.join("")},tokenize:{splitSentences:function(e,t){if(e=e||"",!(e=String(e))||"string"!=typeof e||!1===qC.test(e))return[];let n=function(e){let t=[],n=e.split(LC);for(let e=0;e<n.length;e++){let r=n[e].split(RC);for(let e=0;e<r.length;e++)r[e+1]&&!0===$C.test(r[e+1])&&(r[e]+=r[e+1],r[e+1]=""),""!==r[e]&&t.push(r[e])}return t}(e=e.replace(" "," ")),r=function(e){let t=[];for(let n=0;n<e.length;n++){let r=e[n];if(void 0!==r&&""!==r){if(!1===FC.test(r)||!1===MC.test(r)){if(t[t.length-1]){t[t.length-1]+=r;continue}if(e[n+1]){e[n+1]=r+e[n+1];continue}}t.push(r)}}return t}(n);if(r=function(e,t){const n=t.methods.one.tokenize.isSentence,r=t.model.one.abbreviations||new Set;let i=[];for(let t=0;t<e.length;t++){let s=e[t];e[t+1]&&!1===n(s,r)?e[t+1]=s+(e[t+1]||""):s&&s.length>0&&(i.push(s),e[t]="")}return i}(r,t),r=function(e){let t=[];for(let n=0;n<e.length;n+=1){let r=e[n].match(BC);if(null!==r&&1===r.length){if(zC(e[n+1])&&e[n+1].length<280){e[n]+=e[n+1],t.push(e[n]),e[n+1]="",n+=1;continue}if(zC(e[n+2])){let r=e[n+1]+e[n+2];if(r.length<280){e[n]+=r,t.push(e[n]),e[n+1]="",e[n+2]="",n+=2;continue}}}t.push(e[n])}return t}(r),r=function(e){let t=[];for(let n=0;n<e.length;n+=1){let r=e[n].match(HC);null!==r&&1===r.length&&e[n+1]&&e[n+1].length<250&&null!==e[n+1].match(GC)&&1===r.length&&!HC.test(e[n+1])?(e[n]+=e[n+1],t.push(e[n]),e[n+1]="",n+=1):t.push(e[n])}return t}(r),0===r.length)return[e];for(let e=1;e<r.length;e+=1){let t=r[e].match(KC);null!==t&&(r[e-1]+=t[0],r[e]=r[e].replace(KC,""))}return r},isSentence:function(e,t){if(!1===dO.test(e))return!1;if(!0===uO.test(e))return!1;if(3===e.length&&fO.test(e))return!1;if(!0===hO.test(e))return!1;let n=e.replace(/[.!?\u203D\u2E18\u203C\u2047-\u2049] *$/,"").split(" "),r=n[n.length-1].toLowerCase();return!0!==t.hasOwnProperty(r)||!0!==pO.test(e)},splitTerms:function(e,t){let n=[],r=[];if("number"==typeof(e=e||"")&&(e=String(e)),function(e){return"[object Array]"===Object.prototype.toString.call(e)}(e))return e;const i=e.split(YC);for(let e=0;e<i.length;e++)!0!==WC(i[e],t)?r.push(i[e]):r=r.concat(JC(i[e]));let s="";for(let e=0;e<r.length;e++){let t=r[e];!0===QC.test(t)&&!1===eO.hasOwnProperty(t)&&!1===XC.test(t)?(n.length>0?(n[n.length-1]+=s,n.push(t)):n.push(s+t),s=""):s+=t}return s&&(0===n.length&&(n[0]=""),n[n.length-1]+=s),n=function(e){for(let t=1;t<e.length-1;t++)ZC.test(e[t])&&(e[t-1]+=e[t]+e[t+1],e[t]=null,e[t+1]=null);return e}(n),n=function(e){const t=/^[0-9]{1,4}(:[0-9][0-9])?([a-z]{1,2})? ?[-–—] ?$/,n=/^[0-9]{1,4}([a-z]{1,2})? ?$/;for(let r=0;r<e.length-1;r+=1)e[r+1]&&t.test(e[r])&&n.test(e[r+1])&&(e[r]=e[r]+e[r+1],e[r+1]=null);return e}(n),n=n.filter((e=>e)),n},splitWhitespace:(e,t)=>{let{str:n,pre:r,post:i}=function(e,t){let{prePunctuation:n,postPunctuation:r,emoticons:i}=t.one,s=e,a="",o="",l=Array.from(e);if(i.hasOwnProperty(e.trim()))return{str:e.trim(),pre:a,post:" "};let c=l.length;for(let e=0;e<c;e+=1){let e=l[0];if(!0!==n[e]){if(("+"===e||"-"===e)&&nO.test(l[1]))break;if("'"===e&&3===e.length&&nO.test(l[1]))break;if(tO.test(e)||nO.test(e))break;a+=l.shift()}}c=l.length;for(let e=0;e<c;e+=1){let e=l[l.length-1];if(!0!==r[e]){if(tO.test(e)||nO.test(e))break;"."===e&&!0===rO.test(s)||"'"===e&&!0===iO.test(s)||(o=l.pop()+o)}}return""===(e=l.join(""))&&(s=s.replace(/ *$/,(e=>(o=e||"",""))),e=s,a=""),{str:e,pre:a,post:o}}(e,t);return{text:n,pre:r,post:i,tags:new Set}},fromString:function(e,t){const{methods:n,model:r}=t,{splitSentences:i,splitTerms:s,splitWhitespace:a}=n.one.tokenize;return e=i(e=e||"",t).map((e=>{let n=s(e,r);return n=n.map((e=>a(e,r))),n.forEach((e=>{cO(e,t)})),n})),e}}}};let gO={},yO={};[[["approx","apt","bc","cyn","eg","esp","est","etc","ex","exp","prob","pron","gal","min","pseud","fig","jd","lat","lng","vol","fm","def","misc","plz","ea","ps","sec","pt","pref","pl","pp","qt","fr","sq","nee","ss","tel","temp","vet","ver","fem","masc","eng","adj","vb","rb","inf","situ","vivo","vitro","wr"]],[["dl","ml","gal","qt","pt","tbl","tsp","tbsp","km","dm","cm","mm","mi","td","hr","hrs","kg","hg","dg","cg","mg","µg","lb","oz","sq ft","hz","mps","mph","kmph","kb","mb","tb","lx","lm","fl oz","yb"],"Unit"],[["ad","al","arc","ba","bl","ca","cca","col","corp","ft","fy","ie","lit","ma","md","pd","tce"],"Noun"],[["adj","adm","adv","asst","atty","bldg","brig","capt","cmdr","comdr","cpl","det","dr","esq","gen","gov","hon","jr","llb","lt","maj","messrs","mlle","mme","mr","mrs","ms","mstr","phd","prof","pvt","rep","reps","res","rev","sen","sens","sfc","sgt","sir","sr","supt","surg"],"Honorific"],[["jan","feb","mar","apr","jun","jul","aug","sep","sept","oct","nov","dec"],"Month"],[["dept","univ","assn","bros","inc","ltd","co"],"Organization"],[["rd","st","dist","mt","ave","blvd","cl","cres","hwy","ariz","cal","calif","colo","conn","fla","fl","ga","ida","ia","kan","kans","minn","neb","nebr","okla","penna","penn","pa","dak","tenn","tex","ut","vt","va","wis","wisc","wy","wyo","usafa","alta","ont","que","sask"],"Place"]].forEach((e=>{e[0].forEach((t=>{gO[t]=!0,yO[t]="Abbreviation",void 0!==e[1]&&(yO[t]=[yO[t],e[1]])}))}));const vO=["anti","bi","co","contra","de","extra","infra","inter","intra","macro","micro","mis","mono","multi","peri","pre","pro","proto","pseudo","re","sub","supra","trans","tri","un","out","ex"].reduce(((e,t)=>(e[t]=!0,e)),{});let bO={"!":"¡","?":"¿Ɂ",'"':'“”"❝❞',"'":"‘‛❛❜’","-":"—–",a:"ªÀÁÂÃÄÅàáâãäåĀāĂăĄąǍǎǞǟǠǡǺǻȀȁȂȃȦȧȺΆΑΔΛάαλАаѦѧӐӑӒӓƛæ",b:"ßþƀƁƂƃƄƅɃΒβϐϦБВЪЬвъьѢѣҌҍ",c:"¢©ÇçĆćĈĉĊċČčƆƇƈȻȼͻͼϲϹϽϾСсєҀҁҪҫ",d:"ÐĎďĐđƉƊȡƋƌ",e:"ÈÉÊËèéêëĒēĔĕĖėĘęĚěƐȄȅȆȇȨȩɆɇΈΕΞΣέεξϵЀЁЕеѐёҼҽҾҿӖӗễ",f:"ƑƒϜϝӺӻҒғſ",g:"ĜĝĞğĠġĢģƓǤǥǦǧǴǵ",h:"ĤĥĦħƕǶȞȟΉΗЂЊЋНнђћҢңҤҥҺһӉӊ",I:"ÌÍÎÏ",i:"ìíîïĨĩĪīĬĭĮįİıƖƗȈȉȊȋΊΐΪίιϊІЇіїi̇",j:"ĴĵǰȷɈɉϳЈј",k:"ĶķĸƘƙǨǩΚκЌЖКжкќҚқҜҝҞҟҠҡ",l:"ĹĺĻļĽľĿŀŁłƚƪǀǏǐȴȽΙӀӏ",m:"ΜϺϻМмӍӎ",n:"ÑñŃńŅņŇňŉŊŋƝƞǸǹȠȵΝΠήηϞЍИЙЛПийлпѝҊҋӅӆӢӣӤӥπ",o:"ÒÓÔÕÖØðòóôõöøŌōŎŏŐőƟƠơǑǒǪǫǬǭǾǿȌȍȎȏȪȫȬȭȮȯȰȱΌΘΟθοσόϕϘϙϬϴОФоѲѳӦӧӨөӪӫ",p:"ƤΡρϷϸϼРрҎҏÞ",q:"Ɋɋ",r:"ŔŕŖŗŘřƦȐȑȒȓɌɍЃГЯгяѓҐґ",s:"ŚśŜŝŞşŠšƧƨȘșȿЅѕ",t:"ŢţŤťŦŧƫƬƭƮȚțȶȾΓΤτϮТт",u:"ÙÚÛÜùúûüŨũŪūŬŭŮůŰűŲųƯưƱƲǓǔǕǖǗǘǙǚǛǜȔȕȖȗɄΰυϋύ",v:"νѴѵѶѷ",w:"ŴŵƜωώϖϢϣШЩшщѡѿ",x:"×ΧχϗϰХхҲҳӼӽӾӿ",y:"ÝýÿŶŷŸƳƴȲȳɎɏΎΥΫγψϒϓϔЎУучўѰѱҮүҰұӮӯӰӱӲӳ",z:"ŹźŻżŽžƵƶȤȥɀΖ"},wO={};Object.keys(bO).forEach((function(e){bO[e].split("").forEach((function(t){wO[t]=e}))}));const _O=/\//,kO=/[a-z]\.[a-z]/i,AO=/[0-9]/,PO=function(e,t){let n=e.normal||e.text||e.machine;const r=t.model.one.aliases;if(r.hasOwnProperty(n)&&(e.alias=e.alias||[],e.alias.push(r[n])),_O.test(n)&&!kO.test(n)&&!AO.test(n)){let t=n.split(_O);t.length<=3&&t.forEach((t=>{""!==(t=t.trim())&&(e.alias=e.alias||[],e.alias.push(t))}))}return e},TO=/^\p{Letter}+-\p{Letter}+$/u,EO=function(e){let t=e.implicit||e.normal||e.text;t=t.replace(/['’]s$/,""),t=t.replace(/s['’]$/,"s"),t=t.replace(/([aeiou][ktrp])in'$/,"$1ing"),TO.test(t)&&(t=t.replace(/-/g,"")),t=t.replace(/^[#@]/,""),t!==e.normal&&(e.machine=t)},xO=function(e,t){let n=e.docs;for(let r=0;r<n.length;r+=1)for(let i=0;i<n[r].length;i+=1)t(n[r][i],e.world)},IO={alias:e=>xO(e,PO),machine:e=>xO(e,EO),normal:e=>xO(e,cO),freq:function(e){let t=e.docs,n={};for(let e=0;e<t.length;e+=1)for(let r=0;r<t[e].length;r+=1){let i=t[e][r],s=i.machine||i.normal;n[s]=n[s]||0,n[s]+=1}for(let e=0;e<t.length;e+=1)for(let r=0;r<t[e].length;r+=1){let i=t[e][r],s=i.machine||i.normal;i.freq=n[s]}},offset:function(e){let t=0,n=0,r=e.document;for(let e=0;e<r.length;e+=1)for(let i=0;i<r[e].length;i+=1){let s=r[e][i];s.offset={index:n,start:t+s.pre.length,length:s.text.length},t+=s.pre.length+s.text.length+s.post.length,n+=1}},index:function(e){let t=e.document;for(let e=0;e<t.length;e+=1)for(let n=0;n<t[e].length;n+=1)t[e][n].index=[e,n]},wordCount:function(e){let t=0,n=e.docs;for(let e=0;e<n.length;e+=1)for(let r=0;r<n[e].length;r+=1)""!==n[e][r].normal&&(t+=1,n[e][r].wordCount=t)}},CO={compute:IO,methods:mO,model:{one:{aliases:{"&":"and","@":"at","%":"percent",plz:"please",bein:"being"},abbreviations:gO,prefixes:vO,suffixes:{like:!0,ish:!0,less:!0,able:!0,elect:!0,type:!0,designate:!0},prePunctuation:{"#":!0,"@":!0,_:!0,"°":!0,"​":!0,"‌":!0,"‍":!0,"\ufeff":!0},postPunctuation:{"%":!0,_:!0,"°":!0,"​":!0,"‌":!0,"‍":!0,"\ufeff":!0},lexicon:yO,unicode:wO,emoticons:{"<3":!0,"</3":!0,"<\\3":!0,":^P":!0,":^p":!0,":^O":!0,":^3":!0}}},hooks:["alias","machine","index","id"]},OO={typeahead:function(e){const t=e.model.one.typeahead,n=e.docs;if(0===n.length||0===Object.keys(t).length)return;let r=n[n.length-1]||[],i=r[r.length-1];if(!i.post&&t.hasOwnProperty(i.normal)){let n=t[i.normal];i.implicit=n,i.machine=n,i.typeahead=!0,e.compute.preTagger&&e.last().unTag("*").compute(["lexicon","preTagger"])}}},SO=function(){const e=this.docs;if(0===e.length)return this;let t=e[e.length-1]||[],n=t[t.length-1];return!0===n.typeahead&&n.machine&&(n.text=n.machine,n.normal=n.machine),this},NO={safe:!0,min:3},jO={typeahead:function(e=[],t={}){let n=this.model();var r;t=Object.assign({},NO,t),r=e,"[object Object]"===Object.prototype.toString.call(r)&&(Object.assign(n.one.lexicon,e),e=Object.keys(e));let i=function(e,t,n){let r={},i=[],s=n.prefixes||{};return e.forEach((e=>{let a=(e=e.toLowerCase().trim()).length;t.max&&a>t.max&&(a=t.max);for(let o=t.min;o<a;o+=1){let a=e.substring(0,o);t.safe&&n.model.one.lexicon.hasOwnProperty(a)||(!0!==s.hasOwnProperty(a)&&!0!==r.hasOwnProperty(a)?r[a]=e:i.push(a))}})),r=Object.assign({},s,r),i.forEach((e=>{delete r[e]})),r}(e,t,this.world());return Object.keys(i).forEach((e=>{n.one.typeahead.hasOwnProperty(e)?delete n.one.typeahead[e]:n.one.typeahead[e]=i[e]})),this}},DO={model:{one:{typeahead:{}}},api:function(e){e.prototype.autoFill=SO},lib:jO,compute:OO,hooks:["typeahead"]};zT.extend(kE),zT.extend(WI),zT.extend(vI),zT.extend(iC),zT.extend(DC),zT.plugin(KE),zT.extend(CO),zT.extend(YE),zT.plugin(GT),zT.extend(dx),zT.extend(DO),zT.extend(ax),zT.extend(aC);const RO=zT,$O={addendum:"addenda",corpus:"corpora",criterion:"criteria",curriculum:"curricula",genus:"genera",memorandum:"memoranda",opus:"opera",ovum:"ova",phenomenon:"phenomena",referendum:"referenda",alga:"algae",alumna:"alumnae",antenna:"antennae",formula:"formulae",larva:"larvae",nebula:"nebulae",vertebra:"vertebrae",analysis:"analyses",axis:"axes",diagnosis:"diagnoses",parenthesis:"parentheses",prognosis:"prognoses",synopsis:"synopses",thesis:"theses",neurosis:"neuroses",appendix:"appendices",index:"indices",matrix:"matrices",ox:"oxen",sex:"sexes",alumnus:"alumni",bacillus:"bacilli",cactus:"cacti",fungus:"fungi",hippopotamus:"hippopotami",libretto:"libretti",modulus:"moduli",nucleus:"nuclei",octopus:"octopi",radius:"radii",stimulus:"stimuli",syllabus:"syllabi",cookie:"cookies",calorie:"calories",auntie:"aunties",movie:"movies",pie:"pies",rookie:"rookies",tie:"ties",zombie:"zombies",leaf:"leaves",loaf:"loaves",thief:"thieves",foot:"feet",goose:"geese",tooth:"teeth",beau:"beaux",chateau:"chateaux",tableau:"tableaux",bus:"buses",gas:"gases",circus:"circuses",crisis:"crises",virus:"viruses",database:"databases",excuse:"excuses",abuse:"abuses",avocado:"avocados",barracks:"barracks",child:"children",clothes:"clothes",echo:"echoes",embargo:"embargoes",epoch:"epochs",deer:"deer",halo:"halos",man:"men",woman:"women",mosquito:"mosquitoes",mouse:"mice",person:"people",quiz:"quizzes",rodeo:"rodeos",shoe:"shoes",sombrero:"sombreros",stomach:"stomachs",tornado:"tornados",tuxedo:"tuxedos",volcano:"volcanoes"},LO={Comparative:"true¦bett1f0;arth0ew0in0;er",Superlative:"true¦earlier",PresentTense:"true¦bests,sounds",Condition:"true¦lest,unless",PastTense:"true¦began,came,d4had,kneel3l2m0sa4we1;ea0sg2;nt;eap0i0;ed;id",Participle:"true¦0:09;a06b01cZdXeat0fSgQhPoJprov0rHs7t6u4w1;ak0ithdra02o2r1;i02uY;k0v0;nd1pr04;ergoJoJ;ak0hHo3;e9h7lain,o6p5t4un3w1;o1um;rn;g,k;ol0reS;iQok0;ught,wn;ak0o1runk;ne,wn;en,wn;ewriNi1uJ;dd0s0;ut3ver1;do4se0t1;ak0h2;do2g1;roG;ne;ast0i7;iv0o1;ne,tt0;all0loBor1;bi3g2s1;ak0e0;iv0o9;dd0;ove,r1;a5eamt,iv0;hos0lu1;ng;e4i3lo2ui1;lt;wn;tt0;at0en,gun;r2w1;ak0ok0;is0;en",Gerund:"true¦accord0be0doin,go0result0stain0;ing",Expression:"true¦a0Yb0Uc0Sd0Oe0Mfarew0Lg0FhZjeez,lWmVnToOpLsJtIuFvEw7y0;a5e3i1u0;ck,p;k04p0;ee,pee;a0p,s;!h;!a,h,y;a5h2o1t0;af,f;rd up,w;atsoever,e1o0;a,ops;e,w;hoo,t;ery w06oi0L;gh,h0;! 0h,m;huh,oh;here nPsk,ut tut;h0ic;eesh,hh,it,oo;ff,h1l0ow,sst;ease,s,z;ew,ooey;h1i,mg,o0uch,w,y;h,o,ps;! 0h;hTmy go0wT;d,sh;a7evertheless,o0;!pe;eh,mm;ah,eh,m1ol0;!s;ao,fao;aCeBi9o2u0;h,mph,rra0zzC;h,y;l1o0;r6y9;la,y0;! 0;c1moCsmok0;es;ow;!p hip hoor0;ay;ck,e,llo,y;ha1i,lleluj0;ah;!ha;ah,ee4o1r0;eat scott,r;l1od0sh; grief,bye;ly;! whiz;ell;e0h,t cetera,ureka,ww,xcuse me;k,p;'oh,a0rat,uh;m0ng;mit,n0;!it;mon,o0;ngratulations,wabunga;a2oo1r0tw,ye;avo,r;!ya;h,m; 1h0ka,las,men,rgh,ye;!a,em,h,oy;la",Negative:"true¦n0;ever,o0;n,t",QuestionWord:"true¦how3wh0;at,e1ich,o0y;!m,se;n,re; come,'s",Reflexive:"true¦h4it5my5o1the0your2;ir1m1;ne3ur0;sel0;f,ves;er0im0;self",Plural:"true¦dick0gre0ones,records;ens","Unit|Noun":"true¦cEfDgChBinchAk9lb,m6newt5oz,p4qt,t1y0;ardEd;able1b0ea1sp;!l,sp;spo1;a,t,x;on9;!b,g,i1l,m,p0;h,s;!les;!b,elvin,g,m;!es;g,z;al,b;eet,oot,t;m,up0;!s",Value:"true¦a few",Imperative:"true¦bewa0come he0;re","Plural|Verb":"true¦leaves",Demonym:"true¦0:15;1:12;a0Vb0Oc0Dd0Ce08f07g04h02iYjVkTlPmLnIomHpEqatari,rCs7t5u4v3welAz2;am0Gimbabwe0;enezuel0ietnam0I;gAkrai1;aiwTex0hai,rinida0Ju2;ni0Prkmen;a5cotti4e3ingapoOlovak,oma0Spaniard,udRw2y0W;ede,iss;negal0Cr09;sh;mo0uT;o5us0Jw2;and0;a2eru0Fhilippi0Nortugu07uerto r0S;kist3lesti1na2raguay0;ma1;ani;ami00i2orweP;caragu0geri2;an,en;a3ex0Lo2;ngo0Drocc0;cedo1la2;gasy,y07;a4eb9i2;b2thua1;e0Cy0;o,t01;azakh,eny0o2uwaiI;re0;a2orda1;ma0Ap2;anO;celandic,nd4r2sraeli,ta01vo05;a2iB;ni0qi;i0oneU;aiAin2ondur0unO;di;amEe2hanai0reek,uatemal0;or2rm0;gi0;ilipino,ren8;cuadoVgyp4mira3ngli2sto1thiopi0urope0;shm0;ti;ti0;aPominUut3;a9h6o4roat3ub0ze2;ch;!i0;lom2ngol5;bi0;a6i2;le0n2;ese;lifor1m2na3;bo2eroo1;di0;angladeshi,el6o4r3ul2;gaE;azi9it;li2s1;vi0;aru2gi0;si0;fAl7merBngol0r5si0us2;sie,tr2;a2i0;li0;genti2me1;ne;ba1ge2;ri0;ni0;gh0r2;ic0;an",Organization:"true¦0:4Q;a3Tb3Bc2Od2He2Df27g1Zh1Ti1Pj1Nk1Ll1Gm12n0Po0Mp0Cqu0Br02sTtHuCv9w3xiaomi,y1;amaha,m1Bou1w1B;gov,tu3C;a4e2iki1orld trade organizati33;leaRped0O;lls fargo,st1;fie2Hinghou2R;l1rner br3U;gree3Jl street journ2Im1E;an halOeriz2Xisa,o1;dafo2Yl1;kswagMvo;b4kip,n2ps,s1;a tod3Aps;es3Mi1;lev3Fted natio3C;er,s; mobi32aco beRd bOe9gi frida3Lh3im horto3Amz,o1witt3D;shi49y1;ota,s r 05;e 1in lizzy;b3carpen3Jdaily ma3Dguess w2holli0s1w2;mashing pumpki35uprem0;ho;ea1lack eyed pe3Xyr0Q;ch bo3Dtl0;l2n3Qs1xas instrumen1U;co,la m1F;efoni0Kus;a8cientology,e5ieme2Ymirnoff,np,o3pice gir6quare0Ata1ubaru;rbuc1to34;ks;ny,undgard1;en;a2x pisto1;ls;g1Wrs;few2Minsbur31lesfor03msu2E;adiohead,b8e4o1yana3C;man empi1Xyal 1;b1dutch she4;ank;a3d 1max,vl20;bu1c2Ahot chili peppe2Ylobst2N;ll;ders dige1Ll madrid;c,s;ant3Aizn2Q;a8bs,e5fiz2Ihilip4i3r1;emier 1udenti1D;leagTo2K;nk floyd,zza hut; morrBs;psi2tro1uge0E;br33chi0Tn33;!co;lant2Un1yp16; 2ason27da2P;ld navy,pec,range juli2xf1;am;us;aAb9e6fl,h5i4o1sa,vid3wa;k2tre dame,vart1;is;ia;ke,ntendo,ss0QvZ;l,s;c,st1Otflix,w1; 1sweek;kids on the block,york0D;a,c;nd22s2t1;ional aca2Po,we0U;a,c02d0S;aDcdonalCe9i6lb,o3tv,y1;spa1;ce;b1Tnsanto,ody blu0t1;ley cr1or0T;ue;c2t1;as,subisO;helin,rosoft;dica2rcedes benz,talli1;ca;id,re;ds;cs milk,tt19z24;a3e1g,ittle caesa1P; ore09novo,x1;is,mark,us; 1bour party;pres0Dz boy;atv,fc,kk,lm,m1od1O;art;iffy lu0Roy divisi0Jpmorgan1sa;! cha09;bm,hop,k3n1tv;g,te1;l,rpol;ea;a5ewlett pack1Vi3o1sbc,yundai;me dep1n1P;ot;tac1zbollah;hi;lliburt08sbro;eneral 6hq,ithub,l5mb,o2reen d0Ou1;cci,ns n ros0;ldman sachs,o1;dye1g0H;ar;axo smith kli04encoW;electr0Nm1;oto0Z;a5bi,c barcelo4da,edex,i2leetwood m03o1rito l0G;rd,xcY;at,fa,nancial1restoZ; tim0;na;cebook,nnie mae;b0Asa,u3xxon1; m1m1;ob0J;!rosceptics;aiml0De5isney,o4u1;nkin donu2po0Zran dur1;an;ts;j,w jon0;a,f lepp12ll,peche mode,r spieg02stiny's chi1;ld;aJbc,hFiDloudflaCnn,o3r1;aigsli5eedence clearwater reviv1ossra09;al;c7inba6l4m1o0Est09;ca2p1;aq;st;dplSg1;ate;se;a c1o chanQ;ola;re;a,sco1tigroup;! systems;ev2i1;ck fil a,na daily;r1y;on;d2pital o1rls jr;ne;bury,ill1;ac;aEbc,eBf9l5mw,ni,o1p,rexiteeU;ei3mbardiIston 1;glo1pizza;be;ng;o2ue c1;roV;ckbuster video,omingda1;le; g1g1;oodriL;cht2e ge0rkshire hathaw1;ay;el;cardi,idu,nana republ3s1xt5y5;f,kin robbi1;ns;ic;bYcTdidSerosmith,iRlKmEnheuser busDol,ppleAr6s4u3v2y1;er;is,on;di,todesk;hland o1sociated E;il;b3g2m1;co;os;ys; compu1be0;te1;rs;ch;c,d,erican3t1;!r1;ak; ex1;pre1;ss; 5catel2ta1;ir;! lu1;ce1;nt;jazeera,qae1;da;g,rbnb;as;/dc,a3er,tivision1;! blizz1;ard;demy of scienc0;es;ba",Possessive:"true¦its,my,our0thy;!s","Noun|Verb":"true¦0:9W;1:AA;2:96;3:A3;4:9R;5:A2;6:9K;7:8N;8:7L;9:A8;A:93;B:8D;C:8X;a9Ob8Qc7Id6Re6Gf5Sg5Hh55i4Xj4Uk4Rl4Em40n3Vo3Sp2Squ2Rr21s0Jt02u00vVwGyFzD;ip,oD;ne,om;awn,e6Fie68;aOeMhJiHoErD;ap,e9Oink2;nd0rDuC;kDry,sh5Hth;!shop;ck,nDpe,re,sh;!d,g;e86iD;p,sD;k,p0t2;aDed,lco8W;r,th0;it,lk,rEsDt4ve,x;h,te;!ehou1ra9;aGen5FiFoD;iDmAte,w;ce,d;be,ew,sA;cuum,l4B;pDr7;da5gra6Elo6A;aReQhrPiOoMrGuEwiDy5Z;n,st;nDrn;e,n7O;aGeFiEoDu6;t,ub2;bu5ck4Jgg0m,p;at,k,nd;ck,de,in,nsDp,v7J;f0i8R;ll,ne,p,r4Yss,t94uD;ch,r;ck,de,e,le,me,p,re;e5Wow,u6;ar,e,ll,mp0st,xt;g,lDng2rg7Ps5x;k,ly;a0Sc0Ne0Kh0Fi0Dk0Cl0Am08n06o05pXquaBtKuFwD;ea88iD;ng,pe,t4;bGit,m,ppErD;fa3ge,pri1v2U;lDo6S;e6Py;!je8;aMeLiKoHrEuDy2;dy,ff,mb2;a85eEiDo5Pugg2;ke,ng;am,ss,t4;ckEop,p,rD;e,m;ing,pi2;ck,nk,t4;er,m,p;ck,ff,ge,in,ke,lEmp,nd,p2rDte,y;!e,t;k,l;aJeIiHlGoFrDur,y;ay,e56inDu3;g,k2;ns8Bt;a5Qit;ll,n,r87te;ed,ll;m,n,rk;b,uC;aDee1Tow;ke,p;a5Je4FiDo53;le,rk;eep,iDou4;ce,p,t;ateboa7Ii;de,gnDl2Vnk,p,ze;!al;aGeFiEoDuff2;ck,p,re,w;ft,p,v0;d,i3Ylt0;ck,de,pe,re,ve;aEed,nDrv1It;se,t2N;l,r4t;aGhedu2oBrD;aEeDibb2o3Z;en,w;pe,t4;le,n,r2M;cDfegua72il,mp2;k,rifi3;aZeHhy6LiGoEuD;b,in,le,n,s5X;a6ck,ll,oDpe,u5;f,t;de,ng,ot,p,s1W;aTcSdo,el,fQgPje8lOmMnLo17pJque6sFturn,vDwa6V;eDi27;al,r1;er74oFpe8tEuD;lt,me;!a55;l71rt;air,eaDly,o53;l,t;dezvo2Zt;aDedy;ke,rk;ea1i4G;a6Iist0r5N;act6Yer1Vo71uD;nd,se;a38o6F;ch,s6G;c1Dge,iEke,lly,nDp1Wt1W;ge,k,t;n,se;es6Biv0;a04e00hYiXlToNrEsy4uD;mp,n4rcha1sh;aKeIiHoDu4O;be,ceFdu3fi2grDje8mi1p,te6;amDe6W;!me;ed,ss;ce,de,nt;sDy;er6Cs;cti3i1;iHlFoEp,re,sDuCw0;e,i5Yt;l,p;iDl;ce,sh;nt,s5V;aEce,e32uD;g,mp,n7;ce,nDy;!t;ck,le,n17pe,tNvot;a1oD;ne,tograph;ak,eFnErDt;fu55mA;!c32;!l,r;ckJiInHrFsEtDu1y;ch,e9;s,te;k,tD;!y;!ic;nt,r,se;!a7;bje8ff0il,oErDutli3Qver4B;bAd0ie9;ze;a4ReFoDur1;d,tD;e,i3;ed,gle8tD;!work;aMeKiIoEuD;rd0;ck,d3Rld,nEp,uDve;nt,th;it5EkD;ey;lk,n4Brr5CsDx;s,ta2B;asuBn4UrDss;ge,it;il,nFp,rk3WsEtD;ch,t0;h,k,t0;da5n0oeuvB;aLeJiHoEuD;mp,st;aEbby,ck,g,oDve;k,t;d,n;cDe,ft,mAnIst;en1k;aDc0Pe4vK;ch,d,k,p,se;bFcEnd,p,t4uD;gh,n4;e,k;el,o2U;eEiDno4E;ck,d,ll,ss;el,y;aEo1OuD;i3mp;m,zz;mpJnEr46ssD;ue;c1Rdex,fluGha2k,se2HteDvoi3;nt,rD;e6fa3viD;ew;en3;a8le2A;aJeHiGoEuD;g,nt;l3Ano2Dok,pDr1u1;!e;ghli1Fke,nt,re,t;aDd7lp;d,t;ck,mGndFrEsh,tDu9;ch,e;bo3Xm,ne4Eve6;!le;!m0;aMear,ift,lKossJrFuD;arDe4Alp,n;antee,d;aFiEoDumb2;uCwth;ll,nd,p;de,sp;ip;aBoDue;ss,w;g,in,me,ng,s,te,ze;aZeWiRlNoJrFuD;ck,el,nDss,zz;c38d;aEoDy;st,wn;cDgme,me,nchi1;tuB;cFg,il,ld,rD;ce,e29mDwa31;!at;us;aFe0Vip,oDy;at,ck,od,wD;!er;g,ke,me,re,sh,vo1E;eGgFlEnDre,sh,t,x;an3i0Q;e,m,t0;ht,uB;ld;aEeDn3;d,l;r,tuB;ce,il,ll,rm,vo2W;cho,d7ffe8nMsKxFyeD;!baD;ll;cGerci1hFpDtra8;eriDo0W;en3me9;au6ibA;el,han7u1;caDtima5;pe;count0d,vy;a01eSiMoJrEuDye;b,el,mp,pli2X;aGeFiEoD;ne,p;ft,ll,nk,p,ve;am,ss;ft,g,in;cEd7ubt,wnloD;ad;k,u0E;ge6p,sFt4vD;e,iDor3;de;char7gui1h,liEpD;at4lay,u5;ke;al,bKcJfeIlGmaCposAsEtaD;il;e07iD;gn,re;ay,ega5iD;ght;at,ct;li04rea1;a5ut;b,ma7n3rDte;e,t;a0Eent0Dh06irc2l03oKrFuD;be,e,rDt;b,e,l,ve;aGeFoEuDy;sh;p,ss,wd;dAep;ck,ft,sh;at,de,in,lTmMnFordina5py,re,st,uDv0;gh,nDp2rt;s01t;ceHdu8fli8glomeIsFtDveN;a8rD;a6ol;e9tru8;ct;ntDrn;ra5;bHfoGmFpD;leDouCromi1;me9;aCe9it,u5;rt;at,iD;ne;lap1oD;r,ur;aEiDoud,ub;ck,p;im,w;aEeDip;at,ck,er;iGllen7nErD;ge,m,t;ge,nD;el;n,r;er,re;ke,ll,mp,noe,pGrXsFtEuDve;se,ti0I;alog,ch;h,t;!tuB;re;a03eZiXlToPrHuEyD;pa11;bb2ck2dgEff0mp,rDst,zz;den,n;et;anJeHiFoadEuD;i1sh;ca6;be,d7;ge;aDed;ch,k;ch,d;aFg,mb,nEoDrd0tt2x,ycott;k,st,t;d,e;rd,st;aFeCiDoYur;nk,tz;nd;me;as,d,ke,nd,opsy,tD;!ch,e;aFef,lt,nDt;d,efA;it;r,t;ck,il,lan3nIrFsEtt2;le;e,h;!gDk;aDe;in;!d,g,k;bu1c05dZge,iYlVnTppQrLsIttGucEwaD;rd;tiD;on;aDempt;ck;k,sD;i6ocia5;st;chFmD;!oD;ur;!iD;ve;eEroa4;ch;al;chDg0sw0;or;aEt0;er;rm;d,m,r;dreHvD;an3oD;ca5;te;ce;ss;cDe,he,t;eFoD;rd,u9;nt;nt,ss;se",Actor:"true¦0:7B;1:7G;2:6A;3:7F;4:7O;5:7K;a6Nb62c4Ud4Be41f3Sg3Bh30i2Uj2Qkin2Pl2Km26n1Zo1Sp0Vqu0Tr0JsQtJuHvEw8yo6;gi,ut6;h,ub0;aAe9i8o7r6;estl0it0;m2rk0;fe,nn0t2Bza2H;atherm2ld0;ge earn0it0nder0rri1;eter7i6oyF;ll5Qp,s3Z;an,ina2U;n6s0;c6Uder03;aoisea23e9herapi5iktok0o8r6ut1yco6S;a6endseLo43;d0mp,nscri0Bvel0;ddl0u1G;a0Qchn7en6na4st0;ag0;i3Oo0D;aiXcUeRhPiMki0mu26oJpGquaFtBu7wee6;p0theart;lt2per7r6;f0ge6Iviv1;h6inten0Ist5Ivis1;ero,um2;a8ep7r6;ang0eam0;bro2Nc2Ofa2Nmo2Nsi20;ff0tesm2;tt0;ec7ir2Do6;kesp59u0M;ia5Jt3;l7me6An,rcere6ul;r,ss;di0oi5;n7s6;sy,t0;g0n0;am2ephe1Iow6;girl,m2r2Q;cretInior cit3Fr6;gea4v6;a4it1;hol4Xi7reen6ulpt1;wr2C;e01on;l1nt;aEe9o8u6;l0nn6;er up,ingE;g40le mod3Zof0;a4Zc8fug2Ppo32searQv6;ere4Uolution6;ary;e6luYru22;ptio3T;bbi,dic5Vpp0;arter6e2Z;back;aYeWhSiRlOoKr8sycho7u6;nk,p31;logi5;aGeDiBo6;d9fess1g7ph47s6;pe2Ktitu51;en6ramm0;it1y;igy,uc0;est4Nme mini0Unce6s3E;!ss;a7si6;de4;ch0;ctiti39nk0P;dca0Oet,li6pula50rnst42;c2Itic6;al scie6i2;nti5;a6umb0;nn0y6;er,ma4Lwright;lgrim,one0;a8iloso7otogra7ra6ysi1V;se;ph0;ntom,rmaci5;r6ssi1T;form0s4O;i3El,nel3Yr8st1tr6wn;i6on;arWot;ent4Wi42tn0;ccupa4ffBp8r7ut6;ca5l0B;ac4Iganiz0ig2Fph2;er3t6;i1Jomet6;ri5;ic0spring;aBe9ie4Xo7u6;n,rser3J;b6mad,vi4V;le2Vo4D;i6mesis,phew;ce,ghb1;nny,rr3t1X;aEeDiAo7u6yst1Y;m8si16;der3gul,m7n6th0;arDk;!my;ni7s6;f02s0Jt0;on,st0;chan1Qnt1rcha4;gi9k0n8rtyr,t6y1;e,riar6;ch;ag0iac;ci2stra3I;a7e2Aieutena4o6;rd,s0v0;bor0d7ndlo6ss,urea3Fwy0ym2;rd;!y;!s28;e8o7u6;ggl0;gg0urna2U;st0;c3Hdol,llu3Ummigra4n6; l9c1Qfa4habi42nov3s7ve6;nt1stig3;pe0Nt6;a1Fig3ru0M;aw;airFeBistoAo8u6ygie1K;man6sba2H;!ita8;bo,st6usekN;age,e3P;ri2;ir,r6;m7o6;!ine;it;dress0sty2C;aLeIhostGirl26ladi3oCrand7u6;e5ru;c9daug0Jfa8m7pa6s2Y;!re4;a,o6;th0;hi1B;al7d6lf0;!de3A;ie,k6te26;eep0;!wr6;it0;isha,n6;i6tl04;us;mbl0rden0;aDella,iAo7r6;eela2Nie1P;e,re6ster pare4;be1Hm2r6st0;unn0;an2ZgZlmm17nanci0r6tt0;e6st la2H; marsh2OfigXm2;rm0th0;conoEdDlectriCm8n7x6;amin0cellency,i2A;emy,trepreneur,vironmenta1J;c8p6;er1loye6;e,r;ee;ci2;it1;mi5;aKeBi8ork,ri7u6we02;de,tche2H;ft0v0;ct3eti7plom2Hre6va;ct1;ci2ti2;aDcor3fencCi0InAput9s7tectLvel6;op0;ce1Ge6ign0;rt0;ee,y;iz6;en;em2;c1Ml0;d8nc0redev7ug6;ht0;il;!dy;a06e04fo,hXitizenWlToBr9u6;r3stomer6;! representat6;ive;e3it6;ic;lJmGnAord9rpor1Nu7w6;boy,ork0;n6ri0;ciTte1Q;in3;fidantAgressSs9t6;e0Kr6;ibut1o6;ll0;tab13ul1O;!e;edi2m6pos0rade;a0EeQissi6;on0;leag8on7um6;ni5;el;ue;e6own;an0r6;ic,k;!s;a9e7i6um;ld;erle6f;ad0;ir7nce6plFract0;ll1;m2wI;lebri6o;ty;dBptAr6shi0;e7pe6;nt0;r,t6;ak0;ain;et;aMeLiJlogg0oErBu6;dd0Fild0rgl9siness6;m2p7w6;om2;ers05;ar;i7o6;!k0th0;cklay0de,gadi0;hemi2oge8y6;!frie6;nd;ym2;an;cyc6sR;li5;atbox0ings;by,nk0r6;b0on7te6;nd0;!e07;c04dWge4nQpLrHsFtAu7yatull6;ah;nt7t6;h1oG;!ie;h8t6;e6orney;nda4;ie5le6;te;sis00tron6;aut,om0;chbis8isto7tis6;an,t;crU;hop;ost9p6;ari6rentiS;ti6;on;le;a9cest1im3nou8y6;bo6;dy;nc0;ly5rc6;hi5;mi8v6;entur0is1;er;ni7r6;al;str3;at1;or;counBquaintanArob9t6;ivi5or,re6;ss;st;at;ce;ta4;nt","Adj|Noun":"true¦0:16;a1Db17c0Ud0Re0Mf0Dg0Ah08i06ju05l02mWnUoSpNrIsBt7u4v1watershed;a1ision0Z;gabo4nilla,ria1;b0Vnt;ndergr1pstairs;adua14ou1;nd;a3e1oken,ri0;en,r1;min0rori13;boo,n;age,e5ilv0Flack,o3quat,ta2u1well;bordina0Xper5;b0Lndard;ciali0Yl1vereign;e,ve16;cret,n1ri0;ior;a4e2ou1ubbiL;nd,tiY;ar,bBl0Wnt0p1side11;resent0Vublican;ci0Qsh;a4eriodic0last0Zotenti0r1;emi2incip0o1;!fession0;er,um;rall4st,tie0U;ff1pposi0Hv0;ens0Oi0C;agg01ov1uts;el;a5e3iniatJo1;bi01der07r1;al,t0;di1tr0N;an,um;le,riG;attOi2u1;sh;ber0ght,qC;stice,veniT;de0mpressioYn1;cumbe0Edividu0no0Dsta0Eterim;alf,o1umdrum;bby,melF;en2old,ra1;ph0Bve;er0ious;a7e5i4l3u1;git03t1;ure;uid;ne;llow,m1;aFiL;ir,t,vo1;riOuriO;l3p00x1;c1ecutUpeV;ess;d1iK;er;ar2e1;mographUrivO;k,l2;hiGlassSo2rude,unn1;ing;m5n1operK;creCstitueOte2vertab1;le;mpor1nt;ary;ic,m2p1;anion,lex;er2u1;ni8;ci0;al;e5lank,o4r1;i2u1;te;ef;ttom,urgeois;st;cadem9d6l2ntarct9r1;ab,ct8;e3tern1;at1;ive;rt;oles1ult;ce1;nt;ic","Adj|Past":"true¦0:4Q;1:4C;2:4H;3:4E;a44b3Tc36d2Je29f20g1Wh1Si1Jj1Gkno1Fl1Am15n12o0Xp0Mqu0Kr08sLtEuAv9w4yellow0;a7ea6o4rinkl0;r4u3Y;n,ri0;k31th3;rp0sh0tZ;ari0e1O;n5p4s0;d1li1Rset;cov3derstood,i4;fi0t0;a8e3Rhr7i6ouTr4urn0wi4C;a4imm0ou2G;ck0in0pp0;ed,r0;eat2Qi37;m0nn0r4;get0ni2T;aOcKeIhGimFm0Hoak0pDt7u4;bsid3Ogge44s4;pe4ta2Y;ct0nd0;a8e7i2Eok0r5u4;ff0mp0nn0;ength2Hip4;ed,p0;am0reotyp0;in0t0;eci4ik0oH;al3Efi0;pRul1;a4ock0ut;d0r0;a4c1Jle2t31;l0s3Ut0;a6or5r4;at4e25;ch0;r0tt3;t4ut0;is2Mur1;aEe5o4;tt0;cAdJf2Bg9je2l8m0Knew0p7qu6s4;eTpe2t4;or0ri2;e3Dir0;e1lac0;at0e2Q;i0Rul1;eiv0o4ycl0;mme2Lrd0v3;in0lli0ti2A;a4ot0;li28;aCer30iBlAo9r5u4;mp0zzl0;e6i2Oo4;ce2Fd4lo1Anou30pos0te2v0;uc0;fe1CocCp0Iss0;i2Kli1L;ann0e2CuS;ck0erc0ss0;ck0i2Hr4st0;allLk0;bse7c6pp13rgan2Dver4;lo4whelm0;ok0;cupi0;rv0;aJe5o4;t0uri1A;ed0gle2;a6e5ix0o4ut0ys1N;di1Nt15u26;as0Clt0;n4rk0;ag0ufact0A;e6i5o4;ad0ck0st,v0;cens0m04st0;ft,v4;el0;tt0wn;a5o15u4;dg0s1B;gg0;llumSmpAn4sol1;br0cre1Ldebt0f8jZspir0t5v4;it0olv0;e4ox0Y;gr1n4re23;d0si15;e2l1o1Wuri1;li0o01r4;ov0;a6e1o4um03;ok0r4;ri0Z;mm3rm0;i6r5u4;a1Bid0;a0Ui0Rown;ft0;aAe9i8l6oc0Ir4;a4i0oz0Y;ctHg19m0;avo0Ju4;st3;ni08tt0x0;ar0;d0il0sc4;in1;dCl1mBn9quipp0s8x4;agger1c6p4te0T;a0Se4os0;ct0rie1D;it0;cap0tabliZ;cha0XgFha1As4;ur0;a0Zbarra0N;i0Buc1;aMeDi5r4;a01i0;gni08miniSre2s4;a9c6grun0Ft4;o4re0Hu17;rt0;iplWou4;nt0r4;ag0;bl0;cBdRf9l8p7ra6t5v4;elop0ot0;ail0ermQ;ng0;re07;ay0ight0;e4in0o0M;rr0;ay0enTor1;m5t0z4;ed,zl0;ag0p4;en0;aPeLhIlHo9r6u4;lt4r0stom03;iv1;a5owd0u4;sh0;ck0mp0;d0loAm7n4ok0v3;centr1f5s4troC;id3olid1;us0;b5pl4;ic1;in0;r0ur0;assi9os0utt3;ar5i4;ll0;g0m0;lebr1n6r4;ti4;fi0;tralJ;g0lcul1;aDewild3iCl9o7r5urn4;ed,t;ok4uis0;en;il0r0t4und;tl0;e5i4;nd0;ss0;as0;ffl0k0laMs0tt3;bPcNdKfIg0lFmaz0nDppBrm0ss9u5wa4;rd0;g5thor4;iz0;me4;nt0;o6u4;m0r0;li0re4;ci1;im1ticip1;at0;a5leg0t3;er0;rm0;fe2;ct0;ju5o7va4;nc0;st0;ce4knowledg0;pt0;and5so4;rb0;on0;ed",Singular:"true¦0:5J;1:5H;2:4W;3:4S;4:52;5:57;6:5L;7:56;8:5B;a52b4Lc3Nd35e2Xf2Og2Jh28in24j23k22l1Um1Ln1Ho1Bp0Rqu0Qr0FsZtMuHvCw9x r58yo yo;a9ha3Po3Q;f3i4Rt0Gy9;! arou39;arCeAideo ga2Qo9;cabu4Jl5C;gOr9t;di4Zt1Y;iety,ni4P;nBp30rAs 9;do43s5E;bani1in0;coordinat3Ader9;estima1to24we41; rex,aKeJhHiFoErBuAv9;! show;m2On2rntLto1D;agedy,ib9o4E;e,u9;n0ta46;ni1p2rq3L;c,er,m9;etF;ing9ree26;!y;am,mp3F;ct2le6x return;aNcMeKhor4QiJkHoGpin off,tDuBy9;ll9ner7st4T;ab2X;b9i1n28per bowl,rro1X;st3Ltot0;atAipe2Go1Lrate7udent9;! lo0I;i39u1;ft ser4Lmeo1I;elet5i9;ll,r3V;b38gn2Tte;ab2Jc9min3B;t,urity gua2N;e6ho2Y;bbatic0la3Jndwi0Qpi5;av5eDhetor2iAo9;de6om,w;tAv9;erb2C;e,u0;bDcBf9publ2r10spi1;er9orm3;e6r0;i9ord label;p2Ht0;a1u46;estion mark,ot2F;aPeMhoLiIlGoErAu9yram1F;ddi3HpErpo1Js3J;eBo9;bl3Zs9;pe3Jta1;dic1Rmi1Fp1Qroga8ss relea1F;p9rt0;py;a9ebisci1;q2Dte;cn2eAg9;!gy;!r;ne call,tocoK;anut,dAr9t0yo1;cen3Jsp3K;al,est0;nop4rAt9;e,hog5;adi11i2V;atme0bj3FcBpia1rde0thers,utspok5ve9wn3;n,r9;ti0Pview;cuAe9;an;pi3;arBitAot9umb3;a2Fhi2R;e,ra1;cot2ra8;aFeCiAo9ur0;nopo4p18rni2Nsq1Rti36uld;c,li11n0As9tt5;chief,si34;dAnu,t9;al,i3;al,ic;gna1mm0nd15rsupi0te9yf4;ri0;aDegCiBu9;ddi1n9;ch;me,p09; Be0M;bor14y9; 9er;up;eyno1itt5;el4ourn0;cBdices,itia8ni25sAtel0Lvert9;eb1J;e28titu1;en8i2T;aIeEighDoAu9;man right,s22;me9rmoFsp1Ftb0K;! r9;un; scho0YriY;a9i1N;d9v5; start,pho9;ne;ndful,sh brown,v5ze;aBelat0Ilaci3r9ul4yp1S;an9enadi3id;a1Cd slam,ny;df4r9;l2ni1I;aGeti1HiFlu1oCrAun9;er0;ee market,i9onti3;ga1;l4ur9;so9;me;ePref4;br2mi4;conoFffi7gg,lecto0Rmbas1EnCpidem2s1Zth2venBxAyel9;id;ampZempl0Nte6;i19t;er7terp9;ri9;se;my;eLiEoBr9ump tru0U;agonf4i9;er,ve thru;cAg7i4or,ssi3wn9;side;to0EumenE;aEgniDnn3sAvide9;nd;conte6incen8p9tri11;osi9;ti0C;ta0H;le0X;athBcAf9ni0terre6;ault 05err0;al,im0;!b9;ed;aWeThMiLlJoDr9;edit caBuc9;ib9;le;rd;efficDke,lCmmuniqLnsApi3rr0t0Xus9yo1;in;erv9uI;ato02;ic,lQ;ie6;er7i9oth;e6n2;ty,vil wM;aDeqCick5ocoBr9;istmas car9ysanthemum;ol;la1;ue;ndeli3racteri9;st2;iAllEr9;e0tifica1;liZ;hi3nFpErCt9ucus;erpi9hedr0;ll9;ar;!bohyd9ri3;ra1;it0;aAe,nib0t9;on;l,ry;aMeLiop2leJoHrDu9;nny,r9tterf4;g9i0;la9;ry;eakAi9;ck;fa9throB;st;dy,ro9wl;ugh;mi9;sh;an,l4;nkiArri3;er;ng;cSdMlInFppeti1rDsBtt2utop9;sy;ic;ce6pe9;ct;r9sen0;ay;ecAoma4tiA;ly;do1;i5l9;er7y;gy;en; hominDjAvan9;tage;ec8;ti9;ve;em;cCeAqui9;tt0;ta1;te;iAru0;al;de6;nt","Person|Noun":"true¦a0Eb07c03dWeUfQgOhLjHkiGlFmCnBolive,p7r4s3trini06v1wa0;ng,rd,tts;an,enus,iol0;a,et;ky,onPumm09;ay,e1o0uby;bin,d,se;ed,x;a2e1o0;l,tt04;aLnJ;dYge,tR;at,orm;a0eloW;t0x,ya;!s;a9eo,iH;ng,tP;a2e1o0;lGy;an,w3;de,smi4y;a0erb,iOolBuntR;ll,z0;el;ail,e0iLuy;ne;a1ern,i0lo;elds,nn;ith,n0;ny;a0dEmir,ula,ve;rl;a4e3i1j,ol0;ly;ck,x0;ie;an,ja;i0wn;sy;am,h0liff,rystal;a0in,ristian;mbers,ri0;ty;a4e3i2o,r0ud;an0ook;dy;ll;nedict,rg;k0nks;er;l0rt;fredo,ma","Actor|Verb":"true¦aCb8c5doctor,engineAfool,g3host,judge,m2nerd,p1recruit,scout,ushAvolunteAwi0;mp,tneA;arent,ilot;an,ime;eek,oof,r0uide;adu8oom;ha1o0;ach,nscript,ok;mpion,uffeur;o2u0;lly,tch0;er;ss;ddi1ffili0rchite1;ate;ct",MaleName:"true¦0:H6;1:FZ;2:DS;3:GQ;4:CZ;5:FV;6:GM;7:FP;8:GW;9:ET;A:C2;B:GD;aF8bE1cCQdBMeASfA1g8Yh88i7Uj6Sk6Bl5Mm48n3So3Ip33qu31r26s1Et0Ru0Ov0CwTxSyHzC;aCor0;cChC1karia,nAT;!hDkC;!aF6;!ar7CeF5;aJevgenBSoEuC;en,rFVsCu3FvEF;if,uf;nDs6OusC;ouf,s6N;aCg;s,tC;an,h0;hli,nCrosE1ss09;is,nC;!iBU;avi2ho5;aPeNiDoCyaEL;jcieBJlfgang,odrFutR;lFnC;f8TsC;lCt1;ow;bGey,frEhe4QlC;aE5iCy;am,e,s;ed8iC;d,ed;eAur;i,ndeD2rn2sC;!l9t1;lDyC;l1ne;lDtC;!er;aCHy;aKernDAiFladDoC;jteB0lodymyr;!iC;mFQsDB;cFha0ktBZnceDrgCOvC;a0ek;!nC;t,zo;!e4StBV;lCnC7sily;!entC;in9J;ghE2lCm70nax,ri,sm0;riCyss87;ch,k;aWeRhNiLoGrEuDyC;!l2roEDs1;n6r6E;avD0eCist0oy,um0;ntCRvBKy;bFdAWmCny;!asDmCoharu;aFFie,y;!z;iA6y;mCt4;!my,othy;adEeoDia0SomC;!as;!dor91;!de4;dFrC;enBKrC;anBJeCy;ll,nBI;!dy;dgh,ha,iCnn2req,tsu5V;cDAka;aYcotWeThPiMlobod0oKpenc2tEurDvenAEyCzym1;ed,lvest2;aj,e9V;anFeDuC;!aA;fan17phEQvCwaA;e77ie;!islaCl9;v,w;lom1rBuC;leymaDHta;dDgmu9UlCm1yabonga;as,v8B;!dhart8Yn9;aEeClo75;lCrm0;d1t1;h9Jne,qu1Jun,wn,yne;aDbastiEDk2Yl5Mpp,rgCth,ymoCU;e1Dio;m4n;!tC;!ie,y;eDPlFmEnCq67tosCMul;dCj2UtiA5;e01ro;!iATkeB6mC4u5;!ik,vato9K;aZeUheC8iRoGuDyC;an,ou;b99dDf4peAssC;!elEG;ol00y;an,bLc7MdJel,geIh0lHmGnEry,sDyC;!ce;ar7Ocoe,s;!aCnBU;ld,n;an,eo;a7Ef;l7Jr;e3Eg2n9olfo,riC;go;bBNeDH;cCl9;ar87c86h54kCo;!ey,ie,y;cFeA3gDid,ubByCza;an8Ln06;g85iC;naC6s;ep;ch8Kfa5hHin2je8HlGmFndEoHpha5sDul,wi36yC;an,mo8O;h9Im4;alDSol3O;iD0on;f,ph;ul;e9CinC;cy,t1;aOeLhilJiFrCyoG;aDeC;m,st1;ka85v2O;eDoC;tr;r8GtC;er,ro;!ipCl6H;!p6U;dCLrcy,tC;ar,e9JrC;!o7;b9Udra8So9UscAHtri62ulCv8I;!ie,o7;ctav6Ji2lImHndrBRrGsDtCum6wB;is,to;aDc6k6m0vCwaBE;al79;ma;i,vR;ar,er;aDeksandr,ivC;er,i2;f,v;aNeLguyBiFoCu3O;aDel,j4l0ma0rC;beAm0;h,m;cFels,g5i9EkDlC;es,s;!au,h96l78olaC;!i,y;hCkCol76;ol75;al,d,il,ls1vC;ilAF;hom,tC;e,hC;anCy;!a5i5;aYeViLoGuDyC;l4Nr1;hamDr84staC;fa,p6E;ed,mG;di10e,hamEis4JntDritz,sCussa;es,he;e,y;ad,ed,mC;ad,ed;cGgu5hai,kFlEnDtchC;!e8O;a9Pik;house,o7t1;ae73eC3ha8Iolaj;ah,hDkC;!ey,y;aDeC;al,l;el,l;hDlv3rC;le,ri8Ev4T;di,met;ay0c00gn4hWjd,ks2NlTmadZnSrKsXtDuric7VxC;imilBKwe8B;eHhEi69tCus,y69;!eo,hCia7;ew,i67;eDiC;as,eu,s;us,w;j,o;cHiGkFlEqu8Qsha83tCv3;iCy;!m,n;in,on;el,o7us;a6Yo7us;!elCin,o7us;!l8o;frAEi5Zny,u5;achDcoCik;lm;ai,y;amDdi,e5VmC;oud;adCm6W;ou;aulCi9P;ay;aWeOiMloyd,oJuDyC;le,nd1;cFdEiDkCth2uk;a7e;gi,s,z;ov7Cv6Hw6H;!as,iC;a6Een;g0nn52renDuCvA4we7D;!iS;!zo;am,n4oC;n5r;a9Yevi,la5KnHoFst2thaEvC;eCi;nte;bo;nCpo8V;!a82el,id;!nC;aAy;mEnd1rDsz73urenCwr6K;ce,t;ry,s;ar,beAont;aOeIhalHiFla4onr63rDu5SylC;e,s;istCzysztof;i0oph2;er0ngsl9p,rC;ilA9k,ollos;ed,id;en0iGnDrmCv4Z;it;!dDnCt1;e2Ny;ri4Z;r,th;cp2j4mEna8BrDsp6them,uC;ri;im,l;al,il;a03eXiVoFuC;an,lCst3;en,iC;an,en,o,us;aQeOhKkub4AnIrGsDzC;ef;eDhCi9Wue;!ua;!f,ph;dCge;i,on;!aCny;h,s,th6J;anDnC;!ath6Hie,n72;!nC;!es;!l,sCy;ph;o,qu3;an,mC;!i,m6V;d,ffFns,rCs4;a7JemDmai7QoCry;me,ni1H;i9Dy;!e73rC;ey,y;cKdBkImHrEsDvi2yC;dBs1;on,p2;ed,oDrCv67;e6Qod;d,s61;al,es5Wis1;a,e,oCub;b,v;ob,qu13;aTbNchiMgLke53lija,nuKonut,rIsEtCv0;ai,suC;ki;aDha0i8XmaCsac;el,il;ac,iaC;h,s;a,vinCw3;!g;k,nngu6X;nac1Xor;ka;ai,rahC;im;aReLoIuCyd6;beAgGmFsC;eyDsC;a3e3;in,n;ber5W;h,o;m2raDsse3wC;a5Pie;c49t1K;a0Qct3XiGnDrC;beAman08;dr7VrC;iCy2N;!k,q1R;n0Tt3S;bKlJmza,nIo,rEsDyC;a5KdB;an,s0;lEo67r2IuCv9;hi5Hki,tC;a,o;an,ey;k,s;!im;ib;a08e00iUlenToQrMuCyorgy;iHnFsC;!taC;f,vC;!e,o;n6tC;er,h2;do,lC;herDlC;auCerQ;me;aEegCov2;!g,orC;!io,y;dy,h7C;dfr9nza3XrDttfC;ri6C;an,d47;!n;acoGlEno,oCuseppe;rgiCvan6O;!o,s;be6Ies,lC;es;mo;oFrC;aDha4HrC;it,y;ld,rd8;ffErgC;!e7iCy;!os;!r9;bElBrCv3;eCla1Nr4Hth,y;th;e,rC;e3YielC;!i4;aXeSiQlOorrest,rCyod2E;aHedFiC;edDtC;s,z;ri18;!d42eri11riC;ck,k;nCs2;cEkC;ie,lC;in,yn;esLisC;!co,z3M;etch2oC;ri0yd;d5lConn;ip;deriFliEng,rC;dinaCg4nan0B;nd8;pe,x;co;bCdi,hd;iEriC;ce,zC;io;an,en,o;benez2dZfrYit0lTmMnJo3rFsteb0th0ugenEvCymBzra;an,eCge4D;ns,re3K;!e;gi,iDnCrol,v3w3;est8ie,st;cCk;!h,k;o0DriCzo;co,qC;ue;aHerGiDmC;aGe3A;lCrh0;!iC;a10o,s;s1y;nu5;beAd1iEliDm2t1viCwood;n,s;ot28s;!as,j5Hot,sC;ha;a3en;!dGg6mFoDua2QwC;a2Pin;arC;do;oZuZ;ie;a04eTiOmitrNoFrag0uEwDylC;an,l0;ay3Hig4D;a3Gdl9nc0st3;minFnDri0ugCvydGy2S;!lF;!a36nCov0;e1Eie,y;go,iDykC;as;cCk;!k;i,y;armuFetDll1mitri7neCon,rk;sh;er,m6riC;ch;id;andLepak,j0lbeAmetri4nIon,rGsEvDwCxt2;ay30ey;en,in;hawn,moC;nd;ek,riC;ck;is,nC;is,y;rt;re;an,le,mKnIrEvC;e,iC;!d;en,iEne0PrCyl;eCin,yl;l45n;n,o,us;!iCny;el,lo;iCon;an,en,on;a0Fe0Ch03iar0lRoJrFuDyrC;il,us;rtC;!is;aEistC;iaCob12;no;ig;dy,lInErC;ey,neliCy;s,us;nEor,rDstaC;nt3;ad;or;by,e,in,l3t1;aHeEiCyde;fCnt,ve;fo0Xt1;menDt4;us;s,t;rFuDyC;!t1;dCs;e,io;enC;ce;aHeGrisC;!toC;phCs;!eC;!r;st2t;d,rCs;b5leC;s,y;cDdrCs6;ic;il;lHmFrC;ey,lDroCy;ll;!o7t1;er1iC;lo;!eb,v3;a09eZiVjorn,laUoSrEuCyr1;ddy,rtKst2;er;aKeFiEuDyC;an,ce,on;ce,no;an,ce;nDtC;!t;dDtC;!on;an,on;dFnC;dDisC;lav;en,on;!foOl9y;bby,gd0rCyd;is;i0Lke;bElDshC;al;al,lL;ek;nIrCshoi;at,nEtC;!raC;m,nd;aDhaCie;rd;rd8;!iDjam3nCs1;ie,y;to;kaMlazs,nHrC;n9rDtC;!holomew;eCy;tt;ey;dCeD;ar,iC;le;ar1Nb1Dd16fon15gust3hm12i0Zja0Yl0Bm07nTputsiSrGsaFugustEveDyCziz;a0kh0;ry;o,us;hi;aMchiKiJjun,mHnEon,tCy0;em,hCie,ur8;ur;aDoC;!ld;ud,v;aCin;an,nd8;!el,ki;baCe;ld;ta;aq;aMdHgel8tCw6;hoFoC;iDnC;!i8y;ne;ny;er7rCy;eDzC;ej;!as,i,j,s,w;!s;s,tolC;iCy;!y;ar,iEmaCos;nu5r;el;ne,r,t;aVbSdBeJfHiGl01onFphonsEt1vC;aPin;on;e,o;so,zo;!sR;!onZrC;ed;c,jaHksFssaHxC;!andC;er,rC;e,os,u;andCei;ar,er,r;ndC;ro;en;eDrecC;ht;rt8;dd3in,n,sC;taC;ir;ni;dDm6;ar;an,en;ad,eC;d,t;in;so;aGi,olErDvC;ik;ian8;f8ph;!o;mCn;!a;dGeFraDuC;!bakr,lfazl;hCm;am;!l;allFel,oulaye,ulC;!lDrahm0;an;ah,o;ah;av,on",Uncountable:"true¦0:2E;1:2L;2:33;a2Ub2Lc29d22e1Rf1Ng1Eh16i11j0Yk0Wl0Rm0Hn0Do0Cp03rZsLt9uran2Jv7w3you gu0E;a5his17i4oo3;d,l;ldlife,ne;rm8t1;apor,ernacul29i3;neg28ol1Otae;eDhBiAo8r4un3yranny;a,gst1B;aff2Oea1Ko4ue nor3;th;o08u3;bleshoot2Ose1Tt;night,othpas1Vwn3;foEsfoE;me off,n;er3und1;e,mod2S;a,nnis;aDcCeBhAi9ki8o7p6t4u3weepstak0;g1Unshi2Hshi;ati08e3;am,el;ace2Keci0;ap,cc1meth2C;n,ttl0;lk;eep,ingl0or1C;lf,na1Gri0;ene1Kisso1C;d0Wfe2l4nd,t3;i0Iurn;m1Ut;abi0e4ic3;e,ke15;c3i01laxa11search;ogni10rea10;a9e8hys7luto,o5re3ut2;amble,mis0s3ten20;en1Zs0L;l3rk;i28l0EyH; 16i28;a24tr0F;nt3ti0M;i0s;bstetri24vercrowd1Qxyg09;a5e4owada3utella;ys;ptu1Ows;il poliZtional securi2;aAe8o5u3;m3s1H;ps;n3o1K;ey,o3;gamy;a3cha0Elancholy,rchandi1Htallurgy;sl0t;chine3g1Aj1Hrs,thema1Q; learn1Cry;aught1e6i5ogi4u3;ck,g12;c,s1M;ce,ghtn18nguis1LteratWv1;ath1isVss;ara0EindergartPn3;icke0Aowled0Y;e3upit1;a3llyfiGwel0G;ns;ce,gnor6mp5n3;forma00ter3;net,sta07;atiSort3rov;an18;a7e6isto09o3ung1;ckey,mework,ne4o3rseradi8spitali2use arrest;ky;s2y;adquarteXre;ir,libut,ppiHs3;hi3te;sh;ene8l6o5r3um,ymnas11;a3eZ;niUss;lf,re;ut3yce0F;en; 3ti0W;edit0Hpo3;ol;aNicFlour,o4urnit3;ure;od,rgive3uri1wl;ness;arCcono0LducaBlectr9n7quip8thi0Pvery6x3;ist4per3;ti0B;en0J;body,o08th07;joy3tertain3;ment;ici2o3;ni0H;tiS;nings,th;emi02i6o4raugh3ynas2;ts;pe,wnstai3;rs;abet0ce,s3;honZrepu3;te;aDelciChAivi07l8o3urrency;al,ld w6mmenta5n3ral,ttIuscoB;fusiHt 3;ed;ry;ar;assi01oth0;es;aos,e3;eMwK;us;d,rO;a8i6lood,owlHread5u3;ntGtt1;er;!th;lliarJs3;on;g3ss;ga3;ge;cKdviJeroGirFmBn6ppeal court,r4spi3thleL;rin;ithmet3sen3;ic;i6y3;o4th3;ing;ne;se;en5n3;es2;ty;ds;craft;bi8d3nau7;yna3;mi6;ce;id,ous3;ti3;cs",Infinitive:"true¦0:9G;1:9T;2:AD;3:90;4:9Z;5:84;6:AH;7:A9;8:92;9:A0;A:AG;B:AI;C:9V;D:8R;E:8O;F:97;G:6H;H:7D;a94b8Hc7Jd68e4Zf4Mg4Gh4Ai3Qj3Nk3Kl3Bm34nou48o2Vp2Equ2Dr1Es0CtZuTvRwI;aOeNiLors5rI;eJiI;ng,te;ak,st3;d5e8TthI;draw,er;a2d,ep;i2ke,nIrn;d1t;aIie;liADniAry;nJpI;ho8Llift;cov1dJear8Hfound8DlIplug,rav82tie,ve94;eaAo3X;erIo;cut,go,staAFvalA3w2G;aSeQhNoMrIu73;aIe72;ffi3Smp3nsI;aBfo7CpI;i8oD;pp3ugh5;aJiJrIwaD;eat5i2;nk;aImA0;ch,se;ck3ilor,keImp1r8L;! paD;a0Ic0He0Fh0Bi0Al08mugg3n07o05p02qu01tUuLwI;aJeeIim;p,t5;ll7Wy;bNccMffLggeCmmKppJrI;mouFpa6Zvi2;o0re6Y;ari0on;er,i4;e7Numb;li9KmJsiIveD;de,st;er9it;aMe8MiKrI;ang3eIi2;ng27w;fIng;f5le;b,gg1rI;t3ve;a4AiA;a4UeJit,l7DoI;il,of;ak,nd;lIot7Kw;icEve;atGeak,i0O;aIi6;m,y;ft,ng,t;aKi6CoJriIun;nk,v6Q;ot,rt5;ke,rp5tt1;eIll,nd,que8Gv1w;!k,m;aven9ul8W;dd5tis1Iy;a0FeKiJoI;am,t,ut;d,p5;a0Ab08c06d05f01group,hea00iZjoi4lXmWnVpTq3MsOtMup,vI;amp,eJiIo3B;sEve;l,rI;e,t;i8rI;ie2ofE;eLiKpo8PtIurfa4;o24rI;aHiBuctu8;de,gn,st;mb3nt;el,hra0lIreseF;a4e71;d1ew,o07;aHe3Fo2;a7eFiIo6Jy;e2nq41ve;mbur0nf38;r0t;inKleBocus,rJuI;el,rbiA;aBeA;an4e;aBu4;ei2k8Bla43oIyc3;gni39nci3up,v1;oot,uI;ff;ct,d,liIp;se,ze;tt3viA;aAenGit,o7;aWerUinpoiFlumm1LoTrLuI;b47ke,niArIt;poDsuI;aFe;eMoI;cKd,fe4XhibEmo7noJpo0sp1tru6vI;e,i6o5L;un4;la3Nu8;aGclu6dJf1occupy,sup0JvI;a6BeF;etermi4TiB;aGllu7rtr5Ksse4Q;cei2fo4NiAmea7plex,sIva6;eve8iCua6;mp1rItrol,ve;a6It6E;bOccuNmEpMutLverIwe;l07sJtu6Yu0wI;helm;ee,h1F;gr5Cnu2Cpa4;era7i4Ipo0;py,r;ey,seItaH;r2ss;aMe0ViJoIultiply;leCu6Pw;micJnIspla4;ce,g3us;!k;iIke,na9;m,ntaH;aPeLiIo0u3N;ke,ng1quIv5;eIi6S;fy;aKnIss5;d,gI;th5;rn,ve;ng2Gu1N;eep,idnJnI;e4Cow;ap;oHuI;gg3xtaI;po0;gno8mVnIrk;cTdRfQgeChPitia7ju8q1CsNtKun6EvI;a6eIo11;nt,rt,st;erJimi6BoxiPrI;odu4u6;aBn,pr03ru6C;iCpi8tIu8;all,il,ruB;abEibE;eCo3Eu0;iIul9;ca7;i7lu6;b5Xmer0pI;aLer4Uin9ly,oJrI;e3Ais6Bo2;rt,se,veI;riA;le,rt;aLeKiIoiCuD;de,jaInd1;ck;ar,iT;mp1ng,pp5raIve;ng5Mss;ath1et,iMle27oLrI;aJeIow;et;b,pp3ze;!ve5A;gg3ve;aTer45i5RlSorMrJuI;lf4Cndrai0r48;eJiIolic;ght5;e0Qsh5;b3XeLfeEgJsI;a3Dee;eIi2;!t;clo0go,shIwa4Z;ad3F;att1ee,i36;lt1st5;a0OdEl0Mm0FnXquip,rWsVtGvTxI;aRcPeDhOiNpJtIu6;ing0Yol;eKi8lIo0un9;aHoI;it,re;ct,di7l;st,t;a3oDu3B;e30lI;a10u6;lt,mi28;alua7oI;ke,l2;chew,pou0tab19;a0u4U;aYcVdTfSgQhan4joy,lPqOrNsuMtKvI;e0YisI;a9i50;er,i4rI;aHenGuC;e,re;iGol0F;ui8;ar9iC;a9eIra2ulf;nd1;or4;ang1oIu8;r0w;irc3lo0ou0ErJuI;mb1;oaGy4D;b3ct;bKer9pI;hasiIow1;ze;aKody,rI;a4oiI;d1l;lm,rk;ap0eBuI;ci40de;rIt;ma0Rn;a0Re04iKo,rIwind3;aw,ed9oI;wn;agno0e,ff1g,mi2Kne,sLvI;eIul9;rIst;ge,t;aWbVcQlod9mant3pNru3TsMtI;iIoDu37;lJngI;uiA;!l;ol2ua6;eJlIo0ro2;a4ea0;n0r0;a2Xe36lKoIu0S;uIv1;ra9;aIo0;im;a3Kur0;b3rm;af5b01cVduBep5fUliTmQnOpMrLsiCtaGvI;eIol2;lop;ch;a20i2;aDiBloIoD;re,y;oIy;te,un4;eJoI;liA;an;mEv1;a4i0Ao06raud,y;ei2iMla8oKrI;ee,yI;!pt;de,mIup3;missi34po0;de,ma7ph1;aJrief,uI;g,nk;rk;mp5rk5uF;a0Dea0h0Ai09l08oKrIurta1G;a2ea7ipp3uI;mb3;ales4e04habEinci6ll03m00nIrro6;cXdUfQju8no7qu1sLtKvI;eIin4;ne,r9y;aHin2Bribu7;er2iLoli2Epi8tJuI;lt,me;itu7raH;in;d1st;eKiJoIroFu0;rm;de,gu8rm;ss;eJoI;ne;mn,n0;eIlu6ur;al,i2;buCe,men4pI;eIi3ly;l,te;eBi6u6;r4xiC;ean0iT;rcumveFte;eJirp,oI;o0p;riAw;ncIre5t1ulk;el;a02eSi6lQoPrKuI;iXrIy;st,y;aLeaKiJoad5;en;ng;stfeLtX;ke;il,l11mba0WrrMth1;eIow;ed;!coQfrie1LgPhMliLqueaKstJtrIwild1;ay;ow;th;e2tt3;a2eJoI;ld;ad;!in,ui3;me;bysEckfi8ff3tI;he;b15c0Rd0Iff0Ggree,l0Cm09n03ppZrXsQttOuMvJwaE;it;eDoI;id;rt;gIto0X;meF;aIeCraB;ch,in;pi8sJtoI;niA;aKeIi04u8;mb3rt,ss;le;il;re;g0Hi0ou0rI;an9i2;eaKly,oiFrI;ai0o2;nt;r,se;aMi0GnJtI;icipa7;eJoIul;un4y;al;ly0;aJu0;se;lga08ze;iKlI;e9oIu6;t,w;gn;ix,oI;rd;a03jNmiKoJsoI;rb;pt,rn;niIt;st1;er;ouJuC;st;rn;cLhie2knowled9quiItiva7;es4re;ce;ge;eQliOoKrJusI;e,tom;ue;mIst;moJpI;any,liA;da7;ma7;te;pt;andPduBet,i6oKsI;coKol2;ve;liArt,uI;nd;sh;de;ct;on",Person:"true¦0:1Q;a29b1Zc1Md1Ee18f15g13h0Ri0Qj0Nk0Jl0Gm09n06o05p00rPsItCusain bolt,v9w4xzibit,y1;anni,oko on2uji,v1;an,es;en,o;a3ednesday adams,i2o1;lfram,o0Q;ll ferrell,z khalifa;lt disn1Qr1;hol,r0G;a2i1oltai06;n dies0Zrginia wo17;lentino rossi,n goG;a4h3i2ripp,u1yra banks;lZpac shakur;ger woods,mba07;eresa may,or;kashi,t1ylor;um,ya1B;a5carlett johanss0h4i3lobodan milosevic,no2ocr1Lpider1uperm0Fwami; m0Em0E;op dogg,w whi1H;egfried,nbad;akespeaTerlock holm1Sia labeouf;ddam hussa16nt1;a cla11ig9;aAe6i5o3u1za;mi,n dmc,paul,sh limbau1;gh;bin hood,d stew16nald1thko;in0Mo;han0Yngo starr,valdo;ese witherspo0i1mbrandt;ll2nh1;old;ey,y;chmaninoff,ffi,iJshid,y roma1H;a4e3i2la16o1uff daddy;cahont0Ie;lar,p19;le,rZ;lm17ris hilt0;leg,prah winfr0Sra;a2e1iles cra1Bostradam0J; yo,l5tt06wmQ;pole0s;a5e4i2o1ubar03;by,lie5net,rriss0N;randa ju1tt romn0M;ly;rl0GssiaB;cklemo1rkov,s0ta hari,ya angelou;re;ady gaga,e1ibera0Pu;bron jam0Xch wale1e;sa;anye west,e3i1obe bryant;d cudi,efer suther1;la0P;ats,sha;a2effers0fk,k rowling,rr tolki1;en;ck the ripp0Mwaharlal nehru,y z;liTnez,ron m7;a7e5i3u1;lk hog5mphrey1sa01;! bog05;l1tl0H;de; m1dwig,nry 4;an;ile selassFlle ber4m3rrison1;! 1;ford;id,mo09;ry;ast0iannis,o1;odwPtye;ergus0lorence nightinga08r1;an1ederic chopN;s,z;ff5m2nya,ustaXzeki1;el;eril lagasse,i1;le zatop1nem;ek;ie;a6e4i2octor w1rake;ho;ck w1ego maradoC;olf;g1mi lovaOnzel washingt0;as;l1nHrth vadR;ai lNt0;a8h5lint0o1thulhu;n1olio;an,fuci1;us;on;aucKop2ristian baMy1;na;in;millo,ptain beefhe4r1;dinal wols2son1;! palmF;ey;art;a8e5hatt,i3oHro1;ck,n1;te;ll g1ng crosby;atB;ck,nazir bhut2rtil,yon1;ce;to;nksy,rack ob1;ama;l 6r3shton kutch2vril lavig8yn ra1;nd;er;chimed2istot1;le;es;capo2paci1;no;ne",Adjective:"true¦0:AI;1:BS;2:BI;3:BA;4:A8;5:84;6:AV;7:AN;8:AF;9:7H;A:BQ;B:AY;C:BC;D:BH;E:9Y;aA2b9Ec8Fd7We79f6Ng6Eh61i4Xj4Wk4Tl4Im41n3Po36p2Oquart7Pr2Ds1Dt14uSvOwFye29;aMeKhIiHoF;man5oFrth7G;dADzy;despreB1n w97s86;acked1UoleF;!sa6;ather1PeFll o70ste1D;!k5;nt1Ist6Ate4;aHeGiFola5T;bBUce versa,gi3Lle;ng67rsa5R;ca1gBSluAV;lt0PnLpHrGsFttermoBL;ef9Ku3;b96ge1; Hb32pGsFtiAH;ca6ide d4R;er,i85;f52to da2;a0Fbeco0Hc0Bd04e02f01gu1XheaBGiXkn4OmUnTopp06pRrNsJtHus0wF;aFiel3K;nt0rra0P;app0eXoF;ld,uS;eHi37o5ApGuF;perv06spec39;e1ok9O;en,ttl0;eFu5;cogn06gul2RlGqu84sF;erv0olv0;at0en33;aFrecede0E;id,rallel0;am0otic0;aFet;rri0tF;ch0;nFq26vers3;sur0terFv7U;eFrupt0;st0;air,inish0orese98;mploy0n7Ov97xpF;ect0lain0;eHisFocume01ue;clFput0;os0;cid0rF;!a8Scov9ha8Jlyi8nea8Gprivileg0sMwF;aFei9I;t9y;hGircumcFonvin2U;is0;aFeck0;lleng0rt0;b20ppea85ssuGttend0uthorF;iz0;mi8;i4Ara;aLeIhoHip 25oGrF;anspare1encha1i2;geth9leADp notch,rpB;rny,ugh6H;ena8DmpGrFs6U;r49tia4;eCo8P;leFst4M;nt0;a0Dc09e07h06i04ki03l01mug,nobbi4XoVpRqueami4XtKuFymb94;bHccinAi generis,pFr5;erFre7N;! dup9b,vi70;du0li7Lp6IsFurb7J;eq9Atanda9X;aKeJi16o2QrGubboFy4Q;rn;aightFin5GungS; fFfF;or7V;adfa9Pri6;lwa6Ftu82;arHeGir6NlendBot Fry;on;c3Qe1S;k5se; call0lImb9phistic16rHuFviV;ndFth1B;proof;dBry;dFub6; o2A;e60ipF;pe4shod;ll0n d7R;g2HnF;ceEg6ist9;am3Se9;co1Zem5lfFn6Are7; suf4Xi43;aGholFient3A;ar5;rlFt4A;et;cr0me,tisfac7F;aOeIheumatoBiGoF;bu8Ztt7Gy3;ghtFv3; 1Sf6X;cJdu8PlInown0pro69sGtF;ard0;is47oF;lu2na1;e1Suc45;alcit8Xe1ondi2;bBci3mpa1;aSePicayu7laOoNrGuF;bl7Tnjabi;eKiIoF;b7VfGmi49pFxi2M;er,ort81;a7uD;maFor,sti7va2;!ry;ciDexis0Ima2CpaB;in55puli8G;cBid;ac2Ynt 3IrFti2;ma40tFv7W;!i3Z;i2YrFss7R;anoBtF; 5XiF;al,s5V;bSffQkPld OnMrLth9utKverF;!aIbMdHhGni75seas,t,wF;ei74rou74;a63e7A;ue;ll;do1Ger,si6A;d3Qg2Aotu5Z; bFbFe on o7g3Uli7;oa80;fashion0school;!ay; gua7XbFha5Uli7;eat;eHligGsF;ce7er0So1C;at0;diFse;a1e1;aOeNiMoGuF;anc0de; moEnHrthFt6V;!eFwe7L;a7Krn;chaGdescri7Iprof30sF;top;la1;ght5;arby,cessa4ighbor5wlyw0xt;k0usiaFv3;ti8;aQeNiLoHuF;dIltiF;facet0p6;deHlGnFot,rbBst;ochro4Xth5;dy;rn,st;ddle ag0nF;dbloZi,or;ag9diocEga,naGrFtropolit4Q;e,ry;ci8;cIgenta,inHj0Fkeshift,mmGnFri4Oscu61ver18;da5Dy;ali4Lo4U;!stream;abEho;aOeLiIoFumberi8;ngFuti1R;stan3RtF;erm,i4H;ghtGteraF;l,ry,te;heart0wei5O;ft JgFss9th3;al,eFi0M;nda4;nguBps0te5;apGind5noF;wi8;ut;ad0itte4uniW;ce co0Hgno6Mll0Cm04nHpso 2UrF;a2releF;va1; ZaYcoWdReQfOgrNhibi4Ri05nMoLsHtFvalu5M;aAeF;nDrdepe2K;a7iGolFuboI;ub6ve1;de,gF;nifica1;rdi5N;a2er;own;eriIiLluenVrF;ar0eq5H;pt,rt;eHiGoFul1O;or;e,reA;fiFpe26termi5E;ni2;mpFnsideCrreA;le2;ccuCdeq5Ene,ppr4J;fFsitu,vitro;ro1;mJpF;arHeGl15oFrop9;li2r11;n2LrfeA;ti3;aGeFi18;d4BnD;tuE;egGiF;c0YteC;al,iF;tiF;ma2;ld;aOelNiLoFuma7;a4meInHrrGsFur5;ti6;if4E;e58o3U; ma3GsF;ick;ghfalut2HspF;an49;li00pf33;i4llow0ndGrdFtM; 05coEworki8;sy,y;aLener44iga3Blob3oKrGuF;il1Nng ho;aFea1Fizzl0;cGtF;ef2Vis;ef2U;ld3Aod;iFuc2D;nf2R;aVeSiQlOoJrF;aGeFil5ug3;q43tf2O;gFnt3S;i6ra1;lk13oHrF; keeps,eFge0Vm9tu41;g0Ei2Ds3R;liF;sh;ag4Mowe4uF;e1or45;e4nF;al,i2;d Gmini7rF;ti6ve1;up;bl0lDmIr Fst pac0ux;oGreacF;hi8;ff;ed,ili0R;aXfVlTmQnOqu3rMthere3veryday,xF;aApIquisi2traHuF;be48lF;ta1;!va2L;edRlF;icF;it;eAstF;whi6; Famor0ough,tiE;rou2sui2;erGiF;ne1;ge1;dFe2Aoq34;er5;ficF;ie1;g9sF;t,ygF;oi8;er;aWeMiHoGrFue;ea4owY;ci6mina1ne,r31ti8ubQ;dact2Jfficult,m,sGverF;ge1se;creGePjoi1paCtF;a1inA;et,te; Nadp0WceMfiLgeneCliJmuEpeIreliAsGvoF;id,ut;pFtitu2ul1L;eCoF;nde1;ca2ghF;tf13;a1ni2;as0;facto;i5ngero0I;ar0Ce09h07i06l05oOrIuF;rmudgeon5stoma4teF;sy;ly;aIeHu1EystalF; cleFli7;ar;epy;fFv17z0;ty;erUgTloSmPnGrpoCunterclVveFy;rt;cLdJgr21jIsHtrF;aFi2;dic0Yry;eq1Yta1;oi1ug3;escenFuN;di8;a1QeFiD;it0;atoDmensuCpF;ass1SulF;so4;ni3ss3;e1niza1;ci1J;ockwiD;rcumspeAvil;eFintzy;e4wy;leGrtaF;in;ba2;diac,ef00;a00ePiLliJoGrFuck nak0;and new,isk,on22;gGldface,naF; fi05fi05;us;nd,tF;he;gGpartisFzarE;an;tiF;me;autifOhiNlLnHsFyoN;iWtselF;li8;eGiFt;gn;aFfi03;th;at0oF;v0w;nd;ul;ckwards,rF;e,rT; priori,b13c0Zd0Tf0Ng0Ihe0Hl09mp6nt06pZrTsQttracti0MuLvIwF;aGkF;wa1B;ke,re;ant garGeraF;ge;de;diIsteEtF;heFoimmu7;nt07;re;to4;hGlFtu2;eep;en;bitIchiv3roHtF;ifiFsy;ci3;ga1;ra4;ry;pFt;aHetizi8rF;oprF;ia2;llFre1;ed,i8;ng;iquFsy;at0e;ed;cohKiJkaHl,oGriFterX;ght;ne,of;li7;ne;ke,ve;olF;ic;ad;ain07gressiIi6rF;eeF;ab6;le;ve;fGraB;id;ectGlF;ue1;ioF;na2; JaIeGvF;erD;pt,qF;ua2;ma1;hoc,infinitum;cuCquiGtu3u2;al;esce1;ra2;erSjeAlPoNrKsGuF;nda1;e1olu2trF;aAuD;se;te;eaGuF;pt;st;aFve;rd;aFe;ze;ct;ra1;nt",Pronoun:"true¦elle,h3i2me,she,th0us,we,you;e0ou;e,m,y;!l,t;e,im",Preposition:"true¦aPbMcLdKexcept,fIinGmid,notwithstandiWoDpXqua,sCt7u4v2w0;/o,hereSith0;! whHin,oW;ersus,i0;a,s a vis;n1p0;!on;like,til;h1ill,oward0;!s;an,ereby,r0;ough0u;!oM;ans,ince,o that,uch G;f1n0ut;!to;!f;! 0to;effect,part;or,r0;om;espite,own,u3;hez,irca;ar1e0oBy;sides,tween;ri7;bo8cross,ft7lo6m4propos,round,s1t0;!op;! 0;a whole,long 0;as;id0ong0;!st;ng;er;ut",SportsTeam:"true¦0:18;1:1E;2:1D;3:14;a1Db15c0Sd0Kfc dallas,g0Ihouston 0Hindiana0Gjacksonville jagua0k0El0Am01new UoRpKqueens parkJreal salt lake,sBt6utah jazz,vancouver whitecaps,w4yW;ashington 4h10;natio1Mredski2wizar0W;ampa bay 7e6o4;ronto 4ttenham hotspur;blue ja0Mrapto0;nnessee tita2xasD;buccanee0ra0K;a8eattle 6porting kansas0Wt4; louis 4oke0V;c1Drams;marine0s4;eah13ounH;cramento Rn 4;antonio spu0diego 4francisco gJjose earthquak1;char08paB; ran07;a9h6ittsburgh 5ortland t4;imbe0rail blaze0;pirat1steele0;il4oenix su2;adelphia 4li1;eagl1philNunE;dr1;akland 4klahoma city thunder,rlando magic;athle0Lrai4;de0;england 8orleans 7york 4;g5je3knYme3red bul0Xy4;anke1;ian3;pelica2sain3;patrio3revolut4;ion;anchEeAi4ontreal impact;ami 8lwaukee b7nnesota 4;t5vi4;kings;imberwolv1wi2;rewe0uc0J;dolphi2heat,marli2;mphis grizz4ts;li1;a6eic5os angeles 4;clippe0dodFlaB;esterV; galaxy,ke0;ansas city 4nF;chiefs,roya0D; pace0polis col3;astr05dynamo,rocke3texa2;olden state warrio0reen bay pac4;ke0;allas 8e4i04od6;nver 6troit 4;lio2pisto2ti4;ge0;broncYnugge3;cowbo5maver4;icZ;ys;arEelLhAincinnati 8leveland 6ol4;orado r4umbus crew sc;api7ocki1;brow2cavalie0guar4in4;dia2;bengaVre4;ds;arlotte horAicago 4;b5cubs,fire,wh4;iteB;ea0ulQ;diff4olina panthe0; city;altimore Alackburn rove0oston 6rooklyn 4uffalo bilN;ne3;ts;cel5red4; sox;tics;rs;oriol1rave2;rizona Ast8tlanta 4;brav1falco2h4;awA;ns;es;on villa,r4;os;c6di4;amondbac4;ks;ardi4;na4;ls",Unit:"true¦a07b04cXdWexVfTgRhePinYjoule0BkMlJmDnan08oCp9quart0Bsq ft,t7volts,w6y2ze3°1µ0;g,s;c,f,n;dVear1o0;ttR; 0s 0;old;att,b;erNon0;!ne02;ascals,e1i0;cXnt00;rcent,tJ;hms,unceY;/s,e4i0m²,²,³;/h,cro2l0;e0liK;!²;grLsR;gCtJ;it1u0;menQx;erPreP;b5elvins,ilo1m0notO;/h,ph,²;!byGgrEmCs;ct0rtzL;aJogrC;allonJb0ig3rB;ps;a0emtEl oz,t4;hrenheit,radG;aby9;eci3m1;aratDe1m0oulombD;²,³;lsius,nti0;gr2lit1m0;et0;er8;am7;b1y0;te5;l,ps;c2tt0;os0;econd1;re0;!s","Noun|Gerund":"true¦0:3O;1:3M;2:3N;3:3D;4:32;5:2V;6:3E;7:3K;8:36;9:3J;A:3B;a3Pb37c2Jd27e23f1Vg1Sh1Mi1Ij1Gk1Dl18m13n11o0Wp0Pques0Sr0EsTtNunderMvKwFyDzB;eroi0oB;ni0o3P;aw2eB;ar2l3;aEed4hispe5i5oCrB;ap8est3i1;n0ErB;ki0r31;i1r2s9tc9;isualizi0oB;lunt1Vti0;stan4ta6;aFeDhin6iCraBy8;c6di0i2vel1M;mi0p8;aBs1;c9si0;l6n2s1;aUcReQhOiMkatKl2Wmo6nowJpeItFuCwB;ea5im37;b35f0FrB;fi0vB;e2Mi2J;aAoryt1KrCuB;d2KfS;etc9ugg3;l3n4;bCi0;ebBi0;oar4;gnBnAt1;a3i0;ip8oB;p8rte2u1;a1r27t1;hCo5reBulp1;a2Qe2;edu3oo3;i3yi0;aKeEi4oCuB;li0n2;oBwi0;fi0;aFcEhear7laxi0nDpor1sB;pon4tructB;r2Iu5;de5;or4yc3;di0so2;p8ti0;aFeacek20laEoCrBublis9;a1Teten4in1oces7;iso2siB;tio2;n2yi0;ckaAin1rB;ki0t1O;fEpeDrganiCvB;erco24ula1;si0zi0;ni0ra1;fe5;avi0QeBur7;gotia1twor6;aDeCi2oB;de3nito5;a2dita1e1ssaA;int0XnBrke1;ifUufactu5;aEeaDiBodAyi0;cen7f1mi1stB;e2i0;r2si0;n4ug9;iCnB;ea4it1;c6l3;ogAuB;dAgg3stif12;ci0llust0VmDnBro2;nova1sp0NterBven1;ac1vie02;agi2plo4;aDea1iCoBun1;l4w3;ki0ri0;nd3rB;roWvB;es1;aCene0Lli4rBui4;ee1ie0N;rde2the5;aHeGiDlCorBros1un4;e0Pmat1;ir1oo4;gh1lCnBs9;anZdi0;i0li0;e3nX;r0Zscina1;a1du01nCxB;erci7plo5;chan1di0ginB;ee5;aLeHiGoub1rCum8wB;el3;aDeCiB;bb3n6vi0;a0Qs7;wi0;rTscoDvi0;ba1coZlBvelo8;eCiB;ve5;ga1;nGti0;aVelebUhSlPoDrBur3yc3;aBos7yi0;f1w3;aLdi0lJmFnBo6pi0ve5;dDsCvinB;ci0;trBul1;uc1;muniDpB;lBo7;ai2;ca1;lBo5;ec1;c9ti0;ap8eaCimToBubT;ni0t9;ni0ri0;aBee5;n1t1;ra1;m8rCs1te5;ri0;vi0;aPeNitMlLoGrDuB;dge1il4llBr8;yi0;an4eat9oadB;cas1;di0;a1mEokB;i0kB;ee8;pi0;bi0;es7oa1;c9i0;gin2lonAt1;gi0;bysit1c6ki0tt3;li0;ki0;bando2cGdverti7gi0pproac9rgDssuCtB;trac1;mi0;ui0;hi0;si0;coun1ti0;ti0;ni0;ng",PhrasalVerb:"true¦0:92;1:96;2:8H;3:8V;4:8A;5:83;6:85;7:98;8:90;9:8G;A:8X;B:8R;C:8U;D:8S;E:70;F:97;G:8Y;H:81;I:7H;J:79;a9Fb7Uc6Rd6Le6Jf5Ig50h4Biron0j47k40l3Em31n2Yo2Wp2Cquiet Hr1Xs0KtZuXvacuu6QwNyammerBzK;ero Dip LonK;e0k0;by,ov9up;aQeMhLiKor0Mrit19;mp0n3Fpe0r5s5;ackAeel Di0S;aLiKn33;gh 3Wrd0;n Dr K;do1in,oJ;it 79k5lk Lrm 69sh Kt83v60;aw3do1o7up;aw3in,oC;rgeBsK;e 2herE;a00eYhViRoQrMuKypP;ckErn K;do1in,oJup;aLiKot0y 30;ckl7Zp F;ck HdK;e 5Y;n7Wp 3Es5K;ck MdLe Kghten 6me0p o0Rre0;aw3ba4do1in,up;e Iy 2;by,oG;ink Lrow K;aw3ba4in,up;ba4ov9up;aKe 77ll62;m 2r 5M;ckBke Llk K;ov9shit,u47;aKba4do1in,leave,o4Dup;ba4ft9pa69w3;a0Vc0Te0Mh0Ii0Fl09m08n07o06p01quar5GtQuOwK;earMiK;ngLtch K;aw3ba4o8K; by;cKi6Bm 2ss0;k 64;aReQiPoNrKud35;aigh2Det75iK;ke 7Sng K;al6Yup;p Krm2F;by,in,oG;c3Ln3Lr 2tc4O;p F;c3Jmp0nd LrKveAy 2O;e Ht 2L;ba4do1up;ar3GeNiMlLrKurB;ead0ingBuc5;a49it 6H;c5ll o3Cn 2;ak Fe1Xll0;a3Bber 2rt0und like;ap 5Vow Duggl5;ash 6Noke0;eep NiKow 6;cLp K;o6Dup;e 68;in,oK;ff,v9;de19gn 4NnKt 6Gz5;gKkE; al6Ale0;aMoKu5W;ot Kut0w 7M;aw3ba4f48oC;c2WdeEk6EveA;e Pll1Nnd Orv5tK; Ktl5J;do1foLin,o7upK;!on;ot,r5Z;aw3ba4do1in,o33up;oCto;al66out0rK;ap65ew 6J;ilAv5;aXeUiSoOuK;b 5Yle0n Kstl5;aLba4do1inKo2Ith4Nu5P;!to;c2Xr8w3;ll Mot LpeAuK;g3Ind17;a2Wf3Po7;ar8in,o7up;ng 68p oKs5;ff,p18;aKelAinEnt0;c6Hd K;o4Dup;c27t0;aZeYiWlToQrOsyc35uK;ll Mn5Kt K;aKba4do1in,oJto47up;pa4Dw3;a3Jdo1in,o21to45up;attleBess KiNop 2;ah2Fon;iLp Kr4Zu1Gwer 6N;do1in,o6Nup;nt0;aLuK;gEmp 6;ce u20y 6D;ck Kg0le 4An 6p5B;oJup;el 5NncilE;c53ir 39n0ss MtLy K;ba4oG; Hc2R;aw3ba4in,oJ;pKw4Y;e4Xt D;aLerd0oK;dAt53;il Hrrow H;aTeQiPoLuK;ddl5ll I;c1FnkeyMp 6uthAve K;aKdo1in,o4Lup;l4Nw3; wi4K;ss0x 2;asur5e3SlLss K;a21up;t 6;ke Ln 6rKs2Ax0;k 6ryA;do,fun,oCsure,up;a02eViQoLuK;ck0st I;aNc4Fg MoKse0;k Kse4D;aft9ba4do1forw37in56o0Zu46;in,oJ;d 6;e NghtMnLsKve 00;ten F;e 2k 2; 2e46;ar8do1in;aMt LvelK; oC;do1go,in,o7up;nEve K;in,oK;pKut;en;c5p 2sh LtchBughAy K;do1o59;in4Po7;eMick Lnock K;do1oCup;oCup;eLy K;in,up;l Ip K;aw3ba4do1f04in,oJto,up;aMoLuK;ic5mpE;ke3St H;c43zz 2;a01eWiToPuK;nLrrKsh 6;y 2;keLt K;ar8do1;r H;lKneErse3K;d Ke 2;ba4dKfast,o0Cup;ear,o1;de Lt K;ba4on,up;aw3o7;aKlp0;d Ml Ir Kt 2;fKof;rom;f11in,o03uW;cPm 2nLsh0ve Kz2P;at,it,to;d Lg KkerP;do1in,o2Tup;do1in,oK;ut,v9;k 2;aZeTive Rloss IoMrLunK; f0S;ab hold,in43ow 2U; Kof 2I;aMb1Mit,oLr8th1IuK;nd9;ff,n,v9;bo7ft9hQw3;aw3bKdo1in,oJrise,up,w3;a4ir2H;ar 6ek0t K;aLb1Fdo1in,oKr8up;ff,n,ut,v9;cLhKl2Fr8t,w3;ead;ross;d aKng 2;bo7;a0Ee07iYlUoQrMuK;ck Ke2N;ar8up;eLighten KownBy 2;aw3oG;eKshe27; 2z5;g 2lMol Krk I;aKwi20;bo7r8;d 6low 2;aLeKip0;sh0;g 6ke0mKrKtten H;e F;gRlPnNrLsKzzle0;h F;e Km 2;aw3ba4up;d0isK;h 2;e Kl 1T;aw3fPin,o7;ht ba4ure0;ePnLsK;s 2;cMd K;fKoG;or;e D;d04l 2;cNll Krm0t1G;aLbKdo1in,o09sho0Eth08victim;a4ehi2O;pa0C;e K;do1oGup;at Kdge0nd 12y5;in,o7up;aOi1HoNrK;aLess 6op KuN;aw3b03in,oC;gBwB; Ile0ubl1B;m 2;a0Ah05l02oOrLut K;aw3ba4do1oCup;ackBeep LoKy0;ss Dwd0;by,do1in,o0Uup;me NoLuntK; o2A;k 6l K;do1oG;aRbQforOin,oNtKu0O;hLoKrue;geth9;rough;ff,ut,v9;th,wK;ard;a4y;paKr8w3;rt;eaLose K;in,oCup;n 6r F;aNeLiK;ll0pE;ck Der Kw F;on,up;t 2;lRncel0rOsMtch LveE; in;o1Nup;h Dt K;doubt,oG;ry LvK;e 08;aw3oJ;l Km H;aLba4do1oJup;ff,n,ut;r8w3;a0Ve0MiteAl0Fo04rQuK;bblNckl05il0Dlk 6ndl05rLsKtMy FzzA;t 00;n 0HsK;t D;e I;ov9;anWeaUiLush K;oGup;ghQng K;aNba4do1forMin,oLuK;nd9p;n,ut;th;bo7lKr8w3;ong;teK;n 2;k K;do1in,o7up;ch0;arTg 6iRn5oPrNssMttlLunce Kx D;aw3ba4;e 6; ar8;e H;do1;k Dt 2;e 2;l 6;do1up;d 2;aPeed0oKurt0;cMw K;aw3ba4do1o7up;ck;k K;in,oC;ck0nk0stA; oQaNef 2lt0nd K;do1ov9up;er;up;r Lt K;do1in,oCup;do1o7;ff,nK;to;ck Pil0nMrgLsK;h D;ainBe D;g DkB; on;in,o7;aw3do1in,oCup;ff,ut;ay;ct FdQir0sk MuctionA; oG;ff;ar8o7;ouK;nd; o7;d K;do1oKup;ff,n;wn;o7up;ut",ProperNoun:"true¦aIbDc8dalhousHe7f5gosford,h4iron maiden,kirby,landsdowne,m2nis,r1s0wembF;herwood,paldiB;iel,othwe1;cgi0ercedes,issy;ll;intBudsB;airview,lorence,ra0;mpt9nco;lmo,uro;a1h0;arlt6es5risti;rl0talina;et4i0;ng;arb3e0;et1nt0rke0;ley;on;ie;bid,jax","Person|Place":"true¦a8d6h4jordan,k3orlando,s1vi0;ctor9rgin9;a0ydney;lvador,mara,ntia4;ent,obe;amil0ous0;ton;arw2ie0;go;lexandr1ust0;in;ia",LastName:"true¦0:BR;1:BF;2:B5;3:BH;4:AX;5:9Y;6:B6;7:BK;8:B0;9:AV;A:AL;B:8Q;C:8G;D:7K;E:BM;F:AH;aBDb9Zc8Wd88e81f7Kg6Wh64i60j5Lk4Vl4Dm39n2Wo2Op25quispe,r1Ls0Pt0Ev03wTxSyKzG;aIhGimmerm6A;aGou,u;ng,o;khar5ytsE;aKeun9BiHoGun;koya32shiBU;!lG;diGmaz;rim,z;maGng;da,g52mo83sGzaC;aChiBV;iao,u;aLeJiHoGright,u;jcA5lff,ng;lGmm0nkl0sniewsC;kiB1liams33s3;bGiss,lt0;b,er,st0;a6Vgn0lHtG;anabe,s3;k0sh,tG;e2Non;aLeKiHoGukD;gt,lk5roby5;dHllalGnogr3Kr1Css0val3S;ba,ob1W;al,ov4;lasHsel8W;lJn dIrgBEsHzG;qu7;ilyEqu7siljE;en b6Aijk,yk;enzueAIverde;aPeix1VhKi2j8ka43oJrIsui,uG;om5UrG;c2n0un1;an,emblA7ynisC;dorAMlst3Km4rrAth;atch0i8UoG;mHrG;are84laci79;ps3sG;en,on;hirDkah9Mnaka,te,varA;a06ch01eYhUiRmOoMtIuHvGzabo;en9Jobod3N;ar7bot4lliv2zuC;aIeHoG;i7Bj4AyanAB;ele,in2FpheBvens25;l8rm0;kol5lovy5re7Tsa,to,uG;ng,sa;iGy72;rn5tG;!h;l71mHnGrbu;at9cla9Egh;moBo7M;aIeGimizu;hu,vchG;en8Luk;la,r1G;gu9infe5YmGoh,pulveA7rra5P;jGyG;on5;evi6iltz,miHneid0roed0uGwarz;be3Elz;dHtG;!t,z;!t;ar4Th8ito,ka4OlJnGr4saCto,unde19v4;ch7dHtGz;a5Le,os;b53e16;as,ihDm4Po0Y;aVeSiPoJuHyG;a6oo,u;bio,iz,sG;so,u;bKc8Fdrigue67ge10j9YmJosevelt,sItHux,wG;e,li6;a9Ch;enb4Usi;a54e4L;erts15i93;bei4JcHes,vGzzo;as,e9;ci,hards12;ag2es,iHut0yG;es,nol5N;s,t0;dImHnGsmu97v6C;tan1;ir7os;ic,u;aUeOhMiJoHrGut8;asad,if6Zochazk27;lishc2GpGrti72u10we76;e3Aov51;cHe45nG;as,to;as70hl0;aGillips;k,m,n6I;a3Hde3Wete0Bna,rJtG;ersHrovGters54;!a,ic;!en,on;eGic,kiBss3;i9ra,tz,z;h86k,padopoulIrk0tHvG;ic,l4N;el,te39;os;bMconn2Ag2TlJnei6PrHsbor6XweBzG;dem7Rturk;ella4DtGwe6N;ega,iz;iGof7Hs8I;vGyn1R;ei9;aSri1;aPeNiJoGune50ym2;rHvGwak;ak4Qik5otn66;odahl,r4S;cholsZeHkolGls4Jx3;ic,ov84;ls1miG;!n1;ils3mG;co4Xec;gy,kaGray2sh,var38;jiGmu9shiG;ma;a07c04eZiWoMuHyeG;rs;lJnIrGssoli6S;atGp03r7C;i,ov4;oz,te58;d0l0;h2lOnNo0RrHsGza1A;er,s;aKeJiIoz5risHtG;e56on;!on;!n7K;au,i9no,t5J;!lA;r1Btgome59;i3El0;cracFhhail5kkeHlG;l0os64;ls1;hmeJiIj30lHn3Krci0ssiGyer2N;!er;n0Po;er,j0;dDti;cartHlG;aughl8e2;hy;dQe7Egnu68i0jer3TkPmNnMrItHyG;er,r;ei,ic,su21thews;iHkDquAroqu8tinG;ez,s;a5Xc,nG;!o;ci5Vn;a5UmG;ad5;ar5e6Kin1;rig77s1;aVeOiLoJuHyG;!nch;k4nGo;d,gu;mbarGpe3Fvr4we;di;!nGu,yana2B;coln,dG;b21holm,strom;bedEfeKhIitn0kaHn8rGw35;oy;!j;m11tG;in1on1;bvGvG;re;iGmmy,ng,rs2Qu,voie,ws3;ne,t1F;aZeYh2iWlUnez50oNrJuHvar2woG;k,n;cerGmar68znets5;a,o34;aHem0isGyeziu;h23t3O;m0sni4Fus3KvG;ch4O;bay57ch,rh0Usk16vaIwalGzl5;czGsC;yk;cIlG;!cGen4K;huk;!ev4ic,s;e8uiveG;rt;eff0kGl4mu9nnun1;ucF;ll0nnedy;hn,llKminsCne,pIrHstra3Qto,ur,yGzl5;a,s0;j0Rls22;l2oG;or;oe;aPenOha6im14oHuG;ng,r4;e32hInHrge32u6vG;anD;es,ss3;anHnsG;en,on,t3;nesGs1R;en,s1;kiBnings,s1;cJkob4EnGrv0E;kDsG;en,sG;en0Ion;ks3obs2A;brahimDglesi5Nke5Fl0Qno07oneIshikHto,vanoG;u,v54;awa;scu;aVeOiNjaltal8oIrist50uG;!aGb0ghAynh;m2ng;a6dz4fIjgaa3Hk,lHpUrGwe,x3X;ak1Gvat;mAt;er,fm3WmG;ann;ggiBtchcock;iJmingw4BnHrGss;nand7re9;deGriks1;rs3;kkiHnG;on1;la,n1;dz4g1lvoQmOns0ZqNrMsJuIwHyG;asFes;kiB;g1ng;anHhiG;mo14;i,ov0J;di6p0r10t;ue;alaG;in1;rs1;aVeorgUheorghe,iSjonRoLrJuGw3;errGnnar3Co,staf3Ctierr7zm2;a,eG;ro;ayli6ee2Lg4iffithGub0;!s;lIme0UnHodGrbachE;e,m2;calvAzale0S;dGubE;bGs0E;erg;aj,i;bs3l,mGordaO;en7;iev3U;gnMlJmaIndFo,rGsFuthi0;cGdn0za;ia;ge;eaHlG;agh0i,o;no;e,on;aVerQiLjeldsted,lKoIrHuG;chs,entAji41ll0;eem2iedm2;ntaGrt8urni0wl0;na;emi6orA;lipIsHtzgeraG;ld;ch0h0;ovG;!ic;hatDnanIrG;arGei9;a,i;deY;ov4;b0rre1D;dKinsJriksIsGvaB;cob3GpGtra3D;inoza,osiQ;en,s3;te8;er,is3warG;ds;aXePiNjurhuMoKrisco15uHvorakG;!oT;arte,boHmitru,nn,rGt3C;and,ic;is;g2he0Omingu7nErd1ItG;to;us;aGcki2Hmitr2Ossanayake,x3;s,z; JbnaIlHmirGrvisFvi,w2;!ov4;gado,ic;th;bo0groot,jo6lHsilGvriA;va;a cruz,e3uG;ca;hl,mcevsCnIt2WviG;dGes,s;ov,s3;ielsGku22;!en;ki;a0Be06hRiobQlarkPoIrGunningh1H;awfo0RivGuz;elli;h1lKntJoIrGs2Nx;byn,reG;a,ia;ke,p0;i,rer2K;em2liB;ns;!e;anu;aOeMiu,oIristGu6we;eGiaG;ns1;i,ng,p9uHwGy;!dH;dGng;huJ;!n,onGu6;!g;kJnIpm2ttHudhGv7;ry;erjee,o14;!d,g;ma,raboG;rty;bJl0Cng4rG;eghetHnG;a,y;ti;an,ota1C;cerAlder3mpbeLrIstGvadi0B;iGro;llo;doHl0Er,t0uGvalho;so;so,zo;ll;a0Fe01hYiXlUoNrKuIyG;rLtyG;qi;chan2rG;ke,ns;ank5iem,oGyant;oks,wG;ne;gdan5nIruya,su,uchaHyKziG;c,n5;rd;darGik;enG;ko;ov;aGond15;nco,zG;ev4;ancFshw16;a08oGuiy2;umGwmG;ik;ckRethov1gu,ktPnNrG;gJisInG;ascoGds1;ni;ha;er,mG;anG;!n;gtGit7nP;ss3;asF;hi;er,hG;am;b4ch,ez,hRiley,kk0ldw8nMrIshHtAu0;es;ir;bInHtlGua;ett;es,i0;ieYosa;dGik;a9yoG;padhyG;ay;ra;k,ng;ic;bb0Acos09d07g04kht05lZnPrLsl2tJyG;aHd8;in;la;chis3kiG;ns3;aImstro6sl2;an;ng;ujo,ya;dJgelHsaG;ri;ovG;!a;ersJov,reG;aGjEws;ss1;en;en,on,s3;on;eksejEiyEmeiIvG;ar7es;ez;da;ev;arwHuilG;ar;al;ams,l0;er;ta;as",Ordinal:"true¦eBf7nin5s3t0zeroE;enDhir1we0;lfCn7;d,t3;e0ixt8;cond,vent7;et0th;e6ie7;i2o0;r0urt3;tie4;ft1rst;ight0lev1;e0h,ie1;en0;th",Cardinal:"true¦bEeBf5mEnine7one,s4t0zero;en,h2rDw0;e0o;lve,n5;irt6ousands,ree;even2ix2;i3o0;r1ur0;!t2;ty;ft0ve;e2y;ight0lev1;!e0y;en;illions",Multiple:"true¦b3hundred,m3qu2se1t0;housand,r2;pt1xt1;adr0int0;illion",City:"true¦0:74;1:61;2:6G;3:6J;4:5S;a68b53c4Id48e44f3Wg3Hh39i31j2Wk2Fl23m1Mn1Co19p0Wq0Ur0Os05tRuQvLwDxiBy9z5;a7h5i4Muri4O;a5e5ongsh0;ng3H;greb,nzib5G;ang2e5okoha3Sunfu;katerin3Hrev0;a5n0Q;m5Hn;arsBeAi6roclBu5;h0xi,zh5P;c7n5;d5nipeg,terth4;hoek,s1L;hi5Zkl3A;l63xford;aw;a8e6i5ladivost5Molgogr6L;en3lni6S;ni22r5;o3saill4N;lenc4Wncouv3Sr3ughn;lan bat1Crumqi,trecht;aFbilisi,eEheDiBo9r7u5;l21n63r5;in,ku;i5ondh62;es51poli;kyo,m2Zron1Pulo5;n,uS;an5jua3l2Tmisoa6Bra3;j4Tshui; hag62ssaloni2H;gucigal26hr0l av1U;briz,i6llinn,mpe56ng5rtu,shk2R;i3Esh0;an,chu1n0p2Eyu0;aEeDh8kopje,owe1Gt7u5;ra5zh4X;ba0Ht;aten is55ockholm,rasbou67uttga2V;an8e6i5;jiazhua1llo1m5Xy0;f50n5;ya1zh4H;gh3Kt4Q;att45o1Vv44;cramen16int ClBn5o paulo,ppo3Rrajevo; 7aa,t5;a 5o domin3E;a3fe,m1M;antonio,die3Cfrancisco,j5ped3Nsalvad0J;o5u0;se;em,t lake ci5Fz25;lou58peters24;a9e8i6o5;me,t59;ga,o5yadh;! de janei3F;cife,ims,nn3Jykjavik;b4Sip4lei2Inc2Pwalpindi;ingdao,u5;ez2i0Q;aFeEhDiCo9r7u6yong5;ya1;eb59ya1;a5etor3M;g52to;rt5zn0; 5la4Co;au prin0Melizabe24sa03;ls3Prae5Atts26;iladelph3Gnom pe1Aoenix;ki1tah tik3E;dua,lerYnaji,r4Ot5;na,r32;ak44des0Km1Mr6s5ttawa;a3Vlo;an,d06;a7ew5ing2Fovosibir1Jyc; 5cast36;del24orlea44taip14;g8iro4Wn5pl2Wshv33v0;ch6ji1t5;es,o1;a1o1;a6o5p4;ya;no,sa0W;aEeCi9o6u5;mb2Ani26sc3Y;gadishu,nt6s5;c13ul;evideo,pelli1Rre2Z;ami,l6n14s5;kolc,sissauga;an,waukee;cca,d5lbour2Mmph41ndo1Cssi3;an,ell2Xi3;cau,drAkass2Sl9n8r5shh4A;aca6ib5rakesh,se2L;or;i1Sy;a4EchFdal0Zi47;mo;id;aDeAi8o6u5vSy2;anMckn0Odhia3;n5s angel26;d2g bea1N;brev2Be3Lma5nz,sb2verpo28;!ss27; ma39i5;c5pzig;est16; p6g5ho2Wn0Cusan24;os;az,la33;aHharFiClaipeBo9rak0Du7y5;iv,o5;to;ala lump4n5;mi1sh0;hi0Hlka2Xpavog4si5wlo2;ce;da;ev,n5rkuk;gst2sha5;sa;k5toum;iv;bHdu3llakuric0Qmpa3Fn6ohsiu1ra5un1Iwaguc0Q;c0Pj;d5o,p4;ah1Ty;a7e6i5ohannesV;l1Vn0;dd36rusalem;ip4k5;ar2H;bad0mph1OnArkutUs7taXz5;mir,tapala5;pa;fah0l6tanb5;ul;am2Zi2H;che2d5;ianap2Mo20;aAe7o5yder2W; chi mi5ms,nolulu;nh;f6lsin5rakli2;ki;ei;ifa,lifax,mCn5rb1Dva3;g8nov01oi;aFdanEenDhCiPlasgBo9raz,u5;a5jr23;dal6ng5yaquil;zh1J;aja2Oupe;ld coa1Bthen5;bu2S;ow;ent;e0Uoa;sk;lw7n5za;dhi5gt1E;nag0U;ay;aisal29es,o8r6ukuya5;ma;ankfu5esno;rt;rt5sh0; wor6ale5;za;th;d5indhov0Pl paso;in5mont2;bur5;gh;aBe8ha0Xisp4o7resd0Lu5;b5esseldorf,nkirk,rb0shanbe;ai,l0I;ha,nggu0rtmu13;hradSl6nv5troit;er;hi;donghIe6k09l5masc1Zr es sala1KugavpiY;i0lU;gu,je2;aJebu,hAleve0Vo5raio02uriti1Q;lo7n6penhag0Ar5;do1Ok;akKst0V;gUm5;bo;aBen8i6ongqi1ristchur5;ch;ang m7ca5ttago1;go;g6n5;ai;du,zho1;ng5ttogr14;ch8sha,zh07;gliari,i9lga8mayenJn6pe town,r5tanO;acCdiff;ber1Ac5;un;ry;ro;aWeNhKirmingh0WoJr9u5;chareTdapeTenos air7r5s0tu0;g5sa;as;es;a9is6usse5;ls;ba6t5;ol;ne;sil8tisla7zzav5;il5;le;va;ia;goZst2;op6ubaneshw5;ar;al;iCl9ng8r5;g6l5n;in;en;aluru,hazi;fa6grade,o horizon5;te;st;ji1rut;ghd0BkFn9ot8r7s6yan n4;ur;el,r07;celo3i,ranquil09;ou;du1g6ja lu5;ka;alo6k5;ok;re;ng;ers5u;field;a05b02cc01ddis aba00gartaZhmedXizawl,lSmPnHqa00rEsBt7uck5;la5;nd;he7l5;an5;ta;ns;h5unci2;dod,gab5;at;li5;ngt2;on;a8c5kaOtwerp;hora6o3;na;ge;h7p5;ol5;is;eim;aravati,m0s5;terd5;am; 7buquerq6eppo,giers,ma5;ty;ue;basrah al qadim5mawsil al jadid5;ah;ab5;ad;la;ba;ra;idj0u dha5;bi;an;lbo6rh5;us;rg",Region:"true¦0:2O;1:2L;2:2U;3:2F;a2Sb2Fc21d1Wes1Vf1Tg1Oh1Ki1Fj1Bk16l13m0Sn09o07pYqVrSsJtEuBverAw6y4zacatec2W;akut0o0Fu4;cat1k09;a5est 4isconsin,yomi1O;bengal,virgin0;rwick3shington4;! dc;acruz,mont;dmurt0t4;ah,tar4; 2Pa12;a6e5laxca1Vripu21u4;scaEva;langa2nnessee,x2J;bas10m4smQtar29;aulip2Hil nadu;a9elang07i7o5taf16u4ylh1J;ff02rr09s1E;me1Gno1Uuth 4;cZdY;ber0c4kkim,naloa;hu1ily;n5rawak,skatchew1xo4;ny; luis potosi,ta catari2;a4hodeA;j4ngp0C;asth1shahi;ingh29u4;e4intana roo;bec,en6retaro;aAe6rince edward4unjab; i4;sl0G;i,n5r4;ak,nambu0F;a0Rnsylv4;an0;ha0Pra4;!na;axa0Zdisha,h4klaho21ntar4reg7ss0Dx0I;io;aLeEo6u4;evo le4nav0X;on;r4tt18va scot0;f9mandy,th4; 4ampton3;c6d5yo4;rk3;ako1O;aroli2;olk;bras1Nva0Dw4; 6foundland4;! and labrad4;or;brunswick,hamp3jers5mexiTyork4;! state;ey;galPyarit;aAeghala0Mi6o4;nta2r4;dov0elos;ch6dlanDn5ss4zor11;issippi,ouri;as geraPneso18;ig1oac1;dhy12harasht0Gine,lac07ni5r4ssachusetts;anhao,i el,ylG;p4toba;ur;anca3e4incoln3ouisI;e4iR;ds;a6e5h4omi;aka06ul2;dah,lant1ntucky,ra01;bardino,lmyk0ns0Qr4;achay,el0nata0X;alis6har4iangxi;kh4;and;co;daho,llino7n4owa;d5gush4;et0;ia2;is;a6ert5i4un1;dalFm0D;ford3;mp3rya2waii;ansu,eorg0lou7oa,u4;an4izhou,jarat;ajuato,gdo4;ng;cester3;lori4uji1;da;sex;ageUe7o5uran4;go;rs4;et;lawaMrby3;aFeaEh9o4rim08umbr0;ahui7l6nnectic5rsi4ventry;ca;ut;i03orado;la;e5hattisgarh,i4uvash0;apRhuahua;chn5rke4;ss0;ya;ra;lGm4;bridge3peche;a9ihar,r8u4;ck4ryat0;ingham3;shi4;re;emen,itish columb0;h0ja cal8lk7s4v7;hkorto4que;st1;an;ar0;iforn0;ia;dygHguascalientes,lBndhr9r5ss4;am;izo2kans5un4;achal 7;as;na;a 4;pradesh;a6ber5t4;ai;ta;ba5s4;ka;ma;ea",Place:"true¦0:4T;1:4V;2:44;3:4B;4:3I;a4Eb3Gc2Td2Ge26f25g1Vh1Ji1Fk1Cl14m0Vn0No0Jp08r04sTtNuLvJw7y5;a5o0Syz;kut1Bngtze;aDeChitBi9o5upatki,ycom2P;ki26o5;d5l1B;b3Ps5;i4to3Y;c0SllowbroCn5;c2Qgh2;by,chur1P;ed0ntw3Gs22;ke6r3St5;erf1f1; is0Gf3V;auxha3Mirgin is0Jost5;ok;laanbaatar,pto5xb3E;n,wn;a9eotihuac43h7ive49o6ru2Nsarskoe selo,u5;l2Dzigo47;nto,rquay,tt2J;am3e 5orn3E;bronx,hamptons;hiti,j mah0Iu1N;aEcotts bluff,eCfo,herbroQoApring9t7u5yd2F;dbu1Wn5;der03set3B;aff1ock2Nr5;atf1oud;hi37w24;ho,uth5; 1Iam1Zwo3E;a5i2O;f2Tt0;int lawrence riv3Pkhal2D;ayleigh,ed7i5oc1Z;chmo1Eo gran4ver5;be1Dfr09si4; s39cliffe,hi2Y;aCe9h8i5ompeii,utn2;c6ne5tcai2T; 2Pc0G;keri13t0;l,x;k,lh2mbr6n5r2J;n1Hzance;oke;cif38pahanaumokuak30r5;k5then0;si4w1K;ak7r6x5;f1l2X;ange county,d,f1inoco;mTw1G;e8i1Uo5;r5tt2N;th5wi0E; 0Sam19;uschwanste1Pw5; eng6a5h2market,po36;rk;la0P;a8co,e6i5uc;dt1Yll0Z;adow5ko0H;lands;chu picchu,gad2Ridsto1Ql8n7ple6r5;kh2; g1Cw11;hatt2Osf2B;ibu,t0ve1Z;a8e7gw,hr,in5owlOynd02;coln memori5dl2C;al;asi4w3;kefr7mbe1On5s,x;ca2Ig5si05;f1l27t0;ont;azan kreml14e6itchen2Gosrae,rasnoyar5ul;sk;ns0Hs1U;ax,cn,lf1n6ps5st;wiN;d5glew0Lverness;ian27ochina;aDeBi6kg,nd,ov5unti2H;d,enweep;gh6llc5;reL;bu03l5;and5;!s;r5yw0C;ef1tf1;libu24mp6r5stings;f1lem,row;stead,t0;aDodavari,r5uelph;avenAe5imsS;at 8en5; 6f1Fwi5;ch;acr3vall1H;brita0Flak3;hur5;st;ng3y villa0W;airhavHco,ra;aAgli9nf17ppi8u7ver6x5;et1Lf1;glad3t0;rope,st0;ng;nt0;rls1Ls5;t 5;e5si4;nd;aCe9fw,ig8o7ryd6u5xb;mfri3nstab00rh2tt0;en;nca18rcKv19wnt0B;by;n6r5vonpo1D;ry;!h2;nu8r5;l6t5;f1moor;ingt0;be;aLdg,eIgk,hClBo5royd0;l6m5rnwa0B;pt0;c7lingw6osse5;um;ood;he0S;earwat0St;a8el6i5uuk;chen itza,mney ro07natSricahua;m0Zt5;enh2;mor5rlottetPth2;ro;dar 5ntervilA;breaks,faZg5;rove;ld9m8r5versh2;lis6rizo pla5;in;le;bLpbellf1;weQ;aZcn,eNingl01kk,lackLolt0r5uckV;aGiAo5;ckt0ok5wns cany0;lyn,s5;i4to5;ne;de;dge6gh5;am,t0;n6t5;own;or5;th;ceb6m5;lNpt0;rid5;ge;bu5pool,wa8;rn;aconsfEdf1lBr9verly7x5;hi5;ll; hi5;lls;wi5;ck; air,l5;ingh2;am;ie5;ld;ltimore,rnsl6tters5;ea;ey;bLct0driadic,frica,ginJlGmFn9rc8s7tl6yleOzor3;es;!ant8;hcroft,ia; de triomphe,t6;adyr,ca8dov9tarct5;ic5; oce5;an;st5;er;ericas,s;be6dersh5hambra,list0;ot;rt0;cou5;rt;bot7i5;ngd0;on;sf1;ord",Country:"true¦0:38;1:2L;2:3B;a2Xb2Ec22d1Ye1Sf1Mg1Ch1Ai14j12k0Zl0Um0Gn05om2pZqat1KrXsKtCu7v5wal4yemTz3;a25imbabwe;es,lis and futu2Y;a3enezue32ietnam;nuatu,tican city;gTk6nited 4ruXs3zbeE; 2Ca,sr;arab emirat0Kkingdom,states3;! of am2Y;!raiV;a8haCimor les0Co7rinidad 5u3;nis0rk3valu;ey,me2Zs and caic1V;and t3t3;oba1L;go,kel10nga;iw2ji3nz2T;ki2V;aDcotl1eCi9lov8o6pa2Dri lanka,u5w3yr0;az3edAitzerl1;il1;d2riname;lomon1Xmal0uth 3;afr2KkMsud2;ak0en0;erra leoFn3;gapo1Yt maart3;en;negLrb0ychellZ;int 3moa,n marino,udi arab0;hele26luc0mart21;epublic of ir0Eom2Euss0w3;an27;a4eIhilippinUitcairn1Mo3uerto riN;l1rtugF;ki2Dl4nama,pua new0Vra3;gu7;au,esti3;ne;aBe9i7or3;folk1Ith4w3;ay; k3ern mariana1D;or0O;caragua,ger3ue;!ia;p3ther1Aw zeal1;al;mib0u3;ru;a7exi6icro0Bo3yanm06;ldova,n3roc5zambA;a4gol0t3;enegro,serrat;co;cAdagasc01l7r5urit4yot3;te;an0i16;shall0Xtin3;ique;a4div3i,ta;es;wi,ys0;ao,ed02;a6e5i3uxembourg;b3echtenste12thu1G;er0ya;ban0Isotho;os,tv0;azakh1Fe4iriba04o3uwait,yrgyz1F;rXsovo;eling0Knya;a3erG;ma16p2;c7nd6r4s3taly,vory coast;le of m2rael;a3el1;n,q;ia,oJ;el1;aiTon3ungary;dur0Ng kong;aBermany,ha0QibraltAre8u3;a6ern5inea3ya0P;! biss3;au;sey;deloupe,m,tema0Q;e3na0N;ce,nl1;ar;bUmb0;a7i6r3;ance,ench 3;guia0Epoly3;nes0;ji,nl1;lklandUroeU;ast tim7cu6gypt,l salv6ngl1quatorial4ritr5st3thiop0;on0; guin3;ea;ad3;or;enmark,jibou5ominica4r con3;go;!n C;ti;aBentral african Ah8o5roat0u4yprRzech3; 9ia;ba,racao;c4lo3morQngo brazzaville,okGsta r04te de ivoiL;mb0;osE;i3ristmasG;le,na;republic;m3naUpe verde,ymanA;bod0ero3;on;aGeDhut2o9r5u3;lgar0r3;kina faso,ma,undi;azil,itish 3unei;virgin3; is3;lands;liv0nai5snia and herzegoviHtswaHuvet3; isl1;and;re;l3n8rmuG;ar3gium,ize;us;h4ngladesh,rbad3;os;am4ra3;in;as;fghaGlDmBn6r4ustr3zerbaij2;al0ia;genti3men0uba;na;dorra,g5t3;arct7igua and barbu3;da;o3uil3;la;er3;ica;b3ger0;an0;ia;ni3;st2;an",FirstName:"true¦aTblair,cQdOfrancoZgabMhinaLilya,jHkClBm6ni4quinn,re3s0;h0umit,yd;ay,e0iloh;a,lby;g9ne;co,ko0;!s;a1el0ina,org6;!okuhF;ds,naia,r1tt0xiB;i,y;ion,lo;ashawn,eif,uca;a3e1ir0rM;an;lsFn0rry;dall,yat5;i,sD;a0essIie,ude;i1m0;ie,mG;me;ta;rie0y;le;arcy,ev0;an,on;as1h0;arl8eyenne;ey,sidy;drien,kira,l4nd1ubr0vi;ey;i,r0;a,e0;a,y;ex2f1o0;is;ie;ei,is",WeekDay:"true¦fri2mon2s1t0wednesd3;hurs1ues1;aturd1und1;!d0;ay0;!s",Month:"true¦dec0february,july,nov0octo1sept0;em0;ber",Date:"true¦ago,on4som4t1week0yesterd5; end,ends;mr1o0;d2morrow;!w;ed0;ay",Duration:"true¦centurAd8h7m5q4se3w1y0;ear8r8;eek0k7;!end,s;ason,c5;tr,uarter;i0onth3;llisecond2nute2;our1r1;ay0ecade0;!s;ies,y",FemaleName:"true¦0:J7;1:JB;2:IJ;3:IK;4:J1;5:IO;6:JS;7:JO;8:HB;9:JK;A:H4;B:I2;C:IT;D:JH;E:IX;F:BA;G:I4;aGTbFLcDRdD0eBMfB4gADh9Ti9Gj8Dk7Cl5Wm48n3Lo3Hp33qu32r29s15t0Eu0Cv02wVxiTyOzH;aLeIineb,oHsof3;e3Sf3la,ra;h2iKlIna,ynH;ab,ep;da,ma;da,h2iHra;nab;aKeJi0FolB7uIvH;et8onDP;i0na;le0sen3;el,gm3Hn,rGLs8W;aoHme0nyi;m5XyAD;aMendDZhiDGiH;dele9lJnH;if48niHo0;e,f47;a,helmi0lHma;a,ow;ka0nB;aNeKiHusa5;ck84kIl8oleAviH;anFenJ4;ky,toriBK;da,lA8rHs0;a,nHoniH9;a,iFR;leHnesH9;nILrH;i1y;g9rHs6xHA;su5te;aYeUhRiNoLrIuHy2;i,la;acJ3iHu0J;c3na,sH;hFta;nHr0F;iFya;aJffaEOnHs6;a,gtiH;ng;!nFSra;aIeHomasi0;a,l9Oo8Ares1;l3ndolwethu;g9Fo88rIssH;!a,ie;eHi,ri7;sa,za;bOlMmKnIrHs6tia0wa0;a60yn;iHya;a,ka,s6;arFe2iHm77ra;!ka;a,iH;a,t6;at6it6;a0Ecarlett,e0AhWiSkye,neza0oQri,tNuIyH;bIGlvi1;ha,mayIJniAsIzH;an3Net8ie,y;anHi7;!a,e,nH;aCe;aIeH;fan4l5Dphan6E;cI5r5;b3fiAAm0LnHphi1;d2ia,ja,ya;er2lJmon1nIobh8QtH;a,i;dy;lETv3;aMeIirHo0risFDy5;a,lDM;ba,e0i5lJrH;iHr6Jyl;!d8Ifa;ia,lDZ;hd,iMki2nJrIu0w0yH;la,ma,na;i,le9on,ron,yn;aIda,ia,nHon;a,on;!ya;k6mH;!aa;lJrItaye82vH;da,inj;e0ife;en1i0ma;anA9bLd5Oh1SiBkKlJmInd2rHs6vannaC;aCi0;ant6i2;lDOma,ome;ee0in8Tu2;in1ri0;a05eZhXiUoHuthDM;bScRghQl8LnPsJwIxH;anB3ie,y;an,e0;aIeHie,lD;ann7ll1marDGtA;!lHnn1;iHyn;e,nH;a,dF;da,i,na;ayy8G;hel67io;bDRerAyn;a,cIkHmas,nFta,ya;ki,o;h8Xki;ea,iannGMoH;da,n1P;an0bJemFgi0iInHta,y0;a8Bee;han86na;a,eH;cHkaC;a,ca;bi0chIe,i0mo0nHquETy0;di,ia;aERelHiB;!e,le;een4ia0;aPeOhMiLoJrHute6A;iHudenCV;scil3LyamvaB;lHrt3;i0ly;a,paluk;ilome0oebe,ylH;is,lis;ggy,nelope,r5t2;ige,m0VnKo5rvaDMtIulH;a,et8in1;ricHt4T;a,e,ia;do2i07;ctav3dIfD3is6ksa0lHphD3umC5yunbileg;a,ga,iv3;eHvAF;l3t8;aWeUiMoIurHy5;!ay,ul;a,eJor,rIuH;f,r;aCeEma;ll1mi;aNcLhariBQkKlaJna,sHta,vi;anHha;ur;!y;a,iDZki;hoGk9YolH;a,e4P;!mh;hir,lHna,risDEsreE;!a,lBV;asuMdLh3i6Dl5nKomi7rgEVtH;aHhal4;lHs6;i1ya;cy,et8;e9iF0ya;nngu2X;a0Ackenz4e02iMoJrignayani,uriDJyH;a,rH;a,iOlNna,tG;bi0i2llBJnH;a,iH;ca,ka,qD9;a,cUdo4ZkaTlOmi,nMrItzi,yH;ar;aJiIlH;anET;am;!l,nB;dy,eHh,n4;nhGrva;aKdJe0iCUlH;iHy;cent,e;red;!gros;!e5;ae5hH;ae5el3Z;ag5DgNi,lKrH;edi7AiIjem,on,yH;em,l;em,sCG;an4iHliCF;nHsCJ;a,da;!an,han;b09cASd07e,g05ha,i04ja,l02n00rLsoum5YtKuIv84xBKyHz4;bell,ra,soBB;d7rH;a,eE;h8Gild1t4;a,cUgQiKjor4l7Un4s6tJwa,yH;!aHbe6Xja9lAE;m,nBL;a,ha,in1;!aJbCGeIja,lDna,sHt63;!a,ol,sa;!l1D;!h,mInH;!a,e,n1;!awit,i;arJeIie,oHr48ueri8;!t;!ry;et46i3B;el4Xi7Cy;dHon,ue5;akranAy;ak,en,iHlo3S;a,ka,nB;a,re,s4te;daHg4;!l3E;alDd4elHge,isDJon0;ei9in1yn;el,le;a0Ne0CiXoQuLyH;d3la,nH;!a,dIe2OnHsCT;!a,e2N;a,sCR;aD4cJel0Pis1lIna,pHz;e,iA;a,u,wa;iHy;a0Se,ja,l2NnB;is,l1UrItt1LuHvel4;el5is1;aKeIi7na,rH;aADi7;lHn1tA;ei;!in1;aTbb9HdSepa,lNnKsJvIzH;!a,be5Ret8z4;!ia;a,et8;!a,dH;a,sHy;ay,ey,i,y;a,iJja,lH;iHy;aA8e;!aH;!nF;ia,ya;!nH;!a,ne;aPda,e0iNjYla,nMoKsJtHx93y5;iHt4;c3t3;e2PlCO;la,nHra;a,ie,o2;a,or1;a,gh,laH;!ni;!h,nH;a,d2e,n5V;cOdon9DiNkes6mi9Gna,rMtJurIvHxmi,y5;ern1in3;a,e5Aie,yn;as6iIoH;nya,ya;fa,s6;a,isA9;a,la;ey,ie,y;a04eZhXiOlASoNrJyH;lHra;a,ee,ie;istHy6I;a,en,iIyH;!na;!e,n5F;nul,ri,urtnB8;aOerNlB7mJrHzzy;a,stH;en,in;!berlImernH;aq;eHi,y;e,y;a,stE;!na,ra;aHei2ongordzol;dij1w5;el7UiKjsi,lJnIrH;a,i,ri;d2na,za;ey,i,lBLs4y;ra,s6;biAcARdiat7MeBAiSlQmPnyakuma1DrNss6NtKviAyH;!e,lH;a,eH;e,i8T;!a6HeIhHi4TlDri0y;ar8Her8Hie,leErBAy;!lyn8Ori0;a,en,iHl5Xoli0yn;!ma,nFs95;a5il1;ei8Mi,lH;e,ie;a,tl6O;a0AeZiWoOuH;anMdLlHst88;es,iH;a8NeHs8X;!n9tH;!a,te;e5Mi3My;a,iA;!anNcelDdMelGhan7VleLni,sIva0yH;a,ce;eHie;fHlDph7Y;a,in1;en,n1;i7y;!a,e,n45;lHng;!i1DlH;!i1C;anNle0nKrJsH;i8JsH;!e,i8I;i,ri;!a,elGif2CnH;a,et8iHy;!e,f2A;a,eJiInH;a,eIiH;e,n1;!t8;cMda,mi,nIque4YsminFvie2y9zH;min7;a7eIiH;ce,e,n1s;!lHs82t0F;e,le;inIk6HlDquelH;in1yn;da,ta;da,lRmPnOo0rNsIvaHwo0zaro;!a0lu,na;aJiIlaHob89;!n9R;do2;belHdo2;!a,e,l3B;a7Ben1i0ma;di2es,gr72ji;a9elBogH;en1;a,e9iHo0se;a0na;aSeOiJoHus7Kyacin2C;da,ll4rten24snH;a,i9U;lImaH;ri;aIdHlaI;a,egard;ry;ath1BiJlInrietArmi9sH;sa,t1A;en2Uga,mi;di;bi2Fil8MlNnMrJsItHwa,yl8M;i5Tt4;n60ti;iHmo51ri53;etH;!te;aCnaC;a,ey,l4;a02eWiRlPoNrKunJwH;enHyne1R;!dolD;ay,el;acieIetHiselB;a,chE;!la;ld1CogooH;sh;adys,enHor3yn2K;a,da,na;aKgi,lIna,ov8EselHta;a,e,le;da,liH;an;!n0;mLnJorgIrH;ald5Si,m3Etrud7;et8i4X;a,eHna;s29vieve;ma;bIle,mHrnet,yG;al5Si5;iIrielH;a,l1;!ja;aTeQiPlorOoz3rH;anJeIiH;da,eB;da,ja;!cH;esIiHoi0P;n1s66;!ca;a,enc3;en,o0;lIn0rnH;anB;ec3ic3;jr,nArKtHy7;emIiHma,oumaA;ha,ma,n;eh;ah,iBrah,za0;cr4Rd0Re0Qi0Pk0Ol07mXn54rUsOtNuMvHwa;aKelIiH;!e,ta;inFyn;!a;!ngel4V;geni1ni47;h5Yien9ta;mLperanKtH;eIhHrel5;er;l31r7;za;a,eralB;iHma,ne4Lyn;cHka,n;a,ka;aPeNiKmH;aHe21ie,y;!li9nuH;elG;lHn1;e7iHy;a,e,ja;lHrald;da,y;!nue5;aWeUiNlMma,no2oKsJvH;a,iH;na,ra;a,ie;iHuiH;se;a,en,ie,y;a0c3da,e,f,nMsJzaH;!betHveA;e,h;aHe,ka;!beH;th;!a,or;anor,nH;!a,i;!in1na;ate1Rta;leEs6;vi;eIiHna,wi0;e,th;l,n;aYeMh3iLjeneKoH;lor5Vminiq4Ln3FrHtt4;a,eEis,la,othHthy;ea,y;ba;an09naCon9ya;anQbPde,eOiMlJmetr3nHsir5M;a,iH;ce,se;a,iIla,orHphi9;es,is;a,l6F;dHrdH;re;!d5Ena;!b2ForaCraC;a,d2nH;!a,e;hl3i0l0GmNnLphn1rIvi1WyH;le,na;a,by,cIia,lH;a,en1;ey,ie;a,et8iH;!ca,el1Aka,z;arHia;is;a0Re0Nh04i02lUoJristIynH;di,th3;al,i0;lPnMrIurH;tn1D;aJd2OiHn2Ori9;!nH;a,e,n1;!l4;cepci5Cn4sH;tanHuelo;ce,za;eHleE;en,t8;aJeoIotH;il54;!pat2;ir7rJudH;et8iH;a,ne;a,e,iH;ce,sZ;a2er2ndH;i,y;aReNloe,rH;isJyH;stH;al;sy,tH;a1Sen,iHy;an1e,n1;deJlseIrH;!i7yl;a,y;li9;nMrH;isKlImH;ai9;a,eHot8;n1t8;!sa;d2elGtH;al,elG;cIlH;es8i47;el3ilH;e,ia,y;itlYlXmilWndVrMsKtHy5;aIeIhHri0;er1IleErDy;ri0;a38sH;a37ie;a,iOlLmeJolIrH;ie,ol;!e,in1yn;lHn;!a,la;a,eIie,otHy;a,ta;ne,y;na,s1X;a0Ii0I;a,e,l1;isAl4;in,yn;a0Ke02iZlXoUrH;andi7eRiJoIyH;an0nn;nwDoke;an3HdgMgiLtH;n31tH;!aInH;ey,i,y;ny;d,t8;etH;!t7;an0e,nH;da,na;bbi7glarIlo07nH;iAn4;ka;ancHythe;a,he;an1Clja0nHsm3M;iAtH;ou;aWcVlinUniArPssOtJulaCvH;!erlH;ey,y;hJsy,tH;e,iHy7;e,na;!anH;ie,y;!ie;nItHyl;ha,ie;adIiH;ce;et8i9;ay,da;ca,ky;!triH;ce,z;rbJyaH;rmH;aa;a2o2ra;a2Ub2Od25g21i1Sj5l18m0Zn0Boi,r06sWtVuPvOwa,yIzH;ra,u0;aKes6gJlIn,seH;!l;in;un;!nH;a,na;a,i2K;drLguJrIsteH;ja;el3;stH;in1;a,ey,i,y;aahua,he0;hIi2Gja,miAs2DtrH;id;aMlIraqHt21;at;eIi7yH;!n;e,iHy;gh;!nH;ti;iJleIo6piA;ta;en,n1t8;aHelG;!n1J;a01dje5eZgViTjRnKohito,toHya;inet8nH;el5ia;te;!aKeIiHmJ;e,ka;!mHtt7;ar4;!belIliHmU;sa;!l1;a,eliH;ca;ka,sHta;a,sa;elHie;a,iH;a,ca,n1qH;ue;!tH;a,te;!bImHstasiMya;ar3;el;aLberKeliJiHy;e,l3naH;!ta;a,ja;!ly;hGiIl3nB;da;a,ra;le;aWba,ePiMlKthJyH;a,c3sH;a,on,sa;ea;iHys0N;e,s0M;a,cIn1sHza;a,e,ha,on,sa;e,ia,ja;c3is6jaKksaKna,sJxH;aHia;!nd2;ia,saH;nd2;ra;ia;i0nIyH;ah,na;a,is,naCoud;la;c6da,leEmNnLsH;haClH;inHyY;g,n;!h;a,o,slH;ey;ee;en;at6g4nIusH;ti0;es;ie;aWdiTelMrH;eJiH;anMenH;a,e,ne;an0;na;!aLeKiIyH;nn;a,n1;a,e;!ne;!iH;de;e,lDsH;on;yn;!lH;i9yn;ne;aKbIiHrL;!e,gaK;ey,i7y;!e;gaH;il;dKliyJradhIs6;ha;ya;ah;a,ya",Honorific:"true¦director1field marsh2lieutenant1rear0sergeant major,vice0; admir1; gener0;al","Adj|Gerund":"true¦0:3F;1:3H;2:31;3:2X;4:35;5:33;6:3C;7:2Z;8:36;9:29;a33b2Tc2Bd1Te1If19g12h0Zi0Rl0Nm0Gnu0Fo0Ap04rYsKtEuBvAw1Ayiel3;ar6e08;nBpA;l1Rs0B;fol3n1Zsett2;aEeDhrBi4ouc7rAwis0;e0Bif2oub2us0yi1;ea1SiA;l2vi1;l2mp0rr1J;nt1Vxi1;aMcreec7enten2NhLkyrocke0lo0Vmi2oJpHtDuBweA;e0Ul2;pp2ArA;gi1pri5roun3;aBea8iAri2Hun9;mula0r4;gge4rA;t2vi1;ark2eAraw2;e3llb2F;aAot7;ki1ri1;i9oc29;dYtisf6;aEeBive0oAus7;a4l2;assu4defi9fres7ig9juve07mai9s0vAwar3;ea2italiAol1G;si1zi1;gi1ll6mb2vi1;a6eDier23lun1VrAun2C;eBoA;mi5vo1Z;ce3s5vai2;n3rpleA;xi1;ffCpWutBverAwi1;arc7lap04p0Pri3whel8;goi1l6st1J;en3sA;et0;m2Jrtu4;aEeDiCoBuAyst0L;mb2;t1Jvi1;s5tiga0;an1Rl0n3smeri26;dAtu4;de9;aCeaBiAo0U;fesa0Tvi1;di1ni1;c1Fg19s0;llumiGmFnArri0R;cDfurHsCtBviA;go23ti1;e1Oimi21oxica0rig0V;pi4ul0;orpo20r0K;po5;na0;eaBorr02umilA;ia0;li1rtwar8;lFrA;atiDipCoBuelA;i1li1;undbrea10wi1;pi1;f6ng;a4ea8;a3etc7it0lEoCrBulfA;il2;ee1FighXust1L;rAun3;ebo3thco8;aCoA;a0wA;e4i1;mi1tte4;lectrJmHnExA;aCci0hBis0pA;an3lo3;aOila1B;c0spe1A;ab2coura0CdBergi13ga0Clive9ric7s02tA;hral2i0J;ea4u4;barras5er09pA;owe4;if6;aQeIiBrA;if0;sAzz6;aEgDhearCsen0tA;rAur11;ac0es5;te9;us0;ppoin0r8;biliGcDfi9gra3ligh0mBpres5sAvasG;erE;an3ea9orA;ali0L;a6eiBli9rA;ea5;vi1;ta0;maPri1s7un0zz2;aPhMlo5oAripp2ut0;mGnArrespon3;cer9fDspi4tA;inBrA;as0ibu0ol2;ui1;lic0u5;ni1;fDmCpA;eAromi5;l2ti1;an3;or0;aAil2;llenAnAr8;gi1;l8ptAri1;iva0;aff2eGin3lFoDrBuA;d3st2;eathtaAui5;ki1;gg2i2o8ri1unA;ci1;in3;co8wiA;lAtc7;de4;bsorVcOgonMlJmHnno6ppea2rFsA;pi4su4toA;nBun3;di1;is7;hi1;res0;li1;aFu5;si1;ar8lu4;ri1;mi1;iAzi1;zi1;cAhi1;eleDomA;moBpan6;yi1;da0;ra0;ti1;bi1;ng",Comparable:"true¦0:3C;1:3Q;2:3F;a3Tb3Cc33d2Te2Mf2Ag1Wh1Li1Fj1Ek1Bl13m0Xn0So0Rp0Iqu0Gr07sHtCug0vAw4y3za0Q;el10ouN;ary,e6hi5i3ry;ck0Cde,l3n1ry,se;d,y;ny,te;a3i3R;k,ry;a3erda2ulgar;gue,in,st;a6en2Xhi5i4ouZr3;anqu2Cen1ue;dy,g36me0ny;ck,rs28;ll,me,rt,wd3I;aRcaPeOhMiLkin0BlImGoEpDt6u4w3;eet,ift;b3dd0Wperfi21rre28;sta26t21;a8e7iff,r4u3;pUr1;a4ict,o3;ng;ig2Vn0N;a1ep,rn;le,rk,te0;e1Si2Vright0;ci1Yft,l3on,re;emn,id;a3el0;ll,rt;e4i3y;g2Mm0Z;ek,nd2T;ck24l0mp1L;a3iRrill,y;dy,l01rp;ve0Jxy;n1Jr3;ce,y;d,fe,int0l1Hv0V;a8e6i5o3ude;mantic,o19sy,u3;gh;pe,t1P;a3d,mo0A;dy,l;gg4iFndom,p3re,w;id;ed;ai2i3;ck,et;hoAi1Fl9o8r5u3;ny,r3;e,p11;egna2ic4o3;fouSud;ey,k0;liXor;ain,easa2;ny;dd,i0ld,ranL;aive,e5i4o3u14;b0Sisy,rm0Ysy;bb0ce,mb0R;a3r1w;r,t;ad,e5ild,o4u3;nda12te;ist,o1;a4ek,l3;low;s0ty;a8e7i6o3ucky;f0Jn4o15u3ve0w10y0N;d,sy;e0g;ke0l,mp,tt0Eve0;e1Qwd;me,r3te;ge;e4i3;nd;en;ol0ui19;cy,ll,n3;secu6t3;e3ima4;llege2rmedia3;te;re;aAe7i6o5u3;ge,m3ng1C;bYid;me0t;gh,l0;a3fXsita2;dy,rWv3;en0y;nd13ppy,r3;d3sh;!y;aFenEhCiBlAoofy,r3;a8e6i5o3ue0Z;o3ss;vy;m,s0;at,e3y;dy,n;nd,y;ad,ib,ooD;a2d1;a3o3;st0;tDuiS;u1y;aCeebBi9l8o6r5u3;ll,n3r0N;!ny;aCesh,iend0;a3nd,rmD;my;at,ir7;erce,nan3;ci9;le;r,ul3;ty;a6erie,sse4v3xtre0B;il;nti3;al;r4s3;tern,y;ly,th0;appZe9i5ru4u3;mb;nk;r5vi4z3;zy;ne;e,ty;a3ep,n9;d3f,r;!ly;agey,h8l7o5r4u3;dd0r0te;isp,uel;ar3ld,mmon,st0ward0zy;se;evKou1;e3il0;ap,e3;sy;aHiFlCoAr5u3;ff,r0sy;ly;a6i3oad;g4llia2;nt;ht;sh,ve;ld,un3;cy;a4o3ue;nd,o1;ck,nd;g,tt3;er;d,ld,w1;dy;bsu6ng5we3;so3;me;ry;rd",Adverb:"true¦a08b05d00eYfSheQinPjustOkinda,likewiZmMnJoEpCquite,r9s5t2u0very,well;ltima01p0; to,wards5;h1iny bit,o0wiO;o,t6;en,us;eldom,o0uch;!me1rt0; of;how,times,w0C;a1e0;alS;ndomRth05;ar excellenEer0oint blank; Lhaps;f3n0utright;ce0ly;! 0;ag05moX; courGten;ewJo0; longWt 0;onHwithstand9;aybe,eanwhiNore0;!ovT;! aboX;deed,steY;lla,n0;ce;or3u0;ck1l9rther0;!moK;ing; 0evK;exampCgood,suH;n mas0vI;se;e0irect2; 2fini0;te0;ly;juAtrop;ackward,y 0;far,no0; means,w; GbroFd nauseam,gEl7ny5part,s4t 2w0;ay,hi0;le;be7l0mo7wor7;arge,ea6; soon,i4;mo0way;re;l 3mo2ongsi1ready,so,togeth0ways;er;de;st;b1t0;hat;ut;ain;ad;lot,posteriori",Conjunction:"true¦aXbTcReNhowMiEjust00noBo9p8supposing,t5wh0yet;e1il0o3;e,st;n1re0thN; if,by,vM;evL;h0il,o;erefOo0;!uU;lus,rovided th9;r0therwiM;! not; mattEr,w0;! 0;since,th4w7;f4n0; 0asmuch;as mIcaForder t0;h0o;at;! 0;only,t0w0;hen;!ev3;ith2ven0;! 0;if,tB;er;o0uz;s,z;e0ut,y the time;cau1f0;ore;se;lt3nd,s 0;far1if,m0soon1t2;uch0; as;hou0;gh",Currency:"true¦$,aud,bQcOdJeurIfHgbp,hkd,iGjpy,kElDp8r7s3usd,x2y1z0¢,£,¥,ден,лв,руб,฿,₡,₨,€,₭,﷼;lotyQł;en,uanP;af,of;h0t5;e0il5;k0q0;elK;oubleJp,upeeJ;e2ound st0;er0;lingG;n0soF;ceEnies;empi7i7;n,r0wanzaCyatC;!onaBw;ls,nr;ori7ranc9;!os;en3i2kk,o0;b0ll2;ra5;me4n0rham4;ar3;e0ny;nt1;aht,itcoin0;!s",Determiner:"true¦aBboth,d9e6few,le5mu8neiDplenty,s4th2various,wh0;at0ich0;evC;a0e4is,ose;!t;everal,ome;!ast,s;a1l0very;!se;ch;e0u;!s;!n0;!o0y;th0;er","Adj|Present":"true¦a07b04cVdQeNfJhollIidRlEmCnarrIoBp9qua8r7s3t2uttFw0;aKet,ro0;ng,u08;endChin;e2hort,l1mooth,our,pa9tray,u0;re,speU;i2ow;cu6da02leSpaN;eplica01i02;ck;aHerfePr0;eseUime,omV;bscu1pen,wn;atu0e3odeH;re;a2e1ive,ow0;er;an;st,y;ow;a2i1oul,r0;ee,inge;rm;iIke,ncy,st;l1mpty,x0;emHpress;abo4ic7;amp,e2i1oub0ry,ull;le;ffu9re6;fu8libe0;raE;alm,l5o0;mpleCn3ol,rr1unterfe0;it;e0u7;ct;juga8sum7;ea1o0;se;n,r;ankru1lu0;nt;pt;li2pproxi0rticula1;ma0;te;ght","Person|Adj":"true¦b3du2earnest,frank,mi2r0san1woo1;an0ich,u1;dy;sty;ella,rown",Modal:"true¦c5lets,m4ought3sh1w0;ill,o5;a0o4;ll,nt;! to,a;ight,ust;an,o0;uld",Verb:"true¦born,cannot,gonna,has,keep tabs,msg","Person|Verb":"true¦b8ch7dr6foster,gra5ja9lan4ma2ni9ollie,p1rob,s0wade;kip,pike,t5ue;at,eg,ier2;ck,r0;k,shal;ce;ce,nt;ew;ase,u1;iff,l1ob,u0;ck;aze,ossom","Person|Date":"true¦a2j0sep;an0une;!uary;p0ugust,v0;ril"},MO="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").reduce((function(e,t,n){return e[t]=n,e}),{}),FO=function(e){if(void 0!==MO[e])return MO[e];let t=0,n=1,r=36,i=1;for(;n<e.length;t+=r,n++,r*=36);for(let n=e.length-1;n>=0;n--,i*=36){let r=e.charCodeAt(n)-48;r>10&&(r-=7),t+=r*i}return t},UO=function(e,t,n){const r=FO(t);return r<e.symCount?e.syms[r]:n+r+1-e.symCount},BO=["Possessive","Pronoun"],VO={a:[[/(antenn|formul|nebul|vertebr|vit)a$/i,"$1ae"],[/ia$/i,"ia"]],e:[[/(kn|l|w)ife$/i,"$1ives"],[/(hive)$/i,"$1s"],[/([m|l])ouse$/i,"$1ice"],[/([m|l])ice$/i,"$1ice"]],f:[[/^(dwar|handkerchie|hoo|scar|whar)f$/i,"$1ves"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)f$/i,"$1ves"]],i:[[/(octop|vir)i$/i,"$1i"]],m:[[/([ti])um$/i,"$1a"]],n:[[/^(oxen)$/i,"$1"]],o:[[/(al|ad|at|er|et|ed)o$/i,"$1oes"]],s:[[/(ax|test)is$/i,"$1es"],[/(alias|status)$/i,"$1es"],[/sis$/i,"ses"],[/(bu)s$/i,"$1ses"],[/(sis)$/i,"ses"],[/^(?!talis|.*hu)(.*)man$/i,"$1men"],[/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,"$1i"]],x:[[/(matr|vert|ind|cort)(ix|ex)$/i,"$1ices"],[/^(ox)$/i,"$1en"]],y:[[/([^aeiouy]|qu)y$/i,"$1ies"]],z:[[/(quiz)$/i,"$1zes"]]},zO=/([xsz]|ch|sh)$/,HO=function(e="",t){let{irregularPlurals:n,uncountable:r}=t.two;if(r.hasOwnProperty(e))return e;if(n.hasOwnProperty(e))return n[e];let i=function(e){let t=e[e.length-1];if(!0===VO.hasOwnProperty(t))for(let n=0;n<VO[t].length;n+=1){let r=VO[t][n][0];if(!0===r.test(e))return e.replace(r,VO[t][n][1])}return null}(e);return null!==i?i:zO.test(e)?e+"es":e+"s"},GO=/\|/;let qO={"20th century fox":"Organization","7 eleven":"Organization","motel 6":"Organization",g8:"Organization",vh1:"Organization","76ers":"SportsTeam","49ers":"SportsTeam",q1:"Date",q2:"Date",q3:"Date",q4:"Date",km2:"Unit",m2:"Unit",dm2:"Unit",cm2:"Unit",mm2:"Unit",mile2:"Unit",in2:"Unit",yd2:"Unit",ft2:"Unit",m3:"Unit",dm3:"Unit",cm3:"Unit",in3:"Unit",ft3:"Unit",yd3:"Unit","at&t":"Organization","black & decker":"Organization","h & m":"Organization","johnson & johnson":"Organization","procter & gamble":"Organization","ben & jerry's":"Organization","&":"Conjunction",i:["Pronoun","Singular"],he:["Pronoun","Singular"],she:["Pronoun","Singular"],it:["Pronoun","Singular"],they:["Pronoun","Plural"],we:["Pronoun","Plural"],was:["Copula","PastTense"],is:["Copula","PresentTense"],are:["Copula","PresentTense"],am:["Copula","PresentTense"],were:["Copula","PastTense"],her:BO,his:BO,hers:BO,their:BO,theirs:BO,themselves:BO,your:BO,our:BO,ours:BO,my:BO,its:BO,vs:["Conjunction","Abbreviation"],if:["Condition","Preposition"],closer:"Comparative",closest:"Superlative",much:"Adverb",may:"Modal",babysat:"PastTense",blew:"PastTense",drank:"PastTense",drove:"PastTense",forgave:"PastTense",skiied:"PastTense",spilt:"PastTense",stung:"PastTense",swam:"PastTense",swung:"PastTense",guaranteed:"PastTense",shrunk:"PastTense",nears:"PresentTense",nearing:"Gerund",neared:"PastTense",no:["Negative","Expression"]},KO={};const WO={two:{irregularPlurals:$O,uncountable:{}}};Object.keys(LO).forEach((e=>{let t=function(e){if(!e)return{};const t=e.split("|").reduce(((e,t)=>{const n=t.split("¦");return e[n[0]]=n[1],e}),{}),n={};return Object.keys(t).forEach((function(e){const r=function(e){const t={nodes:e.split(";"),syms:[],symCount:0};return e.match(":")&&function(e){const t=new RegExp("([0-9A-Z]+):([0-9A-Z]+)");for(let n=0;n<e.nodes.length;n++){const r=t.exec(e.nodes[n]);if(!r){e.symCount=n;break}e.syms[FO(r[1])]=FO(r[2])}e.nodes=e.nodes.slice(e.symCount,e.nodes.length)}(t),function(e){const t=[],n=(r,i)=>{let s=e.nodes[r];"!"===s[0]&&(t.push(i),s=s.slice(1));const a=s.split(/([A-Z0-9,]+)/g);for(let s=0;s<a.length;s+=2){const o=a[s],l=a[s+1];if(!o)continue;const c=i+o;if(","===l||void 0===l){t.push(c);continue}const u=UO(e,l,r);n(u,c)}};return n(0,""),t}(t)}(t[e]);"true"===e&&(e=!0);for(let t=0;t<r.length;t++){const i=r[t];!0===n.hasOwnProperty(i)?!1===Array.isArray(n[i])?n[i]=[n[i],e]:n[i].push(e):n[i]=e}})),n}(LO[e]);GO.test(e)?Object.keys(t).forEach((t=>{if(KO[t]=e,"Noun|Verb"===e){let e=HO(t,WO);KO[e]="Plural|Verb"}})):Object.keys(t).forEach((t=>{qO[t]=e}))})),[":(",":)",":P",":p",":O",";(",";)",";P",";p",";O",":3",":|",":/",":\\",":$",":*",":@",":-(",":-)",":-P",":-p",":-O",":-3",":-|",":-/",":-\\",":-$",":-*",":-@",":^(",":^)",":^P",":^p",":^O",":^3",":^|",":^/",":^\\",":^$",":^*",":^@","):","(:","$:","*:",")-:","(-:","$-:","*-:",")^:","(^:","$^:","*^:","<3","</3","<\\3","=("].forEach((e=>qO[e]="Emoticon")),delete qO[""],delete qO.null,delete qO[" "];const JO="Singular",ZO={beforeTags:{Determiner:JO,Possessive:JO,Acronym:JO,Noun:JO,Adjective:JO,PresentTense:JO,Gerund:JO,PastTense:JO,Infinitive:JO,Date:JO,Ordinal:JO,Demonym:JO},afterTags:{Value:JO,Modal:JO,Copula:JO,PresentTense:JO,PastTense:JO,Demonym:JO,Actor:JO},beforeWords:{the:JO,with:JO,without:JO,of:JO,for:JO,any:JO,all:JO,on:JO,cut:JO,cuts:JO,increase:JO,decrease:JO,raise:JO,drop:JO,save:JO,saved:JO,saves:JO,make:JO,makes:JO,made:JO,minus:JO,plus:JO,than:JO,another:JO,versus:JO,neither:JO,about:JO,favorite:JO,best:JO,daily:JO,weekly:JO,linear:JO,binary:JO,mobile:JO,lexical:JO,technical:JO,computer:JO,scientific:JO,security:JO,government:JO,popular:JO,formal:JO,no:JO,more:JO,one:JO,let:JO,her:JO,his:JO,their:JO,our:JO,us:JO,sheer:JO,monthly:JO,yearly:JO,current:JO,previous:JO,upcoming:JO,last:JO,next:JO,main:JO,initial:JO,final:JO,beginning:JO,end:JO,top:JO,bottom:JO,future:JO,past:JO,major:JO,minor:JO,side:JO,central:JO,peripheral:JO,public:JO,private:JO},afterWords:{of:JO,system:JO,aid:JO,method:JO,utility:JO,tool:JO,reform:JO,therapy:JO,philosophy:JO,room:JO,authority:JO,says:JO,said:JO,wants:JO,wanted:JO,is:JO,did:JO,do:JO,can:JO,wise:JO}},QO="Infinitive",XO={beforeTags:{Modal:QO,Adverb:QO,Negative:QO,Plural:QO},afterTags:{Determiner:QO,Adverb:QO,Possessive:QO,Reflexive:QO,Preposition:QO,Cardinal:QO,Comparative:QO,Superlative:QO},beforeWords:{i:QO,we:QO,you:QO,they:QO,to:QO,please:QO,will:QO,have:QO,had:QO,would:QO,could:QO,should:QO,do:QO,did:QO,does:QO,can:QO,must:QO,us:QO,me:QO,let:QO,even:QO,when:QO,help:QO,he:QO,she:QO,it:QO,being:QO,bi:QO,co:QO,contra:QO,de:QO,inter:QO,intra:QO,mis:QO,pre:QO,out:QO,counter:QO,nobody:QO,somebody:QO,anybody:QO,everybody:QO},afterWords:{the:QO,me:QO,you:QO,him:QO,us:QO,her:QO,his:QO,them:QO,they:QO,it:QO,himself:QO,herself:QO,itself:QO,myself:QO,ourselves:QO,themselves:QO,something:QO,anything:QO,a:QO,an:QO,up:QO,down:QO,by:QO,out:QO,off:QO,under:QO,what:QO,all:QO,to:QO,because:QO,although:QO,how:QO,otherwise:QO,together:QO,though:QO,into:QO,yet:QO,more:QO,here:QO,there:QO,away:QO}},YO={beforeTags:Object.assign({},XO.beforeTags,ZO.beforeTags,{}),afterTags:Object.assign({},XO.afterTags,ZO.afterTags,{}),beforeWords:Object.assign({},XO.beforeWords,ZO.beforeWords,{}),afterWords:Object.assign({},XO.afterWords,ZO.afterWords,{})},eS="Adjective",tS={beforeTags:{Determiner:eS,Possessive:eS,Hyphenated:eS},afterTags:{Adjective:eS},beforeWords:{seem:eS,seemed:eS,seems:eS,feel:eS,feels:eS,felt:eS,stay:eS,appear:eS,appears:eS,appeared:eS,also:eS,over:eS,under:eS,too:eS,it:eS,but:eS,still:eS,really:eS,quite:eS,well:eS,very:eS,truly:eS,how:eS,deeply:eS,hella:eS,profoundly:eS,extremely:eS,so:eS,badly:eS,mostly:eS,totally:eS,awfully:eS,rather:eS,nothing:eS,something:eS,anything:eS,not:eS,me:eS,is:eS,face:eS,faces:eS,faced:eS,look:eS,looks:eS,looked:eS,reveal:eS,reveals:eS,revealed:eS,sound:eS,sounded:eS,sounds:eS,remains:eS,remained:eS,prove:eS,proves:eS,proved:eS,becomes:eS,stays:eS,tastes:eS,taste:eS,smells:eS,smell:eS,gets:eS,grows:eS,as:eS,rings:eS,radiates:eS,conveys:eS,convey:eS,conveyed:eS,of:eS},afterWords:{too:eS,also:eS,or:eS,enough:eS,as:eS}},nS="Gerund",rS={beforeTags:{Adverb:nS,Preposition:nS,Conjunction:nS},afterTags:{Adverb:nS,Possessive:nS,Person:nS,Pronoun:nS,Determiner:nS,Copula:nS,Preposition:nS,Conjunction:nS,Comparative:nS},beforeWords:{been:nS,keep:nS,continue:nS,stop:nS,am:nS,be:nS,me:nS,began:nS,start:nS,starts:nS,started:nS,stops:nS,stopped:nS,help:nS,helps:nS,avoid:nS,avoids:nS,love:nS,loves:nS,loved:nS,hate:nS,hates:nS,hated:nS},afterWords:{you:nS,me:nS,her:nS,him:nS,his:nS,them:nS,their:nS,it:nS,this:nS,there:nS,on:nS,about:nS,for:nS,up:nS,down:nS}},iS="Gerund",sS="Adjective",aS={beforeTags:Object.assign({},tS.beforeTags,rS.beforeTags,{Imperative:iS,Infinitive:sS,Plural:iS}),afterTags:Object.assign({},tS.afterTags,rS.afterTags,{Noun:sS}),beforeWords:Object.assign({},tS.beforeWords,rS.beforeWords,{is:sS,are:iS,was:sS,of:sS,suggest:iS,suggests:iS,suggested:iS,recommend:iS,recommends:iS,recommended:iS,imagine:iS,imagines:iS,imagined:iS,consider:iS,considered:iS,considering:iS,resist:iS,resists:iS,resisted:iS,avoid:iS,avoided:iS,avoiding:iS,except:sS,accept:sS,assess:iS,explore:iS,fear:iS,fears:iS,appreciate:iS,question:iS,help:iS,embrace:iS,with:sS}),afterWords:Object.assign({},tS.afterWords,rS.afterWords,{to:iS,not:iS,the:iS})},oS={beforeTags:Object.assign({},tS.beforeTags,ZO.beforeTags,{Determiner:void 0,Cardinal:"Noun",PhrasalVerb:"Adjective"}),afterTags:Object.assign({},tS.afterTags,ZO.afterTags,{}),beforeWords:Object.assign({},tS.beforeWords,ZO.beforeWords,{are:"Adjective",is:"Adjective",was:"Adjective",be:"Adjective",off:"Adjective",out:"Adjective"}),afterWords:Object.assign({},tS.afterWords,ZO.afterWords)};let lS="PastTense",cS="Adjective";const uS={beforeTags:{Adverb:lS,Pronoun:lS,ProperNoun:lS,Auxiliary:lS,Noun:lS},afterTags:{Possessive:lS,Pronoun:lS,Determiner:lS,Adverb:lS,Comparative:lS,Date:lS,Gerund:lS},beforeWords:{be:lS,who:lS,get:cS,had:lS,has:lS,have:lS,been:lS,it:lS,as:lS,for:cS,more:cS,always:cS},afterWords:{by:lS,back:lS,out:lS,in:lS,up:lS,down:lS,before:lS,after:lS,for:lS,the:lS,with:lS,as:lS,on:lS,at:lS,between:lS,to:lS,into:lS,us:lS,them:lS,his:lS,her:lS,their:lS,our:lS,me:lS,about:cS}},hS={beforeTags:Object.assign({},tS.beforeTags,uS.beforeTags),afterTags:Object.assign({},tS.afterTags,uS.afterTags),beforeWords:Object.assign({},tS.beforeWords,uS.beforeWords),afterWords:Object.assign({},tS.afterWords,uS.afterWords)},dS={beforeTags:Object.assign({},tS.beforeTags,XO.beforeTags,{Adverb:void 0,Negative:void 0}),afterTags:Object.assign({},tS.afterTags,XO.afterTags,{Noun:"Adjective",Conjunction:void 0}),beforeWords:Object.assign({},tS.beforeWords,XO.beforeWords,{have:void 0,had:void 0,not:void 0,went:"Adjective",goes:"Adjective",got:"Adjective",be:"Adjective"}),afterWords:Object.assign({},tS.afterWords,XO.afterWords,{to:void 0,as:"Adjective"})},pS={beforeTags:Object.assign({},rS.beforeTags,ZO.beforeTags,{Copula:"Gerund",PastTense:"Gerund",PresentTense:"Gerund",Infinitive:"Gerund"}),afterTags:Object.assign({},rS.afterTags,ZO.afterTags,{Value:"Gerund"}),beforeWords:Object.assign({},rS.beforeWords,ZO.beforeWords,{are:"Gerund",were:"Gerund",be:"Gerund",no:"Gerund",without:"Gerund",you:"Gerund",we:"Gerund",they:"Gerund",he:"Gerund",she:"Gerund",us:"Gerund",them:"Gerund"}),afterWords:Object.assign({},rS.afterWords,ZO.afterWords,{the:"Gerund",this:"Gerund",that:"Gerund",me:"Gerund",us:"Gerund",them:"Gerund"})},fS="Singular",mS="Infinitive",gS={beforeTags:Object.assign({},XO.beforeTags,ZO.beforeTags,{Adjective:fS,Particle:fS}),afterTags:Object.assign({},XO.afterTags,ZO.afterTags,{ProperNoun:mS,Gerund:mS,Adjective:mS,Copula:fS}),beforeWords:Object.assign({},XO.beforeWords,ZO.beforeWords,{is:fS,was:fS,of:fS,have:null}),afterWords:Object.assign({},XO.afterWords,ZO.afterWords,{instead:mS,about:mS,his:mS,her:mS,to:null,by:null,in:null})},yS="Person",vS={beforeTags:{Honorific:yS,Person:yS},afterTags:{Person:yS,ProperNoun:yS,Verb:yS},ownTags:{ProperNoun:yS},beforeWords:{hi:yS,hey:yS,yo:yS,dear:yS,hello:yS},afterWords:{said:yS,says:yS,told:yS,tells:yS,feels:yS,felt:yS,seems:yS,thinks:yS,thought:yS,spends:yS,spendt:yS,plays:yS,played:yS,sing:yS,sang:yS,learn:yS,learned:yS,wants:yS,wanted:yS}},bS="Month",wS={beforeTags:{Date:bS,Value:bS},afterTags:{Date:bS,Value:bS},beforeWords:{by:bS,in:bS,on:bS,during:bS,after:bS,before:bS,between:bS,until:bS,til:bS,sometime:bS,of:bS,this:bS,next:bS,last:bS,previous:bS,following:bS,with:"Person"},afterWords:{sometime:bS,in:bS,of:bS,until:bS,the:bS}},_S={beforeTags:Object.assign({},vS.beforeTags,wS.beforeTags),afterTags:Object.assign({},vS.afterTags,wS.afterTags),beforeWords:Object.assign({},vS.beforeWords,wS.beforeWords),afterWords:Object.assign({},vS.afterWords,wS.afterWords)},kS="Place",AS={beforeTags:{Place:kS},afterTags:{Place:kS,Abbreviation:kS},beforeWords:{in:kS,by:kS,near:kS,from:kS,to:kS},afterWords:{in:kS,by:kS,near:kS,from:kS,to:kS,government:kS,council:kS,region:kS,city:kS}};let PS="Unit";const TS={"Actor|Verb":YO,"Adj|Gerund":aS,"Adj|Noun":oS,"Adj|Past":hS,"Adj|Present":dS,"Noun|Verb":gS,"Noun|Gerund":pS,"Person|Noun":{beforeTags:Object.assign({},ZO.beforeTags,vS.beforeTags),afterTags:Object.assign({},ZO.afterTags,vS.afterTags),beforeWords:Object.assign({},ZO.beforeWords,vS.beforeWords,{i:"Infinitive",we:"Infinitive"}),afterWords:Object.assign({},ZO.afterWords,vS.afterWords)},"Person|Date":_S,"Person|Verb":{beforeTags:Object.assign({},ZO.beforeTags,vS.beforeTags,XO.beforeTags),afterTags:Object.assign({},ZO.afterTags,vS.afterTags,XO.afterTags),beforeWords:Object.assign({},ZO.beforeWords,vS.beforeWords,XO.beforeWords),afterWords:Object.assign({},ZO.afterWords,vS.afterWords,XO.afterWords)},"Person|Place":{beforeTags:Object.assign({},AS.beforeTags,vS.beforeTags),afterTags:Object.assign({},AS.afterTags,vS.afterTags),beforeWords:Object.assign({},AS.beforeWords,vS.beforeWords),afterWords:Object.assign({},AS.afterWords,vS.afterWords)},"Person|Adj":{beforeTags:Object.assign({},vS.beforeTags,tS.beforeTags),afterTags:Object.assign({},vS.afterTags,tS.afterTags),beforeWords:Object.assign({},vS.beforeWords,tS.beforeWords),afterWords:Object.assign({},vS.afterWords,tS.afterWords)},"Unit|Noun":{beforeTags:{Value:PS},afterTags:{},beforeWords:{per:PS,every:PS,each:PS,square:PS,cubic:PS,sq:PS,metric:PS},afterWords:{per:PS,squared:PS,cubed:PS,long:PS}}},ES=(e,t)=>{let n=Object.keys(e).reduce(((t,n)=>(t[n]="Infinitive"===e[n]?"PresentTense":"Plural",t)),{});return Object.assign(n,t)};TS["Plural|Verb"]={beforeWords:ES(TS["Noun|Verb"].beforeWords,{had:"Plural",have:"Plural"}),afterWords:ES(TS["Noun|Verb"].afterWords,{his:"PresentTense",her:"PresentTense",its:"PresentTense",in:null,to:null,is:"PresentTense",by:"PresentTense"}),beforeTags:ES(TS["Noun|Verb"].beforeTags,{Conjunction:"PresentTense",Noun:void 0,ProperNoun:"PresentTense"}),afterTags:ES(TS["Noun|Verb"].afterTags,{Gerund:"Plural",Noun:"PresentTense",Value:"PresentTense"})};const xS=TS,IS="Adjective",CS="Infinitive",OS="PresentTense",SS="Singular",NS="PastTense",jS="Adverb",DS="Plural",RS="Actor",$S="Verb",LS="Noun",MS="LastName",FS="Modal",US="Place",BS="Participle",VS=[null,null,{ea:SS,ia:LS,ic:IS,ly:jS,"'n":$S,"'t":$S},{oed:NS,ued:NS,xed:NS," so":jS,"'ll":FS,"'re":"Copula",azy:IS,eer:LS,end:$S,ped:NS,ffy:IS,ify:CS,ing:"Gerund",ize:CS,ibe:CS,lar:IS,mum:IS,nes:OS,nny:IS,ous:IS,que:IS,ger:LS,ber:LS,rol:SS,sis:SS,ogy:SS,oid:SS,ian:SS,zes:OS,eld:NS,ken:BS,ven:BS,ten:BS,ect:CS,ict:CS,ign:CS,oze:CS,ful:IS,bal:IS,ton:LS,pur:US},{amed:NS,aped:NS,ched:NS,lked:NS,rked:NS,reed:NS,nded:NS,mned:IS,cted:NS,dged:NS,ield:SS,akis:MS,cede:CS,chuk:MS,czyk:MS,ects:OS,iend:SS,ends:$S,enko:MS,ette:SS,iary:SS,wner:SS,fies:OS,fore:jS,gate:CS,gone:IS,ices:DS,ints:DS,ruct:CS,ines:DS,ions:DS,ners:DS,pers:DS,lers:DS,less:IS,llen:IS,made:IS,nsen:MS,oses:OS,ould:FS,some:IS,sson:MS,ians:DS,tion:SS,tage:LS,ique:SS,tive:IS,tors:LS,vice:SS,lier:SS,fier:SS,wned:NS,gent:SS,tist:RS,pist:RS,rist:RS,mist:RS,yist:RS,vist:RS,ists:RS,lite:SS,site:SS,rite:SS,mite:SS,bite:SS,mate:SS,date:SS,ndal:SS,vent:SS,uist:RS,gist:RS,note:SS,cide:SS,ence:SS,wide:IS,vide:CS,ract:CS,duce:CS,pose:CS,eive:CS,lyze:CS,lyse:CS,iant:IS,nary:IS,ghty:IS,uent:IS,erer:RS,bury:US,dorf:LS,esty:LS,wych:US,dale:US,folk:US,vale:US,abad:US,sham:US,wick:US,view:US},{elist:RS,holic:SS,phite:SS,tized:NS,urned:NS,eased:NS,ances:DS,bound:IS,ettes:DS,fully:jS,ishes:OS,ities:DS,marek:MS,nssen:MS,ology:LS,osome:SS,tment:SS,ports:DS,rough:IS,tches:OS,tieth:"Ordinal",tures:DS,wards:jS,where:jS,archy:LS,pathy:LS,opoly:LS,embly:LS,phate:LS,ndent:SS,scent:SS,onist:RS,anist:RS,alist:RS,olist:RS,icist:RS,ounce:CS,iable:IS,borne:IS,gnant:IS,inant:IS,igent:IS,atory:IS,rient:SS,dient:SS,maker:RS,burgh:US,mouth:US,ceter:US,ville:US,hurst:US,stead:US,endon:US,brook:US,shire:US,worth:LS,field:"ProperNoun",ridge:US},{auskas:MS,parent:SS,cedent:SS,ionary:SS,cklist:SS,brooke:US,keeper:RS,logist:RS,teenth:"Value",worker:RS,master:RS,writer:RS,brough:US,cester:US,ington:US,cliffe:US,ingham:US},{chester:US,logists:RS,opoulos:MS,borough:US,sdottir:MS}],zS="Adjective",HS="Noun",GS="Verb",qS=[null,null,{},{neo:HS,bio:HS,"de-":GS,"re-":GS,"un-":GS,"ex-":HS},{anti:HS,auto:HS,faux:zS,hexa:HS,kilo:HS,mono:HS,nano:HS,octa:HS,poly:HS,semi:zS,tele:HS,"pro-":zS,"mis-":GS,"dis-":GS,"pre-":zS},{anglo:HS,centi:HS,ethno:HS,ferro:HS,grand:HS,hepta:HS,hydro:HS,intro:HS,macro:HS,micro:HS,milli:HS,nitro:HS,penta:HS,quasi:zS,radio:HS,tetra:HS,"omni-":zS,"post-":zS},{pseudo:zS,"extra-":zS,"hyper-":zS,"inter-":zS,"intra-":zS,"deca-":zS},{electro:HS}],KS="Adjective",WS="Infinitive",JS="PresentTense",ZS="Singular",QS="PastTense",XS="Adverb",YS="Expression",eN="Actor",tN="Verb",nN="Noun",rN="LastName",iN={a:[[/.[aeiou]na$/,nN,"tuna"],[/.[oau][wvl]ska$/,rN],[/.[^aeiou]ica$/,ZS,"harmonica"],[/^([hyj]a+)+$/,YS,"haha"]],c:[[/.[^aeiou]ic$/,KS]],d:[[/[aeiou](pp|ll|ss|ff|gg|tt|rr|bb|nn|mm)ed$/,QS,"popped"],[/.[aeo]{2}[bdgmnprvz]ed$/,QS,"rammed"],[/.[aeiou][sg]hed$/,QS,"gushed"],[/.[aeiou]red$/,QS,"hired"],[/.[aeiou]r?ried$/,QS,"hurried"],[/[^aeiou]ard$/,ZS,"steward"],[/[aeiou][^aeiou]id$/,KS,""],[/.[vrl]id$/,KS,"livid"],[/..led$/,QS,"hurled"],[/.[iao]sed$/,QS,""],[/[aeiou]n?[cs]ed$/,QS,""],[/[aeiou][rl]?[mnf]ed$/,QS,""],[/[aeiou][ns]?c?ked$/,QS,"bunked"],[/[aeiou]gned$/,QS],[/[aeiou][nl]?ged$/,QS],[/.[tdbwxyz]ed$/,QS],[/[^aeiou][aeiou][tvx]ed$/,QS],[/.[cdflmnprstv]ied$/,QS,"emptied"]],e:[[/.[lnr]ize$/,WS,"antagonize"],[/.[^aeiou]ise$/,WS,"antagonise"],[/.[aeiou]te$/,WS,"bite"],[/.[^aeiou][ai]ble$/,KS,"fixable"],[/.[^aeiou]eable$/,KS,"maleable"],[/.[ts]ive$/,KS,"festive"],[/[a-z]-like$/,KS,"woman-like"]],h:[[/.[^aeiouf]ish$/,KS,"cornish"],[/.v[iy]ch$/,rN,"..ovich"],[/^ug?h+$/,YS,"ughh"],[/^uh[ -]?oh$/,YS,"uhoh"],[/[a-z]-ish$/,KS,"cartoon-ish"]],i:[[/.[oau][wvl]ski$/,rN,"polish-male"]],k:[[/^(k){2}$/,YS,"kkkk"]],l:[[/.[gl]ial$/,KS,"familial"],[/.[^aeiou]ful$/,KS,"fitful"],[/.[nrtumcd]al$/,KS,"natal"],[/.[^aeiou][ei]al$/,KS,"familial"]],m:[[/.[^aeiou]ium$/,ZS,"magnesium"],[/[^aeiou]ism$/,ZS,"schism"],[/^[hu]m+$/,YS,"hmm"],[/^\d+ ?[ap]m$/,"Date","3am"]],n:[[/.[lsrnpb]ian$/,KS,"republican"],[/[^aeiou]ician$/,eN,"musician"],[/[aeiou][ktrp]in'$/,"Gerund","cookin'"]],o:[[/^no+$/,YS,"noooo"],[/^(yo)+$/,YS,"yoo"],[/^wo{2,}[pt]?$/,YS,"woop"]],r:[[/.[bdfklmst]ler$/,"Noun"],[/[aeiou][pns]er$/,ZS],[/[^i]fer$/,WS],[/.[^aeiou][ao]pher$/,eN],[/.[lk]er$/,"Noun"],[/.ier$/,"Comparative"]],t:[[/.[di]est$/,"Superlative"],[/.[icldtgrv]ent$/,KS],[/[aeiou].*ist$/,KS],[/^[a-z]et$/,tN]],s:[[/.[^aeiou]ises$/,JS],[/.[rln]ates$/,JS],[/.[^z]ens$/,tN],[/.[lstrn]us$/,ZS],[/.[aeiou]sks$/,JS],[/.[aeiou]kes$/,JS],[/[aeiou][^aeiou]is$/,ZS],[/[a-z]'s$/,nN],[/^yes+$/,YS]],v:[[/.[^aeiou][ai][kln]ov$/,rN]],y:[[/.[cts]hy$/,KS],[/.[st]ty$/,KS],[/.[tnl]ary$/,KS],[/.[oe]ry$/,ZS],[/[rdntkbhs]ly$/,XS],[/.(gg|bb|zz)ly$/,KS],[/...lly$/,XS],[/.[gk]y$/,KS],[/[bszmp]{2}y$/,KS],[/.[ai]my$/,KS],[/[ea]{2}zy$/,KS],[/.[^aeiou]ity$/,ZS]]},sN="Verb",aN="Noun",oN={leftTags:[["Adjective",aN],["Possessive",aN],["Determiner",aN],["Adverb",sN],["Pronoun",sN],["Value",aN],["Ordinal",aN],["Modal",sN],["Superlative",aN],["Demonym",aN],["Honorific","Person"]],leftWords:[["i",sN],["first",aN],["it",sN],["there",sN],["not",sN],["because",aN],["if",aN],["but",aN],["who",sN],["this",aN],["his",aN],["when",aN],["you",sN],["very","Adjective"],["old",aN],["never",sN],["before",aN],["a",aN],["the",aN],["been",sN]],rightTags:[["Copula",aN],["PastTense",aN],["Conjunction",aN],["Modal",aN]],rightWords:[["there",sN],["me",sN],["man","Adjective"],["him",sN],["it",sN],["were",aN],["took",aN],["himself",sN],["went",aN],["who",aN],["jr","Person"]]},lN=/^([0-9]+)/,cN=function(e){let t=function(e){let t={};return e.split("¦").forEach((e=>{let[n,r]=e.split(":");r=(r||"").split(","),r.forEach((e=>{t[e]=n}))})),t}(e);return Object.keys(t).reduce(((e,n)=>(e[n]=function(e="",t=""){let n=(t=String(t)).match(lN);if(null===n)return t;let r=Number(n[1])||0;return e.substring(0,r)+t.replace(lN,"")}(n,t[n]),e)),{})},uN=function(e={}){return"string"==typeof e&&(e=JSON.parse(e)),e.fwd=cN(e.fwd||""),e.both=cN(e.both||""),e.rev=cN(e.rev||""),e.ex=cN(e.ex||""),e},hN=function(e){return Object.entries(e).reduce(((e,t)=>(e[t[1]]=t[0],e)),{})},dN=function(e={}){return{reversed:!0,both:hN(e.both),ex:hN(e.ex),fwd:e.rev||{}}},pN=uN({fwd:"1:tted,wed,gged,nned,een,rred,pped,yed,bbed,oed,dded,rd,wn,mmed¦2:eed,nded,et,hted,st,oled,ut,emed,eled,lded,ken,rt,nked,apt,ant,eped,eked¦3:eared,eat,eaded,nelled,ealt,eeded,ooted,eaked,eaned,eeted,mited,bid,uit,ead,uited,ealed,geted,velled,ialed,belled¦4:ebuted,hined,comed¦y:ied¦ome:ame¦ear:ore¦ind:ound¦ing:ung,ang¦ep:pt¦ink:ank,unk¦ig:ug¦all:ell¦ee:aw¦ive:ave¦eeze:oze¦old:eld¦ave:ft¦ake:ook¦ell:old¦ite:ote¦ide:ode¦ine:one¦in:un,on¦eal:ole¦im:am¦ie:ay¦and:ood¦1ise:rose¦1eak:roke¦1ing:rought¦1ive:rove¦1el:elt¦1id:bade¦1et:got¦1y:aid¦1it:sat¦3e:lid¦3d:pent",both:"1:aed,fed,xed,hed¦2:sged,xted,wled,rped,lked,kied,lmed,lped,uped,bted,rbed,rked,wned,rled,mped,fted,mned,mbed,zzed,omed,ened,cked,gned,lted,sked,ued,zed,nted,ered,rted,rmed,ced,sted,rned,ssed,rded,pted,ved,cted¦3:cled,eined,siped,ooned,uked,ymed,jored,ouded,ioted,oaned,lged,asped,iged,mured,oided,eiled,yped,taled,moned,yled,lit,kled,oaked,gled,naled,fled,uined,oared,valled,koned,soned,aided,obed,ibed,meted,nicked,rored,micked,keted,vred,ooped,oaded,rited,aired,auled,filled,ouled,ooded,ceted,tolled,oited,bited,aped,tled,vored,dled,eamed,nsed,rsed,sited,owded,pled,sored,rged,osed,pelled,oured,psed,oated,loned,aimed,illed,eured,tred,ioned,celled,bled,wsed,ooked,oiled,itzed,iked,iased,onged,ased,ailed,uned,umed,ained,auded,nulled,ysed,eged,ised,aged,oined,ated,used,dged,doned¦4:ntied,efited,uaked,caded,fired,roped,halled,roked,himed,culed,tared,lared,tuted,uared,routed,pited,naked,miled,houted,helled,hared,cored,caled,tired,peated,futed,ciled,called,tined,moted,filed,sided,poned,iloted,honed,lleted,huted,ruled,cured,named,preted,vaded,sured,talled,haled,peded,gined,nited,uided,ramed,feited,laked,gured,ctored,unged,pired,cuted,voked,eloped,ralled,rined,coded,icited,vided,uaded,voted,mined,sired,noted,lined,nselled,luted,jured,fided,puted,piled,pared,olored,cided,hoked,enged,tured,geoned,cotted,lamed,uiled,waited,udited,anged,luded,mired,uired,raded¦5:modelled,izzled,eleted,umpeted,ailored,rseded,treated,eduled,ecited,rammed,eceded,atrolled,nitored,basted,twined,itialled,ncited,gnored,ploded,xcited,nrolled,namelled,plored,efeated,redited,ntrolled,nfined,pleted,llided,lcined,eathed,ibuted,lloted,dhered,cceded¦3ad:sled¦2aw:drew¦2ot:hot¦2ke:made¦2ow:hrew,grew¦2ose:hose¦2d:ilt¦2in:egan¦1un:ran¦1ink:hought¦1ick:tuck¦1ike:ruck¦1eak:poke,nuck¦1it:pat¦1o:did¦1ow:new¦1ake:woke¦go:went",rev:"3:rst,hed,hut,cut,set¦4:tbid¦5:dcast,eread,pread,erbid¦ought:uy,eek¦1ied:ny,ly,dy,ry,fy,py,vy,by,ty,cy¦1ung:ling,ting,wing¦1pt:eep¦1ank:rink¦1ore:bear,wear¦1ave:give¦1oze:reeze¦1ound:rind,wind¦1ook:take,hake¦1aw:see¦1old:sell¦1ote:rite¦1ole:teal¦1unk:tink¦1am:wim¦1ay:lie¦1ood:tand¦1eld:hold¦2d:he,ge,re,le,leed,ne,reed,be,ye,lee,pe,we¦2ed:dd,oy,or,ey,gg,rr,us,ew,to¦2ame:ecome,rcome¦2ped:ap¦2ged:ag,og,ug,eg¦2bed:ub,ab,ib,ob¦2lt:neel¦2id:pay¦2ang:pring¦2ove:trive¦2med:um¦2ode:rride¦2at:ysit¦3ted:mit,hat,mat,lat,pot,rot,bat¦3ed:low,end,tow,und,ond,eem,lay,cho,dow,xit,eld,ald,uld,law,lel,eat,oll,ray,ank,fin,oam,out,how,iek,tay,haw,ait,vet,say,cay,bow¦3d:ste,ede,ode,ete,ree,ude,ame,oke,ote,ime,ute,ade¦3red:lur,cur,pur,car¦3ped:hop,rop,uip,rip,lip,tep,top¦3ded:bed,rod,kid¦3ade:orbid¦3led:uel¦3ned:lan,can,kin,pan,tun¦3med:rim,lim¦4ted:quit,llot¦4ed:pear,rrow,rand,lean,mand,anel,pand,reet,link,abel,evel,imit,ceed,ruit,mind,peal,veal,hool,head,pell,well,mell,uell,band,hear,weak¦4led:nnel,qual,ebel,ivel¦4red:nfer,efer,sfer¦4n:sake,trew¦4d:ntee¦4ded:hred¦4ned:rpin¦5ed:light,nceal,right,ndear,arget,hread,eight,rtial,eboot¦5d:edite,nvite¦5ted:egret¦5led:ravel",ex:"2:been,upped¦3:added,aged,aided,aimed,aired,bid,died,dyed,egged,erred,eyed,fit,gassed,hit,lied,owed,pent,pied,tied,used,vied,oiled,outed,banned,barred,bet,canned,cut,dipped,donned,ended,feed,inked,jarred,let,manned,mowed,netted,padded,panned,pitted,popped,potted,put,set,sewn,sowed,tanned,tipped,topped,vowed,weed,bowed,jammed,binned,dimmed,hopped,mopped,nodded,pinned,rigged,sinned,towed,vetted¦4:ached,baked,baled,boned,bored,called,caned,cared,ceded,cited,coded,cored,cubed,cured,dared,dined,edited,exited,faked,fared,filed,fined,fired,fuelled,gamed,gelled,hired,hoped,joked,lined,mined,named,noted,piled,poked,polled,pored,pulled,reaped,roamed,rolled,ruled,seated,shed,sided,timed,tolled,toned,voted,waited,walled,waned,winged,wiped,wired,zoned,yelled,tamed,lubed,roped,faded,mired,caked,honed,banged,culled,heated,raked,welled,banded,beat,cast,cooled,cost,dealt,feared,folded,footed,handed,headed,heard,hurt,knitted,landed,leaked,leapt,linked,meant,minded,molded,neared,needed,peaked,plodded,plotted,pooled,quit,read,rooted,sealed,seeded,seeped,shipped,shunned,skimmed,slammed,sparred,stemmed,stirred,suited,thinned,twinned,swayed,winked,dialed,abutted,blotted,fretted,healed,heeded,peeled,reeled¦5:basted,cheated,equalled,eroded,exiled,focused,opined,pleated,primed,quoted,scouted,shored,sloped,smoked,sniped,spelled,spouted,routed,staked,stored,swelled,tasted,treated,wasted,smelled,dwelled,honored,prided,quelled,eloped,scared,coveted,sweated,breaded,cleared,debuted,deterred,freaked,modeled,pleaded,rebutted,speeded¦6:anchored,defined,endured,impaled,invited,refined,revered,strolled,cringed,recast,thrust,unfolded¦7:authored,combined,competed,conceded,convened,excreted,extruded,redefined,restored,secreted,rescinded,welcomed¦8:expedited,infringed¦9:interfered,intervened,persevered¦10:contravened¦eat:ate¦is:was¦go:went¦are:were¦3d:bent,lent,rent,sent¦3e:bit,fled,hid,lost¦3ed:bled,bred¦2ow:blew,grew¦1uy:bought¦2tch:caught¦1o:did¦1ive:dove,gave¦2aw:drew¦2ed:fed¦2y:flew,laid,paid,said¦1ight:fought¦1et:got¦2ve:had¦1ang:hung¦2ad:led¦2ght:lit¦2ke:made¦2et:met¦1un:ran¦1ise:rose¦1it:sat¦1eek:sought¦1each:taught¦1ake:woke,took¦1eave:wove¦2ise:arose¦1ear:bore,tore,wore¦1ind:bound,found,wound¦2eak:broke¦2ing:brought,wrung¦1ome:came¦2ive:drove¦1ig:dug¦1all:fell¦2el:felt¦4et:forgot¦1old:held¦2ave:left¦1ing:rang,sang¦1ide:rode¦1ink:sank¦1ee:saw¦2ine:shone¦4e:slid¦1ell:sold,told¦4d:spent¦2in:spun¦1in:won"}),fN=uN({fwd:"1:oes¦1ve:as",both:"1:xes¦2:zzes,ches,shes,sses¦3:iases¦2y:llies,plies¦1y:cies,bies,ties,vies,nies,pies,dies,ries,fies¦:s",rev:"1ies:ly¦2es:us,go,do¦3es:cho,eto",ex:"2:does,goes¦3:gasses¦5:focuses¦is:are¦3y:relies¦2y:flies¦2ve:has"}),mN=uN({fwd:"1:nning,tting,rring,pping,eing,mming,gging,dding,bbing,kking¦2:eking,oling,eling,eming¦3:velling,siting,uiting,fiting,loting,geting,ialing,celling¦4:graming",both:"1:aing,iing,fing,xing,ying,oing,hing,wing¦2:tzing,rping,izzing,bting,mning,sping,wling,rling,wding,rbing,uping,lming,wning,mping,oning,lting,mbing,lking,fting,hting,sking,gning,pting,cking,ening,nking,iling,eping,ering,rting,rming,cting,lping,ssing,nting,nding,lding,sting,rning,rding,rking¦3:belling,siping,toming,yaking,uaking,oaning,auling,ooping,aiding,naping,euring,tolling,uzzing,ganing,haning,ualing,halling,iasing,auding,ieting,ceting,ouling,voring,ralling,garing,joring,oaming,oaking,roring,nelling,ooring,uelling,eaming,ooding,eaping,eeting,ooting,ooming,xiting,keting,ooking,ulling,airing,oaring,biting,outing,oiting,earing,naling,oading,eeding,ouring,eaking,aiming,illing,oining,eaning,onging,ealing,aining,eading¦4:thoming,melling,aboring,ivoting,weating,dfilling,onoring,eriting,imiting,tialling,rgining,otoring,linging,winging,lleting,louding,spelling,mpelling,heating,feating,opelling,choring,welling,ymaking,ctoring,calling,peating,iloring,laiting,utoring,uditing,mmaking,loating,iciting,waiting,mbating,voiding,otalling,nsoring,nselling,ocusing,itoring,eloping¦5:rselling,umpeting,atrolling,treating,tselling,rpreting,pringing,ummeting,ossoming,elmaking,eselling,rediting,totyping,onmaking,rfeiting,ntrolling¦5e:chmaking,dkeeping,severing,erouting,ecreting,ephoning,uthoring,ravening,reathing,pediting,erfering,eotyping,fringing,entoring,ombining,ompeting¦4e:emaking,eething,twining,rruling,chuting,xciting,rseding,scoping,edoring,pinging,lunging,agining,craping,pleting,eleting,nciting,nfining,ncoding,tponing,ecoding,writing,esaling,nvening,gnoring,evoting,mpeding,rvening,dhering,mpiling,storing,nviting,ploring¦3e:tining,nuring,saking,miring,haling,ceding,xuding,rining,nuting,laring,caring,miling,riding,hoking,piring,lading,curing,uading,noting,taping,futing,paring,hading,loding,siring,guring,vading,voking,during,niting,laning,caping,luting,muting,ruding,ciding,juring,laming,caling,hining,uoting,liding,ciling,duling,tuting,puting,cuting,coring,uiding,tiring,turing,siding,rading,enging,haping,buting,lining,taking,anging,haring,uiring,coming,mining,moting,suring,viding,luding¦2e:tring,zling,uging,oging,gling,iging,vring,fling,lging,obing,psing,pling,ubing,cling,dling,wsing,iking,rsing,dging,kling,ysing,tling,rging,eging,nsing,uning,osing,uming,using,ibing,bling,aging,ising,asing,ating¦2ie:rlying¦1e:zing,uing,cing,ving",rev:"ying:ie¦1ing:se,ke,te,we,ne,re,de,pe,me,le,c,he¦2ing:ll,ng,dd,ee,ye,oe,rg,us¦2ning:un¦2ging:og,ag,ug,ig,eg¦2ming:um¦2bing:ub,ab,eb,ob¦3ning:lan,can,hin,pin,win¦3ring:cur,lur,tir,tar,pur,car¦3ing:ait,del,eel,fin,eat,oat,eem,lel,ool,ein,uin¦3ping:rop,rap,top,uip,wap,hip,hop,lap,rip,cap¦3ming:tem,wim,rim,kim,lim¦3ting:mat,cut,pot,lit,lot,hat,set,pit,put¦3ding:hed,bed,bid¦3king:rek¦3ling:cil,pel¦3bing:rib¦4ning:egin¦4ing:isit,ruit,ilot,nsit,dget,rkel,ival,rcel¦4ring:efer,nfer¦4ting:rmit,mmit,ysit,dmit,emit,bmit,tfit,gret¦4ling:evel,xcel,ivel¦4ding:hred¦5ing:arget,posit,rofit¦5ring:nsfer¦5ting:nsmit,orget,cquit¦5ling:ancel,istil",ex:"3:adding,eating,aiming,aiding,airing,outing,gassing,setting,getting,putting,cutting,winning,sitting,betting,mapping,tapping,letting,bidding,hitting,tanning,netting,popping,fitting,capping,lapping,barring,banning,vetting,topping,rotting,tipping,potting,wetting,pitting,dipping,budding,hemming,pinning,jetting,kidding,padding,podding,sipping,wedding,bedding,donning,warring,penning,gutting,cueing,wadding,petting,ripping,napping,matting,tinning,binning,dimming,hopping,mopping,nodding,panning,rapping,ridding,sinning¦4:selling,falling,calling,waiting,editing,telling,rolling,heating,boating,hanging,beating,coating,singing,tolling,felling,polling,discing,seating,voiding,gelling,yelling,baiting,reining,ruining,seeking,spanning,stepping,knitting,emitting,slipping,quitting,dialing,omitting,clipping,shutting,skinning,abutting,flipping,trotting,cramming,fretting,suiting¦5:bringing,treating,spelling,stalling,trolling,expelling,rivaling,wringing,deterring,singeing,befitting,refitting¦6:enrolling,distilling,scrolling,strolling,caucusing,travelling¦7:installing,redefining,stencilling,recharging,overeating,benefiting,unraveling,programing¦9:reprogramming¦is:being¦2e:using,aging,owing¦3e:making,taking,coming,noting,hiring,filing,coding,citing,doping,baking,coping,hoping,lading,caring,naming,voting,riding,mining,curing,lining,ruling,typing,boring,dining,firing,hiding,piling,taping,waning,baling,boning,faring,honing,wiping,luring,timing,wading,piping,fading,biting,zoning,daring,waking,gaming,raking,ceding,tiring,coking,wining,joking,paring,gaping,poking,pining,coring,liming,toting,roping,wiring,aching¦4e:writing,storing,eroding,framing,smoking,tasting,wasting,phoning,shaking,abiding,braking,flaking,pasting,priming,shoring,sloping,withing,hinging¦5e:defining,refining,renaming,swathing,fringing,reciting¦1ie:dying,tying,lying,vying¦7e:sunbathing"}),gN=uN({fwd:"1:mt¦2:llen¦3:iven,aken¦:ne¦y:in",both:"1:wn¦2:me,aten¦3:seen,bidden,isen¦4:roven,asten¦3l:pilt¦3d:uilt¦2e:itten¦1im:wum¦1eak:poken¦1ine:hone¦1ose:osen¦1in:gun¦1ake:woken¦ear:orn¦eal:olen¦eeze:ozen¦et:otten¦ink:unk¦ing:ung",rev:"2:un¦oken:eak¦ought:eek¦oven:eave¦1ne:o¦1own:ly¦1den:de¦1in:ay¦2t:am¦2n:ee¦3en:all¦4n:rive,sake,take¦5n:rgive",ex:"2:been¦3:seen,run¦4:given,taken¦5:shaken¦2eak:broken¦1ive:dove¦2y:flown¦3e:hidden,ridden¦1eek:sought¦1ake:woken¦1eave:woven"}),yN=dN(pN),vN=dN(fN),bN=dN(mN),wN=dN(gN),_N=uN({fwd:"3:ser,ier¦1er:h,t,f,l,n¦1r:e¦2er:ss,or,om",both:"3er:ver,ear,alm¦3ner:hin¦3ter:lat¦2mer:im¦2er:ng,rm,mb¦2ber:ib¦2ger:ig¦1er:w,p,k,d¦ier:y",rev:"1:tter,yer¦2:uer,ver,ffer,oner,eler,ller,iler,ster,cer,uler,sher,ener,gher,aner,adder,nter,eter,rter,hter,rner,fter¦3:oser,ooler,eafer,user,airer,bler,maler,tler,eater,uger,rger,ainer,urer,ealer,icher,pler,emner,icter,nser,iser¦4:arser,viner,ucher,rosser,somer,ndomer,moter,oother,uarer,hiter¦5:nuiner,esser,emier¦ar:urther",ex:"worse:bad¦better:good¦4er:fair,gray,poor¦1urther:far¦3ter:fat,hot,wet¦3der:mad,sad¦3er:shy,fun¦4der:glad¦:¦4r:cute,dire,fake,fine,free,lame,late,pale,rare,ripe,rude,safe,sore,tame,wide¦5r:eerie,stale"}),kN=uN({fwd:"1st:e¦1est:l,m,f,s¦1iest:cey¦2est:or,ir¦3est:ver",both:"4:east¦5:hwest¦5lest:erful¦4est:weet,lgar,tter,oung¦4most:uter¦3est:ger,der,rey,iet,ong,ear¦3test:lat¦3most:ner¦2est:pt,ft,nt,ct,rt,ht¦2test:it¦2gest:ig¦1est:b,k,n,p,h,d,w¦iest:y",rev:"1:ttest,nnest,yest¦2:sest,stest,rmest,cest,vest,lmest,olest,ilest,ulest,ssest,imest,uest¦3:rgest,eatest,oorest,plest,allest,urest,iefest,uelest,blest,ugest,amest,yalest,ealest,illest,tlest,itest¦4:cerest,eriest,somest,rmalest,ndomest,motest,uarest,tiffest¦5:leverest,rangest¦ar:urthest¦3ey:riciest",ex:"best:good¦worst:bad¦5est:great¦4est:fast,full,fair,dull¦3test:hot,wet,fat¦4nest:thin¦1urthest:far¦3est:gay,shy,ill¦4test:neat¦4st:late,wide,fine,safe,cute,fake,pale,rare,rude,sore,ripe,dire¦6st:severe"}),AN={fromPast:pN,fromPresent:fN,fromGerund:mN,fromParticiple:gN,toPast:yN,toPresent:vN,toGerund:bN,toParticiple:wN,toComparative:_N,toSuperlative:kN,fromComparative:dN(_N),fromSuperlative:dN(kN),adjToNoun:uN({fwd:"1:tistic,eable,lful,sful,ting,tty¦2:onate,rtable,geous,ced,seful,ctful¦3:ortive,ented¦arity:ear¦y:etic¦fulness:begone¦1ity:re¦1y:tiful,gic¦2ity:ile,imous,ilous,ime¦2ion:ated¦2eness:iving¦2y:trious¦2ation:iring¦2tion:vant¦3ion:ect¦3ce:mant,mantic¦3tion:irable¦3y:est,estic¦3m:mistic,listic¦3ess:ning¦4n:utious¦4on:rative,native,vative,ective¦4ce:erant",both:"1:king,wing¦2:alous,ltuous,oyful,rdous¦3:gorous,ectable,werful,amatic¦4:oised,usical,agical,raceful,ocused,lined,ightful¦5ness:stful,lding,itous,nuous,ulous,otous,nable,gious,ayful,rvous,ntous,lsive,peful,entle,ciful,osive,leful,isive,ncise,reful,mious¦5ty:ivacious¦5ties:ubtle¦5ce:ilient,adiant,atient¦5cy:icient¦5sm:gmatic¦5on:sessive,dictive¦5ity:pular,sonal,eative,entic¦5sity:uminous¦5ism:conic¦5nce:mperate¦5ility:mitable¦5ment:xcited¦5n:bitious¦4cy:brant,etent,curate¦4ility:erable,acable,icable,ptable¦4ty:nacious,aive,oyal,dacious¦4n:icious¦4ce:vient,erent,stent,ndent,dient,quent,ident¦4ness:adic,ound,hing,pant,sant,oing,oist,tute¦4icity:imple¦4ment:fined,mused¦4ism:otic¦4ry:dantic¦4ity:tund,eral¦4edness:hand¦4on:uitive¦4lity:pitable¦4sm:eroic,namic¦4sity:nerous¦3th:arm¦3ility:pable,bable,dable,iable¦3cy:hant,nant,icate¦3ness:red,hin,nse,ict,iet,ite,oud,ind,ied,rce¦3ion:lute¦3ity:ual,gal,volous,ial¦3ce:sent,fensive,lant,gant,gent,lent,dant¦3on:asive¦3m:fist,sistic,iastic¦3y:terious,xurious,ronic,tastic¦3ur:amorous¦3e:tunate¦3ation:mined¦3sy:rteous¦3ty:ain¦3ry:ave¦3ment:azed¦2ness:de,on,ue,rn,ur,ft,rp,pe,om,ge,rd,od,ay,ss,er,ll,oy,ap,ht,ld,ad,rt¦2inousness:umous¦2ity:neous,ene,id,ane¦2cy:bate,late¦2ation:ized¦2ility:oble,ible¦2y:odic¦2e:oving,aring¦2s:ost¦2itude:pt¦2dom:ee¦2ance:uring¦2tion:reet¦2ion:oted¦2sion:ending¦2liness:an¦2or:rdent¦1th:ung¦1e:uable¦1ness:w,h,k,f¦1ility:mble¦1or:vent¦1ement:ging¦1tiquity:ncient¦1ment:hed¦verty:or¦ength:ong¦eat:ot¦pth:ep¦iness:y",rev:"",ex:"5:forceful,humorous¦8:charismatic¦13:understanding¦5ity:active¦11ness:adventurous,inquisitive,resourceful¦8on:aggressive,automatic,perceptive¦7ness:amorous,fatuous,furtive,ominous,serious¦5ness:ample,sweet¦12ness:apprehensive,cantankerous,contemptuous,ostentatious¦13ness:argumentative,conscientious¦9ness:assertive,facetious,imperious,inventive,oblivious,rapacious,receptive,seditious,whimsical¦10ness:attractive,expressive,impressive,loquacious,salubrious,thoughtful¦3edom:boring¦4ness:calm,fast,keen,tame¦8ness:cheerful,gracious,specious,spurious,timorous,unctuous¦5sity:curious¦9ion:deliberate¦8ion:desperate¦6e:expensive¦7ce:fragrant¦3y:furious¦9ility:ineluctable¦6ism:mystical¦8ity:physical,proactive,sensitive,vertical¦5cy:pliant¦7ity:positive¦9ity:practical¦12ism:professional¦6ce:prudent¦3ness:red¦6cy:vagrant¦3dom:wise"})},PN=["academy","administration","agence","agences","agencies","agency","airlines","airways","army","assoc","associates","association","assurance","authority","autorite","aviation","bank","banque","board","boys","brands","brewery","brotherhood","brothers","bureau","cafe","co","caisse","capital","care","cathedral","center","centre","chemicals","choir","chronicle","church","circus","clinic","clinique","club","co","coalition","coffee","collective","college","commission","committee","communications","community","company","comprehensive","computers","confederation","conference","conseil","consulting","containers","corporation","corps","corp","council","crew","data","departement","department","departments","design","development","directorate","division","drilling","education","eglise","electric","electricity","energy","ensemble","enterprise","enterprises","entertainment","estate","etat","faculty","faction","federation","financial","fm","foundation","fund","gas","gazette","girls","government","group","guild","herald","holdings","hospital","hotel","hotels","inc","industries","institut","institute","institutes","insurance","international","interstate","investment","investments","investors","journal","laboratory","labs","llc","ltd","limited","machines","magazine","management","marine","marketing","markets","media","memorial","ministere","ministry","military","mobile","motor","motors","musee","museum","news","observatory","office","oil","optical","orchestra","organization","partners","partnership","petrol","petroleum","pharmacare","pharmaceutical","pharmaceuticals","pizza","plc","police","politburo","polytechnic","post","power","press","productions","quartet","radio","reserve","resources","restaurant","restaurants","savings","school","securities","service","services","societe","subsidiary","society","sons","subcommittee","syndicat","systems","telecommunications","telegraph","television","times","tribunal","tv","union","university","utilities","workers"].reduce(((e,t)=>(e[t]=!0,e)),{}),TN=["atoll","basin","bay","beach","bluff","bog","camp","canyon","canyons","cape","cave","caves","cliffs","coast","cove","coves","crater","crossing","creek","desert","dune","dunes","downs","estates","escarpment","estuary","falls","fjord","fjords","forest","forests","glacier","gorge","gorges","grove","gulf","gully","highland","heights","hollow","hill","hills","inlet","island","islands","isthmus","junction","knoll","lagoon","lake","lakeshore","marsh","marshes","mount","mountain","mountains","narrows","peninsula","plains","plateau","pond","rapids","ravine","reef","reefs","ridge","river","rivers","sandhill","shoal","shore","shoreline","shores","strait","straits","springs","stream","swamp","tombolo","trail","trails","trench","valley","vallies","village","volcano","waterfall","watershed","wetland","woods","acres","burough","county","district","municipality","prefecture","province","region","reservation","state","territory","borough","metropolis","downtown","uptown","midtown","city","town","township","hamlet","country","kingdom","enclave","neighbourhood","neighborhood","kingdom","ward","zone","airport","amphitheater","arch","arena","auditorium","bar","barn","basilica","battlefield","bridge","building","castle","centre","coliseum","cineplex","complex","dam","farm","field","fort","garden","gardens","gymnasium","hall","house","levee","library","manor","memorial","monument","museum","gallery","palace","pillar","pits","plantation","playhouse","quarry","sportsfield","sportsplex","stadium","terrace","terraces","theater","tower","park","parks","site","ranch","raceway","sportsplex","ave","st","street","rd","road","lane","landing","crescent","cr","way","tr","terrace","avenue"].reduce(((e,t)=>(e[t]=!0,e)),{}),EN=[[/([^v])ies$/i,"$1y"],[/(ise)s$/i,"$1"],[/(kn|[^o]l|w)ives$/i,"$1ife"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)ves$/i,"$1f"],[/^(dwar|handkerchie|hoo|scar|whar)ves$/i,"$1f"],[/(antenn|formul|nebul|vertebr|vit)ae$/i,"$1a"],[/(octop|vir|radi|nucle|fung|cact|stimul)(i)$/i,"$1us"],[/(buffal|tomat|tornad)(oes)$/i,"$1o"],[/(ause)s$/i,"$1"],[/(ease)s$/i,"$1"],[/(ious)es$/i,"$1"],[/(ouse)s$/i,"$1"],[/(ose)s$/i,"$1"],[/(..ase)s$/i,"$1"],[/(..[aeiu]s)es$/i,"$1"],[/(vert|ind|cort)(ices)$/i,"$1ex"],[/(matr|append)(ices)$/i,"$1ix"],[/([xo]|ch|ss|sh)es$/i,"$1"],[/men$/i,"man"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/(cris|ax|test)es$/i,"$1is"],[/(alias|status)es$/i,"$1"],[/(ss)$/i,"$1"],[/(ic)s$/i,"$1"],[/s$/i,""]],xN=function(e,t){const{irregularPlurals:n}=t.two;let r=function(e){return Object.keys(e).reduce(((t,n)=>(t[e[n]]=n,t)),{})}(n);if(r.hasOwnProperty(e))return r[e];for(let t=0;t<EN.length;t++)if(!0===EN[t][0].test(e))return e.replace(EN[t][0],EN[t][1]);return e},IN={toPlural:HO,toSingular:xN,all:function(e,t){let n=[e],r=HO(e,t);r!==e&&n.push(r);let i=xN(e,t);return i!==e&&n.push(i),n}},CN=function(e="",t={}){let n=function(e,t={}){return t.hasOwnProperty(e)?t[e]:null}(e,t.ex);return n=n||function(e,t=[]){for(let n=0;n<t.length;n+=1)if(e.endsWith(t[n]))return e;return null}(e,t.same),n=n||function(e,t,n={}){t=t||{};for(let r=e.length-1;r>=1;r-=1){let i=e.length-r,s=e.substring(i,e.length);if(!0===t.hasOwnProperty(s))return e.slice(0,i)+t[s];if(!0===n.hasOwnProperty(s))return e.slice(0,i)+n[s]}return t.hasOwnProperty("")?e+t[""]:n.hasOwnProperty("")?e+n[""]:null}(e,t.fwd,t.both),n=n||e,n};let ON={Gerund:["ing"],Actor:["erer"],Infinitive:["ate","ize","tion","rify","then","ress","ify","age","nce","ect","ise","ine","ish","ace","ash","ure","tch","end","ack","and","ute","ade","ock","ite","ase","ose","use","ive","int","nge","lay","est","ain","ant","ent","eed","er","le","unk","ung","upt","en"],PastTense:["ept","ed","lt","nt","ew","ld"],PresentTense:["rks","cks","nks","ngs","mps","tes","zes","ers","les","acks","ends","ands","ocks","lays","eads","lls","els","ils","ows","nds","ays","ams","ars","ops","ffs","als","urs","lds","ews","ips","es","ts","ns"],Participle:["ken","wn"]};ON=Object.keys(ON).reduce(((e,t)=>(ON[t].forEach((n=>e[n]=t)),e)),{});const SN=ON,NN=function(e){let t=e.substring(e.length-3);if(!0===SN.hasOwnProperty(t))return SN[t];let n=e.substring(e.length-2);return!0===SN.hasOwnProperty(n)?SN[n]:"s"===e.substring(e.length-1)?"PresentTense":null},jN={are:"be",were:"be",been:"be",is:"be",am:"be",was:"be",be:"be",being:"be"},DN=function(e,t,n){const{fromPast:r,fromPresent:i,fromGerund:s,fromParticiple:a}=t.two.models;let{prefix:o,verb:l,particle:c}=function(e,t){let n="",r={};t.one&&t.one.prefixes&&(r=t.one.prefixes);let[i,s]=e.split(/ /);return s&&!0===r[i]&&(n=i,i=s,s=""),{prefix:n,verb:i,particle:s}}(e,t),u="";if(n||(n=NN(e)),jN.hasOwnProperty(e))u=jN[e];else if("Participle"===n)u=CN(l,a);else if("PastTense"===n)u=CN(l,r);else if("PresentTense"===n)u=CN(l,i);else{if("Gerund"!==n)return e;u=CN(l,s)}return c&&(u+=" "+c),o&&(u=o+" "+u),u},RN=function(e,t){const{toPast:n,toPresent:r,toGerund:i,toParticiple:s}=t.two.models;if("be"===e)return{Infinitive:e,Gerund:"being",PastTense:"was",PresentTense:"is"};let[a,o]=(e=>/ /.test(e)?e.split(/ /):[e,""])(e),l={Infinitive:a,PastTense:CN(a,n),PresentTense:CN(a,r),Gerund:CN(a,i),FutureTense:"will "+a},c=CN(a,s);if(c!==e&&c!==l.PastTense){let n=t.one.lexicon||{};"Participle"!==n[c]&&"Adjective"!==n[c]||("play"===e&&(c="played"),l.Participle=c)}return o&&Object.keys(l).forEach((e=>{l[e]+=" "+o})),l},$N={toInfinitive:DN,conjugate:RN,all:function(e,t){let n=RN(e,t);return delete n.FutureTense,Object.values(n).filter((e=>e))}},LN=function(e,t){const n=t.two.models.toSuperlative;return CN(e,n)},MN=function(e,t){const n=t.two.models.toComparative;return CN(e,n)},FN=function(e="",t=[]){const n=e.length;for(let r=n<=6?n-1:6;r>=1;r-=1){let i=e.substring(n-r,e.length);if(!0===t[i.length].hasOwnProperty(i))return e.slice(0,n-r)+t[i.length][i]}return null},UN="ically",BN=new Set(["analyt"+UN,"chem"+UN,"class"+UN,"clin"+UN,"crit"+UN,"ecolog"+UN,"electr"+UN,"empir"+UN,"frant"+UN,"grammat"+UN,"ident"+UN,"ideolog"+UN,"log"+UN,"mag"+UN,"mathemat"+UN,"mechan"+UN,"med"+UN,"method"+UN,"method"+UN,"mus"+UN,"phys"+UN,"phys"+UN,"polit"+UN,"pract"+UN,"rad"+UN,"satir"+UN,"statist"+UN,"techn"+UN,"technolog"+UN,"theoret"+UN,"typ"+UN,"vert"+UN,"whims"+UN]),VN=[null,{},{ly:""},{ily:"y",bly:"ble",ply:"ple"},{ally:"al",rply:"rp"},{ually:"ual",ially:"ial",cally:"cal",eally:"eal",rally:"ral",nally:"nal",mally:"mal",eeply:"eep",eaply:"eap"},{ically:"ic"}],zN=new Set(["early","only","hourly","daily","weekly","monthly","yearly","mostly","duly","unduly","especially","undoubtedly","conversely","namely","exceedingly","presumably","accordingly","overly","best","latter","little","long","low"]),HN={wholly:"whole",fully:"full",truly:"true",gently:"gentle",singly:"single",customarily:"customary",idly:"idle",publically:"public",quickly:"quick",superbly:"superb",cynically:"cynical",well:"good"},GN=[null,{y:"ily"},{ly:"ly",ic:"ically"},{ial:"ially",ual:"ually",tle:"tly",ble:"bly",ple:"ply",ary:"arily"},{},{},{}],qN={cool:"cooly",whole:"wholly",full:"fully",good:"well",idle:"idly",public:"publicly",single:"singly",special:"especially"},KN=function(e){if(qN.hasOwnProperty(e))return qN[e];let t=FN(e,GN);return t||(t=e+"ly"),t},WN={toSuperlative:LN,toComparative:MN,toAdverb:KN,toNoun:function(e,t){const n=t.two.models.adjToNoun;return CN(e,n)},fromAdverb:function(e){return e.endsWith("ly")?BN.has(e)?e.replace(/ically/,"ical"):zN.has(e)?null:HN.hasOwnProperty(e)?HN[e]:FN(e,VN)||e:null},fromSuperlative:function(e,t){const n=t.two.models.fromSuperlative;return CN(e,n)},fromComparative:function(e,t){const n=t.two.models.fromComparative;return CN(e,n)},all:function(e,t){let n=[e];return n.push(LN(e,t)),n.push(MN(e,t)),n.push(KN(e)),n=n.filter((e=>e)),n=new Set(n),Array.from(n)}},JN={noun:IN,verb:$N,adjective:WN},ZN={Singular:(e,t,n,r)=>{let i=r.one.lexicon,s=n.two.transform.noun.toPlural(e,r);i[s]||(t[s]=t[s]||"Plural")},Actor:(e,t,n,r)=>{let i=r.one.lexicon,s=n.two.transform.noun.toPlural(e,r);i[s]||(t[s]=t[s]||["Plural","Actor"])},Comparable:(e,t,n,r)=>{let i=r.one.lexicon,{toSuperlative:s,toComparative:a}=n.two.transform.adjective,o=s(e,r);i[o]||(t[o]=t[o]||"Superlative");let l=a(e,r);i[l]||(t[l]=t[l]||"Comparative"),t[e]="Adjective"},Demonym:(e,t,n,r)=>{let i=n.two.transform.noun.toPlural(e,r);t[i]=t[i]||["Demonym","Plural"]},Infinitive:(e,t,n,r)=>{let i=r.one.lexicon,s=n.two.transform.verb.conjugate(e,r);Object.entries(s).forEach((e=>{i[e[1]]||t[e[1]]||"FutureTense"===e[0]||(t[e[1]]=e[0])}))},PhrasalVerb:(e,t,n,r)=>{let i=r.one.lexicon;t[e]=["PhrasalVerb","Infinitive"];let s=r.one._multiCache,[a,o]=e.split(" ");i[a]||(t[a]=t[a]||"Infinitive");let l=n.two.transform.verb.conjugate(a,r);delete l.FutureTense,Object.entries(l).forEach((e=>{if("Actor"===e[0]||""===e[1])return;t[e[1]]||i[e[1]]||(t[e[1]]=e[0]),s[e[1]]=2;let n=e[1]+" "+o;t[n]=t[n]||[e[0],"PhrasalVerb"]}))},Multiple:(e,t)=>{t[e]=["Multiple","Cardinal"],t[e+"th"]=["Multiple","Ordinal"],t[e+"ths"]=["Multiple","Fraction"]},Cardinal:(e,t)=>{t[e]=["TextValue","Cardinal"]},Ordinal:(e,t)=>{t[e]=["TextValue","Ordinal"],t[e+"s"]=["TextValue","Fraction"]},Place:(e,t)=>{t[e]=["Place","ProperNoun"]},Region:(e,t)=>{t[e]=["Region","ProperNoun"]}},QN={e:["mice","louse","antennae","formulae","nebulae","vertebrae","vitae"],i:["tia","octopi","viri","radii","nuclei","fungi","cacti","stimuli"],n:["men"],t:["feet"]},XN=new Set(["israelis","menus","logos"]),YN=["bus","mas","was","ias","xas","vas","cis","lis","nis","ois","ris","sis","tis","xis","aus","cus","eus","fus","gus","ius","lus","nus","das","ous","pus","rus","sus","tus","xus","aos","igos","ados","ogos","'s","ss"],ej=function(e){if(!e||e.length<=3)return!1;if(XN.has(e))return!0;let t=e[e.length-1];return QN.hasOwnProperty(t)?QN[t].find((t=>e.endsWith(t))):"s"===t&&!YN.find((t=>e.endsWith(t)))},tj={two:{quickSplit:function(e){const t=/[,:;]/;let n=[];return e.forEach((e=>{let r=0;e.forEach(((i,s)=>{t.test(i.post)&&function(e,t){let n=e[t];if(!n)return!1;const r=new Set(["may","april","august","jan"]);if("like"===n.normal||r.has(n.normal))return!1;if(n.tags.has("Place")||n.tags.has("Date"))return!1;if(e[t-1]){let i=e[t-1];if(i.tags.has("Date")||r.has(i.normal))return!1;if(i.tags.has("Adjective")||n.tags.has("Adjective"))return!1}let i=n.normal;return 1!==i.length&&2!==i.length&&4!==i.length||!/^[0-9]+$/.test(i)}(e,s+1)&&(n.push(e.slice(r,s+1)),r=s+1)})),r<e.length&&n.push(e.slice(r,e.length))})),n},expandLexicon:function(e,t){const{methods:n,model:r}=t;let i={},s={};return Object.keys(e).forEach((t=>{let a=e[t],o=(t=(t=t.toLowerCase().trim()).replace(/'s\b/,"")).split(/ /);o.length>1&&(void 0===s[o[0]]||o.length>s[o[0]])&&(s[o[0]]=o.length),!0===ZN.hasOwnProperty(a)&&ZN[a](t,i,n,r),i[t]=i[t]||a})),delete i[""],delete i.null,delete i[" "],{lex:i,_multi:s}},transform:JN,looksPlural:ej}};let nj={one:{lexicon:{}},two:{models:AN}};const rj={"Actor|Verb":"Actor","Adj|Gerund":"Adjective","Adj|Noun":"Adjective","Adj|Past":"Adjective","Adj|Present":"Adjective","Noun|Verb":"Singular","Noun|Gerund":"Gerund","Person|Noun":"Noun","Person|Date":"Month","Person|Verb":"FirstName","Person|Place":"Person","Person|Adj":"Comparative","Plural|Verb":"Plural","Unit|Noun":"Noun"},ij=function(e,t){const n={model:t,methods:tj};let{lex:r,_multi:i}=tj.two.expandLexicon(e,n);return Object.assign(t.one.lexicon,r),Object.assign(t.one._multiCache,i),t},sj=function(e,t,n){let r=RN(e,nj);t[r.PastTense]=t[r.PastTense]||"PastTense",t[r.Gerund]=t[r.Gerund]||"Gerund",!0===n&&(t[r.PresentTense]=t[r.PresentTense]||"PresentTense")},aj=function(e,t,n){let r=LN(e,n);t[r]=t[r]||"Superlative";let i=MN(e,n);t[i]=t[i]||"Comparative"};let oj={one:{_multiCache:{},lexicon:qO,frozenLex:{"20th century fox":"Organization","7 eleven":"Organization","motel 6":"Organization","excuse me":"Expression","financial times":"Organization","guns n roses":"Organization","la z boy":"Organization","labour party":"Organization","new kids on the block":"Organization","new york times":"Organization","the guess who":"Organization","thin lizzy":"Organization","prime minister":"Actor","free market":"Singular","lay up":"Singular","living room":"Singular","living rooms":"Plural","spin off":"Singular","appeal court":"Uncountable","cold war":"Uncountable","gene pool":"Uncountable","machine learning":"Uncountable","nail polish":"Uncountable","time off":"Uncountable","take part":"Infinitive","bill gates":"Person","doctor who":"Person","dr who":"Person","he man":"Person","iron man":"Person","kid cudi":"Person","run dmc":"Person","rush limbaugh":"Person","snow white":"Person","tiger woods":"Person","brand new":"Adjective","en route":"Adjective","left wing":"Adjective","off guard":"Adjective","on board":"Adjective","part time":"Adjective","right wing":"Adjective","so called":"Adjective","spot on":"Adjective","straight forward":"Adjective","super duper":"Adjective","tip top":"Adjective","top notch":"Adjective","up to date":"Adjective","win win":"Adjective","brooklyn nets":"SportsTeam","chicago bears":"SportsTeam","houston astros":"SportsTeam","houston dynamo":"SportsTeam","houston rockets":"SportsTeam","houston texans":"SportsTeam","minnesota twins":"SportsTeam","orlando magic":"SportsTeam","san antonio spurs":"SportsTeam","san diego chargers":"SportsTeam","san diego padres":"SportsTeam","iron maiden":"ProperNoun","isle of man":"Country","united states":"Country","united states of america":"Country","prince edward island":"Region","cedar breaks":"Place","cedar falls":"Place","point blank":"Adverb","tiny bit":"Adverb","by the time":"Conjunction","no matter":"Conjunction","civil wars":"Plural","credit cards":"Plural","default rates":"Plural","free markets":"Plural","head starts":"Plural","home runs":"Plural","lay ups":"Plural","phone calls":"Plural","press releases":"Plural","record labels":"Plural","soft serves":"Plural","student loans":"Plural","tax returns":"Plural","tv shows":"Plural","video games":"Plural","took part":"PastTense","takes part":"PresentTense","taking part":"Gerund","taken part":"Participle","light bulb":"Noun","rush hour":"Noun","fluid ounce":"Unit","the rolling stones":"Organization"}},two:{irregularPlurals:$O,models:AN,suffixPatterns:VS,prefixPatterns:qS,endsWith:iN,neighbours:oN,regexNormal:[[/^[\w.]+@[\w.]+\.[a-z]{2,3}$/,"Email"],[/^(https?:\/\/|www\.)+\w+\.[a-z]{2,3}/,"Url","http.."],[/^[a-z0-9./].+\.(com|net|gov|org|ly|edu|info|biz|dev|ru|jp|de|in|uk|br|io|ai)/,"Url",".com"],[/^[PMCE]ST$/,"Timezone","EST"],[/^ma?c'[a-z]{3}/,"LastName","mc'neil"],[/^o'[a-z]{3}/,"LastName","o'connor"],[/^ma?cd[aeiou][a-z]{3}/,"LastName","mcdonald"],[/^(lol)+[sz]$/,"Expression","lol"],[/^wo{2,}a*h?$/,"Expression","wooah"],[/^(hee?){2,}h?$/,"Expression","hehe"],[/^(un|de|re)\\-[a-z\u00C0-\u00FF]{2}/,"Verb","un-vite"],[/^(m|k|cm|km)\/(s|h|hr)$/,"Unit","5 k/m"],[/^(ug|ng|mg)\/(l|m3|ft3)$/,"Unit","ug/L"],[/[^:/]\/\p{Letter}/u,"SlashedTerm","love/hate"]],regexText:[[/^#[\p{Number}_]*\p{Letter}/u,"HashTag"],[/^@\w{2,}$/,"AtMention"],[/^([A-Z]\.){2}[A-Z]?/i,["Acronym","Noun"],"F.B.I"],[/.{3}[lkmnp]in['‘’‛‵′`´]$/,"Gerund","chillin'"],[/.{4}s['‘’‛‵′`´]$/,"Possessive","flanders'"],[/^[\p{Emoji_Presentation}\p{Extended_Pictographic}]/u,"Emoji","emoji-class"]],regexNumbers:[[/^@1?[0-9](am|pm)$/i,"Time","3pm"],[/^@1?[0-9]:[0-9]{2}(am|pm)?$/i,"Time","3:30pm"],[/^'[0-9]{2}$/,"Year"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])$/,"Time","3:12:31"],[/^[012]?[0-9](:[0-5][0-9])?(:[0-5][0-9])? ?(am|pm)$/i,"Time","1:12pm"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])? ?(am|pm)?$/i,"Time","1:12:31pm"],[/^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}/i,"Date","iso-date"],[/^[0-9]{1,4}-[0-9]{1,2}-[0-9]{1,4}$/,"Date","iso-dash"],[/^[0-9]{1,4}\/[0-9]{1,2}\/([0-9]{4}|[0-9]{2})$/,"Date","iso-slash"],[/^[0-9]{1,4}\.[0-9]{1,2}\.[0-9]{1,4}$/,"Date","iso-dot"],[/^[0-9]{1,4}-[a-z]{2,9}-[0-9]{1,4}$/i,"Date","12-dec-2019"],[/^utc ?[+-]?[0-9]+$/,"Timezone","utc-9"],[/^(gmt|utc)[+-][0-9]{1,2}$/i,"Timezone","gmt-3"],[/^[0-9]{3}-[0-9]{4}$/,"PhoneNumber","421-0029"],[/^(\+?[0-9][ -])?[0-9]{3}[ -]?[0-9]{3}-[0-9]{4}$/,"PhoneNumber","1-800-"],[/^[-+]?\p{Currency_Symbol}[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?([kmb]|bn)?\+?$/u,["Money","Value"],"$5.30"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?\p{Currency_Symbol}\+?$/u,["Money","Value"],"5.30£"],[/^[-+]?[$£]?[0-9]([0-9,.])+(usd|eur|jpy|gbp|cad|aud|chf|cny|hkd|nzd|kr|rub)$/i,["Money","Value"],"$400usd"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?\+?$/,["Cardinal","NumericValue"],"5,999"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(st|nd|rd|r?th)$/,["Ordinal","NumericValue"],"53rd"],[/^\.[0-9]+\+?$/,["Cardinal","NumericValue"],".73th"],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?%\+?$/,["Percent","Cardinal","NumericValue"],"-4%"],[/^\.[0-9]+%$/,["Percent","Cardinal","NumericValue"],".3%"],[/^[0-9]{1,4}\/[0-9]{1,4}(st|nd|rd|th)?s?$/,["Fraction","NumericValue"],"2/3rds"],[/^[0-9.]{1,3}[a-z]{0,2}[-–—][0-9]{1,3}[a-z]{0,2}$/,["Value","NumberRange"],"3-4"],[/^[0-9]{1,2}(:[0-9][0-9])?(am|pm)? ?[-–—] ?[0-9]{1,2}(:[0-9][0-9])?(am|pm)$/,["Time","NumberRange"],"3-4pm"],[/^[0-9.]+([a-z°]{1,4})$/,"NumericValue","9km"]],switches:KO,clues:xS,uncountable:{},orgWords:PN,placeWords:TN}};oj=function(e){return e=function(e,t){return Object.keys(e).forEach((n=>{"Uncountable"===e[n]&&(t.two.uncountable[n]=!0,e[n]="Uncountable")})),t}((e=ij(e.one.lexicon,e)).one.lexicon,e),e=function(e,t){let n={};const r=t.one.lexicon;return Object.keys(e).forEach((i=>{const s=e[i];if(n[i]=rj[s],"Noun|Verb"!==s&&"Person|Verb"!==s&&"Actor|Verb"!==s||sj(i,r,!1),"Adj|Present"===s&&(sj(i,r,!0),aj(i,r,t)),"Person|Adj"===s&&aj(i,r,t),"Adj|Gerund"===s||"Noun|Gerund"===s){let e=DN(i,nj,"Gerund");r[e]||(n[e]="Infinitive")}if("Noun|Gerund"!==s&&"Adj|Noun"!==s&&"Person|Noun"!==s||function(e,t,n){let r=HO(e,n);t[r]=t[r]||"Plural"}(i,r,t),"Adj|Past"===s){let e=DN(i,nj,"PastTense");r[e]||(n[e]="Infinitive")}})),t=ij(n,t)}(e.two.switches,e),function(e){const{irregularPlurals:t}=e.two,{lexicon:n}=e.one;return Object.entries(t).forEach((e=>{n[e[0]]=n[e[0]]||"Singular",n[e[1]]=n[e[1]]||"Plural"})),e}(e)}(oj);const lj=oj,cj=function(e,t,n,r){const i=r.methods.one.setTag;"-"===e[t].post&&e[t+1]&&i([e[t],e[t+1]],"Hyphenated",r,null,"1-punct-hyphen''")},uj=/^(under|over|mis|re|un|dis|semi)-?/,hj=function(e,t,n){const r=n.two.switches;let i=e[t];if(r.hasOwnProperty(i.normal))i.switch=r[i.normal];else if(uj.test(i.normal)){let e=i.normal.replace(uj,"");e.length>3&&r.hasOwnProperty(e)&&(i.switch=r[e])}},dj=function(e,t,n){if(!t||0===t.length)return;if(!0===e.frozen)return;const r="undefined"!=typeof process&&process.env?process.env:self.env||{};r&&r.DEBUG_TAGS&&((e,t,n="")=>{let r=e.text||"["+e.implicit+"]";"string"!=typeof t&&t.length>2&&(t=t.slice(0,2).join(", #")+" +"),t="string"!=typeof t?t.join(", #"):t,console.log(` ${(e=>"[33m[3m"+e+"[0m")(r).padEnd(24)} [32m→[0m #${t.padEnd(22)}  ${(e=>"[3m"+e+"[0m")(n)}`)})(e,t,n),e.tags=e.tags||new Set,"string"==typeof t?e.tags.add(t):t.forEach((t=>e.tags.add(t)))},pj=["Acronym","Abbreviation","ProperNoun","Uncountable","Possessive","Pronoun","Activity","Honorific","Month"],fj=function(e,t,n){let r=e[t],i=Array.from(r.tags);for(let e=0;e<i.length;e+=1)if(n.one.tagSet[i[e]]){let t=n.one.tagSet[i[e]].parents;dj(r,t,` -inferred by #${i[e]}`)}!function(e){!e.tags.has("Noun")||e.tags.has("Plural")||e.tags.has("Singular")||pj.find((t=>e.tags.has(t)))||(ej(e.normal)?dj(e,"Plural","3-plural-guess"):dj(e,"Singular","3-singular-guess"))}(r),function(e){let t=e.tags;if(t.has("Verb")&&1===t.size){let t=NN(e.normal);t&&dj(e,t,"3-verb-tense-guess")}}(r)},mj=/^\p{Lu}[\p{Ll}'’]/u,gj=/[0-9]/,yj=["Date","Month","WeekDay","Unit","Expression"],vj=/[IVX]/,bj=/^[IVXLCDM]{2,}$/,wj=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,_j={li:!0,dc:!0,md:!0,dm:!0,ml:!0},kj=function(e,t,n){let r=e[t];r.index=r.index||[0,0];let i=r.index[1],s=r.text||"";return 0!==i&&!0===mj.test(s)&&!1===gj.test(s)?yj.find((e=>r.tags.has(e)))||r.pre.match(/["']$/)||"the"===r.normal?null:(fj(e,t,n),r.tags.has("Noun")||r.frozen||r.tags.clear(),dj(r,"ProperNoun","2-titlecase"),!0):s.length>=2&&bj.test(s)&&vj.test(s)&&wj.test(s)&&!_j[r.normal]?(dj(r,"RomanNumeral","2-xvii"),!0):null},Aj=function(e="",t=[]){const n=e.length;let r=7;n<=r&&(r=n-1);for(let i=r;i>1;i-=1){let r=e.substring(n-i,n);if(!0===t[r.length].hasOwnProperty(r))return t[r.length][r]}return null},Pj=function(e,t,n){let r=e[t];if(0===r.tags.size){let e=Aj(r.normal,n.two.suffixPatterns);if(null!==e)return dj(r,e,"2-suffix"),r.confidence=.7,!0;if(r.implicit&&(e=Aj(r.implicit,n.two.suffixPatterns),null!==e))return dj(r,e,"2-implicit-suffix"),r.confidence=.7,!0}return null},Tj=/['‘’‛‵′`´]/,Ej=function(e,t){for(let n=0;n<t.length;n+=1)if(!0===t[n][0].test(e))return t[n];return null},xj=function(e,t,n,r){const i=r.methods.one.setTag;let{regexText:s,regexNormal:a,regexNumbers:o,endsWith:l}=n.two,c=e[t],u=c.machine||c.normal,h=c.text;Tj.test(c.post)&&!Tj.test(c.pre)&&(h+=c.post.trim());let d=Ej(h,s)||Ej(u,a);return!d&&/[0-9]/.test(u)&&(d=Ej(u,o)),d||0!==c.tags.size||(d=function(e="",t){let n=e[e.length-1];if(!0===t.hasOwnProperty(n)){let r=t[n]||[];for(let t=0;t<r.length;t+=1)if(!0===r[t][0].test(e))return r[t]}return null}(u,l)),d?(i([c],d[1],r,null,`2-regex-'${d[2]||d[0]}'`),c.confidence=.6,!0):null},Ij=function(e,t,n){let r=e[t];if(0===r.tags.size){let e=function(e="",t=[]){const n=e.length;let r=7;r>n-3&&(r=n-3);for(let n=r;n>2;n-=1){let r=e.substring(0,n);if(!0===t[r.length].hasOwnProperty(r))return t[r.length][r]}return null}(r.normal,n.two.prefixPatterns);if(null!==e)return dj(r,e,"2-prefix"),r.confidence=.5,!0}return null},Cj=new Set(["in","on","by","until","for","to","during","throughout","through","within","before","after","of","this","next","last","circa","around","post","pre","budget","classic","plan","may"]),Oj=function(e){if(!e)return!1;let t=e.normal||e.implicit;return!!Cj.has(t)||!!(e.tags.has("Date")||e.tags.has("Month")||e.tags.has("WeekDay")||e.tags.has("Year"))||!!e.tags.has("ProperNoun")},Sj=function(e){return!(!e||!e.tags.has("Ordinal")&&!(e.tags.has("Cardinal")&&e.normal.length<3)&&"is"!==e.normal&&"was"!==e.normal)},Nj=function(e){return e&&(e.tags.has("Date")||e.tags.has("Month")||e.tags.has("WeekDay")||e.tags.has("Year"))},jj=function(e,t){const n=e[t];if(n.tags.has("NumericValue")&&n.tags.has("Cardinal")&&4===n.normal.length){let r=Number(n.normal);if(r&&!isNaN(r)&&r>1400&&r<2100){let i=e[t-1],s=e[t+1];if(Oj(i)||Oj(s))return dj(n,"Year","2-tagYear");if(r>=1920&&r<2025){if(Sj(i)||Sj(s))return dj(n,"Year","2-tagYear-close");if(Nj(e[t-2])||Nj(e[t+2]))return dj(n,"Year","2-tagYear-far");if(i&&(i.tags.has("Determiner")||i.tags.has("Possessive"))&&s&&s.tags.has("Noun")&&!s.tags.has("Plural"))return dj(n,"Year","2-tagYear-noun")}}}return null},Dj=function(e,t,n,r){const i=r.methods.one.setTag,s=e[t];s.tags.has("Verb")&&(["PastTense","PresentTense","Auxiliary","Modal","Particle"].find((e=>s.tags.has(e)))||i([s],"Infinitive",r,null,"2-verb-type''"))},Rj=/^[A-Z]('s|,)?$/,$j=/^[A-Z-]+$/,Lj=/^[A-Z]+s$/,Mj=/([A-Z]\.)+[A-Z]?,?$/,Fj=/[A-Z]{2,}('s|,)?$/,Uj=/([a-z]\.)+[a-z]\.?$/,Bj={I:!0,A:!0},Vj={la:!0,ny:!0,us:!0,dc:!0,gb:!0},zj=function(e,t,n){let r=e[t];return r.tags.has("RomanNumeral")||r.tags.has("Acronym")||r.frozen?null:function(e,t){let n=e.text;if(!1===$j.test(n)){if(!(n.length>3&&!0===Lj.test(n)))return!1;n=n.replace(/s$/,"")}return!(n.length>5||Bj.hasOwnProperty(n)||t.one.lexicon.hasOwnProperty(e.normal)||!0!==Mj.test(n)&&!0!==Uj.test(n)&&!0!==Rj.test(n)&&!0!==Fj.test(n))}(r,n)?(r.tags.clear(),dj(r,["Acronym","Noun"],"3-no-period-acronym"),!0===Vj[r.normal]&&dj(r,"Place","3-place-acronym"),!0===Lj.test(r.text)&&dj(r,"Plural","3-plural-acronym"),!0):!Bj.hasOwnProperty(r.text)&&Rj.test(r.text)?(r.tags.clear(),dj(r,["Acronym","Noun"],"3-one-letter-acronym"),!0):r.tags.has("Organization")&&r.text.length<=3?(dj(r,"Acronym","3-org-acronym"),!0):r.tags.has("Organization")&&$j.test(r.text)&&r.text.length<=6?(dj(r,"Acronym","3-titlecase-acronym"),!0):null},Hj=function(e,t){if(!e)return null;let n=t.find((t=>e.normal===t[0]));return n?n[1]:null},Gj=function(e,t){if(!e)return null;let n=t.find((t=>e.tags.has(t[0])));return n?n[1]:null},qj=function(e,t,n){const{leftTags:r,leftWords:i,rightWords:s,rightTags:a}=n.two.neighbours;let o=e[t];if(0===o.tags.size){let l=null;if(l=l||Hj(e[t-1],i),l=l||Hj(e[t+1],s),l=l||Gj(e[t-1],r),l=l||Gj(e[t+1],a),l)return dj(o,l,"3-[neighbour]"),fj(e,t,n),e[t].confidence=.2,!0}return null},Kj=function(e,t,n){return!!e&&!e.tags.has("FirstName")&&!e.tags.has("Place")&&(!!(e.tags.has("ProperNoun")||e.tags.has("Organization")||e.tags.has("Acronym"))||!(n||!(e=>/^\p{Lu}[\p{Ll}'’]/u.test(e))(e.text))&&(0!==t||e.tags.has("Singular")))},Wj=function(e,t,n,r){const i=n.model.two.orgWords,s=n.methods.one.setTag;let a=e[t];if(!0===i[a.machine||a.normal]&&Kj(e[t-1],t-1,r)){s([e[t]],"Organization",n,null,"3-[org-word]");for(let i=t;i>=0&&Kj(e[i],i,r);i-=1)s([e[i]],"Organization",n,null,"3-[org-word]")}return null},Jj=/'s$/,Zj=new Set(["athletic","city","community","eastern","federal","financial","great","historic","historical","local","memorial","municipal","national","northern","provincial","southern","state","western","spring","pine","sunset","view","oak","maple","spruce","cedar","willow"]),Qj=new Set(["center","centre","way","range","bar","bridge","field","pit"]),Xj=function(e,t,n){if(!e)return!1;let r=e.tags;return!(r.has("Organization")||r.has("Possessive")||Jj.test(e.normal))&&(!(!r.has("ProperNoun")&&!r.has("Place"))||!(n||!(e=>/^\p{Lu}[\p{Ll}'’]/u.test(e))(e.text))&&(0!==t||r.has("Singular")))},Yj=function(e,t,n,r){const i=n.model.two.placeWords,s=n.methods.one.setTag;let a=e[t],o=a.machine||a.normal;if(!0===i[o]){for(let i=t-1;i>=0;i-=1)if(!Zj.has(e[i].normal)){if(!Xj(e[i],i,r))break;s(e.slice(i,t+1),"Place",n,null,"3-[place-of-foo]")}if(Qj.has(o))return!1;for(let i=t+1;i<e.length;i+=1){if(Xj(e[i],i,r))return s(e.slice(t,i+1),"Place",n,null,"3-[foo-place]"),!0;if("of"!==e[i].normal&&!Zj.has(e[i].normal))break}}return null},eD=function(e,t,n){let r=!1,i=e[t].tags;(0===i.size||1===i.size&&(i.has("Hyphenated")||i.has("HashTag")||i.has("Prefix")||i.has("SlashedTerm")))&&(r=!0),r&&(dj(e[t],"Noun","3-[fallback]"),fj(e,t,n),e[t].confidence=.1)},tD=/^[A-Z][a-z]/,nD=(e,t)=>e[t].tags.has("ProperNoun")&&tD.test(e[t].text)?"Noun":null,rD=(e,t,n)=>0!==t||e[1]?null:n,iD={"Adj|Gerund":(e,t)=>nD(e,t),"Adj|Noun":(e,t)=>nD(e,t)||function(e,t){return!e[t+1]&&e[t-1]&&e[t-1].tags.has("Determiner")?"Noun":null}(e,t),"Actor|Verb":(e,t)=>nD(e,t),"Adj|Past":(e,t)=>nD(e,t),"Adj|Present":(e,t)=>nD(e,t),"Noun|Gerund":(e,t)=>nD(e,t),"Noun|Verb":(e,t)=>t>0&&nD(e,t)||rD(e,t,"Infinitive"),"Plural|Verb":(e,t)=>nD(e,t)||rD(e,t,"PresentTense")||function(e,t,n){return 0===t&&e.length>3?"Plural":null}(e,t),"Person|Noun":(e,t)=>nD(e,t),"Person|Verb":(e,t)=>0!==t?nD(e,t):null,"Person|Adj":(e,t)=>0===t&&e.length>1||nD(e,t)?"Person":null},sD=iD,aD="undefined"!=typeof process&&process.env?process.env:self.env||{},oD=/^(under|over|mis|re|un|dis|semi)-?/,lD=(e,t)=>{if(!e||!t)return null;let n=e.normal||e.implicit,r=null;return t.hasOwnProperty(n)&&(r=t[n]),r&&aD.DEBUG_TAGS&&console.log(`\n  [2m[3m     ↓ - '${n}' [0m`),r},cD=(e,t={},n)=>{if(!e||!t)return null;let r=Array.from(e.tags).sort(((e,t)=>(n[e]?n[e].parents.length:0)>(n[t]?n[t].parents.length:0)?-1:1)),i=r.find((e=>t[e]));return i&&aD.DEBUG_TAGS&&console.log(`  [2m[3m      ↓ - '${e.normal||e.implicit}' (#${i})  [0m`),i=t[i],i},uD=function(e,t,n){const r=n.model,i=n.methods.one.setTag,{switches:s,clues:a}=r.two,o=e[t];let l=o.normal||o.implicit||"";if(oD.test(l)&&!s[l]&&(l=l.replace(oD,"")),o.switch){let s=o.switch;if(o.tags.has("Acronym")||o.tags.has("PhrasalVerb"))return;let c=function(e,t,n,r){if(!n)return null;const i="also"!==e[t-1]?.text?t-1:Math.max(0,t-2),s=r.one.tagSet;let a=lD(e[t+1],n.afterWords);return a=a||lD(e[i],n.beforeWords),a=a||cD(e[i],n.beforeTags,s),a=a||cD(e[t+1],n.afterTags,s),a}(e,t,a[s],r);sD[s]&&(c=sD[s](e,t)||c),c?(i([o],c,n,null,`3-[switch] (${s})`),fj(e,t,r)):aD.DEBUG_TAGS&&console.log(`\n -> X  - '${l}'  : (${s})  `)}},hD={there:!0,this:!0,it:!0,him:!0,her:!0,us:!0},dD=function(e){if(e.filter((e=>!e.tags.has("ProperNoun"))).length<=3)return!1;const t=/^[a-z]/;return e.every((e=>!t.test(e.text)))},pD=function(e,t,n,r){for(let i=0;i<e.length;i+=1)!0!==e[i].frozen&&(hj(e,i,t),!1===r&&kj(e,i,t),Pj(e,i,t),xj(e,i,t,n),Ij(e,i,t),jj(e,i))},fD=function(e,t,n,r){for(let n=0;n<e.length;n+=1){let r=zj(e,n,t);fj(e,n,t),r=r||qj(e,n,t),r=r||eD(e,n,t)}for(let t=0;t<e.length;t+=1)!0!==e[t].frozen&&(Wj(e,t,n,r),Yj(e,t,n,r),uD(e,t,n),Dj(e,t,0,n),cj(e,t,0,n));!function(e,t){const n=t.methods.one.setTag,r=t.model.one._multiCache||{};let i=e[0];if(("Noun|Verb"===i.switch||i.tags.has("Infinitive"))&&e.length>=2){if(e.length<4&&!hD[e[1].normal])return;if(!i.tags.has("PhrasalVerb")&&r.hasOwnProperty(i.normal))return;(e[1].tags.has("Noun")||e[1].tags.has("Determiner"))&&(e.slice(1,3).some((e=>e.tags.has("Verb")))&&!i.tags.has("#PhrasalVerb")||n([i],"Imperative",t,null,"3-[imperative]"))}}(e,n)},mD={Possessive:e=>{let t=e.machine||e.normal||e.text;return t=t.replace(/'s$/,""),t},Plural:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.noun.toSingular(n,t.model)},Copula:()=>"is",PastTense:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.verb.toInfinitive(n,t.model,"PastTense")},Gerund:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.verb.toInfinitive(n,t.model,"Gerund")},PresentTense:(e,t)=>{let n=e.machine||e.normal||e.text;return e.tags.has("Infinitive")?n:t.methods.two.transform.verb.toInfinitive(n,t.model,"PresentTense")},Comparative:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.adjective.fromComparative(n,t.model)},Superlative:(e,t)=>{let n=e.machine||e.normal||e.text;return t.methods.two.transform.adjective.fromSuperlative(n,t.model)},Adverb:(e,t)=>{const{fromAdverb:n}=t.methods.two.transform.adjective;return n(e.machine||e.normal||e.text)}},gD={Adverb:"RB",Comparative:"JJR",Superlative:"JJS",Adjective:"JJ",TO:"Conjunction",Modal:"MD",Auxiliary:"MD",Gerund:"VBG",PastTense:"VBD",Participle:"VBN",PresentTense:"VBZ",Infinitive:"VB",Particle:"RP",Verb:"VB",Pronoun:"PRP",Cardinal:"CD",Conjunction:"CC",Determiner:"DT",Preposition:"IN",QuestionWord:"WP",Expression:"UH",Possessive:"POS",ProperNoun:"NNP",Person:"NNP",Place:"NNP",Organization:"NNP",Singular:"NN",Plural:"NNS",Noun:"NN",There:"EX"},yD={preTagger:function(e){const{methods:t,model:n,world:r}=e;let i=e.docs;!function(e,t,n){e.forEach((e=>{!function(e,t,n,r){const i=r.methods.one.setTag;if(e.length>=3){const t=/:/;if(e[0].post.match(t)){let t=e[1];if(t.tags.has("Value")||t.tags.has("Email")||t.tags.has("PhoneNumber"))return;i([e[0]],"Expression",r,null,"2-punct-colon''")}}}(e,0,0,n)}))}(i,0,r);let s=t.two.quickSplit(i);for(let e=0;e<s.length;e+=1){let t=s[e];const i=dD(t);pD(t,n,r,i),fD(t,n,r,i)}return s},root:function(e){const t=e.world,n=Object.keys(mD);e.docs.forEach((e=>{for(let r=0;r<e.length;r+=1){const i=e[r];for(let e=0;e<n.length;e+=1)if(i.tags.has(n[e])){let r=(0,mD[n[e]])(i,t);i.normal!==r&&(i.root=r);break}}}))},penn:function(e){e.compute("tagRank"),e.docs.forEach((e=>{e.forEach((e=>{e.penn=function(e){if(e.tags.has("ProperNoun")&&e.tags.has("Plural"))return"NNPS";if(e.tags.has("Possessive")&&e.tags.has("Pronoun"))return"PRP$";if("there"===e.normal)return"EX";if("to"===e.normal)return"TO";let t=e.tagRank||[];for(let e=0;e<t.length;e+=1)if(gD.hasOwnProperty(t[e]))return gD[t[e]];return null}(e)}))}))}},vD=["Person","Place","Organization"],bD={Noun:{not:["Verb","Adjective","Adverb","Value","Determiner"]},Singular:{is:"Noun",not:["Plural","Uncountable"]},ProperNoun:{is:"Noun"},Person:{is:"Singular",also:["ProperNoun"],not:["Place","Organization","Date"]},FirstName:{is:"Person"},MaleName:{is:"FirstName",not:["FemaleName","LastName"]},FemaleName:{is:"FirstName",not:["MaleName","LastName"]},LastName:{is:"Person",not:["FirstName"]},Honorific:{is:"Person",not:["FirstName","LastName","Value"]},Place:{is:"Singular",not:["Person","Organization"]},Country:{is:"Place",also:["ProperNoun"],not:["City"]},City:{is:"Place",also:["ProperNoun"],not:["Country"]},Region:{is:"Place",also:["ProperNoun"]},Address:{},Organization:{is:"ProperNoun",not:["Person","Place"]},SportsTeam:{is:"Organization"},School:{is:"Organization"},Company:{is:"Organization"},Plural:{is:"Noun",not:["Singular","Uncountable"]},Uncountable:{is:"Noun"},Pronoun:{is:"Noun",not:vD},Actor:{is:"Noun",not:["Place","Organization"]},Activity:{is:"Noun",not:["Person","Place"]},Unit:{is:"Noun",not:vD},Demonym:{is:"Noun",also:["ProperNoun"],not:vD},Possessive:{is:"Noun"},Reflexive:{is:"Pronoun"}};let wD=Object.assign({},bD,{Verb:{not:["Noun","Adjective","Adverb","Value","Expression"]},PresentTense:{is:"Verb",not:["PastTense","FutureTense"]},Infinitive:{is:"PresentTense",not:["Gerund"]},Imperative:{is:"Verb",not:["PastTense","Gerund","Copula"]},Gerund:{is:"PresentTense",not:["Copula"]},PastTense:{is:"Verb",not:["PresentTense","Gerund","FutureTense"]},FutureTense:{is:"Verb",not:["PresentTense","PastTense"]},Copula:{is:"Verb"},Modal:{is:"Verb",not:["Infinitive"]},Participle:{is:"PastTense"},Auxiliary:{is:"Verb",not:["PastTense","PresentTense","Gerund","Conjunction"]},PhrasalVerb:{is:"Verb"},Particle:{is:"PhrasalVerb",not:["PastTense","PresentTense","Copula","Gerund"]},Passive:{is:"Verb"}},{Value:{not:["Verb","Adjective","Adverb"]},Ordinal:{is:"Value",not:["Cardinal"]},Cardinal:{is:"Value",not:["Ordinal"]},Fraction:{is:"Value",not:["Noun"]},Multiple:{is:"TextValue"},RomanNumeral:{is:"Cardinal",not:["TextValue"]},TextValue:{is:"Value",not:["NumericValue"]},NumericValue:{is:"Value",not:["TextValue"]},Money:{is:"Cardinal"},Percent:{is:"Value"}},{Date:{not:["Verb","Adverb","Adjective"]},Month:{is:"Date",also:["Noun"],not:["Year","WeekDay","Time"]},WeekDay:{is:"Date",also:["Noun"]},Year:{is:"Date",not:["RomanNumeral"]},FinancialQuarter:{is:"Date",not:"Fraction"},Holiday:{is:"Date",also:["Noun"]},Season:{is:"Date"},Timezone:{is:"Date",also:["Noun"],not:["ProperNoun"]},Time:{is:"Date",not:["AtMention"]},Duration:{is:"Date",also:["Noun"]}},{Adjective:{not:["Noun","Verb","Adverb","Value"]},Comparable:{is:"Adjective"},Comparative:{is:"Adjective"},Superlative:{is:"Adjective",not:["Comparative"]},NumberRange:{},Adverb:{not:["Noun","Verb","Adjective","Value"]},Determiner:{not:["Noun","Verb","Adjective","Adverb","QuestionWord","Conjunction"]},Conjunction:{not:["Noun","Verb","Adjective","Adverb","Value","QuestionWord"]},Preposition:{not:["Noun","Verb","Adjective","Adverb","QuestionWord","Determiner"]},QuestionWord:{not:["Determiner"]},Currency:{is:"Noun"},Expression:{not:["Noun","Adjective","Verb","Adverb"]},Abbreviation:{},Url:{not:["HashTag","PhoneNumber","Verb","Adjective","Value","AtMention","Email","SlashedTerm"]},PhoneNumber:{not:["HashTag","Verb","Adjective","Value","AtMention","Email"]},HashTag:{},AtMention:{is:"Noun",not:["HashTag","Email"]},Emoji:{not:["HashTag","Verb","Adjective","Value","AtMention"]},Emoticon:{not:["HashTag","Verb","Adjective","Value","AtMention","SlashedTerm"]},SlashedTerm:{not:["Emoticon","Url","Value"]},Email:{not:["HashTag","Verb","Adjective","Value","AtMention"]},Acronym:{not:["Plural","RomanNumeral","Pronoun","Date"]},Negative:{not:["Noun","Adjective","Value","Expression"]},Condition:{not:["Verb","Adjective","Noun","Value"]},There:{not:["Verb","Adjective","Noun","Value","Conjunction","Preposition"]},Prefix:{not:["Abbreviation","Acronym","ProperNoun"]},Hyphenated:{}});const _D={compute:yD,methods:tj,model:lj,tags:wD,hooks:["preTagger"]},kD=/[,)"';:\-–—.…]/,AD=function(e,t){if(!e.found)return;let n=e.termList();for(let e=0;e<n.length-1;e++){const t=n[e];if(kD.test(t.post))return}n[0].implicit=n[0].normal,n[0].text+=t,n[0].normal+=t,n.slice(1).forEach((e=>{e.implicit=e.normal,e.text="",e.normal=""}));for(let e=0;e<n.length-1;e++)n[e].post=n[e].post.replace(/ /,"")},PD=function(){let e=this.not("@hasContraction"),t=e.match("(we|they|you) are");return AD(t,"'re"),t=e.match("(he|she|they|it|we|you) will"),AD(t,"'ll"),t=e.match("(he|she|they|it|we) is"),AD(t,"'s"),t=e.match("#Person is"),AD(t,"'s"),t=e.match("#Person would"),AD(t,"'d"),t=e.match("(is|was|had|would|should|could|do|does|have|has|can) not"),AD(t,"n't"),t=e.match("(i|we|they) have"),AD(t,"'ve"),t=e.match("(would|should|could) have"),AD(t,"'ve"),t=e.match("i am"),AD(t,"'m"),t=e.match("going to"),this},TD=/^\p{Lu}[\p{Ll}'’]/u,ED=function(e,t,n){let[r,i]=t;n&&0!==n.length&&(n=n.map(((e,t)=>(e.implicit=e.text,e.machine=e.text,e.pre="",e.post="",e.text="",e.normal="",e.index=[r,i+t],e))),n[0]&&(n[0].pre=e[r][i].pre,n[n.length-1].post=e[r][i].post,n[0].text=e[r][i].text,n[0].normal=e[r][i].normal),e[r].splice(i,1,...n))},xD=/'/,ID=new Set(["been","become"]),CD=new Set(["what","how","when","if","too"]);let OD=new Set(["too","also","enough"]);const SD=/'/,ND=new Set(["better","done","before","it","had"]),jD=new Set(["have","be"]),DD={that:!0,there:!0,let:!0,here:!0,everywhere:!0},RD={in:!0,by:!0,for:!0};let $D=new Set(["too","also","enough","about"]),LD=new Set(["is","are","did","were","could","should","must","had","have"]);const MD=/'/,FD=function(e,t,n,r){let i=t.update();i.document=[e];let s=n+r;n>0&&(n-=1),e[s]&&(s+=1),i.ptrs=[[0,n,s]],i.compute(["freeze","lexicon","preTagger","unfreeze"]),function(e){e.forEach(((e,t)=>{e.index&&(e.index[1]=t)}))}(e)},UD={d:(e,t)=>function(e,t){let n=e[t].normal.split(SD)[0];return"how"===n||"what"===n?[n,"did"]:"had"===((e,t)=>{for(let n=t+1;n<e.length;n+=1){let t=e[n];if(ND.has(t.normal))return"had";if(jD.has(t.normal))return"would";if(t.tags.has("PastTense")||"Adj|Past"===t.switch)return"had";if(t.tags.has("PresentTense")||t.tags.has("Infinitive"))return"would";if(t.tags.has("#Determiner"))return"had";if(t.tags.has("Adjective"))return"would"}return!1})(e,t)?[n,"had"]:[n,"would"]}(e,t),t:(e,t)=>function(e,t){if("ain't"===e[t].normal||"aint"===e[t].normal){if(e[t+1]&&"never"===e[t+1].normal)return["have"];let n=function(e,t){for(let n=t-1;n>=0;n-=1)if(e[n].tags.has("Noun")||e[n].tags.has("Pronoun")||e[n].tags.has("Plural")||e[n].tags.has("Singular"))return e[n];return null}(e,t);if(n){if("we"===n.normal||"they"===n.normal)return["are","not"];if("i"===n.normal)return["am","not"];if(n.tags&&n.tags.has("Plural"))return["are","not"]}return["is","not"]}return[e[t].normal.replace(/n't/,""),"not"]}(e,t),s:(e,t,n)=>((e,t)=>{let n=e[t];if(DD.hasOwnProperty(n.machine||n.normal))return!1;if(n.tags.has("Possessive"))return!0;if(n.tags.has("QuestionWord"))return!1;if("he's"===n.normal||"she's"===n.normal)return!1;let r=e[t+1];if(!r)return!0;if("it's"===n.normal)return!!r.tags.has("#Noun");if("Noun|Gerund"==r.switch){let r=e[t+2];return r?!!r.tags.has("Copula")||("on"===r.normal||r.normal,!1):!(!n.tags.has("Actor")&&!n.tags.has("ProperNoun"))}if(r.tags.has("Verb"))return!!r.tags.has("Infinitive")||!r.tags.has("Gerund")&&!!r.tags.has("PresentTense");if("Adj|Noun"===r.switch){let n=e[t+2];if(!n)return!1;if(LD.has(n.normal))return!0;if($D.has(n.normal))return!1}if(r.tags.has("Noun")){let e=r.machine||r.normal;return!("here"===e||"there"===e||"everywhere"===e||r.tags.has("Possessive")||r.tags.has("ProperNoun")&&!n.tags.has("ProperNoun"))}if(e[t-1]&&!0===RD[e[t-1].normal])return!0;if(r.tags.has("Adjective")){let n=e[t+2];if(!n)return!1;if(n.tags.has("Noun")&&!n.tags.has("Pronoun")){let e=r.normal;return"above"!==e&&"below"!==e&&"behind"!==e}return"Noun|Verb"===n.switch}return!!r.tags.has("Value")})(e,t)?n.methods.one.setTag([e[t]],"Possessive",n,null,"2-contraction"):function(e,t){let n=e[t].normal.split(xD)[0];if("let"===n)return[n,"us"];if("there"===n){let r=e[t+1];if(r&&r.tags.has("Plural"))return[n,"are"]}return"has"===((e,t)=>{for(let n=t+1;n<e.length;n+=1){let t=e[n];if(ID.has(t.normal))return"has";if(CD.has(t.normal))return"is";if(t.tags.has("Gerund"))return"is";if(t.tags.has("Determiner"))return"is";if(t.tags.has("Adjective"))return"is";if("Adj|Past"===t.switch&&e[n+1]){if(OD.has(e[n+1].normal))return"is";if(e[n+1].tags.has("Preposition"))return"is"}if(t.tags.has("PastTense"))return e[n+1]&&"for"===e[n+1].normal?"is":"has"}return"is"})(e,t)?[n,"has"]:[n,"is"]}(e,t)},BD=function(e,t){let n=t.fromText(e.join(" "));return n.compute("id"),n.docs[0]},VD={contractionTwo:e=>{let{world:t,document:n}=e;n.forEach(((r,i)=>{for(let s=r.length-1;s>=0;s-=1){if(r[s].implicit)continue;let a=null;!0===MD.test(r[s].normal)&&(a=r[s].normal.split(MD)[1]);let o=null;UD.hasOwnProperty(a)&&(o=UD[a](r,s,t)),o&&(o=BD(o,e),ED(n,[i,s],o),FD(n[i],e,s,o.length))}}))}},zD={compute:VD,api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Contraction"}expand(){return this.docs.forEach((e=>{let t=TD.test(e[0].text);e.forEach(((t,n)=>{t.text=t.implicit||"",delete t.implicit,n<e.length-1&&""===t.post&&(t.post+=" "),t.dirty=!0})),t&&(e[0].text=function(e=""){return e.replace(/^ *[a-z\u00C0-\u00FF]/,(e=>e.toUpperCase()))}(e[0].text))})),this.compute("normal"),this}}e.prototype.contractions=function(){let e=this.match("@hasContraction+");return new t(this.document,e.pointer)},e.prototype.contract=PD},hooks:["contractionTwo"]},HD="(hard|fast|late|early|high|right|deep|close|direct)",GD="(i|we|they)";let qD=[].concat([{match:"(got|were|was|is|are|am) (#PastTense|#Participle)",tag:"Passive",reason:"got-walked"},{match:"(was|were|is|are|am) being (#PastTense|#Participle)",tag:"Passive",reason:"was-being"},{match:"(had|have|has) been (#PastTense|#Participle)",tag:"Passive",reason:"had-been"},{match:"will be being? (#PastTense|#Participle)",tag:"Passive",reason:"will-be-cleaned"},{match:"#Noun [(#PastTense|#Participle)] by (the|a) #Noun",group:0,tag:"Passive",reason:"suffered-by"}],[{match:"[(all|both)] #Determiner #Noun",group:0,tag:"Noun",reason:"all-noun"},{match:"#Copula [(just|alone)]$",group:0,tag:"Adjective",reason:"not-adverb"},{match:"#Singular is #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"is-filled"},{match:"[#PastTense] #Singular is",group:0,tag:"Adjective",reason:"smoked-poutine"},{match:"[#PastTense] #Plural are",group:0,tag:"Adjective",reason:"baked-onions"},{match:"well [#PastTense]",group:0,tag:"Adjective",reason:"well-made"},{match:"#Copula [fucked up?]",group:0,tag:"Adjective",reason:"swears-adjective"},{match:"#Singular (seems|appears) #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"seems-filled"},{match:"#Copula #Adjective? [(out|in|through)]$",group:0,tag:"Adjective",reason:"still-out"},{match:"^[#Adjective] (the|your) #Noun",group:0,notIf:"(all|even)",tag:"Infinitive",reason:"shut-the"},{match:"the [said] #Noun",group:0,tag:"Adjective",reason:"the-said-card"},{match:"[#Hyphenated (#Hyphenated && #PastTense)] (#Noun|#Conjunction)",group:0,tag:"Adjective",notIf:"#Adverb",reason:"faith-based"},{match:"[#Hyphenated (#Hyphenated && #Gerund)] (#Noun|#Conjunction)",group:0,tag:"Adjective",notIf:"#Adverb",reason:"self-driving"},{match:"[#PastTense (#Hyphenated && #PhrasalVerb)] (#Noun|#Conjunction)",group:0,tag:"Adjective",reason:"dammed-up"},{match:"(#Hyphenated && #Value) fold",tag:"Adjective",reason:"two-fold"},{match:"must (#Hyphenated && #Infinitive)",tag:"Adjective",reason:"must-win"},{match:"(#Hyphenated && #Infinitive) #Hyphenated",tag:"Adjective",notIf:"#PhrasalVerb",reason:"vacuum-sealed"},{match:"too much",tag:"Adverb Adjective",reason:"bit-4"},{match:"a bit much",tag:"Determiner Adverb Adjective",reason:"bit-3"},{match:"[(un|contra|extra|inter|intra|macro|micro|mid|mis|mono|multi|pre|sub|tri|ex)] #Adjective",group:0,tag:["Adjective","Prefix"],reason:"un-skilled"}],[{match:"#Adverb [#Adverb] (and|or|then)",group:0,tag:"Adjective",reason:"kinda-sparkly-and"},{match:"[(dark|bright|flat|light|soft|pale|dead|dim|faux|little|wee|sheer|most|near|good|extra|all)] #Adjective",group:0,tag:"Adverb",reason:"dark-green"},{match:"#Copula [far too] #Adjective",group:0,tag:"Adverb",reason:"far-too"},{match:"#Copula [still] (in|#Gerund|#Adjective)",group:0,tag:"Adverb",reason:"was-still-walking"},{match:`#Plural ${HD}`,tag:"#PresentTense #Adverb",reason:"studies-hard"},{match:`#Verb [${HD}] !#Noun?`,group:0,notIf:"(#Copula|get|got|getting|become|became|becoming|feel|feels|feeling|#Determiner|#Preposition)",tag:"Adverb",reason:"shops-direct"},{match:"[#Plural] a lot",tag:"PresentTense",reason:"studies-a-lot"}],[{match:"as [#Gerund] as",group:0,tag:"Adjective",reason:"as-gerund-as"},{match:"more [#Gerund] than",group:0,tag:"Adjective",reason:"more-gerund-than"},{match:"(so|very|extremely) [#Gerund]",group:0,tag:"Adjective",reason:"so-gerund"},{match:"(found|found) it #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"found-it-gerund"},{match:"a (little|bit|wee) bit? [#Gerund]",group:0,tag:"Adjective",reason:"a-bit-gerund"},{match:"#Gerund [#Gerund]",group:0,tag:"Adjective",notIf:"(impersonating|practicing|considering|assuming)",reason:"looking-annoying"},{match:"(looked|look|looks) #Adverb? [%Adj|Gerund%]",group:0,tag:"Adjective",notIf:"(impersonating|practicing|considering|assuming)",reason:"looked-amazing"},{match:"[%Adj|Gerund%] #Determiner",group:0,tag:"Gerund",reason:"developing-a"},{match:"#Possessive [%Adj|Gerund%] #Noun",group:0,tag:"Adjective",reason:"leading-manufacturer"},{match:"%Noun|Gerund% %Adj|Gerund%",tag:"Gerund #Adjective",reason:"meaning-alluring"},{match:"(face|embrace|reveal|stop|start|resume) %Adj|Gerund%",tag:"#PresentTense #Adjective",reason:"face-shocking"},{match:"(are|were) [%Adj|Gerund%] #Plural",group:0,tag:"Adjective",reason:"are-enduring-symbols"}],[{match:"#Determiner [#Adjective] #Copula",group:0,tag:"Noun",reason:"the-adj-is"},{match:"#Adjective [#Adjective] #Copula",group:0,tag:"Noun",reason:"adj-adj-is"},{match:"(his|its) [%Adj|Noun%]",group:0,tag:"Noun",notIf:"#Hyphenated",reason:"his-fine"},{match:"#Copula #Adverb? [all]",group:0,tag:"Noun",reason:"is-all"},{match:"(have|had) [#Adjective] #Preposition .",group:0,tag:"Noun",reason:"have-fun"},{match:"#Gerund (giant|capital|center|zone|application)",tag:"Noun",reason:"brewing-giant"},{match:"#Preposition (a|an) [#Adjective]$",group:0,tag:"Noun",reason:"an-instant"},{match:"no [#Adjective] #Modal",group:0,tag:"Noun",reason:"no-golden"},{match:"[brand #Gerund?] new",group:0,tag:"Adverb",reason:"brand-new"},{match:"(#Determiner|#Comparative|new|different) [kind]",group:0,tag:"Noun",reason:"some-kind"},{match:"#Possessive [%Adj|Noun%] #Noun",group:0,tag:"Adjective",reason:"her-favourite"},{match:"must && #Hyphenated .",tag:"Adjective",reason:"must-win"},{match:"#Determiner [#Adjective]$",tag:"Noun",notIf:"(this|that|#Comparative|#Superlative)",reason:"the-south"},{match:"(#Noun && #Hyphenated) (#Adjective && #Hyphenated)",tag:"Adjective",notIf:"(this|that|#Comparative|#Superlative)",reason:"company-wide"},{match:"#Determiner [#Adjective] (#Copula|#Determiner)",notIf:"(#Comparative|#Superlative)",group:0,tag:"Noun",reason:"the-poor"},{match:"[%Adj|Noun%] #Noun",notIf:"(#Pronoun|#ProperNoun)",group:0,tag:"Adjective",reason:"stable-foundations"}],[{match:"[still] #Adjective",group:0,tag:"Adverb",reason:"still-advb"},{match:"[still] #Verb",group:0,tag:"Adverb",reason:"still-verb"},{match:"[so] #Adjective",group:0,tag:"Adverb",reason:"so-adv"},{match:"[way] #Comparative",group:0,tag:"Adverb",reason:"way-adj"},{match:"[way] #Adverb #Adjective",group:0,tag:"Adverb",reason:"way-too-adj"},{match:"[all] #Verb",group:0,tag:"Adverb",reason:"all-verb"},{match:"#Verb  [like]",group:0,notIf:"(#Modal|#PhrasalVerb)",tag:"Adverb",reason:"verb-like"},{match:"(barely|hardly) even",tag:"Adverb",reason:"barely-even"},{match:"[even] #Verb",group:0,tag:"Adverb",reason:"even-walk"},{match:"[even] #Comparative",group:0,tag:"Adverb",reason:"even-worse"},{match:"[even] (#Determiner|#Possessive)",group:0,tag:"#Adverb",reason:"even-the"},{match:"even left",tag:"#Adverb #Verb",reason:"even-left"},{match:"[way] #Adjective",group:0,tag:"#Adverb",reason:"way-over"},{match:"#PresentTense [(hard|quick|bright|slow|fast|backwards|forwards)]",notIf:"#Copula",group:0,tag:"Adverb",reason:"lazy-ly"},{match:"[much] #Adjective",group:0,tag:"Adverb",reason:"bit-1"},{match:"#Copula [#Adverb]$",group:0,tag:"Adjective",reason:"is-well"},{match:"a [(little|bit|wee) bit?] #Adjective",group:0,tag:"Adverb",reason:"a-bit-cold"},{match:"[(super|pretty)] #Adjective",group:0,tag:"Adverb",reason:"super-strong"},{match:"(become|fall|grow) #Adverb? [#PastTense]",group:0,tag:"Adjective",reason:"overly-weakened"},{match:"(a|an) #Adverb [#Participle] #Noun",group:0,tag:"Adjective",reason:"completely-beaten"},{match:"#Determiner #Adverb? [close]",group:0,tag:"Adjective",reason:"a-close"},{match:"#Gerund #Adverb? [close]",group:0,tag:"Adverb",notIf:"(getting|becoming|feeling)",reason:"being-close"},{match:"(the|those|these|a|an) [#Participle] #Noun",group:0,tag:"Adjective",reason:"blown-motor"},{match:"(#PresentTense|#PastTense) [back]",group:0,tag:"Adverb",notIf:"(#PhrasalVerb|#Copula)",reason:"charge-back"},{match:"#Verb [around]",group:0,tag:"Adverb",notIf:"#PhrasalVerb",reason:"send-around"},{match:"[later] #PresentTense",group:0,tag:"Adverb",reason:"later-say"},{match:"#Determiner [well] !#PastTense?",group:0,tag:"Noun",reason:"the-well"},{match:"#Adjective [enough]",group:0,tag:"Adverb",reason:"high-enough"}],[{match:"[sun] the #Ordinal",tag:"WeekDay",reason:"sun-the-5th"},{match:"[sun] #Date",group:0,tag:"WeekDay",reason:"sun-feb"},{match:"#Date (on|this|next|last|during)? [sun]",group:0,tag:"WeekDay",reason:"1pm-sun"},{match:"(in|by|before|during|on|until|after|of|within|all) [sat]",group:0,tag:"WeekDay",reason:"sat"},{match:"(in|by|before|during|on|until|after|of|within|all) [wed]",group:0,tag:"WeekDay",reason:"wed"},{match:"(in|by|before|during|on|until|after|of|within|all) [march]",group:0,tag:"Month",reason:"march"},{match:"[sat] #Date",group:0,tag:"WeekDay",reason:"sat-feb"},{match:"#Preposition [(march|may)]",group:0,tag:"Month",reason:"in-month"},{match:"(this|next|last) (march|may) !#Infinitive?",tag:"#Date #Month",reason:"this-month"},{match:"(march|may) the? #Value",tag:"#Month #Date #Date",reason:"march-5th"},{match:"#Value of? (march|may)",tag:"#Date #Date #Month",reason:"5th-of-march"},{match:"[(march|may)] .? #Date",group:0,tag:"Month",reason:"march-and-feb"},{match:"#Date .? [(march|may)]",group:0,tag:"Month",reason:"feb-and-march"},{match:"#Adverb [(march|may)]",group:0,tag:"Verb",reason:"quickly-march"},{match:"[(march|may)] #Adverb",group:0,tag:"Verb",reason:"march-quickly"},{match:"#Value (am|pm)",tag:"Time",reason:"2-am"}],[{match:"#Holiday (day|eve)",tag:"Holiday",reason:"holiday-day"},{match:"#Value of #Month",tag:"Date",reason:"value-of-month"},{match:"#Cardinal #Month",tag:"Date",reason:"cardinal-month"},{match:"#Month #Value to #Value",tag:"Date",reason:"value-to-value"},{match:"#Month the #Value",tag:"Date",reason:"month-the-value"},{match:"(#WeekDay|#Month) #Value",tag:"Date",reason:"date-value"},{match:"#Value (#WeekDay|#Month)",tag:"Date",reason:"value-date"},{match:"(#TextValue && #Date) #TextValue",tag:"Date",reason:"textvalue-date"},{match:"#Month #NumberRange",tag:"Date",reason:"aug 20-21"},{match:"#WeekDay #Month #Ordinal",tag:"Date",reason:"week mm-dd"},{match:"#Month #Ordinal #Cardinal",tag:"Date",reason:"mm-dd-yyy"},{match:"(#Place|#Demonmym|#Time) (standard|daylight|central|mountain)? time",tag:"Timezone",reason:"std-time"},{match:"(eastern|mountain|pacific|central|atlantic) (standard|daylight|summer)? time",tag:"Timezone",reason:"eastern-time"},{match:"#Time [(eastern|mountain|pacific|central|est|pst|gmt)]",group:0,tag:"Timezone",reason:"5pm-central"},{match:"(central|western|eastern) european time",tag:"Timezone",reason:"cet"}],[{match:"(the|any) [more]",group:0,tag:"Singular",reason:"more-noun"},{match:"[more] #Noun",group:0,tag:"Adjective",reason:"more-noun"},{match:"(right|rights) of .",tag:"Noun",reason:"right-of"},{match:"a [bit]",group:0,tag:"Singular",reason:"bit-2"},{match:"a [must]",group:0,tag:"Singular",reason:"must-2"},{match:"(we|us) [all]",group:0,tag:"Noun",reason:"we all"},{match:"due to [#Verb]",group:0,tag:"Noun",reason:"due-to"},{match:"some [#Verb] #Plural",group:0,tag:"Noun",reason:"determiner6"},{match:"#Possessive #Ordinal [#PastTense]",group:0,tag:"Noun",reason:"first-thought"},{match:"(the|this|those|these) #Adjective [%Verb|Noun%]",group:0,tag:"Noun",notIf:"#Copula",reason:"the-adj-verb"},{match:"(the|this|those|these) #Adverb #Adjective [#Verb]",group:0,tag:"Noun",reason:"determiner4"},{match:"the [#Verb] #Preposition .",group:0,tag:"Noun",reason:"determiner1"},{match:"(a|an|the) [#Verb] of",group:0,tag:"Noun",reason:"the-verb-of"},{match:"#Determiner #Noun of [#Verb]",group:0,tag:"Noun",notIf:"#Gerund",reason:"noun-of-noun"},{match:"#PastTense #Preposition [#PresentTense]",group:0,notIf:"#Gerund",tag:"Noun",reason:"ended-in-ruins"},{match:"#Conjunction [u]",group:0,tag:"Pronoun",reason:"u-pronoun-2"},{match:"[u] #Verb",group:0,tag:"Pronoun",reason:"u-pronoun-1"},{match:"#Determiner [(western|eastern|northern|southern|central)] #Noun",group:0,tag:"Noun",reason:"western-line"},{match:"(#Singular && @hasHyphen) #PresentTense",tag:"Noun",reason:"hyphen-verb"},{match:"is no [#Verb]",group:0,tag:"Noun",reason:"is-no-verb"},{match:"do [so]",group:0,tag:"Noun",reason:"so-noun"},{match:"#Determiner [(shit|damn|hell)]",group:0,tag:"Noun",reason:"swears-noun"},{match:"to [(shit|hell)]",group:0,tag:"Noun",reason:"to-swears"},{match:"(the|these) [#Singular] (were|are)",group:0,tag:"Plural",reason:"singular-were"},{match:"a #Noun+ or #Adverb+? [#Verb]",group:0,tag:"Noun",reason:"noun-or-noun"},{match:"(the|those|these|a|an) #Adjective? [#PresentTense #Particle?]",group:0,tag:"Noun",notIf:"(seem|appear|include|#Gerund|#Copula)",reason:"det-inf"},{match:"#Noun #Actor",tag:"Actor",notIf:"(#Person|#Pronoun)",reason:"thing-doer"},{match:"#Gerund #Actor",tag:"Actor",reason:"gerund-doer"},{match:"co #Singular",tag:"Actor",reason:"co-noun"},{match:"[#Noun+] #Actor",group:0,tag:"Actor",notIf:"(#Honorific|#Pronoun|#Possessive)",reason:"air-traffic-controller"},{match:"(urban|cardiac|cardiovascular|respiratory|medical|clinical|visual|graphic|creative|dental|exotic|fine|certified|registered|technical|virtual|professional|amateur|junior|senior|special|pharmaceutical|theoretical)+ #Noun? #Actor",tag:"Actor",reason:"fine-artist"},{match:"#Noun+ (coach|chef|king|engineer|fellow|personality|boy|girl|man|woman|master)",tag:"Actor",reason:"dance-coach"},{match:"chief . officer",tag:"Actor",reason:"chief-x-officer"},{match:"chief of #Noun+",tag:"Actor",reason:"chief-of-police"},{match:"senior? vice? president of #Noun+",tag:"Actor",reason:"president-of"},{match:"#Determiner [sun]",group:0,tag:"Singular",reason:"the-sun"},{match:"#Verb (a|an) [#Value]$",group:0,tag:"Singular",reason:"did-a-value"},{match:"the [(can|will|may)]",group:0,tag:"Singular",reason:"the can"},{match:"#FirstName #Acronym? (#Possessive && #LastName)",tag:"Possessive",reason:"name-poss"},{match:"#Organization+ #Possessive",tag:"Possessive",reason:"org-possessive"},{match:"#Place+ #Possessive",tag:"Possessive",reason:"place-possessive"},{match:"#Possessive #PresentTense #Particle?",notIf:"(#Gerund|her)",tag:"Noun",reason:"possessive-verb"},{match:"(my|our|their|her|his|its) [(#Plural && #Actor)] #Noun",tag:"Possessive",reason:"my-dads"},{match:"#Value of a [second]",group:0,unTag:"Value",tag:"Singular",reason:"10th-of-a-second"},{match:"#Value [seconds]",group:0,unTag:"Value",tag:"Plural",reason:"10-seconds"},{match:"in [#Infinitive]",group:0,tag:"Singular",reason:"in-age"},{match:"a [#Adjective] #Preposition",group:0,tag:"Noun",reason:"a-minor-in"},{match:"#Determiner [#Singular] said",group:0,tag:"Actor",reason:"the-actor-said"},{match:"#Determiner #Noun [(feel|sense|process|rush|side|bomb|bully|challenge|cover|crush|dump|exchange|flow|function|issue|lecture|limit|march|process)] !(#Preposition|to|#Adverb)?",group:0,tag:"Noun",reason:"the-noun-sense"},{match:"[#PresentTense] (of|by|for) (a|an|the) #Noun #Copula",group:0,tag:"Plural",reason:"photographs-of"},{match:"#Infinitive and [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"fight and win"},{match:"#Noun and [#Verb] and #Noun",group:0,tag:"Noun",reason:"peace-and-flowers"},{match:"the #Cardinal [%Adj|Noun%]",group:0,tag:"Noun",reason:"the-1992-classic"},{match:"#Copula the [%Adj|Noun%] #Noun",group:0,tag:"Adjective",reason:"the-premier-university"},{match:"i #Verb [me] #Noun",group:0,tag:"Possessive",reason:"scottish-me"},{match:"[#PresentTense] (music|class|lesson|night|party|festival|league|ceremony)",group:0,tag:"Noun",reason:"dance-music"},{match:"[wit] (me|it)",group:0,tag:"Presposition",reason:"wit-me"},{match:"#PastTense #Possessive [#Verb]",group:0,tag:"Noun",notIf:"(saw|made)",reason:"left-her-boots"},{match:"#Value [%Plural|Verb%]",group:0,tag:"Plural",notIf:"(one|1|a|an)",reason:"35-signs"},{match:"had [#PresentTense]",group:0,tag:"Noun",notIf:"(#Gerund|come|become)",reason:"had-time"},{match:"%Adj|Noun% %Noun|Verb%",tag:"#Adjective #Noun",notIf:"#ProperNoun #Noun",reason:"instant-access"},{match:"#Determiner [%Adj|Noun%] #Conjunction",group:0,tag:"Noun",reason:"a-rep-to"},{match:"#Adjective #Noun [%Plural|Verb%]$",group:0,tag:"Plural",notIf:"#Pronoun",reason:"near-death-experiences"},{match:"#Possessive #Noun [%Plural|Verb%]$",group:0,tag:"Plural",reason:"your-guild-colors"}],[{match:"(this|that|the|a|an) [#Gerund #Infinitive]",group:0,tag:"Singular",reason:"the-planning-process"},{match:"(that|the) [#Gerund #PresentTense]",group:0,ifNo:"#Copula",tag:"Plural",reason:"the-paving-stones"},{match:"#Determiner [#Gerund] #Noun",group:0,tag:"Adjective",reason:"the-gerund-noun"},{match:"#Pronoun #Infinitive [#Gerund] #PresentTense",group:0,tag:"Noun",reason:"tipping-sucks"},{match:"#Adjective [#Gerund]",group:0,tag:"Noun",notIf:"(still|even|just)",reason:"early-warning"},{match:"[#Gerund] #Adverb? not? #Copula",group:0,tag:"Activity",reason:"gerund-copula"},{match:"#Copula [(#Gerund|#Activity)] #Copula",group:0,tag:"Gerund",reason:"are-doing-is"},{match:"[#Gerund] #Modal",group:0,tag:"Activity",reason:"gerund-modal"},{match:"#Singular for [%Noun|Gerund%]",group:0,tag:"Gerund",reason:"noun-for-gerund"},{match:"#Comparative (for|at) [%Noun|Gerund%]",group:0,tag:"Gerund",reason:"better-for-gerund"},{match:"#PresentTense the [#Gerund]",group:0,tag:"Noun",reason:"keep-the-touching"}],[{match:"#Infinitive (this|that|the) [#Infinitive]",group:0,tag:"Noun",reason:"do-this-dance"},{match:"#Gerund #Determiner [#Infinitive]",group:0,tag:"Noun",reason:"running-a-show"},{match:"#Determiner (only|further|just|more|backward) [#Infinitive]",group:0,tag:"Noun",reason:"the-only-reason"},{match:"(the|this|a|an) [#Infinitive] #Adverb? #Verb",group:0,tag:"Noun",reason:"determiner5"},{match:"#Determiner #Adjective #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"a-nice-inf"},{match:"#Determiner #Demonym [#PresentTense]",group:0,tag:"Noun",reason:"mexican-train"},{match:"#Adjective #Noun+ [#Infinitive] #Copula",group:0,tag:"Noun",reason:"career-move"},{match:"at some [#Infinitive]",group:0,tag:"Noun",reason:"at-some-inf"},{match:"(go|goes|went) to [#Infinitive]",group:0,tag:"Noun",reason:"goes-to-verb"},{match:"(a|an) #Adjective? #Noun [#Infinitive] (#Preposition|#Noun)",group:0,notIf:"from",tag:"Noun",reason:"a-noun-inf"},{match:"(a|an) #Noun [#Infinitive]$",group:0,tag:"Noun",reason:"a-noun-inf2"},{match:"#Gerund #Adjective? for [#Infinitive]",group:0,tag:"Noun",reason:"running-for"},{match:"about [#Infinitive]",group:0,tag:"Singular",reason:"about-love"},{match:"#Plural on [#Infinitive]",group:0,tag:"Noun",reason:"on-stage"},{match:"any [#Infinitive]",group:0,tag:"Noun",reason:"any-charge"},{match:"no [#Infinitive]",group:0,tag:"Noun",reason:"no-doubt"},{match:"number of [#PresentTense]",group:0,tag:"Noun",reason:"number-of-x"},{match:"(taught|teaches|learns|learned) [#PresentTense]",group:0,tag:"Noun",reason:"teaches-x"},{match:"(try|use|attempt|build|make) [#Verb #Particle?]",notIf:"(#Copula|#Noun|sure|fun|up)",group:0,tag:"Noun",reason:"do-verb"},{match:"^[#Infinitive] (is|was)",group:0,tag:"Noun",reason:"checkmate-is"},{match:"#Infinitive much [#Infinitive]",group:0,tag:"Noun",reason:"get-much"},{match:"[cause] #Pronoun #Verb",group:0,tag:"Conjunction",reason:"cause-cuz"},{match:"the #Singular [#Infinitive] #Noun",group:0,tag:"Noun",notIf:"#Pronoun",reason:"cardio-dance"},{match:"#Determiner #Modal [#Noun]",group:0,tag:"PresentTense",reason:"should-smoke"},{match:"this [#Plural]",group:0,tag:"PresentTense",notIf:"(#Preposition|#Date)",reason:"this-verbs"},{match:"#Noun that [#Plural]",group:0,tag:"PresentTense",notIf:"(#Preposition|#Pronoun|way)",reason:"voice-that-rocks"},{match:"that [#Plural] to",group:0,tag:"PresentTense",notIf:"#Preposition",reason:"that-leads-to"},{match:"(let|make|made) (him|her|it|#Person|#Place|#Organization)+ [#Singular] (a|an|the|it)",group:0,tag:"Infinitive",reason:"let-him-glue"},{match:"#Verb (all|every|each|most|some|no) [#PresentTense]",notIf:"#Modal",group:0,tag:"Noun",reason:"all-presentTense"},{match:"(had|have|#PastTense) #Adjective [#PresentTense]",group:0,tag:"Noun",notIf:"better",reason:"adj-presentTense"},{match:"#Value #Adjective [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"one-big-reason"},{match:"#PastTense #Adjective+ [#PresentTense]",group:0,tag:"Noun",notIf:"(#Copula|better)",reason:"won-wide-support"},{match:"(many|few|several|couple) [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"many-poses"},{match:"#Determiner #Adverb #Adjective [%Noun|Verb%]",group:0,tag:"Noun",notIf:"#Copula",reason:"very-big-dream"},{match:"from #Noun to [%Noun|Verb%]",group:0,tag:"Noun",reason:"start-to-finish"},{match:"(for|with|of) #Noun (and|or|not) [%Noun|Verb%]",group:0,tag:"Noun",notIf:"#Pronoun",reason:"for-food-and-gas"},{match:"#Adjective #Adjective [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"adorable-little-store"},{match:"#Gerund #Adverb? #Comparative [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"higher-costs"},{match:"(#Noun && @hasComma) #Noun (and|or) [#PresentTense]",group:0,tag:"Noun",notIf:"#Copula",reason:"noun-list"},{match:"(many|any|some|several) [#PresentTense] for",group:0,tag:"Noun",reason:"any-verbs-for"},{match:"to #PresentTense #Noun [#PresentTense] #Preposition",group:0,tag:"Noun",reason:"gas-exchange"},{match:"#PastTense (until|as|through|without) [#PresentTense]",group:0,tag:"Noun",reason:"waited-until-release"},{match:"#Gerund like #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"like-hot-cakes"},{match:"some #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"some-reason"},{match:"for some [#PresentTense]",group:0,tag:"Noun",reason:"for-some-reason"},{match:"(same|some|the|that|a) kind of [#PresentTense]",group:0,tag:"Noun",reason:"some-kind-of"},{match:"(same|some|the|that|a) type of [#PresentTense]",group:0,tag:"Noun",reason:"some-type-of"},{match:"#Gerund #Adjective #Preposition [#PresentTense]",group:0,tag:"Noun",reason:"doing-better-for-x"},{match:"(get|got|have) #Comparative [#PresentTense]",group:0,tag:"Noun",reason:"got-better-aim"},{match:"whose [#PresentTense] #Copula",group:0,tag:"Noun",reason:"whos-name-was"},{match:"#PhrasalVerb #Particle #Preposition [#PresentTense]",group:0,tag:"Noun",reason:"given-up-on-x"},{match:"there (are|were) #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"there-are"},{match:"#Value [#PresentTense] of",group:0,notIf:"(one|1|#Copula|#Infinitive)",tag:"Plural",reason:"2-trains"},{match:"[#PresentTense] (are|were) #Adjective",group:0,tag:"Plural",reason:"compromises-are-possible"},{match:"^[(hope|guess|thought|think)] #Pronoun #Verb",group:0,tag:"Infinitive",reason:"suppose-i"},{match:"#Possessive #Adjective [#Verb]",group:0,tag:"Noun",notIf:"#Copula",reason:"our-full-support"},{match:"[(tastes|smells)] #Adverb? #Adjective",group:0,tag:"PresentTense",reason:"tastes-good"},{match:"#Copula #Gerund [#PresentTense] !by?",group:0,tag:"Noun",notIf:"going",reason:"ignoring-commute"},{match:"#Determiner #Adjective? [(shed|thought|rose|bid|saw|spelt)]",group:0,tag:"Noun",reason:"noun-past"},{match:"how to [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"how-to-noun"},{match:"which [%Noun|Verb%] #Noun",group:0,tag:"Infinitive",reason:"which-boost-it"},{match:"#Gerund [%Plural|Verb%]",group:0,tag:"Plural",reason:"asking-questions"},{match:"(ready|available|difficult|hard|easy|made|attempt|try) to [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"ready-to-noun"},{match:"(bring|went|go|drive|run|bike) to [%Noun|Verb%]",group:0,tag:"Noun",reason:"bring-to-noun"},{match:"#Modal #Noun [%Noun|Verb%]",group:0,tag:"Infinitive",reason:"would-you-look"},{match:"#Copula just [#Infinitive]",group:0,tag:"Noun",reason:"is-just-spam"},{match:"^%Noun|Verb% %Plural|Verb%",tag:"Imperative #Plural",reason:"request-copies"},{match:"#Adjective #Plural and [%Plural|Verb%]",group:0,tag:"#Plural",reason:"pickles-and-drinks"},{match:"#Determiner #Year [#Verb]",group:0,tag:"Noun",reason:"the-1968-film"},{match:"#Determiner [#PhrasalVerb #Particle]",group:0,tag:"Noun",reason:"the-break-up"},{match:"#Determiner [%Adj|Noun%] #Noun",group:0,tag:"Adjective",notIf:"(#Pronoun|#Possessive|#ProperNoun)",reason:"the-individual-goals"},{match:"[%Noun|Verb%] or #Infinitive",group:0,tag:"Infinitive",reason:"work-or-prepare"},{match:"to #Infinitive [#PresentTense]",group:0,tag:"Noun",notIf:"(#Gerund|#Copula|help)",reason:"to-give-thanks"},{match:"[#Noun] me",group:0,tag:"Verb",reason:"kills-me"},{match:"%Plural|Verb% %Plural|Verb%",tag:"#PresentTense #Plural",reason:"removes-wrinkles"}],[{match:"#Money and #Money #Currency?",tag:"Money",reason:"money-and-money"},{match:"#Value #Currency [and] #Value (cents|ore|centavos|sens)",group:0,tag:"money",reason:"and-5-cents"},{match:"#Value (mark|rand|won|rub|ore)",tag:"#Money #Currency",reason:"4-mark"},{match:"a pound",tag:"#Money #Unit",reason:"a-pound"},{match:"#Value (pound|pounds)",tag:"#Money #Unit",reason:"4-pounds"}],[{match:"[(half|quarter)] of? (a|an)",group:0,tag:"Fraction",reason:"millionth"},{match:"#Adverb [half]",group:0,tag:"Fraction",reason:"nearly-half"},{match:"[half] the",group:0,tag:"Fraction",reason:"half-the"},{match:"#Cardinal and a half",tag:"Fraction",reason:"and-a-half"},{match:"#Value (halves|halfs|quarters)",tag:"Fraction",reason:"two-halves"},{match:"a #Ordinal",tag:"Fraction",reason:"a-quarter"},{match:"[#Cardinal+] (#Fraction && /s$/)",tag:"Fraction",reason:"seven-fifths"},{match:"[#Cardinal+ #Ordinal] of .",group:0,tag:"Fraction",reason:"ordinal-of"},{match:"[(#NumericValue && #Ordinal)] of .",group:0,tag:"Fraction",reason:"num-ordinal-of"},{match:"(a|one) #Cardinal?+ #Ordinal",tag:"Fraction",reason:"a-ordinal"},{match:"#Cardinal+ out? of every? #Cardinal",tag:"Fraction",reason:"out-of"}],[{match:"#Cardinal [second]",tag:"Unit",reason:"one-second"},{match:"!once? [(a|an)] (#Duration|hundred|thousand|million|billion|trillion)",group:0,tag:"Value",reason:"a-is-one"},{match:"1 #Value #PhoneNumber",tag:"PhoneNumber",reason:"1-800-Value"},{match:"#NumericValue #PhoneNumber",tag:"PhoneNumber",reason:"(800) PhoneNumber"},{match:"#Demonym #Currency",tag:"Currency",reason:"demonym-currency"},{match:"#Value [(buck|bucks|grand)]",group:0,tag:"Currency",reason:"value-bucks"},{match:"[#Value+] #Currency",group:0,tag:"Money",reason:"15 usd"},{match:"[second] #Noun",group:0,tag:"Ordinal",reason:"second-noun"},{match:"#Value+ [#Currency]",group:0,tag:"Unit",reason:"5-yan"},{match:"#Value [(foot|feet)]",group:0,tag:"Unit",reason:"foot-unit"},{match:"#Value [#Abbreviation]",group:0,tag:"Unit",reason:"value-abbr"},{match:"#Value [k]",group:0,tag:"Unit",reason:"value-k"},{match:"#Unit an hour",tag:"Unit",reason:"unit-an-hour"},{match:"(minus|negative) #Value",tag:"Value",reason:"minus-value"},{match:"#Value (point|decimal) #Value",tag:"Value",reason:"value-point-value"},{match:"#Determiner [(half|quarter)] #Ordinal",group:0,tag:"Value",reason:"half-ordinal"},{match:"#Multiple+ and #Value",tag:"Value",reason:"magnitude-and-value"},{match:"#Value #Unit [(per|an) (hr|hour|sec|second|min|minute)]",group:0,tag:"Unit",reason:"12-miles-per-second"},{match:"#Value [(square|cubic)] #Unit",group:0,tag:"Unit",reason:"square-miles"}],[{match:"#Copula [(#Noun|#PresentTense)] #LastName",group:0,tag:"FirstName",reason:"copula-noun-lastname"},{match:"(sister|pope|brother|father|aunt|uncle|grandpa|grandfather|grandma) #ProperNoun",tag:"Person",reason:"lady-titlecase",safe:!0},{match:"#FirstName [#Determiner #Noun] #LastName",group:0,tag:"Person",reason:"first-noun-last"},{match:"#ProperNoun (b|c|d|e|f|g|h|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z) #ProperNoun",tag:"Person",reason:"titlecase-acronym-titlecase",safe:!0},{match:"#Acronym #LastName",tag:"Person",reason:"acronym-lastname",safe:!0},{match:"#Person (jr|sr|md)",tag:"Person",reason:"person-honorific"},{match:"#Honorific #Acronym",tag:"Person",reason:"Honorific-TitleCase"},{match:"#Person #Person the? #RomanNumeral",tag:"Person",reason:"roman-numeral"},{match:"#FirstName [/^[^aiurck]$/]",group:0,tag:["Acronym","Person"],reason:"john-e"},{match:"#Noun van der? #Noun",tag:"Person",reason:"van der noun",safe:!0},{match:"(king|queen|prince|saint|lady) of #Noun",tag:"Person",reason:"king-of-noun",safe:!0},{match:"(prince|lady) #Place",tag:"Person",reason:"lady-place"},{match:"(king|queen|prince|saint) #ProperNoun",tag:"Person",notIf:"#Place",reason:"saint-foo"},{match:"al (#Person|#ProperNoun)",tag:"Person",reason:"al-borlen",safe:!0},{match:"#FirstName de #Noun",tag:"Person",reason:"bill-de-noun"},{match:"#FirstName (bin|al) #Noun",tag:"Person",reason:"bill-al-noun"},{match:"#FirstName #Acronym #ProperNoun",tag:"Person",reason:"bill-acronym-title"},{match:"#FirstName #FirstName #ProperNoun",tag:"Person",reason:"bill-firstname-title"},{match:"#Honorific #FirstName? #ProperNoun",tag:"Person",reason:"dr-john-Title"},{match:"#FirstName the #Adjective",tag:"Person",reason:"name-the-great"},{match:"#ProperNoun (van|al|bin) #ProperNoun",tag:"Person",reason:"title-van-title",safe:!0},{match:"#ProperNoun (de|du) la? #ProperNoun",tag:"Person",notIf:"#Place",reason:"title-de-title"},{match:"#Singular #Acronym #LastName",tag:"#FirstName #Person .",reason:"title-acro-noun",safe:!0},{match:"[#ProperNoun] #Person",group:0,tag:"Person",reason:"proper-person",safe:!0},{match:"#Person [#ProperNoun #ProperNoun]",group:0,tag:"Person",notIf:"#Possessive",reason:"three-name-person",safe:!0},{match:"#FirstName #Acronym? [#ProperNoun]",group:0,tag:"LastName",notIf:"#Possessive",reason:"firstname-titlecase"},{match:"#FirstName [#FirstName]",group:0,tag:"LastName",reason:"firstname-firstname"},{match:"#FirstName #Acronym #Noun",tag:"Person",reason:"n-acro-noun",safe:!0},{match:"#FirstName [(de|di|du|van|von)] #Person",group:0,tag:"LastName",reason:"de-firstname"},{match:"[(lieutenant|corporal|sergeant|captain|qeen|king|admiral|major|colonel|marshal|president|queen|king)+] #ProperNoun",group:0,tag:"Honorific",reason:"seargeant-john"},{match:"[(private|general|major|rear|prime|field|count|miss)] #Honorific? #Person",group:0,tag:["Honorific","Person"],reason:"ambg-honorifics"},{match:"#Honorific #FirstName [#Singular]",group:0,tag:"LastName",notIf:"#Possessive",reason:"dr-john-foo",safe:!0},{match:"[(his|her) (majesty|honour|worship|excellency|honorable)] #Person",group:0,tag:"Honorific",reason:"his-excellency"},{match:"#Honorific #Actor",tag:"Honorific",reason:"Lieutenant colonel"},{match:"(first|second|third|1st|2nd|3rd) #Actor",tag:"Honorific",reason:"first lady"},{match:"#Person #RomanNumeral",tag:"Person",reason:"louis-IV"}],[{match:"#FirstName #Noun$",tag:". #LastName",notIf:"(#Possessive|#Organization|#Place|#Pronoun|@hasTitleCase)",reason:"firstname-noun"},{match:"%Person|Date% #Acronym? #ProperNoun",tag:"Person",reason:"jan-thierson"},{match:"%Person|Noun% #Acronym? #ProperNoun",tag:"Person",reason:"switch-person",safe:!0},{match:"%Person|Noun% #Organization",tag:"Organization",reason:"olive-garden"},{match:"%Person|Verb% #Acronym? #ProperNoun",tag:"Person",reason:"verb-propernoun",ifNo:"#Actor"},{match:"[%Person|Verb%] (will|had|has|said|says|told|did|learned|wants|wanted)",group:0,tag:"Person",reason:"person-said"},{match:"[%Person|Place%] (harbor|harbour|pier|town|city|place|dump|landfill)",group:0,tag:"Place",reason:"sydney-harbour"},{match:"(west|east|north|south) [%Person|Place%]",group:0,tag:"Place",reason:"east-sydney"},{match:"#Modal [%Person|Verb%]",group:0,tag:"Verb",reason:"would-mark"},{match:"#Adverb [%Person|Verb%]",group:0,tag:"Verb",reason:"really-mark"},{match:"[%Person|Verb%] (#Adverb|#Comparative)",group:0,tag:"Verb",reason:"drew-closer"},{match:"%Person|Verb% #Person",tag:"Person",reason:"rob-smith"},{match:"%Person|Verb% #Acronym #ProperNoun",tag:"Person",reason:"rob-a-smith"},{match:"[will] #Verb",group:0,tag:"Modal",reason:"will-verb"},{match:"(will && @isTitleCase) #ProperNoun",tag:"Person",reason:"will-name"},{match:"(#FirstName && !#Possessive) [#Singular] #Verb",group:0,safe:!0,tag:"LastName",reason:"jack-layton"},{match:"^[#Singular] #Person #Verb",group:0,safe:!0,tag:"Person",reason:"sherwood-anderson"},{match:"(a|an) [#Person]$",group:0,unTag:"Person",reason:"a-warhol"}],[{match:"#Copula (pretty|dead|full|well|sure) (#Adjective|#Noun)",tag:"#Copula #Adverb #Adjective",reason:"sometimes-adverb"},{match:"(#Pronoun|#Person) (had|#Adverb)? [better] #PresentTense",group:0,tag:"Modal",reason:"i-better"},{match:"(#Modal|i|they|we|do) not? [like]",group:0,tag:"PresentTense",reason:"modal-like"},{match:"#Noun #Adverb? [left]",group:0,tag:"PastTense",reason:"left-verb"},{match:"will #Adverb? not? #Adverb? [be] #Gerund",group:0,tag:"Copula",reason:"will-be-copula"},{match:"will #Adverb? not? #Adverb? [be] #Adjective",group:0,tag:"Copula",reason:"be-copula"},{match:"[march] (up|down|back|toward)",notIf:"#Date",group:0,tag:"Infinitive",reason:"march-to"},{match:"#Modal [march]",group:0,tag:"Infinitive",reason:"must-march"},{match:"[may] be",group:0,tag:"Verb",reason:"may-be"},{match:"[(subject|subjects|subjected)] to",group:0,tag:"Verb",reason:"subject to"},{match:"[home] to",group:0,tag:"PresentTense",reason:"home to"},{match:"[open] #Determiner",group:0,tag:"Infinitive",reason:"open-the"},{match:"(were|was) being [#PresentTense]",group:0,tag:"PastTense",reason:"was-being"},{match:"(had|has|have) [been /en$/]",group:0,tag:"Auxiliary Participle",reason:"had-been-broken"},{match:"(had|has|have) [been /ed$/]",group:0,tag:"Auxiliary PastTense",reason:"had-been-smoked"},{match:"(had|has) #Adverb? [been] #Adverb? #PastTense",group:0,tag:"Auxiliary",reason:"had-been-adj"},{match:"(had|has) to [#Noun] (#Determiner|#Possessive)",group:0,tag:"Infinitive",reason:"had-to-noun"},{match:"have [#PresentTense]",group:0,tag:"PastTense",notIf:"(come|gotten)",reason:"have-read"},{match:"(does|will|#Modal) that [work]",group:0,tag:"PastTense",reason:"does-that-work"},{match:"[(sound|sounds)] #Adjective",group:0,tag:"PresentTense",reason:"sounds-fun"},{match:"[(look|looks)] #Adjective",group:0,tag:"PresentTense",reason:"looks-good"},{match:"[(start|starts|stop|stops|begin|begins)] #Gerund",group:0,tag:"Verb",reason:"starts-thinking"},{match:"(have|had) read",tag:"Modal #PastTense",reason:"read-read"},{match:"(is|was|were) [(under|over) #PastTense]",group:0,tag:"Adverb Adjective",reason:"was-under-cooked"},{match:"[shit] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear1-verb"},{match:"[damn] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear2-verb"},{match:"[fuck] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear3-verb"},{match:"#Plural that %Noun|Verb%",tag:". #Preposition #Infinitive",reason:"jobs-that-work"},{match:"[works] for me",group:0,tag:"PresentTense",reason:"works-for-me"},{match:"as #Pronoun [please]",group:0,tag:"Infinitive",reason:"as-we-please"},{match:"[(co|mis|de|inter|intra|pre|re|un|out|under|over|counter)] #Verb",group:0,tag:["Verb","Prefix"],notIf:"(#Copula|#PhrasalVerb)",reason:"co-write"},{match:"#PastTense and [%Adj|Past%]",group:0,tag:"PastTense",reason:"dressed-and-left"},{match:"[%Adj|Past%] and #PastTense",group:0,tag:"PastTense",reason:"dressed-and-left"},{match:"#Copula #Pronoun [%Adj|Past%]",group:0,tag:"Adjective",reason:"is-he-stoked"},{match:"to [%Noun|Verb%] #Preposition",group:0,tag:"Infinitive",reason:"to-dream-of"}],[{match:"(slowly|quickly) [#Adjective]",group:0,tag:"Verb",reason:"slowly-adj"},{match:"does (#Adverb|not)? [#Adjective]",group:0,tag:"PresentTense",reason:"does-mean"},{match:"[(fine|okay|cool|ok)] by me",group:0,tag:"Adjective",reason:"okay-by-me"},{match:"i (#Adverb|do)? not? [mean]",group:0,tag:"PresentTense",reason:"i-mean"},{match:"will #Adjective",tag:"Auxiliary Infinitive",reason:"will-adj"},{match:"#Pronoun [#Adjective] #Determiner #Adjective? #Noun",group:0,tag:"Verb",reason:"he-adj-the"},{match:"#Copula [%Adj|Present%] to #Verb",group:0,tag:"Verb",reason:"adj-to"},{match:"#Copula [#Adjective] (well|badly|quickly|slowly)",group:0,tag:"Verb",reason:"done-well"},{match:"#Adjective and [#Gerund] !#Preposition?",group:0,tag:"Adjective",reason:"rude-and-x"},{match:"#Copula #Adverb? (over|under) [#PastTense]",group:0,tag:"Adjective",reason:"over-cooked"},{match:"#Copula #Adjective+ (and|or) [#PastTense]$",group:0,tag:"Adjective",reason:"bland-and-overcooked"},{match:"got #Adverb? [#PastTense] of",group:0,tag:"Adjective",reason:"got-tired-of"},{match:"(seem|seems|seemed|appear|appeared|appears|feel|feels|felt|sound|sounds|sounded) (#Adverb|#Adjective)? [#PastTense]",group:0,tag:"Adjective",reason:"felt-loved"},{match:"(seem|feel|seemed|felt) [#PastTense #Particle?]",group:0,tag:"Adjective",reason:"seem-confused"},{match:"a (bit|little|tad) [#PastTense #Particle?]",group:0,tag:"Adjective",reason:"a-bit-confused"},{match:"not be [%Adj|Past% #Particle?]",group:0,tag:"Adjective",reason:"do-not-be-confused"},{match:"#Copula just [%Adj|Past% #Particle?]",group:0,tag:"Adjective",reason:"is-just-right"},{match:"as [#Infinitive] as",group:0,tag:"Adjective",reason:"as-pale-as"},{match:"[%Adj|Past%] and #Adjective",group:0,tag:"Adjective",reason:"faled-and-oppressive"},{match:"or [#PastTense] #Noun",group:0,tag:"Adjective",notIf:"(#Copula|#Pronoun)",reason:"or-heightened-emotion"},{match:"(become|became|becoming|becomes) [#Verb]",group:0,tag:"Adjective",reason:"become-verb"},{match:"#Possessive [#PastTense] #Noun",group:0,tag:"Adjective",reason:"declared-intentions"},{match:"#Copula #Pronoun [%Adj|Present%]",group:0,tag:"Adjective",reason:"is-he-cool"},{match:"#Copula [%Adj|Past%] with",group:0,tag:"Adjective",notIf:"(associated|worn|baked|aged|armed|bound|fried|loaded|mixed|packed|pumped|filled|sealed)",reason:"is-crowded-with"},{match:"#Copula #Adverb? [%Adj|Present%]$",group:0,tag:"Adjective",reason:"was-empty$"}],[{match:"will (#Adverb|not)+? [have] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"will-have-vb"},{match:"[#Copula] (#Adverb|not)+? (#Gerund|#PastTense)",group:0,tag:"Auxiliary",reason:"copula-walking"},{match:"[(#Modal|did)+] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"modal-verb"},{match:"#Modal (#Adverb|not)+? [have] (#Adverb|not)+? [had] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"[(has|had)] (#Adverb|not)+? #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"[(do|does|did|will|have|had|has|got)] (not|#Adverb)+? #Verb",group:0,tag:"Auxiliary",reason:"have-had"},{match:"[about to] #Adverb? #Verb",group:0,tag:["Auxiliary","Verb"],reason:"about-to"},{match:"#Modal (#Adverb|not)+? [be] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"would-be"},{match:"[(#Modal|had|has)] (#Adverb|not)+? [been] (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"had-been"},{match:"[(be|being|been)] #Participle",group:0,tag:"Auxiliary",reason:"being-driven"},{match:"[may] #Adverb? #Infinitive",group:0,tag:"Auxiliary",reason:"may-want"},{match:"#Copula (#Adverb|not)+? [(be|being|been)] #Adverb+? #PastTense",group:0,tag:"Auxiliary",reason:"being-walked"},{match:"will [be] #PastTense",group:0,tag:"Auxiliary",reason:"will-be-x"},{match:"[(be|been)] (#Adverb|not)+? #Gerund",group:0,tag:"Auxiliary",reason:"been-walking"},{match:"[used to] #PresentTense",group:0,tag:"Auxiliary",reason:"used-to-walk"},{match:"#Copula (#Adverb|not)+? [going to] #Adverb+? #PresentTense",group:0,tag:"Auxiliary",reason:"going-to-walk"},{match:"#Imperative [(me|him|her)]",group:0,tag:"Reflexive",reason:"tell-him"},{match:"(is|was) #Adverb? [no]",group:0,tag:"Negative",reason:"is-no"},{match:"[(been|had|became|came)] #PastTense",group:0,notIf:"#PhrasalVerb",tag:"Auxiliary",reason:"been-told"},{match:"[(being|having|getting)] #Verb",group:0,tag:"Auxiliary",reason:"being-born"},{match:"[be] #Gerund",group:0,tag:"Auxiliary",reason:"be-walking"},{match:"[better] #PresentTense",group:0,tag:"Modal",notIf:"(#Copula|#Gerund)",reason:"better-go"},{match:"even better",tag:"Adverb #Comparative",reason:"even-better"}],[{match:"(#Verb && @hasHyphen) up",tag:"PhrasalVerb",reason:"foo-up"},{match:"(#Verb && @hasHyphen) off",tag:"PhrasalVerb",reason:"foo-off"},{match:"(#Verb && @hasHyphen) over",tag:"PhrasalVerb",reason:"foo-over"},{match:"(#Verb && @hasHyphen) out",tag:"PhrasalVerb",reason:"foo-out"},{match:"[#Verb (in|out|up|down|off|back)] (on|in)",notIf:"#Copula",tag:"PhrasalVerb Particle",reason:"walk-in-on"},{match:"(lived|went|crept|go) [on] for",group:0,tag:"PhrasalVerb",reason:"went-on"},{match:"#Verb (up|down|in|on|for)$",tag:"PhrasalVerb #Particle",notIf:"#PhrasalVerb",reason:"come-down$"},{match:"help [(stop|end|make|start)]",group:0,tag:"Infinitive",reason:"help-stop"},{match:"#PhrasalVerb (in && #Particle) #Determiner",tag:"#Verb #Preposition #Determiner",unTag:"PhrasalVerb",reason:"work-in-the"},{match:"[(stop|start|finish|help)] #Gerund",group:0,tag:"Infinitive",reason:"start-listening"},{match:"#Verb (him|her|it|us|himself|herself|itself|everything|something) [(up|down)]",group:0,tag:"Adverb",reason:"phrasal-pronoun-advb"}],[{match:"^do not? [#Infinitive #Particle?]",notIf:GD,group:0,tag:"Imperative",reason:"do-eat"},{match:"^please do? not? [#Infinitive #Particle?]",group:0,tag:"Imperative",reason:"please-go"},{match:"^just do? not? [#Infinitive #Particle?]",group:0,tag:"Imperative",reason:"just-go"},{match:"^[#Infinitive] it #Comparative",notIf:GD,group:0,tag:"Imperative",reason:"do-it-better"},{match:"^[#Infinitive] it (please|now|again|plz)",notIf:GD,group:0,tag:"Imperative",reason:"do-it-please"},{match:"^[#Infinitive] (#Adjective|#Adverb)$",group:0,tag:"Imperative",notIf:"(so|such|rather|enough)",reason:"go-quickly"},{match:"^[#Infinitive] (up|down|over) #Determiner",group:0,tag:"Imperative",reason:"turn-down"},{match:"^[#Infinitive] (your|my|the|a|an|any|each|every|some|more|with|on)",group:0,notIf:"like",tag:"Imperative",reason:"eat-my-shorts"},{match:"^[#Infinitive] (him|her|it|us|me|there)",group:0,tag:"Imperative",reason:"tell-him"},{match:"^[#Infinitive] #Adjective #Noun$",group:0,tag:"Imperative",reason:"avoid-loud-noises"},{match:"^[#Infinitive] (#Adjective|#Adverb)? and #Infinitive",group:0,tag:"Imperative",reason:"call-and-reserve"},{match:"^(go|stop|wait|hurry) please?$",tag:"Imperative",reason:"go"},{match:"^(somebody|everybody) [#Infinitive]",group:0,tag:"Imperative",reason:"somebody-call"},{match:"^let (us|me) [#Infinitive]",group:0,tag:"Imperative",reason:"lets-leave"},{match:"^[(shut|close|open|start|stop|end|keep)] #Determiner #Noun",group:0,tag:"Imperative",reason:"shut-the-door"},{match:"^[#PhrasalVerb #Particle] #Determiner #Noun",group:0,tag:"Imperative",reason:"turn-off-the-light"},{match:"^[go] to .",group:0,tag:"Imperative",reason:"go-to-toronto"},{match:"^#Modal you [#Infinitive]",group:0,tag:"Imperative",reason:"would-you-"},{match:"^never [#Infinitive]",group:0,tag:"Imperative",reason:"never-stop"},{match:"^come #Infinitive",tag:"Imperative",notIf:"on",reason:"come-have"},{match:"^come and? #Infinitive",tag:"Imperative . Imperative",notIf:"#PhrasalVerb",reason:"come-and-have"},{match:"^stay (out|away|back)",tag:"Imperative",reason:"stay-away"},{match:"^[(stay|be|keep)] #Adjective",group:0,tag:"Imperative",reason:"stay-cool"},{match:"^[keep it] #Adjective",group:0,tag:"Imperative",reason:"keep-it-cool"},{match:"^do not [#Infinitive]",group:0,tag:"Imperative",reason:"do-not-be"},{match:"[#Infinitive] (yourself|yourselves)",group:0,tag:"Imperative",reason:"allow-yourself"},{match:"[#Infinitive] what .",group:0,tag:"Imperative",reason:"look-what"},{match:"^[#Infinitive] #Gerund",group:0,tag:"Imperative",reason:"keep-playing"},{match:"^[#Infinitive] (to|for|into|toward|here|there)",group:0,tag:"Imperative",reason:"go-to"},{match:"^[#Infinitive] (and|or) #Infinitive",group:0,tag:"Imperative",reason:"inf-and-inf"},{match:"^[%Noun|Verb%] to",group:0,tag:"Imperative",reason:"commit-to"},{match:"^[#Infinitive] #Adjective? #Singular #Singular",group:0,tag:"Imperative",reason:"maintain-eye-contact"},{match:"do not (forget|omit|neglect) to [#Infinitive]",group:0,tag:"Imperative",reason:"do-not-forget"},{match:"^[(ask|wear|pay|look|help|show|watch|act|fix|kill|stop|start|turn|try|win)] #Noun",group:0,tag:"Imperative",reason:"pay-attention"}],[{match:"(that|which) were [%Adj|Gerund%]",group:0,tag:"Gerund",reason:"that-were-growing"},{match:"#Gerund [#Gerund] #Plural",group:0,tag:"Adjective",reason:"hard-working-fam"}],[{match:"u r",tag:"#Pronoun #Copula",reason:"u r"},{match:"#Noun [(who|whom)]",group:0,tag:"Determiner",reason:"captain-who"},{match:"[had] #Noun+ #PastTense",group:0,tag:"Condition",reason:"had-he"},{match:"[were] #Noun+ to #Infinitive",group:0,tag:"Condition",reason:"were-he"},{match:"some sort of",tag:"Adjective Noun Conjunction",reason:"some-sort-of"},{match:"of some sort",tag:"Conjunction Adjective Noun",reason:"of-some-sort"},{match:"[such] (a|an|is)? #Noun",group:0,tag:"Determiner",reason:"such-skill"},{match:"[right] (before|after|in|into|to|toward)",group:0,tag:"#Adverb",reason:"right-into"},{match:"#Preposition [about]",group:0,tag:"Adjective",reason:"at-about"},{match:"(are|#Modal|see|do|for) [ya]",group:0,tag:"Pronoun",reason:"are-ya"},{match:"[long live] .",group:0,tag:"#Adjective #Infinitive",reason:"long-live"},{match:"[plenty] of",group:0,tag:"#Uncountable",reason:"plenty-of"},{match:"(always|nearly|barely|practically) [there]",group:0,tag:"Adjective",reason:"always-there"},{match:"[there] (#Adverb|#Pronoun)? #Copula",group:0,tag:"There",reason:"there-is"},{match:"#Copula [there] .",group:0,tag:"There",reason:"is-there"},{match:"#Modal #Adverb? [there]",group:0,tag:"There",reason:"should-there"},{match:"^[do] (you|we|they)",group:0,tag:"QuestionWord",reason:"do-you"},{match:"^[does] (he|she|it|#ProperNoun)",group:0,tag:"QuestionWord",reason:"does-he"},{match:"#Determiner #Noun+ [who] #Verb",group:0,tag:"Preposition",reason:"the-x-who"},{match:"#Determiner #Noun+ [which] #Verb",group:0,tag:"Preposition",reason:"the-x-which"},{match:"a [while]",group:0,tag:"Noun",reason:"a-while"},{match:"guess who",tag:"#Infinitive #QuestionWord",reason:"guess-who"},{match:"[fucking] !#Verb",group:0,tag:"#Gerund",reason:"f-as-gerund"}],[{match:"university of #Place",tag:"Organization",reason:"university-of-Foo"},{match:"#Noun (&|n) #Noun",tag:"Organization",reason:"Noun-&-Noun"},{match:"#Organization of the? #ProperNoun",tag:"Organization",reason:"org-of-place",safe:!0},{match:"#Organization #Country",tag:"Organization",reason:"org-country"},{match:"#ProperNoun #Organization",tag:"Organization",notIf:"#FirstName",reason:"titlecase-org"},{match:"#ProperNoun (ltd|co|inc|dept|assn|bros)",tag:"Organization",reason:"org-abbrv"},{match:"the [#Acronym]",group:0,tag:"Organization",reason:"the-acronym",safe:!0},{match:"government of the? [#Place+]",tag:"Organization",reason:"government-of-x"},{match:"(health|school|commerce) board",tag:"Organization",reason:"school-board"},{match:"(nominating|special|conference|executive|steering|central|congressional) committee",tag:"Organization",reason:"special-comittee"},{match:"(world|global|international|national|#Demonym) #Organization",tag:"Organization",reason:"global-org"},{match:"#Noun+ (public|private) school",tag:"School",reason:"noun-public-school"},{match:"#Place+ #SportsTeam",tag:"SportsTeam",reason:"place-sportsteam"},{match:"(dc|atlanta|minnesota|manchester|newcastle|sheffield) united",tag:"SportsTeam",reason:"united-sportsteam"},{match:"#Place+ fc",tag:"SportsTeam",reason:"fc-sportsteam"},{match:"#Place+ #Noun{0,2} (club|society|group|team|committee|commission|association|guild|crew)",tag:"Organization",reason:"place-noun-society"}],[{match:"(west|north|south|east|western|northern|southern|eastern)+ #Place",tag:"Region",reason:"west-norfolk"},{match:"#City [(al|ak|az|ar|ca|ct|dc|fl|ga|id|il|nv|nh|nj|ny|oh|pa|sc|tn|tx|ut|vt|pr)]",group:0,tag:"Region",reason:"us-state"},{match:"portland [or]",group:0,tag:"Region",reason:"portland-or"},{match:"#ProperNoun+ (cliff|place|range|pit|place|point|room|grounds|ruins)",tag:"Place",reason:"foo-point"},{match:"in [#ProperNoun] #Place",group:0,tag:"Place",reason:"propernoun-place"},{match:"#Value #Noun (st|street|rd|road|crescent|cr|way|tr|terrace|avenue|ave)",tag:"Address",reason:"address-st"},{match:"(port|mount|mt) #ProperName",tag:"Place",reason:"port-name"}],[{match:"[so] #Noun",group:0,tag:"Conjunction",reason:"so-conj"},{match:"[(who|what|where|why|how|when)] #Noun #Copula #Adverb? (#Verb|#Adjective)",group:0,tag:"Conjunction",reason:"how-he-is-x"},{match:"#Copula [(who|what|where|why|how|when)] #Noun",group:0,tag:"Conjunction",reason:"when-he"},{match:"#Verb [that] #Pronoun",group:0,tag:"Conjunction",reason:"said-that-he"},{match:"#Noun [that] #Copula",group:0,tag:"Conjunction",reason:"that-are"},{match:"#Noun [that] #Verb #Adjective",group:0,tag:"Conjunction",reason:"that-seem"},{match:"#Noun #Copula not? [that] #Adjective",group:0,tag:"Adverb",reason:"that-adj"},{match:"#Verb #Adverb? #Noun [(that|which)]",group:0,tag:"Preposition",reason:"that-prep"},{match:"@hasComma [which] (#Pronoun|#Verb)",group:0,tag:"Preposition",reason:"which-copula"},{match:"#Noun [like] #Noun",group:0,tag:"Preposition",reason:"noun-like"},{match:"^[like] #Determiner",group:0,tag:"Preposition",reason:"like-the"},{match:"a #Noun [like] (#Noun|#Determiner)",group:0,tag:"Preposition",reason:"a-noun-like"},{match:"#Adverb [like]",group:0,tag:"Verb",reason:"really-like"},{match:"(not|nothing|never) [like]",group:0,tag:"Preposition",reason:"nothing-like"},{match:"#Infinitive #Pronoun [like]",group:0,tag:"Preposition",reason:"treat-them-like"},{match:"[#QuestionWord] (#Pronoun|#Determiner)",group:0,tag:"Preposition",reason:"how-he"},{match:"[#QuestionWord] #Participle",group:0,tag:"Preposition",reason:"when-stolen"},{match:"[how] (#Determiner|#Copula|#Modal|#PastTense)",group:0,tag:"QuestionWord",reason:"how-is"},{match:"#Plural [(who|which|when)] .",group:0,tag:"Preposition",reason:"people-who"}],[{match:"holy (shit|fuck|hell)",tag:"Expression",reason:"swears-expression"},{match:"^[(well|so|okay|now)] !#Adjective?",group:0,tag:"Expression",reason:"well-"},{match:"^come on",tag:"Expression",reason:"come-on"},{match:"(say|says|said) [sorry]",group:0,tag:"Expression",reason:"say-sorry"},{match:"^(ok|alright|shoot|hell|anyways)",tag:"Expression",reason:"ok-"},{match:"^(say && @hasComma)",tag:"Expression",reason:"say-"},{match:"^(like && @hasComma)",tag:"Expression",reason:"like-"},{match:"^[(dude|man|girl)] #Pronoun",group:0,tag:"Expression",reason:"dude-i"}]),KD=null;const WD={postTagger:function(e){const{world:t}=e,{model:n,methods:r}=t;KD=KD||r.one.buildNet(n.two.matches,t);let i=r.two.quickSplit(e.document).map((e=>{let t=e[0];return[t.index[0],t.index[1],t.index[1]+e.length]})),s=e.update(i);return s.cache(),s.sweep(KD),e.uncache(),e.unfreeze(),e},tagger:e=>e.compute(["freeze","lexicon","preTagger","postTagger","unfreeze"])},JD={api:function(e){e.prototype.confidence=function(){let e=0,t=0;return this.docs.forEach((n=>{n.forEach((n=>{t+=1,e+=n.confidence||1}))})),0===t?1:(e=>Math.round(100*e)/100)(e/t)},e.prototype.tagger=function(){return this.compute(["tagger"])}},compute:WD,model:{two:{matches:qD}},hooks:["postTagger"]},ZD=JD,QD={lib:{lazy:function(e,t){let n=t;"string"==typeof t&&(n=this.buildNet([{match:t}]));let r=this.tokenize(e),i=function(e,t){let n=function(e){return Object.keys(e.hooks).filter((e=>!e.startsWith("#")&&!e.startsWith("%")))}(t);if(0===n.length)return e;e._cache||e.cache();let r=e._cache;return e.filter(((e,t)=>n.some((e=>r[t].has(e)))))}(r,n);return i.found?(i.compute(["index","tagger"]),i.match(t)):r.none()}}},XD=function(e,t,n){let r=e.split(/ /g).map((e=>e.toLowerCase().trim()));r=r.filter((e=>e)),r=r.map((e=>`{${e}}`)).join(" ");let i=this.match(r);return n&&(i=i.if(n)),i.has("#Verb")?function(e,t){let n=t;return e.forEach((e=>{e.has("#Infinitive")||(n=function(e,t){let n=(0,e.methods.two.transform.verb.conjugate)(t,e.model);return e.has("#Gerund")?n.Gerund:e.has("#PastTense")?n.PastTense:e.has("#PresentTense")?n.PresentTense:e.has("#Gerund")?n.Gerund:t}(e,t)),e.replaceWith(n)})),e}(i,t):i.has("#Noun")?function(e,t){let n=t;e.has("#Plural")&&(n=(0,e.methods.two.transform.noun.toPlural)(t,e.model)),e.replaceWith(n,{possessives:!0})}(i,t):i.has("#Adverb")?function(e,t){const{toAdverb:n}=e.methods.two.transform.adjective;let r=n(t);r&&e.replaceWith(r)}(i,t):i.has("#Adjective")?function(e,t){const{toComparative:n,toSuperlative:r}=e.methods.two.transform.adjective;let i=t;e.has("#Comparative")?i=n(i,e.model):e.has("#Superlative")&&(i=r(i,e.model)),i&&e.replaceWith(i)}(i,t):this},YD={api:function(e){e.prototype.swap=XD}};RO.plugin(_D),RO.plugin(zD),RO.plugin(ZD),RO.plugin(QD),RO.plugin(YD);const eR=RO,tR=function(e){const{fromComparative:t,fromSuperlative:n}=e.methods.two.transform.adjective;let r=e.text("normal");return e.has("#Comparative")?t(r,e.model):e.has("#Superlative")?n(r,e.model):r},nR={api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Adjectives"}json(e={}){const{toAdverb:t,toNoun:n,toSuperlative:r,toComparative:i}=this.methods.two.transform.adjective;return e.normal=!0,this.map((s=>{let a=s.toView().json(e)[0]||{},o=tR(s);return a.adjective={adverb:t(o,this.model),noun:n(o,this.model),superlative:r(o,this.model),comparative:i(o,this.model)},a}),[])}adverbs(){return this.before("#Adverb+$").concat(this.after("^#Adverb+"))}conjugate(e){const{toComparative:t,toSuperlative:n,toNoun:r,toAdverb:i}=this.methods.two.transform.adjective;return this.getNth(e).map((e=>{let s=tR(e);return{Adjective:s,Comparative:t(s,this.model),Superlative:n(s,this.model),Noun:r(s,this.model),Adverb:i(s,this.model)}}),[])}toComparative(e){const{toComparative:t}=this.methods.two.transform.adjective;return this.getNth(e).map((e=>{let n=tR(e),r=t(n,this.model);return e.replaceWith(r)}))}toSuperlative(e){const{toSuperlative:t}=this.methods.two.transform.adjective;return this.getNth(e).map((e=>{let n=tR(e),r=t(n,this.model);return e.replaceWith(r)}))}toAdverb(e){const{toAdverb:t}=this.methods.two.transform.adjective;return this.getNth(e).map((e=>{let n=tR(e),r=t(n,this.model);return e.replaceWith(r)}))}toNoun(e){const{toNoun:t}=this.methods.two.transform.adjective;return this.getNth(e).map((e=>{let n=tR(e),r=t(n,this.model);return e.replaceWith(r)}))}}e.prototype.adjectives=function(e){let n=this.match("#Adjective");return n=n.getNth(e),new t(n.document,n.pointer)},e.prototype.superlatives=function(e){let n=this.match("#Superlative");return n=n.getNth(e),new t(n.document,n.pointer)},e.prototype.comparatives=function(e){let n=this.match("#Comparative");return n=n.getNth(e),new t(n.document,n.pointer)}}},rR=function(e){let t=this;t=function(e){let t=e.parentheses();return t=t.filter((e=>e.wordCount()>=3&&e.has("#Verb")&&e.has("#Noun"))),e.splitOn(t)}(t),t=function(e){let t=e.quotations();return t=t.filter((e=>e.wordCount()>=3&&e.has("#Verb")&&e.has("#Noun"))),e.splitOn(t)}(t),t=function(e){let t=e.match("@hasComma");return t=t.filter((e=>{if(1===e.growLeft(".").wordCount())return!1;if(1===e.growRight(". .").wordCount())return!1;let t=e.grow(".");return t=t.ifNo("@hasComma @hasComma"),t=t.ifNo("@hasComma (and|or) ."),t=t.ifNo("(#City && @hasComma) #Country"),t=t.ifNo("(#WeekDay && @hasComma) #Date"),t=t.ifNo("(#Date+ && @hasComma) #Value"),t=t.ifNo("(#Adjective && @hasComma) #Adjective"),t.found})),e.splitAfter(t)}(t),t=t.splitAfter("(@hasEllipses|@hasSemicolon|@hasDash|@hasColon)"),t=t.splitAfter("^#Pronoun (said|says)"),t=t.splitBefore("(said|says) #ProperNoun$"),t=t.splitBefore(". . if .{4}"),t=t.splitBefore("and while"),t=t.splitBefore("now that"),t=t.splitBefore("ever since"),t=t.splitBefore("(supposing|although)"),t=t.splitBefore("even (while|if|though)"),t=t.splitBefore("(whereas|whose)"),t=t.splitBefore("as (though|if)"),t=t.splitBefore("(til|until)");let n=t.match("#Verb .* [but] .* #Verb",0);n.found&&(t=t.splitBefore(n));let r=t.if("if .{2,9} then .").match("then");return t=t.splitBefore(r),"number"==typeof e&&(t=t.get(e)),t},iR={this:"Noun",then:"Pivot"},sR=[{match:"[that] #Determiner #Noun",group:0,chunk:"Pivot"},{match:"#PastTense [that]",group:0,chunk:"Pivot"},{match:"[so] #Determiner",group:0,chunk:"Pivot"},{match:"#Copula #Adverb+? [#Adjective]",group:0,chunk:"Adjective"},{match:"#Adjective and #Adjective",chunk:"Adjective"},{match:"#Adverb+ and #Adverb #Verb",chunk:"Verb"},{match:"#Gerund #Adjective$",chunk:"Verb"},{match:"#Gerund to #Verb",chunk:"Verb"},{match:"#PresentTense and #PresentTense",chunk:"Verb"},{match:"#Adverb #Negative",chunk:"Verb"},{match:"(want|wants|wanted) to #Infinitive",chunk:"Verb"},{match:"#Verb #Reflexive",chunk:"Verb"},{match:"#Verb [to] #Adverb? #Infinitive",group:0,chunk:"Verb"},{match:"[#Preposition] #Gerund",group:0,chunk:"Verb"},{match:"#Infinitive [that] <Noun>",group:0,chunk:"Verb"},{match:"#Noun of #Determiner? #Noun",chunk:"Noun"},{match:"#Value+ #Adverb? #Adjective",chunk:"Noun"},{match:"the [#Adjective] #Noun",chunk:"Noun"},{match:"#Singular in #Determiner? #Singular",chunk:"Noun"},{match:"#Plural [in] #Determiner? #Noun",group:0,chunk:"Pivot"},{match:"#Noun and #Determiner? #Noun",notIf:"(#Possessive|#Pronoun)",chunk:"Noun"}];let aR=null;const oR=function(e,t){if(("undefined"!=typeof process&&process.env?process.env:self.env||{}).DEBUG_CHUNKS){let n=(e.normal+"'").padEnd(8);console.log(`  | '${n}  →  [34m${t.padEnd(12)}[0m [2m -fallback- [0m`)}e.chunk=t},lR={chunks:function(e){const{document:t,world:n}=e;(function(e){for(let t=0;t<e.length;t+=1)for(let n=0;n<e[t].length;n+=1){let r=e[t][n];!0!==iR.hasOwnProperty(r.normal)?r.tags.has("Verb")?r.chunk="Verb":r.tags.has("Noun")||r.tags.has("Determiner")||r.tags.has("Value")?r.chunk="Noun":r.tags.has("QuestionWord")&&(r.chunk="Pivot"):r.chunk=iR[r.normal]}})(t),function(e){for(let t=0;t<e.length;t+=1)for(let n=0;n<e[t].length;n+=1){let r=e[t][n];if(r.chunk)continue;let i=e[t][n+1],s=e[t][n-1];if(r.tags.has("Adjective")){if(s&&s.tags.has("Copula")){r.chunk="Adjective";continue}if(s&&s.tags.has("Determiner")){r.chunk="Noun";continue}if(i&&i.tags.has("Noun")){r.chunk="Noun";continue}}else if(r.tags.has("Adverb")||r.tags.has("Negative")){if(s&&s.tags.has("Adjective")){r.chunk="Adjective";continue}if(s&&s.tags.has("Verb")){r.chunk="Verb";continue}if(i&&i.tags.has("Adjective")){r.chunk="Adjective";continue}if(i&&i.tags.has("Verb")){r.chunk="Verb";continue}}}}(t),function(e,t,n){const{methods:r}=n;aR=aR||r.one.buildNet(sR,n),e.sweep(aR)}(e,0,n),function(e){for(let t=0;t<e.length;t+=1)for(let n=0;n<e[t].length;n+=1){let r=e[t][n];void 0===r.chunk&&(r.tags.has("Conjunction")||r.tags.has("Preposition")?oR(r,"Pivot"):r.tags.has("Adverb")?oR(r,"Verb"):r.chunk="Noun")}}(t),function(e){let t=[],n=null;e.forEach((e=>{for(let r=0;r<e.length;r+=1){let i=e[r];n&&i.chunk===n?t[t.length-1].terms.push(i):(t.push({chunk:i.chunk,terms:[i]}),n=i.chunk)}})),t.forEach((e=>{if("Verb"===e.chunk){const t=e.terms.find((e=>e.tags.has("Verb")));t||e.terms.forEach((e=>e.chunk=null))}}))}(t)}},cR={compute:lR,api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Chunks"}isVerb(){return this.filter((e=>e.has("<Verb>")))}isNoun(){return this.filter((e=>e.has("<Noun>")))}isAdjective(){return this.filter((e=>e.has("<Adjective>")))}isPivot(){return this.filter((e=>e.has("<Pivot>")))}debug(){return this.toView().debug("chunks"),this}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.chunks=function(e){let n=function(e){let t=[],n=null;return e.clauses().docs.forEach((e=>{e.forEach((e=>{e.chunk&&e.chunk===n?t[t.length-1][2]=e.index[1]+1:(n=e.chunk,t.push([e.index[0],e.index[1],e.index[1]+1]))})),n=null})),e.update(t)}(this);return n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.clauses=rR},hooks:["chunks"]},uR=/\./g,hR=/\(/,dR=/\)/,pR=function(e,t){for(;t<e.length;t+=1)if(e[t].post&&dR.test(e[t].post)){let[,n]=e[t].index;return n=n||0,n}return null},fR=/'s$/,mR={'"':'"',"＂":"＂","'":"'","“":"”","‘":"’","‟":"”","‛":"’","„":"”","⹂":"”","‚":"’","«":"»","‹":"›","‵":"′","‶":"″","‷":"‴","〝":"〞","`":"´","〟":"〞"},gR=RegExp("["+Object.keys(mR).join("")+"]"),yR=RegExp("["+Object.values(mR).join("")+"]"),vR=function(e,t){const n=e[t].pre.match(gR)[0]||"";if(!n||!mR[n])return null;const r=mR[n];for(;t<e.length;t+=1)if(e[t].post&&e[t].post.match(r))return t;return null},bR=function(e){let t=this.splitAfter("@hasComma");return t=t.match("#PhoneNumber+"),t=t.getNth(e),t},wR=[["hyphenated","@hasHyphen ."],["hashTags","#HashTag"],["emails","#Email"],["emoji","#Emoji"],["emoticons","#Emoticon"],["atMentions","#AtMention"],["urls","#Url"],["conjunctions","#Conjunction"],["prepositions","#Preposition"],["abbreviations","#Abbreviation"],["honorifics","#Honorific"]];let _R=[["emojis","emoji"],["atmentions","atMentions"]];const kR=/\//,AR={api:function(e){(function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Acronyms"}strip(){return this.docs.forEach((e=>{e.forEach((e=>{e.text=e.text.replace(uR,""),e.normal=e.normal.replace(uR,"")}))})),this}addPeriods(){return this.docs.forEach((e=>{e.forEach((e=>{e.text=e.text.replace(uR,""),e.normal=e.normal.replace(uR,""),e.text=e.text.split("").join(".")+".",e.normal=e.normal.split("").join(".")+"."}))})),this}}e.prototype.acronyms=function(e){let n=this.match("#Acronym");return n=n.getNth(e),new t(n.document,n.pointer)}})(e),function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Possessives"}strip(){return function(e){return e.docs.forEach((e=>{e[0].pre=e[0].pre.replace(hR,"");let t=e[e.length-1];t.post=t.post.replace(dR,"")})),e}(this)}}e.prototype.parentheses=function(e){let n=function(e){let t=[];return e.docs.forEach((e=>{for(let n=0;n<e.length;n+=1){let r=e[n];if(r.pre&&hR.test(r.pre)){let r=pR(e,n);if(null!==r){let[i,s]=e[n].index;t.push([i,s,r+1,e[n].id]),n=r}}}})),e.update(t)}(this);return n=n.getNth(e),new t(n.document,n.pointer)}}(e),function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Possessives"}strip(){return this.docs.forEach((e=>{e.forEach((e=>{e.text=e.text.replace(fR,""),e.normal=e.normal.replace(fR,"")}))})),this}}e.prototype.possessives=function(e){let n=function(e){let t=e.match("#Possessive+");return t.has("#Person")&&(t=t.growLeft("#Person+")),t.has("#Place")&&(t=t.growLeft("#Place+")),t.has("#Organization")&&(t=t.growLeft("#Organization+")),t}(this);return n=n.getNth(e),new t(n.document,n.pointer)}}(e),function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Possessives"}strip(){return function(e){e.docs.forEach((e=>{e[0].pre=e[0].pre.replace(gR,"");let t=e[e.length-1];t.post=t.post.replace(yR,"")}))}(this)}}e.prototype.quotations=function(e){let n=function(e){let t=[];return e.docs.forEach((e=>{for(let n=0;n<e.length;n+=1){let r=e[n];if(r.pre&&gR.test(r.pre)){let r=vR(e,n);if(null!==r){let[i,s]=e[n].index;t.push([i,s,r+1,e[n].id]),n=r}}}})),e.update(t)}(this);return n=n.getNth(e),new t(n.document,n.pointer)}}(e),function(e){wR.forEach((t=>{e.prototype[t[0]]=function(e){let n=this.match(t[1]);return"number"==typeof e?n.get(e):n}})),e.prototype.phoneNumbers=bR,_R.forEach((t=>{e.prototype[t[0]]=e.prototype[t[1]]}))}(e),function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Slashes"}split(){return this.map((e=>{let t=e.text().split(kR);return(e=e.replaceWith(t.join(" "))).growRight("("+t.join("|")+")+")}))}}e.prototype.slashes=function(e){let n=this.match("#SlashedTerm");return n=n.getNth(e),new t(n.document,n.pointer)}}(e)}},PR=function(e,t){e.docs.forEach((e=>{e.forEach(t)}))},TR={case:e=>{PR(e,(e=>{e.text=e.text.toLowerCase()}))},unicode:e=>{const t=e.world,n=t.methods.one.killUnicode;PR(e,(e=>e.text=n(e.text,t)))},whitespace:e=>{PR(e,(e=>{e.post=e.post.replace(/\s+/g," "),e.post=e.post.replace(/\s([.,?!:;])/g,"$1"),e.pre=e.pre.replace(/\s+/g,"")}))},punctuation:e=>{PR(e,(e=>{e.post=e.post.replace(/[–—-]/g," "),e.post=e.post.replace(/[,:;]/g,""),e.post=e.post.replace(/\.{2,}/g,""),e.post=e.post.replace(/\?{2,}/g,"?"),e.post=e.post.replace(/!{2,}/g,"!"),e.post=e.post.replace(/\?!+/g,"?")}));let t=e.docs,n=t[t.length-1];if(n&&n.length>0){let e=n[n.length-1];e.post=e.post.replace(/ /g,"")}},contractions:e=>{e.contractions().expand()},acronyms:e=>{e.acronyms().strip()},parentheses:e=>{e.parentheses().strip()},possessives:e=>{e.possessives().strip()},quotations:e=>{e.quotations().strip()},emoji:e=>{e.emojis().remove()},honorifics:e=>{e.match("#Honorific+ #Person").honorifics().remove()},adverbs:e=>{e.adverbs().remove()},nouns:e=>{e.nouns().toSingular()},verbs:e=>{e.verbs().toInfinitive()},numbers:e=>{e.numbers().toNumber()},debullet:e=>{const t=/^\s*([-–—*•])\s*$/;return e.docs.forEach((e=>{t.test(e[0].pre)&&(e[0].pre=e[0].pre.replace(t,""))})),e}},ER=e=>e.split("|").reduce(((e,t)=>(e[t]=!0,e)),{}),xR="unicode|punctuation|whitespace|acronyms",IR="|case|contractions|parentheses|quotations|emoji|honorifics|debullet",CR={light:ER(xR),medium:ER(xR+IR),heavy:ER(xR+IR+"|possessives|adverbs|nouns|verbs")},OR={api:function(e){e.prototype.normalize=function(e="light"){return"string"==typeof e&&(e=CR[e]),Object.keys(e).forEach((t=>{TR.hasOwnProperty(t)&&TR[t](this,e[t])})),this}}},SR=["after","although","as if","as long as","as","because","before","even if","even though","ever since","if","in order that","provided that","since","so that","than","that","though","unless","until","what","whatever","when","whenever","where","whereas","wherever","whether","which","whichever","who","whoever","whom","whomever","whose"],NR=function(e){if(e.before("#Preposition$").found)return!0;if(!e.before().found)return!1;for(let t=0;t<SR.length;t+=1)if(e.has(SR[t]))return!0;return!1},jR=function(e,t){if(e.has("#Plural"))return!0;if(e.has("#Noun and #Noun"))return!0;if(e.has("(we|they)"))return!0;if(!0===t.has("(#Pronoun|#Place|#Value|#Person|#Uncountable|#Month|#WeekDay|#Holiday|#Possessive)"))return!1;if(e.has("#Singular"))return!1;let n=t.text("normal");return n.length>3&&n.endsWith("s")&&!n.endsWith("ss")},DR=function(e){let t=function(e){let t=e.clone();return t=t.match("#Noun+"),t=t.remove("(#Adjective|#Preposition|#Determiner|#Value)"),t=t.not("#Possessive"),t=t.first(),t.found?t:e}(e);return{determiner:e.match("#Determiner").eq(0),adjectives:e.match("#Adjective"),number:e.values(),isPlural:jR(e,t),isSubordinate:NR(e),root:t}},RR=e=>e.text(),$R=e=>e.json({terms:!1,normal:!0}).map((e=>e.normal)),LR=function(e){if(!e.found)return null;let t=e.values(0);return t.found?(t.parse()[0]||{}).num:null},MR=function(e){return!e.has("^(#Uncountable|#ProperNoun|#Place|#Pronoun|#Acronym)+$")},FR={tags:!0},UR={tags:!0},BR={api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Nouns"}parse(e){return this.getNth(e).map(DR)}json(e){let t="object"==typeof e?e:{};return this.getNth(e).map((e=>{let n=e.toView().json(t)[0]||{};return t&&!1!==t.noun&&(n.noun=function(e){let t=DR(e);return{root:RR(t.root),number:LR(t.number),determiner:RR(t.determiner),adjectives:$R(t.adjectives),isPlural:t.isPlural,isSubordinate:t.isSubordinate}}(e)),n}),[])}conjugate(e){const t=this.world.methods.two.transform.noun;return this.getNth(e).map((e=>{let n=DR(e),r=n.root.compute("root").text("root"),i={Singular:r};return MR(n.root)&&(i.Plural=t.toPlural(r,this.model)),i.Singular===i.Plural&&delete i.Plural,i}),[])}isPlural(e){let t=this.filter((e=>DR(e).isPlural));return t.getNth(e)}isSingular(e){let t=this.filter((e=>!DR(e).isPlural));return t.getNth(e)}adjectives(e){let t=this.update([]);return this.forEach((e=>{let n=DR(e).adjectives;n.found&&(t=t.concat(n))})),t.getNth(e)}toPlural(e){return this.getNth(e).map((e=>function(e,t){if(!0===t.isPlural)return e;if(t.root.has("#Possessive")&&(t.root=t.root.possessives().strip()),!MR(t.root))return e;const{methods:n,model:r}=e.world,{toPlural:i}=n.two.transform.noun;let s=i(t.root.text({keepPunct:!1}),r);e.match(t.root).replaceWith(s,FR).tag("Plural","toPlural"),t.determiner.has("(a|an)")&&e.remove(t.determiner);let a=t.root.after("not? #Adverb+? [#Copula]",0);return a.found&&(a.has("is")?e.replace(a,"are"):a.has("was")&&e.replace(a,"were")),e}(e,DR(e))))}toSingular(e){return this.getNth(e).map((e=>function(e,t){if(!1===t.isPlural)return e;const{methods:n,model:r}=e.world,{toSingular:i}=n.two.transform.noun;let s=i(t.root.text("normal"),r);return e.replace(t.root,s,UR).tag("Singular","toPlural"),e}(e,DR(e))))}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.nouns=function(e){let n=function(e){let t=e.clauses().match("<Noun>"),n=t.match("@hasComma");return n=n.not("#Place"),n.found&&(t=t.splitAfter(n)),t=t.splitOn("#Expression"),t=t.splitOn("(he|she|we|you|they|i)"),t=t.splitOn("(#Noun|#Adjective) [(he|him|she|it)]",0),t=t.splitOn("[(he|him|she|it)] (#Determiner|#Value)",0),t=t.splitBefore("#Noun [(the|a|an)] #Adjective? #Noun",0),t=t.splitOn("[(here|there)] #Noun",0),t=t.splitOn("[#Noun] (here|there)",0),t=t.splitBefore("(our|my|their|your)"),t=t.splitOn("#Noun [#Determiner]",0),t=t.if("#Noun"),t}(this);return n=n.getNth(e),new t(this.document,n.pointer)}}},VR={ones:{zeroth:0,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},teens:{tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19},tens:{twentieth:20,thirtieth:30,fortieth:40,fourtieth:40,fiftieth:50,sixtieth:60,seventieth:70,eightieth:80,ninetieth:90,twenty:20,thirty:30,forty:40,fourty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},multiples:{hundredth:100,thousandth:1e3,millionth:1e6,billionth:1e9,trillionth:1e12,quadrillionth:1e15,quintillionth:1e18,sextillionth:1e21,septillionth:1e24,hundred:100,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24,grand:1e3}},zR=(e,t)=>{if(VR.ones.hasOwnProperty(e)){if(t.ones||t.teens)return!1}else if(VR.teens.hasOwnProperty(e)){if(t.ones||t.teens||t.tens)return!1}else if(VR.tens.hasOwnProperty(e)&&(t.ones||t.teens||t.tens))return!1;return!0},HR=function(e){let t="0.";for(let n=0;n<e.length;n++){let r=e[n];if(!0===VR.ones.hasOwnProperty(r))t+=VR.ones[r];else if(!0===VR.teens.hasOwnProperty(r))t+=VR.teens[r];else if(!0===VR.tens.hasOwnProperty(r))t+=VR.tens[r];else{if(!0!==/^[0-9]$/.test(r))return 0;t+=r}}return parseFloat(t)},GR=e=>(e=(e=(e=(e=(e=(e=(e=e.replace(/1st$/,"1")).replace(/2nd$/,"2")).replace(/3rd$/,"3")).replace(/([4567890])r?th$/,"$1")).replace(/^[$€¥£¢]/,"")).replace(/[%$€¥£¢]$/,"")).replace(/,/g,"")).replace(/([0-9])([a-z\u00C0-\u00FF]{1,2})$/,"$1"),qR=/^([0-9,. ]+)\/([0-9,. ]+)$/,KR={"a few":3,"a couple":2,"a dozen":12,"two dozen":24,zero:0},WR=e=>Object.keys(e).reduce(((t,n)=>t+e[n]),0),JR=function(e){if(!0===KR.hasOwnProperty(e))return KR[e];if("a"===e||"an"===e)return 1;const t=(e=>{const t=[{reg:/^(minus|negative)[\s-]/i,mult:-1},{reg:/^(a\s)?half[\s-](of\s)?/i,mult:.5}];for(let n=0;n<t.length;n++)if(!0===t[n].reg.test(e))return{amount:t[n].mult,str:e.replace(t[n].reg,"")};return{amount:1,str:e}})(e);let n=null,r={},i=0,s=!1;const a=(e=t.str).split(/[ -]/);for(let e=0;e<a.length;e++){let o=a[e];if(o=GR(o),!o||"and"===o)continue;if("-"===o||"negative"===o){s=!0;continue}if("-"===o.charAt(0)&&(s=!0,o=o.substring(1)),"point"===o)return i+=WR(r),i+=HR(a.slice(e+1,a.length)),i*=t.amount,i;const l=o.match(qR);if(l){const e=parseFloat(l[1].replace(/[, ]/g,"")),t=parseFloat(l[2].replace(/[, ]/g,""));t&&(i+=e/t||0)}else{if(VR.tens.hasOwnProperty(o)&&r.ones&&1===Object.keys(r).length&&(i=100*r.ones,r={}),!1===zR(o,r))return null;if(/^[0-9.]+$/.test(o))r.ones=parseFloat(o);else if(!0===VR.ones.hasOwnProperty(o))r.ones=VR.ones[o];else if(!0===VR.teens.hasOwnProperty(o))r.teens=VR.teens[o];else if(!0===VR.tens.hasOwnProperty(o))r.tens=VR.tens[o];else if(!0===VR.multiples.hasOwnProperty(o)){let t=VR.multiples[o];if(t===n)return null;if(100===t&&void 0!==a[e+1]){const n=a[e+1];VR.multiples[n]&&(t*=VR.multiples[n],e+=1)}null===n||t<n?(i+=(WR(r)||1)*t,n=t,r={}):(i+=WR(r),n=t,i=(i||1)*t,r={})}}}return i+=WR(r),i*=t.amount,i*=s?-1:1,0===i&&0===Object.keys(r).length?null:i},ZR=/s$/,QR=function(e){let t=e.text("reduced");return JR(t)};let XR={half:2,halve:2,quarter:4};const YR=function(e){let t=function(e){let t=e.text("reduced");return XR.hasOwnProperty(t)?{numerator:1,denominator:XR[t]}:null}(e=e.clone())||function(e){let t=e.text("reduced").match(/^([-+]?[0-9]+)\/([-+]?[0-9]+)(st|nd|rd|th)?s?$/);return t&&t[1]&&t[0]?{numerator:Number(t[1]),denominator:Number(t[2])}:null}(e)||function(e){let t=e.match("[<num>#Value+] out of every? [<den>#Value+]");if(!0!==t.found)return null;let{num:n,den:r}=t.groups();return n&&r?(n=QR(n),r=QR(r),n&&r&&"number"==typeof n&&"number"==typeof r?{numerator:n,denominator:r}:null):null}(e)||function(e){let t=e.match("[<num>(#Cardinal|a)+] [<den>#Fraction+]");if(!0!==t.found)return null;let{num:n,den:r}=t.groups();n=n.has("a")?1:QR(n);let i=r.text("reduced");return ZR.test(i)&&(i=i.replace(ZR,""),r=r.replaceWith(i)),r=XR.hasOwnProperty(i)?XR[i]:QR(r),"number"==typeof n&&"number"==typeof r?{numerator:n,denominator:r}:null}(e)||function(e){let t=e.match("^#Ordinal$");return!0!==t.found?null:e.lookAhead("^of .")?{numerator:1,denominator:QR(t)}:null}(e)||null;return null!==t&&t.numerator&&t.denominator&&(t.decimal=t.numerator/t.denominator,t.decimal=(e=>{let t=Math.round(1e3*e)/1e3;return 0===t&&0!==e?e:t})(t.decimal)),t},e$=function(e){if(e<1e6)return String(e);let t;return t="number"==typeof e?e.toFixed(0):e,-1===t.indexOf("e+")?t:t.replace(".","").split("e+").reduce((function(e,t){return e+Array(t-e.length+2).join(0)}))},t$=[["ninety",90],["eighty",80],["seventy",70],["sixty",60],["fifty",50],["forty",40],["thirty",30],["twenty",20]],n$=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],r$=[[1e24,"septillion"],[1e20,"hundred sextillion"],[1e21,"sextillion"],[1e20,"hundred quintillion"],[1e18,"quintillion"],[1e17,"hundred quadrillion"],[1e15,"quadrillion"],[1e14,"hundred trillion"],[1e12,"trillion"],[1e11,"hundred billion"],[1e9,"billion"],[1e8,"hundred million"],[1e6,"million"],[1e5,"hundred thousand"],[1e3,"thousand"],[100,"hundred"],[1,"one"]],i$=function(e){let t=[];if(e>100)return t;for(let n=0;n<t$.length;n++)e>=t$[n][1]&&(e-=t$[n][1],t.push(t$[n][0]));return n$[e]&&t.push(n$[e]),t},s$=function(e){let t=e.num;if(0===t||"0"===t)return"zero";t>1e21&&(t=e$(t));let n=[];t<0&&(n.push("minus"),t=Math.abs(t));let r=function(e){let t=e,n=[];return r$.forEach((r=>{if(e>=r[0]){let e=Math.floor(t/r[0]);t-=e*r[0],e&&n.push({unit:r[1],count:e})}})),n}(t);for(let e=0;e<r.length;e++){let t=r[e].unit;"one"===t&&(t="",n.length>1&&n.push("and")),n=n.concat(i$(r[e].count)),n.push(t)}return n=n.concat((e=>{const t=["zero","one","two","three","four","five","six","seven","eight","nine"];let n=[],r=e$(e).match(/\.([0-9]+)/);if(!r||!r[0])return n;n.push("point");let i=r[0].split("");for(let e=0;e<i.length;e++)n.push(t[i[e]]);return n})(t)),n=n.filter((e=>e)),0===n.length&&(n[0]=""),n.join(" ")},a$={one:"first",two:"second",three:"third",five:"fifth",eight:"eighth",nine:"ninth",twelve:"twelfth",twenty:"twentieth",thirty:"thirtieth",forty:"fortieth",fourty:"fourtieth",fifty:"fiftieth",sixty:"sixtieth",seventy:"seventieth",eighty:"eightieth",ninety:"ninetieth"},o$=e=>{let t=s$(e).split(" "),n=t[t.length-1];return a$.hasOwnProperty(n)?t[t.length-1]=a$[n]:t[t.length-1]=n.replace(/y$/,"i")+"th",t.join(" ")},l$="twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety|fourty",c$=function(e){let t=e.match("#Value+");if(t.has("#NumericValue #NumericValue")&&(t.has("#Value @hasComma #Value")?t.splitAfter("@hasComma"):t.has("#NumericValue #Fraction")?t.splitAfter("#NumericValue #Fraction"):t=t.splitAfter("#NumericValue")),t.has("#Value #Value #Value")&&!t.has("#Multiple")&&t.has("("+l$+") #Cardinal #Cardinal")&&(t=t.splitAfter("("+l$+") #Cardinal")),t.has("#Value #Value")){t.has("#NumericValue #NumericValue")&&(t=t.splitOn("#Year")),t.has("("+l$+") (eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen)")&&(t=t.splitAfter("("+l$+")"));let e=t.match("#Cardinal #Cardinal");if(e.found&&!t.has("(point|decimal|#Fraction)")&&!e.has("#Cardinal (#Multiple|point|decimal)")){let n=t.has(`(one|two|three|four|five|six|seven|eight|nine) (${l$})`),r=e.has("("+l$+") #Cardinal"),i=e.has("#Multiple #Value");n||r||i||e.terms().forEach((e=>{t=t.splitOn(e)}))}t.match("#Ordinal #Ordinal").match("#TextValue").found&&!t.has("#Multiple")&&(t.has("("+l$+") #Ordinal")||(t=t.splitAfter("#Ordinal"))),t=t.splitBefore("#Ordinal [#Cardinal]",0),t.has("#TextValue #NumericValue")&&!t.has("("+l$+"|#Multiple)")&&(t=t.splitBefore("#TextValue #NumericValue"))}return t=t.splitAfter("#NumberRange"),t=t.splitBefore("#Year"),t},u$=function(e){if("string"==typeof e)return{num:JR(e)};let t=e.text("reduced"),n=e.growRight("#Unit").match("#Unit$").text("machine"),r=/[0-9],[0-9]/.test(e.text("text"));if(1===e.terms().length&&!e.has("#Multiple")){let i=function(e,t){let n=(e=e.replace(/,/g,"")).split(/([0-9.,]*)/),[r,i]=n,s=n.slice(2).join("");return""!==i&&t.length<2?(i=Number(i||e),"number"!=typeof i&&(i=null),s=s||"","st"!==s&&"nd"!==s&&"rd"!==s&&"th"!==s||(s=""),{prefix:r||"",num:i,suffix:s}):null}(t,e);if(null!==i)return i.hasComma=r,i.unit=n,i}let i=e.match("#Fraction{2,}$");i=!1===i.found?e.match("^#Fraction$"):i;let s=null;i.found&&(i.has("#Value and #Value #Fraction")&&(i=i.match("and #Value #Fraction")),s=YR(i),t=(e=(e=e.not(i)).not("and$")).text("reduced"));let a=0;return t&&(a=JR(t)||0),s&&s.decimal&&(a+=s.decimal),{hasComma:r,prefix:"",num:a,suffix:"",isOrdinal:e.has("#Ordinal"),isText:e.has("#TextValue"),isFraction:e.has("#Fraction"),isMoney:e.has("#Money"),unit:n}},h$={"¢":"cents",$:"dollars","£":"pounds","¥":"yen","€":"euros","₡":"colón","฿":"baht","₭":"kip","₩":"won","₹":"rupees","₽":"ruble","₺":"liras"},d$={"%":"percent","°":"degrees"},p$=function(e){let t={suffix:"",prefix:e.prefix};return h$.hasOwnProperty(e.prefix)&&(t.suffix+=" "+h$[e.prefix],t.prefix=""),d$.hasOwnProperty(e.suffix)&&(t.suffix+=" "+d$[e.suffix]),t.suffix&&1===e.num&&(t.suffix=t.suffix.replace(/s$/,"")),!t.suffix&&e.suffix&&(t.suffix+=" "+e.suffix),t},f$=function(e,t){if("TextOrdinal"===t){let{prefix:t,suffix:n}=p$(e);return t+o$(e)+n}if("Ordinal"===t)return e.prefix+function(e){let t=e.num;if(!t&&0!==t)return null;let n=t%100;if(n>10&&n<20)return String(t)+"th";const r={0:"th",1:"st",2:"nd",3:"rd"};let i=e$(t),s=i.slice(i.length-1,i.length);return i+=r[s]?r[s]:"th",i}(e)+e.suffix;if("TextCardinal"===t){let{prefix:t,suffix:n}=p$(e);return t+s$(e)+n}let n=e.num;return e.hasComma&&(n=n.toLocaleString()),e.prefix+String(n)+e.suffix},m$={api:function(e){(function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Fractions"}parse(e){return this.getNth(e).map(YR)}get(e){return this.getNth(e).map(YR)}json(e){return this.getNth(e).map((t=>{let n=t.toView().json(e)[0],r=YR(t);return n.fraction=r,n}),[])}toDecimal(e){return this.getNth(e).forEach((e=>{let{decimal:t}=YR(e);(e=e.replaceWith(String(t),!0)).tag("NumericValue"),e.unTag("Fraction")})),this}toFraction(e){return this.getNth(e).forEach((e=>{let t=YR(e);if(t&&"number"==typeof t.numerator&&"number"==typeof t.denominator){let n=`${t.numerator}/${t.denominator}`;this.replace(e,n)}})),this}toOrdinal(e){return this.getNth(e).forEach((e=>{let t=function(e){if(!e.numerator||!e.denominator)return"";let t=s$({num:e.numerator}),n=o$({num:e.denominator});return 2===e.denominator&&(n="half"),t&&n?(1!==e.numerator&&(n+="s"),`${t} ${n}`):""}(YR(e));e.after("^#Noun").found&&(t+=" of"),e.replaceWith(t)})),this}toCardinal(e){return this.getNth(e).forEach((e=>{let t=function(e){return e.numerator&&e.denominator?`${s$({num:e.numerator})} out of ${s$({num:e.denominator})}`:""}(YR(e));e.replaceWith(t)})),this}toPercentage(e){return this.getNth(e).forEach((e=>{let{decimal:t}=YR(e),n=100*t;n=Math.round(100*n)/100,e.replaceWith(`${n}%`)})),this}}e.prototype.fractions=function(e){let n=function(e,t){let n=e.match("#Fraction+");return n=n.filter((e=>!e.lookBehind("#Value and$").found)),n=n.notIf("#Value seconds"),n}(this);return n=n.getNth(e),new t(this.document,n.pointer)}})(e),function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Numbers"}parse(e){return this.getNth(e).map(u$)}get(e){return this.getNth(e).map(u$).map((e=>e.num))}json(e){let t="object"==typeof e?e:{};return this.getNth(e).map((e=>{let n=e.toView().json(t)[0],r=u$(e);return n.number={prefix:r.prefix,num:r.num,suffix:r.suffix,hasComma:r.hasComma,unit:r.unit},n}),[])}units(){return this.growRight("#Unit").match("#Unit$")}isUnit(e){return function(e,t={}){return t=function(e){if("string"==typeof e||"number"==typeof e){let t={};return t[e]=!0,t}return t=e,"[object Array]"===Object.prototype.toString.call(t)?e.reduce(((e,t)=>(e[t]=!0,e)),{}):e||{};var t}(t),e.filter((e=>{let{unit:n}=u$(e);return!(!n||!0!==t[n])}))}(this,e)}isOrdinal(){return this.if("#Ordinal")}isCardinal(){return this.if("#Cardinal")}toNumber(){let e=this.map((e=>{if(!this.has("#TextValue"))return e;let t=u$(e);if(null===t.num)return e;let n=e.has("#Ordinal")?"Ordinal":"Cardinal",r=f$(t,n);return e.replaceWith(r,{tags:!0}),e.tag("NumericValue")}));return new t(e.document,e.pointer)}toLocaleString(){return this.forEach((e=>{let t=u$(e);if(null===t.num)return;let n=t.num.toLocaleString();if(e.has("#Ordinal")){let e=f$(t,"Ordinal").match(/[a-z]+$/);e&&(n+=e[0]||"")}e.replaceWith(n,{tags:!0})})),this}toText(){let e=this.map((e=>{if(e.has("#TextValue"))return e;let t=u$(e);if(null===t.num)return e;let n=e.has("#Ordinal")?"TextOrdinal":"TextCardinal",r=f$(t,n);return e.replaceWith(r,{tags:!0}),e.tag("TextValue"),e}));return new t(e.document,e.pointer)}toCardinal(){let e=this.map((e=>{if(!e.has("#Ordinal"))return e;let t=u$(e);if(null===t.num)return e;let n=e.has("#TextValue")?"TextCardinal":"Cardinal",r=f$(t,n);return e.replaceWith(r,{tags:!0}),e.tag("Cardinal"),e}));return new t(e.document,e.pointer)}toOrdinal(){let e=this.map((e=>{if(e.has("#Ordinal"))return e;let t=u$(e);if(null===t.num)return e;let n=e.has("#TextValue")?"TextOrdinal":"Ordinal",r=f$(t,n);return e.replaceWith(r,{tags:!0}),e.tag("Ordinal"),e}));return new t(e.document,e.pointer)}isEqual(e){return this.filter((t=>u$(t).num===e))}greaterThan(e){return this.filter((t=>u$(t).num>e))}lessThan(e){return this.filter((t=>u$(t).num<e))}between(e,t){return this.filter((n=>{let r=u$(n).num;return r>e&&r<t}))}set(e){if(void 0===e)return this;"string"==typeof e&&(e=u$(e).num);let n=this.map((t=>{let n=u$(t);if(n.num=e,null===n.num)return t;let r=t.has("#Ordinal")?"Ordinal":"Cardinal";t.has("#TextValue")&&(r=t.has("#Ordinal")?"TextOrdinal":"TextCardinal");let i=f$(n,r);return n.hasComma&&"Cardinal"===r&&(i=Number(i).toLocaleString()),(t=t.not("#Currency")).replaceWith(i,{tags:!0}),t}));return new t(n.document,n.pointer)}add(e){if(!e)return this;"string"==typeof e&&(e=u$(e).num);let n=this.map((t=>{let n=u$(t);if(null===n.num)return t;n.num+=e;let r=t.has("#Ordinal")?"Ordinal":"Cardinal";n.isText&&(r=t.has("#Ordinal")?"TextOrdinal":"TextCardinal");let i=f$(n,r);return t.replaceWith(i,{tags:!0}),t}));return new t(n.document,n.pointer)}subtract(e,t){return this.add(-1*e,t)}increment(e){return this.add(1,e)}decrement(e){return this.add(-1,e)}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}t.prototype.toNice=t.prototype.toLocaleString,t.prototype.isBetween=t.prototype.between,t.prototype.minus=t.prototype.subtract,t.prototype.plus=t.prototype.add,t.prototype.equals=t.prototype.isEqual,e.prototype.numbers=function(e){let n=c$(this);return n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.percentages=function(e){let n=c$(this);return n=n.filter((e=>e.has("#Percent")||e.after("^percent"))),n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.money=function(e){let n=c$(this);return n=n.filter((e=>e.has("#Money")||e.after("^#Currency"))),n=n.getNth(e),new t(this.document,n.pointer)},e.prototype.values=e.prototype.numbers}(e)}},g$={people:!0,emails:!0,phoneNumbers:!0,places:!0},y$=function(e={}){return!1!==(e=Object.assign({},g$,e)).people&&this.people().replaceWith("██████████"),!1!==e.emails&&this.emails().replaceWith("██████████"),!1!==e.places&&this.places().replaceWith("██████████"),!1!==e.phoneNumbers&&this.phoneNumbers().replaceWith("███████"),this},v$={api:function(e){e.prototype.redact=y$}},b$=v$,w$=function(e){let t=null;return e.has("#PastTense")?t="PastTense":e.has("#FutureTense")?t="FutureTense":e.has("#PresentTense")&&(t="PresentTense"),{tense:t}},_$=function(e){let t=function(e){let t=e;return 1===t.length?t:(t=t.if("#Verb"),1===t.length?t:(t=t.ifNo("(after|although|as|because|before|if|since|than|that|though|when|whenever|where|whereas|wherever|whether|while|why|unless|until|once)"),t=t.ifNo("^even (if|though)"),t=t.ifNo("^so that"),t=t.ifNo("^rather than"),t=t.ifNo("^provided that"),1===t.length?t:(t=t.ifNo("(that|which|whichever|who|whoever|whom|whose|whomever)"),1===t.length?t:(t=t.ifNo("(^despite|^during|^before|^through|^throughout)"),1===t.length?t:(t=t.ifNo("^#Gerund"),1===t.length?t:(0===t.length&&(t=e),t.eq(0)))))))}(e.clauses()).chunks(),n=e.none(),r=e.none(),i=e.none();return t.forEach(((e,t)=>{0!==t||e.has("<Verb>")?r.found||!e.has("<Verb>")?r.found&&(i=i.concat(e)):r=e:n=e})),r.found&&!n.found&&(n=r.before("<Noun>+").first()),{subj:n,verb:r,pred:i,grammar:w$(r)}},k$={api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Sentences"}json(e={}){return this.map((t=>{let n=t.toView().json(e)[0]||{},{subj:r,verb:i,pred:s,grammar:a}=_$(t);return n.sentence={subject:r.text("normal"),verb:i.text("normal"),predicate:s.text("normal"),grammar:a},n}),[])}toPastTense(e){return this.getNth(e).map((e=>(_$(e),function(e){let t=e.verbs(),n=t.eq(0);if(n.has("#PastTense"))return e;if(n.toPastTense(),t.length>1){t=t.slice(1),t=t.filter((e=>!e.lookBehind("to$").found)),t=t.if("#PresentTense"),t=t.notIf("#Gerund");let n=e.match("to #Verb+ #Conjunction #Verb").terms();t=t.not(n),t.found&&t.verbs().toPastTense()}return e}(e))))}toPresentTense(e){return this.getNth(e).map((e=>(_$(e),function(e){let t=e.verbs();return t.eq(0).toPresentTense(),t.length>1&&(t=t.slice(1),t=t.filter((e=>!e.lookBehind("to$").found)),t=t.notIf("#Gerund"),t.found&&t.verbs().toPresentTense()),e}(e))))}toFutureTense(e){return this.getNth(e).map((e=>(_$(e),function(e){let t=e.verbs();if(t.eq(0).toFutureTense(),t=(e=e.fullSentence()).verbs(),t.length>1){t=t.slice(1);let e=t.filter((e=>!(e.lookBehind("to$").found||!e.has("#Copula #Gerund")&&(e.has("#Gerund")||!e.has("#Copula")&&e.has("#PresentTense")&&!e.has("#Infinitive")&&e.lookBefore("(he|she|it|that|which)$").found))));e.found&&e.forEach((e=>{if(e.has("#Copula"))return e.match("was").replaceWith("is"),void e.match("is").replaceWith("will be");e.toInfinitive()}))}return e}(e))))}toInfinitive(e){return this.getNth(e).map((e=>(_$(e),function(e){return e.verbs().toInfinitive(),e}(e))))}toNegative(e){return this.getNth(e).map((e=>(_$(e),function(e){return e.verbs().first().toNegative().compute("chunks"),e}(e))))}toPositive(e){return this.getNth(e).map((e=>(_$(e),function(e){return e.verbs().first().toPositive().compute("chunks"),e}(e))))}isQuestion(e){return this.questions(e)}isExclamation(e){let t=this.filter((e=>e.lastTerm().has("@hasExclamation")));return t.getNth(e)}isStatement(e){let t=this.filter((e=>!e.isExclamation().found&&!e.isQuestion().found));return t.getNth(e)}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}t.prototype.toPresent=t.prototype.toPresentTense,t.prototype.toPast=t.prototype.toPastTense,t.prototype.toFuture=t.prototype.toFutureTense;const n={sentences:function(e){let n=this.map((e=>e.fullSentence()));return n=n.getNth(e),new t(this.document,n.pointer)},questions:function(e){return function(e){const t=/\?/,{document:n}=e;return e.filter((e=>{let r=e.docs[0]||[],i=r[r.length-1];return!(!i||n[i.index[0]].length!==r.length)&&(!!t.test(i.post)||function(e){let t=e.clauses();return!(/\.\.$/.test(e.out("text"))||e.has("^#QuestionWord")&&e.has("@hasComma")||!e.has("or not$")&&!e.has("^#QuestionWord")&&!e.has("^(do|does|did|is|was|can|could|will|would|may) #Noun")&&!e.has("^(have|must) you")&&!t.has("(do|does|is|was) #Noun+ #Adverb? (#Adjective|#Infinitive)$"))}(e))}))}(this).getNth(e)}};Object.assign(e.prototype,n)}},A$=function(e){let t={};t.firstName=e.match("#FirstName+"),t.lastName=e.match("#LastName+"),t.honorific=e.match("#Honorific+");let n=t.lastName,r=t.firstName;return r.found&&n.found||r.found||n.found||!e.has("^#Honorific .$")||(t.lastName=e.match(".$")),t},P$="male",T$="female",E$={mr:P$,mrs:T$,miss:T$,madam:T$,king:P$,queen:T$,duke:P$,duchess:T$,baron:P$,baroness:T$,count:P$,countess:T$,prince:P$,princess:T$,sire:P$,dame:T$,lady:T$,ayatullah:P$,congressman:P$,congresswoman:T$,"first lady":T$,mx:null},x$=function(e,t){let{firstName:n,honorific:r}=e;if(n.has("#FemaleName"))return T$;if(n.has("#MaleName"))return P$;if(r.found){let e=r.text("normal");if(e=e.replace(/\./g,""),E$.hasOwnProperty(e))return E$[e];if(/^her /.test(e))return T$;if(/^his /.test(e))return P$}let i=t.after();if(!i.has("#Person")&&i.has("#Pronoun")){let e=i.match("#Pronoun");if(e.has("(they|their)"))return null;let t=e.has("(he|his)"),n=e.has("(she|her|hers)");if(t&&!n)return P$;if(n&&!t)return T$}return null},I$=function(e){let t=this.clauses(),n=t.people();return n=n.concat(t.places()),n=n.concat(t.organizations()),n=n.not("(someone|man|woman|mother|brother|sister|father)"),n=n.sort("seq"),n=n.getNth(e),n},C$={api:function(e){(function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="People"}parse(e){return this.getNth(e).map(A$)}json(e){let t="object"==typeof e?e:{};return this.getNth(e).map((e=>{let n=e.toView().json(t)[0],r=A$(e);return n.person={firstName:r.firstName.text("normal"),lastName:r.lastName.text("normal"),honorific:r.honorific.text("normal"),presumed_gender:x$(r,e)},n}),[])}presumedMale(){return this.filter((e=>e.has("(#MaleName|mr|mister|sr|jr|king|pope|prince|sir)")))}presumedFemale(){return this.filter((e=>e.has("(#FemaleName|mrs|miss|queen|princess|madam)")))}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.people=function(e){let n=function(e){let t=e.splitAfter("@hasComma");t=t.match("#Honorific+? #Person+");let n=t.match("#Possessive").notIf("(his|her)");return t=t.splitAfter(n),t}(this);return n=n.getNth(e),new t(this.document,n.pointer)}})(e),function(e){e.prototype.places=function(t){let n=function(e){let t=e.match("(#Place|#Address)+"),n=t.match("@hasComma");return n=n.filter((e=>!!e.has("(asia|africa|europe|america)$")||!e.has("(#City|#Region|#ProperNoun)$")||!e.after("^(#Country|#Region)").found)),t=t.splitAfter(n),t}(this);return n=n.getNth(t),new e(this.document,n.pointer)}}(e),function(e){e.prototype.organizations=function(e){return this.match("#Organization+").getNth(e)}}(e),function(e){e.prototype.topics=I$}(e)}},O$=function(e,t){let n={pre:e.none(),post:e.none()};if(!e.has("#Adverb"))return n;let r=e.splitOn(t);return 3===r.length?{pre:r.eq(0).adverbs(),post:r.eq(2).adverbs()}:r.eq(0).isDoc(t)?(n.post=r.eq(1).adverbs(),n):(n.pre=r.eq(0).adverbs(),n)},S$=function(e,t){let n=e.splitBefore(t);if(n.length<=1)return e.none();let r=n.eq(0);return r=r.not("(#Adverb|#Negative|#Prefix)"),r},N$=function(e){return e.match("#Negative")},j$=function(e){if(!e.has("(#Particle|#PhrasalVerb)"))return{verb:e.none(),particle:e.none()};let t=e.match("#Particle$");return{verb:e.not(t),particle:t}},D$=function(e){let t=e.clone();t.contractions().expand();const n=function(e){let t=e;return e.wordCount()>1&&(t=e.not("(#Negative|#Auxiliary|#Modal|#Adverb|#Prefix)")),t.length>1&&!t.has("#Phrasal #Particle")&&(t=t.last()),t=t.not("(want|wants|wanted) to"),t.found||(t=e.not("#Negative")),t}(t);return{root:n,prefix:t.match("#Prefix"),adverbs:O$(t,n),auxiliary:S$(t,n),negative:N$(t),phrasal:j$(n)}},R$={tense:"PresentTense"},$$={conditional:!0},L$={tense:"FutureTense"},M$={progressive:!0},F$={tense:"PastTense"},U$={complete:!0,progressive:!1},B$={passive:!0},V$=function(e){let t={};return e.forEach((e=>{Object.assign(t,e)})),t},z$={imperative:[["#Imperative",[]]],"want-infinitive":[["^(want|wants|wanted) to #Infinitive$",[R$]],["^wanted to #Infinitive$",[F$]],["^will want to #Infinitive$",[L$]]],"gerund-phrase":[["^#PastTense #Gerund$",[F$]],["^#PresentTense #Gerund$",[R$]],["^#Infinitive #Gerund$",[R$]],["^will #Infinitive #Gerund$",[L$]],["^have #PastTense #Gerund$",[F$]],["^will have #PastTense #Gerund$",[F$]]],"simple-present":[["^#PresentTense$",[R$]],["^#Infinitive$",[R$]]],"simple-past":[["^#PastTense$",[F$]]],"simple-future":[["^will #Adverb? #Infinitive",[L$]]],"present-progressive":[["^(is|are|am) #Gerund$",[R$,M$]]],"past-progressive":[["^(was|were) #Gerund$",[F$,M$]]],"future-progressive":[["^will be #Gerund$",[L$,M$]]],"present-perfect":[["^(has|have) #PastTense$",[F$,U$]]],"past-perfect":[["^had #PastTense$",[F$,U$]],["^had #PastTense to #Infinitive",[F$,U$]]],"future-perfect":[["^will have #PastTense$",[L$,U$]]],"present-perfect-progressive":[["^(has|have) been #Gerund$",[F$,M$]]],"past-perfect-progressive":[["^had been #Gerund$",[F$,M$]]],"future-perfect-progressive":[["^will have been #Gerund$",[L$,M$]]],"passive-past":[["(got|were|was) #Passive",[F$,B$]],["^(was|were) being #Passive",[F$,B$]],["^(had|have) been #Passive",[F$,B$]]],"passive-present":[["^(is|are|am) #Passive",[R$,B$]],["^(is|are|am) being #Passive",[R$,B$]],["^has been #Passive",[R$,B$]]],"passive-future":[["will have been #Passive",[L$,B$,$$]],["will be being? #Passive",[L$,B$,$$]]],"present-conditional":[["would be #PastTense",[R$,$$]]],"past-conditional":[["would have been #PastTense",[F$,$$]]],"auxiliary-future":[["(is|are|am|was) going to (#Infinitive|#PresentTense)",[L$]]],"auxiliary-past":[["^did #Infinitive$",[F$,{plural:!1}]],["^used to #Infinitive$",[F$,U$]]],"auxiliary-present":[["^(does|do) #Infinitive$",[R$,U$,{plural:!0}]]],"modal-past":[["^(could|must|should|shall) have #PastTense$",[F$]]],"modal-infinitive":[["^#Modal #Infinitive$",[]]],infinitive:[["^#Infinitive$",[]]]};let H$=[];Object.keys(z$).map((e=>{z$[e].forEach((t=>{H$.push({name:e,match:t[0],data:V$(t[1])})}))}));const G$=H$,q$=function(e,t){let n={};e=function(e,t){return e=e.clone(),t.adverbs.post&&t.adverbs.post.found&&e.remove(t.adverbs.post),t.adverbs.pre&&t.adverbs.pre.found&&e.remove(t.adverbs.pre),e.has("#Negative")&&(e=e.remove("#Negative")),e.has("#Prefix")&&(e=e.remove("#Prefix")),t.root.has("#PhrasalVerb #Particle")&&e.remove("#Particle$"),e.not("#Adverb")}(e,t);for(let t=0;t<G$.length;t+=1){let r=G$[t];if(!0===e.has(r.match)){n.form=r.name,Object.assign(n,r.data);break}}return n.form||e.has("^#Verb$")&&(n.form="infinitive"),n.tense||(n.tense=t.root.has("#PastTense")?"PastTense":"PresentTense"),n.copula=t.root.has("#Copula"),n.isInfinitive=function(e){return!(!e.has("#Infinitive")||!e.growLeft("to").has("^to #Infinitive"))}(e),n},K$=function(e){return!(e.length<=1)&&(e.parse()[0]||{}).isSubordinate},W$=function(e,t){return!!t.has("(are|were|does)")||!!e.has("(those|they|we)")||!(!e.found||!e.isPlural)&&e.isPlural().found},J$=function(e){let t=function(e){let t=e.before();t=function(e){let t=e.clauses();return t=t.filter(((e,t)=>!(e.has("^(if|unless|while|but|for|per|at|by|that|which|who|from)")||t>0&&e.has("^#Verb . #Noun+$")||t>0&&e.has("^#Adverb")))),0===t.length?e:t}(t);let n=t.nouns(),r=n.last(),i=r.match("(i|he|she|we|you|they)");if(i.found)return i.nouns();let s=n.if("^(that|this|those)");return s.found||!1===n.found&&(s=t.match("^(that|this|those)"),s.found)?s:(r=n.last(),K$(r)&&(n.remove(r),r=n.last()),K$(r)&&(n.remove(r),r=n.last()),r)}(e);return{subject:t,plural:W$(t,e)}},Z$=e=>e,Q$=(e,t)=>{let n=J$(e),r=n.subject;return!(!r.has("i")&&!r.has("we"))||n.plural},X$=function(e,t){if(e.has("were"))return"are";let{subject:n,plural:r}=J$(e);return n.has("i")?"am":n.has("we")||r?"are":"is"},Y$=function(e,t){let n=J$(e),r=n.subject;return r.has("i")||r.has("we")||n.plural?"do":"does"},eL=function(e){return e.has("#Infinitive")?"Infinitive":e.has("#Participle")?"Participle":e.has("#PastTense")?"PastTense":e.has("#Gerund")?"Gerund":e.has("#PresentTense")?"PresentTense":void 0},tL=function(e,t){const{toInfinitive:n}=e.methods.two.transform.verb;let r=t.root.text({keepPunct:!1});return r=n(r,e.model,eL(e)),r&&e.replace(t.root,r),e},nL=e=>e.has("will not")?e.replace("will not","have not"):e.remove("will"),rL=function(e){return e&&e.isView?e.json({normal:!0,terms:!1,text:!1}).map((e=>e.normal)):[]},iL=function(e){return e&&e.isView?e.text("normal"):""},sL=function(e){const{toInfinitive:t}=e.methods.two.transform.verb;return t(e.text("normal"),e.model,eL(e))},aL={tags:!0},oL={tags:!0},lL={noAux:(e,t)=>(t.auxiliary.found&&(e=e.remove(t.auxiliary)),e),simple:(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;if(i.has("#Modal"))return e;let s=i.text({keepPunct:!1});return s=r(s,e.model,eL(i)),s=n(s,e.model).PastTense,s="been"===s?"was":s,"was"===s&&(s=((e,t)=>{let{subject:n,plural:r}=J$(e);return r||n.has("we")?"were":"was"})(e)),s&&e.replace(i,s,oL),e},both:function(e,t){return t.negative.found?(e.replace("will","did"),e):(e=lL.simple(e,t),e=lL.noAux(e,t))},hasHad:e=>(e.replace("has","had",oL),e),hasParticiple:(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;let s=i.text("normal");return s=r(s,e.model,eL(i)),n(s,e.model).Participle}},cL={infinitive:lL.simple,"simple-present":lL.simple,"simple-past":Z$,"simple-future":lL.both,"present-progressive":e=>(e.replace("are","were",oL),e.replace("(is|are|am)","was",oL),e),"past-progressive":Z$,"future-progressive":(e,t)=>(e.match(t.root).insertBefore("was"),e.remove("(will|be)"),e),"present-perfect":lL.hasHad,"past-perfect":Z$,"future-perfect":(e,t)=>(e.match(t.root).insertBefore("had"),e.has("will")&&(e=nL(e)),e.remove("have"),e),"present-perfect-progressive":lL.hasHad,"past-perfect-progressive":Z$,"future-perfect-progressive":e=>(e.remove("will"),e.replace("have","had",oL),e),"passive-past":e=>(e.replace("have","had",oL),e),"passive-present":e=>(e.replace("(is|are)","was",oL),e),"passive-future":(e,t)=>(t.auxiliary.has("will be")&&(e.match(t.root).insertBefore("had been"),e.remove("(will|be)")),t.auxiliary.has("will have been")&&(e.replace("have","had",oL),e.remove("will")),e),"present-conditional":e=>(e.replace("be","have been"),e),"past-conditional":Z$,"auxiliary-future":e=>(e.replace("(is|are|am)","was",oL),e),"auxiliary-past":Z$,"auxiliary-present":e=>(e.replace("(do|does)","did",oL),e),"modal-infinitive":(e,t)=>(e.has("can")?e.replace("can","could",oL):(lL.simple(e,t),e.match("#Modal").insertAfter("have").tag("Auxiliary")),e),"modal-past":Z$,"want-infinitive":e=>(e.replace("(want|wants)","wanted",oL),e.remove("will"),e),"gerund-phrase":(e,t)=>(t.root=t.root.not("#Gerund$"),lL.simple(e,t),nL(e),e)},uL=function(e,t){let n=J$(e),r=n.subject;return r.has("(i|we|you)")?"have":!1===n.plural||r.has("he")||r.has("she")||r.has("#Person")?"has":"have"},hL=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,{root:i,auxiliary:s}=t;if(i.has("#Modal"))return e;let a=i.text({keepPunct:!1});a=r(a,e.model,eL(i));let o=n(a,e.model);if(a=o.Participle||o.PastTense,a){e=e.replace(i,a);let t=uL(e);e.prepend(t).match(t).tag("Auxiliary"),e.remove(s)}return e},dL={infinitive:hL,"simple-present":hL,"simple-future":(e,t)=>e.replace("will",uL(e)),"present-perfect":Z$,"past-perfect":Z$,"future-perfect":(e,t)=>e.replace("will have",uL(e)),"present-perfect-progressive":Z$,"past-perfect-progressive":Z$,"future-perfect-progressive":Z$},pL={tags:!0},fL=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;let s=i.text("normal");return s=r(s,e.model,eL(i)),!1===Q$(e)&&(s=n(s,e.model).PresentTense),i.has("#Copula")&&(s=X$(e)),s&&(e=e.replace(i,s,pL)).not("#Particle").tag("PresentTense"),e},mL=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,i=t.root;let s=i.text("normal");return s=r(s,e.model,eL(i)),!1===Q$(e)&&(s=n(s,e.model).Gerund),s&&(e=e.replace(i,s,pL)).not("#Particle").tag("Gerund"),e},gL={infinitive:fL,"simple-present":(e,t)=>{const{conjugate:n}=e.methods.two.transform.verb;let{root:r}=t;if(!r.has("#Infinitive"))return fL(e,t);{let t=J$(e).subject;if(Q$(e)||t.has("i"))return e;let i=r.text("normal"),s=n(i,e.model).PresentTense;i!==s&&e.replace(r,s,pL)}return e},"simple-past":fL,"simple-future":(e,t)=>{const{root:n,auxiliary:r}=t;if(r.has("will")&&n.has("be")){let t=X$(e);e.replace(n,t),(e=e.remove("will")).replace("not "+t,t+" not")}else fL(e,t),e=e.remove("will");return e},"present-progressive":Z$,"past-progressive":(e,t)=>{let n=X$(e);return e.replace("(were|was)",n,pL)},"future-progressive":e=>(e.match("will").insertBefore("is"),e.remove("be"),e.remove("will")),"present-perfect":(e,t)=>(fL(e,t),e.remove("(have|had|has)")),"past-perfect":(e,t)=>{let n=J$(e).subject;return Q$(e)||n.has("i")?((e=tL(e,t)).remove("had"),e):(e.replace("had","has",pL),e)},"future-perfect":e=>(e.match("will").insertBefore("has"),e.remove("have").remove("will")),"present-perfect-progressive":Z$,"past-perfect-progressive":e=>e.replace("had","has",pL),"future-perfect-progressive":e=>(e.match("will").insertBefore("has"),e.remove("have").remove("will")),"passive-past":(e,t)=>{let n=X$(e);return e.has("(had|have|has)")&&e.has("been")?(e.replace("(had|have|has)",n,pL),e.replace("been","being"),e):e.replace("(got|was|were)",n)},"passive-present":Z$,"passive-future":e=>(e.replace("will","is"),e.replace("be","being")),"present-conditional":Z$,"past-conditional":e=>(e.replace("been","be"),e.remove("have")),"auxiliary-future":(e,t)=>(mL(e,t),e.remove("(going|to)"),e),"auxiliary-past":(e,t)=>{if(t.auxiliary.has("did")){let n=Y$(e);return e.replace(t.auxiliary,n),e}return mL(e,t),e.replace(t.auxiliary,"is"),e},"auxiliary-present":Z$,"modal-infinitive":Z$,"modal-past":(e,t)=>(((e,t)=>{const{toInfinitive:n}=e.methods.two.transform.verb,r=t.root;let i=t.root.text("normal");i=n(i,e.model,eL(r)),i&&(e=e.replace(t.root,i,pL))})(e,t),e.remove("have")),"gerund-phrase":(e,t)=>(t.root=t.root.not("#Gerund$"),fL(e,t),e.remove("(will|have)")),"want-infinitive":(e,t)=>{let n="wants";return Q$(e)&&(n="want"),e.replace("(want|wanted|wants)",n,pL),e.remove("will"),e}},yL={tags:!0},vL=(e,t)=>{const{toInfinitive:n}=e.methods.two.transform.verb,{root:r,auxiliary:i}=t;if(r.has("#Modal"))return e;let s=r.text("normal");return s=n(s,e.model,eL(r)),s&&(e=e.replace(r,s,yL)).not("#Particle").tag("Verb"),e.prepend("will").match("will").tag("Auxiliary"),e.remove(i),e},bL=(e,t)=>{const{conjugate:n,toInfinitive:r}=e.methods.two.transform.verb,{root:i,auxiliary:s}=t;let a=i.text("normal");return a=r(a,e.model,eL(i)),a&&(a=n(a,e.model).Gerund,e.replace(i,a,yL),e.not("#Particle").tag("PresentTense")),e.remove(s),e.prepend("will be").match("will be").tag("Auxiliary"),e},wL={infinitive:vL,"simple-present":vL,"simple-past":vL,"simple-future":Z$,"present-progressive":bL,"past-progressive":bL,"future-progressive":Z$,"present-perfect":e=>(e.match("(have|has)").replaceWith("will have"),e),"past-perfect":e=>e.replace("(had|has)","will have"),"future-perfect":Z$,"present-perfect-progressive":e=>e.replace("has","will have"),"past-perfect-progressive":e=>e.replace("had","will have"),"future-perfect-progressive":Z$,"passive-past":e=>e.has("got")?e.replace("got","will get"):e.has("(was|were)")?(e.replace("(was|were)","will be"),e.remove("being")):e.has("(have|has|had) been")?e.replace("(have|has|had) been","will be"):e,"passive-present":e=>(e.replace("being","will be"),e.remove("(is|are|am)"),e),"passive-future":Z$,"present-conditional":e=>e.replace("would","will"),"past-conditional":e=>e.replace("would","will"),"auxiliary-future":Z$,"auxiliary-past":e=>e.has("used")&&e.has("to")?(e.replace("used","will"),e.remove("to")):(e.replace("did","will"),e),"auxiliary-present":e=>e.replace("(do|does)","will"),"modal-infinitive":Z$,"modal-past":Z$,"gerund-phrase":(e,t)=>(t.root=t.root.not("#Gerund$"),vL(e,t),e.remove("(had|have)")),"want-infinitive":e=>(e.replace("(want|wants|wanted)","will want"),e)},_L={tags:!0},kL={tags:!0},AL=function(e,t){let n=Y$(e);return e.prepend(n+" not"),e},PL=function(e){let t=e.match("be");return t.found?(t.prepend("not"),e):(t=e.match("(is|was|am|are|will|were)"),t.found?(t.append("not"),e):e)},TL=e=>e.has("(is|was|am|are|will|were|be)"),EL={"simple-present":(e,t)=>!0===TL(e)?PL(e):(e=tL(e,t),e=AL(e)),"simple-past":(e,t)=>!0===TL(e)?PL(e):((e=tL(e,t)).prepend("did not"),e),imperative:e=>(e.prepend("do not"),e),infinitive:(e,t)=>!0===TL(e)?PL(e):AL(e),"passive-past":e=>{if(e.has("got"))return e.replace("got","get",kL),e.prepend("did not"),e;let t=e.match("(was|were|had|have)");return t.found&&t.append("not"),e},"auxiliary-past":e=>{if(e.has("used"))return e.prepend("did not"),e;let t=e.match("(did|does|do)");return t.found&&t.append("not"),e},"want-infinitive":(e,t)=>(e=AL(e)).replace("wants","want",kL)},xL={api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Verbs"}parse(e){return this.getNth(e).map(D$)}json(e,t){let n=this.getNth(t).map((t=>{let n=t.toView().json(e)[0]||{};return n.verb=function(e){let t=D$(e);e=e.clone().toView();const n=q$(e,t);return{root:t.root.text(),preAdverbs:rL(t.adverbs.pre),postAdverbs:rL(t.adverbs.post),auxiliary:iL(t.auxiliary),negative:t.negative.found,prefix:iL(t.prefix),infinitive:sL(t.root),grammar:n}}(t),n}),[]);return n}subjects(e){return this.getNth(e).map((e=>(D$(e),J$(e).subject)))}adverbs(e){return this.getNth(e).map((e=>e.match("#Adverb")))}isSingular(e){return this.getNth(e).filter((e=>!0!==J$(e).plural))}isPlural(e){return this.getNth(e).filter((e=>!0===J$(e).plural))}isImperative(e){return this.getNth(e).filter((e=>e.has("#Imperative")))}toInfinitive(e){return this.getNth(e).map((e=>{let t=D$(e);return function(e,t){const{toInfinitive:n}=e.methods.two.transform.verb,{root:r,auxiliary:i}=t;let s=i.terms().harden(),a=r.text("normal");if(a=n(a,e.model,eL(r)),a&&e.replace(r,a,aL).tag("Verb").firstTerm().tag("Infinitive"),s.found&&e.remove(s),t.negative.found){e.has("not")||e.prepend("not");let t=Y$(e);e.prepend(t)}return e.fullSentence().compute(["freeze","lexicon","preTagger","postTagger","unfreeze","chunks"]),e}(e,t,q$(e,t).form)}))}toPresentTense(e){return this.getNth(e).map((e=>{let t=D$(e),n=q$(e,t);return n.isInfinitive?e:function(e,t,n){return gL.hasOwnProperty(n)?((e=gL[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):e}(e,t,n.form)}))}toPastTense(e){return this.getNth(e).map((e=>{let t=D$(e),n=q$(e,t);return n.isInfinitive?e:function(e,t,n){return cL.hasOwnProperty(n)?((e=cL[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):e}(e,t,n.form)}))}toFutureTense(e){return this.getNth(e).map((e=>{let t=D$(e),n=q$(e,t);return n.isInfinitive?e:function(e,t,n){return e.has("will")||e.has("going to")?e:wL.hasOwnProperty(n)?((e=wL[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):e}(e,t,n.form)}))}toGerund(e){return this.getNth(e).map((e=>{let t=D$(e),n=q$(e,t);return n.isInfinitive?e:function(e,t){const{toInfinitive:n,conjugate:r}=e.methods.two.transform.verb,{root:i,auxiliary:s}=t;if(e.has("#Gerund"))return e;let a=i.text("normal");a=n(a,e.model,eL(i));let o=r(a,e.model).Gerund;if(o){let t=X$(e);e.replace(i,o,_L),e.remove(s),e.prepend(t)}return e.replace("not is","is not"),e.replace("not are","are not"),e.fullSentence().compute(["tagger","chunks"]),e}(e,t,n.form)}))}toPastParticiple(e){return this.getNth(e).map((e=>{let t=D$(e),n=q$(e,t);return n.isInfinitive?e:function(e,t,n){return dL.hasOwnProperty(n)?((e=dL[n](e,t)).fullSentence().compute(["tagger","chunks"]),e):((e=hL(e,t)).fullSentence().compute(["tagger","chunks"]),e)}(e,t,n.form)}))}conjugate(e){const{conjugate:t,toInfinitive:n}=this.world.methods.two.transform.verb;return this.getNth(e).map((e=>{let r=D$(e),i=q$(e,r);"imperative"===i.form&&(i.form="simple-present");let s=r.root.text("normal");if(!r.root.has("#Infinitive")){let t=eL(r.root);s=n(s,e.model,t)||s}return t(s,e.model)}),[])}isNegative(){return this.if("#Negative")}isPositive(){return this.ifNo("#Negative")}toPositive(){let e=this.match("do not #Verb");return e.found&&e.remove("do not"),this.remove("#Negative")}toNegative(e){return this.getNth(e).map((e=>{let t=D$(e);return function(e,t,n){if(e.has("#Negative"))return e;if(EL.hasOwnProperty(n))return EL[n](e,t);let r=e.matchOne("be");return r.found?(r.prepend("not"),e):!0===TL(e)?PL(e):(r=e.matchOne("(will|had|have|has|did|does|do|#Modal)"),r.found?(r.append("not"),e):e)}(e,t,q$(e,t).form)}))}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}t.prototype.toPast=t.prototype.toPastTense,t.prototype.toPresent=t.prototype.toPresentTense,t.prototype.toFuture=t.prototype.toFutureTense,e.prototype.verbs=function(e){let n=function(e){let t=e.match("<Verb>");return t=t.not("#Conjunction"),t=t.not("#Preposition"),t=t.splitAfter("@hasComma"),t=t.splitAfter("[(do|did|am|was|is|will)] (is|was)",0),t=t.splitBefore("(#Verb && !#Copula) [being] #Verb",0),t=t.splitBefore("#Verb [to be] #Verb",0),t=t.splitAfter("[help] #PresentTense",0),t=t.splitBefore("(#PresentTense|#PastTense) [#Copula]$",0),t=t.splitBefore("(#PresentTense|#PastTense) [will be]$",0),t=t.splitBefore("(#PresentTense|#PastTense) [(had|has)]",0),t=t.not("#Reflexive$"),t=t.not("#Adjective"),t=t.splitAfter("[#PastTense] #PastTense",0),t=t.splitAfter("[#PastTense] #Auxiliary+ #PastTense",0),t=t.splitAfter("#Copula [#Gerund] #PastTense",0),t=t.if("#Verb"),t.has("(#Verb && !#Auxiliary) #Adverb+? #Copula")&&(t=t.splitBefore("#Copula")),t}(this);return n=n.getNth(e),new t(this.document,n.pointer)}}},IL=function(e,t){let n=t.match(e);if(n.found){let e=n.pronouns().refersTo();if(e.found)return e}return t.none()},CL=function(e){if(!e.found)return e;let[t]=e.fullPointer[0];return t&&t>0?e.update([[t-1]]):e.none()},OL=function(e,t){let n=e.people();return n=function(e,t){return"m"===t?e.filter((e=>!e.presumedFemale().found)):"f"===t?e.filter((e=>!e.presumedMale().found)):e}(n,t),n.found?n.last():(n=e.nouns("#Actor"),n.found?n.last():"f"===t?IL("(she|her|hers)",e):"m"===t?IL("(he|him|his)",e):e.none())},SL=function(e){let t=e.nouns(),n=t.isPlural().notIf("#Pronoun");if(n.found)return n.last();let r=IL("(they|their|theirs)",e);return r.found?r:(n=t.match("(somebody|nobody|everybody|anybody|someone|noone|everyone|anyone)"),n.found?n.last():e.none())},NL=function(e,t){let n=e.before(),r=t(n);return r.found?r:(n=CL(e),r=t(n),r.found?r:(n=CL(n),r=t(n),r.found?r:e.none()))},jL={compute:{coreference:function(e){e.pronouns().if("(he|him|his|she|her|hers|they|their|theirs|it|its)").forEach((e=>{let t=null;e.has("(he|him|his)")?t=NL(e,(e=>OL(e,"m"))):e.has("(she|her|hers)")?t=NL(e,(e=>OL(e,"f"))):e.has("(they|their|theirs)")&&(t=NL(e,SL)),t&&t.found&&function(e,t){t&&t.found&&(e.docs[0][0].reference=t.ptrs[0])}(e,t)}))}},api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Pronouns"}hasReference(){return this.compute("coreference"),this.filter((e=>e.docs[0][0].reference))}refersTo(){return this.compute("coreference"),this.map((e=>{if(!e.found)return e.none();let t=e.docs[0][0];return t.reference?e.update([t.reference]):e.none()}))}update(e){let n=new t(this.document,e);return n._cache=this._cache,n}}e.prototype.pronouns=function(e){let n=this.match("#Pronoun");return n=n.getNth(e),new t(n.document,n.pointer)}}};eR.plugin(nR),eR.plugin({api:function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.viewType="Adverbs"}conjugate(e){return this.getNth(e).map((e=>{let t=function(e){return e.compute("root").text("root")}(e);return{Adverb:e.text("normal"),Adjective:t}}),[])}json(e={}){const t=this.methods.two.transform.adjective.fromAdverb;return e.normal=!0,this.map((n=>{let r=n.toView().json(e)[0]||{};return r.adverb={adjective:t(r.normal)},r}),[])}}e.prototype.adverbs=function(e){let n=this.match("#Adverb");return n=n.getNth(e),new t(n.document,n.pointer)}}}),eR.plugin(cR),eR.plugin(jL),eR.plugin(AR),eR.plugin(OR),eR.plugin(BR),eR.plugin(m$),eR.plugin(b$),eR.plugin(k$),eR.plugin(C$),eR.plugin(xL);const DL=eR;function RL(e){return DL(e).json()}function $L(e){return DL(e).fullSentences().out("array")}var LL=i(75),ML=i.n(LL);async function FL(e){const t=(new TextEncoder).encode(e);return UL(await crypto.subtle.digest("SHA-256",t))}function UL(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")}async function BL(e){return await FL(ML()(e))}async function VL(e,t=12){return(await BL(e)).slice(0,t)}async function zL(e){const t=(await FL(e)).slice(0,32);return[t.slice(0,8),t.slice(8,12),t.slice(12,16),t.slice(16,20),t.slice(20,32)].join("-")}const HL={top:"gpt-4o",top_think:"o4-mini",quick:"gpt-4.1-nano"};async function GL(e,t){let n=HL[t]||"gpt-4o",r=BP();return(await r.responses.create({model:n,input:e})).output_text}async function qL(e){let t=BP();return(await t.embeddings.create({model:"text-embedding-3-small",input:e,dimensions:1024,encoding_format:"float"})).data[0].embedding}async function KL(e,t,n){let r=BP(),i=HL[n]||"gpt-4o";return(await r.responses.parse({model:i,input:[{role:"system",content:"Provide the requested output."},{role:"user",content:e}],text:{format:t}})).output_parsed}async function WL(e,t){return(await async function(e,t,n={}){const r=e.startsWith("/api/")?e:e.startsWith("api/")?`/${e}`:`/api/${e}`;let i="";i="undefined"!=typeof window&&void 0!==window.document?`${window.origin}${r}`:`https://www.tidyscripts.com${r}`;const s=await fetch(i,Object.assign({method:"POST",headers:Object.assign({"Content-Type":"application/json"},n.headers),body:JSON.stringify(t)},n));if(!s.ok)throw new Error(`Serverless query failed: ${s.status} ${s.statusText}`);return await s.json()}("openai_embedding",Object.assign({text:e},t&&{dimensions:t}))).embedding}async function JL(e){let t=BP();return(await t.embeddings.create({model:"text-embedding-3-small",input:e,encoding_format:"float"})).data[0].embedding}class ZL{constructor(e={}){this.config=Object.assign({enableStats:!0,verbose:!1,logPrefix:"cache"},e),this.logger=_t({id:e.logPrefix||"cache"}),this.stats={hits:0,misses:0,sets:0,deletes:0,hitRate:0},this.log("Cache instance created",{config:this.config})}buildKey(e){const t=[this.config.keyPrefix||"",this.config.namespace||"",e].filter(Boolean).join(":");return this.log("Built cache key",{originalKey:e,fullKey:t}),t}createCacheEntry(e,t){const n=Date.now(),r=(null==t?void 0:t.ttl)||this.config.defaultTtl,i={value:e,createdAt:n,expiresAt:r?n+r:void 0,metadata:null==t?void 0:t.metadata};return this.log("Created cache entry",{ttl:r,expiresAt:i.expiresAt,hasMetadata:!!(null==t?void 0:t.metadata)}),i}isExpired(e){const t=!!e.expiresAt&&Date.now()>e.expiresAt;return t&&this.log("Cache entry expired",{expiresAt:e.expiresAt,now:Date.now()}),t}updateStats(e,t){if(this.config.enableStats){if("hit"===e){this.stats.hits++,this.stats.hitRate=this.stats.hits/(this.stats.hits+this.stats.misses)||0;let e=Pt("green","Cache hit");this.log(`${e}: key=${(null==t?void 0:t.key)||"unknown"} hitRate=${(100*this.stats.hitRate).toFixed(2)}%`)}else if("miss"===e){this.stats.misses++,this.stats.hitRate=this.stats.hits/(this.stats.hits+this.stats.misses)||0;let e=Pt("red","Cache miss");this.log(`${e}: key=${(null==t?void 0:t.key)||"unknown"} reason=${(null==t?void 0:t.reason)||"unknown"} hitRate=${(100*this.stats.hitRate).toFixed(2)}%`)}else"set"===e?this.stats.sets++:"delete"===e&&this.stats.deletes++;this.log("Stats updated",{operation:e,stats:this.stats})}}log(e,t){if(this.config.onlyLogHitsMisses){if(!e.includes("Cache hit")&&!e.includes("Cache miss"))return}else if(!this.config.verbose)return;(new Date).toISOString(),this.config.logPrefix,t?(this.logger(e),this.logger(t)):this.logger(e)}getStats(){return Object.assign({},this.stats)}resetStats(){this.stats={hits:0,misses:0,sets:0,deletes:0,hitRate:0},this.log("Stats reset")}}class QL{static register(e,t){this.implementations.set(e,t)}static create(e,t){const n=this.implementations.get(e);if(!n)throw new Error(`Cache implementation '${e}' not found. Available: ${Array.from(this.implementations.keys()).join(", ")}`);return new n(t)}static getAvailableTypes(){return Array.from(this.implementations.keys())}}QL.implementations=new Map;class XL{static async generateKey(e){return await BL(e)}static generateKeySync(e){try{const t=JSON.stringify(e);let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return Math.abs(n).toString(36)}catch(e){return Math.random().toString(36).substring(2)}}static isAsyncFunction(e){return"AsyncFunction"===e.constructor.name||e.toString().includes("async ")||e.toString().includes("return new Promise")||e.toString().includes("await ")}static async batchGet(e,t){const n=new Map,r=t.map((async t=>{const r=await e.get(t);n.set(t,r)}));return await Promise.all(r),n}static async batchSet(e,t){const n=t.map((({key:t,value:n,options:r})=>e.set(t,n,r)));await Promise.all(n)}static memoize(e,t,n={}){const{ttl:r,keyGenerator:i,includeThis:s=!1,errorOnCacheFailure:a=!1}=n,o=async function(...n){var o;try{const o=e.name||"anonymous",l=s&&this?[this,...n]:n,c=`${o}:${i?i(l):await XL.generateKey(l)}`,u=await t.get(c);if(null!==u)return u;const h=await e.apply(this,n);try{await t.set(c,h,{ttl:r})}catch(e){if(a)throw new Error(`Cache storage failed: ${e}`)}return h}catch(t){if((null===(o=t.message)||void 0===o?void 0:o.includes("Cache"))&&!a)return await e.apply(this,n);throw t}};return Object.defineProperty(o,"name",{value:`memoized_${e.name}`}),Object.defineProperty(o,"length",{value:e.length}),o}static memoize2(e,t,n={}){const{ttl:r,keyGenerator:i,includeThis:s=!1,errorOnCacheFailure:a=!1}=n;return XL.isAsyncFunction(e)?async function(...n){var o;try{const o=e.name||"anonymous",l=s&&this?[this,...n]:n,c=`${o}:${i?i(l):await XL.generateKey(l)}`,u=await t.get(c);if(null!==u)return u;const h=e.apply(this,n),d=h instanceof Promise?await h:h;try{await t.set(c,d,{ttl:r})}catch(e){if(a)throw new Error(`Cache storage failed: ${e}`)}return d}catch(t){if((null===(o=t.message)||void 0===o?void 0:o.includes("Cache"))&&!a){const t=e.apply(this,n);return t instanceof Promise?await t:t}throw t}}:function(...t){e.name;const n=s&&this?[this,...t]:t;return XL.generateKeySync(n),e.apply(this,t)}}static createMemoizer(e,t={}){return(n,r={})=>{const i=Object.assign(Object.assign({},t),r);return XL.memoize(n,e,i)}}}class YL extends ZL{constructor(e){super(Object.assign({logPrefix:"memoryCache"},e)),this.storage=new Map}async get(e){const t=this.buildKey(e),n=this.storage.get(t);return this.log("Get operation",{key:e,fullKey:t,found:!!n}),n?this.isExpired(n)?(this.log("Entry expired, removing",{key:e,fullKey:t}),this.storage.delete(t),this.updateStats("miss",{key:e,fullKey:t,reason:"expired"}),null):(this.updateStats("hit",{key:e,fullKey:t}),n.value):(this.updateStats("miss",{key:e,fullKey:t,reason:"not_found"}),null)}async set(e,t,n){const r=this.buildKey(e),i=this.createCacheEntry(t,n);this.log("Set operation",{key:e,fullKey:r,ttl:null==n?void 0:n.ttl,hasMetadata:!!(null==n?void 0:n.metadata)}),this.storage.set(r,i),this.updateStats("set")}async has(e){const t=this.buildKey(e),n=this.storage.get(t);return this.log("Has operation",{key:e,fullKey:t,found:!!n}),!(!n||this.isExpired(n)&&(this.log("Entry expired, removing",{key:e,fullKey:t}),this.storage.delete(t),1))}async delete(e){const t=this.buildKey(e),n=this.storage.delete(t);return this.log("Delete operation",{key:e,fullKey:t,deleted:n}),n&&this.updateStats("delete"),n}async clear(){const e=this.storage.size;this.storage.clear(),this.log("Clear operation",{previousSize:e})}async keys(){const e=[],t=[this.config.keyPrefix||"",this.config.namespace||""].filter(Boolean).join(":").length,n=t>0?1:0;for(const[r,i]of this.storage.entries())if(this.isExpired(i))this.storage.delete(r);else{const i=r.substring(t+n);e.push(i)}return this.log("Keys operation",{count:e.length}),e}async size(){let e=0;for(const[t,n]of this.storage.entries())this.isExpired(n)?this.storage.delete(t):e++;return this.log("Size operation",{size:e}),e}}QL.register("memory",YL);class eM{static async runAllTests(){console.log("🧪 Starting Memoization Tests...\n"),await this.testBasicMemoization(),await this.testTTLExpiration(),await this.testCustomKeyGeneration(),await this.testNamespaceIsolation(),await this.testErrorHandling(),await this.testMemoizerFactory(),await this.testThisContext(),await this.testFunctionPreservation(),console.log("🎉 All memoization tests completed successfully!")}static async testBasicMemoization(){console.log("📝 Test 1: Basic Memoization");const e=new YL;let t=0;const n=XL.memoize((async e=>(t++,await new Promise((e=>setTimeout(e,10))),2*e)),e),r=await n(5);console.log(`✅ First call result: ${r}, Call count: ${t}`);const i=await n(5);console.log(`✅ Second call result: ${i}, Call count: ${t}`);const s=await n(10);console.log(`✅ Third call result: ${s}, Call count: ${t}`),console.log(`✅ Expected: 10, 10, 20 | Got: ${r}, ${i}, ${s}`),console.log(`✅ Expected call count: 2 | Got: ${t}\n`)}static async testTTLExpiration(){console.log("⏰ Test 2: TTL Expiration");const e=new YL;let t=0;const n=XL.memoize((async e=>(t++,3*e)),e,{ttl:100}),r=await n(7);console.log(`✅ Before expiration: ${r}, Call count: ${t}`),await new Promise((e=>setTimeout(e,150)));const i=await n(7);console.log(`✅ After expiration: ${i}, Call count: ${t}`),console.log(`✅ Expected call count: 2 | Got: ${t}\n`)}static async testCustomKeyGeneration(){console.log("🔑 Test 3: Custom Key Generation");const e=new YL;let t=0;const n=XL.memoize((async e=>(t++,`${e.name}-${e.id}`)),e,{keyGenerator:e=>`obj:${e[0].id}`}),r=await n({id:1,name:"Alice"}),i=await n({id:1,name:"Bob"});console.log(`✅ First call: ${r}, Call count: ${t}`),console.log(`✅ Second call: ${i}, Call count: ${t}`),console.log(`✅ Expected call count: 1 | Got: ${t}\n`)}static async testNamespaceIsolation(){console.log("🏠 Test 4: Namespace Isolation");const e=new YL;let t=0,n=0;const r=XL.memoize((async e=>(t++,e+1)),e,{namespace:"ns1"}),i=XL.memoize((async e=>(n++,e+2)),e,{namespace:"ns2"}),s=await r(5),a=await i(5);console.log(`✅ Namespace 1 result: ${s}, Call count: ${t}`),console.log(`✅ Namespace 2 result: ${a}, Call count: ${n}`),console.log(`✅ Expected: 6, 7 | Got: ${s}, ${a}\n`)}static async testErrorHandling(){console.log("❌ Test 5: Error Handling");const e=new YL;let t=0;const n=XL.memoize((async e=>{if(t++,e)throw new Error("Function failed");return"success"}),e);try{await n(!0)}catch(e){console.log(`✅ Expected error caught: ${e.message}`)}const r=await n(!1);console.log(`✅ Success result: ${r}, Call count: ${t}\n`)}static async testMemoizerFactory(){console.log("🏭 Test 6: Memoizer Factory");const e=new YL,t=XL.createMemoizer(e,{namespace:"factory",ttl:1e3});let n=0;const r=t((async e=>(n++,4*e))),i=await r(3),s=await r(3);console.log(`✅ Factory memoized result: ${i}, ${s}`),console.log(`✅ Expected call count: 1 | Got: ${n}\n`)}static async testThisContext(){console.log("🎯 Test 7: This Context");const e=new YL;class t{constructor(e){this.callCount=0,this.multiplier=e}async calculate(e){return this.callCount++,e*this.multiplier}}const n=new t(5),r=(new t(10),XL.memoize(n.calculate.bind(n),e,{includeThis:!0})),i=await r(3),s=await r(3);console.log(`✅ This context result: ${i}, ${s}`),console.log(`✅ Expected call count: 1 | Got: ${n.callCount}\n`)}static async testFunctionPreservation(){console.log("🔧 Test 8: Function Property Preservation");const e=new YL;async function t(e,t,n){return e+t+n}const n=XL.memoize(t,e);console.log(`✅ Original name: ${t.name}, length: ${t.length}`),console.log(`✅ Memoized name: ${n.name}, length: ${n.length}`),console.log(`✅ Name includes 'memoized': ${n.name.includes("memoized")}\n`)}}const tM=_t({id:"reflections"});class nM{constructor(e={}){this.enabled=!0,this.config={endpoint:e.endpoint||"/api/insights/query",enable_cache:!1!==e.enable_cache,cache_ttl_ms:e.cache_ttl_ms||6e4,cache_namespace:e.cache_namespace||"reflections",silent_failure:void 0!==e.silent_failure&&e.silent_failure,verbose:void 0!==e.verbose&&e.verbose,slow_llm_threshold_ms:e.slow_llm_threshold_ms||5e3,slow_operation_threshold_ms:e.slow_operation_threshold_ms||1e4},this.config.enable_cache&&(this.cache=new YL({defaultTtl:this.config.cache_ttl_ms,namespace:this.config.cache_namespace,verbose:this.config.verbose,enableStats:!0})),tM("ReflectionsClient initialized"),tM(`Endpoint: ${this.config.endpoint}`),tM("Cache: "+(this.config.enable_cache?"enabled":"disabled"))}async queryEvents(e={}){var t;if(!this.enabled)return{events:[],total_count:0,query_time_ms:0,from_cache:!1};const n=JSON.stringify(e);if(this.cache)try{const e=await this.cache.get(n);if(e)return tM(`Cache HIT: ${n.substring(0,50)}...`),Object.assign(Object.assign({},e),{from_cache:!0})}catch(e){tM(`Cache error (continuing): ${e}`)}const r=Date.now();try{const i=await fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const s=await i.json(),a=Date.now()-r,o={events:s.events||[],total_count:(null===(t=s.events)||void 0===t?void 0:t.length)||0,query_time_ms:a,from_cache:!1,server_logs:s.server_logs};if(this.cache)try{await this.cache.set(n,o)}catch(e){tM(`Cache set error (continuing): ${e}`)}return tM(`Query completed: ${o.total_count} events in ${a}ms`),o}catch(e){if(tM(`Query failed: ${e.message}`),this.config.silent_failure)return{events:[],total_count:0,query_time_ms:0,from_cache:!1};throw e}}async getEventsBySession(e,t={}){return this.queryEvents({session_id:e,limit:t.limit,sort_by:"timestamp",sort_order:"asc"})}async getEventsByTrace(e){return this.queryEvents({trace_id:e,sort_by:"timestamp",sort_order:"asc"})}async getEventsByType(e,t={}){return this.queryEvents({event_type:e,session_id:t.session_id,limit:t.limit})}async getEventById(e){return(await this.queryEvents({limit:1e4})).events.find((t=>t.event_id===e))||null}async analyzeSession(e){throw new Error("analyzeSession not yet implemented (Phase 3)")}async analyzeTrace(e){throw new Error("analyzeTrace not yet implemented (Phase 3)")}async analyzeLLMUsage(e,t){throw new Error("analyzeLLMUsage not yet implemented (Phase 4)")}async analyzePerformance(e,t){throw new Error("analyzePerformance not yet implemented (Phase 4)")}async analyzeErrors(e,t){throw new Error("analyzeErrors not yet implemented (Phase 4)")}async getEventTypes(){const e=await this.queryEvents({limit:1e4}),t=new Set(e.events.map((e=>e.event_type)));return Array.from(t).sort()}async getEventTypeStats(){const e=await this.queryEvents({limit:1e4}),t=new Map;for(const n of e.events){t.has(n.event_type)||t.set(n.event_type,{event_type:n.event_type,count:0,first_seen:n.timestamp,last_seen:n.timestamp,has_duration:!1,has_tags:!1,sample_payload_keys:[]});const e=t.get(n.event_type);e.count++,e.first_seen=Math.min(e.first_seen,n.timestamp),e.last_seen=Math.max(e.last_seen,n.timestamp),void 0!==n.duration_ms&&(e.has_duration=!0),n.tags&&n.tags.length>0&&(e.has_tags=!0),1===e.count&&n.payload&&(e.sample_payload_keys=Object.keys(n.payload))}return Array.from(t.values()).sort(((e,t)=>t.count-e.count))}async inspectPayloadSchema(e){const t=await this.queryEvents({event_type:e,limit:1e3}),n=new Map;for(const e of t.events)if(e.payload)for(const[t,r]of Object.entries(e.payload)){n.has(t)||n.set(t,{field_name:t,occurrences:0,sample_values:[],value_types:[]});const e=n.get(t);e.occurrences++,e.sample_values.length<5&&e.sample_values.push(r);const i=typeof r;e.value_types.includes(i)||e.value_types.push(i)}const r=Array.from(n.values()),i=.9*t.total_count;return{event_type:e,total_events:t.total_count,fields:r,common_fields:r.filter((e=>e.occurrences>=i)).map((e=>e.field_name)),optional_fields:r.filter((e=>e.occurrences<i)).map((e=>e.field_name))}}async getSessions(e=100){const t=await this.queryEvents({limit:1e4}),n=new Set(t.events.map((e=>e.session_id)));return Array.from(n).slice(0,e)}async getTraces(e=100){const t=await this.queryEvents({limit:1e4}),n=new Set(t.events.filter((e=>e.trace_id)).map((e=>e.trace_id)));return Array.from(n).slice(0,e)}async inspectSession(e){const t=(await this.getEventsBySession(e,{limit:1e4})).events;if(0===t.length)throw new Error(`No events found for session ${e}`);const n={};for(const e of t)n[e.event_type]=(n[e.event_type]||0)+1;const r=[...new Set(t.filter((e=>e.trace_id)).map((e=>e.trace_id)))],i=t.map((e=>e.timestamp)),s=Math.min(...i),a=Math.max(...i);return{session_id:e,event_count:t.length,event_types:n,traces:r,time_range:{start:s,end:a},duration_ms:a-s,sample_events:t.slice(0,5)}}async inspectTrace(e){const t=(await this.getEventsByTrace(e)).events;if(0===t.length)throw new Error(`No events found for trace ${e}`);const n=t.find((e=>!e.parent_event_id)),r=!!n,i=new Map(t.map((e=>[e.event_id,e]))),s=new Map;for(const e of t)e.parent_event_id&&s.set(e.parent_event_id,(s.get(e.parent_event_id)||0)+1);const a=n&&s.get(n.event_id)||0,o=t.filter((e=>!s.has(e.event_id))).length;let l=0;for(const e of t){let t=0,n=e;const r=new Set;for(;n.parent_event_id&&!r.has(n.event_id);){r.add(n.event_id);const e=i.get(n.parent_event_id);if(!e)break;n=e,t++}l=Math.max(l,t)}const c=t.map((e=>e.timestamp)),u=Math.min(...c),h=Math.max(...c);return{trace_id:e,event_count:t.length,events:t,has_root:r,root_event:n,chain_structure:{depth:l,branches:a,leaf_count:o},time_range:{start:u,end:h},duration_ms:h-u}}async getAllTags(){const e=await this.queryEvents({limit:1e4}),t=new Set;for(const n of e.events)n.tags&&n.tags.forEach((e=>t.add(e)));return Array.from(t).sort()}async getTimeRange(){const e=await this.queryEvents({limit:1e4});if(0===e.events.length)return{earliest:0,latest:0,span_ms:0,span_days:0,total_events:0};const t=e.events.map((e=>e.timestamp)),n=Math.min(...t),r=Math.max(...t),i=r-n;return{earliest:n,latest:r,span_ms:i,span_days:i/864e5,total_events:e.total_count}}async getDatabaseStats(){const e=(await this.queryEvents({limit:1e4})).events,t=[...new Set(e.map((e=>e.event_type)))],n=[...new Set(e.map((e=>e.session_id)))],r=[...new Set(e.filter((e=>e.trace_id)).map((e=>e.trace_id)))],i=[...new Set(e.map((e=>e.app_name)))],s=[...new Set(e.map((e=>e.user_id)))],a=await this.getTimeRange();return{total_events:e.length,event_types:t,sessions:n,traces:r,apps:i,users:s,time_range:a}}async sampleEvents(e,t=10){return(await this.queryEvents({event_type:e,limit:t})).events}async invalidateCache(e){if(this.cache)if(e){const t=await this.cache.keys();for(const n of t)n.includes(e)&&await this.cache.delete(n);tM(`Cache invalidated: ${e}`)}else await this.cache.clear(),tM("Cache invalidated: all")}getCacheStats(){return this.cache?Object.assign({enabled:!0},this.cache.getStats()):{enabled:!1}}setEnabled(e){this.enabled=e,tM("ReflectionsClient "+(e?"enabled":"disabled"))}getConfig(){return Object.assign({},this.config)}}let rM=null;function iM(e){return new nM(e)}function sM(){if(!rM)throw new Error("Default ReflectionsClient not initialized. Call createClient() first or set defaultClient.");return rM}function aM(e){rM=e,tM("Default ReflectionsClient set")}const oM={resultReferences:'\n- Use "$0" to reference the result from the first call (index 0)\n- Use "$1" to reference the result from the second call (index 1)\n- And so on...\n\nPlease note that references ("$0", "$1" , "$N" as well as "@id") must exist as standalone strings within arrays or objects and NOT nested within another string. \n\nIf you want to respond to the user with variable outputs please use the format string function first to construct the output.\n\n',cortexRAMReferences:'\n- Use "@id" to reference a value stored in CortexRAM (e.g., "@dc5a7a9940da")\n',templateParamReferences:'\n- Use "&paramName" to reference template parameters provided at runtime\n'},lM=e=>`\n==================================================\n${e}\n==================================================\n`,cM={intro:(e="Cortex")=>`${lM("INTRO")}\nYou are an AI agent named ${e} that interacts with users via structured data.\n`,cortexRAM:`${lM("CORTEX RAM")}\nCortexRAM is a key-value store for persisting values across calls.\n\nTo reference a stored value, use the @id syntax where id is the returned identifier.\nYou can pass CortexRAM references as parameters to any function.\n`,callChains:`${lM("CALL CHAINS")}\nYou can execute multiple function calls in series, which is referred to as running a call chain.\n\nIMPORTANT: All calls must be included in a single CortexOutput object's "calls" array. Never output multiple JSON objects. Use the $N syntax to reference results within the same calls array.\n\n${oM.resultReferences}\n${oM.cortexRAMReferences}\n`,dynamicFunctions:`${lM("DYNAMIC FUNCTIONS")}\nDynamic functions are reusable JavaScript functions stored in the database which you have access to.\nThese are noted here again and pay special attention to\nrun_dynamic_function which was not noted previously. \n\nFunctions available:\n- create_dynamic_function({name, description, code, params_schema})\n- load_dynamic_function({name})\n- list_dynamic_functions()\n- update_dynamic_function({name, code?, description?, params_schema?})\n- delete_dynamic_function({name})\n\nOne special function is:\n- run_dynamic_function({name, args})\nThis is available as well and should be used to run a dynamic function \n\nCode format:\n- Named async function: async function my_func(args) { ... }\n- Takes single args object parameter\n- Has access to all cortex functions \n- Use destructuring: const {text, category} = args;\n\nExample:\nasync function embed_and_store(args) {\n  const {text, category} = args;\n  const embedding = await compute_embedding({text});\n  return await access_database_with_surreal_ql({\n    query: 'INSERT INTO logs {text: $text, category: $category, embedding: $emb}',\n    variables: {text, category, emb: embedding}\n  });\n}\n\nData does not automatically persist between execution turns unless explicitly returned or stored in the workspace.\n1. The 'Return' Requirement\nTo access the result of an asynchronous operation (like accumulate_text or retrieve_declarative_knowledge) in the next turn, the current script must include a return statement for that value.\n\n// Turn 1\nresult = await some_async_function();\nreturn result; // Required to populate 'last_result' in Turn 2\n\n// Turn 2\nconsole.log(last_result); // Accessing the data\n2. Avoiding the 'Null Turn'\nIf a script concludes with respond_to_user but does not return a value, last_result will be null in the subsequent turn. This clears the chain of logic.\n\n3. Workspace vs. Last Result\nWorkspace: Use for long-term state that needs to survive multiple turns without manual passing.\nLast Result: Use for sequential function outputs where the immediate next turn depends on the current turn's findings.\n\nIMPORTANT: if you encounter an error with code execution PLEASE STOP EXECUTION AND NOTIFY the user rather than trying to re-run the code\n\n`,knowledgeGraph:`${lM("KNOWLEDGE GRAPH VS DATABASE")}\nYou have two types of data storage available:\n\n1. KNOWLEDGE GRAPH (user_entities + user_relations)\n   - For: Facts, relationships, ontological knowledge\n   - Structure: Entity-Relation-Entity triples (e.g., "shay created tidyscripts")\n   - Functions:\n     * store_declarative_knowledge({triples: [["A", "rel", "B"], ...]})\n     * retrieve_declarative_knowledge({query: "...", limit: 10})\n\n   USE FOR:\n   - Permanent facts: "Paris is_in France"\n   - Relationships: "Einstein developed relativity"\n   - Concepts: "Aspirin treats headache"\n   - Structured relational knowledge\n\n2. DATABASE TABLES (logs, cortex, custom tables)\n   - For: Events, history, user data, raw records\n   - Structure: Arbitrary JSON documents\n   - Functions:\n     * access_database_with_surreal_ql({query, variables})\n     * Dynamic functions that query specific tables\n\n   USE FOR:\n   - User activity logs\n   - Conversation history\n   - Temporal events with timestamps\n   - Unstructured data storage\n   - Custom application data\n\nDECISION GUIDE:\n- Is it a fact/relationship between entities? -> Knowledge Graph\n- Is it an event/log/record/document? -> Database table\n- Does it fit Subject-Relation-Object structure? -> Knowledge Graph\n- Is it freeform data with custom fields? -> Database table\n\nIMPORTANT: Before telling the user you don't know something, ALWAYS search the knowledge graph first using retrieve_declarative_knowledge!\n`,returnIndices:`${lM("RETURN INDICES")}\nSpecify which results to return using the return_indeces field.\nUse this to filter output to only the final result, or extract specific intermediate results.\n`,responseGuidance:e=>`${lM("RESPONSE GUIDANCE")}\n${null!=e?e:"Follow the instructions exactly as described."}\n`,functions:e=>`${lM("AVAILABLE FUNCTIONS")}\nBelow are the available functions in JSON format.\nUse the description field to determine if a function should be used.\n\n${JSON.stringify(e,null,2)}\n`,outputFormat:(e,t)=>`${lM("OUTPUT FORMAT")}\n${e}\n${t?`\n${t}`:""}\n`,codeGeneration:e=>`${lM("CODE GENERATION")}\nYou generate JavaScript code that executes in a sandboxed environment.\n\nAll cortex functions are async and available in global scope. Call them directly in your code.\n\nCRITICAL RULES:\n1. Always call functions with a SINGLE OBJECT parameter containing named properties\n   Example: await compute_embedding({text: "hello"})\n   NOT: await compute_embedding("hello")\n\n2. You can use console.log() for debugging - all logs will be returned to you in the result\n   Example: console.log("Processing query:", userQuery);\n\n3. A 'workspace' object is available for persisting state between executions\n   Example: workspace.counter = (workspace.counter || 0) + 1;\n\n4. A 'last_result' variable contains the result from the previous code execution\n   - On the first execution, last_result is null\n   - Use this to reference previous computation results\n   Example: if (last_result) { console.log("Previous result was:", last_result); }\n\n5. You can call respond_to_user({response: "message"}) to send output back to the user.\n   If you do this at the end then we will assume you are done computing.\n\n   CRITICAL RULE: Never call respond_to_user in the same turn as other function calls!\n\n   You CANNOT see the results of function calls until the NEXT turn. If you call\n   respond_to_user in the same turn, you're composing a response BEFORE knowing what\n   the functions returned - this leads to generic, unhelpful responses.\n\n   BAD (responding before seeing results):\n     results = await retrieve_declarative_knowledge({query: "AI"});\n     await respond_to_user({response: "I found some relevant information about AI."});\n     // ^ You wrote this response BEFORE seeing what 'results' contains!\n\n   GOOD (return data, respond next turn):\n     // Turn 1: Execute and return\n     results = await retrieve_declarative_knowledge({query: "AI"});\n     return results;\n\n     // Turn 2: Now you've SEEN the results in your context, respond accurately\n     await respond_to_user({response: "I found 3 entries about AI: ..."});\n\n   The ONLY exception is simple acknowledgments like "Starting the task now..."\n   followed by actual work, where you're not claiming to know any results\n\n\n6. IMPORTANT: Use UNQUALIFIED ASSIGNMENTS for variables (no const/let/var)\n   This enables variable tracking in the UI for observability.\n   CORRECT: query = "What is AI?";\n   CORRECT: results = await retrieve_declarative_knowledge({query: query});\n   WRONG: const query = "What is AI?";\n   WRONG: let results = await retrieve_declarative_knowledge({query: query});\n\n   Exception: You can use const/let/var inside function definitions IF NEEDED\n\n7. Write natural async JavaScript code with control flow, error handling, etc.\n\n8. IMPORTANT - Turn-Based Execution:\n   This is a turn-based system. You CANNOT see results until the NEXT turn.\n\n   ALWAYS use this pattern when calling functions:\n\n   // Turn 1: Execute and return (DO NOT respond yet)\n   results = await retrieve_declarative_knowledge({query: "AI"});\n   return results;\n\n   // Turn 2: Use last_result to access previous data, then respond accurately\n   await respond_to_user({response: "I found " + last_result.length + " entries about AI."});\n\n   To pass data to the next turn:\n   - Return it directly (becomes last_result in next turn)\n   - Store in workspace (persists across multiple turns)\n   - Use console.log() only for ancillary debug info, not the main return value\n\n   NEVER call respond_to_user in the same turn as other function calls.\n   You must SEE the data before you can accurately describe it to the user \n\nAvailable Functions:\n${JSON.stringify(e,null,2)}\n\n\n`,additional:e=>`${lM("ADDITIONAL INSTRUCTIONS")}\n${e}\n`},uM={types:"\nYou receive UserInput messages and return CortexOutput messages, defined in TypeScript as:\n\ntype CortexOutput = {\n    thoughts: string,\n    calls: FunctionCall[],\n    return_indeces: number[]\n}\n\ntype FunctionCall = {\n    name: string,\n    parameters: FunctionParameters\n}\n\ntype FunctionParameters = (Record<string, any> | null)\n",examples:'\n[Example] Responding to user with text "Sounds great!"\n{\n  thoughts: "ready to respond to the user",\n  calls: [\n    { name: "respond_to_user", parameters: { response: "Sounds great!" } }\n  ],\n  return_indeces: [0]\n}\n\n[Example] Get 5th value of the embedding of the text "hello"\nThis demonstrates referencing the result of a prior call using $N syntax:\n{\n  thoughts: "Need to use compute_embedding and then array_nth_value",\n  calls: [\n    { name: "compute_embedding", parameters: { text: "hello" } },\n    { name: "array_nth_value", parameters: { a: "$0", n: 5 } }\n  ],\n  return_indeces: [1]\n}\n\n[Example] Log a value in CortexRAM\nThis shows how to reference a value in CortexRAM using @ syntax:\n{\n  thoughts: "Need to reference the value in RAM to log it",\n  calls: [\n    { name: "console_log", parameters: { data: "@dc5a7a9940da" } }\n  ],\n  return_indeces: [0]\n}\n'},hM={types:"\nYou receive UserInput messages and return CodeOutput messages, defined in TypeScript as:\n\ntype CodeOutput = {\n    thoughts: string,\n    code: string\n}\n",examples:'\n[Example] Simple response (no function calls needed)\n{\n  thoughts: "User greeted me, responding directly",\n  code: "await respond_to_user({response: \\"Sounds great!\\"});"\n}\n\n[Example] Turn 1 - Execute function and return results (DO NOT respond yet)\n{\n  thoughts: "Need to list available functions first. Will return results and respond next turn after seeing them.",\n  code: "functions = await list_dynamic_functions();\\nreturn functions;"\n}\n\n[Example] Turn 2 - Use last_result to access previous data, then respond accurately\n{\n  thoughts: "I can see last_result contains 5 dynamic functions. Now I can give an accurate response.",\n  code: "names = last_result.map(f => f.name);\\nawait respond_to_user({response: \\"You have \\" + names.length + \\" dynamic functions: \\" + names.join(\\", \\")});"\n}\n'};function dM(e){return e.sections.map((t=>{var n,r;const i=cM[t];return"function"==typeof i?i(...null!==(r=null===(n=e.sectionArgs)||void 0===n?void 0:n[t])&&void 0!==r?r:[]):i})).join("\n")}const pM=["intro","cortexRAM","callChains","returnIndices","outputFormat","responseGuidance","functions"],fM=["intro","codeGeneration","dynamicFunctions","knowledgeGraph","outputFormat","responseGuidance"];class mM{constructor(e){this.sections=e.sections,this.sectionArgs=e.sectionArgs||{}}build(){return dM({sections:this.sections,sectionArgs:this.sectionArgs})}buildWith(e){const t=[],n={};for(const r of this.sections){const i=e[r];if(null!==i)if(void 0!==i)t.push(r),n[r]=i;else{t.push(r);const e=this.sectionArgs[r];e&&(n[r]=e)}}return dM({sections:t,sectionArgs:n})}getSections(){return[...this.sections]}getSectionArgs(){return Object.assign({},this.sectionArgs)}}class gM{constructor(e){let{name:t}=e;this.forwarding_to=[],this.receiving_from=[],this.value_que=[],this.promise_que=[],this.name=t,this.log=_t({id:`ch:${t}`})}read(){if(this.value_que.length>0){let e=this.value_que;return new Promise(((t,n)=>{setTimeout((()=>t(e.shift())),0)}))}{let e=new Promise(((e,t)=>{this.promise_que.push([e,t])}));return e}}connect(e){this.log(`Connecting to channel: ${e.name}`),this.forwarding_to.push(e),e.receiving_from.push(this)}write(e){if(this.promise_que.length>0){let[t,n]=this.promise_que.shift();t(e)}else this.value_que.push(e)}flush(){this.value_que=[];for(var e=0;e<this.promise_que.length;e++){let[e,t]=this.promise_que.shift();e(null)}this.log("Flushed channel")}async log_data(){for(this.log("Chan read loop initiated");;){let e=await this.read();this.log("Got value:"),this.log(e)}}}const yM=36e5,vM={openai:4,anthropic:3.5,gemini:4,default:4},bM=4;function wM(e,t){if(!e)return 0;const n=vM[t||"default"];return Math.ceil(e.length/n)}const _M=wM;function kM(e,t){if(!e||0===e.length)return 0;const n=e.length*bM,r=e.reduce(((e,n)=>e+wM(n.content,t)),0);return r+n}function AM(e,t){let n=0,r=0,i=0;for(const s of e){const e=wM(s.content,t)+bM;switch(s.role){case"system":n+=e;break;case"user":default:r+=e;break;case"assistant":i+=e}}return{systemMessage:n,userMessages:r,assistantMessages:i,total:n+r+i}}function PM(e,t){return 0===t?0:Math.abs(t-e)/t}function TM(e,t,n){const r=vM[n||"default"],i=PM(wM(e,n),t);return{currentRatio:r,suggestedRatio:e.length/t,drift:i}}const EM={"claude-opus-4-5":{id:"claude-opus-4-5-20251101",provider:"anthropic",inputPricePer1M:5,outputPricePer1M:25,contextWindow:2e5,maxOutputTokens:64e3,description:"Premium model combining maximum intelligence with practical performance",tiktokenEncoding:"cl100k_base"},"claude-sonnet-4-5":{id:"claude-sonnet-4-5-20250929",provider:"anthropic",inputPricePer1M:3,outputPricePer1M:15,contextWindow:2e5,maxOutputTokens:64e3,description:"Smart model for complex agents and coding",tiktokenEncoding:"cl100k_base"},"claude-haiku-4-5":{id:"claude-haiku-4-5-20251001",provider:"anthropic",inputPricePer1M:1,outputPricePer1M:5,contextWindow:2e5,maxOutputTokens:64e3,description:"Fastest model with near-frontier intelligence",tiktokenEncoding:"cl100k_base"},"gemini-3-pro-preview":{id:"gemini-3-pro-preview",provider:"gemini",inputPricePer1M:2,outputPricePer1M:12,contextWindow:1e6,maxOutputTokens:64e3,description:"Best for complex tasks requiring broad world knowledge and advanced reasoning",tiktokenEncoding:"cl100k_base"},"gemini-3-flash-preview":{id:"gemini-3-flash-preview",provider:"gemini",inputPricePer1M:.5,outputPricePer1M:3,contextWindow:1e6,maxOutputTokens:64e3,description:"Pro-level intelligence at Flash speed and pricing",tiktokenEncoding:"cl100k_base"},"gemini-3-pro-image-preview":{id:"gemini-3-pro-image-preview",provider:"gemini",inputPricePer1M:2,outputPricePer1M:.134,contextWindow:65e3,maxOutputTokens:32e3,description:"Highest quality image generation model",tiktokenEncoding:"cl100k_base"},"gpt-4.1":{id:"gpt-4.1-2025-04-14",provider:"openai",inputPricePer1M:2,outputPricePer1M:8,contextWindow:1047576,maxOutputTokens:32768,description:"Smartest non-reasoning model with 1M context window",tiktokenEncoding:"o200k_base"},"gpt-5":{id:"gpt-5-2025-08-07",provider:"openai",inputPricePer1M:1.25,outputPricePer1M:10,contextWindow:4e5,maxOutputTokens:128e3,description:"Intelligent reasoning model for coding and agentic tasks",tiktokenEncoding:"o200k_base"},"gpt-5-mini":{id:"gpt-5-mini-2025-08-07",provider:"openai",inputPricePer1M:.25,outputPricePer1M:2,contextWindow:4e5,maxOutputTokens:128e3,description:"Faster, cost-efficient version of GPT-5",tiktokenEncoding:"o200k_base"},"gpt-5-nano":{id:"gpt-5-nano-2025-08-07",provider:"openai",inputPricePer1M:.05,outputPricePer1M:.4,contextWindow:4e5,maxOutputTokens:128e3,description:"Fastest, most cost-efficient version of GPT-5",tiktokenEncoding:"o200k_base"},"gpt-5.2":{id:"gpt-5.2-2025-12-11",provider:"openai",inputPricePer1M:1.75,outputPricePer1M:14,contextWindow:4e5,maxOutputTokens:128e3,description:"Best model for coding and agentic tasks across industries",tiktokenEncoding:"o200k_base"},"gpt-5.2-pro":{id:"gpt-5.2-pro-2025-12-11",provider:"openai",inputPricePer1M:21,outputPricePer1M:168,contextWindow:4e5,maxOutputTokens:128e3,description:"Smarter, more precise version of GPT-5.2",tiktokenEncoding:"o200k_base"},"gpt-5.2-codex":{id:"gpt-5.2-codex",provider:"openai",inputPricePer1M:1.75,outputPricePer1M:14,contextWindow:4e5,maxOutputTokens:128e3,description:"Most intelligent coding model for long-horizon agentic tasks",tiktokenEncoding:"o200k_base"},"o4-mini":{id:"o4-mini-2025-04-16",provider:"openai",inputPricePer1M:1.1,outputPricePer1M:4.4,contextWindow:2e5,maxOutputTokens:1e5,description:"Fast, cost-efficient reasoning model for coding and visual tasks",tiktokenEncoding:"o200k_base"}},xM={openai:{provider:"openai",contextWindow:128e3,maxOutputTokens:16384,inputPricePer1M:2,outputPricePer1M:8,tiktokenEncoding:"o200k_base"},anthropic:{provider:"anthropic",contextWindow:2e5,maxOutputTokens:64e3,inputPricePer1M:3,outputPricePer1M:15,tiktokenEncoding:"cl100k_base"},gemini:{provider:"gemini",contextWindow:1048576,maxOutputTokens:65536,inputPricePer1M:.5,outputPricePer1M:3,tiktokenEncoding:"cl100k_base"}};function IM(e,t){if(EM[e])return EM[e];for(const[t,n]of Object.entries(EM))if(e.startsWith(t)||t.startsWith(e))return Object.assign(Object.assign({},n),{id:e});const n=t||function(e){return e.startsWith("claude-")?"anthropic":e.startsWith("gemini-")?"gemini":"openai"}(e),r=xM[n];return Object.assign({id:e},r)}function CM(){return Object.keys(EM)}const OM=_t({id:"cortex_base"});function SM(e){switch(e){case"anthropic":return"/api/claude_structured_response";case"gemini":return"/api/gemini_structured_response";default:return"/api/openai_structured_response"}}const NM=e_({name:Jw(),parameters:t_([n_(Jw()),Qw()])}),jM=FP(e_({thoughts:Jw(),calls:Yw(NM),return_indeces:Yw(Zw())}),"CortexOutput"),DM=jM.json_schema.schema,RM="CortexOutput",$M=FP(e_({thoughts:Jw(),code:Jw()}),"CodeOutput"),LM=$M.json_schema.schema,MM="CodeOutput";function FM(e){return{schema:e.json_schema.schema,schema_name:e.json_schema.name}}function UM(e){var t={};return e.map((e=>t[e.name]=e)),t}function BM(e){let t=e.map((e=>{let{description:t,name:n,parameters:r,return_type:i}=e;return OM(`Adding function: ${n}`),{description:t,name:n,parameters:r,return_type:i}}));return JSON.stringify(t,null,2)}function VM(e,t){const n=e.map((e=>({description:e.description,name:e.name,parameters:e.parameters,return_type:e.return_type})));return dM({sections:t?[...fM,"additional"]:[...fM],sectionArgs:Object.assign({functions:[n],outputFormat:[hM.types,hM.examples]},t&&{additional:[t]})})}async function zM(e){const t=JSON.stringify({data:e});let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return Math.abs(n).toString(36)}class HM extends dT.EventEmitter{constructor(e){super(),this.last_result=null,this.usage={promptTokens:0,completionTokens:0,totalTokens:0,costUsd:0,callCount:0};let{model:t,name:n,functions:r,additional_system_msg:i,provider:s,insights:a,sandbox:o,apiBaseUrl:l,utilities:c}=e;this.model=t,this.name=n,this.provider=null!=s?s:IM(t).provider,this.functions=r,this.messages=[],this.is_running_function=!1,this.function_input_ch=new gM({name:n}),this.prompt_history=[],this.CortexRAM={},this.last_result=null,this.insights=a||null,this.sandbox=o,this.utilities=c||{},this.apiBaseUrl=l||("undefined"!=typeof window?window.location.origin:"https://www.tidyscripts.com");let u=_t({id:`cortex:${n}`});this.log=u,this.user_output=function(e){OM("User output not yet configured: received output:"),OM(e)},OM("Initializing"),OM("Generating system message via PromptManager");const h=r.map((e=>({description:e.description,name:e.name,parameters:e.parameters,return_type:e.return_type}))),d=i?[...fM,"additional"]:[...fM];this.promptManager=new mM({sections:d,sectionArgs:Object.assign({codeGeneration:[h],outputFormat:[hM.types,hM.examples]},i&&{additional:[i]})});let p={role:"system",content:this.promptManager.build()};this.system_msg=p,OM("Building function dictionary");let f=UM(r);this.function_dictionary=f,OM(`Initialized: model=${t}, provider=${this.provider}`),OM("Done")}getContextStatus(){const e=this.build_messages(),t=IM(this.model,this.provider),n=AM(e,this.provider),r=n.total,i=Math.max(0,t.contextWindow-r),s=r/t.contextWindow*100;return{model:this.model,provider:this.provider,contextWindow:t.contextWindow,maxOutputTokens:t.maxOutputTokens,breakdown:n,totalUsed:r,remaining:i,usagePercent:Math.round(10*s)/10,isApproachingLimit:s>80,isAtLimit:s>95,messageCount:this.messages.length,countMethod:"estimate"}}emitContextStatus(){const e=this.getContextStatus();this.emit_event({type:"context_status",status:e})}updateUsage(e,t){this.usage.promptTokens+=e,this.usage.completionTokens+=t,this.usage.totalTokens+=e+t,this.usage.callCount++;const n=IM(this.model,this.provider),r=e/1e6*n.inputPricePer1M+t/1e6*n.outputPricePer1M;this.usage.costUsd+=r,this.emit_event({type:"usage_update",call:{promptTokens:e,completionTokens:t,costUsd:r},cumulative:Object.assign({},this.usage)}),this.log(`Usage: +${e}/${t} tokens, +$${r.toFixed(6)} | Total: ${this.usage.totalTokens} tokens, $${this.usage.costUsd.toFixed(6)}`)}getUsage(){return Object.assign({},this.usage)}resetUsage(){this.usage={promptTokens:0,completionTokens:0,totalTokens:0,costUsd:0,callCount:0},this.log("Usage stats reset")}async set_var(e){let t=await zM(e);return this.CortexRAM[t]=e,this.log(`Wrote var with id hash=${t}`),t}async set_var_with_id(e,t){return this.CortexRAM[t]=e,this.log(`Wrote var with id=${t}`),t}get_var(e){return this.log(`Returning var ${e}`),this.CortexRAM[e]}emit_event(e){this.log(`emitting event: ${JSON.stringify(e)}`),this.emit("event",e)}async run_structured_completion(e){var t,n,r,i,s;const{schema:a,schema_name:o,messages:l}=e;this.log(`[Structured Completion] schema=${o}, model=${this.model}, provider=${this.provider}`),this.log(`Message count: ${l.length}`),this.log_event(`Structured completion: ${o} | Provider: ${this.provider}`);const c=FP(a,o),{schema:u,schema_name:h}=FM(c),d=SM(this.provider);this.log(`Structured completion request: ${o}`);const p=await fetch(`${this.apiBaseUrl}${d}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:this.model,input:l,schema:u,schema_name:h})}),f=await p.json();if(this.log("Structured completion response received"),f.error)throw this.log(`Structured completion error: ${JSON.stringify(f.error)}`),this.log_event(`Structured completion failed: ${o}`),new Error(`Structured completion failed: ${f.error.message||f.error}`);const m=f.usage||{},g=null!==(t=m.prompt_tokens)&&void 0!==t?t:m.input_tokens,y=null!==(n=m.completion_tokens)&&void 0!==n?n:m.output_tokens,v=m.total_tokens;let b;if(v&&this.log_event(`Structured completion tokens: ${v}`),g&&y&&this.updateUsage(g,y),f.output_text)b=JSON.parse(f.output_text);else{if(!(null===(s=null===(i=null===(r=f.choices)||void 0===r?void 0:r[0])||void 0===i?void 0:i.message)||void 0===s?void 0:s.parsed))throw new Error("Unexpected response format: no output_text or parsed content");b=f.choices[0].message.parsed}return this.log(`Structured completion result received for: ${o}`),this.log("Structured completion parsed successfully"),b}async rerun_llm_with_output_format(e){const{schema:t,schema_name:n,sectionOverrides:r={}}=e;this.log(`Rerunning LLM with custom output format: ${n}`);const i=this.messages.slice(0,-1);this.log(`Using ${i.length} messages (dropped last cortex message)`);const s=`\nYou must respond with a JSON object matching this schema: ${n}\nThe response will be validated against this structure.\n`,a=Object.assign({outputFormat:[s]},r),o=[{role:"system",content:this.promptManager.buildWith(a)},...i];this.log(`Calling structured completion with ${o.length} messages`),this.log(`Rerunning LLM with ${o.length} messages`);const l=await this.run_structured_completion({schema:t,schema_name:n,messages:o});return this.log(`Rerun completed successfully for: ${n}`),l}configure_user_output(e){this.log("Linking user output"),this.user_output=e}async chat(e,t=4){return this.add_user_text_input(e),await this.run_llm(t)}build_messages(){return[this.system_msg,...this.messages]}set_is_running_function(e){this.log(`Function running=${e}`),this.is_running_function=e}add_user_message(e){this.messages=[...this.messages,e],this.log("Added user message")}add_cortex_message(e){this.messages=[...this.messages,e],this.log("Added cortex message")}_user_msg(e){return{role:"user",content:e}}_cortex_msg(e){return{role:"assistant",content:e}}add_user_text_input(e){let t={kind:"text",text:e,codeExecutionResult:null},n=this._user_msg(JSON.stringify(t));this.add_user_message(n)}add_user_result_input(e){let t={kind:"CodeExecutionResult",codeExecutionResult:e,text:null},n=this._user_msg(JSON.stringify(t));this.add_user_message(n)}add_cortex_output(e){let t=this._cortex_msg(JSON.stringify(e));this.add_cortex_message(t)}async run_llm(e=6){let t=this.build_messages(),n=this.model;const r=this.getContextStatus();this.emitContextStatus(),r.isAtLimit?this.log_event(`WARNING: Context at ${r.usagePercent}% capacity (${r.totalUsed}/${r.contextWindow} tokens)`):r.isApproachingLimit&&this.log_event(`Context approaching limit: ${r.usagePercent}% (${r.totalUsed}/${r.contextWindow} tokens)`);const i=SM(this.provider);let s={model:n,input:t,schema:LM,schema_name:MM};this.log(`[LLM Call] model=${this.model}, provider=${this.provider}, endpoint=${i}, estimated_tokens=${r.totalUsed}`),this.log_event(`Provider: ${this.provider} | Model: ${this.model}`);let a=await fetch(`${this.apiBaseUrl}${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await this.handle_llm_response(a,e)}resolve_cortex_ram_reference(e){if("@"==e[0]){this.log(`Detected CRAM reference ${e}`);let t=this.get_var(e.slice(1));return t?(this.log("Returning resolved value"),this.log("Resolved CRAM reference"),t):(this.log("Reference is undefined!"),null)}return this.log("No CRAM ref found: passing var through"),e}collect_args(e){let t={};for(var n=0;n<e.length-1;n++)if(n%2==0){let i=e[n];var r=null;let s=e[n+1];try{r=JSON.parse(s)}catch(e){r=this.resolve_cortex_ram_reference(s)}t[i]=r}return t}resolve_args(e){if(null==e)return e;if("string"==typeof e){if("@"===e[0])return this.log(`Resolving CortexRAM reference: ${e}`),this.resolve_cortex_ram_reference(e);if(e.match(/^\$\d+$/)){this.log(`Resolving result reference: ${e}`);const t=this.get_var(e);return void 0!==t?this.resolve_args(t):(this.log(`Warning: ${e} not found in CortexRAM, returning as-is`),e)}try{const t=JSON.parse(e);return this.resolve_args(t)}catch(t){return e}}if(Array.isArray(e))return e.map((e=>this.resolve_args(e)));if("object"==typeof e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=this.resolve_args(e[n]));return t}return e}async run_cortex_output(e){try{const{calls:t,return_indeces:n}=e;if(!t||0===t.length)return this.log("No function calls to execute"),{name:"run_result",error:!1,result:"There were no functions to execute"};this.log(`Executing cortex output with ${t.length} function calls`);const r=[];for(let e=0;e<t.length;e++){const i=t[e];this.log(`Executing call ${e+1}/${t.length}: ${i.name}`);const s=await this.handle_function_call({name:i.name,parameters:i.parameters});if(r.push(s),await this.set_var_with_id(s.result,`$${e}`),s.error){const a=this.filter_results_by_indices(r,n),o=`Execution failed at call ${e+1}/${t.length} (${i.name}): ${s.error}`;return this.log(o),this.log_event(o),{name:"run_result",error:o,result:{results:a}}}}const i=this.filter_results_by_indices(r,n);return this.log(`All ${t.length} calls completed successfully`),this.log_event(`Run execution completed: ${t.length} functions`),this.log("Results:"),this.log(r),this.log("Filtered results:"),this.log(i),{name:"call_chain_results",error:!1,result:{results:i}}}catch(e){const t=`Unexpected error in run execution: ${e.message}`;return this.log(t),this.log_event(t),{name:"run_result",error:t,result:null}}}filter_results_by_indices(e,t){if(!t||0===t.length){const t={};return e.forEach(((e,n)=>{t[n]=e})),t}const n={};return t.forEach((t=>{t>=0&&t<e.length?n[t]=e[t]:this.log(`Warning: return_indeces contains invalid index ${t}`)})),n}build_sandbox_context(){const e={};for(const t of this.functions)e[t.name]=async(e={})=>{try{const n={params:e,util:{log:this.log,event:this.emit_event.bind(this),user_output:this.user_output,get_user_data:async()=>await this.function_input_ch.read(),get_var:this.get_var.bind(this),set_var:this.set_var.bind(this),set_var_with_id:this.set_var_with_id.bind(this),get_embedding:this.utilities.get_embedding||(async()=>{throw new Error("Embedding function not configured")}),handle_function_call:this.handle_function_call.bind(this),collect_args:this.collect_args.bind(this),resolve_args:this.resolve_args.bind(this),run_cortex_output:this.run_cortex_output.bind(this),run_structured_completion:this.run_structured_completion.bind(this),rerun_llm_with_output_format:this.rerun_llm_with_output_format.bind(this),build_system_message:dM,cortex_functions:this.functions,get_context_status:this.getContextStatus.bind(this),feedback:this.utilities.sounds||{error:()=>{},activated:()=>{},ok:()=>{},success:()=>{}}}},r=await t.fn(n);return structuredClone(r)}catch(e){throw new Error(e.message||String(e))}};return e.workspace=this.workspace||{},e.last_result=this.last_result,e}async run_code_output(e){var t;const{code:n}=e;let r;this.sandbox.setupEventStream&&(r=this.sandbox.setupEventStream((e=>{switch(e.type){case"log":const t=e.payload;this.emit_event({type:"sandbox_log",level:t.level,args:t.args,timestamp:t.timestamp});break;case"event":const n=e.payload;this.emit_event({type:"sandbox_event",eventType:n.type,data:n.data,timestamp:n.timestamp})}})));try{const e=this.build_sandbox_context(),r=await this.sandbox.execute(n,e,yM);this.log(`Sandbox execution complete: ok=${r.ok}, duration=${r.duration}ms`),r.logs&&r.logs.length>0&&this.log(`Sandbox logs: ${r.logs.length} entries`);let i=r.data;return r.ok&&(null===(t=r.data)||void 0===t?void 0:t.__workspace)&&(this.workspace=r.data.__workspace,this.emit_event({type:"workspace_update",workspace:this.workspace}),this.log(`Workspace updated: ${Object.keys(this.workspace||{}).length} keys`),i=r.data.__userResult,this.last_result=structuredClone(i),this.log("Stored last_result for next execution")),{name:"code_execution",error:!r.ok&&(r.error||"Unknown error"),result:i,events:r.events||[]}}catch(e){const t=`Sandbox execution failed: ${e.message}`;return this.log(t),this.log_event(t),this.last_result=null,this.log("Cleared last_result due to execution error"),{name:"code_execution",error:t,result:null,events:[]}}finally{r&&r()}}async handle_llm_response(e,t){var n,r,i,s,a,o,l,c,u,h,d,p,f,m;const g=Date.now();let y=await e.json();const v=Date.now()-g;if(this.log("Model JSON response received"),this.prompt_history.push(y),y.error){if(this.log(`API Error: ${y.error}`),this.insights)try{await this.insights.addLLMInvocation({model:this.model,provider:this.provider,mode:"code_generation",prompt_tokens:0,completion_tokens:0,latency_ms:v,status:"error",error:y.error})}catch(e){this.log(`Error adding insights event: ${e}`)}throw new Error(y.error)}const b=y.usage||{},w=null!==(n=b.prompt_tokens)&&void 0!==n?n:b.input_tokens,_=null!==(r=b.completion_tokens)&&void 0!==r?r:b.output_tokens,k=b.total_tokens;if(k&&this.log_event(`Token Usage=${k}`),w){const e=this.getContextStatus(),t=PM(e.totalUsed,w);t>.15&&this.log(`Token estimate drift: ${(100*t).toFixed(1)}% (estimated=${e.totalUsed}, actual=${w})`)}let A;if(w&&_&&this.updateUsage(w,_),y.output_text)A=JSON.parse(y.output_text);else{if(!(null===(a=null===(s=null===(i=y.choices)||void 0===i?void 0:i[0])||void 0===s?void 0:s.message)||void 0===a?void 0:a.parsed))throw new Error("Unexpected response format: no output_text or parsed content");A=y.choices[0].message.parsed}if(console.log(A),this.log("Output received"),this.add_cortex_message(this._cortex_msg(JSON.stringify(A))),this.emit_event({type:"thought",thought:A.thoughts}),this.insights)try{await this.insights.addLLMInvocation({model:this.model,provider:this.provider,mode:"code_generation",prompt_tokens:w||0,completion_tokens:_||0,latency_ms:v,status:"success",context:{loop:t,messages_count:this.messages.length,output:A},usage:this.getUsage()})}catch(e){this.log(`Error adding insights event: ${e}`)}this.emit_event({type:"code_execution_start",code:A.code,executionId:`exec_${Date.now()}`}),this.set_is_running_function(!0);const P=Date.now();let T=await this.run_code_output(A);const E=Date.now()-P;if(this.set_is_running_function(!1),this.emit_event({type:"code_execution_complete",status:T.error?"error":"success",error:T.error,duration:E,result:T.result}),this.insights)try{const e=(null===(l=null===(o=T.events)||void 0===o?void 0:o.filter((e=>"function_start"===e.type)))||void 0===l?void 0:l.length)||0,t=(null===(u=null===(c=T.events)||void 0===c?void 0:c.filter((e=>"variable_set"===e.type)))||void 0===u?void 0:u.length)||0,n=(null===(d=null===(h=T.events)||void 0===h?void 0:h.filter((e=>"log"===e.type)))||void 0===d?void 0:d.length)||0;await this.insights.addExecution({execution_type:"code_sandbox",status:T.error?"error":"success",duration_ms:E,error:T.error,function_calls:e,variables_assigned:t,logs_count:n,context:{code_length:A.code.length,thoughts:A.thoughts,code:A.code,result:T}})}catch(e){this.log(`Error adding execution insights event: ${e}`)}const x=T.error;let I=!1,C=null;if(!x&&T.events&&T.events.length>0){const e=T.events.filter((e=>"function_start"===e.type));e.length>0&&(C=e[e.length-1],I="respond_to_user"===(null===(p=C.data)||void 0===p?void 0:p.name),this.log(`Last function call: ${null===(f=C.data)||void 0===f?void 0:f.name}`))}const O={name:T.name,error:T.error,result:T.result};if(this.add_user_result_input(O),!x&&I){if((null===(m=null==C?void 0:C.data)||void 0===m?void 0:m.args)&&C.data.args.length>0){const e=C.data.args[0];return"object"==typeof e&&e.response?e.response:e}return"done"}if(t>0)return this.log(`Continuing LLM invocation::  [loops remaining: ${t}] - Error=${T.error}`),await this.run_llm(t-1);if(0===t){this.log("Loop limit reached without respond_to_user, adding instruction message");const e={name:"system_message",error:!1,result:"Loop limit reached. You must now call respond_to_user with the current status of the task."};return this.add_user_result_input(e),await this.run_llm(-1)}return this.log("Final loop limit reached without respond_to_user, forcing stop"),"done"}log_event(e){this.emit_event({type:"log",log:e})}async handle_function_input(e){let t=`Sending to function_input_ch: ${e}`;this.log(t),this.function_input_ch.write(e),this.log_event(t)}async handle_function_call(e){let{name:t,parameters:n}=e;n=this.resolve_args(n);let r=this.function_dictionary[t];var i;if(!r)return i=`The function ${t} was not found`,this.log(i),{error:i,result:null,name:t};let s=`Running function: ${t} with args=${JSON.stringify(n)}`;this.log(s),this.log_event(s);var a={};const o=async function(){return await this.function_input_ch.read()}.bind(this),l=_t({id:`fn:${t}`});this.log("Appending get_user_data to function parameters"),a.get_user_data=o,a.log=l;const c=this.utilities.sounds||{error:()=>{},activated:()=>{},ok:()=>{},success:()=>{}};this.log("Appending feedback object to function parameters"),a.feedback=c,this.log("Appending user_output to function parameters"),a.user_output=this.user_output,this.log("Appending event to function parameters"),a.event=this.emit_event.bind(this),this.log("Appending embedding fn to parameters"),a.get_embedding=this.utilities.get_embedding||(async()=>{throw new Error("Embedding function not configured")}),this.log("Including cortex get/set var"),a.get_var=this.get_var.bind(this),a.set_var=this.set_var.bind(this),this.log("Including handle_function_call and collect_args"),a.handle_function_call=this.handle_function_call.bind(this),a.collect_args=this.collect_args.bind(this),this.log("Including resolve_args and run_cortex_output"),a.resolve_args=this.resolve_args.bind(this),a.run_cortex_output=this.run_cortex_output.bind(this),this.log("Including run_structured_completion, rerun_llm_with_output_format, build_system_message, and cortex_functions"),a.run_structured_completion=this.run_structured_completion.bind(this),a.rerun_llm_with_output_format=this.rerun_llm_with_output_format.bind(this),a.build_system_message=dM,a.cortex_functions=this.functions;try{let e=await r.fn({params:n,util:a});return i=null,this.log_event(`Ran ${t} function successfully`),this.log(`Ran ${t} function successfully and got result:`),this.log(e),{error:i,result:e,name:t}}catch(e){let n=`\n                [ERROR] - Error with function: ${t}: ${i=e.message}\n                DO NOT proceed any further\n                Instead think about what caused this error \n                Immediately report this error and your thoughts regarding the reason to the user and await further instructions \n\t    `;return this.log(n),this.log_event(n),{error:n,result:null,name:t}}}}function GM(e,t,n){return Uint8Array.from([144+e,t,n])}function qM(e,t,n){return Uint8Array.from([128+e,t,n])}function KM(e,t,n){return Uint8Array.from([176+e,t,n])}function WM(e){return e.toISOString()}function JM(){return WM(new Date)}function ZM(e){return WM(e).split("T")[0].replace(/-/g,"_")}function QM(){return ZM(new Date)}function XM(e){return Number(e)}function YM(){return XM(new Date)}function eF(e,t){return e.getTime()==t.getTime()}function tF(e){return new Date(e.getTime())}function nF(e){return e.toString().split(" ").slice(0,4).join(" ").replace(" ","_")}function rF(e,t){let n=tF(e);switch(t){case"year":n.setMonth(0);case"month":n.setDate(1);case"day":n.setHours(0);case"hour":n.setMinutes(0);case"minute":n.setSeconds(0);case"second":n.setMilliseconds(0);case"millisecond":break;default:return n}return n}function iF(e,t,n){let r=tF(e);switch(n){case"year":r.setFullYear(r.getFullYear()+t);break;case"month":r.setMonth(r.getMonth()+t);break;case"day":r.setDate(r.getDate()+t);break;case"hour":r.setHours(r.getHours()+t);break;case"minute":r.setMinutes(r.getMinutes()+t);break;case"second":r.setSeconds(r.getSeconds()+t);break;case"millisecond":r.setMilliseconds(r.getMilliseconds()+t);break;default:return r}return r}var sF={"1sec":1e3,"5sec":5e3,"10sec":1e4,"30sec":3e4,"1min":6e4,"2min":12e4,"5min":3e5,"10min":6e5,"30min":18e5,"1hr":36e5,"1day":864e5},aF=class e{static initParams(e,t){return[e.replace(/\s+/g,"").toLowerCase(),t.replace(/\s+/g,"").toLowerCase()]}static checkThanosType(e){if("string"!=typeof e)throw new Error("first argument should be a string")}static checkRivalType(e){if("string"!=typeof e)throw new Error("second argument should be a string")}static checkAvengersType(e){if(!Array.isArray(e))throw new Error("second argument should be an array of strings");if(e.find((e=>"string"!=typeof e)))throw new Error("second argument should be an array of strings")}sortMatch(t,n){return e.checkThanosType(t),e.checkAvengersType(n),n.map(((e,n)=>({member:e,index:n,rating:this.similarity(t,e)}))).sort(((e,t)=>e.rating-t.rating))}},oF=new class extends aF{similarity(e,t){aF.checkThanosType(e),aF.checkRivalType(t);let[n,r]=aF.initParams(e,t);if(!n.length&&!r.length)return 1;if(!n.length||!r.length)return 0;if(n===r)return 1;let i=Array.from(new Set(n.split("").concat(r.split("")))),s=this.stringVectorization(n.split(""),i),a=this.stringVectorization(r.split(""),i),[o,l,c]=[0,0,0];for(let e=0;e<s.length;++e)o+=s[e]*a[e],l+=s[e]*s[e],c+=a[e]*a[e];return l=Math.sqrt(l),c=Math.sqrt(c),Number(o)/(l*c)}distance(e,t){return 1-this.similarity(e,t)}stringVectorization(e,t){return t.map((t=>e.includes(t)?1:0))}},lF=new class extends aF{similarity(e,t){aF.checkThanosType(e),aF.checkRivalType(t);let[n,r]=aF.initParams(e,t),[i,s]=[n.length,r.length];if(!n.length&&!r.length||n===r)return 1;if(i<2||s<2)return 0;let a=new Map;for(let e=0;e<i-1;e++){let t=n.slice(e,e+2),r=a.has(t)?a.get(t)+1:1;a.set(t,r)}let o=0;for(let e=0;e<s-1;e++){let t=r.slice(e,e+2),n=a.has(t)?a.get(t):0;n>0&&(a.set(t,n-1),++o)}return 2*o/(i+s-2)}distance(e,t){return 1-this.similarity(e,t)}},cF=new class extends aF{similarity(e,t){aF.checkThanosType(e),aF.checkRivalType(t);let[n,r]=aF.initParams(e,t);if(!n.length&&!r.length||n===r)return 1;let i=new Set(n.split("").concat(r.split(""))),s=new Set(n.split("").filter((e=>new Set(r).has(e))));return Number(s.size)/i.size}distance(e,t){return 1-this.similarity(e,t)}},uF=new class extends aF{similarity(e,t){aF.checkThanosType(e),aF.checkRivalType(t);let[n,r]=aF.initParams(e,t);return n.length||r.length?1-Number(this.distance(n,r))/Math.max(n.length,r.length):1}distance(e,t){aF.checkThanosType(e),aF.checkRivalType(t);let[n,r]=aF.initParams(e,t);if(n===r)return 0;let[i,s]=[n.length,r.length];if(!i)return s;if(!s)return i;let a,o=[...Array(i+1)].map((()=>Array(s+1).fill(0)));for(let e=0;e<=i;++e)o[e][0]=e;for(let e=0;e<=s;++e)o[0][e]=e;for(let e=1;e<=i;++e)for(let t=1;t<=s;++t)a=n[e-1]===r[t-1]?0:1,o[e][t]=Math.min(o[e-1][t]+1,o[e][t-1]+1,o[e-1][t-1]+a);return o[i][s]}},hF=new class e extends aF{static lcsLength(e,t){aF.checkThanosType(e),aF.checkRivalType(t);let[n,r]=aF.initParams(e,t),[i,s]=[n.length,r.length],a=[...Array(i+1)].map((()=>Array(s+1).fill(0)));for(let e=1;e<=i;++e)for(let t=1;t<=s;++t)a[e][t]=n[e-1]===r[t-1]?a[e-1][t-1]+1:Math.max(a[e][t-1],a[e-1][t]);return a[i][s]}similarity(t,n){aF.checkThanosType(t),aF.checkRivalType(n);let[r,i]=aF.initParams(t,n);return!r.length&&!i.length||r===i?1:2*e.lcsLength(r,i)/(r.length+i.length)}distance(t,n){let[r,i]=aF.initParams(t,n);return r.length+i.length-2*e.lcsLength(r,i)}},dF=hF,pF=new class e extends aF{static lcsLength(e,t){aF.checkThanosType(e),aF.checkRivalType(t);let[n,r]=[e.length,t.length],i=[...Array(n+1)].map((()=>Array(r+1).fill(0)));for(let s=1;s<=n;++s)for(let n=1;n<=r;++n)i[s][n]=e[s-1]===t[n-1]?i[s-1][n-1]+1:Math.max(i[s][n-1],i[s-1][n]);return i[n][r]}similarity(t,n){aF.checkThanosType(t),aF.checkRivalType(n);let[r,i]=aF.initParams(t,n);return!r.length&&!i.length||r===i?1:Number(e.lcsLength(r,i))/Math.max(r.length,i.length)}distance(e,t){aF.checkThanosType(e),aF.checkRivalType(t);let[n,r]=aF.initParams(e,t);return n===r?0:1-this.similarity(n,r)}},fF=pF,mF=new class extends aF{distance(e,t){aF.checkThanosType(e),aF.checkRivalType(t);let[n,r]=aF.initParams(e,t);if(!n.length&&!r.length)return 1;if(!n.length||!r.length)return 0;if(n===r||n===r)return 1;let i=n.length,s=r.length;if(0===i||0===s)return 0;let a=Math.floor(Math.max(i,s)/2)-1,o=0,l=new Array(n.length).fill(0),c=new Array(r.length).fill(0);for(let e=0;e<i;e++)for(let t=Math.max(0,e-a);t<Math.min(s,e+a+1);t++)if(n[e]===r[t]&&0===c[t]){l[e]=1,c[t]=1,o++;break}if(0===o)return 0;let u=0,h=0;for(let e=0;e<i;e++)if(1===l[e]){for(;0===c[h];)h++;n[e]!==r[h++]&&u++}return u/=2,(o/i+o/s+(o-u)/o)/3}similarity(e,t){let n=this.distance(e,t);if(n>.7){let r=0;for(let n=0;n<Math.min(e.length,t.length)&&e[n]===t[n];n++)r++;r=Math.min(4,r),n+=.1*r*(1-n)}return n}},gF={cosine:oF,diceCoefficient:lF,jaccardIndex:cF,levenshtein:uF,lcs:hF,longestCommonSubsequence:dF,mlcs:pF,metricLcs:fF,jaroWinkler:mF};const yF={USER_INPUT:"user_input",USER_INTERACTION:"user_interaction",USER_OUTPUT:"user_output",LLM_INVOCATION:"llm_invocation",EXECUTION:"execution",CODE_EXECUTION:"code_execution",EXECUTION_COMPLETE:"execution_complete",NOTE_GENERATION:"note_generation",TEST_RUN:"test_run",MODEL_TEST:"model_test",MODEL_TEST_COMPLETE:"model_test_complete"},vF=_t({id:"insights"});function bF(e){return`${e}_${Date.now().toString(36)}${Math.random().toString(36).substring(2,9)}`}function wF(){return bF("ses")}function _F(){return bF("evt")}function kF(){return bF("trc")}function AF(){if(!$d())return;const e={user_agent:navigator.userAgent,viewport_size:`${window.innerWidth}x${window.innerHeight}`};try{if("function"==typeof window.getAuth){const t=window.getAuth();(null==t?void 0:t.currentUser)&&(e.firebase_uid=t.currentUser.uid||null,e.firebase_email=t.currentUser.email||null,e.firebase_display_name=t.currentUser.displayName||null)}}catch(e){console.warn("[insights] Failed to capture Firebase auth data:",e)}return e}class PF{constructor(e){this.eventBatch=[],this.batchTimer=null,this.chainStack=[],this.enabled=!0,this.sessionTags=[],this.config={app_name:e.app_name,app_version:e.app_version,user_id:e.user_id,session_id:e.session_id||wF(),endpoint:e.endpoint||"/api/insights/batch",batch_size:e.batch_size||50,batch_interval_ms:e.batch_interval_ms||5e3,enabled:void 0===e.enabled||e.enabled},this.enabled=this.config.enabled,vF(`InsightsClient initialized for ${this.config.app_name} v${this.config.app_version}`),vF(`Session ID: ${this.config.session_id}`),vF(`Batch size: ${this.config.batch_size}, Interval: ${this.config.batch_interval_ms}ms`),this.enabled&&$d()&&this.startBatchTimer()}startBatchTimer(){this.batchTimer||(this.batchTimer=setInterval((()=>{this.eventBatch.length>0&&this.flushBatch()}),this.config.batch_interval_ms))}stopBatchTimer(){this.batchTimer&&(clearInterval(this.batchTimer),this.batchTimer=null)}async addEvent(e,t,n={}){if(!this.enabled)return _F();try{const r=_F(),i=Date.now();let s=n.parent_event_id,a=n.trace_id;if(this.chainStack.length>0){const e=this.chainStack[this.chainStack.length-1];s||(s=e.event_id),a||(a=e.trace_id)}const o={event_id:r,event_type:e,app_name:this.config.app_name,app_version:this.config.app_version,user_id:this.config.user_id,session_id:this.config.session_id,timestamp:i,payload:t,parent_event_id:s,trace_id:a,tags:n.tags,duration_ms:n.duration_ms,client_info:AF()};return this.eventBatch.push(o),this.eventBatch.length>=this.config.batch_size&&await this.flushBatch(),r}catch(e){return vF(`Error adding event: ${e}`),_F()}}async startChain(e,t){if(!this.enabled)return _F();try{const n=await this.addEvent(e,t,{trace_id:kF()}),r=this.eventBatch.find((e=>e.event_id===n)),i=(null==r?void 0:r.trace_id)||kF();return this.chainStack.push({event_id:n,trace_id:i}),n}catch(e){return vF(`Error starting chain: ${e}`),_F()}}endChain(){this.chainStack.length>0&&this.chainStack.pop()}async addInChain(e,t,n={}){return this.addEvent(e,t,n)}async addLLMInvocation(e){const t="error"===e.status?["error"]:[];return e.latency_ms>5e3&&t.push("slow"),this.addEvent(yF.LLM_INVOCATION,e,{tags:t,duration_ms:e.latency_ms})}async addExecution(e){const t="error"===e.status?["error"]:[];return e.duration_ms>1e4&&t.push("slow"),this.addEvent(yF.EXECUTION,e,{tags:t,duration_ms:e.duration_ms})}async addUserInput(e){return this.addEvent(yF.USER_INPUT,e)}async flushBatch(){if(0===this.eventBatch.length)return;const e=[...this.eventBatch];this.eventBatch=[];try{await this.flushViaAPI(e)}catch(t){vF(`Error flushing batch: ${t}`),this.eventBatch.length<2*this.config.batch_size&&this.eventBatch.unshift(...e)}}async flushViaAPI(e){vF(`Flushing ${e.length} events to ${this.config.endpoint}`);const t=await fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e})});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=await t.json();vF(`Batch sent successfully: ${n.events_stored}/${n.events_received} stored`),n.errors&&n.errors.length>0&&vF(`Batch had errors: ${n.errors.join(", ")}`)}async shutdown(){this.stopBatchTimer(),await this.flushBatch(),vF("InsightsClient shutdown complete")}addSessionTags(e){for(const t of e)this.sessionTags.includes(t)||this.sessionTags.push(t);this.addEvent("session_tags",{tags:this.sessionTags},{tags:this.sessionTags})}getSessionTags(){return[...this.sessionTags]}getSessionId(){return this.config.session_id}getChainDepth(){return this.chainStack.length}setEnabled(e){this.enabled=e,e&&$d()?this.startBatchTimer():this.stopBatchTimer()}}let TF=null;function EF(e){return new PF(e)}function xF(){if(!TF)throw new Error("Default InsightsClient not initialized. Call createClient() first or set defaultClient.");return TF}function IF(e){TF=e}const CF=_t({id:"tes"}),OF="localhost",SF=8001;async function NF(e){const t=`http://${OF}:${SF}/call`;Nd("local_tes_call.request",e),CF(`POST ${t}`);const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const e=await n.text();throw CF(`Error response: ${n.status} ${n.statusText} - ${e}`),new Error(`TES call failed: ${n.status} ${n.statusText}`)}const r=await n.json();return Nd("local_tes_call.response",r),CF("Received result"),r}async function jF(e){const t="/api/tes";Nd("cloud_tes_call.request",e),CF(`POST ${t}`);const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const e=await n.text();throw CF(`Error response: ${n.status} ${n.statusText} - ${e}`),new Error(`TES call failed: ${n.status} ${n.statusText}`)}const r=await n.json();return Nd("cloud_tes_call.response",r),CF("Received result"),r}const DF=function e(t=[]){const n=()=>{};return new Proxy(n,{get(r,i){if("then"!==i||0!==t.length)return"symbol"==typeof i?Reflect.get(n,i):e(t.concat(i.toString()))},apply:(e,n,r)=>NF({fn_path:t,fn_args:r})})}(),RF=function e(t=[]){const n=()=>{};return new Proxy(n,{get(r,i){if("then"!==i||0!==t.length)return"symbol"==typeof i?Reflect.get(n,i):e(t.concat(i.toString()))},apply:(e,n,r)=>jF({fn_path:t,fn_args:r})})}(),$F=_t({id:"tobi"});class LF{constructor(e="localhost",t=8002){this.ws=null,this.handlers=[],this.url="localhost",this.port=8002,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.url=e,this.port=t}connect(){return new Promise(((e,t)=>{try{const n=function(){if("undefined"!=typeof WebSocket)return WebSocket;try{const{WebSocket:e}=i(236);return e}catch(e){throw new Error('WebSocket not available. In Node.js, please install the "ws" package.')}}(),r=`ws://${this.url}:${this.port}`;$F(`Connecting to ${r}...`),this.ws=new n(r),this.ws.onopen=()=>{$F(`Connected to ${r}`),this.reconnectAttempts=0,e()},this.ws.onmessage=e=>{const t=this.parseMessage(e.data);$F(`Received message: ${JSON.stringify(t)}`),this.handlers.forEach((e=>{try{e(t)}catch(e){$F(`Error in message handler: ${e}`)}}))},this.ws.onerror=e=>{$F(`WebSocket error: ${e}`),t(e)},this.ws.onclose=()=>{$F("Connection closed"),this.attemptReconnect()}}catch(e){$F(`Failed to connect: ${e}`),t(e)}}))}parseMessage(e){try{return e instanceof Buffer?JSON.parse(e.toString()):"string"==typeof e?JSON.parse(e):e}catch(t){return e}}attemptReconnect(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,$F(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),setTimeout((()=>{this.connect().catch((e=>{$F(`Reconnection attempt failed: ${e}`)}))}),this.reconnectDelay*this.reconnectAttempts)):$F("Max reconnection attempts reached")}send(e){if(!this.ws||1!==this.ws.readyState)throw new Error("WebSocket is not connected");const t="string"==typeof e?e:JSON.stringify(e);$F(`Sending message: ${t}`),this.ws.send(t)}async autoSend(e){this.isConnected()||($F("Not connected, connecting first..."),await this.connect()),this.send(e)}registerHandler(e){this.handlers.push(e),$F(`Handler registered. Total handlers: ${this.handlers.length}`)}removeHandler(e){const t=this.handlers.indexOf(e);t>-1&&(this.handlers.splice(t,1),$F(`Handler removed. Total handlers: ${this.handlers.length}`))}clearHandlers(){this.handlers=[],$F("All handlers cleared")}disconnect(){this.ws&&(this.maxReconnectAttempts=0,this.ws.close(),this.ws=null,$F("Disconnected"))}isConnected(){return null!==this.ws&&1===this.ws.readyState}getHandlerCount(){return this.handlers.length}}function MF(e="localhost",t=8002){return new LF(e,t)}let FF=null;function UF(){return FF||(FF=new LF),FF}async function BF(e){const t=UF();await t.autoSend(e)}async function VF(e){await BF(Object.assign(Object.assign({type:"bar_chart"},e),{timestamp:Date.now()}))}async function zF(e){await BF(Object.assign(Object.assign({type:"time_series_chart"},e),{timestamp:Date.now()}))}async function HF(e){await BF(Object.assign(Object.assign({type:"object"},e),{timestamp:Date.now()}))}const GF=_t({id:"common"});async function qF(e,t){let n=`${e}?${new URLSearchParams(t)}`;return GF(`Querying with url= ${n}`),(await fetch(n,{method:"GET",cache:"no-cache",headers:{"Content-Type":"application/json"},redirect:"follow"})).json()}})();var a=t;for(var o in s)a[o]=s[o];s.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return r[e](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{s.r(a),s.d(a,{apis:()=>I,common:()=>N,components:()=>C,cryptocurrency:()=>g,umd:()=>S,util:()=>p});var e={};s.r(e),s.d(e,{_speak:()=>X,cancel_speech:()=>F,chunk_strategy:()=>Y,default_rate:()=>W,finished_speaking:()=>B,finished_utterance:()=>U,get_voice:()=>H,get_voice_by_name:()=>G,get_voices:()=>z,is_speaking:()=>V,pause_speech:()=>Z,resume_speech:()=>Q,set_chunk_strategy:()=>ee,set_default_rate:()=>J,speak:()=>te,speech_que:()=>M,tts:()=>L,voices_ready:()=>q,wait_until_voices_ready:()=>K});var t={};s.r(t),s.d(t,{get_recognition_object:()=>ae});var r={};s.r(r),s.d(r,{audio_context:()=>ue,error:()=>_e,input_ready:()=>ke,m2f:()=>oe,note_obj_to_midi:()=>pe,note_to_freq:()=>ge,note_to_midi:()=>me,note_to_note_obj:()=>fe,play_note:()=>ye,play_notes:()=>ve,play_notes_delay:()=>be,proceed:()=>Ae,success:()=>we,tone:()=>de});var i={};s.r(i),s.d(i,{audio_primitives:()=>Te,connect:()=>xe,disconnect:()=>Ie});var o={};s.r(o),s.d(o,{_recorder:()=>Se,get_current_data:()=>Le,get_recorder_object:()=>Ne,get_recorder_state:()=>Me,is_supported:()=>Oe,pause_recording:()=>Re,resume_recording:()=>$e,start_recording:()=>je,stop_recording:()=>De});var l={};s.r(l),s.d(l,{audio_detector:()=>Ge,detection_threshold:()=>ze,listeners:()=>Ve,media_recorder:()=>o,mic:()=>i,set_detection_threshold:()=>He,start_power:()=>Be,stop:()=>qe});var c={};s.r(c),s.d(c,{dot_join:()=>Qe,full_name:()=>Xe,get:()=>et,get_header:()=>nt,get_keys:()=>tt,get_t:()=>it,set_storage_header:()=>Ze,store:()=>Ye,store_t:()=>rt});var u={};s.r(u),s.d(u,{RecognitionState:()=>st,ap:()=>l,initialize_recognition:()=>ht,listen_while_speaking:()=>lt,pause_recognition:()=>dt,recognition:()=>ot,recognition_state:()=>ct,set_default_tts_rate:()=>vt,set_default_voice_from_name_preference_list:()=>bt,set_default_voice_uri:()=>yt,set_listen_while_speaking:()=>ut,speak:()=>_t,speak_with_rate:()=>kt,speak_with_voice:()=>wt,sr:()=>t,start_recognition:()=>ft,start_recognition_and_detection:()=>gt,stop_recognition:()=>pt,stop_recognition_and_detection:()=>mt,tts:()=>e});var h={};s.r(h),s.d(h,{WebSocketMaker:()=>Pt});var d={};s.r(d),s.d(d,{set_value_by_id:()=>Tt});var p={};s.r(p),s.d(p,{add_css:()=>Dt,add_script:()=>Nt,alert:()=>xt,audio_processing:()=>l,define:()=>St,dom:()=>d,inject_script:()=>jt,is_chrome:()=>It,is_mobile:()=>Ct,sounds:()=>r,speech_recognition:()=>t,tts:()=>e,uuid:()=>Ot,voice_interface:()=>u,ws:()=>h});var f={};s.r(f),s.d(f,{basic_spot_kine_socket:()=>Lt,basic_spot_trade_socket:()=>Ft,spot_kline_socket:()=>$t,spot_trade_socket:()=>Mt});var m={};s.r(m),s.d(m,{buy_beep:()=>Vt,sell_beep:()=>zt,set_sound_options:()=>Bt,sound_options:()=>Ut,trade_beeper:()=>Ht});var g={};s.r(g),s.d(g,{binance_listener:()=>m,binance_ws:()=>f});var y={};s.r(y),s.d(y,{load_key_handlers:()=>qt});var v={};s.r(v),s.d(v,{keys:()=>Yt,keys_to_notes_1:()=>en,load_sound_key_handler:()=>nn,sound_key_handler:()=>tn});var b={};s.r(b),s.d(b,{get_openai:()=>cn,get_openai_tts_response:()=>dn,openai_davinci_prompt:()=>fn,proxied_chat_completion:()=>mn,sendAudioBlobToOpenAI:()=>gn,speak:()=>un,text_to_audio:()=>hn,tts_response:()=>pn});var w={};s.r(w),s.d(w,{encode_json_to_uint8:()=>vn,get_datagram_writer:()=>bn,get_json_writer:()=>_n,init:()=>yn,write_json_datagram:()=>wn});var _={};s.r(_),s.d(_,{FacebookAuthProvider:()=>Qs,GithubAuthProvider:()=>Ys,GoogleAuthProvider:()=>Xs,addDoc:()=>Zf,collection:()=>df,doc:()=>pf,getDoc:()=>Kf,getFirestore:()=>gf,get_auth:()=>em,get_firestore_db:()=>tm,initialize_app:()=>Yf,initialize_firebase_auth_firestore:()=>nm,log_out:()=>rm,setDoc:()=>Jf,signInWithRedirect:()=>Ba});var k={};s.r(k),s.d(k,{get_midi_writer:()=>im});var A={};s.r(A),s.d(A,{webtransport:()=>k});var P={};s.r(P),s.d(P,{log_motion:()=>um,log_orientation:()=>hm,motion_handler:()=>gm,motion_subscribers:()=>lm,orientation_handler:()=>ym,orientation_subscribers:()=>cm,start_device_motion:()=>vm,start_device_orientation:()=>bm,stop_device_motion:()=>wm,stop_device_orientation:()=>_m,subscribe_to_motion:()=>dm,subscribe_to_orientation:()=>pm,unsubscribe_motion_id:()=>fm,unsubscribe_orientation_id:()=>mm});var T={};s.r(T),s.d(T,{CACHE_CHECK_INTERVAL:()=>Cm,GET_DB:()=>Dm,LOCAL_DB_HANDLE_CACHE:()=>Im,START_CACHE_CHECK:()=>Mm,STOP_CACHE_CHECK:()=>Fm,cache_check_interval_id:()=>$m,default_db_header:()=>Sm,default_store_name:()=>Om,deleteDB:()=>Um,do_cache_check:()=>Lm,exportDBString:()=>Bm,importFromJson:()=>Vm,log:()=>Em,set_cache_check_interval:()=>Rm});var E={};s.r(E),s.d(E,{load_bokeh_scripts:()=>Gm,point_plt:()=>qm});var x={};s.r(x),s.d(x,{SoundEventDetector:()=>dg,a1:()=>pg,a2:()=>fg,analyser:()=>Zm,ctx:()=>Wm,data_array:()=>cg,decode_audio_array_buffer:()=>ig,decode_audio_blob:()=>sg,get_audio_context:()=>Ym,get_audio_stream:()=>ng,get_sampling_rate:()=>rg,get_sound_event_detector:()=>gg,initialize_microphone:()=>hg,mic_callbacks:()=>ag,mic_initialized:()=>ug,plot_data:()=>yg,register_mic_callback:()=>og,remove_mic_callbacks:()=>tg,run_mic_callbacks:()=>lg,shutdown:()=>eg,sound_event_detector:()=>Qm,stream:()=>Jm,test_diff:()=>mg});var I={};s.r(I),s.d(I,{bind_sounds_to_keys:()=>v,bokeh:()=>E,db:()=>T,firebase:()=>_,key_presses:()=>y,local_storage:()=>c,midi:()=>A,openai:()=>b,sensor:()=>P,web_audio:()=>x,webtransport:()=>w});var C={};s.r(C);var O={};s.r(O),s.d(O,{adjust_tts_rate:()=>Ng,click_input:()=>wg,configure_tts:()=>jg,default_monitoring_interval:()=>Dg,enter_input:()=>_g,finish_stream_handler:()=>Ig,initialize_voice_system:()=>Rg,initialize_voice_system_with_tts:()=>$g,input_area:()=>vg,monitor_responses:()=>Cg,new_text_handler:()=>Tg,set_input:()=>bg,speak:()=>xg,speech_text_handler:()=>Eg,start_speech_recognition_and_link_to_input:()=>kg,stop_monitoring:()=>Sg,voice_preference_order:()=>Og});var S={};s.r(S),s.d(S,{chatgpt:()=>O});var N=s(78);let{asnc:j,fp:D,logger:R}=N,$=R.get_logger({id:"tts"});var L=function(){return window.speechSynthesis},M=[];function F(){$("Canceling speech, and queue"),M=[],L().cancel(),$("Done")}async function U(){await j.wait_until((()=>!L().speaking),1/0,200)}async function B(){await j.wait_until((()=>!L().speaking&&M.length<1),1/0,200)}function V(){return L().speaking||M.length>0}function z(){return L().getVoices()}function H(e){let t=L().getVoices().filter((t=>t.voiceURI==e));return t.length>0?t[0]:null}function G(e){let t=L().getVoices().filter((t=>t.name==e));return t.length>0?t[0]:null}function q(){try{return L().getVoices().length>0}catch(e){return!1}}async function K(){await N.asnc.wait_until(q,3e3,200),$("voices_ready")}var W=1;function J(e){W=e,$("Default rate set to: "+e)}async function Z(){$("pausing speech utterance");let e=L();e.speaking?(e.pause(),$("Speech paused.")):$("No speech is currently in progress to pause.")}async function Q(){$("resuming utterance");let e=L();e.paused?(e.resume(),$("Speech resumed.")):$("No speech is currently paused.")}async function X(e){let{voiceURI:t,rate:n=W,text:r}=e;if(L().speaking)$("Scheduling speech for later."),M.push(e);else{var i=new window.SpeechSynthesisUtterance(r);if(t){let e=H(t);e&&(i.voice=e)}i.rate=n,L().speak(i),await U();let e=M.shift();e?X(e):$("done with speech que")}}var Y="sentences";function ee(e){$(`Set chunk strategy: ${e}`),Y=e}function te(e){let{voiceURI:t,rate:n=W,text:r}=e;$("Request to speak  =:> "+r),$("With voice =:> "+t);var i=null;"sentences"==Y?($("splitting text by sentences"),i=r.split(".")):($("splitting text by words"),i=D.map(D.partition(D.split(r," "),20),D.joiner(" "))),i.forEach((function(t){let n=D.clone(e);n.text=t,X(n)}))}let{asnc:ne,fp:re,logger:ie}=N,se=ie.get_logger({id:"speech"});function ae(e={}){let{result_dispatch:t="tidyscripts_web_speech_recognition_result",interim_dispatch:n="tidyscripts_web_speech_recognition_interim"}=e,{continuous:r=!0,interimResults:i=!0,onStart:s=(()=>{se("Recognition started")}),onSoundStart:a=(()=>{se("Sound started...")}),onSoundEnd:o=(()=>{se("Sound ended...")}),onSpeechStart:l=(()=>{se("Speech started...")}),onSpeechEnd:c=(()=>{se("Speech ended...")}),onResult:u=function(e){let r="",i="";for(let s=e.resultIndex;s<e.results.length;++s)e.results[s].isFinal?(se("GOT FINAL RESULT"),i+=e.results[s][0].transcript,se("Recognition result: "+i),window.dispatchEvent(new CustomEvent(t,{detail:i}))):(r+=e.results[s][0].transcript,window.dispatchEvent(new CustomEvent(n,{detail:r})))},onError:h=(e=>{se("Recognition error: "),console.log(e)}),onEnd:d=(()=>{se("Recognition ended")}),lang:p="en-US"}=e,f=new window.webkitSpeechRecognition;return f.onresult=u,f.onerror=h,f.onend=d,f.continuous=r,f.interimResults=i,f.onstart=s,f.onsoundstart=a,f.onsoundend=o,f.onspeechstart=l,f.onspeechend=c,f}var oe={12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:27.5,22:29.135,23:30.868,24:32.703,25:34.648,26:36.708,27:38.891,28:41.203,29:43.654,30:46.249,31:48.999,32:51.913,33:55,34:58.27,35:61.735,36:65.406,37:69.296,38:73.416,39:77.782,40:82.407,41:87.307,42:92.499,43:97.999,44:103.826,45:110,46:116.541,47:123.471,48:130.813,49:138.591,50:146.832,51:155.564,52:164.814,53:174.614,54:184.997,55:195.998,56:207.652,57:220,58:233.082,59:246.942,60:261.626,61:277.183,62:293.665,63:311.127,64:329.628,65:349.228,66:369.994,67:391.995,68:415.305,69:440,70:466.164,71:493.883,72:523.251,73:554.365,74:587.33,75:622.254,76:659.255,77:698.457,78:739.989,79:783.991,80:830.609,81:880,82:932.328,83:987.767,84:1046.502,85:1108.731,86:1174.659,87:1244.508,88:1318.51,89:1396.913,90:1479.978,91:1567.982,92:1661.219,93:1760,94:1864.655,95:1975.533,96:2093.005,97:2217.461,98:2349.318,99:2489.016,100:2637.021,101:2793.826,102:2959.956,103:3135.964,104:3322.438,105:3520,106:3729.31,107:3951.066,108:4186.009,109:4434.922,110:4698.637,111:4978.032,112:5274.042,113:5587.652,114:5919.912,115:6271.928,116:6644.876,117:7040,118:7458.62,119:7902.133,120:8372.019,121:8869.845,122:9397.273,123:9956.064,124:10548.083,125:11175.305,126:11839.823,127:12543.855};let{fp:le,asnc:ce}=N;var ue=null,he=function(){if(ue)return ue;{let e=window.AudioContext||window.webkitAudioContext;return ue=new e}};async function de(e){let{type:t="sine",duration:n=600,gain:r=.5,delay:i,freq:s}=e,a=he();var o=a.createOscillator();o.frequency.value=s,o.type=t;var l=a.createGain();if(i){var c=a.createDelay();c.delayTime.value=i,l.connect(c),c.connect(a.destination)}l.gain.value=r,o.connect(l),l.connect(a.destination),o.start(0),await ce.wait(n),o.stop()}function pe(e){let{num:t,mod:n,octave:r}=e,i=function(e){return le.nth([0,0,2,4,5,7,9,11,12],e)}(t)+12*r;return n&&(i+="#"==n?1:-1),i}function fe(e){let t=e.split(".");var n=0,r=null,i=null;return t.length>1&&(n=Number(t[1])),t[0].length>1?(r=t[0][0],i=Number(t[0][1])):i=Number(t[0][0]),{num:i,mod:r,octave:n}}function me(e){return pe(fe(e))}function ge(e){return oe[me(e)]}async function ye(e,t,n){console.log(le.format("note | n= {}, dur={}, k={}",[e,t,n]));let r=n?me(n):60,i=me(e),s=oe[String(r+i)],a=t||500;try{await de({freq:s,duration:a})}catch(e){console.log("Error playing. You likely played a note outside of currently supported range"),console.log(e),console.log("freq + duration:"),console.log({freq:s,duration:a})}}async function ve(e,t,n){e.map((e=>ye(e,t,n)))}async function be(e,t,n,r){for(var i of e)ye(i,n,r),await ce.wait(t)}function we(){ve(["1","3"],400,"3.5")}function _e(){ve(["1","b5"],200,"3.5")}function ke(){be(["1","3"],100,100,"3.5")}function Ae(){ve(["5.-1"],100,"3.5")}const Pe=N.logger.get_logger({id:"mic"});var Te={context:null,source:null,processor:null,stream:null,mic_sample_rate:null},Ee=function(e,t){return function(n){var r,i,s,a,o;Te.stream=n,Te.context=new window.AudioContext,Te.source=null===(r=Te.context)||void 0===r?void 0:r.createMediaStreamSource(n),Te.processor=null===(i=Te.context)||void 0===i?void 0:i.createScriptProcessor(1024,1,1),null===(s=Te.source)||void 0===s||s.connect(Te.processor),null===(a=Te.processor)||void 0===a||a.connect(null===(o=Te.context)||void 0===o?void 0:o.destination),Te.processor.onaudioprocess=function(n){let r=e(n.inputBuffer.getChannelData(0));const i=new window.CustomEvent(t,{detail:r});window.dispatchEvent(i)};let l=n.getAudioTracks()[0].getSettings().sampleRate;Te.mic_sample_rate=l,Pe(`Determined sample rate of mic : ${Te.mic_sample_rate}`)}};function xe(e,t){let n=t||"tidyscripts_web_mic";window.navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(Ee(e,n))}function Ie(){let e=Te.context;e&&e.close(),Te={context:null,source:null,processor:null,stream:null,mic_sample_rate:null}}const Ce=N.logger.get_logger({id:"media_recorder"});function Oe(){return!!window.navigator.mediaDevices}var Se=null;async function Ne(){if(Se)return Se;if(!Oe())return void Ce("NOT SUPPORTED");let e=await navigator.mediaDevices.getUserMedia({audio:!0});return Se=new MediaRecorder(e)}async function je(e,t){let n=await Ne();n.addEventListener("dataavailable",(async function(t){e(await t.data)})),n.start(t),Ce("Recording started")}async function De(){(await Ne()).stop(),Ce("Recording stopped")}async function Re(){(await Ne()).pause(),Ce("Recording paused")}async function $e(){(await Ne()).resume(),Ce("Recording resumed")}async function Le(){return(await Ne()).requestData()}async function Me(){return(await Ne()).state}let{dsp:Fe,performance:Ue}=N.util;function Be(){xe((e=>Fe.power(e)),"tidyscripts_web_mic")}var Ve=[],ze=1e3;function He(e){ze=e}function Ge(e,t){Be(),t&&He(t);var n=0,r=Ue.ms();let i=t=>{let i=t.detail;if(0==n)return void(n=i);let s=i/n*100;Ue.ms()-r>600&&s>ze&&e(),n=i};window.addEventListener("tidyscripts_web_mic",i),Ve.push(["tidyscripts_web_mic",i])}function qe(){for(var e of(Ie(),Ve))window.removeEventListener(e[0],e[1]);Ve=[]}let{fp:Ke}=N,We=function(){return window.localStorage};var Je="tidyscripts";function Ze(e){Je=e}function Qe(e){return e.join(".")}function Xe(e){return Qe([Je,e])}function Ye(e,t){We()[Xe(t)]=JSON.stringify(e)}function et(e){let t=We()[Xe(e)];return t?JSON.parse(t):null}function tt(){return Object.keys(We())}function nt(e){let t=tt();return Ke.filter(t,(t=>t.startsWith(e)))}function rt(e,t){Ye({timestamp:Number(new Date),data:e},t)}function it(e){return et(e)}var st,at=N.logger.get_logger({id:"voice_interface"}),ot=null,lt=!1;!function(e){e.NULL="NULL",e.STOPPED="STOPPED",e.PAUSED="PAUSED",e.LISTENING="LISTENING",e.STOPPING="STOPPING"}(st||(st={}));var ct=st.NULL;function ut(e){at(`Set listen_while_speaking=${e}`),lt=e}function ht(e){pt();let t=(e=e||{}).onEnd;e.onEnd=function(){ct==st.STOPPING?(at("Recognition stopped"),ct=st.STOPPED):(ct=st.PAUSED,at("Recognition paused")),t&&t()},ot=ae(e),ct=st.PAUSED,Ge(ft)}function dt(){ot&&(ot.abort(),ct=st.PAUSED)}function pt(){ot&&(at("Stopping recognition"),ct=st.STOPPING,ot.abort(),ot=null,qe())}async function ft(){ct!=st.LISTENING&&(V()&&at("Wont start recognition while tts active"),ot?ot.start():(ht(),at("Recognition initialized without args")),ct=st.LISTENING)}function mt(){let e=ze;return dt(),He(1/0),e}function gt(e){ft(),He(e)}function yt(e){Ye("default_voice_uri",e)}function vt(e){J(e)}function bt(e){for(var t of e){let e=G(t);if(e)return yt(e.voiceURI),void at(`Set default voice to: ${e.name}`)}at("Unable to set default voice to any matching name in provided list")}async function wt(e,t,n){if(ot)if(lt)at("Listening while speaking"),te({text:e,voiceURI:t,rate:n}),await B();else{at("Stopping listening while speaking");let r=mt();te({text:e,voiceURI:t,rate:n}),await B(),gt(r)}else te({text:e,voiceURI:t,rate:n}),await B()}async function _t(e){wt(e,et("default_voice_uri"),W)}async function kt(e,t){wt(e,et("default_voice_uri"),t)}let At=N.logger.get_logger({id:"ws"});function Pt(e){var{url:t,handler:n,open:r,error:i,close:s}=e;r=r||(()=>{At(`ws to ${t} opened`)}),s=s||(()=>{At(`ws to ${t} closed`)}),i=i||(e=>{At(`ws to ${t} errored: ${JSON.stringify(e)}`)});let a=new WebSocket(t);return a.onopen=r,a.onclose=s,a.onerror=i,a.onmessage=e=>{n(e.data)},a}function Tt(e,t){document.getElementById(e).value=t}let Et=N.logger.get_logger({id:"wutil"});function xt(e){Et("Alerting web page!"),window.alert(e)}function It(){return/Chrome/.test(window.navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function Ct(){return/Mobi/.test(window.navigator.userAgent)}function Ot(){var e=new Uint32Array(4);window.crypto.getRandomValues(e);var t=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){t++;var r=e[t>>3]>>t%8*4&15;return("x"==n?r:3&r|8).toString(16)}))}async function St(e,t){window[t]=await e,Et(`Defined ${t} on the window object :)`)}function Nt(e){return new Promise(((t,n)=>{const r=window.document.createElement("script");r.setAttribute("src",e),r.addEventListener("load",t),r.addEventListener("error",n),document.body.appendChild(r)}))}function jt(e){return new Promise(((t,n)=>{const r=window.document.createElement("script");r.setAttribute("src",e.src);let i=e.attributes;if(i){let e=Object.keys(i);for(let t of e)r.setAttribute(t,i[t])}r.addEventListener("load",t),r.addEventListener("error",n),document.body.appendChild(r)}))}function Dt(e){return new Promise(((t,n)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=e,r.media="all",r.addEventListener("load",t),r.addEventListener("error",n),document.getElementsByTagName("head")[0].appendChild(r)}))}let Rt=N.logger.get_logger({id:"bws"});function $t(e,t){let{sym:n,handler:r,error:i,close:s,open:a}=e;n=n.toLowerCase();let o=`wss://stream.binance.com:9443/ws/${n}@kline_${t=t||"1m"}`;return Rt("Using url for spot kline socket: "+o),Pt({url:o,handler:r,error:i,close:s,open:a})}function Lt(e,t){return $t({sym:e,handler:t=t||(e=>{console.log(JSON.parse(e))})})}function Mt(e){let{sym:t,handler:n,error:r,close:i,open:s}=e;t=t.toLowerCase();let a=`wss://stream.binance.com:9443/ws/${t}@aggTrade`;return Rt("Using url for spot trade socket: "+a),Pt({url:a,handler:n,error:r,close:i,open:s})}function Ft(e,t){return Mt({sym:e,handler:t=t||(e=>{console.log(JSON.parse(e))})})}var Ut={freq:{buy:620,sell:580},duration:{buy:30,sell:30}};function Bt(e){Ut=e}function Vt(e){de({freq:Ut.freq.buy,gain:e,duration:Ut.duration.buy})}function zt(e){de({freq:Ut.freq.sell,gain:e,duration:Ut.duration.sell})}function Ht(e){return Ft(e,(function(e){let t=JSON.parse(e),{m:n,p:r,q:i}=t,s=Number(i),a=s>1?1:s;console.log(t),n?zt(a):Vt(a)}))}let Gt=N.logger.get_logger({id:"key_presses"});function qt(e){window.onkeypress=function(t){Gt("Keypress!");let n=t.key;console.log(n),e[n]&&e[n]()}}N.fp,N.util.debug;let Kt=N.logger.get_logger({id:"key_sounds"}),Wt=N.fp,Jt=N.util.debug;var Zt=["q","w","e","r","t","y","u","i","o","p","["],Qt=["a","s","d","f","g","h","j","k","l",";"],Xt=["z","x","c","v","b","n","m",","],Yt={hi:Zt,mid:Qt,lo:Xt};function en(e){let t=Xt.concat(Qt).concat(Zt),n=0,r={};for(var i of Wt.enumerate(t)){i[0]%7==0&&(n+=1);let e=i[0]%7+1,t=Wt.format("{}.{}",[e,n]);r[i[1]]=t}return r}function tn(e,t=30,n="1.4"){let r={};for(var i of Wt.dict_to_list(e)){let e=i[0],s=i[1];r[e]=function(){Kt(String(s)),ye(String(s),t,n)}}return r}function nn(e=30,t="1.4"){let n=tn(en(),e,t);qt(n),Jt.add("km",n)}let{get_json_from_url:rn}=N,{OpenAI:sn}=N.apis;var an=null;const on=N.logger.get_logger({id:"open_ai_web"}),ln=N.util.debug;function cn(){if(an)return on("OpenAI already initialized"),an;{on("Initializing open api in browser");let e=localStorage.OAAK;if(e)return an=new sn({apiKey:e,dangerouslyAllowBrowser:!0}),on("Complete"),an;{let e='Unable to find API key; please make sure api key is under "OAAK" in local storage';return on(e),window.alert(e),1}}}async function un(e){on(`Request to speak ${e}`);let t=await hn(e);return on("Retrieved audio data from openai"),on("Playing audio and returning data"),t.audio_element.play(),t}async function hn(e){let t=await pn(e),n=await t.blob(),r=URL.createObjectURL(n);return{audio_element:new Audio(r),blob:n}}async function dn(e){let t=cn();return await t.audio.speech.create({model:"tts-1",voice:"alloy",input:e})}async function pn(e){let t=cn();return await t.audio.speech.create(e)}async function fn(e,t){return await rn("https://www.tidyscripts.com/api/openai_davinci",{prompt:e,max_tokens:t})}async function mn(e){let t="/api/open_ai_chat_2";e.response_format&&(on("Detected request for structured completion"),t="/api/openai_structured_completion",on(`Switching URL to ${t}`),ln.add("chat_completion_args",e));let n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});ln.add("fetch_response",n);let r=await n.json();return ln.add("response",r),r}async function gn(e){cn();let t=localStorage.OAAK;const n=new FormData;n.append("file",e,"audio.webm"),n.append("model","whisper-1");try{const e=await fetch("https://api.openai.com/v1/audio/transcriptions",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:n});if(!e.ok)throw new Error(`API request failed with status ${e.status}`);const r=await e.json();return on(`Transcription: ${r.text}`),r.text}catch(e){console.error("Error while sending audio to OpenAI:",e)}}function yn(e){return new WebTransport(e)}function vn(e){return(new TextEncoder).encode(JSON.stringify(e))}function bn(e){let t=yn(e);return{writer:t.datagrams.writable.getWriter(),transport:t}}async function wn(e,t){let n=vn(t);await e.write(n)}function _n(e){let{writer:t,transport:n}=bn(e);return t.write_json=async function(e){await t.write(vn(e))},t}const kn=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},An={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,c=i>>2,u=(3&i)<<4|a>>4;let h=(15&a)<<2|l>>6,d=63&l;o||(d=64,s||(h=64)),r.push(n[c],n[u],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(kn(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const o=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new Pn;const l=i<<2|s>>4;if(r.push(l),64!==a){const e=s<<4&240|a>>2;if(r.push(e),64!==o){const e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Pn extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Tn=function(e){return function(e){const t=kn(e);return An.encodeByteArray(t,!0)}(e).replace(/\./g,"")},En=function(e){try{return An.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},xn=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==s.g)return s.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&En(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},In=e=>{var t,n;return null===(n=null===(t=xn())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},Cn=e=>{const t=In(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},On=()=>{var e;return null===(e=xn())||void 0===e?void 0:e.config},Sn=e=>{var t;return null===(t=xn())||void 0===t?void 0:t[`_${e}`]};class Nn{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function jn(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class Dn extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Dn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Rn.prototype.create)}}class Rn{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace($n,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",a=`${this.serviceName}: ${s} (${r}).`;return new Dn(r,a,n)}}const $n=/\{\$([^}]+)}/g;function Ln(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(Mn(n)&&Mn(s)){if(!Ln(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function Mn(e){return null!==e&&"object"==typeof e}function Fn(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Un(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function Bn(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Vn{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=zn),void 0===r.error&&(r.error=zn),void 0===r.complete&&(r.complete=zn);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function zn(){}function Hn(e){return e&&e._delegate?e._delegate:e}class Gn{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const qn="[DEFAULT]";class Kn{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Nn;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const e=this.getOrInitializeService({instanceIdentifier:t});e&&n.resolve(e)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:qn})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(e){}}}}clearInstance(e=qn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=qn){return this.instances.has(e)}getOptions(e=qn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===qn?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=qn){return this.component?this.component.multipleInstances?e:qn:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Wn{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Kn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Jn=[];var Zn;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Zn||(Zn={}));const Qn={debug:Zn.DEBUG,verbose:Zn.VERBOSE,info:Zn.INFO,warn:Zn.WARN,error:Zn.ERROR,silent:Zn.SILENT},Xn=Zn.INFO,Yn={[Zn.DEBUG]:"log",[Zn.VERBOSE]:"log",[Zn.INFO]:"info",[Zn.WARN]:"warn",[Zn.ERROR]:"error"},er=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=Yn[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class tr{constructor(e){this.name=e,this._logLevel=Xn,this._logHandler=er,this._userLogHandler=null,Jn.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Zn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Qn[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Zn.DEBUG,...e),this._logHandler(this,Zn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Zn.VERBOSE,...e),this._logHandler(this,Zn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Zn.INFO,...e),this._logHandler(this,Zn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Zn.WARN,...e),this._logHandler(this,Zn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Zn.ERROR,...e),this._logHandler(this,Zn.ERROR,...e)}}const nr=(e,t)=>t.some((t=>e instanceof t));let rr,ir;const sr=new WeakMap,ar=new WeakMap,or=new WeakMap,lr=new WeakMap,cr=new WeakMap;let ur={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ar.get(e);if("objectStoreNames"===t)return e.objectStoreNames||or.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return hr(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function hr(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(hr(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&sr.set(t,e)})).catch((()=>{})),cr.set(t,e),t}(e);if(lr.has(e))return lr.get(e);const t=function(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ir||(ir=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(dr(this),e),hr(sr.get(this))}:function(...e){return hr(t.apply(dr(this),e))}:function(e,...n){const r=t.call(dr(this),e,...n);return or.set(r,e.sort?e.sort():[e]),hr(r)}:(e instanceof IDBTransaction&&function(e){if(ar.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));ar.set(e,t)}(e),nr(e,rr||(rr=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,ur):e);var t}(e);return t!==e&&(lr.set(e,t),cr.set(t,e)),t}const dr=e=>cr.get(e),pr=["get","getKey","getAll","getAllKeys","count"],fr=["put","add","delete","clear"],mr=new Map;function gr(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(mr.get(t))return mr.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=fr.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!pr.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return mr.set(t,s),s}var yr;yr=ur,ur={...yr,get:(e,t,n)=>gr(e,t)||yr.get(e,t,n),has:(e,t)=>!!gr(e,t)||yr.has(e,t)};class vr{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const br="@firebase/app",wr="0.10.13",_r=new tr("@firebase/app"),kr="@firebase/app-compat",Ar="@firebase/analytics-compat",Pr="@firebase/analytics",Tr="@firebase/app-check-compat",Er="@firebase/app-check",xr="@firebase/auth",Ir="@firebase/auth-compat",Cr="@firebase/database",Or="@firebase/data-connect",Sr="@firebase/database-compat",Nr="@firebase/functions",jr="@firebase/functions-compat",Dr="@firebase/installations",Rr="@firebase/installations-compat",$r="@firebase/messaging",Lr="@firebase/messaging-compat",Mr="@firebase/performance",Fr="@firebase/performance-compat",Ur="@firebase/remote-config",Br="@firebase/remote-config-compat",Vr="@firebase/storage",zr="@firebase/storage-compat",Hr="@firebase/firestore",Gr="@firebase/vertexai-preview",qr="@firebase/firestore-compat",Kr="firebase",Wr="[DEFAULT]",Jr={[br]:"fire-core",[kr]:"fire-core-compat",[Pr]:"fire-analytics",[Ar]:"fire-analytics-compat",[Er]:"fire-app-check",[Tr]:"fire-app-check-compat",[xr]:"fire-auth",[Ir]:"fire-auth-compat",[Cr]:"fire-rtdb",[Or]:"fire-data-connect",[Sr]:"fire-rtdb-compat",[Nr]:"fire-fn",[jr]:"fire-fn-compat",[Dr]:"fire-iid",[Rr]:"fire-iid-compat",[$r]:"fire-fcm",[Lr]:"fire-fcm-compat",[Mr]:"fire-perf",[Fr]:"fire-perf-compat",[Ur]:"fire-rc",[Br]:"fire-rc-compat",[Vr]:"fire-gcs",[zr]:"fire-gcs-compat",[Hr]:"fire-fst",[qr]:"fire-fst-compat",[Gr]:"fire-vertex","fire-js":"fire-js",[Kr]:"fire-js-all"},Zr=new Map,Qr=new Map,Xr=new Map;function Yr(e,t){try{e.container.addComponent(t)}catch(n){_r.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ei(e){const t=e.name;if(Xr.has(t))return _r.debug(`There were multiple attempts to register component ${t}.`),!1;Xr.set(t,e);for(const t of Zr.values())Yr(t,e);for(const t of Qr.values())Yr(t,e);return!0}function ti(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ni(e){return void 0!==e.settings}const ri=new Rn("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ii{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Gn("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ri.create("app-deleted",{appName:this._name})}}const si="10.14.1";function ai(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:Wr,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw ri.create("bad-app-name",{appName:String(i)});if(n||(n=On()),!n)throw ri.create("no-options");const s=Zr.get(i);if(s){if(Ln(n,s.options)&&Ln(r,s.config))return s;throw ri.create("duplicate-app",{appName:i})}const a=new Wn(i);for(const e of Xr.values())a.addComponent(e);const o=new ii(n,r,a);return Zr.set(i,o),o}function oi(e=Wr){const t=Zr.get(e);if(!t&&e===Wr&&On())return ai();if(!t)throw ri.create("no-app",{appName:e});return t}function li(e,t,n){var r;let i=null!==(r=Jr[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void _r.warn(e.join(" "))}ei(new Gn(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const ci="firebase-heartbeat-database",ui=1,hi="firebase-heartbeat-store";let di=null;function pi(){return di||(di=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),o=hr(a);return r&&a.addEventListener("upgradeneeded",(e=>{r(hr(a.result),e.oldVersion,e.newVersion,hr(a.transaction),e)})),n&&a.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),o.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),o}(ci,ui,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(hi)}catch(e){console.warn(e)}}}).catch((e=>{throw ri.create("idb-open",{originalErrorMessage:e.message})}))),di}async function fi(e,t){try{const n=(await pi()).transaction(hi,"readwrite"),r=n.objectStore(hi);await r.put(t,mi(e)),await n.done}catch(e){if(e instanceof Dn)_r.warn(e.message);else{const t=ri.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});_r.warn(t.message)}}}function mi(e){return`${e.name}!${e.options.appId}`}class gi{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new vi(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=yi();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(e){_r.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=yi(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),bi(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),bi(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=Tn(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return _r.warn(e),""}}}function yi(){return(new Date).toISOString().substring(0,10)}class vi{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await pi()).transaction(hi),n=await t.objectStore(hi).get(mi(e));return await t.done,n}catch(e){if(e instanceof Dn)_r.warn(e.message);else{const t=ri.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});_r.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return fi(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return fi(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function bi(e){return Tn(JSON.stringify({version:2,heartbeats:e})).length}function wi(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}ei(new Gn("platform-logger",(e=>new vr(e)),"PRIVATE")),ei(new Gn("heartbeat",(e=>new gi(e)),"PRIVATE")),li(br,wr,""),li(br,wr,"esm2017"),li("fire-js",""),li("firebase","10.14.1","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const _i=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ki=new Rn("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ai=new tr("@firebase/auth");function Pi(e,...t){Ai.logLevel<=Zn.ERROR&&Ai.error(`Auth (${si}): ${e}`,...t)}function Ti(e,...t){throw Ci(e,...t)}function Ei(e,...t){return Ci(e,...t)}function xi(e,t,n){const r=Object.assign(Object.assign({},_i()),{[t]:n});return new Rn("auth","Firebase",r).create(t,{appName:e.name})}function Ii(e){return xi(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ci(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return ki.create(e,...t)}function Oi(e,t,...n){if(!e)throw Ci(t,...n)}function Si(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Pi(t),new Error(t)}function Ni(e,t){e||Si(t)}function ji(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Di(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Ri{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ni(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(jn())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Di()||"https:"===Di()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function $i(e,t){Ni(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Li{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Si("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Si("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Si("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Mi={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Fi=new Ri(3e4,6e4);function Ui(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Bi(e,t,n,r,i={}){return Vi(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const a=Fn(Object.assign({key:e.config.apiKey},s)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l=Object.assign({method:t,headers:o},i);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),Li.fetch()(Hi(e,e.config.apiHost,n,a),l)}))}async function Vi(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Mi),t);try{const t=new qi(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw Ki(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ki(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw Ki(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw Ki(e,"user-disabled",s);const o=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw xi(e,o,a);Ti(e,o)}}catch(t){if(t instanceof Dn)throw t;Ti(e,"network-request-failed",{message:String(t)})}}async function zi(e,t,n,r,i={}){const s=await Bi(e,t,n,r,i);return"mfaPendingCredential"in s&&Ti(e,"multi-factor-auth-required",{_serverResponse:s}),s}function Hi(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?$i(e.config,i):`${e.config.apiScheme}://${i}`}function Gi(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qi{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Ei(this.auth,"network-request-failed"))),Fi.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ki(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Ei(e,t,r);return i.customData._tokenResponse=n,i}function Wi(e){return void 0!==e&&void 0!==e.enterprise}class Ji{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Gi(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function Zi(e,t){return Bi(e,"POST","/v1/accounts:lookup",t)}function Qi(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Xi(e){return 1e3*Number(e)}function Yi(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Pi("JWT malformed, contained fewer than 3 sections"),null;try{const e=En(n);return e?JSON.parse(e):(Pi("Failed to decode base64 JWT payload"),null)}catch(e){return Pi("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function es(e){const t=Yi(e);return Oi(t,"internal-error"),Oi(void 0!==t.exp,"internal-error"),Oi(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function ts(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof Dn&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ns{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class rs{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Qi(this.lastLoginAt),this.creationTime=Qi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function is(e){var t;const n=e.auth,r=await e.getIdToken(),i=await ts(e,Zi(n,{idToken:r}));Oi(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const a=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?ss(s.providerUserInfo):[],o=(l=e.providerData,c=a,[...l.filter((e=>!c.some((t=>t.providerId===e.providerId)))),...c]);var l,c;const u=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==o?void 0:o.length)),d=!!u&&h,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new rs(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,p)}function ss(e){return e.map((e=>{var{providerId:t}=e,n=wi(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class as{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Oi(e.idToken,"internal-error"),Oi(void 0!==e.idToken,"internal-error"),Oi(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):es(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Oi(0!==e.length,"internal-error");const t=es(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Oi(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await Vi(e,{},(async()=>{const n=Fn({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=Hi(e,r,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Li.fetch()(s,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new as;return n&&(Oi("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Oi("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Oi("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new as,this.toJSON())}_performRefresh(){return Si("not implemented")}}function os(e,t){Oi("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ls{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=wi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ns(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new rs(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ts(this,this.stsTokenManager.getToken(this.auth,e));return Oi(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=Hn(e),r=await n.getIdToken(t),i=Yi(r);Oi(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Qi(Xi(i.auth_time)),issuedAtTime:Qi(Xi(i.iat)),expirationTime:Qi(Xi(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Hn(e);await is(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Oi(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ls(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Oi(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await is(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ni(this.auth.app))return Promise.reject(Ii(this.auth));const e=await this.getIdToken();return await ts(this,async function(e,t){return Bi(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,a,o,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(a=t.tenantId)&&void 0!==a?a:void 0,m=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:v,emailVerified:b,isAnonymous:w,providerData:_,stsTokenManager:k}=t;Oi(v&&k,e,"internal-error");const A=as.fromJSON(this.name,k);Oi("string"==typeof v,e,"internal-error"),os(u,e.name),os(h,e.name),Oi("boolean"==typeof b,e,"internal-error"),Oi("boolean"==typeof w,e,"internal-error"),os(d,e.name),os(p,e.name),os(f,e.name),os(m,e.name),os(g,e.name),os(y,e.name);const P=new ls({uid:v,auth:e,email:h,emailVerified:b,displayName:u,isAnonymous:w,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:A,createdAt:g,lastLoginAt:y});return _&&Array.isArray(_)&&(P.providerData=_.map((e=>Object.assign({},e)))),m&&(P._redirectEventId=m),P}static async _fromIdTokenResponse(e,t,n=!1){const r=new as;r.updateFromServerResponse(t);const i=new ls({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await is(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];Oi(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?ss(r.providerUserInfo):[],s=!(r.email&&r.passwordHash||(null==i?void 0:i.length)),a=new as;a.updateFromIdToken(n);const o=new ls({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:s}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new rs(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==i?void 0:i.length))};return Object.assign(o,l),o}}const cs=new Map;function us(e){Ni(e instanceof Function,"Expected a class definition");let t=cs.get(e);return t?(Ni(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,cs.set(e,t),t)}class hs{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}hs.type="NONE";const ds=hs;function ps(e,t,n){return`firebase:${e}:${t}:${n}`}class fs{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=ps(this.userKey,r.apiKey,i),this.fullPersistenceKey=ps("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ls._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new fs(us(ds),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||us(ds);const s=ps(n,e.config.apiKey,e.name);let a=null;for(const n of t)try{const t=await n._get(s);if(t){const r=ls._fromJSON(e,t);n!==i&&(a=r),i=n;break}}catch(e){}const o=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&o.length?(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new fs(i,e,n)):new fs(i,e,n)}}function ms(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(bs(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(gs(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(_s(t))return"Blackberry";if(ks(t))return"Webos";if(ys(t))return"Safari";if((t.includes("chrome/")||vs(t))&&!t.includes("edge/"))return"Chrome";if(ws(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function gs(e=jn()){return/firefox\//i.test(e)}function ys(e=jn()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function vs(e=jn()){return/crios\//i.test(e)}function bs(e=jn()){return/iemobile/i.test(e)}function ws(e=jn()){return/android/i.test(e)}function _s(e=jn()){return/blackberry/i.test(e)}function ks(e=jn()){return/webos/i.test(e)}function As(e=jn()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ps(e=jn()){return As(e)||ws(e)||ks(e)||_s(e)||/windows phone/i.test(e)||bs(e)}function Ts(e,t=[]){let n;switch(e){case"Browser":n=ms(jn());break;case"Worker":n=`${ms(jn())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${si}/${r}`}class Es{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const n of t)try{n()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class xs{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(r=o.containsLowercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(i=o.containsUppercaseLetter)||void 0===i||i),o.isValid&&(o.isValid=null===(s=o.containsNumericCharacter)||void 0===s||s),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Is{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Os(this),this.idTokenSubscription=new Os(this),this.beforeStateQueue=new Es(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ki,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=us(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await fs.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Zi(this,{idToken:e}),n=await ls._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ni(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,a=await this.tryRedirectSignIn(e);n&&n!==s||!(null==a?void 0:a.user)||(r=a.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Oi(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await is(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ni(this.app))return Promise.reject(Ii(this));const t=e?Hn(e):null;return t&&Oi(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Oi(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return ni(this.app)?Promise.reject(Ii(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ni(this.app)?Promise.reject(Ii(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(us(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return Bi(e,"GET","/v2/passwordPolicy",Ui(e,t))}(this),t=new xs(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Rn("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Bi(e,"POST","/v2/accounts:revokeToken",Ui(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&us(e)||this._popupRedirectResolver;Oi(t,this,"argument-error"),this.redirectPersistenceManager=await fs.create(this,[us(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Oi(a,this,"internal-error"),a.then((()=>{s||i(this.currentUser)})),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Oi(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ts(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Ai.logLevel<=Zn.WARN&&Ai.warn(`Auth (${si}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Cs(e){return Hn(e)}class Os{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new Vn(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Oi(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ss={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ns(e){return Ss.loadJS(e)}function js(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Ds{constructor(e){this.type="recaptcha-enterprise",this.auth=Cs(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;Wi(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{(async function(e,t){return Bi(e,"GET","/v2/recaptchaConfig",Ui(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}))})(e).then((r=>{if(void 0!==r.recaptchaKey){const n=new Ji(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&Wi(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Ss.recaptchaEnterpriseScript;0!==t.length&&(t+=i),Ns(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Rs(e,t,n,r=!1){const i=new Ds(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const a=Object.assign({},t);return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function $s(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Rs(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await Rs(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}function Ls(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ms(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Fs{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Si("not implemented")}_getIdTokenResponse(e){return Si("not implemented")}_linkToIdToken(e,t){return Si("not implemented")}_getReauthenticationResolver(e){return Si("not implemented")}}async function Us(e,t){return Bi(e,"POST","/v1/accounts:signUp",t)}async function Bs(e,t){return zi(e,"POST","/v1/accounts:signInWithPassword",Ui(e,t))}class Vs extends Fs{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Vs(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Vs(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return $s(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Bs);case"emailLink":return async function(e,t){return zi(e,"POST","/v1/accounts:signInWithEmailLink",Ui(e,t))}(e,{email:this._email,oobCode:this._password});default:Ti(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return $s(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Us);case"emailLink":return async function(e,t){return zi(e,"POST","/v1/accounts:signInWithEmailLink",Ui(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Ti(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function zs(e,t){return zi(e,"POST","/v1/accounts:signInWithIdp",Ui(e,t))}class Hs extends Fs{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Hs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ti("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=wi(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Hs(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return zs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,zs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,zs(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Fn(t)}return e}}const Gs={USER_NOT_FOUND:"user-not-found"};class qs extends Fs{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new qs({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new qs({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return zi(e,"POST","/v1/accounts:signInWithPhoneNumber",Ui(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await zi(e,"POST","/v1/accounts:signInWithPhoneNumber",Ui(e,t));if(n.temporaryProof)throw Ki(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return zi(e,"POST","/v1/accounts:signInWithPhoneNumber",Ui(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Gs)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new qs({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Ks{constructor(e){var t,n,r,i,s,a;const o=Un(Bn(e)),l=null!==(t=o.apiKey)&&void 0!==t?t:null,c=null!==(n=o.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=o.mode)&&void 0!==r?r:null);Oi(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(i=o.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=o.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(a=o.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=Un(Bn(e)).link,n=t?Un(Bn(t)).deep_link_id:null,r=Un(Bn(e)).deep_link_id;return(r?Un(Bn(r)).link:null)||r||n||t||e}(e);try{return new Ks(t)}catch(e){return null}}}class Ws{constructor(){this.providerId=Ws.PROVIDER_ID}static credential(e,t){return Vs._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Ks.parseLink(t);return Oi(n,"argument-error"),Vs._fromEmailAndCode(e,n.code,n.tenantId)}}Ws.PROVIDER_ID="password",Ws.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ws.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Js{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Zs extends Js{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Qs extends Zs{constructor(){super("facebook.com")}static credential(e){return Hs._fromParams({providerId:Qs.PROVIDER_ID,signInMethod:Qs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qs.credentialFromTaggedObject(e)}static credentialFromError(e){return Qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Qs.credential(e.oauthAccessToken)}catch(e){return null}}}Qs.FACEBOOK_SIGN_IN_METHOD="facebook.com",Qs.PROVIDER_ID="facebook.com";class Xs extends Zs{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Hs._fromParams({providerId:Xs.PROVIDER_ID,signInMethod:Xs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Xs.credentialFromTaggedObject(e)}static credentialFromError(e){return Xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Xs.credential(t,n)}catch(e){return null}}}Xs.GOOGLE_SIGN_IN_METHOD="google.com",Xs.PROVIDER_ID="google.com";class Ys extends Zs{constructor(){super("github.com")}static credential(e){return Hs._fromParams({providerId:Ys.PROVIDER_ID,signInMethod:Ys.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ys.credentialFromTaggedObject(e)}static credentialFromError(e){return Ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ys.credential(e.oauthAccessToken)}catch(e){return null}}}Ys.GITHUB_SIGN_IN_METHOD="github.com",Ys.PROVIDER_ID="github.com";class ea extends Zs{constructor(){super("twitter.com")}static credential(e,t){return Hs._fromParams({providerId:ea.PROVIDER_ID,signInMethod:ea.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ea.credentialFromTaggedObject(e)}static credentialFromError(e){return ea.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ea.credential(t,n)}catch(e){return null}}}ea.TWITTER_SIGN_IN_METHOD="twitter.com",ea.PROVIDER_ID="twitter.com";class ta{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await ls._fromIdTokenResponse(e,n,r),s=na(n);return new ta({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=na(n);return new ta({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function na(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ra extends Dn{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,ra.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new ra(e,t,n,r)}}function ia(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw ra._fromErrorAndOperation(e,n,t,r);throw n}))}new WeakMap;const sa="__sak";class aa{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(sa,"1"),this.storage.removeItem(sa),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class oa extends aa{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ps(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=jn();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}oa.type="LOCAL";const la=oa;class ca extends aa{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ca.type="SESSION";const ua=ca;class ha{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new ha(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const a=Array.from(s).map((async e=>e(t.origin,i))),o=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function da(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ha.receivers=[];class pa{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((a,o)=>{const l=da("",20);r.port1.start();const c=setTimeout((()=>{o(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),i=setTimeout((()=>{o(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),a(t.data.response);break;default:clearTimeout(c),clearTimeout(i),o(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function fa(){return window}function ma(){return void 0!==fa().WorkerGlobalScope&&"function"==typeof fa().importScripts}const ga="firebaseLocalStorageDb",ya="firebaseLocalStorage",va="fbase_key";class ba{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function wa(e,t){return e.transaction([ya],t?"readwrite":"readonly").objectStore(ya)}function _a(){const e=indexedDB.open(ga,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(ya,{keyPath:va})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(ya)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(ga);return new ba(e).toPromise()}(),t(await _a()))}))}))}async function ka(e,t,n){const r=wa(e,!0).put({[va]:t,value:n});return new ba(r).toPromise()}function Aa(e,t){const n=wa(e,!0).delete(t);return new ba(n).toPromise()}class Pa{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await _a()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ma()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ha._getInstance(ma()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new pa(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _a();return await ka(e,sa,"1"),await Aa(e,sa),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>ka(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=wa(e,!1).get(t),r=await new ba(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Aa(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=wa(e,!1).getAll();return new ba(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Pa.type="LOCAL";const Ta=Pa;js("rcb"),new Ri(3e4,6e4);class Ea{constructor(e){this.providerId=Ea.PROVIDER_ID,this.auth=Cs(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const i=await n.verify();try{let s;if(Oi("string"==typeof i,e,"argument-error"),Oi("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){Oi("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Bi(e,"POST","/v2/accounts/mfaEnrollment:start",Ui(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{Oi("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;Oi(n,e,"missing-multi-factor-info");const a=await function(e,t){return Bi(e,"POST","/v2/accounts/mfaSignIn:start",Ui(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return a.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Bi(e,"POST","/v1/accounts:sendVerificationCode",Ui(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}(this.auth,e,Hn(t))}static credential(e,t){return qs._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ea.credentialFromTaggedObject(t)}static credentialFromError(e){return Ea.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?qs._fromTokenResponse(t,n):null}}function xa(e,t){return t?us(t):(Oi(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Ea.PROVIDER_ID="phone",Ea.PHONE_SIGN_IN_METHOD="phone";class Ia extends Fs{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return zs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return zs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return zs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Ca(e){return async function(e,t,n=!1){if(ni(e.app))return Promise.reject(Ii(e));const r="signIn",i=await ia(e,r,t),s=await ta._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}(e.auth,new Ia(e),e.bypassAuthState)}function Oa(e){const{auth:t,user:n}=e;return Oi(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e;if(ni(r.app))return Promise.reject(Ii(r));const i="reauthenticate";try{const s=await ts(e,ia(r,i,t,e),n);Oi(s.idToken,r,"internal-error");const a=Yi(s.idToken);Oi(a,r,"internal-error");const{sub:o}=a;return Oi(e.uid===o,r,"user-mismatch"),ta._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Ti(r,"user-mismatch"),e}}(n,new Ia(e),e.bypassAuthState)}async function Sa(e){const{auth:t,user:n}=e;return Oi(n,t,"internal-error"),async function(e,t,n=!1){const r=await ts(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ta._forOperation(e,"link",r)}(n,new Ia(e),e.bypassAuthState)}class Na{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ca;case"linkViaPopup":case"linkViaRedirect":return Sa;case"reauthViaPopup":case"reauthViaRedirect":return Oa;default:Ti(this.auth,"internal-error")}}resolve(e){Ni(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ni(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ja=new Ri(2e3,1e4);class Da extends Na{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Da.currentPopupAction&&Da.currentPopupAction.cancel(),Da.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Oi(e,this.auth,"internal-error"),e}async onExecution(){Ni(1===this.filter.length,"Popup operations only handle one event");const e=da();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Ei(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Ei(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Da.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Ei(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,ja.get())};e()}}Da.currentPopupAction=null;const Ra="pendingRedirect",$a=new Map;class La extends Na{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=$a.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Ua(t),r=Fa(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}$a.set(this.auth._key(),e)}return this.bypassAuthState||$a.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Ma(e,t){$a.set(e._key(),t)}function Fa(e){return us(e._redirectPersistence)}function Ua(e){return ps(Ra,e.config.apiKey,e.name)}function Ba(e,t,n){return async function(e,t,n){if(ni(e.app))return Promise.reject(Ii(e));const r=Cs(e);(function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Ti(e,"argument-error"),xi(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)})(e,t,Js),await r._initializationPromise;const i=xa(r,n);return await async function(e,t){return Fa(e)._set(Ua(t),"true")}(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}async function Va(e,t,n=!1){if(ni(e.app))return Promise.reject(Ii(e));const r=Cs(e),i=xa(r,t),s=new La(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}class za{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ga(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Ga(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Ei(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ha(e))}saveEventToCache(e){this.cachedEventUids.add(Ha(e)),this.lastProcessedEventTime=Date.now()}}function Ha(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Ga({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const qa=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ka=/^https?/;function Wa(e){const t=ji(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Ka.test(n))return!1;if(qa.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Ja=new Ri(3e4,6e4);function Za(){const e=fa().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Qa=null;const Xa=new Ri(5e3,15e3),Ya={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},eo=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function to(e){const t=e.config;Oi(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?$i(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:si},i=eo.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${Fn(r).slice(1)}`}const no={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ro{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const io=encodeURIComponent("fac");async function so(e,t,n,r,i,s){Oi(e.config.authDomain,e,"auth-domain-config-required"),Oi(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:si,eventId:i};if(t instanceof Js){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))a[e]=t}if(t instanceof Zs){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(a.scopes=e.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const e of Object.keys(o))void 0===o[e]&&delete o[e];const l=await e._getAppCheckToken(),c=l?`#${io}=${encodeURIComponent(l)}`:"";return`${function({config:e}){return e.emulator?$i(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${Fn(o).slice(1)}${c}`}const ao="webStorageSupport",oo=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ua,this._completeRedirectFn=Va,this._overrideRedirectResult=Ma}async _openPopup(e,t,n,r){var i;return Ni(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=Object.assign(Object.assign({},no),{width:r.toString(),height:i.toString(),top:s,left:a}),c=jn().toLowerCase();n&&(o=vs(c)?"_blank":n),gs(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=jn()){var t;return As(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(c)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new ro(null);const h=window.open(t||"",o,u);Oi(h,e,"popup-blocked");try{h.focus()}catch(e){}return new ro(h)}(e,await so(e,t,n,ji(),r),da())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await so(e,t,n,ji(),r),fa().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Ni(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return Qa=Qa||function(e){return new Promise(((t,n)=>{var r,i,s;function a(){Za(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Za(),n(Ei(e,"network-request-failed"))},timeout:Ja.get()})}if(null===(i=null===(r=fa().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=fa().gapi)||void 0===s?void 0:s.load)){const t=js("iframefcb");return fa()[t]=()=>{gapi.load?a():n(Ei(e,"network-request-failed"))},Ns(`${Ss.gapiScript}?onload=${t}`).catch((e=>n(e)))}a()}})).catch((e=>{throw Qa=null,e}))}(e),Qa}(e),n=fa().gapi;return Oi(n,e,"internal-error"),t.open({where:document.body,url:to(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ya,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Ei(e,"network-request-failed"),s=fa().setTimeout((()=>{r(i)}),Xa.get());function a(){fa().clearTimeout(s),n(t)}t.ping(a).then(a,(()=>{r(i)}))}))))}(e),n=new za(e);return t.register("authEvent",(t=>(Oi(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ao,{type:ao},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[ao];void 0!==i&&t(!!i),Ti(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Bi(e,"GET","/v1/projects",t)}(e);for(const n of t)try{if(Wa(n))return}catch(e){}Ti(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ps()||ys()||As()}};var lo="@firebase/auth",co="1.7.9";class uo{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Oi(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const ho=Sn("authIdTokenMaxAge")||300;let po=null;const fo=e=>async t=>{const n=t&&await t.getIdTokenResult(),r=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>ho)return;const i=null==n?void 0:n.token;po!==i&&(po=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};var mo,go;mo={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Ei("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Ss=mo,go="Browser",ei(new Gn("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:a}=n.options;Oi(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const o={apiKey:s,authDomain:a,clientPlatform:go,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ts(go)},l=new Is(n,r,i,o);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(us);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(l,t),l}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ei(new Gn("auth-internal",(e=>{return t=Cs(e.getProvider("auth").getImmediate()),new uo(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),li(lo,co,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(go)),li(lo,co,"esm2017");var yo,vo,bo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},wo={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+3614090360&4294967295;a=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(a<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(t=n+((a=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,s=this.h,a=0;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i={};function s(e){return-128<=e&&128>e?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new r([0|e],0>e?-1:0)}(e)}(e):new r([0|e],0>e?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(0>e)return d(a(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var o=s(0),l=s(1),c=s(16777216);function u(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(l)}function p(e,t){return e.add(d(t))}function f(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(u(t))throw Error("division by zero");if(u(e))return new m(o,o);if(h(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(h(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,r=t;0>=r.l(e);)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!u(r);){var c=s.add(r);0>=c.l(e)&&(i=i.add(n),s=c),r=v(r,1),n=v(n,1)}return t=p(e,i.j(t)),new m(i,t)}for(i=o;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),c=(s=a(n)).j(t);h(c)||0<c.l(e);)c=(s=a(n-=r)).j(t);u(s)&&(s=l),i=i.add(s),e=p(e,c)}return new m(i,e)}function y(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function v(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],a=0;a<i;a++)s[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new r(s,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=a(Math.pow(e,6)),n=this,r="";;){var i=g(n,t).g,s=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(u(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=p(this,e))?-1:u(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var a=i+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=o>>>16,a&=65535,o&=65535,n[s]=o<<16|a}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return o;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(c)&&0>e.l(c))return a(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var l=this.i(i)>>>16,p=65535&this.i(i),m=e.i(s)>>>16,g=65535&e.i(s);n[2*i+2*s]+=p*g,f(n,2*i+2*s),n[2*i+2*s+1]+=l*g,f(n,2*i+2*s+1),n[2*i+2*s+1]+=p*m,f(n,2*i+2*s+1),n[2*i+2*s+2]+=l*m,f(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,vo=wo.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=a,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=a(Math.pow(n,8)),i=o,s=0;s<t.length;s+=8){var l=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+l),n);8>l?(l=a(Math.pow(n,l)),i=i.j(l).add(a(c))):i=(i=i.j(r)).add(a(c))}return i},yo=wo.Integer=r}).apply(void 0!==bo?bo:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var _o,ko,Ao,Po,To,Eo,xo,Io,Co="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},Oo={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Co&&Co];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(0,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var r=r||{},i=this||self;function s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?o:l).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function p(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(s(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function f(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var y=!(-1==m().indexOf("Gecko")||-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge")||-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE")||-1!=m().indexOf("Edge"));function v(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function b(e){const t={};for(const n in e)t[n]=e[n];return t}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<w.length;t++)n=w[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function k(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function A(e){i.setTimeout((()=>{throw e}),0)}function P(){var e=C;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var T=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new E),(e=>e.reset()));class E{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let x,I=!1,C=new class{constructor(){this.h=this.g=null}add(e,t){const n=T.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},O=()=>{const e=i.Promise.resolve(void 0);x=()=>{e.then(S)}};var S=()=>{for(var e;e=P();){try{e.h.call(e.g)}catch(e){A(e)}var t=T;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}I=!1};function N(){this.s=this.s,this.C=this.C}function j(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.s=!1,N.prototype.ma=function(){this.s||(this.s=!0,this.N())},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},j.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(e){}return e}();function R(e,t){if(j.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{g(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:$[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&R.aa.h.call(this)}}h(R,j);var $={2:"touch",3:"pen",4:"mouse"};R.prototype.h=function(){R.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),M=0;function F(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++M,this.da=this.fa=!1}function U(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e){this.src=e,this.g={},this.h=0}function V(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(U(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function z(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}B.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=z(e,t,r,i);return-1<a?(t=e[a],n||(t.fa=!1)):((t=new F(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),G={};function q(e,t,n,r,i){if(r&&r.once)return W(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)q(e,t[s],n,r,i);return null}return n=te(n),e&&e[L]?e.K(t,n,a(r)?!!r.capture:!!r,i):K(e,t,n,!1,r,i)}function K(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=a(i)?!!i.capture:!!i,l=Y(e);if(l||(e[H]=l=new B(e)),(n=l.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=X;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)D||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Q(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function W(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)W(e,t[s],n,r,i);return null}return n=te(n),e&&e[L]?e.L(t,n,a(r)?!!r.capture:!!r,i):K(e,t,n,!0,r,i)}function J(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)J(e,t[s],n,r,i);else r=a(r)?!!r.capture:!!r,n=te(n),e&&e[L]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=z(s=e.g[t],n,r,i))&&(U(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Y(e))&&(t=e.g[t.toString()],e=-1,t&&(e=z(t,n,r,i)),(n=-1<e?t[e]:null)&&Z(n))}function Z(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])V(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Q(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Y(t))?(V(n,e),0==n.h&&(n.src=null,t[H]=null)):U(e)}}}function Q(e){return e in G?G[e]:G[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new R(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&Z(e),e=n.call(r,t)}return e}function Y(e){return(e=e[H])instanceof B?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"==typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){N.call(this),this.i=new B(this),this.M=this,this.F=null}function re(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new j(t,e);else if(t instanceof j)t.target=t.target||e;else{var i=t;_(t=new j(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=ie(a,r,!0,t)&&i}if(i=ie(a=t.g=e,r,!0,t)&&i,i=ie(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=ie(a=t.g=n[s],r,!1,t)&&i}function ie(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&V(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function se(e,t,n){if("function"==typeof e)n&&(e=c(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function ae(e){e.g=se((()=>{e.g=null,e.i&&(e.i=!1,ae(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(ne,N),ne.prototype[L]=!0,ne.prototype.removeEventListener=function(e,t,n,r){J(this,e,t,n,r)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)U(n[r]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ne.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class oe extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ae(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function le(e){N.call(this),this.h=e,this.g={}}h(le,N);var ce=[];function ue(e){v(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Z(e)}),e),e.g={}}le.prototype.N=function(){le.aa.N.call(this),ue(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var he=i.JSON.stringify,de=i.JSON.parse,pe=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function fe(){}function me(e){return e.h||(e.h=e.i())}function ge(){}fe.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){j.call(this,"d")}function be(){j.call(this,"c")}h(ve,j),h(be,j);var we={},_e=null;function ke(){return _e=_e||new ne}function Ae(e){j.call(this,we.La,e)}function Pe(e){const t=ke();re(t,new Ae(t))}function Te(e,t){j.call(this,we.STAT_EVENT,e),this.stat=t}function Ee(e){const t=ke();re(t,new Te(t,e))}function xe(e,t){j.call(this,we.Ma,e),this.size=t}function Ie(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function Ce(){this.g=!0}function Oe(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return he(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}we.La="serverreachability",h(Ae,j),we.STAT_EVENT="statevent",h(Te,j),we.Ma="timingevent",h(xe,j),Ce.prototype.xa=function(){this.g=!1},Ce.prototype.info=function(){};var Se,Ne={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},je={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function De(){}function Re(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new le(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new $e}function $e(){this.i=null,this.g="",this.h=!1}h(De,fe),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},Se=new De;var Le={},Me={};function Fe(e,t,n){e.L=1,e.v=ht(at(t)),e.m=n,e.P=!0,Ue(e,null)}function Ue(e,t){e.F=Date.now(),ze(e),e.A=at(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Tt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new $e,e.g=pn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new oe(c(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(ce[0]=i.toString()),i=ce);for(var s=0;s<i.length;s++){var a=q(n,i[s],r||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?b(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Pe(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var c=o[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");a=2<=h.length&&"type"==h[1]?a+(u+"=")+c+"&":a+(u+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Be(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Ve(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Me:(n=Number(t.substring(n,r)),isNaN(n)?Le:(r+=1)+n>t.length?Me:(t=t.slice(r,r+n),e.C=r+n,t))}function ze(e){e.S=Date.now()+e.I,He(e,e.I)}function He(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ie(c(e.ba,e),t)}function Ge(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function qe(e){0==e.j.G||e.J||ln(e.j,e)}function Ke(e){Ge(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ue(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function We(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Ye(n.h,e)))if(!e.K&&Ye(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;on(n),Zt(n)}rn(n),Ee(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ie(c(n.Za,n),6e3));if(1>=Xe(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else un(n,11)}else if((e.K||n.g==e)&&on(n),!f(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.K=c[1],n.ia=c[2];const t=c[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=c[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(et(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,ut(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var a=e;if((r=n).qa=dn(r,r.J?r.ia:null,r.W),a.K){tt(r.h,a);var o=a,l=r.L;l&&(o.I=l),o.B&&(Ge(o),ze(o)),r.g=a}else nn(r);0<n.i.length&&Xt(n)}else"stop"!=c[0]&&"close"!=c[0]||un(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?un(n,7):Jt(n):"noop"!=c[0]&&n.l&&n.l.ta(c),n.v=0)}Pe()}catch(e){}}Re.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Gt(e)?t.j():this.Y(e)},Re.prototype.Y=function(e){try{if(e==this.g)e:{const d=Gt(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||qt(this.g)))){this.J||4!=d||7==t||Pe(),Ge(this);var n=this.g.Z();this.X=n;t:if(Be(this)){var r=qt(this.g);e="";var s=r.length,a=4==Gt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ke(this),qe(this);var o="";break t}this.h.i=new i.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(a&&t==s-1)});r.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,a){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+a}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var l,c=this.g;if((l=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!f(l)){var u=l;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,Ee(12),Ke(this),qe(this);break e}Oe(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,We(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;){if(e=Ve(this,o),e==Me){4==d&&(this.s=4,Ee(14),n=!1),Oe(this.i,this.l,null,"[Incomplete Response]");break}if(e==Le){this.s=4,Ee(15),Oe(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}Oe(this.i,this.l,e,null),We(this,e)}if(Be(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=o.length||this.h.h||(this.s=1,Ee(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),sn(h),h.M=!0,Ee(11))}}else Oe(this.i,this.l,o,"[Invalid Chunked Response]"),Ke(this),qe(this)}else Oe(this.i,this.l,o,null),We(this,o);4==d&&Ke(this),this.o&&!this.J&&(4==d?ln(this.j,this):(this.o=!1,ze(this)))}else(function(e){const t={};e=(e.g&&2<=Gt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(f(e[r]))continue;var n=k(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Ee(12)):(this.s=0,Ee(13)),Ke(this),qe(this)}}}catch(e){}},Re.prototype.cancel=function(){this.J=!0,Ke(this)},Re.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Pe(),Ee(17)),Ke(this),this.s=2,qe(this)):He(this,this.S-e)};var Je=class{constructor(e,t){this.g=e,this.map=t}};function Ze(e){this.l=e||10,e=i.PerformanceNavigationTiming?0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Xe(e){return e.h?1:e.g?e.g.size:0}function Ye(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function rt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(s(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(s(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(s(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}Ze.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var it=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function st(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof st){this.h=e.h,ot(this,e.j),this.o=e.o,this.g=e.g,lt(this,e.s),this.l=e.l;var t=e.i,n=new _t;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ct(this,n),this.m=e.m}else e&&(t=String(e).match(it))?(this.h=!1,ot(this,t[1]||"",!0),this.o=dt(t[2]||""),this.g=dt(t[3]||"",!0),lt(this,t[4]),this.l=dt(t[5]||"",!0),ct(this,t[6]||"",!0),this.m=dt(t[7]||"")):(this.h=!1,this.i=new _t(null,this.h))}function at(e){return new st(e)}function ot(e,t,n){e.j=n?dt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function lt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ct(e,t,n){t instanceof _t?(e.i=t,function(e,t){t&&!e.j&&(kt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(At(this,t),Tt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=pt(t,bt)),e.i=new _t(t,e.h))}function ut(e,t,n){e.i.set(t,n)}function ht(e){return ut(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function pt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ft),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ft(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}st.prototype.toString=function(){var e=[],t=this.j;t&&e.push(pt(t,gt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(pt(t,gt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(pt(n,"/"==n.charAt(0)?vt:yt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",pt(n,wt)),e.join("")};var mt,gt=/[#\/\?@]/g,yt=/[#\?:]/g,vt=/[#\?]/g,bt=/[#\?@]/g,wt=/#/g;function _t(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function kt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function At(e,t){kt(e),t=Et(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Pt(e,t){return kt(e),t=Et(e,t),e.g.has(t)}function Tt(e,t,n){At(e,t),0<n.length&&(e.i=null,e.g.set(Et(e,t),d(n)),e.h+=n.length)}function Et(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function xt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function It(){this.g=new pe}function Ct(e,t,n){const r=n||"";try{rt(e,(function(e,n){let i=e;a(e)&&(i=he(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Ot(e){this.l=e.Ub||null,this.j=e.eb||!1}function St(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Nt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function jt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Dt(e)}function Dt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Rt(e){let t="";return v(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function $t(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Rt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ut(e,t,n))}function Lt(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=_t.prototype).add=function(e,t){kt(this),this.i=null,e=Et(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){kt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){kt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){kt(this);let t=[];if("string"==typeof e)Pt(this,e)&&(t=t.concat(this.g.get(Et(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return kt(this),this.i=null,Pt(this,e=Et(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},h(Ot,fe),Ot.prototype.g=function(){return new St(this.l,this.j)},Ot.prototype.i=(mt={},function(){return mt}),h(St,ne),(e=St.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Dt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Dt(this)),this.g&&(this.readyState=3,Dt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?jt(this):Dt(this),3==this.readyState&&Nt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,jt(this))},e.Qa=function(e){this.g&&(this.response=e,jt(this))},e.ga=function(){this.g&&jt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(St.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Lt,ne);var Mt=/^https?$/i,Ft=["POST","PUT"];function Ut(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Bt(e),zt(e)}function Bt(e){e.A||(e.A=!0,re(e,"complete"),re(e,"error"))}function Vt(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=Gt(e)||2!=e.Z()))if(e.u&&4==Gt(e))se(e.Ea,0,e);else if(re(e,"readystatechange"),4==Gt(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){var a=String(e.D).match(it)[1]||null;!a&&i.self&&i.self.location&&(a=i.self.location.protocol.slice(0,-1)),s=!Mt.test(a?a.toLowerCase():"")}n=s}if(n)re(e,"complete"),re(e,"success");else{e.m=6;try{var o=2<Gt(e)?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.Z()+"]",Bt(e)}}finally{zt(e)}}}function zt(e,t){if(e.g){Ht(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||re(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Ht(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function Gt(e){return e.g?e.g.readyState:0}function qt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Kt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Wt(e){this.Aa=0,this.i=[],this.j=new Ce,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Kt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Kt("baseRetryDelayMs",5e3,e),this.cb=Kt("retryDelaySeedMs",1e4,e),this.Wa=Kt("forwardChannelMaxRetries",2,e),this.wa=Kt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Ze(e&&e.concurrentRequestLimit),this.Da=new It,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Jt(e){if(Qt(e),3==e.G){var t=e.U++,n=at(e.I);if(ut(n,"SID",e.K),ut(n,"RID",t),ut(n,"TYPE","terminate"),en(e,n),(t=new Re(e,e.j,t)).L=2,t.v=ht(at(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=pn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),ze(t)}hn(e)}function Zt(e){e.g&&(sn(e),e.g.cancel(),e.g=null)}function Qt(e){Zt(e),e.u&&(i.clearTimeout(e.u),e.u=null),on(e),e.h.cancel(),e.s&&("number"==typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Xt(e){if(!Qe(e.h)&&!e.s){e.s=!0;var t=e.Ga;x||O(),I||(x(),I=!0),C.add(t,e),e.B=0}}function Yt(e,t){var n;n=t?t.l:e.U++;const r=at(e.I);ut(r,"SID",e.K),ut(r,"RID",n),ut(r,"AID",e.T),en(e,r),e.m&&e.o&&$t(r,e.m,e.o),n=new Re(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),Fe(n,r,t)}function en(e,t){e.H&&v(e.H,(function(e,n){ut(t,n,e)})),e.l&&rt({},(function(e,n){ut(t,n,e)}))}function tn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?c(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const s=["count="+n];-1==t?0<n?(t=i[0].g,s.push("ofs="+t)):t=0:s.push("ofs="+t);let a=!0;for(let o=0;o<n;o++){let n=i[o].g;const l=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),a=!1;else try{Ct(l,s,"req"+n+"_")}catch(e){r&&r(l)}}if(a){r=s.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function nn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;x||O(),I||(x(),I=!0),C.add(t,e),e.v=0}}function rn(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Ie(c(e.Fa,e),cn(e,e.v)),e.v++,0))}function sn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function an(e){e.g=new Re(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=at(e.qa);ut(t,"RID","rpc"),ut(t,"SID",e.K),ut(t,"AID",e.T),ut(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ut(t,"TO",e.ja),ut(t,"TYPE","xmlhttp"),en(e,t),e.m&&e.o&&$t(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ht(at(t)),n.m=null,n.P=!0,Ue(n,e)}function on(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function ln(e,t){var n=null;if(e.g==t){on(e),sn(e),e.g=null;var r=2}else{if(!Ye(e.h,t))return;n=t.D,tt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;re(r=ke(),new xe(r,n)),Xt(e)}else nn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(Xe(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Ie(c(e.Ga,e,t),cn(e,e.B)),e.B++,0)))}(e,t)||2==r&&rn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:un(e,5);break;case 4:un(e,10);break;case 3:un(e,6);break;default:un(e,2)}}function cn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function un(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.fb,e),r=e.Xa;const t=!r;r=new st(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ot(r,"https"),ht(r),t?function(e,t){const n=new Ce;if(i.Image){const r=new Image;r.onload=u(xt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(xt,n,"TestLoadImage: error",!1,t,r),r.onabort=u(xt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(xt,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ce;const n=new AbortController,r=setTimeout((()=>{n.abort(),xt(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?xt(0,0,!0,t):xt(0,0,!1,t)})).catch((()=>{clearTimeout(r),xt(0,0,!1,t)}))}(r.toString(),n)}else Ee(2);e.G=0,e.l&&e.l.sa(t),hn(e),Qt(e)}function hn(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(p(e.ka,t),p(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function dn(e,t,n){var r=n instanceof st?at(n):new st(n);if(""!=r.g)t&&(r.g=t+"."+r.g),lt(r,r.s);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var a=new st(null);r&&ot(a,r),t&&(a.g=t),s&&lt(a,s),n&&(a.l=n),r=a}return n=e.D,t=e.ya,n&&t&&ut(r,n,t),ut(r,"VER",e.la),en(e,r),r}function pn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Lt(new Ot({eb:n})):new Lt(e.pa)).Ha(e.J),t}function fn(){}function mn(){}function gn(e,t){ne.call(this),this.g=new Wt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!f(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!f(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new bn(this)}function yn(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function vn(){be.call(this),this.status=1}function bn(e){this.g=e}(e=Lt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Se.g(),this.v=this.o?me(this.o):me(Se),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Ut(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),s=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Ft,t,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ht(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Ut(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,re(this,"complete"),re(this,"abort"),zt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zt(this,!0)),Lt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Vt(this):this.bb())},e.bb=function(){Vt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Gt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),de(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Wt.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Ee(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=dn(this,null,this.W),Xt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Re(this,this.j,e);let s=this.o;if(this.S&&(s?(s=b(s),_(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tn(this,i,t),ut(n=at(this.I),"RID",e),ut(n,"CVER",22),this.D&&ut(n,"X-HTTP-Session-Id",this.D),en(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Rt(s)))+"&"+t:this.m&&$t(n,this.m,s)),et(this.h,i),this.Ua&&ut(n,"TYPE","init"),this.P?(ut(n,"$req",t),ut(n,"SID","null"),i.T=!0,Fe(i,n,null)):Fe(i,n,t),this.G=2}}else 3==this.G&&(e?Yt(this,e):0==this.i.length||Qe(this.h)||Yt(this))},e.Fa=function(){if(this.u=null,an(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ie(c(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ee(10),Zt(this),an(this))},e.Za=function(){null!=this.C&&(this.C=null,Zt(this),rn(this),Ee(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ee(2)):(this.j.info("Failed to ping google.com"),Ee(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=fn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},mn.prototype.g=function(e,t){return new gn(e,t)},h(gn,ne),gn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gn.prototype.close=function(){Jt(this.g)},gn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=he(e),e=n);t.i.push(new Je(t.Ya++,e)),3==t.G&&Xt(t)},gn.prototype.N=function(){this.g.l=null,delete this.j,Jt(this.g),delete this.g,gn.aa.N.call(this)},h(yn,ve),h(vn,be),h(bn,fn),bn.prototype.ua=function(){re(this.g,"a")},bn.prototype.ta=function(e){re(this.g,new yn(e))},bn.prototype.sa=function(e){re(this.g,new vn)},bn.prototype.ra=function(){re(this.g,"b")},mn.prototype.createWebChannel=mn.prototype.g,gn.prototype.send=gn.prototype.o,gn.prototype.open=gn.prototype.m,gn.prototype.close=gn.prototype.close,Io=Oo.createWebChannelTransport=function(){return new mn},xo=Oo.getStatEventTarget=function(){return ke()},Eo=Oo.Event=we,To=Oo.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ne.NO_ERROR=0,Ne.TIMEOUT=8,Ne.HTTP_ERROR=6,Po=Oo.ErrorCode=Ne,je.COMPLETE="complete",Ao=Oo.EventType=je,ge.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",ne.prototype.listen=ne.prototype.K,ko=Oo.WebChannel=ge,Oo.FetchXmlHttpFactory=Ot,Lt.prototype.listenOnce=Lt.prototype.L,Lt.prototype.getLastError=Lt.prototype.Ka,Lt.prototype.getLastErrorCode=Lt.prototype.Ba,Lt.prototype.getStatus=Lt.prototype.Z,Lt.prototype.getResponseJson=Lt.prototype.Oa,Lt.prototype.getResponseText=Lt.prototype.oa,Lt.prototype.send=Lt.prototype.ea,Lt.prototype.setWithCredentials=Lt.prototype.Ha,_o=Oo.XhrIo=Lt}).apply(void 0!==Co?Co:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const So="@firebase/firestore";class No{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}No.UNAUTHENTICATED=new No(null),No.GOOGLE_CREDENTIALS=new No("google-credentials-uid"),No.FIRST_PARTY=new No("first-party-uid"),No.MOCK_USER=new No("mock-user");let jo="10.14.0";const Do=new tr("@firebase/firestore");function Ro(){return Do.logLevel}function $o(e,...t){if(Do.logLevel<=Zn.DEBUG){const n=t.map(Fo);Do.debug(`Firestore (${jo}): ${e}`,...n)}}function Lo(e,...t){if(Do.logLevel<=Zn.ERROR){const n=t.map(Fo);Do.error(`Firestore (${jo}): ${e}`,...n)}}function Mo(e,...t){if(Do.logLevel<=Zn.WARN){const n=t.map(Fo);Do.warn(`Firestore (${jo}): ${e}`,...n)}}function Fo(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Uo(e="Unexpected state"){const t=`FIRESTORE (${jo}) INTERNAL ASSERTION FAILED: `+e;throw Lo(t),new Error(t)}function Bo(e,t){e||Uo()}function Vo(e,t){return e}const zo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ho extends Dn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Go{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class qo{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ko{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(No.UNAUTHENTICATED)))}shutdown(){}}class Wo{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Jo{constructor(e){this.t=e,this.currentUser=No.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Bo(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Go;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Go,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},a=e=>{$o("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit((e=>a(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):($o("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Go)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?($o("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Bo("string"==typeof t.accessToken),new qo(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Bo(null===e||"string"==typeof e),new No(e)}}class Zo{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=No.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Qo{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Zo(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(No.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Xo{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Yo{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Bo(void 0===this.o);const n=e=>{null!=e.error&&$o("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,$o("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{$o("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):$o("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Bo("string"==typeof e.token),this.R=e.token,new Xo(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function el(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class tl{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=el(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function nl(e,t){return e<t?-1:e>t?1:0}function rl(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}class il{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ho(zo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ho(zo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ho(zo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ho(zo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return il.fromMillis(Date.now())}static fromDate(e){return il.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new il(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?nl(this.nanoseconds,e.nanoseconds):nl(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class sl{constructor(e){this.timestamp=e}static fromTimestamp(e){return new sl(e)}static min(){return new sl(new il(0,0))}static max(){return new sl(new il(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class al{constructor(e,t,n){void 0===t?t=0:t>e.length&&Uo(),void 0===n?n=e.length-t:n>e.length-t&&Uo(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===al.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof al?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ol extends al{construct(e,t,n){return new ol(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Ho(zo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new ol(t)}static emptyPath(){return new ol([])}}const ll=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class cl extends al{construct(e,t,n){return new cl(e,t,n)}static isValidIdentifier(e){return ll.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),cl.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new cl(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Ho(zo.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Ho(zo.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Ho(zo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Ho(zo.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new cl(t)}static emptyPath(){return new cl([])}}class ul{constructor(e){this.path=e}static fromPath(e){return new ul(ol.fromString(e))}static fromName(e){return new ul(ol.fromString(e).popFirst(5))}static empty(){return new ul(ol.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ol.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ol.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ul(new ol(e.slice()))}}function hl(e){return new dl(e.readTime,e.key,-1)}class dl{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new dl(sl.min(),ul.empty(),-1)}static max(){return new dl(sl.max(),ul.empty(),-1)}}function pl(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ul.comparator(e.documentKey,t.documentKey),0!==n?n:nl(e.largestBatchId,t.largestBatchId))}const fl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ml{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function gl(e){if(e.code!==zo.FAILED_PRECONDITION||e.message!==fl)throw e;$o("LocalStore","Unexpectedly lost primary lease")}class yl{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Uo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new yl(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof yl?t:yl.resolve(t)}catch(e){return yl.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):yl.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):yl.reject(t)}static resolve(e){return new yl(((t,n)=>{t(e)}))}static reject(e){return new yl(((t,n)=>{n(e)}))}static waitFor(e){return new yl(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=yl.resolve(!1);for(const n of e)t=t.next((e=>e?yl.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new yl(((n,r)=>{const i=e.length,s=new Array(i);let a=0;for(let o=0;o<i;o++){const l=o;t(e[l]).next((e=>{s[l]=e,++a,a===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new yl(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}function vl(e){return"IndexedDbTransactionError"===e.name}class bl{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function wl(e){return null==e}function _l(e){return 0===e&&1/e==-1/0}function kl(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Al(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Pl(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}bl.oe=-1;class Tl{constructor(e,t){this.comparator=e,this.root=t||xl.EMPTY}insert(e,t){return new Tl(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xl.BLACK,null,null))}remove(e){return new Tl(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new El(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new El(this.root,e,this.comparator,!1)}getReverseIterator(){return new El(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new El(this.root,e,this.comparator,!0)}}class El{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xl{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:xl.RED,this.left=null!=r?r:xl.EMPTY,this.right=null!=i?i:xl.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new xl(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return xl.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return xl.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,xl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,xl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Uo();if(this.right.isRed())throw Uo();const e=this.left.check();if(e!==this.right.check())throw Uo();return e+(this.isRed()?0:1)}}xl.EMPTY=null,xl.RED=!0,xl.BLACK=!1,xl.EMPTY=new class{constructor(){this.size=0}get key(){throw Uo()}get value(){throw Uo()}get color(){throw Uo()}get left(){throw Uo()}get right(){throw Uo()}copy(e,t,n,r,i){return this}insert(e,t,n){return new xl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Il{constructor(e){this.comparator=e,this.data=new Tl(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Cl(this.data.getIterator())}getIteratorFrom(e){return new Cl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Il))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Il(this.comparator);return t.data=e,t}}class Cl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ol{constructor(e){this.fields=e,e.sort(cl.comparator)}static empty(){return new Ol([])}unionWith(e){let t=new Il(cl.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ol(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rl(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Sl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Nl{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Sl("Invalid base64 string: "+e):e}}(e);return new Nl(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Nl(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return nl(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Nl.EMPTY_BYTE_STRING=new Nl("");const jl=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Dl(e){if(Bo(!!e),"string"==typeof e){let t=0;const n=jl.exec(e);if(Bo(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Rl(e.seconds),nanos:Rl(e.nanos)}}function Rl(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function $l(e){return"string"==typeof e?Nl.fromBase64String(e):Nl.fromUint8Array(e)}function Ll(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ml(e){const t=e.mapValue.fields.__previous_value__;return Ll(t)?Ml(t):t}function Fl(e){const t=Dl(e.mapValue.fields.__local_write_time__.timestampValue);return new il(t.seconds,t.nanos)}class Ul{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class Bl{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Bl("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Bl&&e.projectId===this.projectId&&e.database===this.database}}const Vl={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function zl(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ll(e)?4:ic(e)?9007199254740991:nc(e)?10:11:Uo()}function Hl(e,t){if(e===t)return!0;const n=zl(e);if(n!==zl(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Fl(e).isEqual(Fl(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Dl(e.timestampValue),r=Dl(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return $l(e.bytesValue).isEqual($l(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Rl(e.geoPointValue.latitude)===Rl(t.geoPointValue.latitude)&&Rl(e.geoPointValue.longitude)===Rl(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Rl(e.integerValue)===Rl(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Rl(e.doubleValue),r=Rl(t.doubleValue);return n===r?_l(n)===_l(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return rl(e.arrayValue.values||[],t.arrayValue.values||[],Hl);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(kl(n)!==kl(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Hl(n[e],r[e])))return!1;return!0}(e,t);default:return Uo()}}function Gl(e,t){return void 0!==(e.values||[]).find((e=>Hl(e,t)))}function ql(e,t){if(e===t)return 0;const n=zl(e),r=zl(t);if(n!==r)return nl(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return nl(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Rl(e.integerValue||e.doubleValue),r=Rl(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Kl(e.timestampValue,t.timestampValue);case 4:return Kl(Fl(e),Fl(t));case 5:return nl(e.stringValue,t.stringValue);case 6:return function(e,t){const n=$l(e),r=$l(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=nl(n[e],r[e]);if(0!==t)return t}return nl(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=nl(Rl(e.latitude),Rl(t.latitude));return 0!==n?n:nl(Rl(e.longitude),Rl(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Wl(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;const a=e.fields||{},o=t.fields||{},l=null===(n=a.value)||void 0===n?void 0:n.arrayValue,c=null===(r=o.value)||void 0===r?void 0:r.arrayValue,u=nl((null===(i=null==l?void 0:l.values)||void 0===i?void 0:i.length)||0,(null===(s=null==c?void 0:c.values)||void 0===s?void 0:s.length)||0);return 0!==u?u:Wl(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Vl.mapValue&&t===Vl.mapValue)return 0;if(e===Vl.mapValue)return 1;if(t===Vl.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=nl(r[e],s[e]);if(0!==t)return t;const a=ql(n[r[e]],i[s[e]]);if(0!==a)return a}return nl(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Uo()}}function Kl(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return nl(e,t);const n=Dl(e),r=Dl(t),i=nl(n.seconds,r.seconds);return 0!==i?i:nl(n.nanos,r.nanos)}function Wl(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=ql(n[e],r[e]);if(t)return t}return nl(n.length,r.length)}function Jl(e){return Zl(e)}function Zl(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Dl(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return $l(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ul.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Zl(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Zl(e.fields[i])}`;return n+"}"}(e.mapValue):Uo()}function Ql(e){return!!e&&"integerValue"in e}function Xl(e){return!!e&&"arrayValue"in e}function Yl(e){return!!e&&"nullValue"in e}function ec(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function tc(e){return!!e&&"mapValue"in e}function nc(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function rc(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Al(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=rc(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=rc(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ic(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class sc{constructor(e){this.value=e}static empty(){return new sc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!tc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rc(t)}setAll(e){let t=cl.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=rc(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());tc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Hl(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];tc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Al(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new sc(rc(this.value))}}function ac(e){const t=[];return Al(e.fields,((e,n)=>{const r=new cl([e]);if(tc(n)){const e=ac(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Ol(t)}class oc{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new oc(e,0,sl.min(),sl.min(),sl.min(),sc.empty(),0)}static newFoundDocument(e,t,n,r){return new oc(e,1,t,sl.min(),n,r,0)}static newNoDocument(e,t){return new oc(e,2,t,sl.min(),sl.min(),sc.empty(),0)}static newUnknownDocument(e,t){return new oc(e,3,t,sl.min(),sl.min(),sc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(sl.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=sc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=sc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=sl.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof oc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new oc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class lc{constructor(e,t){this.position=e,this.inclusive=t}}function cc(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?ul.comparator(ul.fromName(a.referenceValue),n.key):ql(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function uc(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Hl(e.position[n],t.position[n]))return!1;return!0}class hc{constructor(e,t="asc"){this.field=e,this.dir=t}}function dc(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class pc{}class fc extends pc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new _c(e,t,n):"array-contains"===t?new Tc(e,n):"in"===t?new Ec(e,n):"not-in"===t?new xc(e,n):"array-contains-any"===t?new Ic(e,n):new fc(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new kc(e,n):new Ac(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(ql(t,this.value)):null!==t&&zl(this.value)===zl(t)&&this.matchesComparison(ql(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Uo()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class mc extends pc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new mc(e,t)}matches(e){return gc(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function gc(e){return"and"===e.op}function yc(e){return function(e){for(const t of e.filters)if(t instanceof mc)return!1;return!0}(e)&&gc(e)}function vc(e){if(e instanceof fc)return e.field.canonicalString()+e.op.toString()+Jl(e.value);if(yc(e))return e.filters.map((e=>vc(e))).join(",");{const t=e.filters.map((e=>vc(e))).join(",");return`${e.op}(${t})`}}function bc(e,t){return e instanceof fc?function(e,t){return t instanceof fc&&e.op===t.op&&e.field.isEqual(t.field)&&Hl(e.value,t.value)}(e,t):e instanceof mc?function(e,t){return t instanceof mc&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&bc(n,t.filters[r])),!0)}(e,t):void Uo()}function wc(e){return e instanceof fc?function(e){return`${e.field.canonicalString()} ${e.op} ${Jl(e.value)}`}(e):e instanceof mc?function(e){return e.op.toString()+" {"+e.getFilters().map(wc).join(" ,")+"}"}(e):"Filter"}class _c extends fc{constructor(e,t,n){super(e,t,n),this.key=ul.fromName(n.referenceValue)}matches(e){const t=ul.comparator(e.key,this.key);return this.matchesComparison(t)}}class kc extends fc{constructor(e,t){super(e,"in",t),this.keys=Pc(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Ac extends fc{constructor(e,t){super(e,"not-in",t),this.keys=Pc(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Pc(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>ul.fromName(e.referenceValue)))}class Tc extends fc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Xl(t)&&Gl(t.arrayValue,this.value)}}class Ec extends fc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Gl(this.value.arrayValue,t)}}class xc extends fc{constructor(e,t){super(e,"not-in",t)}matches(e){if(Gl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Gl(this.value.arrayValue,t)}}class Ic extends fc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Xl(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Gl(this.value.arrayValue,e)))}}class Cc{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ue=null}}function Oc(e,t=null,n=[],r=[],i=null,s=null,a=null){return new Cc(e,t,n,r,i,s,a)}function Sc(e){const t=Vo(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>vc(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),wl(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Jl(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Jl(e))).join(",")),t.ue=e}return t.ue}function Nc(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!dc(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!bc(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!uc(e.startAt,t.startAt)&&uc(e.endAt,t.endAt)}function jc(e){return ul.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Dc{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Rc(e){return new Dc(e)}function $c(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Lc(e){const t=Vo(e);if(null===t.ce){t.ce=[];const e=new Set;for(const n of t.explicitOrderBy)t.ce.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Il(cl.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new hc(r,n))})),e.has(cl.keyField().canonicalString())||t.ce.push(new hc(cl.keyField(),n))}return t.ce}function Mc(e){const t=Vo(e);return t.le||(t.le=function(e,t){if("F"===e.limitType)return Oc(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new hc(e.field,t)}));const n=e.endAt?new lc(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new lc(e.startAt.position,e.startAt.inclusive):null;return Oc(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,Lc(e))),t.le}function Fc(e,t,n){return new Dc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Uc(e,t){return Nc(Mc(e),Mc(t))&&e.limitType===t.limitType}function Bc(e){return`${Sc(Mc(e))}|lt:${e.limitType}`}function Vc(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>wc(e))).join(", ")}]`),wl(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Jl(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Jl(e))).join(",")),`Target(${t})`}(Mc(e))}; limitType=${e.limitType})`}function zc(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ul.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Lc(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=cc(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Lc(e),t)||e.endAt&&!function(e,t,n){const r=cc(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Lc(e),t))}(e,t)}function Hc(e){return(t,n)=>{let r=!1;for(const i of Lc(e)){const e=Gc(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Gc(e,t,n){const r=e.field.isKeyField()?ul.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?ql(r,i):Uo()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Uo()}}class qc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Al(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Pl(this.inner)}size(){return this.innerSize}}const Kc=new Tl(ul.comparator);function Wc(){return Kc}const Jc=new Tl(ul.comparator);function Zc(...e){let t=Jc;for(const n of e)t=t.insert(n.key,n);return t}function Qc(e){let t=Jc;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Xc(){return eu()}function Yc(){return eu()}function eu(){return new qc((e=>e.toString()),((e,t)=>e.isEqual(t)))}const tu=new Tl(ul.comparator),nu=new Il(ul.comparator);function ru(...e){let t=nu;for(const n of e)t=t.add(n);return t}const iu=new Il(nl);function su(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_l(t)?"-0":t}}function au(e){return{integerValue:""+e}}class ou{constructor(){this._=void 0}}function lu(e,t,n){return e instanceof hu?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Ll(t)&&(t=Ml(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof du?pu(e,t):e instanceof fu?mu(e,t):function(e,t){const n=uu(e,t),r=yu(n)+yu(e.Pe);return Ql(n)&&Ql(e.Pe)?au(r):su(e.serializer,r)}(e,t)}function cu(e,t,n){return e instanceof du?pu(e,t):e instanceof fu?mu(e,t):n}function uu(e,t){return e instanceof gu?function(e){return Ql(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class hu extends ou{}class du extends ou{constructor(e){super(),this.elements=e}}function pu(e,t){const n=vu(t);for(const t of e.elements)n.some((e=>Hl(e,t)))||n.push(t);return{arrayValue:{values:n}}}class fu extends ou{constructor(e){super(),this.elements=e}}function mu(e,t){let n=vu(t);for(const t of e.elements)n=n.filter((e=>!Hl(e,t)));return{arrayValue:{values:n}}}class gu extends ou{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function yu(e){return Rl(e.integerValue||e.doubleValue)}function vu(e){return Xl(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class bu{constructor(e,t){this.version=e,this.transformResults=t}}class wu{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new wu}static exists(e){return new wu(void 0,e)}static updateTime(e){return new wu(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function _u(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ku{}function Au(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ju(e.key,wu.none()):new Iu(e.key,e.data,wu.none());{const n=e.data,r=sc.empty();let i=new Il(cl.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Cu(e.key,r,new Ol(i.toArray()),wu.none())}}function Pu(e,t,n){e instanceof Iu?function(e,t,n){const r=e.value.clone(),i=Su(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Cu?function(e,t,n){if(!_u(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Su(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Ou(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Tu(e,t,n,r){return e instanceof Iu?function(e,t,n,r){if(!_u(e.precondition,t))return n;const i=e.value.clone(),s=Nu(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Cu?function(e,t,n,r){if(!_u(e.precondition,t))return n;const i=Nu(e.fieldTransforms,r,t),s=t.data;return s.setAll(Ou(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return _u(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Eu(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=uu(r.transform,e||null);null!=i&&(null===n&&(n=sc.empty()),n.set(r.field,i))}return n||null}function xu(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&rl(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof du&&t instanceof du||e instanceof fu&&t instanceof fu?rl(e.elements,t.elements,Hl):e instanceof gu&&t instanceof gu?Hl(e.Pe,t.Pe):e instanceof hu&&t instanceof hu}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Iu extends ku{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Cu extends ku{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ou(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Su(e,t,n){const r=new Map;Bo(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],a=s.transform,o=t.data.field(s.field);r.set(s.field,cu(a,o,n[i]))}return r}function Nu(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,lu(e,s,t))}return r}class ju extends ku{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Du extends ku{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ru{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Pu(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Tu(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Tu(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Yc();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let a=this.applyToLocalView(s,i.mutatedFields);a=t.has(r.key)?null:a;const o=Au(s,a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(sl.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ru())}isEqual(e){return this.batchId===e.batchId&&rl(this.mutations,e.mutations,((e,t)=>xu(e,t)))&&rl(this.baseMutations,e.baseMutations,((e,t)=>xu(e,t)))}}class $u{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Bo(e.mutations.length===n.length);let r=tu;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new $u(e,t,n,r)}}class Lu{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Mu{constructor(e,t){this.count=e,this.unchangedNames=t}}var Fu,Uu;function Bu(e){if(void 0===e)return Lo("GRPC error has no .code"),zo.UNKNOWN;switch(e){case Fu.OK:return zo.OK;case Fu.CANCELLED:return zo.CANCELLED;case Fu.UNKNOWN:return zo.UNKNOWN;case Fu.DEADLINE_EXCEEDED:return zo.DEADLINE_EXCEEDED;case Fu.RESOURCE_EXHAUSTED:return zo.RESOURCE_EXHAUSTED;case Fu.INTERNAL:return zo.INTERNAL;case Fu.UNAVAILABLE:return zo.UNAVAILABLE;case Fu.UNAUTHENTICATED:return zo.UNAUTHENTICATED;case Fu.INVALID_ARGUMENT:return zo.INVALID_ARGUMENT;case Fu.NOT_FOUND:return zo.NOT_FOUND;case Fu.ALREADY_EXISTS:return zo.ALREADY_EXISTS;case Fu.PERMISSION_DENIED:return zo.PERMISSION_DENIED;case Fu.FAILED_PRECONDITION:return zo.FAILED_PRECONDITION;case Fu.ABORTED:return zo.ABORTED;case Fu.OUT_OF_RANGE:return zo.OUT_OF_RANGE;case Fu.UNIMPLEMENTED:return zo.UNIMPLEMENTED;case Fu.DATA_LOSS:return zo.DATA_LOSS;default:return Uo()}}(Uu=Fu||(Fu={}))[Uu.OK=0]="OK",Uu[Uu.CANCELLED=1]="CANCELLED",Uu[Uu.UNKNOWN=2]="UNKNOWN",Uu[Uu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Uu[Uu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Uu[Uu.NOT_FOUND=5]="NOT_FOUND",Uu[Uu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Uu[Uu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Uu[Uu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Uu[Uu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Uu[Uu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Uu[Uu.ABORTED=10]="ABORTED",Uu[Uu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Uu[Uu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Uu[Uu.INTERNAL=13]="INTERNAL",Uu[Uu.UNAVAILABLE=14]="UNAVAILABLE",Uu[Uu.DATA_LOSS=15]="DATA_LOSS";const Vu=new yo([4294967295,4294967295],0);function zu(e){const t=(new TextEncoder).encode(e),n=new vo;return n.update(t),new Uint8Array(n.digest())}function Hu(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new yo([n,r],0),new yo([i,s],0)]}class Gu{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new qu(`Invalid padding: ${t}`);if(n<0)throw new qu(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new qu(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new qu(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=yo.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(yo.fromNumber(n)));return 1===r.compare(Vu)&&(r=new yo([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=zu(e),[n,r]=Hu(t);for(let e=0;e<this.hashCount;e++){const t=this.Ee(n,r,e);if(!this.de(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Gu(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Ie)return;const t=zu(e),[n,r]=Hu(t);for(let e=0;e<this.hashCount;e++){const t=this.Ee(n,r,e);this.Ae(t)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class qu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ku{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Wu.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ku(sl.min(),r,new Tl(nl),Wc(),ru())}}class Wu{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Wu(n,t,ru(),ru(),ru())}}class Ju{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class Zu{constructor(e,t){this.targetId=e,this.me=t}}class Qu{constructor(e,t,n=Nl.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Xu{constructor(){this.fe=0,this.ge=th(),this.pe=Nl.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ru(),t=ru(),n=ru();return this.ge.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Uo()}})),new Wu(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=th()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Bo(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Yu{constructor(e){this.Le=e,this.Be=new Map,this.ke=Wc(),this.qe=eh(),this.Qe=new Tl(nl)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Uo()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((e,n)=>{this.ze(n)&&t(n)}))}He(e){const t=e.targetId,n=e.me.count,r=this.Je(t);if(r){const i=r.target;if(jc(i))if(0===n){const e=new ul(i.path);this.Ue(t,e,oc.newNoDocument(e,sl.min()))}else Bo(1===n);else{const r=this.Ye(t);if(r!==n){const n=this.Ze(e),i=n?this.Xe(n,e,r):1;if(0!==i){this.je(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,a;try{s=$l(n).toUint8Array()}catch(e){if(e instanceof Sl)return Mo("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new Gu(s,r,i)}catch(e){return Mo(e instanceof qu?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.Ie?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Le.tt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.Ue(t,n,null),r++)})),r}rt(e){const t=new Map;this.Be.forEach(((n,r)=>{const i=this.Je(r);if(i){if(n.current&&jc(i.target)){const t=new ul(i.target.path);null!==this.ke.get(t)||this.it(r,t)||this.Ue(r,t,oc.newNoDocument(t,e))}n.be&&(t.set(r,n.ve()),n.Ce())}}));let n=ru();this.qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.ke.forEach(((t,n)=>n.setReadTime(e)));const r=new Ku(e,t,this.Qe,this.ke,n);return this.ke=Wc(),this.qe=eh(),this.Qe=new Tl(nl),r}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Xu,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Il(nl),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||$o("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Xu),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function eh(){return new Tl(ul.comparator)}function th(){return new Tl(ul.comparator)}const nh={asc:"ASCENDING",desc:"DESCENDING"},rh={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ih={and:"AND",or:"OR"};class sh{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ah(e,t){return e.useProto3Json||wl(t)?t:{value:t}}function oh(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function lh(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ch(e,t){return oh(e,t.toTimestamp())}function uh(e){return Bo(!!e),sl.fromTimestamp(function(e){const t=Dl(e);return new il(t.seconds,t.nanos)}(e))}function hh(e,t){return dh(e,t).canonicalString()}function dh(e,t){const n=function(e){return new ol(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function ph(e){const t=ol.fromString(e);return Bo(Sh(t)),t}function fh(e,t){return hh(e.databaseId,t.path)}function mh(e,t){const n=ph(t);if(n.get(1)!==e.databaseId.projectId)throw new Ho(zo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Ho(zo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ul(vh(n))}function gh(e,t){return hh(e.databaseId,t)}function yh(e){return new ol(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function vh(e){return Bo(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function bh(e,t,n){return{name:fh(e,t),fields:n.value.mapValue.fields}}function wh(e,t){return{documents:[gh(e,t.path)]}}function _h(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=gh(e,i);const s=function(e){if(0!==e.length)return Ch(mc.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const a=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:xh(e.field),direction:Ph(e.dir)}}(e)))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=ah(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:i}}function kh(e){let t=function(e){const t=ph(e);return 4===t.length?ol.emptyPath():vh(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Bo(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Ah(e);return t instanceof mc&&yc(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map((e=>function(e){return new hc(Ih(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,wl(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new lc(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new lc(n,t)}(n.endAt)),function(e,t,n,r,i,s,a,o){return new Dc(e,t,n,r,i,"F",a,o)}(t,i,a,s,o,0,l,c)}function Ah(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Ih(e.unaryFilter.field);return fc.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Ih(e.unaryFilter.field);return fc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ih(e.unaryFilter.field);return fc.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ih(e.unaryFilter.field);return fc.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Uo()}}(e):void 0!==e.fieldFilter?function(e){return fc.create(Ih(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Uo()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return mc.create(e.compositeFilter.filters.map((e=>Ah(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Uo()}}(e.compositeFilter.op))}(e):Uo()}function Ph(e){return nh[e]}function Th(e){return rh[e]}function Eh(e){return ih[e]}function xh(e){return{fieldPath:e.canonicalString()}}function Ih(e){return cl.fromServerFormat(e.fieldPath)}function Ch(e){return e instanceof fc?function(e){if("=="===e.op){if(ec(e.value))return{unaryFilter:{field:xh(e.field),op:"IS_NAN"}};if(Yl(e.value))return{unaryFilter:{field:xh(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ec(e.value))return{unaryFilter:{field:xh(e.field),op:"IS_NOT_NAN"}};if(Yl(e.value))return{unaryFilter:{field:xh(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xh(e.field),op:Th(e.op),value:e.value}}}(e):e instanceof mc?function(e){const t=e.getFilters().map((e=>Ch(e)));return 1===t.length?t[0]:{compositeFilter:{op:Eh(e.op),filters:t}}}(e):Uo()}function Oh(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Sh(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Nh{constructor(e,t,n,r,i=sl.min(),s=sl.min(),a=Nl.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new Nh(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Nh(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Nh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Nh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class jh{constructor(e){this.ct=e}}function Dh(e){const t=kh({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Fc(t,t.limit,"L"):t}class Rh{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Rl(e.integerValue));else if("doubleValue"in e){const n=Rl(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),_l(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Dl(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt($l(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?ic(e)?this.dt(t,Number.MAX_SAFE_INTEGER):nc(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Uo()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const e of Object.keys(n))this.Vt(e,t),this.Tt(n[e],t)}wt(e,t){var n,r;const i=e.fields||{};this.dt(t,53);const s="value",a=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.dt(t,15),t.At(Rl(a)),this.Vt(s,t),this.Tt(i[s],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const e of n)this.Tt(e,t)}yt(e,t){this.dt(t,37),ul.fromName(e).path.forEach((e=>{this.dt(t,60),this.Dt(e,t)}))}dt(e,t){e.At(t)}ft(e){e.At(2)}}Rh.vt=new Rh;class $h{constructor(){this.un=new Lh}addToCollectionParentIndex(e,t){return this.un.add(t),yl.resolve()}getCollectionParents(e,t){return yl.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return yl.resolve()}deleteFieldIndex(e,t){return yl.resolve()}deleteAllFieldIndexes(e){return yl.resolve()}createTargetIndexes(e,t){return yl.resolve()}getDocumentsMatchingTarget(e,t){return yl.resolve(null)}getIndexType(e,t){return yl.resolve(0)}getFieldIndexes(e,t){return yl.resolve([])}getNextCollectionGroupToUpdate(e){return yl.resolve(null)}getMinOffset(e,t){return yl.resolve(dl.min())}getMinOffsetFromCollectionGroup(e,t){return yl.resolve(dl.min())}updateCollectionGroup(e,t,n){return yl.resolve()}updateIndexEntries(e,t){return yl.resolve()}}class Lh{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Il(ol.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Il(ol.comparator)).toArray()}}new Uint8Array(0);class Mh{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Mh(e,Mh.DEFAULT_COLLECTION_PERCENTILE,Mh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Mh.DEFAULT_COLLECTION_PERCENTILE=10,Mh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Mh.DEFAULT=new Mh(41943040,Mh.DEFAULT_COLLECTION_PERCENTILE,Mh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Mh.DISABLED=new Mh(-1,0,0);class Fh{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Fh(0)}static kn(){return new Fh(-1)}}class Uh{constructor(){this.changes=new qc((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,oc.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?yl.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Bh{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Vh{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Tu(n.mutation,e,Ol.empty(),il.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,ru()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=ru()){const r=Xc();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Zc();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Xc();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,ru())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Wc();const s=eu(),a=eu();return t.forEach(((e,t)=>{const a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof Cu)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),Tu(a.mutation,t,a.mutation.getFieldMask(),il.now())):s.set(t.key,Ol.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return a.set(e,new Bh(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),a)))}recalculateAndSaveOverlays(e,t){const n=eu();let r=new Tl(((e,t)=>e-t)),i=ru();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let a=n.get(e)||Ol.empty();a=i.applyToLocalView(s,a),n.set(e,a);const o=(r.get(i.batchId)||ru()).add(e);r=r.insert(i.batchId,o)}))})).next((()=>{const s=[],a=r.getReverseIterator();for(;a.hasNext();){const r=a.getNext(),o=r.key,l=r.value,c=Yc();l.forEach((e=>{if(!i.has(e)){const r=Au(t.get(e),n.get(e));null!==r&&c.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,o,c))}return yl.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return ul.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):yl.resolve(Xc());let a=-1,o=i;return s.next((t=>yl.forEach(t,((t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?yl.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{o=o.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,o,t,ru()))).next((e=>({batchId:a,changes:Qc(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ul(t)).next((e=>{let t=Zc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=Zc();return this.indexManager.getCollectionParents(e,i).next((a=>yl.forEach(a,(a=>{const o=function(e,t){return new Dc(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,oc.newInvalidDocument(r)))}));let n=Zc();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&Tu(s.mutation,r,Ol.empty(),il.now()),zc(t,r)&&(n=n.insert(e,r))})),n}))}}class zh{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return yl.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:uh(e.createTime)}}(t)),yl.resolve()}getNamedQuery(e,t){return yl.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(e){return{name:e.name,query:Dh(e.bundledQuery),readTime:uh(e.readTime)}}(t)),yl.resolve()}}class Hh{constructor(){this.overlays=new Tl(ul.comparator),this.Ir=new Map}getOverlay(e,t){return yl.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Xc();return yl.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),yl.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Ir.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Ir.delete(n)),yl.resolve()}getOverlaysForCollection(e,t,n){const r=Xc(),i=t.length+1,s=new ul(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return yl.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Tl(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Xc(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=Xc(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach(((e,t)=>a.set(e,t))),!(a.size()>=r)););return yl.resolve(a)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Lu(t,n));let i=this.Ir.get(t);void 0===i&&(i=ru(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}class Gh{constructor(){this.sessionToken=Nl.EMPTY_BYTE_STRING}getSessionToken(e){return yl.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,yl.resolve()}}class qh{constructor(){this.Tr=new Il(Kh.Er),this.dr=new Il(Kh.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Kh(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Vr(new Kh(e,t))}mr(e,t){e.forEach((e=>this.removeReference(e,t)))}gr(e){const t=new ul(new ol([])),n=new Kh(t,e),r=new Kh(t,e+1),i=[];return this.dr.forEachInRange([n,r],(e=>{this.Vr(e),i.push(e.key)})),i}pr(){this.Tr.forEach((e=>this.Vr(e)))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ul(new ol([])),n=new Kh(t,e),r=new Kh(t,e+1);let i=ru();return this.dr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Kh(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Kh{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ul.comparator(e.key,t.key)||nl(e.wr,t.wr)}static Ar(e,t){return nl(e.wr,t.wr)||ul.comparator(e.key,t.key)}}class Wh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Il(Kh.Er)}checkEmpty(e){return yl.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ru(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.br=this.br.add(new Kh(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return yl.resolve(s)}lookupMutationBatch(e,t){return yl.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.vr(n),i=r<0?0:r;return yl.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return yl.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return yl.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Kh(t,0),r=new Kh(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,r],(e=>{const t=this.Dr(e.wr);i.push(t)})),yl.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Il(nl);return t.forEach((e=>{const t=new Kh(e,0),r=new Kh(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,r],(e=>{n=n.add(e.wr)}))})),yl.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ul.isDocumentKey(i)||(i=i.child(""));const s=new Kh(new ul(i),0);let a=new Il(nl);return this.br.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.wr)),!0)}),s),yl.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach((e=>{const n=this.Dr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Bo(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return yl.forEach(t.mutations,(r=>{const i=new Kh(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.br=n}))}On(e){}containsKey(e,t){const n=new Kh(t,0),r=this.br.firstAfterOrEqual(n);return yl.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,yl.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Jh{constructor(e){this.Mr=e,this.docs=new Tl(ul.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return yl.resolve(n?n.document.mutableCopy():oc.newInvalidDocument(t))}getEntries(e,t){let n=Wc();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():oc.newInvalidDocument(e))})),yl.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Wc();const s=t.path,a=new ul(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||pl(hl(a),n)<=0||(r.has(a.key)||zc(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return yl.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Uo()}Or(e,t){return yl.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Zh(this)}getSize(e){return yl.resolve(this.size)}}class Zh extends Uh{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)})),yl.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class Qh{constructor(e){this.persistence=e,this.Nr=new qc((e=>Sc(e)),Nc),this.lastRemoteSnapshotVersion=sl.min(),this.highestTargetId=0,this.Lr=0,this.Br=new qh,this.targetCount=0,this.kr=Fh.Bn()}forEachTarget(e,t){return this.Nr.forEach(((e,n)=>t(n))),yl.resolve()}getLastRemoteSnapshotVersion(e){return yl.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return yl.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),yl.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),yl.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Fh(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,yl.resolve()}updateTargetData(e,t){return this.Kn(t),yl.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,yl.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Nr.forEach(((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Nr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)})),yl.waitFor(i).next((()=>r))}getTargetCount(e){return yl.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return yl.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),yl.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),yl.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),yl.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return yl.resolve(n)}containsKey(e,t){return yl.resolve(this.Br.containsKey(t))}}class Xh{constructor(e,t){this.qr={},this.overlays={},this.Qr=new bl(0),this.Kr=!1,this.Kr=!0,this.$r=new Gh,this.referenceDelegate=e(this),this.Ur=new Qh(this),this.indexManager=new $h,this.remoteDocumentCache=function(e){return new Jh(e)}((e=>this.referenceDelegate.Wr(e))),this.serializer=new jh(t),this.Gr=new zh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Hh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Wh(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){$o("MemoryPersistence","Starting transaction:",e);const r=new Yh(this.Qr.next());return this.referenceDelegate.zr(),n(r).next((e=>this.referenceDelegate.jr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Hr(e,t){return yl.or(Object.values(this.qr).map((n=>()=>n.containsKey(e,t))))}}class Yh extends ml{constructor(e){super(),this.currentSequenceNumber=e}}class ed{constructor(e){this.persistence=e,this.Jr=new qh,this.Yr=null}static Zr(e){return new ed(e)}get Xr(){if(this.Yr)return this.Yr;throw Uo()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),yl.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),yl.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),yl.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach((e=>this.Xr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Xr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return yl.forEach(this.Xr,(n=>{const r=ul.fromPath(n);return this.ei(e,r).next((e=>{e||t.removeEntry(r,sl.min())}))})).next((()=>(this.Yr=null,t.apply(e))))}updateLimboDocument(e,t){return this.ei(e,t).next((e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())}))}Wr(e){return 0}ei(e,t){return yl.or([()=>yl.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class td{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=ru(),r=ru();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new td(e,t.fromCache,n,r)}}class nd{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class rd{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=!function(){var e;const t=null===(e=xn())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(s.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}(jn())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.Yi(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Zi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new nd;return this.Xi(e,t,n).next((r=>{if(i.result=r,this.zi)return this.es(e,t,n,r.size)}))})).next((()=>i.result))}es(e,t,n,r){return n.documentReadCount<this.ji?(Ro()<=Zn.DEBUG&&$o("QueryEngine","SDK will not create cache indexes for query:",Vc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),yl.resolve()):(Ro()<=Zn.DEBUG&&$o("QueryEngine","Query:",Vc(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(Ro()<=Zn.DEBUG&&$o("QueryEngine","The SDK decides to create cache indexes for query:",Vc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Mc(t))):yl.resolve())}Yi(e,t){if($c(t))return yl.resolve(null);let n=Mc(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Fc(t,null,"F"),n=Mc(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=ru(...r);return this.Ji.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ts(t,r);return this.ns(t,s,i,n.readTime)?this.Yi(e,Fc(t,null,"F")):this.rs(e,s,t,n)}))))})))))}Zi(e,t,n,r){return $c(t)||r.isEqual(sl.min())?yl.resolve(null):this.Ji.getDocuments(e,n).next((i=>{const s=this.ts(t,i);return this.ns(t,s,n,r)?yl.resolve(null):(Ro()<=Zn.DEBUG&&$o("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Vc(t)),this.rs(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=sl.fromTimestamp(1e9===r?new il(n+1,0):new il(n,r));return new dl(i,ul.empty(),-1)}(r)).next((e=>e)))}))}ts(e,t){let n=new Il(Hc(e));return t.forEach(((t,r)=>{zc(e,r)&&(n=n.add(r))})),n}ns(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Xi(e,t,n){return Ro()<=Zn.DEBUG&&$o("QueryEngine","Using full collection scan to execute query:",Vc(t)),this.Ji.getDocumentsMatchingQuery(e,t,dl.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class id{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new Tl(nl),this._s=new qc((e=>Sc(e)),Nc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Vh(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.os)))}}async function sd(e,t){const n=Vo(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.ls(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let a=ru();for(const e of r){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next((e=>({hs:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function ad(e){const t=Vo(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Ur.getLastRemoteSnapshotVersion(e)))}function od(e,t){const n=Vo(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function ld(e,t,n){const r=Vo(e),i=r.os.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!vl(e))throw e;$o("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.os=r.os.remove(t),r._s.delete(i.target)}function cd(e,t,n){const r=Vo(e);let i=sl.min(),s=ru();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=Vo(e),i=r._s.get(n);return void 0!==i?yl.resolve(r.os.get(i)):r.Ur.getTargetData(t,n)}(r,e,Mc(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ss.getDocumentsMatchingQuery(e,t,n?i:sl.min(),n?s:ru()))).next((e=>(function(e,t,n){let r=e.us.get(t)||sl.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.us.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Ts:s})))))}class ud{constructor(){this.activeTargetIds=iu}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class hd{constructor(){this.so=new ud,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new ud,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class dd{_o(e){}shutdown(){}}class pd{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){$o("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){$o("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let fd=null;function md(){return null===fd?fd=268435456+Math.round(2147483648*Math.random()):fd++,"0x"+fd.toString(16)}const gd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class yd{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const vd="WebChannelConnection";class bd extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo=`projects/${n}/databases/${r}`,this.Co="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get Fo(){return!1}Mo(e,t,n,r,i){const s=md(),a=this.xo(e,t.toUriEncodedString());$o("RestConnection",`Sending RPC '${e}' ${s}:`,a,n);const o={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(o,r,i),this.No(e,a,o,n).then((t=>($o("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Mo("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t}))}Lo(e,t,n,r,i,s){return this.Mo(e,t,n,r,i)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+jo,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}xo(e,t){const n=gd[e];return`${this.Do}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){const i=md();return new Promise(((s,a)=>{const o=new _o;o.setWithCredentials(!0),o.listenOnce(Ao.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Po.NO_ERROR:const t=o.getResponseJson();$o(vd,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case Po.TIMEOUT:$o(vd,`RPC '${e}' ${i} timed out`),a(new Ho(zo.DEADLINE_EXCEEDED,"Request time out"));break;case Po.HTTP_ERROR:const n=o.getStatus();if($o(vd,`RPC '${e}' ${i} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(zo).indexOf(t)>=0?t:zo.UNKNOWN}(t.status);a(new Ho(e,t.message))}else a(new Ho(zo.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new Ho(zo.UNAVAILABLE,"Connection failed."));break;default:Uo()}}finally{$o(vd,`RPC '${e}' ${i} completed.`)}}));const l=JSON.stringify(r);$o(vd,`RPC '${e}' ${i} sending request:`,r),o.send(t,"POST",l,n,15)}))}Bo(e,t,n){const r=md(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Io(),a=xo(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const c=i.join("");$o(vd,`Creating RPC '${e}' stream ${r}: ${c}`,o);const u=s.createWebChannel(c,o);let h=!1,d=!1;const p=new yd({Io:t=>{d?$o(vd,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||($o(vd,`Opening RPC '${e}' stream ${r} transport.`),u.open(),h=!0),$o(vd,`RPC '${e}' stream ${r} sending:`,t),u.send(t))},To:()=>u.close()}),f=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(u,ko.EventType.OPEN,(()=>{d||($o(vd,`RPC '${e}' stream ${r} transport opened.`),p.yo())})),f(u,ko.EventType.CLOSE,(()=>{d||(d=!0,$o(vd,`RPC '${e}' stream ${r} transport closed`),p.So())})),f(u,ko.EventType.ERROR,(t=>{d||(d=!0,Mo(vd,`RPC '${e}' stream ${r} transport errored:`,t),p.So(new Ho(zo.UNAVAILABLE,"The operation could not be completed")))})),f(u,ko.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];Bo(!!i);const s=i,a=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(a){$o(vd,`RPC '${e}' stream ${r} received error:`,a);const t=a.status;let n=function(e){const t=Fu[e];if(void 0!==t)return Bu(t)}(t),i=a.message;void 0===n&&(n=zo.INTERNAL,i="Unknown error status: "+t+" with message "+a.message),d=!0,p.So(new Ho(n,i)),u.close()}else $o(vd,`RPC '${e}' stream ${r} received:`,i),p.bo(i)}})),f(a,Eo.STAT_EVENT,(t=>{t.stat===To.PROXY?$o(vd,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===To.NOPROXY&&$o(vd,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{p.wo()}),0),p}}function wd(){return"undefined"!=typeof document?document:null}function _d(e){return new sh(e,!0)}class kd{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);r>0&&$o("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,(()=>(this.Uo=Date.now(),e()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Ad{constructor(e,t,n,r,i,s,a,o){this.ui=e,this.Ho=n,this.Jo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new kd(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===zo.RESOURCE_EXHAUSTED?(Lo(t.toString()),Lo("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===zo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Yo===t&&this.P_(e,n)}),(t=>{e((()=>{const e=new Ho(zo.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)}))}))}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((()=>{n((()=>this.listener.Eo()))})),this.stream.Ro((()=>{n((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((e=>{n((()=>this.I_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.e_?this.E_(e):this.onNext(e)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(e){return $o("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget((()=>this.Yo===e?t():($o("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Pd extends Ad{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Uo()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(Bo(void 0===t||"string"==typeof t),Nl.fromBase64String(t||"")):(Bo(void 0===t||t instanceof Buffer||t instanceof Uint8Array),Nl.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?zo.UNKNOWN:Bu(e.code);return new Ho(t,e.message||"")}(a);n=new Qu(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=mh(e,r.document.name),s=uh(r.document.updateTime),a=r.document.createTime?uh(r.document.createTime):sl.min(),o=new sc({mapValue:{fields:r.document.fields}}),l=oc.newFoundDocument(i,s,a,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Ju(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=mh(e,r.document),s=r.readTime?uh(r.readTime):sl.min(),a=oc.newNoDocument(i,s),o=r.removedTargetIds||[];n=new Ju([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=mh(e,r.document),s=r.removedTargetIds||[];n=new Ju([],s,i,null)}else{if(!("filter"in t))return Uo();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Mu(r,i),a=e.targetId;n=new Zu(a,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return sl.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?sl.min():t.readTime?uh(t.readTime):sl.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=yh(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=jc(r)?{documents:wh(e,r)}:{query:_h(e,r)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=lh(e,t.resumeToken);const r=ah(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(sl.min())>0){n.readTime=oh(e,t.snapshotVersion.toTimestamp());const r=ah(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Uo()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=yh(this.serializer),t.removeTarget=e,this.a_(t)}}class Td extends Ad{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Bo(!!e.streamToken),this.lastStreamToken=e.streamToken,Bo(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){Bo(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function(e,t){return e&&e.length>0?(Bo(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?uh(e.updateTime):uh(t);return n.isEqual(sl.min())&&(n=uh(t)),new bu(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=uh(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=yh(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof Iu)n={update:bh(e,t.key,t.value)};else if(t instanceof ju)n={delete:fh(e,t.key)};else if(t instanceof Cu)n={update:bh(e,t.key,t.data),updateMask:Oh(t.fieldMask)};else{if(!(t instanceof Du))return Uo();n={verify:fh(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof hu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof du)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof fu)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof gu)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw Uo()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:ch(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Uo()}(e,t.precondition)),n}(this.serializer,e)))};this.a_(t)}}class Ed extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new Ho(zo.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Mo(e,dh(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===zo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ho(zo.UNKNOWN,e.toString())}))}Lo(e,t,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,a])=>this.connection.Lo(e,dh(t,n),r,s,a,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===zo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ho(zo.UNKNOWN,e.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class xd{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Lo(t),this.D_=!1):$o("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class Id{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o((e=>{n.enqueueAndForget((async()=>{Ld(this)&&($o("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Vo(e);t.L_.add(4),await Od(t),t.q_.set("Unknown"),t.L_.delete(4),await Cd(t)}(this))}))})),this.q_=new xd(n,r)}}async function Cd(e){if(Ld(e))for(const t of e.B_)await t(!0)}async function Od(e){for(const t of e.B_)await t(!1)}function Sd(e,t){const n=Vo(e);n.N_.has(t.targetId)||(n.N_.set(t.targetId,t),$d(n)?Rd(n):tp(n).r_()&&jd(n,t))}function Nd(e,t){const n=Vo(e),r=tp(n);n.N_.delete(t),r.r_()&&Dd(n,t),0===n.N_.size&&(r.r_()?r.o_():Ld(n)&&n.q_.set("Unknown"))}function jd(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(sl.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}tp(e).A_(t)}function Dd(e,t){e.Q_.xe(t),tp(e).R_(t)}function Rd(e){e.Q_=new Yu({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),tp(e).start(),e.q_.v_()}function $d(e){return Ld(e)&&!tp(e).n_()&&e.N_.size>0}function Ld(e){return 0===Vo(e).L_.size}function Md(e){e.Q_=void 0}async function Fd(e){e.q_.set("Online")}async function Ud(e){e.N_.forEach(((t,n)=>{jd(e,t)}))}async function Bd(e,t){Md(e),$d(e)?(e.q_.M_(t),Rd(e)):e.q_.set("Unknown")}async function Vd(e,t,n){if(e.q_.set("Online"),t instanceof Qu&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.N_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.N_.delete(r),e.Q_.removeTarget(r))}(e,t)}catch(n){$o("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await zd(e,n)}else if(t instanceof Ju?e.Q_.Ke(t):t instanceof Zu?e.Q_.He(t):e.Q_.We(t),!n.isEqual(sl.min()))try{const t=await ad(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Q_.rt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.N_.get(r);i&&e.N_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.N_.get(t);if(!r)return;e.N_.set(t,r.withResumeToken(Nl.EMPTY_BYTE_STRING,r.snapshotVersion)),Dd(e,t);const i=new Nh(r.target,t,n,r.sequenceNumber);jd(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){$o("RemoteStore","Failed to raise snapshot:",t),await zd(e,t)}}async function zd(e,t,n){if(!vl(t))throw t;e.L_.add(1),await Od(e),e.q_.set("Offline"),n||(n=()=>ad(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{$o("RemoteStore","Retrying IndexedDB access"),await n(),e.L_.delete(1),await Cd(e)}))}function Hd(e,t){return t().catch((n=>zd(e,n,t)))}async function Gd(e){const t=Vo(e),n=np(t);let r=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;qd(t);)try{const e=await od(t.localStore,r);if(null===e){0===t.O_.length&&n.o_();break}r=e.batchId,Kd(t,e)}catch(e){await zd(t,e)}Wd(t)&&Jd(t)}function qd(e){return Ld(e)&&e.O_.length<10}function Kd(e,t){e.O_.push(t);const n=np(e);n.r_()&&n.V_&&n.m_(t.mutations)}function Wd(e){return Ld(e)&&!np(e).n_()&&e.O_.length>0}function Jd(e){np(e).start()}async function Zd(e){np(e).p_()}async function Qd(e){const t=np(e);for(const n of e.O_)t.m_(n.mutations)}async function Xd(e,t,n){const r=e.O_.shift(),i=$u.from(r,t,n);await Hd(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Gd(e)}async function Yd(e,t){t&&np(e).V_&&await async function(e,t){if(function(e){return function(e){switch(e){default:return Uo();case zo.CANCELLED:case zo.UNKNOWN:case zo.DEADLINE_EXCEEDED:case zo.RESOURCE_EXHAUSTED:case zo.INTERNAL:case zo.UNAVAILABLE:case zo.UNAUTHENTICATED:return!1;case zo.INVALID_ARGUMENT:case zo.NOT_FOUND:case zo.ALREADY_EXISTS:case zo.PERMISSION_DENIED:case zo.FAILED_PRECONDITION:case zo.ABORTED:case zo.OUT_OF_RANGE:case zo.UNIMPLEMENTED:case zo.DATA_LOSS:return!0}}(e)&&e!==zo.ABORTED}(t.code)){const n=e.O_.shift();np(e).s_(),await Hd(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Gd(e)}}(e,t),Wd(e)&&Jd(e)}async function ep(e,t){const n=Vo(e);n.asyncQueue.verifyOperationInProgress(),$o("RemoteStore","RemoteStore received new credentials");const r=Ld(n);n.L_.add(3),await Od(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.L_.delete(3),await Cd(n)}function tp(e){return e.K_||(e.K_=function(e,t,n){const r=Vo(e);return r.w_(),new Pd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:Fd.bind(null,e),Ro:Ud.bind(null,e),mo:Bd.bind(null,e),d_:Vd.bind(null,e)}),e.B_.push((async t=>{t?(e.K_.s_(),$d(e)?Rd(e):e.q_.set("Unknown")):(await e.K_.stop(),Md(e))}))),e.K_}function np(e){return e.U_||(e.U_=function(e,t,n){const r=Vo(e);return r.w_(),new Td(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Zd.bind(null,e),mo:Yd.bind(null,e),f_:Qd.bind(null,e),g_:Xd.bind(null,e)}),e.B_.push((async t=>{t?(e.U_.s_(),await Gd(e)):(await e.U_.stop(),e.O_.length>0&&($o("RemoteStore",`Stopping write stream with ${e.O_.length} pending writes`),e.O_=[]))}))),e.U_}class rp{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Go,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new rp(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ho(zo.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ip(e,t){if(Lo("AsyncQueue",`${t}: ${e}`),vl(e))return new Ho(zo.UNAVAILABLE,`${t}: ${e}`);throw e}class sp{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ul.comparator(t.key,n.key):(e,t)=>ul.comparator(e.key,t.key),this.keyedMap=Zc(),this.sortedSet=new Tl(this.comparator)}static emptySet(e){return new sp(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sp))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new sp;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ap{constructor(){this.W_=new Tl(ul.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Uo():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class op{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new op(e,t,sp.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Uc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class lp{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((e=>e.J_()))}}class cp{constructor(){this.queries=up(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=Vo(e),r=n.queries;n.queries=up(),r.forEach(((e,n)=>{for(const e of n.j_)e.onError(t)}))}(this,new Ho(zo.ABORTED,"Firestore shutting down"))}}function up(){return new qc((e=>Bc(e)),Uc)}function hp(e,t){const n=Vo(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.j_)t.X_(e)&&(r=!0);i.z_=e}}r&&pp(n)}function dp(e,t,n){const r=Vo(e),i=r.queries.get(t);if(i)for(const e of i.j_)e.onError(n);r.queries.delete(t)}function pp(e){e.Y_.forEach((e=>{e.next()}))}var fp,mp;(mp=fp||(fp={})).ea="default",mp.Cache="cache";class gp{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new op(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache)return!0;if(!this.J_())return!0;const n="Offline"!==t;return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}oa(e){e=op.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==fp.Cache}}class yp{constructor(e){this.key=e}}class vp{constructor(e){this.key=e}}class bp{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ru(),this.mutatedKeys=ru(),this.Aa=Hc(e),this.Ra=new sp(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new ap,r=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1;const o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const c=r.get(e),u=zc(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),p=!0):this.ga(c,u)||(n.track({type:2,doc:u}),p=!0,(o&&this.Aa(u,o)>0||l&&this.Aa(u,l)<0)&&(a=!0)):!c&&u?(n.track({type:0,doc:u}),p=!0):c&&!u&&(n.track({type:1,doc:c}),p=!0,(o||l)&&(a=!0)),p&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ra:s,fa:n,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const s=e.fa.G_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Uo()}};return n(e)-n(t)}(e.type,t.type)||this.Aa(e.doc,t.doc))),this.pa(n),r=null!=r&&r;const a=t&&!r?this.ya():[],o=0===this.da.size&&this.current&&!r?1:0,l=o!==this.Ea;return this.Ea=o,0!==s.length||l?{snapshot:new op(this.query,e.Ra,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new ap,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach((e=>this.Ta=this.Ta.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ta=this.Ta.delete(e))),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ru(),this.Ra.forEach((e=>{this.Sa(e.key)&&(this.da=this.da.add(e.key))}));const t=[];return e.forEach((e=>{this.da.has(e)||t.push(new vp(e))})),this.da.forEach((n=>{e.has(n)||t.push(new yp(n))})),t}ba(e){this.Ta=e.Ts,this.da=ru();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return op.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class wp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class _p{constructor(e){this.key=e,this.va=!1}}class kp{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Ca={},this.Fa=new qc((e=>Bc(e)),Uc),this.Ma=new Map,this.xa=new Set,this.Oa=new Tl(ul.comparator),this.Na=new Map,this.La=new qh,this.Ba={},this.ka=new Map,this.qa=Fh.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function Ap(e,t,n=!0){const r=zp(e);let i;const s=r.Fa.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=await Tp(r,t,n,!0),i}async function Pp(e,t){const n=zp(e);await Tp(n,t,!0,!1)}async function Tp(e,t,n,r){const i=await function(e,t){const n=Vo(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Ur.getTargetData(e,t).next((i=>i?(r=i,yl.resolve(r)):n.Ur.allocateTargetId(e).next((i=>(r=new Nh(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Ur.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.os.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.os=n.os.insert(e.targetId,e),n._s.set(t,e.targetId)),e}))}(e.localStore,Mc(t)),s=i.targetId,a=e.sharedClientState.addLocalQueryTarget(s,n);let o;return r&&(o=await async function(e,t,n,r,i){e.Ka=(t,n,r)=>async function(e,t,n,r){let i=t.view.ma(n);i.ns&&(i=await cd(e.localStore,t.query,!1).then((({documents:e})=>t.view.ma(e,i))));const s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return Lp(e,t.targetId,o.wa),o.snapshot}(e,t,n,r);const s=await cd(e.localStore,t,!0),a=new bp(t,s.Ts),o=a.ma(s.documents),l=Wu.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),c=a.applyChanges(o,e.isPrimaryClient,l);Lp(e,n,c.wa);const u=new wp(t,n,a);return e.Fa.set(t,u),e.Ma.has(n)?e.Ma.get(n).push(t):e.Ma.set(n,[t]),c.snapshot}(e,t,s,"current"===a,i.resumeToken)),e.isPrimaryClient&&n&&Sd(e.remoteStore,i),o}async function Ep(e,t,n){const r=Vo(e),i=r.Fa.get(t),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter((e=>!Uc(e,t)))),void r.Fa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await ld(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Nd(r.remoteStore,i.targetId),Rp(r,i.targetId)})).catch(gl)):(Rp(r,i.targetId),await ld(r.localStore,i.targetId,!0))}async function xp(e,t){const n=Vo(e),r=n.Fa.get(t),i=n.Ma.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Nd(n.remoteStore,r.targetId))}async function Ip(e,t){const n=Vo(e);try{const e=await function(e,t){const n=Vo(e),r=t.snapshotVersion;let i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;const a=[];t.targetChanges.forEach(((s,o)=>{const l=i.get(o);if(!l)return;a.push(n.Ur.removeMatchingKeys(e,s.removedDocuments,o).next((()=>n.Ur.addMatchingKeys(e,s.addedDocuments,o))));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(Nl.EMPTY_BYTE_STRING,sl.min()).withLastLimboFreeSnapshotVersion(sl.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,r)),i=i.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(l,c,s)&&a.push(n.Ur.updateTargetData(e,c))}));let o=Wc(),l=ru();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),a.push(function(e,t,n){let r=ru(),i=ru();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Wc();return n.forEach(((n,s)=>{const a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(sl.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):$o("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),{Ps:r,Is:i}}))}(e,s,t.documentUpdates).next((e=>{o=e.Ps,l=e.Is}))),!r.isEqual(sl.min())){const t=n.Ur.getLastRemoteSnapshotVersion(e).next((t=>n.Ur.setTargetsMetadata(e,e.currentSequenceNumber,r)));a.push(t)}return yl.waitFor(a).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,o,l))).next((()=>o))})).then((e=>(n.os=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Na.get(t);r&&(Bo(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.va=!0:e.modifiedDocuments.size>0?Bo(r.va):e.removedDocuments.size>0&&(Bo(r.va),r.va=!1))})),await Up(n,e,t)}catch(e){await gl(e)}}function Cp(e,t,n){const r=Vo(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Fa.forEach(((n,r)=>{const i=r.view.Z_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Vo(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.j_)e.Z_(t)&&(r=!0)})),r&&pp(n)}(r.eventManager,t),e.length&&r.Ca.d_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Op(e,t,n){const r=Vo(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Na.get(t),s=i&&i.key;if(s){let e=new Tl(ul.comparator);e=e.insert(s,oc.newNoDocument(s,sl.min()));const n=ru().add(s),i=new Ku(sl.min(),new Map,new Tl(nl),e,n);await Ip(r,i),r.Oa=r.Oa.remove(s),r.Na.delete(t),Fp(r)}else await ld(r.localStore,t,!1).then((()=>Rp(r,t,n))).catch(gl)}async function Sp(e,t){const n=Vo(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Vo(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let a=yl.resolve();return s.forEach((e=>{a=a.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Bo(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),a.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ru();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Dp(n,r,null),jp(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Up(n,e)}catch(e){await gl(e)}}async function Np(e,t,n){const r=Vo(e);try{const e=await function(e,t){const n=Vo(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Bo(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Dp(r,t,n),jp(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Up(r,e)}catch(n){await gl(n)}}function jp(e,t){(e.ka.get(t)||[]).forEach((e=>{e.resolve()})),e.ka.delete(t)}function Dp(e,t,n){const r=Vo(e);let i=r.Ba[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ba[r.currentUser.toKey()]=i}}function Rp(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Ma.get(t))e.Fa.delete(r),n&&e.Ca.$a(r,n);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach((t=>{e.La.containsKey(t)||$p(e,t)}))}function $p(e,t){e.xa.delete(t.path.canonicalString());const n=e.Oa.get(t);null!==n&&(Nd(e.remoteStore,n),e.Oa=e.Oa.remove(t),e.Na.delete(n),Fp(e))}function Lp(e,t,n){for(const r of n)r instanceof yp?(e.La.addReference(r.key,t),Mp(e,r)):r instanceof vp?($o("SyncEngine","Document no longer in limbo: "+r.key),e.La.removeReference(r.key,t),e.La.containsKey(r.key)||$p(e,r.key)):Uo()}function Mp(e,t){const n=t.key,r=n.path.canonicalString();e.Oa.get(n)||e.xa.has(r)||($o("SyncEngine","New document in limbo: "+n),e.xa.add(r),Fp(e))}function Fp(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){const t=e.xa.values().next().value;e.xa.delete(t);const n=new ul(ol.fromString(t)),r=e.qa.next();e.Na.set(r,new _p(n)),e.Oa=e.Oa.insert(n,r),Sd(e.remoteStore,new Nh(Mc(Rc(n.path)),r,"TargetPurposeLimboResolution",bl.oe))}}async function Up(e,t,n){const r=Vo(e),i=[],s=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach(((e,o)=>{a.push(r.Ka(o,t,n).then((e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(o.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(o.targetId,i?"current":"not-current")}if(e){i.push(e);const t=td.Wi(o.targetId,e);s.push(t)}})))})),await Promise.all(a),r.Ca.d_(i),await async function(e,t){const n=Vo(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>yl.forEach(t,(t=>yl.forEach(t.$i,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>yl.forEach(t.Ui,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!vl(e))throw e;$o("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.os.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.os=n.os.insert(t,i)}}}(r.localStore,s))}async function Bp(e,t){const n=Vo(e);if(!n.currentUser.isEqual(t)){$o("SyncEngine","User change. New user:",t.toKey());const e=await sd(n.localStore,t);n.currentUser=t,function(e,t){e.ka.forEach((e=>{e.forEach((e=>{e.reject(new Ho(zo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.ka.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Up(n,e.hs)}}function Vp(e,t){const n=Vo(e),r=n.Na.get(t);if(r&&r.va)return ru().add(r.key);{let e=ru();const r=n.Ma.get(t);if(!r)return e;for(const t of r){const r=n.Fa.get(t);e=e.unionWith(r.view.Va)}return e}}function zp(e){const t=Vo(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ip.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Vp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Op.bind(null,t),t.Ca.d_=hp.bind(null,t.eventManager),t.Ca.$a=dp.bind(null,t.eventManager),t}function Hp(e){const t=Vo(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Sp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Np.bind(null,t),t}class Gp{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=_d(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return function(e,t,n,r){return new id(e,t,n,r)}(this.persistence,new rd,e.initialUser,this.serializer)}Ga(e){return new Xh(ed.Zr,this.serializer)}Wa(e){return new hd}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gp.provider={build:()=>new Gp};class qp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Cp(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Bp.bind(null,this.syncEngine),await async function(e,t){const n=Vo(e);t?(n.L_.delete(2),await Cd(n)):t||(n.L_.add(2),await Od(n),n.q_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new cp}createDatastore(e){const t=_d(e.databaseInfo.databaseId),n=function(e){return new bd(e)}(e.databaseInfo);return function(e,t,n,r){return new Ed(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Id(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Cp(this.syncEngine,e,0)),pd.D()?new pd:new dd)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new kp(e,t,n,r,i,s);return a&&(o.Qa=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=Vo(e);$o("RemoteStore","RemoteStore shutting down."),t.L_.add(5),await Od(t),t.k_.shutdown(),t.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}qp.provider={build:()=>new qp};class Kp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Lo("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class Wp{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=No.UNAUTHENTICATED,this.clientId=tl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{$o("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>($o("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Go;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=ip(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Jp(e,t){e.asyncQueue.verifyOperationInProgress(),$o("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await sd(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Zp(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){$o("FirestoreClient","Using user provided OfflineComponentProvider");try{await Jp(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===zo.FAILED_PRECONDITION||e.code===zo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;Mo("Error using user provided cache. Falling back to memory cache: "+n),await Jp(e,new Gp)}}else $o("FirestoreClient","Using default OfflineComponentProvider"),await Jp(e,new Gp);return e._offlineComponents}(e);$o("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>ep(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>ep(t.remoteStore,n))),e._onlineComponents=t}async function Qp(e){return e._onlineComponents||(e._uninitializedComponentsProvider?($o("FirestoreClient","Using user provided OnlineComponentProvider"),await Zp(e,e._uninitializedComponentsProvider._online)):($o("FirestoreClient","Using default OnlineComponentProvider"),await Zp(e,new qp))),e._onlineComponents}async function Xp(e){const t=await Qp(e),n=t.eventManager;return n.onListen=Ap.bind(null,t.syncEngine),n.onUnlisten=Ep.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Pp.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=xp.bind(null,t.syncEngine),n}function Yp(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const ef=new Map;function tf(e,t,n){if(!n)throw new Ho(zo.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function nf(e){if(!ul.isDocumentKey(e))throw new Ho(zo.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function rf(e){if(ul.isDocumentKey(e))throw new Ho(zo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function sf(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Uo()}function af(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Ho(zo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=sf(e);throw new Ho(zo.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class of{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Ho(zo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Ho(zo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new Ho(zo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Yp(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Ho(zo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Ho(zo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Ho(zo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lf{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new of({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ho(zo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Ho(zo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new of(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Ko;switch(e.type){case"firstParty":return new Qo(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Ho(zo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ef.get(e);t&&($o("ComponentProvider","Removing Datastore"),ef.delete(e),t.terminate())}(this),Promise.resolve()}}class cf{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new cf(this.firestore,e,this._query)}}class uf{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new uf(this.firestore,e,this._key)}}class hf extends cf{constructor(e,t,n){super(e,t,Rc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new uf(this.firestore,null,new ul(e))}withConverter(e){return new hf(this.firestore,e,this._path)}}function df(e,t,...n){if(e=Hn(e),tf("collection","path",t),e instanceof lf){const r=ol.fromString(t,...n);return rf(r),new hf(e,null,r)}{if(!(e instanceof uf||e instanceof hf))throw new Ho(zo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ol.fromString(t,...n));return rf(r),new hf(e.firestore,null,r)}}function pf(e,t,...n){if(e=Hn(e),1===arguments.length&&(t=tl.newId()),tf("doc","path",t),e instanceof lf){const r=ol.fromString(t,...n);return nf(r),new uf(e,null,new ul(r))}{if(!(e instanceof uf||e instanceof hf))throw new Ho(zo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ol.fromString(t,...n));return nf(r),new uf(e.firestore,e instanceof hf?e.converter:null,new ul(r))}}class ff{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new kd(this,"async_queue_retry"),this.Vu=()=>{const e=wd();e&&$o("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=wd();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=wd();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise((()=>{}));const t=new Go;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Pu.push(e),this.pu())))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!vl(e))throw e;$o("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go((()=>this.pu()))}}gu(e){const t=this.mu.then((()=>(this.du=!0,e().catch((e=>{this.Eu=e,this.du=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Lo("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.du=!1,e))))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const r=rp.createAndSchedule(this,e,t,n,(e=>this.yu(e)));return this.Tu.push(r),r}fu(){this.Eu&&Uo()}verifyOperationInProgress(){}async wu(){let e;do{e=this.mu,await e}while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then((()=>{this.Tu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()}))}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class mf extends lf{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new ff,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ff(e),this._firestoreClient=void 0,await e}}}function gf(e,t){const n="string"==typeof e?e:t||"(default)",r=ti("object"==typeof e?e:oi(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=Cn("firestore");e&&function(e,t,n,r={}){var i;const s=(e=af(e,lf))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&Mo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=No.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Tn(JSON.stringify({alg:"none",type:"JWT"})),Tn(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Ho(zo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new No(s)}e._authCredentials=new Wo(new qo(t,n))}}(r,...e)}return r}function yf(e){if(e._terminated)throw new Ho(zo.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Ul(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Yp(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Wp(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class vf{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vf(Nl.fromBase64String(e))}catch(e){throw new Ho(zo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new vf(Nl.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class bf{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Ho(zo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new cl(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class wf{constructor(e){this._methodName=e}}class _f{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ho(zo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ho(zo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return nl(this._lat,e._lat)||nl(this._long,e._long)}}class kf{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const Af=/^__.*__$/;class Pf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Cu(e,this.data,this.fieldMask,t,this.fieldTransforms):new Iu(e,this.data,t,this.fieldTransforms)}}function Tf(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Uo()}}class Ef{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Ef(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Lf(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(Tf(this.Cu)&&Af.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class xf{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||_d(e)}Qu(e,t,n,r=!1){return new Ef({Cu:e,methodName:t,qu:n,path:cl.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function If(e){const t=e._freezeSettings(),n=_d(e._databaseId);return new xf(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Cf(e,t,n,r,i,s={}){const a=e.Qu(s.merge||s.mergeFields?2:0,t,n,i);jf("Data must be an object, but it was:",a,r);const o=Sf(r,a);let l,c;if(s.merge)l=new Ol(a.fieldMask),c=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Df(t,r,n);if(!a.contains(i))throw new Ho(zo.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Mf(e,i)||e.push(i)}l=new Ol(e),c=a.fieldTransforms.filter((e=>l.covers(e.field)))}else l=null,c=a.fieldTransforms;return new Pf(new sc(o),l,c)}function Of(e,t){if(Nf(e=Hn(e)))return jf("Unsupported field value:",t,e),Sf(e,t);if(e instanceof wf)return function(e,t){if(!Tf(t.Cu))throw t.Bu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Bu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Of(i,t.Lu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Hn(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return function(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!_l(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?au(t):su(e,t)}(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=il.fromDate(e);return{timestampValue:oh(t.serializer,n)}}if(e instanceof il){const n=new il(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:oh(t.serializer,n)}}if(e instanceof _f)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof vf)return{bytesValue:lh(t.serializer,e._byteString)};if(e instanceof uf){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Bu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:hh(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof kf)return function(e,t){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.Bu("VectorValues must only contain numeric values.");return su(t.serializer,e)}))}}}}}}(e,t);throw t.Bu(`Unsupported field value: ${sf(e)}`)}(e,t)}function Sf(e,t){const n={};return Pl(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Al(e,((e,r)=>{const i=Of(r,t.Mu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Nf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof il||e instanceof _f||e instanceof vf||e instanceof uf||e instanceof wf||e instanceof kf)}function jf(e,t,n){if(!Nf(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=sf(n);throw"an object"===r?t.Bu(e+" a custom object"):t.Bu(e+" "+r)}}function Df(e,t,n){if((t=Hn(t))instanceof bf)return t._internalPath;if("string"==typeof t)return $f(e,t);throw Lf("Field path arguments must be of type string or ",e,!1,void 0,n)}const Rf=new RegExp("[~\\*/\\[\\]]");function $f(e,t,n){if(t.search(Rf)>=0)throw Lf(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new bf(...t.split("."))._internalPath}catch(r){throw Lf(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Lf(e,t,n,r,i){const s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new Ho(zo.INVALID_ARGUMENT,o+e+l)}function Mf(e,t){return e.some((e=>e.isEqual(t)))}class Ff{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new uf(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Uf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Bf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Uf extends Ff{data(){return super.data()}}function Bf(e,t){return"string"==typeof t?$f(e,t):t instanceof bf?t._internalPath:t._delegate._internalPath}class Vf{convertValue(e,t="none"){switch(zl(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Rl(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes($l(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Uo()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Al(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((e=>Rl(e.doubleValue)));return new kf(i)}convertGeoPoint(e){return new _f(Rl(e.latitude),Rl(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ml(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Fl(e));default:return null}}convertTimestamp(e){const t=Dl(e);return new il(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ol.fromString(e);Bo(Sh(n));const r=new Bl(n.get(1),n.get(3)),i=new ul(n.popFirst(5));return r.isEqual(t)||Lo(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function zf(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Hf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gf extends Ff{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new qf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Bf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class qf extends Gf{data(e={}){return super.data(e)}}function Kf(e){e=af(e,uf);const t=af(e.firestore,mf);return function(e,t,n={}){const r=new Go;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Kp({next:o=>{s.Za(),t.enqueueAndForget((()=>async function(e,t){const n=Vo(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.j_.indexOf(t);e>=0&&(s.j_.splice(e,1),0===s.j_.length?i=t.J_()?0:1:!s.H_()&&t.J_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(e,a)));const l=o.docs.has(n);!l&&o.fromCache?i.reject(new Ho(zo.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&"server"===r.source?i.reject(new Ho(zo.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new gp(Rc(n.path),s,{includeMetadataChanges:!0,_a:!0});return async function(e,t){const n=Vo(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.H_()&&t.J_()&&(r=2):(s=new lp,r=t.J_()?0:1);try{switch(r){case 0:s.z_=await n.onListen(i,!0);break;case 1:s.z_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=ip(e,`Initialization of query '${Vc(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.j_.push(t),t.Z_(n.onlineState),s.z_&&t.X_(s.z_)&&pp(n)}(e,a)}(await Xp(e),e.asyncQueue,t,n,r))),r.promise}(yf(t),e._key).then((n=>function(e,t,n){const r=n.docs.get(t._key),i=new Wf(e);return new Gf(e,i,t._key,r,new Hf(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}class Wf extends Vf{constructor(e){super(),this.firestore=e}convertBytes(e){return new vf(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new uf(this.firestore,null,t)}}function Jf(e,t,n){e=af(e,uf);const r=af(e.firestore,mf),i=zf(e.converter,t,n);return Qf(r,[Cf(If(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,wu.none())])}function Zf(e,t){const n=af(e.firestore,mf),r=pf(e),i=zf(e.converter,t);return Qf(n,[Cf(If(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,wu.exists(!1))]).then((()=>r))}function Qf(e,t){return function(e,t){const n=new Go;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Hp(e);try{const e=await function(e,t){const n=Vo(e),r=il.now(),i=t.reduce(((e,t)=>e.add(t.key)),ru());let s,a;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let o=Wc(),l=ru();return n.cs.getEntries(e,i).next((e=>{o=e,o.forEach(((e,t)=>{t.isValidDocument()||(l=l.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,o))).next((i=>{s=i;const a=[];for(const e of t){const t=Eu(e,s.get(e.key).overlayedDocument);null!=t&&a.push(new Cu(e.key,t,ac(t.value.mapValue),wu.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,a,t)})).next((t=>{a=t;const r=t.applyToLocalDocumentSet(s,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:a.batchId,changes:Qc(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ba[e.currentUser.toKey()];r||(r=new Tl(nl)),r=r.insert(t,n),e.Ba[e.currentUser.toKey()]=r}(r,e.batchId,n),await Up(r,e.changes),await Gd(r.remoteStore)}catch(e){const t=ip(e,"Failed to persist write");n.reject(t)}}(await function(e){return Qp(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(yf(e),t)}new WeakMap,function(e,t=!0){!function(e){jo=e}(si),ei(new Gn("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new mf(new Jo(e.getProvider("auth-internal")),new Yo(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Ho(zo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bl(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),li(So,"4.7.3",e),li(So,"4.7.3","esm2017")}();const Xf=N.logger.get_logger({id:"firebase"});function Yf(e){return ai(e)}function em(e){return function(e=oi()){const t=ti(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=ti(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Ln(n.getOptions(),null!=t?t:{}))return e;Ti(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:oo,persistence:[Ta,la,ua]}),r=Sn("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=fo(e.toString());!function(e,t,n){Hn(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,n,r,i){Hn(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}}const i=In("auth");return i&&function(e,t,n){const r=Cs(e);Oi(r._canInitEmulator,r,"emulator-config-failed"),Oi(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=Ls(t),{host:s,port:a}=function(e){const t=Ls(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Ms(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Ms(t)}}}(t),o=null===a?"":`:${a}`;r.config.emulator={url:`${i}//${s}${o}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})}),function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${i}`),n}(e)}function tm(e){return gf(e)}function nm(e){let t=Yf(e);return{app:t,auth:em(t),db:tm(t)}}function rm(e){(function(e){return Hn(e).signOut()})(e).then((()=>{Xf("User signed out")})).catch((e=>{Xf("Signout error")}))}function im(e){let t=bn(e);return t.note_on=function(e,n,r){let i=N.midi_encoder.note_on(e,n,r);t.write(i)},t.note_off=function(e,n,r){let i=Uint8Array.from([128+e,n,r]);t.write(i)},t.control_change=function(e,n,r){let i=N.midi_encoder.control_change(e,n,r);t.write(i)},t}const sm=N.logger.get_logger({id:"sensors"});var am=!1,om=!1,lm={},cm={};function um(e){let t="default.motion.logger";dm(t,(function(e){let{acceleration:t,rotationRate:n}=e,{x:r,y:i,z:s}=t,{alpha:a,beta:o,gamma:l}=n;sm(`x,y,z,alpha,beta,gamma=${r},${i},${s},${a},${o},${l}`)})),window.setTimeout((function(){fm(t)}),1e3*e)}function hm(e){let t="default.orientation.logger";pm(t,(function(e){let{alpha:t,beta:n,gamma:r}=e;sm(`alpha,beta,gamma=${t},${n},${r}`)})),window.setTimeout((function(){mm(t)}),1e3*e)}function dm(e,t){vm(),lm[e]&&sm(`WARNING! motion subscription id ${e} has already been used`),lm[e]=t}function pm(e,t){bm(),cm[e]&&sm(`WARNING! orientation subscription id ${e} has already been used`),cm[e]=t}function fm(e){delete lm[e],sm(`Unsubscribed motion id: ${e}`),N.fp.is_empty_array(N.fp.keys(lm))&&(sm("No more motion subscribers; so listener will be detached"),wm())}function mm(e){delete cm[e],sm(`Unsubscribed orientation id: ${e}`),N.fp.is_empty_array(N.fp.keys(cm))&&(sm("No more orientation subscribers; so listener will be detached"),_m())}function gm(e){N.fp.values(lm).map((t=>t(e)))}function ym(e){N.fp.values(cm).map((t=>t(e)))}function vm(){am||(window.addEventListener("devicemotion",gm),sm("Started listening to device motion (registered handler"),am=!0)}function bm(){om||(window.addEventListener("deviceorientation",ym),sm("Started listening to device orientation (registered handler"),om=!0)}function wm(){window.removeEventListener("devicemotion",gm),am=!1,sm("Unregistered device motion handler")}function _m(){window.removeEventListener("deviceorientation",ym),om=!1,sm("Unregistered device orientation handler")}const km=N.logger.get_logger({id:"idbmod"});class Am{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._db=null,this._dbp=new Promise(((n,r)=>{let i=this;const s=indexedDB.open(e,1);s.onerror=()=>r(s.error),s.onsuccess=function(){n(s.result),i._db=s.result},s.onupgradeneeded=()=>{km(`creating store: ${e},  ${t}`),s.result.createObjectStore(t)}}))}_withIDBStore(e,t){return this._dbp.then((n=>new Promise(((r,i)=>{const s=n.transaction(this.storeName,e);s.oncomplete=()=>r(),s.onabort=s.onerror=()=>i(s.error),t(s.objectStore(this.storeName))}))))}get_db(){return this._db}}let Pm;function Tm(){return Pm||(Pm=new Am),Pm}const Em=N.logger.get_logger({id:"db"}),xm=N.dates,Im={};var Cm=5e3;const Om="main_store",Sm="TIDYSCRIPTS_WEB_";var Nm=null,jm=!1;function Dm(e,t=!0){if(jm||(Em("initializing TTL"),jm=!0,Nm=Dm("TTL")),Im[e])return t&&Em(`getting db from local cache: ${e}`),Im[e];var n=new Am(Sm+e,Om);function r(e,t){return function(e,t,n=Tm()){return n._withIDBStore("readwrite",(n=>{n.put(t,e)}))}(e,t,n)}let i={store:n,set:r,get:function(e){return function(e,t=Tm()){let n;return t._withIDBStore("readonly",(t=>{n=t.get(e)})).then((()=>n.result))}(e,n)},del:function(e){return function(e,t=Tm()){return t._withIDBStore("readwrite",(t=>{t.delete(e)}))}(e,n)},keys:function(){return function(e=Tm()){const t=[];return e._withIDBStore("readonly",(e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}})).then((()=>t))}(n)},clear:function(){return function(e=Tm()){return e._withIDBStore("readwrite",(e=>{e.clear()}))}(n)},set_with_ttl:async function(t){let{id:n,ttl_ms:i,value:s}=t,a=i+xm.ms_now();Em(`In db "${e}" setting "${n}" with ttl_ms ${i}, expiration = ${a}`),await r(n,s),await Nm.set(a,{db_id:e,del_id:n}),Em("done setting with ttl \\(^.^)/")},get_db_store:function(){return n},ready:function(){return n._dbp}};return Im[e]=i,t&&Em(`getting db: ${e}`),i}function Rm(e){Cm=e,Em("Updated cache check interval to "+e+" ms")}var $m=null;async function Lm(){let e=await Nm.keys(),t=e.length,n=e.filter((e=>e<xm.ms_now())),r=n.length,i=[];for(var s of n){let{db_id:e,del_id:t}=await Nm.get(s),n=Dm(e,!1);await n.del(t),await Nm.del(s),i.push({db_id:e,del_id:t})}Em(`CacheCheck |> ${r}/${t} expired:`),r>0&&Em(i)}function Mm(e){$m&&(Em("Already checking, will clear old interval."),Fm()),Rm(e),$m=setInterval(Lm,Cm)}function Fm(){clearInterval($m),Em("Stopped cache check")}function Um(e){return window.indexedDB.deleteDatabase(Sm+e)}async function Bm(e){let t=Dm(e).get_db_store()._db;return await(n=t,new Promise(((e,t)=>{const r={};if(0===n.objectStoreNames.length)e(JSON.stringify(r));else{const i=n.transaction(n.objectStoreNames,"readonly");i.addEventListener("error",t);for(const t of n.objectStoreNames){const s=[];i.objectStore(t).openCursor().addEventListener("success",(i=>{const a=i.target.result;a?(s.push([a.key,a.value]),a.continue()):(r[t]=s,n.objectStoreNames.length===Object.keys(r).length&&e(JSON.stringify(r)))}))}}})));var n}async function Vm(e,t){let n=Dm(e);await n.ready();let r=n.get_db_store()._db;return await(i=r,s=t,new Promise(((e,t)=>{const n=i.transaction(i.objectStoreNames,"readwrite");n.addEventListener("error",t);var r=JSON.parse(s);for(const t of i.objectStoreNames){let i=0;for(const s of r[t]){let[a,o]=s;n.objectStore(t).add(o,a).addEventListener("success",(()=>{i++,i===r[t].length&&(delete r[t],0===Object.keys(r).length&&e("ok"))}))}}})));var i,s}const zm=N.logger.get_logger({id:"bokeh"});var Hm=!1;async function Gm(){if(window.Bokeh)return void zm("Bokeh is already loaded! Skipping load for now...");if(Hm)return void zm("Bokeh is already loading! Skipping load for now...");Hm=!0;let e="3.0.0",t=[`https://cdn.bokeh.org/bokeh/release/bokeh-${e}.min.js`,`https://cdn.bokeh.org/bokeh/release/bokeh-widgets-${e}.min.js`,`https://cdn.bokeh.org/bokeh/release/bokeh-tables-${e}.min.js`,`https://cdn.bokeh.org/bokeh/release/bokeh-api-${e}.min.js`,`https://cdn.bokeh.org/bokeh/release/bokeh-gl-${e}.min.js`,`https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-${e}.min.js`];for(var n of(zm("Loading scripts"),t))zm(`Loading ${n}`),await jt({src:n,attributes:{crossorigin:"anonymous"}});zm("Done")}function qm(){const e=new Bokeh.ColumnDataSource({data:{x:[0],y:[0]}});let t={width:300,height:100};t.y_range=new Bokeh.Range1d({start:-1,end:1}),t.x_range=new Bokeh.Range1d({start:-1,end:1});const n=new Bokeh.Plot(t),r=new Bokeh.LinearAxis({axis_line_color:null}),i=new Bokeh.LinearAxis({axis_line_color:null});n.add_layout(r,"below"),n.add_layout(i,"left");const s=new Bokeh.Grid({ticker:r.ticker,dimension:0}),a=new Bokeh.Grid({ticker:i.ticker,dimension:1});n.add_layout(s),n.add_layout(a);const o=new Bokeh.Line({x:{field:"x"},y:{field:"y"},line_color:"#666699",line_width:2});return n.add_glyph(o,e),{plot:n,source:e}}const Km=N.util.dsp;N.util.debug;var Wm=null,Jm=null,Zm=null,Qm=null;const Xm=N.logger.get_logger({id:"web_audio"});async function Ym(){return Wm||(Wm=new window.AudioContext,Jm=await window.navigator.mediaDevices.getUserMedia({audio:!0}),Wm)}async function eg(){return Wm?(Xm("Shutting down audio context"),await Wm.close(),tg(),Xm("Done"),null):void Xm("no ctx is active")}function tg(){Xm("Removing mic_callbacks"),ag={}}async function ng(){return Jm||(await Ym(),await window.navigator.mediaDevices.getUserMedia({audio:!0}))}async function rg(){return(await ng()).getAudioTracks()[0].getSettings().sampleRate}async function ig(e){let t=await Ym();return await t.decodeAudioData(e)}async function sg(e){return await ig(await e.arrayBuffer())}var ag={};function og(e,t){ag[e]=t}function lg(e){Object.keys(ag).length>0&&N.fp.apply_function_dictionary_to_object(ag,e)}var cg,ug=!1;async function hg(){if(ug)return Xm("mic already initialized");let e=await Ym(),t=await ng(),n=e.createMediaStreamSource(t);(Zm=e.createAnalyser()).fftSize=2048,cg=new Float32Array(Zm.frequencyBinCount),n.connect(Zm),ug=!0,function e(){requestAnimationFrame(e),Zm.getFloatTimeDomainData(cg),lg(cg)}()}var dg,pg=new Float32Array(1024),fg=new Float32Array(1024);async function mg(e){Xm(`testing diff with ${e} ms`),Zm.getFloatTimeDomainData(pg),window.setTimeout((function(){Zm.getFloatTimeDomainData(fg);let e=JSON.stringify(pg)==JSON.stringify(fg);Xm(`Equality = ${e}`)}),e)}async function gg(e){if(await hg(),Qm)return Xm("sound event detector already initialized"),Qm;let t={threshold:.2,margin:600,audio_buffer_size:cg.length,register_fn:og},n=Object.assign(t,e);return Qm=new dg(n),await Qm.init(),Qm}async function yg(e,t){await Gm();const n=N.fp.range(0,e.length),r=Array.from(e),i=new Bokeh.ColumnDataSource({data:{x:n,y:r}}),s=new Bokeh.Plot({width:300,height:100}),a=new Bokeh.LinearAxis({axis_line_color:null}),o=new Bokeh.LinearAxis({axis_line_color:null});s.add_layout(a,"below"),s.add_layout(o,"left");const l=new Bokeh.Grid({ticker:a.ticker,dimension:0}),c=new Bokeh.Grid({ticker:o.ticker,dimension:1});s.add_layout(l),s.add_layout(c);const u=new Bokeh.Line({x:{field:"x"},y:{field:"y"},line_color:"#666699",line_width:2});s.add_glyph(u,i),Bokeh.Plotting.show(s,document.getElementById(t))}function vg(){return document.querySelector("textarea")}function bg(e){vg().value=e}function wg(){vg().parentElement.querySelector("button").click()}function _g(e){bg(e),wg()}function kg(){window.addEventListener("tidyscripts_web_speech_recognition_result",(function(e){_g(e.detail)})),ht()}"undefined"!=typeof window&&(dg=class extends window.EventTarget{constructor(e){super();let{threshold:t,margin:n,register_fn:r,audio_buffer_size:i}=e;this.threshold=t,this.margin=n,this.register_fn=r,this.log=N.logger.get_logger({id:"snd_evt"}),this.sampling_rate=48e3,this.audio_buffer_size=i,this.tmp_buffer=[],this.tmp_buffer_max_length=10,this.recording_event=!1,this.event_start_time=0,this.time_of_last_detection=performance.now(),this.media_recorder=null}async init(){let e=this;this.register_fn("SED",(function(t){e.handle_data(t)})),this.log("Linked sound event detector to audio source"),this.sampling_rate=await rg(),this.log(`Got sampling rate ${this.sampling_rate}`);let t=this.num_buffers_to_cover_margin();this.log(`Created tmp buffer of size ${t}`),this.tmp_buffer_max_length=t,this.tmp_buffer=N.fp.range(0,t).map((e=>new Float32Array(this.audio_buffer_size)));let n=await ng();this.media_recorder=new window.MediaRecorder(n),this.log("Initialized media recorder")}handle_data(e){this.tmp_buffer.shift(),this.tmp_buffer.push(e),this.analyze_tmp_buffer()}analyze_tmp_buffer(){let e=this.tmp_buffer,t=N.fp.all_true(e.map((e=>Km.mean_abs(e)>this.threshold)));if(this.recording_event){if(t)return void(this.time_of_last_detection=performance.now());let n=N.fp.all_true(e.map((e=>Km.mean_abs(e)<this.threshold))),r=performance.now()-this.time_of_last_detection>this.margin;n&&r&&(this.log("Detected quiet while recording event..."),this.recording_event=!1,this.media_recorder.stop(),this.log("Stopped recording"))}else if(t){let e=this;this.media_recorder.ondataavailable=function(t){let n=t.data,r=new window.CustomEvent("sound_event_ended",{detail:n});e.dispatchEvent(r)},this.media_recorder.start(),this.log("Detected event start"),this.time_since_last_detection=performance.now();let t=new window.Event("sound_event_started");this.dispatchEvent(t),this.recording_event=!0,this.event_start_time=N.util.unix_timestamp_ms()}}samples_to_ms(e){return 1e3*e/this.sampling_rate}ms_to_samples(e){return e*this.sampling_rate/1e3}num_buffers_to_cover_margin(){let e=this.ms_to_samples(this.margin);return Math.ceil(e/this.audio_buffer_size)}});var Ag=null,Pg="";function Tg(e){console.log("new text:"+e)}function Eg(e){_t(e)}function xg(e){_t(e)}function Ig(){console.log("finished stream"),ht()}function Cg(e,t){let n=e;Ag=window.setInterval((function(){let e=document.querySelector(".result-streaming");if(e){let n=e.innerText,r=n.replace(Pg,"");t?Eg(r):Tg(r),Pg=n}else if(""==Pg);else{let e=N.fp.last(Array.from(document.querySelectorAll("div.markdown"))).innerText.replace(Pg,"");t?Eg(e):Tg(e),Pg="",Ig()}}),n)}var Og=["Google UK English Female","Google UK English Male","Google UK English","Karen","Rishi"];function Sg(){window.clearInterval(Ag)}function Ng(e){vt(e)}async function jg(){await K(),vt(1.3),bt(Og)}var Dg=2e3;async function Rg(){kg(),await jg(),Cg(Dg,!1)}async function $g(){kg(),await jg(),Cg(Dg,!0)}})();var o=t;for(var l in a)o[l]=a[l];a.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r);var e=n(515);window.tsw=e})(),r})()));