TIDYSCRIPTS MONOREPO OPTIMIZATION OPPORTUNITIES
Generated: 2026-01-08
===============================================

## üî• CRITICAL (DO THESE FIRST)

### 1. Turbo Cache Explosion (16GB!)
ISSUE: .turbo is consuming 16GB of local disk space
IMPACT: Massive disk waste on local machine
ACTION:
  - Clean old cache: turbo prune
  - Configure cache limits in turbo.json (e.g., max size or retention)
  - Consider: turbo run build --force to rebuild and refresh cache
NOTE: Already in .gitignore (not committed to repo)
SAVINGS: 16GB ‚Üí 1-2GB (14GB local disk space freed)

### 2. Missing Critical Dependency
ISSUE: openai package used in 9+ files but NOT in package.json
FILES: All API routes using OpenAI (claude_response.ts, openai_response.ts, etc.)
RISK: Production failure if transitive dependency changes
ACTION: npm install openai --save
IMPACT: Critical bug fix

### 3. Data Directory (1.1GB)
ISSUE: /data/data/.cache/ghe_embeddings: 889MB
       /data/docs.surrealdb.com: 188MB
ACTION: Move to separate data repo or add to .gitignore
SAVINGS: 1.1GB

TOTAL IMMEDIATE SAVINGS: 17GB+ disk space


## ‚ö° HIGH IMPACT (IMPROVES PERFORMANCE)

### 4. Outdated Build Tools (Webpack)
CURRENT: Using webpack 5.91.0 across 3 packages
  - ts_common: 916KB bundle, slow builds
  - ts_web: Complex webpack config for simple bundling
  - ts_web_umd: Webpack overkill for UMD builds
RECOMMENDATION: Migrate to tsup or esbuild
  - Install: npm install -D tsup
  - Replace webpack.config.cjs with tsconfig.json
  - Update package.json build scripts
IMPACT: 5-10x faster package builds (18s ‚Üí 2-3s)

### 5. Duplicate Webpack Installations
ISSUE: webpack-cli installed separately in ts_web and ts_node
WASTE: ~188MB in duplicate node_modules
ACTION: Hoist to root package.json devDependencies
SAVINGS: 188MB

### 6. Complex Prebuild Step
CURRENT: prebuild copies 15MB of ONNX files every build
  "prebuild": "type-check && lint && generate_build_info && cp WASM..."
ISSUE: Wastes time on every build, even when ONNX unchanged
ACTION: Move ONNX copying to postinstall script
  - Create scripts/setup-onnx.js
  - Add "postinstall": "node scripts/setup-onnx.js"
  - Remove ONNX copying from prebuild
IMPACT: Faster iterative builds

### 7. Missing Code Splitting
ISSUE: Only 11 dynamic imports found across entire app
  - 162 laboratory files (2.5MB) loaded eagerly
  - Heavy components not lazy-loaded
ACTION:
  - Lazy load laboratory pages: const Page = dynamic(() => import('./lab/page'))
  - Lazy load @mui/icons-material (130MB package!)
  - Use Next.js route-based code splitting
IMPACT: 100-200MB smaller initial bundle


## üì¶ MEDIUM IMPACT (REDUCES BUNDLE SIZE)

### 8. Duplicate UI Libraries
ISSUE: Both Chakra UI AND Material-UI installed
  - MUI: 145MB in node_modules
  - Chakra: ~50MB
  - 313 imports across 108 files using both
RECOMMENDATION: Standardize on ONE library
  - Audit which is used more
  - Migrate all components to chosen library
  - Remove the other
SAVINGS: 100MB+ bundle, faster builds

### 9. Large Public Assets
ISSUE:
  - /public/tidyscripts_web_umd.js: 1.2MB uncompressed
  - /public/onnx/: 15MB (12MB WASM file)
ACTION:
  - Enable gzip/brotli compression
  - Lazy load ONNX runtime only when VAD features used
  - Consider CDN for large static assets
IMPACT: Faster initial page load

### 10. Firebase Version Conflicts
ISSUE: Multiple Firebase versions across packages
  - ts_next_app: 10.12.4
  - ts_node: 10.12.0
  - root: 12.5.0
RISK: Compatibility issues, auth conflicts
ACTION: Standardize on single Firebase version (12.5.0)
  - Update all packages to firebase@12.5.0
  - Test auth flows
  - Test Firebase Functions

### 11. Outdated Dependencies (Major Versions Behind)
CRITICAL UPDATES:
  - @langchain/*: 0.2.x ‚Üí 1.x (major breaking changes)
  - @mui/material: 6.4.7 ‚Üí 7.3.7
  - @chakra-ui/react: 2.10.6 ‚Üí 3.30.0
  - @openai/agents: 0.2.1 ‚Üí 0.3.7
  - @google/generative-ai: 0.17.1 ‚Üí 0.24.1
ACTION: Update cautiously, test after each major bump
  - npm outdated (check all)
  - npm update (patch/minor)
  - Manually update majors with testing

### 12. Likely Unused Dependencies
FOUND BY DEPCHECK:
  - @ricky0123/vad-react
  - graphology-layout
  - crypto (Node.js built-in, shouldn't be in dependencies)
ACTION: Run comprehensive audit
  - npm install -g depcheck
  - depcheck
  - Remove confirmed unused deps
SAVINGS: 50-100MB


## üßπ CODE ORGANIZATION

### 13. Laboratory Directory Bloat
ISSUE: 162 files in /app/laboratory/ (many old experiments)
EXAMPLES: tobi, mimi, bokeh, vip, cortex, cortex_0, neo_cortex
QUESTION: Which are still active?
ACTION:
  - Archive old experiments to separate repo
  - Keep only active laboratory features
  - Document what each does
SAVINGS: Cleaner codebase, faster searches

### 14. tidyscripts_common Tight Coupling
ISSUE: 148 imports across 111 files
IMPACT: Every change rebuilds everything via Turbo
CONSIDERATION: Split into smaller focused packages
  - tidyscripts_common_core (essentials)
  - tidyscripts_common_ai (LLM/AI utilities)
  - tidyscripts_common_crypto (blockchain/crypto)
BENEFIT: Faster incremental builds

### 15. Console.log Pollution
ISSUE: 228 console statements across 69 files
IMPACT: Noisy logs, potential info leaks in production
ACTION: Use proper logging library
  - Install: npm install winston or pino
  - Replace console.log with logger.debug/info/error
  - Disable debug logs in production

### 16. Large Source Files
ISSUE: Multiple files over 1000 lines
ACTION: Split large components into smaller modules
  - Extract hooks to separate files
  - Split complex components
  - Create focused utility files
BENEFIT: Better maintainability, easier code review


## üóÑÔ∏è CACHE & ARTIFACTS

### 17. Next.js Build Cache (1.1GB)
ISSUE: .next/cache: 1.1GB webpack cache
ACTION:
  - Verify .next in .gitignore
  - Configure cache limits in next.config.mjs:
    experimental: {
      webpackBuildWorker: true,
      caseSensitiveRoutes: true
    }
ALREADY GOOD: Using Next.js incremental builds

### 18. Node Modules Duplication
CURRENT:
  - Root: 1.8GB
  - ts_next_app: 242MB
  - ts_node: 119MB
  - ts_web: 69MB
  - Total: 2.2GB
ISSUE: Common devDependencies duplicated
ACTION: Better workspace hoisting
  - Move common devDeps to root
  - Use npm workspaces properly
  - Consider pnpm for better deduplication
SAVINGS: 200-400MB

### 19. Package Manager Consideration
CURRENT: npm@10.8.3
ALTERNATIVE: pnpm
BENEFITS:
  - 30-50% less disk space
  - 2-3x faster installations
  - Better dependency isolation
CONSIDERATION: Migration effort vs. benefits


## üîÑ CI/CD

### 20. Minimal CI/CD Setup
CURRENT: Only vercel.json (Node version spec)
MISSING:
  - No GitHub Actions
  - No automated testing
  - No build verification
  - No dependency updates
ACTION: Add GitHub Actions workflow
  - Type checking
  - Linting
  - Tests (currently only 1 test!)
  - Build verification
  - Preview deployments
BENEFIT: Catch issues before production

### 21. Testing Coverage (Critical!)
ISSUE: Only 1 test file found (deliriumDiagnosis.test.tsx)
RISK: Bugs slip into production
ACTION:
  - Add tests for critical paths
  - Set up test coverage reporting
  - Add to CI pipeline
  - Target: >80% coverage for core features


## üéØ PERFORMANCE

### 22. Heavy Initial Bundle (Likely)
ISSUE: No route-based code splitting evident
  - Large UI libraries loaded upfront
  - Laboratory features not lazy-loaded
ACTION:
  - Use Next.js App Router automatic splitting
  - Lazy load MUI icons (biggest offender - 130MB!)
  - Defer non-critical JavaScript
IMPACT: Faster initial page load (TTI)

### 23. Potential Memory Leaks
ISSUE: 439 useEffect/useState in laboratory alone
RISK: Many might be missing cleanup functions
ACTION: Audit useEffect dependencies
  - Check for missing cleanup in useEffect
  - Verify event listeners are removed
  - Check for unsubscribed subscriptions
TOOL: React DevTools Profiler


## üìã PRIORITY ACTION PLAN

### PHASE 1: Immediate (Today - Saves 16GB+)
‚úì Already done:
  - Cleaned 20MB artifacts
  - Optimized Turbo caching for builds
  - Fixed type-checking

TODO:
1. Clean .turbo cache (16GB local disk space freed)
   cd /home/oluwa/dev/tidyscripts && turbo prune
   # Note: Already in .gitignore

2. Add openai dependency
   cd apps/ts_next_app && npm install openai --save

3. Clean data directory
   Review /data/data/.cache/ghe_embeddings (889MB)
   Move to separate repo or .gitignore

ESTIMATED TIME: 30 minutes
IMPACT: 17GB disk space, critical bug fix


### PHASE 2: High Impact (This Week - 5-10x Faster Builds)
4. Migrate packages from webpack to tsup
   - Start with ts_common
   - Then ts_web, ts_web_umd
   ESTIMATED TIME: 2-3 hours
   IMPACT: 5-10x faster package builds

5. Hoist common devDependencies
   Move webpack, typescript, etc. to root
   ESTIMATED TIME: 1 hour
   IMPACT: 188MB saved, cleaner setup

6. Move ONNX to postinstall
   Create scripts/setup-onnx.js
   Remove from prebuild
   ESTIMATED TIME: 30 minutes
   IMPACT: Faster iterative builds

ESTIMATED TIME: 1 day
IMPACT: Much faster development iteration


### PHASE 3: Medium Impact (Next Week - 100MB+ Smaller)
7. Pick ONE UI library (Chakra vs MUI)
   - Audit usage
   - Plan migration
   - Execute migration
   ESTIMATED TIME: 2-3 days
   IMPACT: 100MB+ smaller bundle

8. Add lazy loading
   - Laboratory pages
   - MUI icons
   - Heavy components
   ESTIMATED TIME: 1 day
   IMPACT: 100-200MB smaller initial bundle

9. Update critical dependencies
   @langchain, @openai/agents, Firebase
   ESTIMATED TIME: 1 day
   IMPACT: Security fixes, new features

ESTIMATED TIME: 1 week
IMPACT: Much faster page loads


### PHASE 4: Long Term (Next Month)
10. Add comprehensive testing
    Target: >80% coverage
    ESTIMATED TIME: Ongoing
    IMPACT: Fewer production bugs

11. Set up CI/CD pipeline
    GitHub Actions with automated checks
    ESTIMATED TIME: 1 day
    IMPACT: Catch issues early

12. Archive old laboratory experiments
    Document active vs. inactive
    ESTIMATED TIME: 1 day
    IMPACT: Cleaner codebase

13. Consider pnpm migration
    For better disk usage
    ESTIMATED TIME: 1 day
    IMPACT: 30-50% less disk space


## üìä ESTIMATED TOTAL IMPACT

DISK SPACE:
  - Current: ~20GB (node_modules + .turbo + data)
  - After optimizations: ~5-8GB
  - Savings: 12-15GB (60-75% reduction)

BUILD TIME:
  - Package builds: 5-10x faster (webpack ‚Üí tsup)
  - Incremental builds: Already optimized (Turbo caching)
  - CI builds: Will be tracked with CI setup

BUNDLE SIZE:
  - Initial bundle: 100-200MB smaller
  - Total bundle: 150-300MB smaller
  - Impact: Faster page loads, better performance

DEVELOPER EXPERIENCE:
  - Faster installs (if pnpm)
  - Faster builds
  - Better testing
  - Automated checks
  - Cleaner dependencies


## ü§î QUESTIONS FOR YOU

1. Which UI library do you prefer - Chakra or MUI?
2. Which laboratory experiments are still active vs. archive?
3. Do you want to migrate to pnpm or stay with npm?
4. What's your testing strategy going forward?
5. Any specific performance issues you've noticed?


## üìù NOTES

- These recommendations are based on analysis of the codebase structure
- Some recommendations may need adjustment based on your specific use cases
- Always test changes in a separate branch before merging
- Consider creating a "optimization" branch for these changes
- Track impact of each change to validate improvements

Last updated: 2026-01-08
Analysis performed by: Claude Code
